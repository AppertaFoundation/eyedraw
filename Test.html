<!DOCTYPE html>
<html>
    <head>
        <title>EyeDraw</title>
        
        <link rel="stylesheet" href="styles.css" type="text/css" media="screen" />
        
        <!--   Include this file first to establish name space -->
        <script language="JavaScript" src="ED_Drawing.js" type="text/javascript"></script>
        
        <!--   Subclasses loaded according to need as determined by PHP   -->
        <script language="JavaScript" src="ED_VitreoRetinal.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_Cancer.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_Basic.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_AntSeg.js" type="text/javascript"></script>
        
        <!--   This script handles the drawings for the page   -->
        <script type="text/javascript">
            
//            $(document).ready(function() {
//                              $("a").click(function() {
//                                           alert("Hello world!");
//                                           });
//                              });
            
            
            // This set is written by PHP and contains doodle data for this drawing from the database
            var doodleSetRPS = 
            
[{"subclass": "Freehand", "originX": 0, "originY": 0, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 180, "rotation": 0, "order": 0, "squiggleArray": [{"colour": {"red":255,"green":0,"blue":0,"alpha":1}, "thickness": 4, "filled": "true", "pointsArray": [{"x":-36.96,"y":-114.89}, {"x":-32.97,"y":-110.89}, {"x":-30.97,"y":-108.89}, {"x":-20.98,"y":-102.90}, {"x":-16.98,"y":-102.90}, {"x":-5.00,"y":-100.90}, {"x":5.00,"y":-100.90}, {"x":18.98,"y":-100.90}, {"x":26.97,"y":-100.90}, {"x":36.96,"y":-100.90}, {"x":40.96,"y":-102.90}, {"x":44.96,"y":-102.90}, {"x":46.95,"y":-104.90}, {"x":48.95,"y":-106.89}, {"x":48.95,"y":-110.89}, {"x":50.95,"y":-112.89}, {"x":52.95,"y":-116.88}, {"x":52.95,"y":-118.88}, {"x":52.95,"y":-120.88}, {"x":52.95,"y":-122.88}, {"x":52.95,"y":-126.87}, {"x":52.95,"y":-128.87}, {"x":52.95,"y":-132.87}, {"x":52.95,"y":-136.86}, {"x":50.95,"y":-138.86}, {"x":50.95,"y":-140.86}, {"x":50.95,"y":-142.86}, {"x":50.95,"y":-146.85}, {"x":48.95,"y":-152.85}, {"x":48.95,"y":-156.84}, {"x":46.95,"y":-160.84}, {"x":46.95,"y":-162.84}, ]}, ]}, {"subclass": "RoundHole", "originX": 0, "originY": -376, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 180, "rotation": 0, "order": 1, "squiggleArray": []}, ]
            
            
            //[
             //{subclass: "Fundus", originX: "0", originY: "0", apexX: "0", apexY: "0", scaleX: "1", scaleY: "1", arc: "0", rotation: "0", order: "0"},
//             {subclass: "RRD", originX: "0", originY: "0", apexX: "0", apexY: "105", scaleX: "1", scaleY: "1", arc: "160", rotation: "330", order: "1"},
//             {subclass: "UTear", originX: "-212", originY: "-320", apexX: "0", apexY: "-22", scaleX: "1", scaleY: "1", arc: "0", rotation: "327", order: "2"}
             //{subclass: "AntSeg", originX: "0", originY: "0", apexX: "0", apexY: "-300", scaleX: "1", scaleY: "1", arc: "0", rotation: "0", order: "0"}
             //]
            
            // Variables assigned to each drawing on this page
            var drawingRPS;
            
            // Pre-load pattern images
            var latticeImg = new Image();
            latticeImg.src = 'graphics/latticePattern.gif';
            var cryoImg = new Image();
            cryoImg.src = 'graphics/cryoPattern.gif';
            var antPVRImg = new Image();
            antPVRImg.src = 'graphics/antPVRPattern.gif';
            
            // Runs on page load
            function init()
            {
                // Get reference to RPS canvas
                var canvasRPS = document.getElementById('canvasRPS');
                
                // Create blank posterior segment drawing
                drawingRPS = new ED.Drawing(canvasRPS, ED.eye.Right, 'RPS');
                
                // Stop browser stealing double click to select text (TODO Test this in browsers other than Safari)
                canvasRPS.onselectstart = function () { return false; }
                
                // Event listeners  - use Chris' function to deal with Firefox problem of undefined offset
                canvasRPS.addEventListener('mousedown', function(e) { 
                                           var pos = findPos(canvasRPS);
                                           var point = new ED.Point(e.pageX-pos.x,e.pageY-pos.y);
                                           drawingRPS.mousedown(point); 
                                           }, false);
                
                canvasRPS.addEventListener('mouseup', function(e) { 
                                           var pos = findPos(canvasRPS);
                                           var point = new ED.Point(e.pageX-pos.x,e.pageY-pos.y);
                                           drawingRPS.mouseup(point); 
                                           }, false);
                
                canvasRPS.addEventListener('mousemove', function(e) { 
                                           var pos = findPos(canvasRPS);
                                           var point = new ED.Point(e.pageX-pos.x,e.pageY-pos.y);
                                           drawingRPS.mousemove(point); 
                                           }, false);
                
                canvasRPS.addEventListener('mouseout', function(e) { 
                                           var pos = findPos(canvasRPS);
                                           var point = new ED.Point(e.pageX-pos.x,e.pageY-pos.y);
                                           drawingRPS.mouseout(point); 
                                           }, false);
                
                // Capture keystrokes for interaction with drawing
                window.addEventListener('keydown',function(e) {
                                        drawingRPS.keydown(e);
                                        }, true);
                
                
                // Event listeners for iOS
                canvasRPS.addEventListener('touchstart', function(e) { 
                                           var point = new ED.Point(e.targetTouches[0].pageX - canvasRPS.offsetLeft,e.targetTouches[0].pageY - canvasRPS.offsetTop);
                                           e.preventDefault();
                                           drawingRPS.mousedown(point); 
                                           }, false);
                
                canvasRPS.addEventListener('touchend', function(e) { 
                                           var point = new ED.Point(e.targetTouches[0].pageX - canvasRPS.offsetLeft,e.targetTouches[0].pageY - canvasRPS.offsetTop);
                                           drawingRPS.mouseup(point); 
                                           }, false);
                
                canvasRPS.addEventListener('touchmove', function(e) { 
                                           var point = new ED.Point(e.targetTouches[0].pageX - canvasRPS.offsetLeft,e.targetTouches[0].pageY - canvasRPS.offsetTop);
                                           drawingRPS.mousemove(point); 
                                           }, false);

                canvasRPS.focus();
                
                
                // Load doodleSet (for existing drawings)
                drawingRPS.load(doodleSetRPS);
                
                // Use fundus as template (for new drawings)
                //drawingRPS.addDoodle('RRD');
                //drawingRPS.lock();
                
                // Draw doodles
                drawingRPS.drawAllDoodles();


                
            }
            
            
            // Chris' function for getting accurate mouse position
            function findPos(obj) {
                var curleft = curtop = 0;
                if (obj.offsetParent) {
                    do {
                        curleft += obj.offsetLeft;
                        curtop += obj.offsetTop;
                    } while (obj = obj.offsetParent);
                    return { x: curleft, y: curtop };
                }
            }
        
            // Returns true if browser is firefox
            function isFirefox()
            {
                var index = 0;
                var ua = window.navigator.userAgent;
                index = ua.indexOf("Firefox");
                
                if (index > 0)
                {
                    return true;
                }
                else
                {
                    return false;
                }
            }
            
            // changes eye and flips fundus right or left
            function flip()
            {
                drawingRPS.flipFundus();
            }
            
            // Changes colour of preview display
            function changeColour(_hexColour)
            {
                document.getElementById("divpreview").style.background=_hexColour;
            }
            
            </script>
    </head>
    <body onload="init();">
        <div>
            <div>
                <form>
                    <div>
                        <span>
                            <!-- Doodle toolbar -->
                            <button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingRPS.moveToFront(); return false;" ><img src="graphics/moveToFront.gif"/></button>
                            <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingRPS.moveToBack(); return false;" ><img src="graphics/moveToBack.gif" /></button>
                            <button class="imgbutton" disabled="true" id="deleteRPS" title="Delete" onclick="drawingRPS.deleteDoodle(); return false;" ><img src="graphics/delete.gif" /></button>
                            <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingRPS.lock(); return false;" ><img src="graphics/lock.gif" /></button>
                            <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingRPS.unlock(); return false;" ><img src="graphics/unlock.gif" /></button>

                            <!-- Squiggle options -->
                            <span class= "squiggle" id="squiggleSpanRPS">
                                <img class="colourWell" border="0" src="graphics/colourWell.gif" usemap="#colormap" alt='colormap' />
                                <map id="colormap" name="colormap">
                                    <area style="cursor:pointer" shape="rect" coords="0,0,16,16" onclick="changeColour('#000000');" />
                                    <area style="cursor:pointer" shape="rect" coords="16,0,32,16" onclick="changeColour('#FF0000');" />
                                    <area style="cursor:pointer" shape="rect" coords="32,0,48,16" onclick="changeColour('#FF7F00');" />
                                    <area style="cursor:pointer" shape="rect" coords="0,16,16,32" onclick="changeColour('#0000FF');" />
                                    <area style="cursor:pointer" shape="rect" coords="16,16,32,32" onclick="changeColour('#00FF00');" />
                                    <area style="cursor:pointer" shape="rect" coords="32,16,48,32" onclick="changeColour('#FFFF00');" />
                                </map>
                                <table class="preview" cellpadding="0" border="0" cellspacing="0" width="32"><tr><td width="32"><div id="divpreview" style="height:32px;width:32px;background-color:#FF0000;">&nbsp;</div></td></tr></table>
                                <select class="thickness" id="thicknessSelectRPS" >
									<option value="4">Thin</option>
									<option value="8">Medium</option>
									<option value="12">Thick</option>
								</select>
                                <span class="fill">
	                                <input class="fillbutton" type="radio" name="fill" value="clear"/>Outline<br />
	                                <input class="fillbutton" type="radio" name="fill" value="solid"/>Solid<br />
								</span>
                            </span>

                                                        
                            <br />
                            
                            <!-- Doodle selection toolbar -->
                            <button class="imgbutton" id="RRDRPS" title="Retinal detachment" onclick="drawingRPS.addDoodle('RRD'); return false;" ><img src="graphics/rrd.gif" /></button>
                            <button class="imgbutton" id="uTearRPS" title="U tear" onclick="drawingRPS.addDoodle('UTear'); return false;" ><img src="graphics/uTear.gif" /></button>
                            <button class="imgbutton" id="roundHoleRPS" title="Round hole" onclick="drawingRPS.addDoodle('RoundHole'); return false;" ><img src="graphics/roundHole.gif" /></button>
                            <button class="imgbutton" id="dialysisRPS" title="Dialysis" onclick="drawingRPS.addDoodle('Dialysis'); return false;" ><img src="graphics/dialysis.gif" /></button>
                            <button class="imgbutton" id="grtRPS" title="GRT" onclick="drawingRPS.addDoodle('GRT'); return false;" ><img src="graphics/grt.gif" /></button>
                            <button class="imgbutton" id="macularHoleRPS" title="Macular hole" onclick="drawingRPS.addDoodle('MacularHole'); return false;" ><img src="graphics/macularHole.gif" /></button>
                            <button class="imgbutton" id="starFoldRPS" title="Star Fold" onclick="drawingRPS.addDoodle('StarFold'); return false;" ><img src="graphics/starFold.gif" /></button>
                            <button class="imgbutton" id="antPVRRPS" title="Anterior PVR" onclick="drawingRPS.addDoodle('AntPVR'); return false;" ><img src="graphics/antPVR.gif" /></button>
                            <button class="imgbutton" id="latticeRPS" title="Lattice" onclick="drawingRPS.addDoodle('Lattice'); return false;" ><img src="graphics/lattice.gif" /></button>
                            <button class="imgbutton" id="cryoRPS" title="Cryo" onclick="drawingRPS.addDoodle('Cryo'); return false;" ><img src="graphics/cryo.gif" /></button>
                            <button class="imgbutton" id="buckleRPS" title="Buckle" onclick="drawingRPS.addDoodle('Buckle'); return false;" ><img src="graphics/buckle.gif" /></button>
                            <button class="imgbutton" id="buckleRPS" title="Freehand" onclick="drawingRPS.addDoodle('Freehand'); return false;" ><img src="graphics/freehand.gif" /></button>
                            <!-- Breast cancer doodles 
                            <button class="imgbutton" id="cryoRPS" title="Cryo" onclick="drawingRPS.addDoodle('Lump'); return false;" ><img src="graphics/cryo.gif" /></button>
                            <button class="imgbutton" id="buckleRPS" title="Buckle" onclick="drawingRPS.addDoodle('Scar'); return false;" ><img src="graphics/buckle.gif" /></button> -->

                            
                            
                            <br />  
                            <button class="imgbutton" id="antSeg" title="Anterior Segment" onclick="drawingRPS.addDoodle('AntSeg'); return false;" ><img src="graphics/antSeg.gif" /></button>
                            
                            <br />
                            <!-- add tabindex="1" to canvas after testing and remove highlighted border with css -->
                            <canvas id="canvasRPS" width="501" height="501"></canvas>
                            <br />
                            <button title="Report" onclick="console.log(drawingRPS.save()); return false;" >Save</button><br />
                            
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </body>
</html>