/*! eyedraw 02-04-2014 */
function EyeDrawChecker(){this._eyedraws=new Array,this._eyedrawsReady=new Array,this._allReadyListeners=new Array;var a=this;$("canvas").each(function(){($(this).hasClass("ed_canvas_display")||$(this).hasClass("ed_canvas_edit"))&&a._eyedraws.push($(this).attr("id"))}),this.eyedrawReady=function(a){if($.inArray(a,this._eyedraws)>-1&&-1==$.inArray(a,this._eyedrawsReady)&&(this._eyedrawsReady.push(a),this.allEyedrawsReady()))for(var b=0;b<this._allReadyListeners.length;b++)this._allReadyListeners[b]()},this.allEyedrawsReady=function(){return this._eyedraws.length==this._eyedrawsReady.length?!0:!1},this.registerForReady=function(a){this.allEyedrawsReady()?a():this._allReadyListeners.push(a)}}function getOEEyeDrawChecker(){return OEEyeDrawChecker||(OEEyeDrawChecker=new EyeDrawChecker),OEEyeDrawChecker}function EyeDrawReadyListener(a){this.drawing=a;var b="right";this.drawing.eye&&(b="left"),this.side=b,this.drawing.registerForNotifications(this,"callBack",["doodlesLoaded"]),this.callBack=function(){checker=getOEEyeDrawChecker(),checker.eyedrawReady(this.drawing.canvas.id)}}function eyeDrawInit(a){function b(b){this.drawing=b,this.drawing.registerForNotifications(this,"notificationHandler",["ready","doodlesLoaded","doodleAdded","doodleDeleted","doodleSelected","mousedragged","parameterChanged"]),this.notificationHandler=function(b){var d=document.getElementById(a.inputId);switch(b.eventName){case"ready":if(this.drawing.globalScaleFactor=a.scale,null!=d&&d.value.length>0)this.drawing.loadDoodles(a.inputId),this.drawing.repaint();else for(var e=0;e<a.onReadyCommandArray.length;e++){var f=a.onReadyCommandArray[e][0],g=a.onReadyCommandArray[e][1];this.drawing[f].apply(this.drawing,g)}ED.objectIsEmpty(a.bindingArray)||this.drawing.addBindings(a.bindingArray),ED.objectIsEmpty(a.deleteValueArray)||this.drawing.addDeleteValues(a.deleteValueArray),null!=d&&(d.value=window[a.drawingName].save()),a.focus&&c.focus(),this.drawing.isReady=!0;break;case"doodlesLoaded":for(var e=0;e<a.onDoodlesLoadedCommandArray.length;e++){var f=a.onDoodlesLoadedCommandArray[e][0],g=a.onDoodlesLoadedCommandArray[e][1];this.drawing[f].apply(this.drawing,g)}break;case"doodleAdded":null!=d&&d.value.length>0&&(d.value=this.drawing.save());var h=b.object;"undefined"!=typeof h&&"Label"==h.className&&c.focus();break;case"doodleDeleted":null!=d&&d.value.length>0&&(d.value=this.drawing.save());break;case"doodleSelected":for(var i in a.syncArray){var j=window["ed_drawing_edit_"+i];j.deselectDoodles()}break;case"mousedragged":null!=d&&d.value.length>0&&(d.value=this.drawing.save());break;case"parameterChanged":var k=b.object.doodle;for(var i in a.syncArray){var l=window["ed_drawing_edit_"+i];for(var m in a.syncArray[i])for(var n in a.syncArray[i][m]){var o=l.firstDoodleOfClass(n);if(k&&k.className==m&&o&&o.willSync){var p=a.syncArray[i][m][n].parameters;if("undefined"!=typeof p)for(var e=0;e<p.length;e++)if(p[e]==b.object.parameter&&k[b.object.parameter]!=o[b.object.parameter]){var q=b.object.value-b.object.oldValue,r=o[b.object.parameter]+q;o.setSimpleParameter(b.object.parameter,r),o.updateDependentParameters(b.object.parameter),l.updateBindings(o)}}}l.repaint()}null!=d&&d.value.length>0&&(d.value=this.drawing.save())}}}var c=document.getElementById(a.canvasId),d=new Array;d.offsetX=a.offsetX,d.offsetY=a.offsetY,d.toImage=a.toImage,d.graphicsPath=a.graphicsPath,window[a.drawingName]=new ED.Drawing(c,a.eye,a.idSuffix,a.isEditable,d),window["ed_controller_"+a.idSuffix]=new b(window[a.drawingName]);for(var e=new Array,f=0;f<a.listenerArray.length;f++)e[f]=new a.listenerArray[f](window[a.drawingName]);e.push(new EyeDrawReadyListener(window[a.drawingName])),window[a.drawingName].init()}var OEEyeDrawChecker;