/*! eyedraw 11-09-2013 */
function EyeDrawChecker(){this._eyedraws=[],this._eyedrawsReady=[],this._allReadyListeners=[];var t=this;$("canvas").each(function(){($(this).hasClass("ed_canvas_display")||$(this).hasClass("ed_canvas_edit"))&&t._eyedraws.push($(this).attr("id"))}),this.eyedrawReady=function(t){if($.inArray(t,this._eyedraws)>-1&&-1==$.inArray(t,this._eyedrawsReady)&&(this._eyedrawsReady.push(t),this.allEyedrawsReady()))for(var e=0;this._allReadyListeners.length>e;e++)this._allReadyListeners[e]()},this.allEyedrawsReady=function(){return this._eyedraws.length==this._eyedrawsReady.length?!0:!1},this.registerForReady=function(t){this.allEyedrawsReady()?t():this._allReadyListeners.push(t)}}function getOEEyeDrawChecker(){return OEEyeDrawChecker||(OEEyeDrawChecker=new EyeDrawChecker),OEEyeDrawChecker}function EyeDrawReadyListener(t){this.drawing=t;var e="right";this.drawing.eye&&(e="left"),this.side=e,this.drawing.registerForNotifications(this,"callBack",["doodlesLoaded"]),this.callBack=function(){checker=getOEEyeDrawChecker(),checker.eyedrawReady(this.drawing.canvas.id)}}function eyeDrawInit(t){function e(e){this.drawing=e,this.drawing.registerForNotifications(this,"notificationHandler",["ready","doodlesLoaded","doodleAdded","doodleDeleted","doodleSelected","mousedragged","parameterChanged"]),this.notificationHandler=function(e){var a=document.getElementById(t.inputId);switch(e.eventName){case"ready":if(this.drawing.globalScaleFactor=t.scale,null!=a&&a.value.length>0)this.drawing.loadDoodles(t.inputId),this.drawing.repaint();else for(var i=0;t.onReadyCommandArray.length>i;i++){var o=t.onReadyCommandArray[i][0],s=t.onReadyCommandArray[i][1];this.drawing[o].apply(this.drawing,s)}ED.objectIsEmpty(t.bindingArray)||this.drawing.addBindings(t.bindingArray),ED.objectIsEmpty(t.deleteValueArray)||this.drawing.addDeleteValues(t.deleteValueArray),null!=a&&(a.value=window[t.drawingName].save()),t.focus&&r.focus(),this.drawing.isReady=!0;break;case"doodlesLoaded":for(var i=0;t.onDoodlesLoadedCommandArray.length>i;i++){var o=t.onDoodlesLoadedCommandArray[i][0],s=t.onDoodlesLoadedCommandArray[i][1];this.drawing[o].apply(this.drawing,s)}break;case"doodleAdded":null!=a&&a.value.length>0&&(a.value=this.drawing.save());var n=e.object;n!==void 0&&"Label"==n.className&&r.focus();break;case"doodleDeleted":null!=a&&a.value.length>0&&(a.value=this.drawing.save());break;case"doodleSelected":for(var l in t.syncArray){var h=window["ed_drawing_edit_"+l];h.deselectDoodles()}break;case"mousedragged":null!=a&&a.value.length>0&&(a.value=this.drawing.save());break;case"parameterChanged":var d=e.object.doodle;for(var l in t.syncArray){var c=window["ed_drawing_edit_"+l];for(var p in t.syncArray[l])for(var D in t.syncArray[l][p]){var u=c.firstDoodleOfClass(D);if(d&&d.className==p&&u&&u.willSync){var y=t.syncArray[l][p][D].parameters;if(y!==void 0)for(var i=0;y.length>i;i++)if(y[i]==e.object.parameter&&d[e.object.parameter]!=u[e.object.parameter]){var g=e.object.value-e.object.oldValue,E=u[e.object.parameter]+g;u.setSimpleParameter(e.object.parameter,E),u.updateDependentParameters(e.object.parameter),c.updateBindings(u)}}}c.repaint()}null!=a&&a.value.length>0&&(a.value=this.drawing.save())}}}var r=document.getElementById(t.canvasId),a=[];a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.toImage=t.toImage,a.graphicsPath=t.graphicsPath,window[t.drawingName]=new ED.Drawing(r,t.eye,t.idSuffix,t.isEditable,a),window["ed_controller_"+t.idSuffix]=new e(window[t.drawingName]);for(var i=[],o=0;t.listenerArray.length>o;o++)i[o]=new t.listenerArray[o](window[t.drawingName]);i.push(new EyeDrawReadyListener(window[t.drawingName])),window[t.drawingName].init()}var OEEyeDrawChecker;