/*! eyedraw 13-12-2013 */
var ED={};if(ED.handleRadius=15,ED.arrowDelta=4,ED.squiggleWidth={Thin:4,Medium:12,Thick:20},ED.squiggleStyle={Outline:0,Solid:1},ED.recentClick=!1,ED.eye={Right:0,Left:1},ED.drawFunctionMode={Draw:0,HitTest:1},ED.Mode={None:0,Move:1,Scale:2,Arc:3,Rotate:4,Apex:5,Handles:6,Draw:7,Select:8,Size:9},ED.handleRing={Inner:0,Outer:1},ED.modified=!1,ED.findOffset=function(t,e,r){if(t.offsetParent){do e+=t.offsetLeft,r+=t.offsetTop;while(t=t.offsetParent);return{left:e,top:r}}},ED.findPosition=function(t,e){if("undefined"!=typeof jQuery)var r=jQuery(t).offset();else var r=ED.findOffset(t,0,0);return{x:e.pageX-r.left,y:e.pageY-r.top}},ED.objectIsEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},ED.isFirefox=function(){var t=0,e=window.navigator.userAgent;return t=e.indexOf("Firefox"),t>0?!0:!1},ED.Mod=function(t,e){return t-Math.floor(t/e)*e},ED.positiveAngle=function(t){for(var e=2*Math.PI;0>t;)t+=e;return t%e},ED.errorHandler=function(t,e,r){console.log("EYEDRAW ERROR! class: ["+t+"] method: ["+e+"] message: ["+r+"]")},ED.randomArray=[.657,.2886,.7388,.1621,.9896,.0434,.1695,.9099,.1948,.4433,.158,.7392,.873,.2165,.7138,.6316,.3425,.2838,.4551,.4153,.7421,.3364,.6087,.1986,.5764,.1952,.6179,.6699,.0903,.2968,.2684,.9383,.2488,.4579,.2921,.9085,.7951,.45,.2255,.3366,.667,.73,.5511,.5623,.1376,.5553,.9898,.4317,.5922,.6452,.5008,.7077,.0704,.2293,.5697,.7415,.1557,.2944,.4566,.4129,.2449,.562,.4105,.5486,.8917,.9346,.0921,.7998,.7717,.0357,.1179,.0168,.152,.5187,.3466,.1663,.5935,.7524,.841,.1859,.6012,.8171,.9272,.3367,.8133,.4868,.3665,.9625,.7839,.3052,.1651,.6414,.7361,.0065,.3267,.0554,.3389,.8967,.8777,.0557,.9201,.6015,.2676,.3365,.2606,.0989,.2085,.3526,.8476,.0146,.019,.6896,.5198,.9871,.0288,.8037,.6741,.2148,.2584,.8447,.848,.5557,.248,.4736,.8869,.1867,.3869,.6871,.1011,.7561,.734,.1525,.9968,.8179,.7103,.5462,.415,.4187,.0478,.6511,.0386,.5243,.7271,.9093,.4461,.1264,.0756,.9405,.7287,.0684,.282,.4059,.3694,.7641,.4188,.0498,.7841,.9136,.621,.2249,.9935,.9709,.0741,.6218,.3166,.2237,.7754,.4191,.2195,.2935,.4529,.9112,.9183,.3275,.1856,.8345,.0442,.6297,.903,.4689,.9512,.2219,.9993,.8981,.1018,.9362,.6426,.4563,.1267,.7889,.5057,.8588,.4669,.0687,.6623,.3681,.8152,.9004,.0822,.3652],ED.Drawing=function(t,e,r,a,i){var o=0,s=0,n=!1;if(this.controllerFunctionName="eyeDrawController",this.graphicsPath="img/",this.scaleOn="height",i!==void 0&&(i.offsetX&&(o=i.offsetX),i.offsetY&&(s=i.offsetY),i.toImage&&(n=i.toImage),i.controllerFunctionName&&(this.controllerFunctionName=i.controllerFunctionName),i.graphicsPath&&(this.graphicsPath=i.graphicsPath),i.scaleOn&&(this.scaleOn=i.scaleOn)),this.canvas=t,this.eye=e,this.idSuffix=r,this.isEditable=a,this.hoverTimer=null,this.convertToImage=n&&!this.isEditable?!0:!1,this.context=this.canvas.getContext("2d"),this.doodleArray=[],this.bindingArray=[],this.listenerArray=[],this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.selectedDoodle=null,this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.lastMousePosition=new ED.Point(0,0),this.doubleClickMilliSeconds=250,this.readyNotificationSent=!1,this.newPointOnClick=!1,this.completeLine=!1,this.globalScaleFactor=1,this.scrollValue=0,this.lastDoodleId=0,this.isActive=!1,this.isNew=!0,this.isReady=!1,this.showDoodleControls=!1,this.boundElementDeleteValueArray=[],this.canvasParent=this.canvas.parentElement,this.notificationArray=[],this.canvasTooltip=document.getElementById(this.canvas.id+"Tooltip"),this.scale="height"==this.scaleOn?this.canvas.height/1001:this.canvas.width/1001,this.doodlePlaneWidth=this.canvas.width/this.scale,this.doodlePlaneHeight=this.canvas.height/this.scale,this.imageArray=[],this.imageArray.LatticePattern=new Image,this.imageArray.CribriformPattern=new Image,this.imageArray.CribriformPatternSmall=new Image,this.imageArray.CryoPattern=new Image,this.imageArray.AntPVRPattern=new Image,this.imageArray.LaserPattern=new Image,this.imageArray.FuchsPattern=new Image,this.imageArray.PSCPattern=new Image,this.imageArray.MeshworkPatternLight=new Image,this.imageArray.MeshworkPatternMedium=new Image,this.imageArray.MeshworkPatternHeavy=new Image,this.imageArray.NewVesselPattern=new Image,this.imageArray.OedemaPattern=new Image,this.imageArray.OedemaPatternBullous=new Image,this.imageArray.BrownSpotPattern=new Image,this.transform.translate(this.canvas.width/2,this.canvas.height/2),this.transform.scale(this.scale,this.scale),this.inverseTransform=this.transform.createInverse(),this.clear(),this.moveToFrontButton=document.getElementById("moveToFront"+this.idSuffix),this.moveToBackButton=document.getElementById("moveToBack"+this.idSuffix),this.flipVerButton=document.getElementById("flipVer"+this.idSuffix),this.flipHorButton=document.getElementById("flipHor"+this.idSuffix),this.deleteSelectedDoodleButton=document.getElementById("deleteSelectedDoodle"+this.idSuffix),this.lockButton=document.getElementById("lock"+this.idSuffix),this.unlockButton=document.getElementById("unlock"+this.idSuffix),this.selectionRectangleIsBeingDragged=!1,this.selectionRectangleStart=new ED.Point(0,0),this.selectionRectangleEnd=new ED.Point(0,0),this.isEditable){var l=this;this.canvas.addEventListener("mousedown",function(t){var e=ED.findPosition(this,t),r=new ED.Point(e.x,e.y);l.mousedown(r)},!1),this.canvas.addEventListener("mouseup",function(t){var e=ED.findPosition(this,t),r=new ED.Point(e.x,e.y);l.mouseup(r)},!1),this.canvas.addEventListener("mousemove",function(t){var e=ED.findPosition(this,t),r=new ED.Point(e.x,e.y);l.mousemove(r)},!1),this.canvas.addEventListener("mouseover",function(t){var e=ED.findPosition(this,t),r=new ED.Point(e.x,e.y);l.mouseover(r)},!1),this.canvas.addEventListener("mouseout",function(t){var e=ED.findPosition(this,t),r=new ED.Point(e.x,e.y);l.mouseout(r)},!1),this.canvas.addEventListener("touchstart",function(t){if(void 0!==t.targetTouches[0]){var e=l.getPositionOfElement(l.canvas),r=new ED.Point(t.targetTouches[0].pageX-e[0]-this.offsetLeft,t.targetTouches[0].pageY-e[1]);t.preventDefault()}else ED.errorHandler("ED.Drawing","Class","Touches undefined: ");l.mousedown(r)},!1),this.canvas.addEventListener("touchend",function(t){if(void 0!==t.targetTouches[0]){var e=l.getPositionOfElement(l.canvas),r=new ED.Point(t.targetTouches[0].pageX-e[0]-this.offsetLeft,t.targetTouches[0].pageY-e[1]);l.mouseup(r)}},!1),this.canvas.addEventListener("touchmove",function(t){if(void 0!==t.targetTouches[0]){var e=l.getPositionOfElement(l.canvas),r=new ED.Point(t.targetTouches[0].pageX-e[0]-this.offsetLeft,t.targetTouches[0].pageY-e[1]);l.mousemove(r)}},!1),window.addEventListener("keydown",function(e){document.activeElement===t&&l.keydown(e)},!0),this.canvas.onselectstart=function(){return!1}}},ED.Drawing.prototype.getPositionOfElement=function(t){for(var e=0,r=0;;){if(e+=t.offsetLeft,r+=t.offsetTop,null===t.offsetParent)break;t=t.offsetParent}return[e,r]},ED.Drawing.prototype.init=function(){this.preLoadImagesFrom(this.graphicsPath)},ED.Drawing.prototype.replaceWithImage=function(){var t=document.createElement("img");if(t.setAttribute("src",this.canvas.toDataURL("image/png")),this.canvasParent.hasChildNodes())for(;this.canvasParent.childNodes.length>=1;)this.canvasParent.removeChild(this.canvasParent.firstChild);this.canvasParent.appendChild(t)},ED.Drawing.prototype.preLoadImagesFrom=function(t){var e=this;for(var r in this.imageArray)this.imageArray[r].onload=function(){e.checkAllLoaded()},this.imageArray[r].onerror=function(){ED.errorHandler("ED.Drawing","preLoadImagesFrom","Error loading image files from directory: "+t)},this.imageArray[r].src=t+r+".gif"},ED.Drawing.prototype.checkAllLoaded=function(){var t=!0;for(var e in this.imageArray){var r=!1;this.imageArray[e].width>0&&(r=!0),t=t&&r}t&&(this.readyNotificationSent||(this.readyNotificationSent=!0,this.notify("ready")))},ED.Drawing.prototype.registerForNotifications=function(t,e,r){e===void 0&&(e="notificationHandler"),r===void 0&&(r=[]),this.notificationArray[this.notificationArray.length]={object:t,methodName:e,notificationList:r}},ED.Drawing.prototype.unRegisterForNotifications=function(t){var e=this.notificationArray.indexOf(t);e>=0&&this.notificationArray.splice(e,1)},ED.Drawing.prototype.notify=function(t,e){for(var r={eventName:t,selectedDoodle:this.selectedDoodle,object:e},a=0;this.notificationArray.length>a;a++){var i=this.notificationArray[a].notificationList,o=this.notificationArray[a].object,s=this.notificationArray[a].methodName;(0==i.length||i.indexOf(t)>=0)&&(o[s]!==void 0?o[s].apply(o,[r]):ED.errorHandler("ED.Drawing","notify","Attempt to call undefined notification handler method"))}},ED.Drawing.prototype.loadDoodles=function(t){var e=document.getElementById(t);if(e&&e.value.length>0){var r=window.JSON.parse(e.value);this.load(r),this.isNew=!1,this.notify("doodlesLoaded")}},ED.Drawing.prototype.load=function(t){for(var e=0;t.length>e;e++){if(void 0===ED[t[e].subclass]){ED.errorHandler("ED.Drawing","load","Unrecognised doodle: "+t[e].subclass);break}this.doodleArray[e]=new ED[t[e].subclass](this,t[e]),this.doodleArray[e].id=e,this.doodleArray[e].scaleX=this.doodleArray[e].scaleX*this.globalScaleFactor,this.doodleArray[e].scaleY=this.doodleArray[e].scaleY*this.globalScaleFactor}this.doodleArray.sort(function(t,e){return t.order-e.order})},ED.Drawing.prototype.save=function(){return"["+this.json()+"]"},ED.Drawing.prototype.json=function(){for(var t="",e=0;this.doodleArray.length>e;e++){var r=this.doodleArray[e];r.isSaveable&&(t=t+r.json()+",")}return t=t.substring(0,t.length-1)},ED.Drawing.prototype.drawAllDoodles=function(){var t=this.context;t.beginPath();for(var e,r=!1,a=0;this.doodleArray.length>a;a++)this.doodleArray[a].isPointInLine&&(r?t.lineTo(this.doodleArray[a].originX,this.doodleArray[a].originY):(t.moveTo(this.doodleArray[a].originX,this.doodleArray[a].originY),r=!0,e=new ED.Point(this.doodleArray[a].originX,this.doodleArray[a].originY)));this.completeLine&&e!==void 0&&t.lineTo(e.x,e.y),r&&(t.lineWidth=4,t.strokeStyle="rgba(20,20,20,1)",t.stroke());for(var a=0;this.doodleArray.length>a;a++)this.context.save(),this.doodleArray[a].draw(),this.context.restore()},ED.Drawing.prototype.mousedown=function(t){this.mouseDown=!0,ED.recentClick&&(this.doubleClick=!0),ED.recentClick=!0,setTimeout("ED.recentClick = false;",this.doubleClickMilliSeconds);var e=!1;this.lastSelectedDoodle=this.selectedDoodle,this.selectedDoodle=null;for(var r=this.doodleArray.length-1;r>-1;r--)e?(this.doodleArray[r].isSelected=!1,this.doodleArray[r].isForDrawing=!1):(this.context.save(),this.doodleArray[r].draw(t)?this.doodleArray[r].isSelectable&&!this.doodleArray[r].isLocked&&(this.doubleClick&&this.doodleArray[r].isSelected&&this.doodleArray[r].isDrawable&&(this.doodleArray[r].isForDrawing=!0),this.doodleArray[r].isSelected=!0,this.selectedDoodle=this.doodleArray[r],e=!0,this.lastSelectedDoodle!=this.selectedDoodle&&(this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.selectedDoodle.onSelection(),this.notify("doodleSelected")),!this.doubleClick&&this.doodleArray[r].isForDrawing&&this.doodleArray[r].addSquiggle()):(this.doodleArray[r].isSelected=!1,this.doodleArray[r].isForDrawing=!1),this.context.restore()),this.doodleArray[r].isBeingDragged=!1;if(this.selectedDoodle||this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.lastSelectedDoodle&&this.lastSelectedDoodle!=this.selectedDoodle&&this.notify("doodleDeselected"),this.newPointOnClick&&!e){var a=this.inverseTransform.transformPoint(t),i=this.addDoodle("PointInLine");i.originX=a.x,i.originY=a.y}this.repaint(),this.notify("mousedown",{drawing:this,point:t})},ED.Drawing.prototype.mousemove=function(t){this.notify("mousemove",{drawing:this,point:t});var e="";this.startHoverTimer(t);var r=this.selectedDoodle;if(this.mouseDown&&null!=r){if(r.isBeingDragged){var a=this.inverseTransform.transformPoint(t),i=this.inverseTransform.transformPoint(this.lastMousePosition),o=r.inverseTransform.transformPoint(t),s=r.inverseTransform.transformPoint(this.lastMousePosition),n=new ED.Point(t.x-this.canvas.width/2,t.y-this.canvas.height/2),l=new ED.Point(this.lastMousePosition.x-this.canvas.width/2,this.lastMousePosition.y-this.canvas.height/2),h=new ED.Point(0,0),d=new ED.Point(0,-100),c=new ED.Point(r.originX,r.originY),p=new ED.Point(r.originX,r.originY-100);switch(this.mode){case ED.Mode.None:break;case ED.Mode.Move:if(r.isMoveable){var D=r.originX,u=r.originY;if(r.snapToGrid){var y=a.x-r.gridDisplacementX,g=Math.floor(y/r.gridSpacing),E=ED.Mod(y,r.gridSpacing);D=r.gridDisplacementX+r.gridSpacing*(g+Math.round(E/r.gridSpacing));var m=a.y-r.gridDisplacementY,f=Math.floor(m/r.gridSpacing),P=ED.Mod(m,r.gridSpacing);u=r.gridDisplacementY+r.gridSpacing*(f+Math.round(P/r.gridSpacing)),r.move(D-r.originX,u-r.originY)}else r.snapToQuadrant?(0!=a.x&&(D=r.quadrantPoint.x*a.x/Math.abs(a.x)),0!=a.y&&(u=r.quadrantPoint.y*a.y/Math.abs(a.y)),r.move(D-r.originX,u-r.originY)):r.snapToPoints?(D=r.nearestPointTo(a).x,u=r.nearestPointTo(a).y,r.move(D-r.originX,u-r.originY)):r.move(a.x-i.x,a.y-i.y);e="move"}else if(r.isRotatable){var w=this.innerAngle(d,h,l),b=this.innerAngle(d,h,n),v=b-w;if(r.snapToAngles)var A=r.nearestAngleTo(b);else var A=ED.Mod(r.rotation+v,2*Math.PI);r.setSimpleParameter("rotation",r.parameterValidationArray.rotation.range.constrainToAngularRange(A,!1)),r.updateDependentParameters("rotation");var M=Math.sqrt(i.x*i.x+i.y*i.y),x=Math.sqrt(a.x*a.x+a.y*a.y),S=r.radius+(x-M);r.setSimpleParameter("radius",r.parameterValidationArray.radius.range.constrain(S)),r.updateDependentParameters("radius")}break;case ED.Mode.Scale:if(r.isScaleable){var C=r.scaleX/Math.abs(r.scaleX),T=r.scaleY/Math.abs(r.scaleY),k=o.x/s.x,I=o.y/s.y;r.isSqueezable||(I=k>I?k:k),k>0&&I>0?(newScaleX=r.scaleX*k,newScaleY=r.scaleY*I,newScaleX=r.parameterValidationArray.scaleX.range.constrain(Math.abs(newScaleX)),newScaleY=r.parameterValidationArray.scaleY.range.constrain(Math.abs(newScaleY)),r.setSimpleParameter("scaleX",newScaleX*C),r.setSimpleParameter("scaleY",newScaleY*T),r.updateDependentParameters("scaleX"),r.updateDependentParameters("scaleY")):this.mode=ED.Mode.None}break;case ED.Mode.Arc:var b=this.innerAngle(p,c,o),w=this.innerAngle(p,c,s),Y=b-w;r.isArcSymmetrical&&(Y=2*Y),rotationCorrection=1,2>r.draggingHandleIndex&&(Y=-Y,rotationCorrection=-1),r.snapToArc?(0>rotationCorrection&&(b=2*Math.PI-ED.positiveAngle(b)),r.setSimpleParameter("arc",r.nearestArcTo(r.arc/2+b))):r.parameterValidationArray.arc.range.isBelow(r.arc+Y)?(Y=r.parameterValidationArray.arc.range.min-r.arc,r.setSimpleParameter("arc",r.parameterValidationArray.arc.range.min),this.mode=ED.Mode.None):r.parameterValidationArray.arc.range.isAbove(r.arc+Y)?(Y=r.parameterValidationArray.arc.range.max-r.arc,r.setSimpleParameter("arc",r.parameterValidationArray.arc.range.max),this.mode=ED.Mode.None):r.setSimpleParameter("arc",r.arc+Y),r.updateDependentParameters("arc"),r.isArcSymmetrical||(rotationCorrection=rotationCorrection*Y/2,r.setSimpleParameter("rotation",r.rotation+rotationCorrection),r.updateDependentParameters("rotation"));break;case ED.Mode.Rotate:if(r.isRotatable){var w=this.innerAngle(p,c,i),b=this.innerAngle(p,c,a),Y=b-w,A=r.rotation+Y;A=ED.positiveAngle(A),r.setSimpleParameter("rotation",r.parameterValidationArray.rotation.range.constrainToAngularRange(A,!1)),r.updateDependentParameters("rotation")}break;case ED.Mode.Apex:var H=r.apexX+(o.x-s.x),R=r.apexY+(o.y-s.y);r.setSimpleParameter("apexX",r.parameterValidationArray.apexX.range.constrain(H)),r.setSimpleParameter("apexY",r.parameterValidationArray.apexY.range.constrain(R)),r.updateDependentParameters("apexX"),r.updateDependentParameters("apexY");break;case ED.Mode.Size:var F=r.width+2*(o.x-s.x),V=r.height-2*(o.y-s.y);r.setSimpleParameter("width",r.parameterValidationArray.width.range.constrain(F)),r.setSimpleParameter("height",r.parameterValidationArray.height.range.constrain(V)),r.updateDependentParameters("width"),r.updateDependentParameters("height");break;case ED.Mode.Handles:var X=r.draggingHandleIndex,W=new ED.Point(0,0);if(W.x=r.squiggleArray[0].pointsArray[X].x+(o.x-s.x),W.y=r.squiggleArray[0].pointsArray[X].y+(o.y-s.y),r.handleCoordinateRangeArray!==void 0&&(W.x=r.handleCoordinateRangeArray[X].x.constrain(W.x),W.y=r.handleCoordinateRangeArray[X].y.constrain(W.y)),r.handleVectorRangeArray!==void 0){var B=r.handleVectorRangeArray[X].length.constrain(W.length()),N=r.handleVectorRangeArray[X].angle.constrainToAngularRange(W.direction(),!1);W.setWithPolars(B,N)}r.squiggleArray[0].pointsArray[X].x=W.x,r.squiggleArray[0].pointsArray[X].y=W.y,r.updateDependentParameters("handles");break;case ED.Mode.Draw:var z=new ED.Point(o.x,o.y);r.addPointToSquiggle(z);break;case ED.Mode.Select:var z=new ED.Point(o.x,o.y);console.log("Selecting ",z.x,z.y);break;default:}}else r.isBeingDragged=!0;this.lastMousePosition=t,this.notify("mousedragged",{point:t,action:e}),this.repaint()}},ED.Drawing.prototype.mouseup=function(t){this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.selectionRectangleIsBeingDragged=!1,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles()),this.selectedDoodle.willStaySelected||(this.selectedDoodle.isSelected=!1,this.selectedDoodle=null)),this.repaint(),this.notify("mouseup",t)},ED.Drawing.prototype.mouseover=function(t){this.isActive=!0,this.notify("mouseover",t)},ED.Drawing.prototype.mouseout=function(t){this.isActive=!1,this.stopHoverTimer(),this.mouseDown=!1,this.mode=ED.Mode.None,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles())),this.notify("mouseout",t)},ED.Drawing.prototype.keydown=function(t){if(null!=this.selectedDoodle){switch(t.keyCode){case 8:"Label"!=this.selectedDoodle.className&&this.deleteSelectedDoodle();break;case 37:this.selectedDoodle.move(-ED.arrowDelta,0);break;case 38:this.selectedDoodle.move(0,-ED.arrowDelta);break;case 39:this.selectedDoodle.move(ED.arrowDelta,0);break;case 40:this.selectedDoodle.move(0,ED.arrowDelta);break;default:}this.repaint(),t.stopPropagation(),t.preventDefault(),this.notify("keydown",t.keyCode)}},ED.Drawing.prototype.startHoverTimer=function(t){if(this.isEditable&&null!=this.canvasTooltip){this.stopHoverTimer();var e=this;this.hoverTimer=setTimeout(function(){e.hover(t)},1e3)}},ED.Drawing.prototype.stopHoverTimer=function(){null!=this.canvasTooltip&&(clearTimeout(this.hoverTimer),this.canvasTooltip.innerHTML="",this.hideTooltip())},ED.Drawing.prototype.hover=function(t){this.showTooltip(t),this.notify("hover",t)},ED.Drawing.prototype.showTooltip=function(t){var e=t.x,r=t.y;if(this.canvas.offsetParent){var a,i=this.canvas;do{var o=document.defaultView.getComputedStyle(i,null).getPropertyValue("position");a=!1,null!=o&&"static"==o&&(a=!0,e+=i.offsetLeft,r+=i.offsetTop);var a=a&&(i=i.offsetParent)}while(a)}this.canvasTooltip.style.left=e+"px",this.canvasTooltip.style.top=r+18+"px";for(var s=!1,n=this.doodleArray.length-1;n>-1;n--)s||(this.context.save(),this.doodleArray[n].draw(t)&&(this.canvasTooltip.innerHTML=this.doodleArray[n].tooltip(),s=!0),this.context.restore());this.canvasTooltip.innerHTML.length>0&&(this.canvasTooltip.style.display="block")},ED.Drawing.prototype.hideTooltip=function(){this.canvasTooltip.style.display="none"},ED.Drawing.prototype.moveToFront=function(){if(null!=this.selectedDoodle){this.selectedDoodle.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToFront")},ED.Drawing.prototype.moveToBack=function(){if(null!=this.selectedDoodle){this.selectedDoodle.order=-1,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToBack")},ED.Drawing.prototype.moveNextTo=function(t,e,r){if(this.hasDoodleOfClass(e)){t.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var a=0;this.doodleArray.length>a;a++)this.doodleArray[a].order=a;for(var i=0,a=0;this.doodleArray.length-1>a;a++)this.doodleArray[a].order=a+i,this.doodleArray[a].className==e&&(i=1,r?t.order=a+1:(t.order=a,this.doodleArray[a].order=a+1));this.doodleArray.sort(function(t,e){return t.order-e.order})}},ED.Drawing.prototype.flipVer=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleY=-1*this.selectedDoodle.scaleY,this.repaint()),this.notify("flipVer")},ED.Drawing.prototype.flipHor=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleX=-1*this.selectedDoodle.scaleX,this.repaint()),this.notify("flipHor")},ED.Drawing.prototype.deleteDoodle=function(t){var e=!1,r="Attempt to delete a doodle that does not exist";if(t.willDelete()){for(var a=0;this.doodleArray.length>a;a++)if(this.doodleArray[a].id==t.id)if(this.doodleArray[a].isDeletable){e=t.className,null!=this.selectedDoodle&&this.selectedDoodle.id==t.id&&(this.selectedDoodle.onDeselection(),this.selectedDoodle=null);for(var i in t.bindingArray){var o=t.bindingArray[i].id,s=t.bindingArray[i].attribute,n=document.getElementById(o),l=this.boundElementDeleteValueArray[o];if(null!=n&&l!==void 0)switch(n.type){case"checkbox":s?ED.errorHandler("ED.Drawing","deleteDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==l?n.setAttribute("checked","checked"):n.removeAttribute("checked");break;case"select-one":if(s){for(var h=0;n.length>h;h++)if(n.options[h].getAttribute(s)==l){n.value=n.options[h].value;break}}else n.value=l;break;default:s?n.setAttribute(s,l):n.value=l}t.removeBinding(i)}this.doodleArray.splice(a,1)}else r="Attempt to delete a doodle that is not deletable, className: "+t.className}else r="Doodle refused permission to be deleted, className: "+t.className;if(e){for(var a=0;this.doodleArray.length>a;a++)this.doodleArray[a].order=a;this.repaint(),this.notify("doodleDeleted",e)}else ED.errorHandler("ED.Drawing","deleteDoodle",r)},ED.Drawing.prototype.deleteSelectedDoodle=function(){null!=this.selectedDoodle?this.deleteDoodle(this.selectedDoodle):ED.errorHandler("ED.Drawing","deleteSelectedDoodle","Attempt to delete selected doodle, when none selected")},ED.Drawing.prototype.resetEyedraw=function(){this.deleteAllDoodles(),this.deselectDoodles(),this.drawAllDoodles()},ED.Drawing.prototype.setSelectedDoodle=function(t,e){var r=t.checked?"true":"false";null!=this.selectedDoodle?this.selectedDoodle.setParameterFromString(e,r):ED.errorHandler("ED.Drawing","setSelectedDoodle","Attempt to set a property on the selected doodle, when none selected")},ED.Drawing.prototype.deleteDoodleOfId=function(t){var e=this.doodleOfId(t);e?this.deleteDoodle(e):ED.errorHandler("ED.Drawing","deleteDoodleOfId","Attempt to delete doodle with invalid id")},ED.Drawing.prototype.lock=function(){if(null!=this.selectedDoodle){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isSelected&&(this.doodleArray[t].isLocked=!0,this.doodleArray[t].isSelected=!1,this.selectedDoodle=null);this.repaint()}},ED.Drawing.prototype.unlock=function(){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isLocked=!1;this.repaint()},ED.Drawing.prototype.deselectDoodles=function(){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].isSelected=!1;this.selectedDoodle&&this.selectedDoodle.onDeselection(),this.selectedDoodle=null,this.repaint()},ED.Drawing.prototype.selectNextDoodle=function(t){this.scrollValue+=t;var e=t>0?!0:!1,r=96;if(this.scrollValue>r||-r>this.scrollValue){this.scrollValue=0;for(var a=-1,i=0;this.doodleArray.length>i;i++)this.doodleArray[i].isSelected&&(a=i,this.doodleArray[i].isSelected=!1);a>=0&&(e?(a++,a==this.doodleArray.length&&(a=0)):(a--,0>a&&(a=this.doodleArray.length-1)),a==this.doodleArray.length,this.doodleArray[a].isSelected=!0,this.selectedDoodle=this.doodleArray[a]),this.repaint()}},ED.Drawing.prototype.isReady=function(){this.modified=!1,this.convertToImage&&this.replaceWithImage()},ED.Drawing.prototype.addDoodle=function(t,e,r){var a=this.hasDoodleOfClass(t);if(!ED.hasOwnProperty(t))return ED.errorHandler("ED.Drawing","addDoodle","Unable to find definition for subclass "+t),null;var i=new ED[t](this);if(i.isUnique&&this.hasDoodleOfClass(t))return ED.errorHandler("ED.Drawing","addDoodle","Attempt to add a second unique doodle of class "+t),null;for(var o=0;this.doodleArray.length>o;o++)this.doodleArray[o].isSelected&&this.doodleArray[o].onDeselection(),this.doodleArray[o].isSelected=!1;if(e!==void 0)for(var s in e){var n=i.validateParameter(s,e[s]);n.valid?i.setParameterFromString(s,n.value):ED.errorHandler("ED.Drawing","addDoodle","ParameterDefaults array contains an invalid value for parameter "+s)}if(this.selectedDoodle=i,i.scaleX=i.scaleX*this.globalScaleFactor,i.scaleY=i.scaleY*this.globalScaleFactor,i.isDrawable&&(i.isForDrawing=!0),this.doodleArray[this.doodleArray.length]=i,!a)for(var l in this.bindingArray[t]){var h,d=this.bindingArray[t][l].id,c=this.bindingArray[t][l].attribute,p=document.getElementById(d);switch(p.type){case"checkbox":c?ED.errorHandler("ED.Drawing","addDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):h=""+p.checked;break;case"select-one":c?p.selectedIndex>-1&&(h=p.options[p.selectedIndex].getAttribute(c)):h=p.value;break;default:h=c?p.getAttribute(c):p.value}h==this.boundElementDeleteValueArray[d]&&(h=i[l]);var D=i.validateParameter(l,h);D.valid?(i.setParameterFromString(l,D.value),i.updateDependentParameters(l)):(h=i[l],ED.errorHandler("ED.Drawing","addDoodle","Invalid value for parameter: "+l)),i.addBinding(l,this.bindingArray[t][l]),i.setParameterFromString(l,D.value),i.updateDependentParameters(l),this.updateBindings(i)}if(r!==void 0)for(var s in r)i.addBinding(s,r[s]);return i.addAtBack?this.moveToBack():this.repaint(),this.selectedDoodle.onSelection(),this.notify("doodleAdded",i),i},ED.Drawing.prototype.addBindings=function(t){this.bindingArray=t;var e=this;for(var r in t){var a=this.firstDoodleOfClass(r);for(var i in t[r]){var o=t[r][i].id,s=document.getElementById(o);s?(s.addEventListener("change",function(){for(var r in e.bindingArray)for(var a in e.bindingArray[r])this.id==t[r][a].id&&(e.hasDoodleOfClass(r)||(e.addDoodle(r),e.deselectDoodles()))},!1),a&&a.addBinding(i,t[r][i])):ED.errorHandler("ED.Drawing","addBindings","Attempt to add binding for an element that does not exist for parameter: "+i)}}},ED.Drawing.prototype.addDeleteValues=function(t){for(elementId in t)this.boundElementDeleteValueArray[elementId]=t[elementId]},ED.Drawing.prototype.eventHandler=function(t,e,r,a,i){switch(t){case"onchange":var o=this.doodleOfId(e);if(o)if(this.boundElementDeleteValueArray[a]==i)this.deleteDoodleOfId(e);else{o.drawing.isActive=!0;var s;for(var n in o.bindingArray)o.bindingArray[n].id==a&&(s=n);var l=o.validateParameter(s,i);if(l.valid?o.setParameterWithAnimation(s,l.value):ED.errorHandler("ED.Drawing","eventHandler","Attempt to change HTML element value to an invalid value for parameter "+s),i!=l.value){var h=document.getElementById(a),d=o.bindingArray[s].attribute;switch(h.type){case"checkbox":d?ED.errorHandler("ED.Drawing","eventHandler","Binding to a checkbox with a non-standard attribute not yet supported"):(console.log("setting checkbox - needs testing with a suitable doodle"),"true"==value?h.setAttribute("checked","checked"):h.removeAttribute("checked"));break;case"select-one":if(d){for(var c=0;h.length>c;c++)if(h.options[c].getAttribute(d)==l.value){h.value=h.options[c].value;break}}else h.value=l.value;break;case"text":d?ED.errorHandler("ED.Drawing","eventHandler","Binding to a textfield with a non-standard attribute not yet supported"):(console.log("setting textfield - needs testing with a suitable doodle"),h.value=l.value);break;default:d?h.setAttribute(d,l.value):h.value=l.value}}}else ED.errorHandler("ED.Drawing","eventHandler","Doodle of id: "+e+" no longer exists");break;default:}},ED.isNumeric=function(t){return t-0==t&&t.length>0},ED.Drawing.prototype.updateBindings=function(t){var e=t;if(e===void 0&&(e=this.selectedDoodle),null!=e)for(var r in e.bindingArray){var a=document.getElementById(e.bindingArray[r].id),i=e.bindingArray[r].attribute,o=e.getParameter(r);switch(a.type){case"checkbox":i?ED.errorHandler("ED.Drawing","updateBindings","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==o?a.setAttribute("checked","checked"):a.removeAttribute("checked");break;case"select-one":if(i){for(var s=0;a.length>s;s++)if(a.options[s].getAttribute(i)==o){a.value=a.options[s].value;break}}else a.value=o;break;case"text":i?ED.errorHandler("ED.Drawing","updateBindings","Binding to a textfield with a non-standard attribute not yet supported"):a.value=o;break;default:i?a.setAttribute(i,o):a.value=o}}},ED.Drawing.prototype.hasDoodleOfClass=function(t){for(var e=!1,r=0;this.doodleArray.length>r;r++)this.doodleArray[r].className==t&&(e=!0);return e},ED.Drawing.prototype.numberOfDoodlesOfClass=function(t){for(var e=0,r=0;this.doodleArray.length>r;r++)this.doodleArray[r].className==t&&e++;return e},ED.Drawing.prototype.firstDoodleOfClass=function(t){for(var e=!1,r=0;this.doodleArray.length>r;r++)if(this.doodleArray[r].className==t){e=this.doodleArray[r];break}return e},ED.Drawing.prototype.lastDoodleOfClass=function(t){for(var e=!1,r=this.doodleArray.length-1;r>=0;r--)if(this.doodleArray[r].className==t){e=this.doodleArray[r];break}return e},ED.Drawing.prototype.allDoodlesOfClass=function(t){for(var e=[],r=this.doodleArray.length-1;r>=0;r--)this.doodleArray[r].className==t&&e.push(this.doodleArray[r]);return e},ED.Drawing.prototype.setParameterValueForClass=function(t,e,r){for(var a=this.doodleArray.length-1;a>=0;a--)if(this.doodleArray[a].className==r){var i=this.doodleArray[a];i.setParameterWithAnimation(t,e)}this.repaint()},ED.Drawing.prototype.doodleOfId=function(t){for(var e=!1,r=0;this.doodleArray.length>r;r++)if(this.doodleArray[r].id==t){e=this.doodleArray[r];break}return e},ED.Drawing.prototype.deleteAllDoodles=function(){for(var t=this.doodleArray.length-1;t>=0;t--)this.doodleArray[t].isDeletable&&this.deleteDoodle(this.doodleArray[t])},ED.Drawing.prototype.deleteDoodlesOfClass=function(t){for(var e=this.doodleArray.length-1;e>=0;e--)this.doodleArray[e].className==t&&this.deleteDoodle(this.doodleArray[e])},ED.Drawing.prototype.setParameterForDoodle=function(t,e,r){t[e]!==void 0?t[e]=+r:t.setParameterFromString(e,r),this.saveToInputElement!==void 0&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.setParameterForDoodleOfClass=function(t,e,r){var a=this.firstDoodleOfClass(t);a.setParameterWithAnimation(e,r),this.saveToInputElement!==void 0&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.totalDegreesExtent=function(t){for(var e=0,r=0;this.doodleArray.length>r;r++)this.doodleArray[r].className==t&&(e+=this.doodleArray[r].degreesExtent());return e>360&&(e=360),e},ED.Drawing.prototype.suppressReports=function(){for(var t=0;this.doodleArray.length>t;t++)this.doodleArray[t].willReport=!1},ED.Drawing.prototype.report=function(){for(var t="",e=[],r=[],a=0;this.doodleArray.length>a;a++){var i=this.doodleArray[a];if(i.willReport)if(i.groupDescription().length>0)e[i.className]===void 0?(e[i.className]=i.groupDescription(),e[i.className]+=i.description()):i.description().length>0&&(e[i.className]+=", ",e[i.className]+=i.description()),i.groupDescriptionEnd().length>0&&r[i.className]===void 0&&(r[i.className]=i.groupDescriptionEnd());else{var o=i.description();o.length>0&&(0==t.length?t+=o:t=t+", "+o.firstLetterToLowerCase())}}for(className in e){var o=e[className],s="";r[className]!==void 0&&(s=r[className]),o=o.addAndAfterLastComma()+s,o.length>0&&(0==t.length?t+=o:t=t+", "+o.firstLetterToLowerCase())}return t},ED.Drawing.prototype.diagnosis=function(){for(var t=0,e=[],r=0;this.doodleArray.length>r;r++){var a=this.doodleArray[r],i=a.snomedCode();
if(i>0){var o=a.diagnosticHierarchy();o>t?(t=o,e.push(i)):o==t&&0>e.indexOf(i)&&e.push(i)}}return e},ED.Drawing.prototype.setEye=function(t){"Right"==t&&(this.eye=ED.eye.Right),"Left"==t&&(this.eye=ED.eye.Left),this.repaint()},ED.Drawing.prototype.clear=function(){this.canvas.width=this.canvas.width,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.canvas.width/2,this.canvas.height/2),this.context.scale(this.scale,this.scale)},ED.Drawing.prototype.repaint=function(){if(this.clear(),this.image!==void 0)if(this.image.width>=this.image.height){var t=1e3*this.image.height/this.image.width;this.context.drawImage(this.image,-500,-t/2,1e3,t)}else{var e=1e3*this.image.width/this.image.height;this.context.drawImage(this.image,-e/2,-500,e,1e3)}this.drawAllDoodles();for(var r=0;this.doodleArray.length>r;r++)this.doodleArray[r].setDisplayOfParameterControls(!1);if(null!=this.selectedDoodle&&this.selectedDoodle.setDisplayOfParameterControls(!0),null!=this.selectedDoodle?(null!==this.moveToFrontButton&&(this.moveToFrontButton.disabled=!1),null!==this.moveToBackButton&&(this.moveToBackButton.disabled=!1),null!==this.flipVerButton&&(this.flipVerButton.disabled=!1),null!==this.flipHorButton&&(this.flipHorButton.disabled=!1),null!==this.deleteSelectedDoodleButton&&this.selectedDoodle.isDeletable&&(this.deleteSelectedDoodleButton.disabled=!1),null!==this.lockButton&&(this.lockButton.disabled=!1)):(null!==this.moveToFrontButton&&(this.moveToFrontButton.disabled=!0),null!==this.moveToBackButton&&(this.moveToBackButton.disabled=!0),null!==this.flipVerButton&&(this.flipVerButton.disabled=!0),null!==this.flipHorButton&&(this.flipHorButton.disabled=!0),null!==this.deleteSelectedDoodleButton&&(this.deleteSelectedDoodleButton.disabled=!0),null!==this.lockButton&&(this.lockButton.disabled=!0)),null!=this.unlockButton){this.unlockButton.disabled=!0;for(var r=0;this.doodleArray.length>r;r++)if(this.doodleArray[r].isLocked){this.unlockButton.disabled=!1;break}}var a=document.getElementById(this.canvas.id+"doodleToolbar");if(a){for(var i=a.getElementsByTagName("button"),r=0;i.length>r;r++)i[r].disabled=!1;for(var r=0;this.doodleArray.length>r;r++){var o=document.getElementById(this.doodleArray[r].className+this.idSuffix);o&&(o.disabled=this.doodleArray[r].isUnique)}}if(this.modified||(this.modified=!0),this.selectionRectangleIsBeingDragged){var s=this.context;s.beginPath(),s.moveTo(this.selectionRectangleStart.x,this.selectionRectangleStart.y),s.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleStart.y),s.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleEnd.y),s.lineTo(this.selectionRectangleStart.x,this.selectionRectangleEnd.y),s.closePath(),s.lineWidth=1,s.strokeStyle="gray",s.stroke()}this.notify("drawingRepainted")},ED.Drawing.prototype.innerAngle=function(t,e,r){var a=new ED.Point(t.x-e.x,t.y-e.y),i=new ED.Point(r.x-e.x,r.y-e.y);return a.clockwiseAngleTo(i)},ED.Drawing.prototype.togglePointInLine=function(){this.newPointOnClick?(this.newPointOnClick=!1,this.completeLine=!0,this.deselectDoodles(),this.repaint()):(this.newPointOnClick=!0,this.completeLine=!1)},ED.Drawing.prototype.nextDoodleId=function(){return this.lastDoodleId++},ED.Report=function(t){this.drawing=t,this.breaksInAttached=0,this.breaksInDetached=0,this.largestBreakType="Not found",this.largestBreakSize=0,this.lowestBreakPosition=12,this.pvrType="None",this.pvrCClockHours=0,this.antPvrClockHours=0;var e=0,r=0,a=180,i=[];i.UTear="U tear",i.RoundHole="Round hole",i.Dialysis="Dialysis",i.GRT="GRT",i.MacularHole="Macular hole",i.OuterLeafBreak="Outer Leaf Break",this.rrdArray=[];var o,s;for(o=0;this.drawing.doodleArray.length>o;o++)s=this.drawing.doodleArray[o],"RRD"==s.className&&this.rrdArray.push(s);for(o=0;this.drawing.doodleArray.length>o;o++)if(s=this.drawing.doodleArray[o],"StarFold"==s.className)this.pvrType="C",e+=180*s.arc/Math.PI;else if("AntPVR"==s.className)this.pvrType="C",r+=180*s.arc/Math.PI;else if(s.className in i){var n=0;n="UTear"==s.className||"RoundHole"==s.className||"OuterLeafBreak"==s.className?(Math.round(180*Math.atan2(s.originX,-s.originY)/Math.PI)+360)%360:Math.round(180*s.rotation/Math.PI+360)%360;var l=this.inDetachment(n);l?this.breaksInDetached++:this.breaksInAttached++,l&&s.arc>this.largestBreakSize&&(this.largestBreakSize=s.arc,this.largestBreakType=i[s.className]);var h=Math.abs(n-180);if(l&&a>h){a=h;var d=n+15;c=d%30,this.lowestBreakPosition=Math.floor((d-c)/30),0==this.lowestBreakPosition&&(this.lowestBreakPosition=12)}}e+=25;var c=e%30;this.pvrCClockHours=Math.floor((e-c)/30),r+=25,c=r%30,this.antPvrClockHours=Math.floor((r-c)/30);var p=180*this.largestBreakSize/Math.PI+25,c=p%30;this.largestBreakSize=Math.floor((p-c)/30)},ED.Report.prototype.inDetachment=function(t){var e=!1;for(key in this.rrdArray){var r=this.rrdArray[key],a=180*(r.rotation-r.arc/2)/Math.PI,i=180*(r.rotation+r.arc/2)/Math.PI,a=(a+360)%360,i=(i+360)%360;if(a>i)(t>=0&&i>=t||t>=a&&360>=t)&&(e=!0);else{if(i==a)return!0;t>=a&&i>=t&&(e=!0)}}return e},ED.Report.prototype.extent=function(){var t=[];this.drawing.eye==ED.eye.Right?(t.SN=0,t.IN=0,t.IT=0,t.ST=0):(t.ST=0,t.IT=0,t.IN=0,t.SN=0);var e=15;for(quadrant in t)for(var r=0;3>r;r++){var a=this.inDetachment(e)?1:0;t[quadrant]=t[quadrant]+a,e+=30}return t},ED.Report.prototype.isMacOff=function(){var t=!1;for(key in this.rrdArray){var e=this.rrdArray[key];e.isMacOff()&&(t=!0)}return t},ED.Doodle=function(t,e){if(t!==void 0){this.drawing=t,this.id=this.drawing.nextDoodleId(),this.squiggleArray=[],this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.isLocked=!1,this.isSelectable=!0,this.isShowHighlight=!0,this.willStaySelected=!0,this.isDeletable=!0,this.isSaveable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!0,this.isDrawable=!1,this.isUnique=!1,this.isArcSymmetrical=!1,this.addAtBack=!1,this.isPointInLine=!1,this.snapToGrid=!1,this.snapToQuadrant=!1,this.snapToPoints=!1,this.snapToAngles=!1,this.snapToArc=!1,this.willReport=!0,this.willSync=!0;var r=Math.round(this.drawing.doodlePlaneWidth/2),a=Math.round(this.drawing.doodlePlaneHeight/2);this.parameterValidationArray={originX:{kind:"simple",type:"int",range:new ED.Range(-r,+r),defaultValue:0,delta:15},originY:{kind:"simple",type:"int",range:new ED.Range(-a,+a),defaultValue:0,delta:15},width:{kind:"simple",type:"int",range:new ED.Range(100,+a),defaultValue:50,delta:15},height:{kind:"simple",type:"int",range:new ED.Range(100,+r),defaultValue:50,delta:15},radius:{kind:"simple",type:"float",range:new ED.Range(100,450),precision:6,defaultValue:100,delta:15},apexX:{kind:"simple",type:"int",defaultValue:0,range:new ED.Range(-500,500),delta:15},apexY:{kind:"simple",type:"int",range:new ED.Range(-500,500),defaultValue:0,delta:15},scaleX:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},scaleY:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},arc:{kind:"simple",type:"float",range:new ED.Range(Math.PI/12,2*Math.PI),precision:6,defaultValue:Math.PI,delta:.1},rotation:{kind:"simple",type:"float",range:new ED.Range(0,2*Math.PI),precision:6,defaultValue:0,delta:.2}},this.savedParameterArray||(this.savedParameterArray=[]),this.controlParameterArray||(this.controlParameterArray=[]),this.parameterObjectTypeArray||(this.parameterObjectTypeArray=[]),this.gridSpacing=200,this.gridDisplacementX=0,this.gridDisplacementY=0,this.isBeingDragged=!1,this.draggingHandleIndex=null,this.draggingHandleRing=null,this.isClicked=!1,this.drawFunctionMode=ED.drawFunctionMode.Draw,this.isFilled=!0,this.derivedParametersArray=[],this.animationFrameRate=30,this.animationDataArray=[],this.parentClass="",this.inFrontOfClassArray=[],this.pointsArray=[],this.anglesArray=[],this.arcArray=[],this.quadrantPoint=new ED.Point(200,200),this.bindingArray=[],this.drawing.listenerArray[this.id]=[],this.handleArray=[],this.handleArray[0]=new ED.Handle(new ED.Point(-50,50),!1,ED.Mode.Scale,!1),this.handleArray[1]=new ED.Handle(new ED.Point(-50,-50),!1,ED.Mode.Scale,!1),this.handleArray[2]=new ED.Handle(new ED.Point(50,-50),!1,ED.Mode.Scale,!1),this.handleArray[3]=new ED.Handle(new ED.Point(50,50),!1,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(new ED.Point(this.apexX,this.apexY),!1,ED.Mode.Apex,!1),this.setHandles(),this.leftExtremity=new ED.Point(-100,-100),this.rightExtremity=new ED.Point(0,-100),this.version=1.1,this.setPropertyDefaults();for(var i in this.parameterValidationArray){var o=this.parameterValidationArray[i];"simple"==o.kind&&(this[i]=o.defaultValue)}if(e===void 0)this.order=this.drawing.doodleArray.length,this.setParameterDefaults(),this.isSelected=!0;else{for(var s in e)if("arc"==s||"rotation"==s)this[s]=e[s]*Math.PI/180;else if("squiggleArray"==s)for(var n=e[s],l=0;n.length>l;l++){for(var h=n[l].colour,d=new ED.Colour(h.red,h.green,h.blue,h.alpha),c=n[l].thickness,p=n[l].filled,D=new ED.Squiggle(this,d,c,p),u=n[l].pointsArray,y=0;u.length>y;y++){var g=new ED.Point(u[y].x,u[y].y);D.addPoint(g)}D.complete=!0,this.squiggleArray.push(D)}else if("params"==s)for(var l=0;e[s].length>l;l++){var E=e[s][l].name,m=e[s][l].value;this.setParameterFromString(E,m)}else this[s]=s in this.parameterObjectTypeArray?this.parseObjectString(e[s],this.parameterObjectTypeArray[s]):e[s];this.isOrientated&&(this.rotation=this.orientation()),this.order=+e.order;for(var s in this.savedParameterArray)this.updateDependentParameters(this.savedParameterArray[s]);this.isSelected=!1,this.isForDrawing=!1}}},ED.Doodle.prototype.parseObjectString=function(t,e){var r=!1;switch(e){case"date":var a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(t);r=new Date(Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6]));break;default:ED.errorHandler("ED.Doodle","parseObjectString","Object type: "+e+" currently not supported")}return r},ED.Doodle.prototype.setHandles=function(){},ED.Doodle.prototype.setPropertyDefaults=function(){},ED.Doodle.prototype.setParameterDefaults=function(){},ED.Doodle.prototype.position=function(){},ED.Doodle.prototype.willDelete=function(){return!0},ED.Doodle.prototype.move=function(t,e){var r=Math.round(+t),a=Math.round(+e);if(this.isMoveable){var i=this.parameterValidationArray.originX.range.constrain(this.originX+r),o=this.parameterValidationArray.originY.range.constrain(this.originY+a);0!=r&&this.setSimpleParameter("originX",i),0!=a&&this.setSimpleParameter("originY",o),this.updateDependentParameters("originX"),this.updateDependentParameters("originY"),(0!=r||0!=a)&&this.isOrientated&&(this.setSimpleParameter("rotation",this.orientation()),this.updateDependentParameters("rotation")),this.drawing.notify("doodleMoved",{doodle:this})}},ED.Doodle.prototype.orientation=function(){var t=new ED.Point(0,0),e=new ED.Point(0,-100),r=new ED.Point(this.originX,this.originY);return this.drawing.innerAngle(e,t,r)},ED.Doodle.prototype.draw=function(t){this.drawFunctionMode=t!==void 0?ED.drawFunctionMode.HitTest:ED.drawFunctionMode.Draw;var e=this.drawing.context;e.translate(this.originX,this.originY),e.rotate(this.rotation),e.scale(this.scaleX,this.scaleY),this.transform.setToTransform(this.drawing.transform),this.transform.translate(this.originX,this.originY),this.transform.rotate(this.rotation),this.transform.scale(this.scaleX,this.scaleY),this.inverseTransform=this.transform.createInverse(),this.isClicked=!1},ED.Doodle.prototype.drawHandles=function(t){this.drawFunctionMode==ED.drawFunctionMode.HitTest&&(this.draggingHandleIndex=null,this.draggingHandleRing=null);var e=this.drawing.context;e.save(),e.setTransform(1,0,0,1,0,0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="yellow";for(var r=2*Math.PI,a=0;this.handleArray.length>a;a++){var i=this.handleArray[a];i.isVisible&&(e.beginPath(),e.arc(i.location.x,i.location.y,ED.handleRadius/2,0,r,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=a,this.draggingHandleRing=ED.handleRing.Inner,this.drawing.mode=i.mode,this.isClicked=!0),this.isRotatable&&i.isRotatable&&(e.moveTo(i.location.x+ED.handleRadius,i.location.y),e.arc(i.location.x,i.location.y,ED.handleRadius,0,r,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=a,null==this.draggingHandleRing&&(this.draggingHandleRing=ED.handleRing.Outer,this.drawing.mode=ED.Mode.Rotate),this.isClicked=!0)),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fill(),e.stroke()))}e.restore()},ED.Doodle.prototype.drawBoundary=function(t){var e=this.drawing.context;if(this.drawFunctionMode==ED.drawFunctionMode.HitTest){if(ED.isFirefox()){e.save(),e.setTransform(1,0,0,1,0,0);var r=e.isPointInPath(t.x,t.y);e.restore()}else var r=e.isPointInPath(t.x,t.y);r&&(this.drawing.mode=this.isDrawable&&this.isForDrawing?ED.Mode.Draw:ED.Mode.Move,this.isClicked=!0)}else this.isSelected&&this.isShowHighlight&&(e.shadowColor="gray",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=20),this.isForDrawing&&(e.shadowColor="blue",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=20),this.isFilled&&e.fill(),e.stroke(),e.shadowBlur=0,this.isSelected&&this.isShowHighlight&&this.drawHighlightExtras()},ED.Doodle.prototype.drawHighlightExtras=function(){},ED.Doodle.prototype.setDisplayOfParameterControls=function(t){for(var e in this.parameterValidationArray){var r=this.parameterValidationArray[e];if(r.display){var a=e+this.className+this.drawing.idSuffix,i=document.getElementById(a);if(i){var o=i.parentNode;o.style.display=t?"inline":"none",i.checked=this[e]}}}},ED.Doodle.prototype.groupDescription=function(){return""},ED.Doodle.prototype.description=function(){return""},ED.Doodle.prototype.groupDescriptionEnd=function(){return""},ED.Doodle.prototype.tooltip=function(){var t=ED.trans[this.className];return t!==void 0?t:""},ED.Doodle.prototype.snomedCode=function(){return 0},ED.Doodle.prototype.diagnosticHierarchy=function(){return 0},ED.Doodle.prototype.dependentParameterValues=function(){return[]},ED.Doodle.prototype.updateDependentParameters=function(t){var e=this.dependentParameterValues(t,this[t]);for(var r in e)this.setSimpleParameter(r,e[r]);this.drawing.updateBindings(this)},ED.Doodle.prototype.validateParameter=function(t,e){var r=this.parameterValidationArray[t],a="";if(r){var i=!1;switch(a=(""+e).trim(),r.type){case"string":r.list.indexOf(a)>=0&&(i=!0);break;case"float":ED.isNumeric(a)&&(a=parseFloat(a),a=r.range.constrain(a),a=a.toFixed(r.precision),i=!0);break;case"int":ED.isNumeric(a)&&(a=parseInt(a),a=r.range.constrain(a),a=a.toFixed(0),i=!0);break;case"mod":ED.isNumeric(a)&&(a=parseInt(a),a=r.range.constrain(a),"top"==r.clock?a==r.range.min&&(a=r.range.max):"bottom"==r.clock&&a==r.range.max&&(a=r.range.min),a=a.toFixed(0),i=!0);break;case"bool":("true"==e||"false"==e)&&(a=e,i=!0);break;case"colourString":i=!0;break;case"freeText":i=!0;break;default:ED.errorHandler("ED.Drawing","eventHandler","Illegal validation type")}}else ED.errorHandler("ED.Doodle","validateParameter","Unknown parameter name");i||(a=this.getParameter(t),ED.errorHandler("ED.Doodle","validateParameter","Validation failure for parameter: "+t+" with value: "+e));var o=[];return o.valid=i,o.value=a,o},ED.Doodle.prototype.parameterControlElementId=function(t){return this.drawing.canvas.id+"_"+t+"_control"},ED.Doodle.prototype.onSelection=function(){if(this.drawing.showDoodleControls){var t=document.getElementById(this.drawing.canvas.id+"_"+"controls");for(var e in this.controlParameterArray){var r=this.parameterElement(e);t.appendChild(r),this.addBinding(e,{id:this.parameterControlElementId(e)})}}},ED.Doodle.prototype.onDeselection=function(){if(this.drawing.showDoodleControls){for(var t in this.controlParameterArray)this.removeBinding(t);for(var e=document.getElementById(this.drawing.canvas.id+"_"+"controls");e.hasChildNodes();)e.removeChild(e.lastChild)}},ED.Doodle.prototype.parameterElement=function(t){var e;switch(this.parameterValidationArray[t].type){case"string":e=document.createElement("select"),e.setAttribute("id",this.parameterControlElementId(t));for(var r in this.parameterValidationArray[t].list){var a=document.createElement("option");a.innerText=this.parameterValidationArray[t].list[r],e.appendChild(a)}break;case"bool":e=document.createElement("input"),e.type="checkbox",e.setAttribute("id",this.parameterControlElementId(t));break;case"colourString":e=document.createElement("select"),e.setAttribute("id",this.parameterControlElementId(t));for(var r in this.parameterValidationArray[t].list){var a=document.createElement("option");a.innerText="FF0000FF"==this.parameterValidationArray[t].list[r]?"Red":"00FF00FF"==this.parameterValidationArray[t].list[r]?"Green":"Blue",a.value=this.parameterValidationArray[t].list[r],e.appendChild(a)}break;case"freeText":e=document.createElement("input"),e.type="text",e.setAttribute("id",this.parameterControlElementId(t));break;default:ED.errorHandler("ED.Doodle","parameterElement","Unexpected type: "+this.parameterValidationArray[t].type+" for parameter: "+t)}var i=document.createElement("label");i.innerText=this.controlParameterArray[t];var o=document.createElement("div");return o.appendChild(i),o.appendChild(e),o},ED.Doodle.prototype.setParameterWithAnimation=function(t,e){if(this.parameterValidationArray[t].animate){var r=this.dependentParameterValues(t,e);for(var a in r){var i=this.parameterValidationArray[a].delta,o=r[a]-this[a];if("rotation"==a){var s=0>(Math.PI-Math.abs(o))*o?-1:1;o*=s,0>o&&(o+=2*Math.PI),o>3.141&&this.rotation<Math.PI&&(s=-s)}else var s=0>o?-1:1;i*=s;var n=Math.abs(Math.floor(o/i)),l={timer:null,delta:i,frames:n,frameCounter:0};this.animationDataArray[a]=l,n>0?this.increment(a,r[a]):(this.setSimpleParameter(a,r[a]),this.updateDependentParameters(a),this.drawing.repaint())}}else this.setParameterFromString(t,""+e)},ED.Doodle.prototype.setSimpleParameter=function(t,e){var r={};r.doodle=this,r.parameter=t,r.value=e,r.oldValue=this[t],this[t]=e,this.drawing.notify("parameterChanged",r)},ED.Doodle.prototype.setParameterFromString=function(t,e){var r=typeof e;"string"!=r&&ED.errorHandler("ED.Doodle","setParameterFromString","_value parameter should be of type string, not "+r);var a=this.parameterValidationArray[t];if(a){switch(a.type){case"string":this[t]=e;break;case"float":this[t]=parseFloat(e);break;case"int":this[t]=parseInt(e);break;case"mod":this[t]=parseInt(e);break;case"bool":this[t]="true"==e;break;case"colourString":this[t]=e;break;case"freeText":this[t]=e;break;default:ED.errorHandler("ED.Doodle","setParameterFromString","Illegal validation type: "+a.type)}if(this.updateDependentParameters(t),"derived"==this.parameterValidationArray[t].kind){var i=this.dependentParameterValues(t,e);for(var o in i)this.updateDependentParameters(o)}var s={};s.doodle=this,s.parameter=t,s.value=e,s.oldValue=this[t],this.drawing.notify("parameterChanged",s)}else ED.errorHandler("ED.Doodle","setParameterFromString","No item in parameterValidationArray corresponding to parameter: "+t);this.drawing.repaint()},ED.Doodle.prototype.setOriginWithDisplacements=function(t,e){if(this.originX=this.drawing.eye==ED.eye.Right?-t:t,this.originY=-t,this.addAtBack)var r=this.drawing.firstDoodleOfClass(this.className);else var r=this.drawing.lastDoodleOfClass(this.className);if(r){var a=r.originX-e,i=r.originY-e;this.originX=this.parameterValidationArray.originX.range.constrain(a),this.originY=this.parameterValidationArray.originY.range.constrain(i)}},ED.Doodle.prototype.setOriginWithRotations=function(t,e,r){var a=this.drawing.eye==ED.eye.Right?-1:1,i=new ED.Point(0,0);if(i.setWithPolars(t,a*e*Math.PI/180),this.addAtBack)var o=this.drawing.firstDoodleOfClass(this.className);else var o=this.drawing.lastDoodleOfClass(this.className);if(o){var s=new ED.Point(o.originX,o.originY);i.setWithPolars(t,s.direction()+a*r*Math.PI/180)}this.originX=i.x,this.originY=i.y},ED.Doodle.prototype.setRotationWithDisplacements=function(t,e){var r,a=this.drawing.eye==ED.eye.Right?-1:1;if(this.addAtBack)var i=this.drawing.firstDoodleOfClass(this.className);else var i=this.drawing.lastDoodleOfClass(this.className);r=i?(180*i.rotation/Math.PI+a*e+360)%360*Math.PI/180:(a*t+360)%360*Math.PI/180,this.rotation=this.parameterValidationArray.rotation.range.constrain(r)},ED.Doodle.prototype.deselect=function(){this.isSelected=!1,this.drawing.selectedDoodle=null,this.drawing.repaint()},ED.Doodle.prototype.getParameter=function(t){var e=this.parameterValidationArray[t],r="";if(e)switch(e.type){case"string":r=this[t];break;case"float":r=this[t].toFixed(e.precision);break;case"int":r=this[t].toFixed(0);break;case"mod":r=Math.round(this[t]),"top"==e.clock?r==e.range.min&&(r=e.range.max):"bottom"==e.clock&&r==e.range.max&&(r=e.range.min),r=r.toFixed(0);break;case"bool":r=""+this[t];break;case"colourString":r=this[t];break;case"freeText":r=this[t];break;default:ED.errorHandler("ED.Doodle","getParameter","Illegal validation type")}else ED.errorHandler("ED.Doodle","getParameter","No entry in parameterValidationArray corresponding to parameter: "+t);return r},ED.Doodle.prototype.increment=function(t,e){var r=this[t];this.animationDataArray[t].frameCounter++;var a=1e3/this.animationFrameRate;if(this.animationDataArray[t].frameCounter==this.animationDataArray[t].frames)this.setSimpleParameter(t,e),this.updateDependentParameters(t),clearTimeout(this.animationDataArray[t].timer);else{this.setSimpleParameter(t,r+this.animationDataArray[t].delta),this.updateDependentParameters(t);var i=this;this.animationDataArray[t].timer=setTimeout(function(){i.increment(t,e)},a)}this.drawing.repaint()},ED.Doodle.prototype.addBinding=function(t,e){var r=e.id,a=e.attribute;if(this[t]!==void 0){var i=document.getElementById(r);if(null!=i){this.bindingArray[t]={id:r,attribute:a};var o,s=this.drawing,n=this.id,l=this.className;switch(i.type){case"checkbox":a?ED.errorHandler("ED.Doodle","addBinding","Binding to a checkbox with a non-standard attribute not yet supported"):(0>this.savedParameterArray.indexOf(t)?this.setParameterFromString(t,""+i.checked):this.drawing.updateBindings(this),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,""+this.checked)},!1));break;case"select-one":a?(i.selectedIndex>-1&&0>this.savedParameterArray.indexOf(t)&&this.setParameterFromString(t,i.options[i.selectedIndex].getAttribute(a)),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.options[this.selectedIndex].getAttribute(a))},!1)):(0>this.savedParameterArray.indexOf(t)?this.setParameterFromString(t,i.value):this.drawing.updateBindings(this),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.value)},!1));break;case"text":a?ED.errorHandler("ED.Doodle","addBinding","Binding to a text field with a non-standard attribute not yet supported"):(0>this.savedParameterArray.indexOf(t)?this.setParameterFromString(t,i.value):this.drawing.updateBindings(this),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.value)},!1));break;default:a?(this.setParameterFromString(t,i.getAttribute(a)),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.getAttribute(a))},!1)):(this.setParameterFromString(t,i.value),i.addEventListener("change",o=function(){s.eventHandler("onchange",n,l,this.id,this.value)},!1))}this.drawing.listenerArray[this.id][t]=o}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. DOM has no element with id: "+r)}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. Doodle of class: "+this.className+" has no parameter of name: "+t)},ED.Doodle.prototype.removeBinding=function(t){var e;for(var r in this.bindingArray)r==t&&(e=this.bindingArray[t].id);delete this.bindingArray[t];var a=document.getElementById(e);a.removeEventListener("change",this.drawing.listenerArray[this.id][t],!1),delete this.drawing.listenerArray[this.id][t]},ED.Doodle.prototype.clockHour=function(){var t;if(this.isRotatable&&!this.isMoveable)t=(6*this.rotation/Math.PI+12)%12;else var e=new ED.Point(0,-100),r=new ED.Point(this.originX,this.originY),t=(6*e.clockwiseAngleTo(r)/Math.PI+12)%12;return t=t.toFixed(0),0==t&&(t=12),t},ED.Doodle.prototype.quadrant=function(){var t="";return t+=0>this.originY?"supero":"infero",t+=this.drawing.eye==ED.eye.Right?0>this.originX?"temporal":"nasal":0>this.originX?"nasal":"temporal",t+=" quadrant"},ED.Doodle.prototype.degrees=function(){var t;if(this.isRotatable&&!this.isMoveable)t=(180*this.rotation/Math.PI+360)%360;else{var e=new ED.Point(0,-100),r=new ED.Point(this.originX,this.originY);t=(180*e.clockwiseAngleTo(r)/Math.PI+360)%360}return t=t.toFixed(0),0==t&&(t=0),t},ED.Doodle.prototype.clockHourExtent=function(){var t,e;if(this.isRotatable&&!this.isMoveable)t=(6*(this.rotation-this.arc/2)/Math.PI+12)%12,e=(6*(this.rotation+this.arc/2)/Math.PI+12)%12;else{var r=new ED.Point(0,-100),a=new ED.Point(this.originX,this.originY);(6*r.clockwiseAngleTo(a)/Math.PI+12)%12}return t=t.toFixed(0),0==t&&(t=12),e=e.toFixed(0),0==e&&(e=12),"from "+t+" to "+e},ED.Doodle.prototype.degreesExtent=function(){var t=180*this.arc/Math.PI,e=Math.round(t);return e},ED.Doodle.prototype.locationRelativeToDisc=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>180&&420>this.originX&&this.originY>-120&&120>this.originY?t="at the disc":(t+=0>=this.originY?"supero":"infero",t+=300>=this.originX?"temporally":"nasally"):-180>this.originX&&this.originX>-420&&this.originY>-120&&120>this.originY?t="at the disc":(t+=0>=this.originY?"supero":"infero",t+=this.originX>=-300?"temporally":"nasally"),t},ED.Doodle.prototype.locationRelativeToFovea=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>-10&&10>this.originX&&this.originY>-10&&10>this.originY?t="at the fovea":(t+=0>=this.originY?"supero":"infero",t+=0>=this.originX?"temporal":"nasal",t+=" to the fovea"):this.originX>-10&&10>this.originX&&this.originY>-10&&10>this.originY?t="at the fovea":(t+=0>=this.originY?"supero":"infero",t+=this.originX>=0?"temporally":"nasally",t+=" to the fovea"),t},ED.Doodle.prototype.addSquiggle=function(){var t=new ED.Colour(0,0,0,1);t.setWithHexString(this.colourString);var e;switch(this.thickness){case"Thin":e=ED.squiggleWidth.Thin;break;case"Medium":e=ED.squiggleWidth.Medium;break;case"Thick":e=ED.squiggleWidth.Thick;break;default:e=ED.squiggleWidth.Thin}var r=new ED.Squiggle(this,t,e,this.filled);this.squiggleArray.push(r)},ED.Doodle.prototype.addPointToSquiggle=function(t){if(this.squiggleArray.length>0){var e=this.squiggleArray.length-1,r=this.squiggleArray[e];r.addPoint(t)}},ED.Doodle.prototype.completeSquiggle=function(){if(this.squiggleArray.length>0){var t=this.squiggleArray.length-1,e=this.squiggleArray[t];e.complete=!0}},ED.Doodle.prototype.calculateArc=function(){var t=new ED.Point(this.leftExtremity.x-this.drawing.canvas.width/2,this.leftExtremity.y-this.drawing.canvas.height/2),e=new ED.Point(this.rightExtremity.x-this.drawing.canvas.width/2,this.rightExtremity.y-this.drawing.canvas.height/2);return t.clockwiseAngleTo(e)},ED.Doodle.prototype.nearestPointTo=function(t){if(this.pointsArray.length>0){for(var e=1e7,r=0,a=0;this.pointsArray.length>a;a++){var i=this.pointsArray[a],o=(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y);e>o&&(e=o,r=a)}return this.pointsArray[r]}return ED.errorHandler("ED.Doodle","nearestPointTo","Attempt to calculate nearest points with an empty points array"),t},ED.Doodle.prototype.nearestAngleTo=function(t){if(this.anglesArray.length>0){for(var e=2*Math.PI,r=0,a=0;this.anglesArray.length>a;a++){var i=this.anglesArray[a],o=Math.abs(i-t);e>o&&(e=o,r=a)}return this.anglesArray[r]}return ED.errorHandler("ED.Doodle","nearestAngleTo","Attempt to calculate nearest angle with an empty angles array"),t},ED.Doodle.prototype.nearestArcTo=function(t){if(this.arcArray.length>0){for(var e=2*Math.PI,r=0,a=0;this.arcArray.length>a;a++){var i=this.arcArray[a],o=Math.abs(i-t);e>o&&(e=o,r=a)}return this.arcArray[r]}return ED.errorHandler("ED.Doodle","nearestArcTo","Attempt to calculate nearest arc with an empty arc array"),t},ED.Doodle.prototype.json=function(){var t="{";if(t=t+'"version":'+this.version.toFixed(1)+",",t=t+'"subclass":'+'"'+this.className+'",',this.savedParameterArray!==void 0&&this.savedParameterArray.length>0)for(var e=0;this.savedParameterArray.length>e;e++){var r,a=this.savedParameterArray[e];"scaleX"==a||"scaleY"==a?r=this[a].toFixed(2):"arc"==a||"rotation"==a?r=(180*this[a]/Math.PI).toFixed(0):"originX"==a||"originY"==a||"radius"==a||"apexX"==a||"apexY"==a||"width"==a||"height"==a?r=this[a].toFixed(0):"number"==typeof this[a]?r=this[a].toFixed(2):"string"==typeof this[a]?r='"'+this[a]+'"':"boolean"==typeof this[a]?r=this[a]:"object"==typeof this[a]?r=JSON.stringify(this[a]):(ED.errorHandler("ED.Doodle","json","Attempt to create json for an unhandled parameter type: "+typeof this[a]),r="ERROR"),t=t+'"'+a+'":'+r+","}if(this.squiggleArray.length>0){t+='"squiggleArray":[';for(var i=0;this.squiggleArray.length>i;i++)t+=this.squiggleArray[i].json(),this.squiggleArray.length-i>1&&(t+=",");t+="],"}return t=t+'"order":'+this.order.toFixed(0),t+="}"},ED.Doodle.prototype.drawSpot=function(t,e,r,a,i){t.save(),t.beginPath(),t.arc(e,r,a,0,2*Math.PI,!0),t.fillStyle=i,t.strokeStyle=i,t.lineWidth=0,t.fill(),t.stroke(),t.restore()},ED.Doodle.prototype.drawCircle=function(t,e,r,a,i,o,s){t.save(),t.beginPath(),t.arc(e,r,a,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.lineWidth=o,t.strokeStyle=s,t.stroke(),t.restore()},ED.Doodle.prototype.drawLine=function(t,e,r,a,i,o,s){t.save(),t.beginPath(),t.moveTo(e,r),t.lineTo(a,i),t.lineWidth=o,t.strokeStyle=s,t.stroke(),t.restore()},ED.Doodle.prototype.drawLaserSpot=function(t,e,r){this.drawCircle(t,e,r,15,"Yellow",10,"rgba(255, 128, 0, 1)")},ED.Doodle.prototype.drawNFLHaem=function(t,e,r){var a=10,i=new ED.Point(e,r),o=i.direction()+Math.PI/2,s=i.direction()+3*Math.PI/2,n=new ED.Point(0,0);n.setWithPolars(a,o);var l=new ED.Point(0,0);l.setWithPolars(a,s),t.beginPath(),t.moveTo(e+n.x,r+n.y),t.lineTo(e+l.x,r+l.y),t.lineWidth=16,t.lineCap="round",t.strokeStyle="rgba(255,0,0,0.5)",t.stroke()},ED.Doodle.prototype.addEllipseToPath=function(t,e,r,a,i){var o=.5522848,s=a/2*o,n=i/2*o;t.moveTo(-a/2,0),t.bezierCurveTo(e-a/2,r-n,e-s,r-i/2,e,r-i/2),t.bezierCurveTo(e+s,r-i/2,e+a/2,r-n,e+a/2,r),t.bezierCurveTo(e+a/2,r+n,e+s,r+i/2,e,r+i/2),t.bezierCurveTo(e-s,r+i/2,e-a/2,r+n,e-a/2,r)},ED.Doodle.prototype.xForY=function(t,e){return Math.sqrt(t*t-e*e)},ED.Doodle.prototype.debug=function(){console.log("org: "+this.originX+" : "+this.originY),console.log("apx: "+this.apexX+" : "+this.apexY),console.log("rot: "+180*this.rotation/Math.PI),console.log("arc: "+180*this.arc/Math.PI)},ED.Handle=function(t,e,r,a){this.location=null==t?new ED.Point(0,0):t,this.isVisible=e,this.mode=r,this.isRotatable=a},ED.Range=function(t,e){this.min=t,this.max=e},ED.Range.prototype.setMinAndMax=function(t,e){this.min=t,this.max=e},ED.Range.prototype.isBelow=function(t){return this.min>t?!0:!1},ED.Range.prototype.isAbove=function(t){return t>this.max?!0:!1},ED.Range.prototype.includes=function(t){return this.min>t||t>this.max?!1:!0},ED.Range.prototype.constrain=function(t){return this.min>t?this.min:t>this.max?this.max:t},ED.Range.prototype.includesInAngularRange=function(t,e){var r=100,a=new ED.Point(0,0),i=new ED.Point(0,0),o=new ED.Point(0,0);return e?(a.setWithPolars(r,this.min*Math.PI/180),i.setWithPolars(r,this.max*Math.PI/180),o.setWithPolars(r,t*Math.PI/180)):(a.setWithPolars(r,this.min),i.setWithPolars(r,this.max),o.setWithPolars(r,t)),a.clockwiseAngleTo(o)<=a.clockwiseAngleTo(i)},ED.Range.prototype.constrainToAngularRange=function(t,e){if(this.max-this.min<(e?360:2*Math.PI)){var r=100,a=new ED.Point(0,0),i=new ED.Point(0,0),o=new ED.Point(0,0);return e?(a.setWithPolars(r,this.min*Math.PI/180),i.setWithPolars(r,this.max*Math.PI/180),o.setWithPolars(r,t*Math.PI/180)):(a.setWithPolars(r,this.min),i.setWithPolars(r,this.max),o.setWithPolars(r,t)),a.clockwiseAngleTo(o)<=a.clockwiseAngleTo(i)?t:o.clockwiseAngleTo(a)<i.clockwiseAngleTo(o)?this.min:this.max
}return t},ED.Point=function(t,e){this.x=Math.round(+t),this.y=Math.round(+e),this.components=[this.x,this.y,1]},ED.Point.prototype.setWithPolars=function(t,e){this.x=Math.round(t*Math.sin(e)),this.y=Math.round(-t*Math.cos(e))},ED.Point.prototype.setCoordinates=function(t,e){this.x=t,this.y=e},ED.Point.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},ED.Point.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},ED.Point.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},ED.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},ED.Point.prototype.direction=function(){var t=new ED.Point(0,-100);return t.clockwiseAngleTo(this)},ED.Point.prototype.clockwiseAngleTo=function(t){var e=Math.acos(this.dotProduct(t)/(this.length()*t.length()));return 0>this.crossProduct(t)?2*Math.PI-e:e},ED.Point.prototype.pointAtRadiusAndClockwiseAngle=function(t,e){var r=this.direction(),a=new ED.Point(0,0);return a.setWithPolars(t,r+e),a},ED.Point.prototype.pointAtAngleToLineToPointAtProportion=function(t,e,a){var i=new ED.Point((e.x-this.x)*a,(e.y-this.y)*a);r=i.length();var o=i.pointAtRadiusAndClockwiseAngle(r,t);return o.x+=this.x,o.y+=this.y,o},ED.Point.prototype.clockHour=function(){var t=new ED.Point(0,-100),e=(6*t.clockwiseAngleTo(this)/Math.PI+12)%12;return e=e.toFixed(0),0==e&&(e=12),e},ED.Point.prototype.tangentialControlPoint=function(t){var e=this.length(),r=this.direction(),a=e/Math.cos(t),i=new ED.Point(0,0);return i.setWithPolars(a,r+t),i},ED.Point.prototype.json=function(){return'{"x":'+this.x.toFixed(2)+',"y":'+this.y.toFixed(2)+"}"},ED.AffineTransform=function(){this.components=[[1,0,0],[0,1,0],[0,0,1]]},ED.AffineTransform.prototype.setToIdentity=function(){this.components[0][0]=1,this.components[0][1]=0,this.components[0][2]=0,this.components[1][0]=0,this.components[1][1]=1,this.components[1][2]=0,this.components[2][0]=0,this.components[2][1]=0,this.components[2][2]=1},ED.AffineTransform.prototype.setToTransform=function(t){this.components[0][0]=t.components[0][0],this.components[0][1]=t.components[0][1],this.components[0][2]=t.components[0][2],this.components[1][0]=t.components[1][0],this.components[1][1]=t.components[1][1],this.components[1][2]=t.components[1][2],this.components[2][0]=t.components[2][0],this.components[2][1]=t.components[2][1],this.components[2][2]=t.components[2][2]},ED.AffineTransform.prototype.translate=function(t,e){this.components[0][2]=this.components[0][0]*t+this.components[0][1]*e+this.components[0][2],this.components[1][2]=this.components[1][0]*t+this.components[1][1]*e+this.components[1][2],this.components[2][2]=this.components[2][0]*t+this.components[2][1]*e+this.components[2][2]},ED.AffineTransform.prototype.scale=function(t,e){this.components[0][0]=this.components[0][0]*t,this.components[0][1]=this.components[0][1]*e,this.components[1][0]=this.components[1][0]*t,this.components[1][1]=this.components[1][1]*e,this.components[2][0]=this.components[2][0]*t,this.components[2][1]=this.components[2][1]*e},ED.AffineTransform.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),a=[[0,0,0],[0,0,0],[0,0,0]];a[0][0]=this.components[0][0]*e+this.components[0][1]*r,a[0][1]=this.components[0][1]*e-this.components[0][0]*r,a[1][0]=this.components[1][0]*e+this.components[1][1]*r,a[1][1]=this.components[1][1]*e-this.components[1][0]*r,a[2][0]=this.components[2][0]*e+this.components[2][1]*r,a[2][1]=this.components[2][1]*e-this.components[2][0]*r,this.components[0][0]=a[0][0],this.components[0][1]=a[0][1],this.components[1][0]=a[1][0],this.components[1][1]=a[1][1],this.components[2][0]=a[2][0],this.components[2][1]=a[2][1]},ED.AffineTransform.prototype.transformPoint=function(t){var e=t.x*this.components[0][0]+t.y*this.components[0][1]+1*this.components[0][2],r=t.x*this.components[1][0]+t.y*this.components[1][1]+1*this.components[1][2];return new ED.Point(e,r)},ED.AffineTransform.prototype.determinant=function(){return this.components[0][0]*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1])-this.components[0][1]*(this.components[1][0]*this.components[2][2]-this.components[1][2]*this.components[2][0])+this.components[0][2]*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0])},ED.AffineTransform.prototype.createInverse=function(){var t=new ED.AffineTransform,e=this.determinant(),r=1/e;return t.components[0][0]=r*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1]),t.components[0][1]=r*(this.components[0][2]*this.components[2][1]-this.components[0][1]*this.components[2][2]),t.components[0][2]=r*(this.components[0][1]*this.components[1][2]-this.components[0][2]*this.components[1][1]),t.components[1][0]=r*(this.components[1][2]*this.components[2][0]-this.components[1][0]*this.components[2][2]),t.components[1][1]=r*(this.components[0][0]*this.components[2][2]-this.components[0][2]*this.components[2][0]),t.components[1][2]=r*(this.components[0][2]*this.components[1][0]-this.components[0][0]*this.components[1][2]),t.components[2][0]=r*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0]),t.components[2][1]=r*(this.components[0][1]*this.components[2][0]-this.components[0][0]*this.components[2][1]),t.components[2][2]=r*(this.components[0][0]*this.components[1][1]-this.components[0][1]*this.components[1][0]),t},ED.Squiggle=function(t,e,r,a){this.doodle=t,this.colour=e,this.thickness=r,this.filled=a,this.pointsArray=[],this.complete=!1},ED.Squiggle.prototype.addPoint=function(t){this.pointsArray.push(t)},ED.Squiggle.prototype.json=function(){var t="{";t=t+'"colour":'+this.colour.json()+",",t=t+'"thickness": '+this.thickness+",",t=t+'"filled": "'+this.filled+'",',t+='"pointsArray":[';for(var e=0;this.pointsArray.length>e;e++)t+=this.pointsArray[e].json(),this.pointsArray.length-e>1&&(t+=",");return t+="]",t+="}"},ED.Colour=function(t,e,r,a){this.red=t,this.green=e,this.blue=r,this.alpha=a},ED.Colour.prototype.setWithHexString=function(t){this.red=parseInt(t.charAt(0)+t.charAt(1),16),this.green=parseInt(t.charAt(2)+t.charAt(3),16),this.blue=parseInt(t.charAt(4)+t.charAt(5),16),t.length>6&&(this.alpha=parseInt(t.charAt(6)+t.charAt(7),16))},ED.Colour.prototype.hexString=function(){return this.red>0?"FF0000FF":"00FF00FF"},ED.Colour.prototype.rgba=function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},ED.Colour.prototype.json=function(){return'{"red":'+this.red+',"green":'+this.green+',"blue":'+this.blue+',"alpha":'+this.alpha+"}"},String.prototype.firstLetterToLowerCase=function(){var t=this.charAt(1);return t==t.toUpperCase()?this:this.charAt(0).toLowerCase()+this.slice(1)},String.prototype.addAndAfterLastComma=function(){for(var t=!1,e=this.length-1;e>=0;e--)if(","==this.charAt(e)){t=!0;break}return t?this.substring(0,e)+", and"+this.substring(e+1,this.length):this},null==ED||"object"!=typeof ED)var ED={};if(ED.Categories={},ED.Categories.EntrySiteBreak={complication:"Entry site break"},ED.Categories.RetinalTouch={complication:"Retinal touch"},ED.Categories.IatrogenicBreak={complication:"Iatrogenic break"},ED.Categories.SubretinalPFCL={complication:"Subretinal PFCL"},ED.Freehand=function(t,e){this.className="Freehand",this.labelWidth=0,this.labelHeight=80,this.labelFont="60px sans-serif",this.colourString="00FF00FF",this.filled=!0,this.thickness="Thin",this.labelText="",this.savedParameterArray=["originX","originY","colourString","filled","thickness","labelText"],this.controlParameterArray={colourString:"Colour",filled:"Fill",thickness:"Thickness",labelText:"Label"},ED.Doodle.call(this,t,e)},ED.Freehand.prototype=new ED.Doodle,ED.Freehand.prototype.constructor=ED.Freehand,ED.Freehand.superclass=ED.Doodle.prototype,ED.Freehand.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.Freehand.prototype.setPropertyDefaults=function(){this.isDrawable=!0,this.parameterValidationArray.colourString={kind:"derived",type:"colourString",list:["FF0000FF","00FF00FF","0000FFFF"],animate:!1},this.parameterValidationArray.filled={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.thickness={kind:"derived",type:"string",list:["Thin","Medium","Thick"],animate:!1},this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!1}},ED.Freehand.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,100)},ED.Freehand.prototype.draw=function(t){var e=this.drawing.context;ED.Freehand.superclass.draw.call(this,t),e.beginPath();var r=200;e.rect(-r,-r,2*r,2*r),e.closePath();var a=new ED.Colour(0,0,0,1);if(a.setWithHexString(this.colourString),e.lineWidth=2,this.isFilled=!1,e.strokeStyle="rgba(255, 255, 255, 0)",this.isSelected&&(e.strokeStyle="gray"),this.isForDrawing&&(e.strokeStyle="blue"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var i=0;this.squiggleArray.length>i;i++){var o=this.squiggleArray[i];e.beginPath(),e.lineWidth=o.thickness,e.strokeStyle=o.colour.rgba(),e.fillStyle=o.colour.rgba();for(var s=0;o.pointsArray.length>s;s++)e.lineTo(o.pointsArray[s].x,o.pointsArray[s].y);e.stroke(),o.filled&&o.complete&&e.fill()}this.labelText.length>0&&(e.font=this.labelFont,this.labelWidth=e.measureText(this.labelText).width,e.fillStyle="black",e.fillText(this.labelText,-this.labelWidth/2,this.labelHeight/6))}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(r,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MouseTest=function(t,e){this.className="MouseTest",ED.Doodle.call(this,t,e)},ED.MouseTest.prototype=new ED.Doodle,ED.MouseTest.prototype.constructor=ED.MouseTest,ED.MouseTest.superclass=ED.Doodle.prototype,ED.MouseTest.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.MouseTest.prototype.draw=function(t){var e=this.drawing.context;ED.MouseTest.superclass.draw.call(this,t),e.beginPath();var r=200;return e.rect(-r/2,-r/2,r,r),e.closePath(),e.lineWidth=1,e.fillStyle="white",e.strokeStyle="blue",this.drawBoundary(t),this.isClicked&&console.log(t.x,t.y),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isClicked},ED.GraphAxes=function(t,e){this.className="GraphAxes",ED.Doodle.call(this,t,e)},ED.GraphAxes.prototype=new ED.Doodle,ED.GraphAxes.prototype.constructor=ED.GraphAxes,ED.GraphAxes.superclass=ED.Doodle.prototype,ED.GraphAxes.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.GraphAxes.prototype.draw=function(t){var e=this.drawing.context;ED.GraphAxes.superclass.draw.call(this,t),e.beginPath();var r=400;if(e.moveTo(0,-r),e.lineTo(0,r),e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,-r),e.closePath(),e.lineWidth=4,e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var a=-r;r>=a;a+=100)0!=a&&(e.moveTo(-20,a),e.lineTo(20,a));for(var i=-r;r>=i;i+=100)0!=i&&(e.moveTo(i,-20),e.lineTo(i,20));e.stroke(),e.font="80px sans-serif",e.fillStyle="gray",e.textAlign="center",e.fillText("+Sph",0,-440),e.fillText("-Sph",0,480),e.fillText("+Cyl",400,-40),e.fillText("-Cyl",-400,-40)}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Label=function(t,e){this.className="Label",this.labelText="",this.lastOriginX=0,this.lastOriginY=0,this.labelWidth=0,this.labelHeight=80,this.labelFont="60px sans-serif",this.padding=10,this.maximumLength=20,this.isEdited=!1,this.savedParameterArray=["originX","originY","apexX","apexY","labelText","lastOriginX","lastOriginY"],this.controlParameterArray={labelText:"Text"},ED.Doodle.call(this,t,e)},ED.Label.prototype=new ED.Doodle,ED.Label.prototype.constructor=ED.Label,ED.Label.superclass=ED.Doodle.prototype,ED.Label.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Label.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.apexY.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!1}},ED.Label.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.lastOriginX=this.originX,this.lastOriginY=this.originY,this.apexX=100,this.apexY=-150},ED.Label.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"originX":r.apexX=this.apexX-(e-this.lastOriginX)/this.drawing.globalScaleFactor,this.lastOriginX=e;break;case"originY":r.apexY=this.apexY-(e-this.lastOriginY)/this.drawing.globalScaleFactor,this.lastOriginY=e}return r},ED.Label.prototype.draw=function(t){var e=this.drawing.context;if(ED.Label.superclass.draw.call(this,t),e.font=this.labelFont,this.labelWidth=e.measureText(this.labelText).width+2*this.padding,e.beginPath(),e.rect(-this.labelWidth/2,-this.labelHeight/2,this.labelWidth,this.labelHeight),e.closePath(),e.lineWidth=2,this.isFilled=!1,e.strokeStyle="rgba(0, 0, 0, 0)",this.isSelected&&(e.strokeStyle="gray"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.fillText(this.labelText,-this.labelWidth/2+this.padding,this.labelHeight/6);var r,a=new ED.Point(0,0);r=0==this.apexX?2:Math.abs(this.apexY/this.apexX),0>=this.apexY&&r>=1&&(a.x=0,a.y=-this.labelHeight/2),0>=this.apexX&&1>r&&(a.x=-this.labelWidth/2,a.y=0),this.apexY>0&&r>=1&&(a.x=0,a.y=this.labelHeight/2),this.apexX>0&&1>r&&(a.x=this.labelWidth/2,a.y=0);var i=new ED.Point(this.apexX,this.apexY);e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.strokeStyle="Gray",e.lineWidth=4,e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Label.prototype.onSelection=function(){ED.Label.superclass.onSelection.call(this),document.getElementById(this.parameterControlElementId("labelText")).focus()},ED.OperatingTable=function(t,e){this.className="OperatingTable",ED.Doodle.call(this,t,e)},ED.OperatingTable.prototype=new ED.Doodle,ED.OperatingTable.prototype.constructor=ED.OperatingTable,ED.OperatingTable.superclass=ED.Doodle.prototype,ED.OperatingTable.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.OperatingTable.prototype.draw=function(t){var e=this.drawing.context;return ED.OperatingTable.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-0,60,0,2*Math.PI,!0),e.lineWidth=30,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.rect(-100,20,200,400),e.lineWidth=8,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",e.fill(),e.stroke()),this.isClicked},ED.Slider2D=function(t,e){this.className="Slider2D",this.sphereSign=" ",this.sphereInteger=0,this.sphereFractional=0,this.cylinderSign=" ",this.cylinderInteger=0,this.cylinderFractional=0,ED.Doodle.call(this,t,e)},ED.Slider2D.prototype=new ED.Doodle,ED.Slider2D.prototype.constructor=ED.Slider2D,ED.Slider2D.superclass=ED.Doodle.prototype,ED.Slider2D.prototype.setPropertyDefaults=function(){this.snapToGrid=!0,this.gridSpacing=5,this.isShowHighlight=!1,this.parameterValidationArray.originX.range.setMinAndMax(-400,400),this.parameterValidationArray.originY.range.setMinAndMax(-400,400),this.parameterValidationArray.sphereSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.sphereInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.sphereFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0},this.parameterValidationArray.cylinderSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.cylinderInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.cylinderFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0}},ED.Slider2D.prototype.setParameterDefaults=function(){this.setParameterFromString("sphereSign","="),this.setParameterFromString("sphereInteger","0"),this.setParameterFromString("sphereFractional",".00"),this.setParameterFromString("cylinderSign","="),this.setParameterFromString("cylinderInteger","0"),this.setParameterFromString("cylinderFractional",".00")},ED.Slider2D.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"sphereSign":switch(e){case"+":r.originY=-1*Math.abs(this.originY);break;case"=":r.originY=0;break;case"-":r.originY=Math.abs(this.originY)}break;case"sphereInteger":r.originY=20*(parseInt(e)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?1:-1);break;case"sphereFractional":r.originY=20*(this.sphereInteger+parseFloat(e))*("-"==this.sphereSign?1:-1);break;case"cylinderSign":switch(e){case"+":r.originX=Math.abs(this.originX);break;case"=":r.originX=0;break;case"-":r.originX=-1*Math.abs(this.originX)}break;case"cylinderInteger":r.originX=20*(parseInt(e)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?-1:1);break;case"cylinderFractional":r.originX=20*(this.sphereInteger+parseFloat(e))*("-"==this.sphereSign?-1:1);break;case"originY":r.sphereSign=e>0?"-":0>e?"+":"=",r.sphereInteger=Math.floor(Math.abs(e/20));var a=Math.abs(e/20)-Math.floor(Math.abs(e/20));0==a&&(r.sphereFractional=".00"),.25==a&&(r.sphereFractional=".25"),.5==a&&(r.sphereFractional=".50"),.75==a&&(r.sphereFractional=".75");break;case"originX":r.cylinderSign=0>e?"-":e>0?"+":"=",r.cylinderInteger=Math.floor(Math.abs(e/20));var a=Math.abs(e/20)-Math.floor(Math.abs(e/20));0==a&&(r.cylinderFractional=".00"),.25==a&&(r.cylinderFractional=".25"),.5==a&&(r.cylinderFractional=".50"),.75==a&&(r.cylinderFractional=".75")}return r},ED.Slider2D.prototype.draw=function(t){var e=this.drawing.context;ED.Slider2D.superclass.draw.call(this,t),e.beginPath();var r=30,a=80;e.moveTo(0,-a-r),e.lineTo(r,-a),e.lineTo(a,-a),e.lineTo(a,-r),e.lineTo(a+r,0),e.lineTo(a,r),e.lineTo(a,a),e.lineTo(r,a),e.lineTo(0,a+r),e.lineTo(-r,a),e.lineTo(-a,a),e.lineTo(-a,r),e.lineTo(-a-r,0),e.lineTo(-a,-r),e.lineTo(-a,-a),e.lineTo(-r,-a),e.closePath(),e.lineWidth=2,e.strokeStyle="blue";var i="rgba(130, 205, 205, 0.5)",o="rgba(170, 225, 225, 0.5)",s=e.createLinearGradient(0,-25,0,25);if(s.addColorStop(0,o),s.addColorStop(1,i),e.fillStyle=s,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var n=100;e.moveTo(0,-n),e.lineTo(0,n),e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,-n),e.strokeStyle="gray",e.stroke()}return this.isClicked},ED.Surgeon=function(t,e){this.className="Surgeon",this.surgeonPosition="Temporal",this.savedParameterArray=["surgeonPosition"],ED.Doodle.call(this,t,e)},ED.Surgeon.prototype=new ED.Doodle,ED.Surgeon.prototype.constructor=ED.Surgeon,ED.Surgeon.superclass=ED.Doodle.prototype,ED.Surgeon.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.snapToAngles=!0,this.willStaySelected=!1,this.isUnique=!0,this.isDeletable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(100,500),this.parameterValidationArray.surgeonPosition={kind:"derived",type:"string",list:["Superior","Supero-temporal","Temporal","Infero-temporal","Inferior","Infero-nasal","Nasal","Supero-nasal"],animate:!0};var t=Math.PI/4;this.anglesArray=[0,t,2*t,3*t,4*t,5*t,6*t,7*t]},ED.Surgeon.prototype.setParameterDefaults=function(){this.rotation=0,this.setParameterFromString("surgeonPosition","Temporal")},ED.Surgeon.prototype.dependentParameterValues=function(t,e){var r=[],a=this.drawing.eye==ED.eye.Right,i=2*Math.PI;switch(t){case"rotation":r.surgeonPosition=a?i/16>e?"Superior":3*i/16>e?"Supero-nasal":5*i/16>e?"Nasal":7*i/16>e?"Infero-nasal":9*i/16>e?"Inferior":11*i/16>e?"Infero-temporal":13*i/16>e?"Temporal":15*i/16>e?"Supero-temporal":"Superior":i/16>e?"Superior":3*i/16>e?"Supero-temporal":5*i/16>e?"Temporal":7*i/16>e?"Infero-temporal":9*i/16>e?"Inferior":11*i/16>e?"Infero-nasal":13*i/16>e?"Nasal":15*i/16>e?"Supero-nasal":"Superior";break;case"surgeonPosition":switch(e){case"Superior":r.rotation=0;break;case"Supero-temporal":r.rotation=a?7*Math.PI/4:1*Math.PI/4;break;case"Temporal":r.rotation=a?6*Math.PI/4:2*Math.PI/4;break;case"Infero-temporal":r.rotation=a?5*Math.PI/4:3*Math.PI/4;break;case"Inferior":r.rotation=Math.PI;break;case"Infero-nasal":r.rotation=a?3*Math.PI/4:5*Math.PI/4;break;case"Nasal":r.rotation=a?2*Math.PI/4:6*Math.PI/4;break;case"Supero-nasal":r.rotation=a?1*Math.PI/4:7*Math.PI/4}}return r},ED.Surgeon.prototype.draw=function(t){var e=this.drawing.context;ED.Surgeon.superclass.draw.call(this,t),e.beginPath();var r=.2,a=-300;e.moveTo(0*r,a-200*r),e.bezierCurveTo(-100*r,a-250*r,-145*r,a-190*r,-200*r,a-180*r),e.bezierCurveTo(-310*r,a-160*r,-498*r,a-75*r,-500*r,a+0*r),e.bezierCurveTo(-500*r,a+50*r,-500*r,a+460*r,-470*r,a+700*r),e.bezierCurveTo(-470*r,a+710*r,-500*r,a+770*r,-500*r,a+810*r),e.bezierCurveTo(-500*r,a+840*r,-440*r,a+850*r,-420*r,a+840*r),e.bezierCurveTo(-390*r,a+830*r,-380*r,a+710*r,-380*r,a+700*r),e.bezierCurveTo(-370*r,a+700*r,-360*r,a+780*r,-350*r,a+780*r),e.bezierCurveTo(-330*r,a+780*r,-340*r,a+730*r,-340*r,a+700*r),e.bezierCurveTo(-340*r,a+690*r,-350*r,a+680*r,-350*r,a+670*r),e.bezierCurveTo(-350*r,a+590*r,-385*r,a+185*r,-300*r,a+100*r),e.bezierCurveTo(-150*r,a+140*r,-250*r,a+200*r,0*r,a+300*r),e.bezierCurveTo(250*r,a+200*r,150*r,a+140*r,300*r,a+100*r),e.bezierCurveTo(380*r,a+180*r,350*r,a+590*r,350*r,a+670*r),e.bezierCurveTo(350*r,a+680*r,340*r,a+690*r,340*r,a+700*r),e.bezierCurveTo(340*r,a+730*r,330*r,a+780*r,350*r,a+780*r),e.bezierCurveTo(360*r,a+780*r,370*r,a+700*r,380*r,a+700*r),e.bezierCurveTo(380*r,a+710*r,390*r,a+830*r,420*r,a+840*r),e.bezierCurveTo(430*r,a+845*r,505*r,a+840*r,505*r,a+810*r),e.bezierCurveTo(505*r,a+760*r,470*r,a+710*r,470*r,a+700*r),e.bezierCurveTo(500*r,a+460*r,499*r,a+45*r,500*r,a+0*r),e.bezierCurveTo(498*r,a-78*r,308*r,a-164*r,200*r,a-182*r),e.bezierCurveTo(145*r,a-190*r,100*r,a-250*r,0*r,a-200*r),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,1)";var i=new ED.Colour(0,0,0,1);return i.setWithHexString("3AFEFA"),e.fillStyle=i.rgba(),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(0*r,a-250*r),e.bezierCurveTo(-100*r,a-250*r,-180*r,a-200*r,-200*r,a-170*r),e.bezierCurveTo(-209*r,a-157*r,-220*r,a-100*r,-230*r,a-50*r),e.bezierCurveTo(-260*r,a-70*r,-260*r,a-20*r,-260*r,a+0*r),e.bezierCurveTo(-260*r,a+20*r,-260*r,a+80*r,-230*r,a+60*r),e.bezierCurveTo(-230*r,a+90*r,-220*r,a+141*r,-210*r,a+160*r),e.bezierCurveTo(-190*r,a+200*r,-100*r,a+280*r,-40*r,a+300*r),e.bezierCurveTo(-34*r,a+303*r,-20*r,a+350*r,0*r,a+350*r),e.bezierCurveTo(20*r,a+350*r,34*r,a+300*r,40*r,a+300*r),e.bezierCurveTo(100*r,a+280*r,190*r,a+200*r,210*r,a+160*r),e.bezierCurveTo(218*r,a+143*r,230*r,a+90*r,230*r,a+60*r),e.bezierCurveTo(260*r,a+80*r,260*r,a+20*r,260*r,a+0*r),e.bezierCurveTo(260*r,a-20*r,260*r,a-70*r,230*r,a-50*r),e.bezierCurveTo(220*r,a-100*r,208*r,a-158*r,200*r,a-170*r),e.bezierCurveTo(180*r,a-200*r,100*r,a-250*r,0*r,a-250*r),e.fill(),e.stroke()),this.isClicked},null==ED||"object"!=typeof ED)var ED={};if(ED.trans={},ED.trans.ACIOL="Anterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.AngleGradeEast="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeNorth="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeSouth="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeWest="Grade of angle (Iris)<br/><br/>Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleNV="Angle new vessels<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.AngleRecession="Angle recession<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.AntSeg="Anterior segment<br/><br/>Drag the handle to resize the pupil<br/><br/>The iris is semi-transparent so that IOLs, and<br/>other structures can be seen behind it",ED.trans.AntSegCrossSection="",ED.trans.AntSynech="Anterior synechiae<br/><br/>Drag to move around angle<br/>Drag handles to change extent",ED.trans.ArcuateScotoma="Arcuate scotoma<br/><br/>Drag handle to change size",ED.trans.BiopsySite="Biopsy site<br/><br/>Drag to position",ED.trans.Bleb="Trabeculectomy bleb<br/><br/>Drag to move around the limbus",ED.trans.BlotHaemorrhage="Blot haemorrhage<br/><br/>Drag to position<br/>Drag the handle to change size",ED.trans.BuckleSuture="Buckle suture<br/><br/>Drag to position",ED.trans.BusaccaNodule="Busacca nodule<br/><br/>Drag to move around the iris",ED.trans.CapsularTensionRing="Capsular Tension Ring<br/><br/>This cannot be selected directly since it is behind the iris<br/>Select the iris first<br/>Then move the scroll wheel until the ring is selected<br/>Click the 'Move to front' button<br/>Err.. of course if you are seeing this tooltip you have already done it",ED.trans.ChandelierSingle="Chandelier illumination<br/><br/>Drag to rotate around centre<br/>",ED.trans.ChandelierDouble="Double chandelier illumination<br/><br/>Drag to rotate around centre<br/>",ED.trans.ChoroidalHameorrhage="Choroidal haemorrhage<br/><br/>Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.ChoroidalNaevus="Choroidal naevust<br/><br/>Drag to position<br/>Drag outer handles to change shape<br/>Drag outer ring of top handles to rotate<br/>Drag middle handle to add drusen",ED.trans.CiliaryInjection="Ciliary injection<br/><br/>Drag to rotate around centre<br/>Drag handles to change extent",ED.trans.Circinate="Circinate (Ring of exudates)<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CircumferentialBuckle="Circumferential buckle<br/><br/>Drag to position<br/>Drag outer handles to change extent<br/>Drag middle handle to change width",ED.trans.ConjunctivalFlap="Conjunctival flap<br/><br/>Drag to move around the limbus<br/>Drag handles to change size and depth",ED.trans.CornealAbrasion="Corneal abrasion<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CorneaCrossSection="Corneal cross section",ED.trans.CornealErosion="Removal of corneal epithelium<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CornealGraft="Corneal graft<br/><br/>Drag handle to change size",ED.trans.CornealOedema="Corneal oedema<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.CornealStriae="Corneal striae",ED.trans.CornealScar="Corneal Scar<br/><br/>Drag outer handle to change shape<br/>Drag inner handle to change density",ED.trans.CornealSuture="Corneal suture<br/><br/>Drag to move",ED.trans.CorticalCataract="",ED.trans.CottonWoolSpot="Cotton wool spot<br/><br/>Drag to position<br/>Drag handle to change shape and size",ED.trans.CNV="Choroidal neovascular membrane<br/><br/>Drag to move<br/>Drag handle to scale",ED.trans.CutterPI="Cutter iridectomy<br/><br/>Drag to move around the iris",ED.trans.CystoidMacularOedema="Cystoid macular oedema<br/><br/>Drag handle to change size",ED.trans.DiabeticNV="Diabetic new vessels<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.DiscHaemorrhage="Disc haemorrhage<br/><br/>Drag to position",ED.trans.DiscPallor="Disc Pallor<br/><br/>Drag to position<br/>Drag handles to adjust extent",ED.trans.DrainageRetinotomy="Drainage retinotomy<br/><br/>Drag to position",ED.trans.DrainageSite="Drainage site<br/><br/>Drag to change position",ED.trans.EncirclingBand="Encircling band<br/><br/>Drag to change orientation of Watzke sleeve",ED.trans.EntrySiteBreak="Entry site break<br/><br/>Drag to position<br/>Drag either end handle to increase extent",ED.trans.EpiretinalMembrane="Epiretinal membrane<br/><br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrousProliferation="Fibrous Proliferation<br/><br/>Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FocalLaser="Focal laser burns<br/><br/>Drag the handle for a bigger area with more burns",ED.trans.Freehand="Freehand drawing<br/><br/>Double-click to start drawing<br/>Drag inner handle to change size<br/>Drag outer handle to rotate<br/><br/>Adjust colours and settings in tool bar",ED.trans.Fundus="",ED.trans.Fuchs="Fuch's Endothelial Dystrophy<br/><br/>Drag handle to change shape",ED.trans.Geographic="Geographic Atrophy<br/><br/>Drag middle handle to alter size of remaining central island of RPE<br/>Drag outside handle to scale",ED.trans.Gonioscopy="Goniogram<br/><br/>Drag top left handle up and down to alter pigment density<br/>Drag top left handle left and right to alter pigment homogeneity",ED.trans.HardDrusen="Hard drusen<br/><br/>Drag middle handle up and down to alter density of drusen<br/>Drag outside handle to scale",ED.trans.HardExudate="Hard exudate<br/><br/>Drag to position",ED.trans.Hyphaema="Hyphaema<br/><br/>Drag handle vertically to change size<br/>Drag handle horizontally to change density",ED.trans.Hypopyon="Hypopyon<br/><br/>Drag handle vertically to change size",ED.trans.IatrogenicBreak="Iatrogenic Break<br/><br/>Drag to position<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.ILMPeel="ILM peel<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.InjectionSite="Injection site<br/><br/>Drag to position<br/>Drag handle to adjust distance from limbus",ED.trans.IrisHook="Iris hook<br/><br/>Drag to move around the clock<br/><br/>The hook will match the size of the pupil as it changes<br/>Subsequent hooks are added to the next quadrant",ED.trans.IrisNaevus="Iris naevus<br/><br/>Drag to move<br/>Drag handle to change size",ED.trans.IRMA="Intraretinal microvascular abnormalities<br/><br/>Drag to move<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.KeraticPrecipitates="Keratic precipitates<br/><br/>Drag middle handle up and down to alter density<br/>Drag middle handle left and right to alter size<br/>Drag outside handle to scale",ED.trans.KoeppeNodule="Koeppe nodule<br/><br/>Drag to move around the iris",ED.trans.KrukenbergSpindle="Krukenberg's spindle<br/><br/>Drag to move</br>Drag outer handle to change shape",ED.trans.LaserCircle="A circle of laser spots<br/><br/>Drag handle to change shape",ED.trans.LaserDemarcation="A row of laser spots for demarcation<br/><br/>Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move line more posteriorly",ED.trans.LaserSpot="A single laser spot<br/><br/>Drag to position<br/>Drag the handle to change size",ED.trans.LasikFlap="LASIK flap<br/><br/>Drag to rotate<br/>Drag the handle to scale",ED.trans.LensCrossSection="",ED.trans.LimbalRelaxingIncision="Limbal relaxing incision<br/><br/>Drag to move",ED.trans.Macroaneurysm="Macroaneurysm<br/><br/>Drag to move",ED.trans.MacularDystrophy="Macular dystrophy<br/><br/>Drag outer handle to change size<br/>Drag middle handle to change type",ED.trans.MacularGrid="Macular grid<br/><br/>Drag the handle to scale",ED.trans.MacularHole="Macular hole<br/><br/>Drag the handle to scale",ED.trans.MacularThickening="Macular thickening<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.MattressSuture="Mattress suture<br/><br/>Drag to move",ED.trans.Microaneurysm="Microaneurysm<br/><br/>Drag to position",ED.trans.NerveFibreDefect="Nerve fibre layer defect<br/><br/>Drag to position<br/>Drag handles to change size",ED.trans.OperatingTable="Operating table",ED.trans.OpticDisc="Optic disc<br/><br/>Basic mode: Drag handle to adjust cup/disc ratio<br/>Expert mode: Drag handles to re-shape disc",ED.trans.OpticDiscPit="Optic disc pit<br/><br/>Drag to position<br/>Drag handle to change shape",ED.trans.Papilloedema="Papilloedema",ED.trans.PCIOL="Posterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.PeripapillaryAtrophy="Peripapillary atrophy<br/><br/>Drag to rotate<br/>Drag handles to change extent",ED.trans.PeripheralRetinectomy="Peripheral retinectomy<br/><br/>Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PeripheralRRD="Peripheral retinal detachment<br/><br/>Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PhakoIncision="Phako incision<br/><br/>Drag end handle to change length<br/>Drag the middle handle to change section type<br/>Drag the incision itself to move",ED.trans.PI="Peripheral iridectomy<br/><br/>Drag to move around the iris",ED.trans.PosteriorEmbryotoxon="Posterior embryotoxon",ED.trans.PosteriorRetinectomy="Posterior retinectomy<br/><br/>Drag to position<br/>Drag the handle to change size",ED.trans.PosteriorSynechia="PosteriorSynechia<br/><br/>Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.PostPole="Posterior pole<br/><br/>The disc cup can be edited by clicking on the disc, and dragging the yellow handle<br/>The gray circle marks one disc diameter from the fovea",ED.trans.PreRetinalHaemorrhage="Preretinal haemorrhage<br/><br/>Drag to position<br/>Drag handles to change shape and size",ED.trans.PRPPostPole="Pan-retinal photocoagulation",ED.trans.RadialSponge="Radial sponge<br/><br/>Drag to change position",ED.trans.RetinalArteryOcclusionPostPole="Retinal artery occlusion<br/><br/>Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RetinalTouch="Retinal touch<br/><br/>Drag to change position",ED.trans.RetinalVeinOcclusionPostPole="Retinal vein occlusion<br/><br/>Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RK="Radial keratotomy<br/><br/>Drag to rotate<br/>Drag outer handle to resize<br/>Drag inner handle to adjust central extent",ED.trans.RoundHole="",ED.trans.RPEDetachment="RPE detachment<br/><br/>Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.RPERip="RPE rip<br/><br/>Drag to move<br/>Drag large handle to resize and rotate<br/>Drag other handles to adjust shape",ED.trans.RRD="Rhegmatogenous retinal detachment<br/><br/>Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.Rubeosis="Rubeosis iridis<br/><br/>Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.SectorPRP="A sector of panretinal photocoagulation<br/><br/>Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.SectorPRPPostPole="A sector of panretinal photocoagulation<br/><br/>Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.ScleralIncision="Scleral incision<br/><br/>Drag to move around the sclera",ED.trans.SectorIridectomy="Sector Iridectomy<br/><br/>Drag to position<br/>Drag handles to adjust extent",ED.trans.Sclerostomy="A sclerostomy for vitrectomy<br/><br/>Drag to rotate around centre<br/>Drag each handle to alter gauge<br/>Click suture button to toggle suture",ED.trans.SidePort="Side port<br/><br/>Drag to move",ED.trans.SubretinalFluid="Subretinal fluid<br/><br/>Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.SubretinalPFCL="Subretinal PFCL<br/><br/>Drag to position<br/>Drag handle to change size",ED.trans.Surgeon="Surgeon",ED.trans.SwollenDisc="Swollen disc",ED.trans.Telangiectasis="Parafoveal Telangiectasia<br/><br/>Drag middle handle to add pigment and exudate",ED.trans.ToricPCIOL="Toric posterior chamber IOL<br/><br/>Drag to move<br/>Drag the handle to rotate",ED.trans.Trabectome="Trabectome<br/><br/>Drag to position<br/>Drag either end handle to adjust extent",ED.trans.TrabyFlap="Trabeculectomy flap<br/><br/>Drag to position<br/>Drag either end handle to adjust size</br>Drag middle handle to change sclerostomy",ED.trans.TrabySuture="Trabeculectomy suture<br/><br/>Drag to position<br/>Drag corner handle to adjust orientation</br>Drag lower handle to change suture type",ED.trans.TractionRetinalDetachment="Traction retinal detachment<br/><br/>Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.TransilluminationDefect="Transillumination defects of the iris<br/><br/>Drag to rotate around centre<br/>Drag each end handle to alter extent",ED.trans.UTear="",ED.trans.VitreousOpacity="Vitreous Opacity<br/><br/>Drag to move<br/>Drag the inner handle up and down to alter opacity<br/>Drag the outer handle to scale",ED.trans.Crepitations="Crepitations<br/><br/>Drag to move<br/>Drag handle to resize",ED.trans.Stenosis="Stenosis<br/><br/>Drag to move<br/>Drag handle up and down to change degree<br/>Drag handle to left and right to change type",ED.trans.Wheeze="Wheeze<br/><br/>Drag to move",ED.trans.Effusion="Pleural effusion<br/><br/>Drag handle to move up",ED.trans.LeftCoronaryArtery="Left coronary artery<br/><br/>Drag handle to move origin and make anomolous",ED.trans.DrugStent="Drug eluting stent<br/><br/>Drag to move",ED.trans.MetalStent="Metal stent<br/><br/>Drag to move",ED.trans.Bypass="Coronary artery bypass<br/><br/>Drag handle to alter destination",ED.trans.Bruit="Bruit<br/><br/>Drag to move",ED.trans.Bruising="Bruising<br/><br/>Drag to move<br/>Drag handle to resize",ED.trans.Haematoma="Haematoma<br/><br/>Drag to move<br/>Drag handle to resize",ED.AgentDose=function(t,e){this.className="AgentDose",this.halfWidth=50,this.halfHeight=20,this.minimumWidth=40,this.valueString="200mg",ED.Doodle.call(this,t,e)
},ED.AgentDose.prototype=new ED.Doodle,ED.AgentDose.prototype.constructor=ED.AgentDose,ED.AgentDose.superclass=ED.Doodle.prototype,ED.AgentDose.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDose.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-1e3+this.halfWidth,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(-this.halfWidth+this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDose.prototype.setParameterDefaults=function(){this.apexX=100},ED.AgentDose.prototype.draw=function(t){var e=this.drawing.context;ED.AgentDose.superclass.draw.call(this,t),e.beginPath();var r=5,a=1.5;if(this.halfWidth=e.measureText(this.valueString).width*a,e.moveTo(-this.halfWidth,-this.halfHeight+r),e.lineTo(-r,-this.halfHeight+r),e.lineTo(0,-this.halfHeight),e.lineTo(r,-this.halfHeight+r),e.lineTo(this.halfWidth,-this.halfHeight+r),e.lineTo(this.halfWidth,this.halfHeight-r),e.lineTo(r,this.halfHeight-r),e.lineTo(0,this.halfHeight),e.lineTo(-r,this.halfHeight-r),e.lineTo(-this.halfWidth,this.halfHeight-r),e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(50,50,50,1)",e.fillStyle="white",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.font="24px sans-serif",e.strokeStyle="gray",e.fillStyle="gray";var i=e.measureText(this.valueString).width;e.fillText(this.valueString,-i/2,8)}return this.isClicked},ED.AgentDuration=function(t,e){this.className="AgentDuration",this.unit="mg",this.type="range",this.halfHeight=20,this.minimumWidth=40,this.dose="",this.savedParameterArray=["originX","apexX","unit","type","dose"],ED.Doodle.call(this,t,e)},ED.AgentDuration.prototype=new ED.Doodle,ED.AgentDuration.prototype.constructor=ED.AgentDuration,ED.AgentDuration.superclass=ED.Doodle.prototype,ED.AgentDuration.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDuration.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.unit={kind:"derived",type:"string",list:["mg","mls","ug","mg/kg/hr","ug/kg/hr","drops","IU"],animate:!1},this.parameterValidationArray.type={kind:"derived",type:"string",list:["range","fixed"],animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-500,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDuration.prototype.setParameterDefaults=function(){this.apexX=this.minimumWidth},ED.AgentDuration.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"type":this.apexX="range"==e?200:40}return r},ED.AgentDuration.prototype.draw=function(t){var e=this.drawing.context;ED.AgentDuration.superclass.draw.call(this,t),e.beginPath();var r=this.minimumWidth/2;if("range"==this.type&&(r=0),e.rect(0-r,-this.halfHeight,this.apexX,2*this.halfHeight),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(125,125,125,0)",e.fillStyle="rgba(125,125,125,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),"range"==this.type?(e.moveTo(0-r,-this.halfHeight),e.lineTo(0-r,this.halfHeight),e.moveTo(0-r,0),e.lineTo(this.apexX-r,0),e.moveTo(this.apexX-r,-this.halfHeight),e.lineTo(this.apexX-r,this.halfHeight)):(e.moveTo(-r,0),e.lineTo(0,this.halfHeight),e.lineTo(r,0),e.lineTo(0,-this.halfHeight),e.closePath()),e.lineWidth=4,e.strokeStyle="rgba(50,50,50,1)",e.stroke(),e.lineWidth=1,e.font="24px sans-serif",e.strokeStyle="blue",e.fillStyle="blue";var a=this.dose+"";a.length>0&&(a=a+" "+this.unit),e.measureText(a).width;var i=10;e.fillText(a,r+i,-8)}return"range"==this.type&&(this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t)),this.isClicked},ED.AgentDuration.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.beginPath();var e=this.minimumWidth/2;"range"==this.type&&(e=0);var r=3;t.rect(0-e-r,-this.halfHeight-r,this.apexX+2*r,2*this.halfHeight+2*r),t.lineWidth=3,t.strokeStyle="yellow",t.stroke()},ED.RecordGrid=function(t,e){this.className="RecordGrid",this.values={sys:160,dia:80,pul:60,res:30,oxi:100},this.minutesPerCell=5,this.minutesLabelArray=[0,30],this.totalMinutes=180,this.numberCellsHorizontal=Math.round(this.totalMinutes/this.minutesPerCell)+2,this.numberCellsVertical=12,this.separationOfVerticalGridLines=t.doodlePlaneWidth/this.numberCellsHorizontal,this.index=0,this.firstCoordinate=-t.doodlePlaneWidth/2,this.startDate=new Date,this.gridStartDate=new Date,this.nowDate=new Date,this.setGridStartDate(this.startDate),this.savedParameterArray=["startDate"],this.parameterObjectTypeArray={startDate:"date",gridStartDate:"date"},ED.Doodle.call(this,t,e)},ED.RecordGrid.prototype=new ED.Doodle,ED.RecordGrid.prototype.constructor=ED.RecordGrid,ED.RecordGrid.superclass=ED.Doodle.prototype,ED.RecordGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.RecordGrid.prototype.draw=function(t){var e=this.drawing.context;ED.RecordGrid.superclass.draw.call(this,t),e.beginPath();var r=-this.drawing.doodlePlaneWidth/2,a=-this.drawing.doodlePlaneHeight/2,i=this.drawing.doodlePlaneWidth/this.numberCellsHorizontal,o=this.drawing.doodlePlaneHeight/this.numberCellsVertical;if(e.rect(r,a,this.drawing.doodlePlaneWidth,this.drawing.doodlePlaneHeight),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var s=0;this.numberCellsVertical>s;s++)e.moveTo(r,a+s*o),e.lineTo(r+this.drawing.doodlePlaneWidth,a+s*o);for(var n=0;this.numberCellsHorizontal>n;n++)e.moveTo(r+n*i,a),e.lineTo(r+n*i,a+this.drawing.doodlePlaneHeight);e.lineWidth=4,e.strokeStyle="rgba(200,200,200,1)",e.stroke();var l=this.nowDate-this.gridStartDate;this.timeLineX=this.firstCoordinate+this.drawing.doodlePlaneWidth/this.numberCellsHorizontal*l/(6e4*this.minutesPerCell),e.beginPath(),e.moveTo(this.timeLineX,a),e.lineTo(this.timeLineX,a+this.drawing.doodlePlaneHeight),e.lineWidth=4,e.strokeStyle="red",e.stroke();for(var n=1;this.numberCellsHorizontal>n;n++){dateOfGridLine=new Date(this.gridStartDate.getTime()+6e4*n*this.minutesPerCell);var h=dateOfGridLine.getHours(),d=dateOfGridLine.getMinutes();if(this.minutesLabelArray.indexOf(d)>=0){var c=""+h;2>c.length&&(c="0"+c);var p=""+d;2>p.length&&(p="0"+p);var D=c+":"+p;e.lineWidth=1,e.font="48px sans-serif",e.strokeStyle="gray",e.fillStyle="gray";var u=e.measureText(D).width;e.fillText(D,r+n*i-u/2,a+50)}}}return this.isClicked},ED.RecordGrid.prototype.getNextValues=function(t){for(var e=this.drawing.allDoodlesOfClass("RecordReading"),r=-2e3,a=0;e.length>a;a++)if(e[a].type==t){this.values[t]=e[a].value,r=e[a].originX;break}var i=this.getGridX();return i>r?{value:this.values[t],originX:i}:!1},ED.RecordGrid.prototype.setGridStartDate=function(t){var e=Math.round(t.getMinutes()/this.minutesPerCell)*this.minutesPerCell,r=Math.floor(t.getMinutes()/this.minutesPerCell)*this.minutesPerCell;this.gridStartDate=t,this.gridStartDate.setMinutes(r),e==r&&(this.gridStartDate=new Date(this.gridStartDate.getTime()-6e4*this.minutesPerCell)),this.gridStartDate.setSeconds(0)},ED.RecordGrid.prototype.getGridX=function(){var t=this.nowDate-this.gridStartDate;return this.index=Math.round(t/(6e4*this.minutesPerCell)),Math.round(this.firstCoordinate+this.index*this.separationOfVerticalGridLines)},ED.RecordReading=function(t,e){this.className="RecordReading",this.type="sys",this.value="0",this.savedParameterArray=["originX","originY","value","type"],ED.Doodle.call(this,t,e)},ED.RecordReading.prototype=new ED.Doodle,ED.RecordReading.prototype.constructor=ED.RecordReading,ED.RecordReading.superclass=ED.Doodle.prototype,ED.RecordReading.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.value={kind:"derived",type:"int",range:new ED.Range(0,240),animate:!1},this.parameterValidationArray.type={kind:"derived",type:"string",list:["sys","dia","pul","res","oxi"],animate:!1}},ED.RecordReading.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"originY":r.value=Math.round(240*(this.drawing.doodlePlaneHeight/2-e)/this.drawing.doodlePlaneHeight);break;case"value":r.originY=-(e*this.drawing.doodlePlaneHeight/240)+this.drawing.doodlePlaneHeight/2;break;case"originX":this.parameterValidationArray.originX.range.setMinAndMax(this.originX,this.originX)}return r},ED.RecordReading.prototype.draw=function(t){var e=this.drawing.context;ED.RecordReading.superclass.draw.call(this,t),e.beginPath();var r=56,a=30;switch(this.type){case"sys":e.rect(-r/2,-a,r,a);break;case"dia":e.rect(-r/2,0,r,a);break;case"pul":e.arc(0,0,a,0,2*Math.PI,!0);break;case"res":e.arc(0,0,a,0,2*Math.PI,!0);break;case"oxi":e.rect(-r/2,-a/2,r,a)}if(e.closePath(),e.strokeStyle="rgba(255,255,255,0)",e.fillStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),this.type){case"sys":e.moveTo(-r/2,-a),e.lineTo(0,0),e.lineTo(r/2,-a);break;case"dia":e.moveTo(-r/2,a),e.lineTo(0,0),e.lineTo(r/2,a);break;case"pul":e.arc(0,0,20,0,2*Math.PI,!0);break;case"res":e.arc(0,0,20,0,2*Math.PI,!0);break;case"oxi":e.rect(-r/2,-a/2,r,a)}e.lineWidth=8,e.lineJoin="round",e.lineCap="round",e.strokeStyle="gray",e.fillStyle=e.strokeStyle,e.stroke(),"pul"==this.type&&e.fill()}return this.isClicked},ED.RecordReading.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.font="64px sans-serif",t.strokeStyle="blue",t.fillStyle="blue",t.fillText(this.value,40,20)},null==ED||"object"!=typeof ED)var ED={};ED.Heart=function(t,e){this.className="Heart",ED.Doodle.call(this,t,e)},ED.Heart.prototype=new ED.Doodle,ED.Heart.prototype.constructor=ED.Heart,ED.Heart.superclass=ED.Doodle.prototype,ED.Heart.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Heart.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Heart.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Heart.prototype.draw=function(t){var e=this.drawing.context;ED.Heart.superclass.draw.call(this,t);var r=0,a=2*Math.PI;return e.beginPath(),e.arc(0,0,400,r,a,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-287,-51),e.bezierCurveTo(-344,53,-346,243,-116,209),e.bezierCurveTo(5,297,269,341,312,268),e.bezierCurveTo(387,141,319,-17,237,-59),e.bezierCurveTo(225,-133,141,-209,65,-215),e.bezierCurveTo(55,-209,43,-219,53,-193),e.bezierCurveTo(133,-185,201,-129,216,-46),e.bezierCurveTo(205,-23,167,11,187,25),e.bezierCurveTo(202,36,192,-37,235,-3),e.bezierCurveTo(291,41,333,227,295,207),e.bezierCurveTo(195,155,153,111,97,43),e.bezierCurveTo(74,15,177,62,181,43),e.bezierCurveTo(187,17,109,25,55,19),e.bezierCurveTo(31,-7,-172,-89,-173,-87),e.bezierCurveTo(-173,-84,-232,-117,-191,-73),e.bezierCurveTo(-115,-49,-61,-13,-37,-3),e.bezierCurveTo(-67,45,-14,171,3,165),e.bezierCurveTo(21,159,-53,45,15,23),e.bezierCurveTo(103,87,199,183,231,249),e.bezierCurveTo(199,297,-31,243,-81,199),e.bezierCurveTo(-53,175,-8,204,-13,187),e.bezierCurveTo(-17,171,-66,181,-105,185),e.bezierCurveTo(-331,209,-289,33,-273,-37),e.bezierCurveTo(-270,-47,-287,-51,-287,-51),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Heart.prototype.description=function(){return"Heart"},ED.Aorta=function(t,e){this.className="Aorta",ED.Doodle.call(this,t,e)},ED.Aorta.prototype=new ED.Doodle,ED.Aorta.prototype.constructor=ED.Aorta,ED.Aorta.superclass=ED.Doodle.prototype,ED.Aorta.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Aorta.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Aorta.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.5,this.originX=-352,this.originY=-416,this.apexX=-460,this.apexY=-460},ED.Aorta.prototype.draw=function(t){var e=this.drawing.context;ED.Aorta.superclass.draw.call(this,t);var r=0,a=2*Math.PI;return e.beginPath(),e.arc(0,0,400,r,a,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(216,-112),e.bezierCurveTo(216,-112,181,46,210,40),e.bezierCurveTo(239,33,282,-111,282,-111),e.moveTo(423,335),e.bezierCurveTo(423,335,453,57,313,31),e.bezierCurveTo(281,26,330,-100,330,-100),e.moveTo(-1,-25),e.bezierCurveTo(-1,-25,57,2,74,41),e.bezierCurveTo(82,61,93,79,116,78),e.bezierCurveTo(144,78,141,42,141,7),e.bezierCurveTo(141,-50,159,-97,159,-97),e.moveTo(198,582),e.bezierCurveTo(214,619,155,663,105,649),e.moveTo(-39,12),e.bezierCurveTo(-39,12,52,54,28,133),e.bezierCurveTo(28,133,-2,180,-16,200),e.bezierCurveTo(-49,246,-125,446,-28,595),e.lineTo(-1,640),e.bezierCurveTo(67,725,152,624,119,566),e.bezierCurveTo(151,598,255,603,251,514),e.bezierCurveTo(250,473,182,418,182,418),e.bezierCurveTo(118,352,162,209,254,211),e.bezierCurveTo(314,212,287,365,287,365),e.lineWidth=12,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Aorta.prototype.description=function(){return""},ED.RightCoronaryArtery=function(t,e){this.className="RightCoronaryArtery",ED.Doodle.call(this,t,e)},ED.RightCoronaryArtery.prototype=new ED.Doodle,ED.RightCoronaryArtery.prototype.constructor=ED.RightCoronaryArtery,ED.RightCoronaryArtery.superclass=ED.Doodle.prototype,ED.RightCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RightCoronaryArtery.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.RightCoronaryArtery.prototype.setParameterDefaults=function(){this.originX=24,this.originY=2,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.RightCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.RightCoronaryArtery.superclass.draw.call(this,t);var r=0,a=2*Math.PI;return e.beginPath(),e.arc(0,0,400,r,a,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.moveTo(-82,306),e.lineTo(-142,247),e.moveTo(-42,286),e.lineTo(-96,232),e.bezierCurveTo(-84,218,-36,250,-24,276),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RightCoronaryArtery.prototype.description=function(){return""},ED.LeftCoronaryArtery=function(t,e){this.className="LeftCoronaryArtery",ED.Doodle.call(this,t,e)},ED.LeftCoronaryArtery.prototype=new ED.Doodle,ED.LeftCoronaryArtery.prototype.constructor=ED.LeftCoronaryArtery,ED.LeftCoronaryArtery.superclass=ED.Doodle.prototype,ED.LeftCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.LeftCoronaryArtery.prototype.setPropertyDefaults=function(){this.isDeletable=!1},ED.LeftCoronaryArtery.prototype.setParameterDefaults=function(){this.originY=0,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-153,this.apexY=-84},ED.LeftCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.LeftCoronaryArtery.superclass.draw.call(this,t);var r=0,a=2*Math.PI;return e.beginPath(),e.arc(-100,-50,100,r,a,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(this.apexX,this.apexY),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(-4,98),e.bezierCurveTo(-10,136,-10,136,-22,156),e.moveTo(58,-10),e.bezierCurveTo(62,18,62,18,54,42),e.moveTo(102,10),e.bezierCurveTo(106,38,106,38,102,56),e.moveTo(222,90),e.bezierCurveTo(242,92,242,92,258,94),e.moveTo(258,142),e.bezierCurveTo(340,264,316,250,204,244),e.moveTo(258,142),e.bezierCurveTo(264,164,264,164,260,176),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),this.apexX>-200?e.bezierCurveTo(-152,-40,-146,-27,this.apexX-20,this.apexY):e.bezierCurveTo(-152,-40,-146,-27,this.apexX-8,this.apexY+15),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LeftCoronaryArtery.prototype.description=function(){return-200>this.apexX?"Anomalous insertion of left coronary artery":""},ED.AnomalousVessels=function(t,e){this.className="AnomalousVessels",ED.Doodle.call(this,t,e)},ED.AnomalousVessels.prototype=new ED.Doodle,ED.AnomalousVessels.prototype.constructor=ED.AnomalousVessels,ED.AnomalousVessels.superclass=ED.Doodle.prototype,ED.AnomalousVessels.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AnomalousVessels.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.AnomalousVessels.prototype.setParameterDefaults=function(){this.originY=-100,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.AnomalousVessels.prototype.draw=function(t){var e=this.drawing.context;ED.AnomalousVessels.superclass.draw.call(this,t);var r=0,a=2*Math.PI;return e.beginPath(),e.arc(0,0,400,r,a,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.lineTo(254,89),e.moveTo(-6,94),e.bezierCurveTo(-8,113,-11,132,-33,164),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.lineTo(-91,307),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(257,151),e.bezierCurveTo(257,151,278,176,288,190),e.bezierCurveTo(297,204,312,227,304,240),e.bezierCurveTo(291,264,223,250,200,250),e.moveTo(-14,278),e.bezierCurveTo(-14,278,-49,217,-98,230),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-210,-104),e.bezierCurveTo(-253,-100,-259,-73,-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),e.bezierCurveTo(-152,-40,-206,-27,-238,-56),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-210,-94),e.bezierCurveTo(-277,-82,-206,-47,-186,-48),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AnomalousVessels.prototype.description=function(){return"AnomalousVessels"},ED.Bypass=function(t,e){this.className="Bypass",ED.Doodle.call(this,t,e)},ED.Bypass.prototype=new ED.Doodle,ED.Bypass.prototype.constructor=ED.Bypass,ED.Bypass.superclass=ED.Doodle.prototype,ED.Bypass.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Bypass.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Bypass.prototype.setParameterDefaults=function(){var t=this.drawing.numberOfDoodlesOfClass(this.className);0==t?(this.apexX=40,this.apexY=-60):1==t?(this.apexX=-11,this.apexY=133):(this.apexX=-445,this.apexY=205)},ED.Bypass.prototype.draw=function(t){var e=this.drawing.context;ED.Bypass.superclass.draw.call(this,t),e.beginPath();var r=new ED.Point(-320,-200),a=new ED.Point(this.apexX,this.apexY),i=r.distanceTo(a),o=20,s=Math.PI/8;e.moveTo(r.x,r.y);var n=Math.atan((a.y-r.y)/(a.x-r.x));0>n&&(n=Math.PI/2+(Math.PI/2+n));var l=new ED.Point(0,0);l.setWithPolars(o,n);var h=new ED.Point(0,0);h.setWithPolars(i/2,n+Math.PI/2-s);var d=new ED.Point(l.x+a.x,l.y+a.y),c=new ED.Point(0,0);c.setWithPolars(o,n+Math.PI);var p=new ED.Point(c.x+a.x,c.y+a.y);return e.lineTo(r.x+l.x,r.y+l.y),e.bezierCurveTo(r.x+l.x+h.x,r.y+l.y+h.y,r.x+l.x+h.x,r.y+l.y+h.y,d.x,d.y),e.lineTo(a.x,a.y),e.lineTo(p.x,p.y),e.bezierCurveTo(r.x+c.x+h.x,r.y+c.y+h.y,r.x+c.x+h.x,r.y+c.y+h.y,r.x+c.x,r.y+c.y),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 000, 000, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.Bypass.prototype.description=function(){var t="";return t=this.apexX>0?"left coronary artery":this.apexX>-300?"circumflex artery":"right coronary artery","Bypass graft to "+t},ED.MetalStent=function(t,e){this.className="MetalStent",ED.Doodle.call(this,t,e)},ED.MetalStent.prototype=new ED.Doodle,ED.MetalStent.prototype.constructor=ED.MetalStent,ED.MetalStent.superclass=ED.Doodle.prototype,ED.MetalStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.MetalStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MetalStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.MetalStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.MetalStent.superclass.draw.call(this,t);var r=50,a=10,i=10;if(e.beginPath(),e.rect(-r,-a,2*r,2*a),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var o=0;10>o;o++)e.moveTo(-r+o*i,-a),e.lineTo(-r+o*i,+a);e.stroke()}var s=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MetalStent.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+t},ED.DrugStent=function(t,e){this.className="DrugStent",ED.Doodle.call(this,t,e)},ED.DrugStent.prototype=new ED.Doodle,ED.DrugStent.prototype.constructor=ED.DrugStent,ED.DrugStent.superclass=ED.Doodle.prototype,ED.DrugStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.DrugStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.DrugStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.DrugStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.DrugStent.superclass.draw.call(this,t);var r=50,a=10,i=20;if(e.beginPath(),e.rect(-r,-a,2*r,2*a),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var o=0;5>o;o++)e.moveTo(-r+o*i,-a),e.lineTo(-r+(o+1)*i,+a),e.moveTo(-r+(o+1)*i,-a),e.lineTo(-r+o*i,+a);e.stroke()}var s=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrugStent.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+t},ED.Stenosis=function(t,e){this.className="Stenosis",this.degree=0,this.type="Calcified",ED.Doodle.call(this,t,e)},ED.Stenosis.prototype=new ED.Doodle,ED.Stenosis.prototype.constructor=ED.Stenosis,ED.Stenosis.superclass=ED.Doodle.prototype,ED.Stenosis.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Stenosis.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-10,10),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0),this.parameterValidationArray.degree={kind:"derived",type:"int",range:new ED.Range(0,100),precision:0,animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Calcified","Non-calcified"],animate:!0}},ED.Stenosis.prototype.setParameterDefaults=function(){this.setParameterFromString("degree","0"),this.setParameterFromString("type","Calcified"),this.apexX=0,this.apexY=0,this.originX=-373,this.originY=323},ED.Stenosis.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexX":r.type=e>0?"Calcified":"Non-calcified";break;case"apexY":r.degree=e/-1;break;case"type":r.apexX="Calcified"==e?10:-10;break;case"degree":r.apexY=-1*e}return r},ED.Stenosis.prototype.draw=function(t){var e=this.drawing.context;return ED.Stenosis.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle="blue",e.fillStyle="rgba(155, 155, 0,"+this.apexY/-100+")",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&"Calcified"==this.type&&(e.beginPath(),e.arc(-10,-10,8,0,2*Math.PI,!1),e.moveTo(10,-10),e.arc(10,-10,8,0,2*Math.PI,!1),e.moveTo(10,10),e.arc(10,10,8,0,2*Math.PI,!1),e.moveTo(-10,10),e.arc(-10,10,8,0,2*Math.PI,!1),e.fillStyle="white",e.fill()),point=new ED.Point(this.apexX,this.apexY),this.handleArray[4].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Stenosis.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery",""+this.degree+"% "+this.type+" stenosis in the "+t},ED.Groin=function(t,e){this.className="Groin",ED.Doodle.call(this,t,e)},ED.Groin.prototype=new ED.Doodle,ED.Groin.prototype.constructor=ED.Groin,ED.Groin.superclass=ED.Doodle.prototype,ED.Groin.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Groin.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Groin.prototype.setParameterDefaults=function(){},ED.Groin.prototype.draw=function(t){var e=this.drawing.context;return ED.Groin.superclass.draw.call(this,t),2*Math.PI,e.beginPath(),e.moveTo(12,49),e.bezierCurveTo(37,49,68,24,68,24),e.bezierCurveTo(73,42,136,318,136,318),e.lineTo(460,318),e.bezierCurveTo(460,318,468,191,468,159),e.bezierCurveTo(468,127,451,-48,451,-67),e.bezierCurveTo(451,-87,444,-188,444,-215),e.bezierCurveTo(444,-242,407,-402,407,-402),e.lineTo(-380,-402),e.bezierCurveTo(-380,-402,-417,-242,-417,-215),e.bezierCurveTo(-417,-189,-423,-87,-423,-67),e.bezierCurveTo(-423,-48,-440,127,-440,159),e.bezierCurveTo(-440,191,-432,318,-432,318),e.lineTo(-112,318),e.lineTo(-40,24),e.bezierCurveTo(-27,39,-10,49,15,49),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 175, 175, 0.5)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-228,-189),e.lineTo(-158,-155),e.bezierCurveTo(-158,-155,-109,-113,-88,-75),e.bezierCurveTo(-74,-51,-65,-5,-40,24),e.moveTo(255,-189),e.lineTo(186,-155),e.bezierCurveTo(186,-155,136,-113,115,-75),e.bezierCurveTo(102,-51,92,-5,68,23),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked
},ED.Groin.prototype.description=function(){return"Groin"},ED.Haematoma=function(t,e){this.className="Haematoma",ED.Doodle.call(this,t,e)},ED.Haematoma.prototype=new ED.Doodle,ED.Haematoma.prototype.constructor=ED.Haematoma,ED.Haematoma.superclass=ED.Doodle.prototype,ED.Haematoma.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Haematoma.prototype.setParameterDefaults=function(){this.originX=-150},ED.Haematoma.prototype.draw=function(t){var e=this.drawing.context;ED.Haematoma.superclass.draw.call(this,t);var r=30;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Haematoma.prototype.groupDescription=function(){return"Haematoma"},ED.Bruising=function(t,e){this.className="Bruising",ED.Doodle.call(this,t,e)},ED.Bruising.prototype=new ED.Doodle,ED.Bruising.prototype.constructor=ED.Bruising,ED.Bruising.superclass=ED.Doodle.prototype,ED.Bruising.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Bruising.prototype.setParameterDefaults=function(){this.originX=-190,this.originY=100,this.scaleY=2},ED.Bruising.prototype.setPropertyDefaults=function(){this.isSqueezable=!0},ED.Bruising.prototype.draw=function(t){var e=this.drawing.context;ED.Bruising.superclass.draw.call(this,t);var r=100;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(127, 0, 127, 0.5)",e.fillStyle="rgba(127, 0, 127, 0.5)",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruising.prototype.description=function(){return"Bruising"},ED.Bruit=function(t,e){this.className="Bruit",ED.Doodle.call(this,t,e)},ED.Bruit.prototype=new ED.Doodle,ED.Bruit.prototype.constructor=ED.Bruit,ED.Bruit.superclass=ED.Doodle.prototype,ED.Bruit.prototype.setHandles=function(){},ED.Bruit.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.Bruit.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.originX=-150,this.originY=-62},ED.Bruit.prototype.draw=function(t){var e=this.drawing.context;ED.Bruit.superclass.draw.call(this,t);var r=100;e.beginPath(),e.arc(0,-50,r,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(155, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(0,-80),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruit.prototype.description=function(){return"Bruit"},ED.Crepitations=function(t,e){this.className="Crepitations",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Crepitations.prototype=new ED.Doodle,ED.Crepitations.prototype.constructor=ED.Crepitations,ED.Crepitations.superclass=ED.Doodle.prototype,ED.Crepitations.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Crepitations.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,200),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.Crepitations.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/4,this.apexX=50,this.apexY=0,this.setOriginWithDisplacements(-150,300)},ED.Crepitations.prototype.draw=function(t){var e=this.drawing.context;ED.Crepitations.superclass.draw.call(this,t);var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var a=30;e.moveTo(-r,0),e.lineTo(r,0);for(var i=-1;2>i;i+=2)for(var o=a;r>o;o+=a){var s=this.xForY(r,o);e.moveTo(-s,i*o),e.lineTo(s,i*o)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Crepitations.prototype.description=function(){var t=this.originX>0?" left lung":" right lung",e=this.originY>0?" lower lobe of":" upper lobe of";return"crepitations"+e+t},ED.Effusion=function(t,e){this.className="Effusion",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Effusion.prototype=new ED.Doodle,ED.Effusion.prototype.constructor=ED.Effusion,ED.Effusion.superclass=ED.Doodle.prototype,ED.Effusion.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Effusion.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Effusion.prototype.setParameterDefaults=function(){this.apexX=-231,this.apexY=136},ED.Effusion.prototype.draw=function(t){var e=this.drawing.context;return ED.Effusion.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(-400+(-136+this.apexY)*-.3,this.apexY),e.lineTo(-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.lineTo(-44,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=4,e.fillStyle="yellow",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Effusion.prototype.description=function(){return"pleural effusion in right lung"},ED.Lungs=function(t,e){this.className="Lungs",ED.Doodle.call(this,t,e)},ED.Lungs.prototype=new ED.Doodle,ED.Lungs.prototype.constructor=ED.Lungs,ED.Lungs.superclass=ED.Doodle.prototype,ED.Lungs.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1},ED.Lungs.prototype.draw=function(t){var e=this.drawing.context;return ED.Lungs.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-147,-281),e.bezierCurveTo(-224,-279,-414,29,-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.bezierCurveTo(-6,231,-71,-284,-147,-281),e.moveTo(147,-281),e.bezierCurveTo(224,-279,414,29,426,289),e.bezierCurveTo(334,226,219,196,79,236),e.bezierCurveTo(6,231,71,-284,147,-281),e.closePath(),e.lineWidth=4,e.fillStyle="white",e.strokeStyle="gray",this.drawBoundary(t),this.isClicked},ED.Lungs.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.Wheeze=function(t,e){this.className="Wheeze",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Wheeze.prototype=new ED.Doodle,ED.Wheeze.prototype.constructor=ED.Wheeze,ED.Wheeze.superclass=ED.Doodle.prototype,ED.Wheeze.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.setOriginWithDisplacements(-200,100)},ED.Wheeze.prototype.draw=function(t){var e=this.drawing.context;ED.Wheeze.superclass.draw.call(this,t);var r=100;return e.beginPath(),e.arc(0,-50,r,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(66,-150),e.lineTo(66,-50),e.stroke(),e.beginPath(),e.arc(50,-50,20,0,2*Math.PI,!1),e.fill(),e.closePath(),e.fillStyle="gray",e.fill()),this.isClicked},ED.Wheeze.prototype.description=function(){var t=this.originX>0?" left lung":" right lung",e=this.originY>0?" lower lobe of":" upper lobe of";return"wheeze"+e+t},ED.ACIOL=function(t,e){this.className="ACIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e),this.scaleX=.8,this.scaleY=.8},ED.ACIOL.prototype=new ED.Doodle,ED.ACIOL.prototype.constructor=ED.ACIOL,ED.ACIOL.superclass=ED.Doodle.prototype,ED.ACIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ACIOL.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isUnique=!0},ED.ACIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ACIOL.superclass.draw.call(this,t),e.beginPath();var r=240;e.arc(0,0,r,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,170,-210,160,-230),e.bezierCurveTo(150,-250,100,-280,50,-290),e.bezierCurveTo(0,-300,-220,-330,-230,-340),e.bezierCurveTo(-250,-360,-220,-420,-200,-430),e.bezierCurveTo(-180,-440,-180,-440,-150,-450),e.bezierCurveTo(-120,-460,-130,-430,-120,-420),e.bezierCurveTo(-110,-410,110,-410,120,-420),e.bezierCurveTo(130,-430,120,-460,150,-450),e.bezierCurveTo(180,-440,180,-440,200,-430),e.bezierCurveTo(220,-420,180,-400,150,-390),e.bezierCurveTo(120,-380,-120,-380,-150,-390),e.bezierCurveTo(-180,-400,-190,-370,-170,-360),e.bezierCurveTo(-150,-350,20,-330,70,-320),e.bezierCurveTo(120,-310,190,-280,210,-250),e.bezierCurveTo(230,-220,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-170,210,-160,230),e.bezierCurveTo(-150,250,-100,280,-50,290),e.bezierCurveTo(0,300,220,330,230,340),e.bezierCurveTo(250,360,220,420,200,430),e.bezierCurveTo(180,440,180,440,150,450),e.bezierCurveTo(120,460,130,430,120,420),e.bezierCurveTo(110,410,-110,410,-120,420),e.bezierCurveTo(-130,430,-120,460,-150,450),e.bezierCurveTo(-180,440,-180,440,-200,430),e.bezierCurveTo(-220,420,-180,400,-150,390),e.bezierCurveTo(-120,380,120,380,150,390),e.bezierCurveTo(180,400,190,370,170,360),e.bezierCurveTo(150,350,-20,330,-70,320),e.bezierCurveTo(-120,310,-190,280,-210,250),e.bezierCurveTo(-230,220,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ACIOL.prototype.description=function(){var t="Anterior chamber IOL",e=40,r="";return-e>this.originY&&(r.length>0&&(r+=" and"),r+=" superiorly"),this.originY>e&&(r.length>0&&(r+=" and"),r+=" inferiorly"),-e>this.originX&&(r.length>0&&(r+=" and"),r+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>e&&(r.length>0&&(r+=" and"),r+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),r.length>0&&(t+=" displaced"+r),t},ED.Ahmed=function(t,e){this.className="Ahmed",this.platePosition="STQ",this.savedParameterArray=["rotation","apexY"],ED.Doodle.call(this,t,e)},ED.Ahmed.prototype=new ED.Doodle,ED.Ahmed.prototype.constructor=ED.Ahmed,ED.Ahmed.superclass=ED.Doodle.prototype,ED.Ahmed.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Ahmed.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var t=Math.PI/4;this.anglesArray=[t,3*t,5*t,7*t]},ED.Ahmed.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ")},ED.Ahmed.prototype.dependentParameterValues=function(t,e){var r=[],a=this.drawing.eye==ED.eye.Right,i=Math.PI/4;switch(t){case"rotation":r.platePosition=this.rotation>0&&2*i>=this.rotation?a?"SNQ":"STQ":this.rotation>2*i&&4*i>=this.rotation?a?"INQ":"ITQ":this.rotation>4*i&&6*i>=this.rotation?a?"ITQ":"INQ":a?"STQ":"SNQ";break;case"platePosition":switch(e){case"STQ":r.rotation=a?7*i:i;break;case"SNQ":r.rotation=a?i:7*i;break;case"INQ":r.rotation=a?3*i:5*i;break;case"ITQ":r.rotation=a?5*i:3*i}}return r},ED.Ahmed.prototype.draw=function(t){var e=this.drawing.context;ED.Ahmed.superclass.draw.call(this,t),e.beginPath();var r=.41666667,a=-740;return e.moveTo(-300*r,0*r+a),e.bezierCurveTo(-300*r,-100*r+a,-200*r,-400*r+a,0*r,-400*r+a),e.bezierCurveTo(200*r,-400*r+a,300*r,-100*r+a,300*r,0*r+a),e.bezierCurveTo(300*r,140*r+a,200*r,250*r+a,0*r,250*r+a),e.bezierCurveTo(-200*r,250*r+a,-300*r,140*r+a,-300*r,0*r+a),e.moveTo(-160*r,230*r+a),e.lineTo(-120*r,290*r+a),e.lineTo(120*r,290*r+a),e.lineTo(160*r,230*r+a),e.bezierCurveTo(120*r,250*r+a,-120*r,250*r+a,-160*r,230*r+a),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawSpot(e,0*r,-230*r+a,20*r,"white"),this.drawSpot(e,-180*r,-180*r+a,20*r,"white"),this.drawSpot(e,180*r,-180*r+a,20*r,"white"),e.beginPath(),e.moveTo(-100*r,230*r+a),e.lineTo(100*r,230*r+a),e.lineTo(200*r,0*r+a),e.lineTo(40*r,0*r+a),e.arcTo(0,-540*r+a,-40*r,0*r+a,15),e.lineTo(-40*r,0*r+a),e.lineTo(-200*r,0*r+a),e.closePath(),e.fillStyle="rgba(250,250,250,0.7)",e.fill(),e.moveTo(-80*r,-40*r+a),e.lineTo(-160*r,-280*r+a),e.moveTo(80*r,-40*r+a),e.lineTo(160*r,-280*r+a),e.lineWidth=8,e.strokeStyle="rgba(250,250,250,0.7)",e.stroke(),e.beginPath(),e.moveTo(-30*r,250*r+a),e.lineTo(-30*r,290*r+a),e.moveTo(30*r,250*r+a),e.lineTo(30*r,290*r+a),e.moveTo(-20*r,290*r+a),e.lineTo(-20*r,this.apexY),e.lineTo(20*r,this.apexY),e.lineTo(20*r,290*r+a),e.strokeStyle="rgba(150,150,150,0.5)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Ahmed.prototype.description=function(){var t={STQ:"superotemporal",SNQ:"superonasal",INQ:"inferonasal",ITQ:"inferotemporal"};return"Ahmed tube in the "+t[this.platePosition]+" quadrant"},ED.AngleGradeEast=function(t,e){this.className="AngleGradeEast",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=Math.PI/2},ED.AngleGradeEast.prototype=new ED.Doodle,ED.AngleGradeEast.prototype.constructor=ED.AngleGradeEast,ED.AngleGradeEast.superclass=ED.Doodle.prototype,ED.AngleGradeEast.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeEast.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeEast.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeEast.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":var a="4";-e>=this.riro&&(a="3"),-e>=this.rcbo&&(a="2"),-e>=this.rtmo&&(a="1"),-e>=this.rsli&&(a="0"),r.grade=a,r.seen=-e>=this.rtmo?"No":"Yes";break;case"grade":var a="";switch(e){case"0":a=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":a=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":a=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":a=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":a=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}r.apexY=a;break;case"seen":var a="";switch(e){case"No":a=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":a=-this.apexY<this.rtmo?this.apexY:-this.riri}r.apexY=a}return r},ED.AngleGradeEast.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeEast.superclass.draw.call(this,t);var r=this.arc/2,a=-Math.PI/2+r,i=-Math.PI/2-r;return e.beginPath(),e.arc(0,0,-this.apexY,a,i,!0),e.arc(0,0,this.rpu,i,a,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeNorth=function(t,e){this.className="AngleGradeNorth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=0},ED.AngleGradeNorth.prototype=new ED.Doodle,ED.AngleGradeNorth.prototype.constructor=ED.AngleGradeNorth,ED.AngleGradeNorth.superclass=ED.Doodle.prototype,ED.AngleGradeNorth.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeNorth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeNorth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeNorth.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":var a="4";-e>=this.riro&&(a="3"),-e>=this.rcbo&&(a="2"),-e>=this.rtmo&&(a="1"),-e>=this.rsli&&(a="0"),r.grade=a,r.seen=-e>=this.rtmo?"No":"Yes";break;case"grade":var a="";switch(e){case"0":a=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":a=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":a=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":a=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":a=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}r.apexY=a;break;case"seen":var a="";switch(e){case"No":a=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":a=-this.apexY<this.rtmo?this.apexY:-this.riri}r.apexY=a}return r},ED.AngleGradeNorth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeNorth.superclass.draw.call(this,t);var r=this.arc/2,a=-Math.PI/2+r,i=-Math.PI/2-r;return e.beginPath(),e.arc(0,0,-this.apexY,a,i,!0),e.arc(0,0,this.rpu,i,a,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeSouth=function(t,e){this.className="AngleGradeSouth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=Math.PI},ED.AngleGradeSouth.prototype=new ED.Doodle,ED.AngleGradeSouth.prototype.constructor=ED.AngleGradeSouth,ED.AngleGradeSouth.superclass=ED.Doodle.prototype,ED.AngleGradeSouth.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeSouth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeSouth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeSouth.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":var a="4";-e>=this.riro&&(a="3"),-e>=this.rcbo&&(a="2"),-e>=this.rtmo&&(a="1"),-e>=this.rsli&&(a="0"),r.grade=a,r.seen=-e>=this.rtmo?"No":"Yes";break;case"grade":var a="";switch(e){case"0":a=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":a=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":a=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":a=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":a=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}r.apexY=a;break;case"seen":var a="";switch(e){case"No":a=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":a=-this.apexY<this.rtmo?this.apexY:-this.riri}r.apexY=a}return r},ED.AngleGradeSouth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeSouth.superclass.draw.call(this,t);var r=this.arc/2,a=-Math.PI/2+r,i=-Math.PI/2-r;return e.beginPath(),e.arc(0,0,-this.apexY,a,i,!0),e.arc(0,0,this.rpu,i,a,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeWest=function(t,e){this.className="AngleGradeWest",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=3*Math.PI/2},ED.AngleGradeWest.prototype=new ED.Doodle,ED.AngleGradeWest.prototype.constructor=ED.AngleGradeWest,ED.AngleGradeWest.superclass=ED.Doodle.prototype,ED.AngleGradeWest.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeWest.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeWest.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeWest.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":var a="4";-e>=this.riro&&(a="3"),-e>=this.rcbo&&(a="2"),-e>=this.rtmo&&(a="1"),-e>=this.rsli&&(a="0"),r.grade=a,r.seen=-e>=this.rtmo?"No":"Yes";break;case"grade":var a="";switch(e){case"0":a=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":a=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":a=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":a=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":a=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}r.apexY=a;break;case"seen":var a="";switch(e){case"No":a=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":a=-this.apexY<this.rtmo?this.apexY:-this.riri}r.apexY=a}return r},ED.AngleGradeWest.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeWest.superclass.draw.call(this,t);var r=this.arc/2,a=-Math.PI/2+r,i=-Math.PI/2-r;return e.beginPath(),e.arc(0,0,-this.apexY,a,i,!0),e.arc(0,0,this.rpu,i,a,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV=function(t,e){this.className="AngleNV",this.rtmo=404,this.rtmi=304,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.AngleNV.prototype=new ED.Doodle,ED.AngleNV.prototype.constructor=ED.AngleNV,ED.AngleNV.superclass=ED.Doodle.prototype,ED.AngleNV.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleNV.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleNV.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleNV.prototype.draw=function(t){var e=this.drawing.context;ED.AngleNV.superclass.draw.call(this,t);var r=this.rtmo;this.rir=this.rtmi;var a=this.rir+(r-this.rir)/2,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=a*Math.sin(i),l=-a*Math.cos(i),h=-a*Math.sin(i),d=l;e.beginPath(),e.arc(0,0,this.rir,o,s,!0),e.arc(0,0,r,s,o,!1),e.closePath();var c=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return e.fillStyle=c,e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Angle new vessels over "+(""+t)+" degrees"},ED.AngleRecession=function(t,e){this.className="AngleRecession",this.riri=176,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.AngleRecession.prototype=new ED.Doodle,ED.AngleRecession.prototype.constructor=ED.AngleRecession,ED.AngleRecession.superclass=ED.Doodle.prototype,ED.AngleRecession.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleRecession.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleRecession.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleRecession.prototype.draw=function(t){var e=this.drawing.context;ED.AngleRecession.superclass.draw.call(this,t);var r=this.riri-30;this.rir=this.riri,this.rir+(r-this.rir)/2;var a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=-Math.PI/2+a-Math.PI/24,n=-Math.PI/2-a+Math.PI/24,l=this.rir*Math.sin(a),h=-this.rir*Math.cos(a),d=-this.rir*Math.sin(a),c=h;return e.beginPath(),e.arc(0,0,this.rir,i,o,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.fillStyle="rgba(255, 255, 200, 1.0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleRecession.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Angle recession over "+(""+t)+" degrees"},ED.AntPVR=function(t,e){this.className="AntPVR",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.AntPVR.prototype=new ED.Doodle,ED.AntPVR.prototype.constructor=ED.AntPVR,ED.AntPVR.superclass=ED.Doodle.prototype,ED.AntPVR.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntPVR.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,4),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,4),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.AntPVR.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-400,this.setRotationWithDisplacements(180,120)},ED.AntPVR.prototype.draw=function(t){var e=this.drawing.context;ED.AntPVR.superclass.draw.call(this,t);var r=476,a=-this.apexY,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4;var p=e.createPattern(this.drawing.imageArray.AntPVRPattern,"repeat");return e.fillStyle=p,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntPVR.prototype.snomedCode=function(){return 232017001},ED.AntPVR.prototype.diagnosticHierarchy=function(){return 2},ED.AntSeg=function(t,e){this.className="AntSeg",this.pupilSize="Large",this.pxe=!1,this.coloboma=!1,this.colour="Blue",this.ectropion=!1,this.savedParameterArray=["apexY","pxe","coloboma","colour","ectropion"],this.controlParameterArray={pxe:"PXE",coloboma:"Coloboma",colour:"Colour",ectropion:"Ectropion uveae"},ED.Doodle.call(this,t,e)},ED.AntSeg.prototype=new ED.Doodle,ED.AntSeg.prototype.constructor=ED.AntSeg,ED.AntSeg.superclass=ED.Doodle.prototype,ED.AntSeg.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSeg.prototype.setPropertyDefaults=function(){this.version=1.1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0},this.parameterValidationArray.pxe={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.coloboma={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.colour={kind:"derived",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1},this.parameterValidationArray.ectropion={kind:"derived",type:"bool",display:!0}
},ED.AntSeg.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.setParameterFromString("pxe","false")},ED.AntSeg.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.pupilSize=-200>e?"Large":-100>e?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":-200>this.apexY?returnValue=this.apexY:r.apexY=-260;break;case"Medium":this.apexY>=-200&&-100>this.apexY?returnValue=this.apexY:r.apexY=-200;break;case"Small":this.apexY>=-100?returnValue=this.apexY:r.apexY=-100}break;case"coloboma":this.isRotatable="true"==e?!0:!1}return r},ED.AntSeg.prototype.draw=function(t){var e=this.drawing.context;ED.AntSeg.superclass.draw.call(this,t);var r=380,a=-this.apexY,i=0,o=2*Math.PI;if(e.beginPath(),e.arc(0,0,r,i,o,!0),this.coloboma){var s=280*(Math.PI/3)/a,n=Math.PI/6,l=20,h=new ED.Point(0,0);h.setWithPolars(a,Math.PI+s/2);var d=new ED.Point(0,0);d.setWithPolars(r-l,Math.PI+n/2),e.moveTo(-d.x,d.y),e.arc(0,0,r-l,Math.PI/2-n/2,Math.PI/2+n/2,!1),e.arc(0,0,a,Math.PI/2+s/2,Math.PI/2-s/2,!1),e.lineTo(-d.x,d.y)}else e.moveTo(a,0),e.arc(0,0,a,o,i,!1);switch(e.lineWidth=4,e.strokeStyle="gray",this.colour){case"Blue":e.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":e.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":e.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":e.fillStyle="rgba(114, 172, 62, 0.5)"}if(this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.pxe){e.lineWidth=8,e.strokeStyle="darkgray";var c,p=.8*a,D=1.05*a,u=36,y=2*Math.PI/u;for(c=0;u>c;c++)e.beginPath(),e.arc(0,0,p,c*y,c*y+y/2,!1),e.stroke(),e.beginPath(),e.arc(0,0,D,c*y,c*y+y/2,!1),e.stroke()}this.ectropion&&(e.beginPath(),this.coloboma?e.arc(0,0,a,Math.PI/2-s/2,Math.PI/2+s/2,!0):e.arc(0,0,a+16,i,o,!0),e.lineWidth=32,e.lineCap="round",e.strokeStyle="brown",e.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSeg.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.AntSegCrossSection=function(t,e){this.className="AntSegCrossSection",this.pupilSize="Large",this.savedParameterArray=["apexY","apexX"],ED.Doodle.call(this,t,e),this.originX=44},ED.AntSegCrossSection.prototype=new ED.Doodle,ED.AntSegCrossSection.prototype.constructor=ED.AntSegCrossSection,ED.AntSegCrossSection.superclass=ED.Doodle.prototype,ED.AntSegCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSegCrossSection.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0}},ED.AntSegCrossSection.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.apexX=24},ED.AntSegCrossSection.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":if(this.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(this.apexY+280),32-72/220*(this.apexY+280)),this.drawing.isActive)var a=this.parameterValidationArray.apexX.range.constrain(this.apexX);else var a=this.parameterValidationArray.apexX.range.max;this.setSimpleParameter("apexX",a),r.pupilSize=-200>e?"Large":-100>e?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":r.apexY=-260;break;case"Medium":r.apexY=-200;break;case"Small":r.apexY=-100}}return r},ED.AntSegCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.AntSegCrossSection.superclass.draw.call(this,t);var r=this.apexX;e.beginPath(),e.moveTo(60,480),e.lineTo(140,480),e.lineTo(140,380),e.bezierCurveTo(120,340,120,340,100,380),e.bezierCurveTo(80,340,80,340,60,380);var a=.15*Math.abs(r);return e.bezierCurveTo(40,460,r+60+a,-this.apexY,r,-this.apexY),e.bezierCurveTo(r-60-a,-this.apexY,-21,317,0,380),e.moveTo(60,-480),e.lineTo(140,-480),e.lineTo(140,-380),e.bezierCurveTo(120,-340,120,-340,100,-380),e.bezierCurveTo(80,-340,80,-340,60,-380),e.bezierCurveTo(40,-460,r+60+a,this.apexY,r,this.apexY),e.bezierCurveTo(r-60-a,this.apexY,-21,-317,0,-380),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 160, 40, 1)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSynech=function(t,e){this.className="AntSynech",this.rtmi=304,this.riri=176,this.savedParameterArray=["arc","rotation","apexY"],ED.Doodle.call(this,t,e)},ED.AntSynech.prototype=new ED.Doodle,ED.AntSynech.prototype.constructor=ED.AntSynech,ED.AntSynech.superclass=ED.Doodle.prototype,ED.AntSynech.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSynech.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.rcbo),this.parameterValidationArray.arc.range.setMinAndMax(30*Math.PI/180,2*Math.PI)},ED.AntSynech.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.apexY=-this.rtmi,this.setRotationWithDisplacements(0,-60)},ED.AntSynech.prototype.draw=function(t){var e=this.drawing.context;ED.AntSynech.superclass.draw.call(this,t);var r=-this.apexY;this.rir=this.riri,this.rir+(r-this.rir)/2;var a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=-Math.PI/2+a-Math.PI/14,n=-Math.PI/2-a+Math.PI/14,l=this.rir*Math.sin(a),h=-this.rir*Math.cos(a),d=-this.rir*Math.sin(a),c=h;return e.beginPath(),e.arc(0,0,this.rir,i,o,!0),e.arc(0,0,r,n,s,!1),e.closePath(),e.fillStyle="rgba(100, 200, 250, 1.0)",e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSynech.prototype.groupDescription=function(){var t=this.drawing.totalDegreesExtent(this.className);return"Anterior synechiae over "+(""+t)+" degrees"},ED.AnteriorCapsulotomy=function(t,e){this.className="AnteriorCapsulotomy",ED.Doodle.call(this,t,e)},ED.AnteriorCapsulotomy.prototype=new ED.Doodle,ED.AnteriorCapsulotomy.prototype.constructor=ED.AnteriorCapsulotomy,ED.AnteriorCapsulotomy.superclass=ED.Doodle.prototype,ED.AnteriorCapsulotomy.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500)},ED.AnteriorCapsulotomy.prototype.setParameterDefaults=function(){},ED.AnteriorCapsulotomy.prototype.draw=function(t){var e=this.drawing.context;ED.AnteriorCapsulotomy.superclass.draw.call(this,t);var r=240;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var a=r-60;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ArcuateScotoma=function(t,e){this.className="ArcuateScotoma",this.savedParameterArray=["scaleX","scaleY","apexY","arc"],ED.Doodle.call(this,t,e)},ED.ArcuateScotoma.prototype=new ED.Doodle,ED.ArcuateScotoma.prototype.constructor=ED.ArcuateScotoma,ED.ArcuateScotoma.superclass=ED.Doodle.prototype,ED.ArcuateScotoma.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ArcuateScotoma.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(140,300),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.ArcuateScotoma.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexX=200,this.drawing.eye==ED.eye.Left&&(this.scaleX=-1*this.scaleX);var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.scaleY=-1*t.scaleY)},ED.ArcuateScotoma.prototype.draw=function(t){var e=this.drawing.context;ED.ArcuateScotoma.superclass.draw.call(this,t);var r=-100,a=100,i=-140,o=(a-r)/2,s=r+o;return e.beginPath(),e.arc(s,0,o,-Math.PI,0,!1),e.lineTo(this.apexX,0),o=(this.apexX-i)/2,s=i+o,e.arc(s,0,o,0,-Math.PI,!0),e.closePath(),e.lineWidth=6,e.fillStyle="gray",e.strokeStyle="black",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ArcuateScotoma.prototype.description=function(){return this.scaleY>0?"Superior":"Inferior arcuate scotoma"},ED.Baerveldt=function(t,e){this.className="Baerveldt",this.platePosition="STQ",this.savedParameterArray=["rotation","apexY"],ED.Doodle.call(this,t,e)},ED.Baerveldt.prototype=new ED.Doodle,ED.Baerveldt.prototype.constructor=ED.Baerveldt,ED.Baerveldt.superclass=ED.Doodle.prototype,ED.Baerveldt.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Baerveldt.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var t=Math.PI/4;this.anglesArray=[t,3*t,5*t,7*t]},ED.Baerveldt.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ")},ED.Baerveldt.prototype.dependentParameterValues=function(t,e){var r=[],a=this.drawing.eye==ED.eye.Right,i=Math.PI/4;switch(t){case"rotation":r.platePosition=this.rotation>0&&2*i>=this.rotation?a?"SNQ":"STQ":this.rotation>2*i&&4*i>=this.rotation?a?"INQ":"ITQ":this.rotation>4*i&&6*i>=this.rotation?a?"ITQ":"INQ":a?"STQ":"SNQ";break;case"platePosition":switch(e){case"STQ":r.rotation=a?7*i:i;break;case"SNQ":r.rotation=a?i:7*i;break;case"INQ":r.rotation=a?3*i:5*i;break;case"ITQ":r.rotation=a?5*i:3*i}}return r},ED.Baerveldt.prototype.draw=function(t){var e=this.drawing.context;ED.Baerveldt.superclass.draw.call(this,t),e.beginPath();var r=.41666667,a=-740;return e.moveTo(-400*r,0*r+a),e.bezierCurveTo(-400*r,-100*r+a,-300*r,-200*r+a,-200*r,-200*r+a),e.bezierCurveTo(-100*r,-200*r+a,-58*r,-136*r+a,0*r,-135*r+a),e.bezierCurveTo(54*r,-136*r+a,100*r,-200*r+a,200*r,-200*r+a),e.bezierCurveTo(300*r,-200*r+a,400*r,-100*r+a,400*r,0*r+a),e.bezierCurveTo(400*r,140*r+a,200*r,250*r+a,0*r,250*r+a),e.bezierCurveTo(-200*r,250*r+a,-400*r,140*r+a,-400*r,0*r+a),e.moveTo(-160*r,230*r+a),e.lineTo(-120*r,290*r+a),e.lineTo(120*r,290*r+a),e.lineTo(160*r,230*r+a),e.bezierCurveTo(120*r,250*r+a,-120*r,250*r+a,-160*r,230*r+a),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawSpot(e,-240*r,-40*r+a,10,"rgba(150,150,150,0.5)"),this.drawSpot(e,-120*r,40*r+a,10,"rgba(150,150,150,0.5)"),this.drawSpot(e,120*r,40*r+a,10,"rgba(150,150,150,0.5)"),this.drawSpot(e,240*r,-40*r+a,10,"rgba(150,150,150,0.5)"),this.drawSpot(e,-100*r,260*r+a,5,"rgba(150,150,150,0.5)"),this.drawSpot(e,100*r,260*r+a,5,"rgba(150,150,150,0.5)"),e.beginPath(),e.moveTo(-30*r,250*r+a),e.lineTo(-30*r,290*r+a),e.moveTo(30*r,250*r+a),e.lineTo(30*r,290*r+a),e.moveTo(-20*r,290*r+a),e.lineTo(-20*r,this.apexY),e.lineTo(20*r,this.apexY),e.lineTo(20*r,290*r+a),e.strokeStyle="rgba(150,150,150,0.5)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Baerveldt.prototype.description=function(){var t={STQ:"superotemporal",SNQ:"superonasal",INQ:"inferonasal",ITQ:"inferotemporal"};return"Baerveldt tube in the "+t[this.platePosition]+" quadrant"},ED.BiopsySite=function(t,e){this.className="BiopsySite",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.BiopsySite.prototype=new ED.Doodle,ED.BiopsySite.prototype.constructor=ED.BiopsySite,ED.BiopsySite.superclass=ED.Doodle.prototype,ED.BiopsySite.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.BiopsySite.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.BiopsySite.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(300,-80)},ED.BiopsySite.prototype.draw=function(t){var e=this.drawing.context;ED.BiopsySite.superclass.draw.call(this,t);var r=30;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2*r/3,e.fillStyle="yellow",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw;var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BiopsySite.prototype.description=function(){return"Biopsy site in the "+this.quadrant()},ED.Bleb=function(t,e){this.className="Bleb",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.Bleb.prototype=new ED.Doodle,ED.Bleb.prototype.constructor=ED.Bleb,ED.Bleb.superclass=ED.Doodle.prototype,ED.Bleb.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.Bleb.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.Bleb.prototype.draw=function(t){var e=this.drawing.context;ED.Bleb.superclass.draw.call(this,t);var r=384;e.beginPath();var a=Math.PI/12;return e.arc(0,0,r,-a-Math.PI/2,a-Math.PI/2,!1),e.lineTo(r/4,1.25*-r),e.lineTo(-r/4,1.25*-r),e.closePath(),e.fillStyle="rgba(240,240,240,0.9)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-40,-r),e.lineTo(-40,1.15*-r),e.lineTo(40,1.15*-r),e.lineTo(40,-r),e.stroke()),this.isClicked},ED.Bleb.prototype.description=function(){return"Trabeculectomy bleb at "+this.clockHour()+" o'clock"},ED.BlotHaemorrhage=function(t,e){this.className="BlotHaemorrhage",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.BlotHaemorrhage.prototype=new ED.Doodle,ED.BlotHaemorrhage.prototype.constructor=ED.BlotHaemorrhage,ED.BlotHaemorrhage.superclass=ED.Doodle.prototype,ED.BlotHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.BlotHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-60,-60)},ED.BlotHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.BlotHaemorrhage.superclass.draw.call(this,t);var r=30;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BlotHaemorrhage.prototype.groupDescription=function(){return"Blot haemorrhages"},ED.BuckleOperation=function(t,e){this.className="BuckleOperation",ED.Doodle.call(this,t,e)},ED.BuckleOperation.prototype=new ED.Doodle,ED.BuckleOperation.prototype.constructor=ED.BuckleOperation,ED.BuckleOperation.superclass=ED.Doodle.prototype,ED.BuckleOperation.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.willReport=!1},ED.BuckleOperation.prototype.draw=function(t){var e=this.drawing.context;return ED.BuckleOperation.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#444",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawRectus(e,"Sup"),this.drawRectus(e,"Nas"),this.drawRectus(e,"Inf"),this.drawRectus(e,"Tem")),this.isClicked},ED.BuckleOperation.prototype.drawRectus=function(t,e){switch(t.beginPath(),e){case"Sup":x1=-60,y1=-480,x2=-60,y2=-200,x3=60,y3=-200,x4=60,y4=-480,xd=30,yd=0;break;case"Nas":x1=480,y1=-60,x2=200,y2=-60,x3=200,y3=60,x4=480,y4=60,xd=0,yd=30;break;case"Inf":x1=60,y1=480,x2=60,y2=200,x3=-60,y3=200,x4=-60,y4=480,xd=-30,yd=0;break;case"Tem":x1=-480,y1=60,x2=-200,y2=60,x3=-200,y3=-60,x4=-480,y4=-60,xd=0,yd=-30;default:}t.moveTo(x1,y1),t.lineTo(x2,y2),t.lineTo(x3,y3),t.lineTo(x4,y4),t.moveTo(x1+xd,y1+yd),t.lineTo(x2+xd,y2+yd),t.moveTo(x1+2*xd,y1+2*yd),t.lineTo(x2+2*xd,y2+2*yd),t.moveTo(x1+3*xd,y1+3*yd),t.lineTo(x2+3*xd,y2+3*yd),t.fillStyle="#CA6800",t.fill(),t.lineWidth=8,t.strokeStyle="#804000",t.stroke()},ED.BuckleSuture=function(t,e){this.className="BuckleSuture",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e),this.arc=15*Math.PI/180},ED.BuckleSuture.prototype=new ED.Doodle,ED.BuckleSuture.prototype.constructor=ED.BuckleSuture,ED.BuckleSuture.superclass=ED.Doodle.prototype,ED.BuckleSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.willReport=!1},ED.BuckleSuture.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BuckleSuture.prototype.draw=function(t){var e=this.drawing.context;ED.BuckleSuture.superclass.draw.call(this,t);var a=340,i=this.drawing.lastDoodleOfClass("CircumferentialBuckle");i&&(a=-i.apexY+20);var o=200,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s;if(e.beginPath(),e.arc(0,0,a,n,l,!0),e.arc(0,0,o,l,n,!1),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#666",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){r=o+(a-o)/2;var h=r*Math.sin(s),d=-r*Math.cos(s);e.beginPath(),e.arc(h,d,5,0,2*Math.PI,!0),e.moveTo(h+20,d+20),e.lineTo(h,d),e.lineTo(h+20,d-20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BusaccaNodule=function(t,e){this.className="BusaccaNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.BusaccaNodule.prototype=new ED.Doodle,ED.BusaccaNodule.prototype.constructor=ED.BusaccaNodule,ED.BusaccaNodule.superclass=ED.Doodle.prototype,ED.BusaccaNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.BusaccaNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BusaccaNodule.prototype.draw=function(t){var e=this.drawing.context;ED.BusaccaNodule.superclass.draw.call(this,t);var r=380,a=260,i=this.drawing.lastDoodleOfClass("AntSeg");i&&(a=-i.apexY);var o=a+(r-a)/2;return e.beginPath(),e.arc(0,-o,30,0,2*Math.PI,!1),e.fillStyle="rgba(150,100,50,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.BusaccaNodule.prototype.groupDescription=function(){return"Busacca nodules"},ED.CNV=function(t,e){this.className="CNV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CNV.prototype=new ED.Doodle,ED.CNV.prototype.constructor=ED.CNV,ED.CNV.superclass=ED.Doodle.prototype,ED.CNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CNV.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.CNV.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.CNV.prototype.draw=function(t){var e=this.drawing.context;ED.CNV.superclass.draw.call(this,t),e.beginPath();var r=80,a=16,i=2*Math.PI/a,o=.5*Math.PI/a,s=4,n=new ED.Point(0,0),l=new ED.Point(0,0);l.setWithPolars(r,0),e.moveTo(l.x,l.y);for(var h=r,d=0;a>d;d++){var c=r*(s+ED.randomArray[d])/s,p=new ED.Point(0,0);p.setWithPolars(h,d*i+o);var D=new ED.Point(0,0);D.setWithPolars(c,(d+1)*i-o);var u=new ED.Point(0,0);u.setWithPolars(c,(d+1)*i),h=c,d==a-1?e.bezierCurveTo(p.x,p.y,D.x,D.y,l.x,l.y):e.bezierCurveTo(p.x,p.y,D.x,D.y,u.x,u.y),1==d&&(n.x=u.x,n.y=u.y)}return e.closePath(),e.lineWidth=0,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,.8*r,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,190,1)",e.fill()),this.handleArray[2].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CNV.prototype.description=function(){return"CNV"},ED.CNV.prototype.snomedCode=function(){return 314517003},ED.CNV.prototype.diagnosticHierarchy=function(){return 2},ED.CapsularTensionRing=function(t,e){this.className="CapsularTensionRing",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.CapsularTensionRing.prototype=new ED.Doodle,ED.CapsularTensionRing.prototype.constructor=ED.CapsularTensionRing,ED.CapsularTensionRing.superclass=ED.Doodle.prototype,ED.CapsularTensionRing.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0},ED.CapsularTensionRing.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/2},ED.CapsularTensionRing.prototype.draw=function(t){var e=this.drawing.context;ED.CapsularTensionRing.superclass.draw.call(this,t),e.beginPath();var r=360,a=340,i=300,o=15,s=.2*Math.PI;e.arc(0,0,r,-s,s,!0);var n=new ED.Point(0,0);n.setWithPolars(r,Math.PI/2+.8*s);var l=new ED.Point(0,0);l.setWithPolars(i,Math.PI/2+.8*s);var h=new ED.Point(0,0);h.setWithPolars(i,Math.PI/2+s);var d=new ED.Point(0,0);d.setWithPolars(i,Math.PI/2+1.1*s);var c=new ED.Point(0,0);c.setWithPolars(a,Math.PI/2+1.1*s);var p=new ED.Point(0,0);p.setWithPolars(a,Math.PI/2+1.2*s),e.bezierCurveTo(n.x,n.y,l.x,l.y,h.x,h.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,p.x,p.y),e.arc(0,0,a,1.2*s,-1.2*s,!1);var D=new ED.Point(0,0);D.setWithPolars(a,Math.PI/2-1.1*s);var u=new ED.Point(0,0);u.setWithPolars(i,Math.PI/2-1.1*s);var y=new ED.Point(0,0);y.setWithPolars(i,Math.PI/2-s);var g=new ED.Point(0,0);g.setWithPolars(i,Math.PI/2-.8*s);var E=new ED.Point(0,0);E.setWithPolars(r,Math.PI/2-.8*s);var m=new ED.Point(0,0);m.setWithPolars(r,Math.PI/2-s),e.bezierCurveTo(D.x,D.y,u.x,u.y,y.x,y.y),e.bezierCurveTo(g.x,g.y,E.x,E.y,m.x,m.y);var f=new ED.Point(0,0);f.setWithPolars(a-8,Math.PI/2-s);var P=new ED.Point(0,0);P.setWithPolars(a-8+o,Math.PI/2-s),e.moveTo(P.x,P.y),e.arc(f.x,f.y,15,0,2*Math.PI,!1);var w=new ED.Point(0,0);w.setWithPolars(a-8,Math.PI/2+s);var b=new ED.Point(0,0);return b.setWithPolars(a-8+o,Math.PI/2+s),e.moveTo(b.x,b.y),e.arc(w.x,w.y,15,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.isClicked},ED.CapsularTensionRing.prototype.description=function(){var t="Capsular Tension Ring";return t},ED.ChandelierDouble=function(t,e){this.className="ChandelierDouble",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.ChandelierDouble.prototype=new ED.Doodle,ED.ChandelierDouble.prototype.constructor=ED.ChandelierDouble,ED.ChandelierDouble.superclass=ED.Doodle.prototype,ED.ChandelierDouble.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierDouble.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierDouble.prototype.draw=function(t){var e=this.drawing.context;if(ED.ChandelierDouble.superclass.draw.call(this,t),e.beginPath(),e.rect(-120,this.parsPlana-60,240,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var r=-80;e.moveTo(r-20,this.parsPlana+60),e.lineTo(r+20,this.parsPlana+60),e.lineTo(r+20,this.parsPlana+120),e.lineTo(r,this.parsPlana+140),e.lineTo(r-20,this.parsPlana+120),e.lineTo(r-20,this.parsPlana+60);var r=80;e.moveTo(r-20,this.parsPlana+60),e.lineTo(r+20,this.parsPlana+60),e.lineTo(r+20,this.parsPlana+120),e.lineTo(r,this.parsPlana+140),e.lineTo(r-20,this.parsPlana+120),e.lineTo(r-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-120,this.parsPlana,240,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()}return this.isClicked},ED.ChandelierDouble.prototype.groupDescription=function(){return"Twin chandelier at "},ED.ChandelierDouble.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChandelierSingle=function(t,e){this.className="ChandelierSingle",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.ChandelierSingle.prototype=new ED.Doodle,ED.ChandelierSingle.prototype.constructor=ED.ChandelierSingle,ED.ChandelierSingle.superclass=ED.Doodle.prototype,ED.ChandelierSingle.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierSingle.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierSingle.prototype.draw=function(t){var e=this.drawing.context;return ED.ChandelierSingle.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-60,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-20,this.parsPlana+60),e.lineTo(20,this.parsPlana+60),e.lineTo(20,this.parsPlana+120),e.lineTo(0,this.parsPlana+140),e.lineTo(-20,this.parsPlana+120),e.lineTo(-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-60,this.parsPlana,120,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()),this.isClicked},ED.ChandelierSingle.prototype.groupDescription=function(){return"Chandelier at "},ED.ChandelierSingle.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChoroidalHaemorrhage=function(t,e){this.className="ChoroidalHaemorrhage",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.ChoroidalHaemorrhage.prototype=new ED.Doodle,ED.ChoroidalHaemorrhage.prototype.constructor=ED.ChoroidalHaemorrhage,ED.ChoroidalHaemorrhage.superclass=ED.Doodle.prototype,ED.ChoroidalHaemorrhage.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.ChoroidalHaemorrhage.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexY=-200,this.setRotationWithDisplacements(315,60)},ED.ChoroidalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.ChoroidalHaemorrhage.superclass.draw.call(this,t);var r=476,a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=r*Math.sin(a),n=-r*Math.cos(a),l=-r*Math.sin(a),h=n;e.beginPath(),e.arc(0,0,r,i,o,!0);var d=.6,c=25;if(-c>this.apexY)e.bezierCurveTo(l,h,d*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);else if(c>this.apexY){var p=Math.acos((0-this.apexY)/c),D=c*Math.sin(p);e.bezierCurveTo(l,h,d*l,this.apexY,-D,this.apexY),e.arc(0,0,c,-Math.PI/2-p,-Math.PI/2+p,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n)}else e.bezierCurveTo(l,h,d*l,this.apexY,0,25),e.arc(0,0,c,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);return e.lineWidth=4,e.fillStyle="rgba(153, 102, 51, 1)",e.strokeStyle="rgba(153, 102, 51, 1)",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(s,n)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ChoroidalHaemorrhage.prototype.description=function(){var t="";return t+=Math.cos(this.rotation)>0?"Supero":"Infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",t+=" choroidal haemorrhage"},ED.ChoroidalHaemorrhage.prototype.snomedCode=function(){return 419596007},ED.ChoroidalNaevus=function(t,e){this.className="ChoroidalNaevus",this.numberOfHandles=4,this.initialRadius=120,this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.ChoroidalNaevus.prototype=new ED.Doodle,ED.ChoroidalNaevus.prototype.constructor=ED.ChoroidalNaevus,ED.ChoroidalNaevus.superclass=ED.Doodle.prototype,ED.ChoroidalNaevus.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0,this.handleArray[this.numberOfHandles]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalNaevus.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,r=this.numberOfHandles,a={};a.length=new ED.Range(50,290),a.angle=new ED.Range(((2*r-1)*e/(2*r)+t*e/r)%e,(1*e/(2*r)+t*e/r)%e),this.handleVectorRangeArray[t]=a}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0},ED.ChoroidalNaevus.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;this.numberOfHandles>e;e++){var r=new ED.Point(0,0);r.setWithPolars(this.initialRadius,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(r)}},ED.ChoroidalNaevus.prototype.draw=function(t){var e=this.drawing.context;ED.ChoroidalNaevus.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var l=0;this.numberOfHandles>l;l++){r=this.squiggleArray[0].pointsArray[l];var h=this.numberOfHandles-1>l?l+1:0;a=this.squiggleArray[0].pointsArray[h],i=r.tangentialControlPoint(+s),o=a.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,a.x,a.y)}if(e.closePath(),e.lineWidth=4,e.fillStyle="rgba(125, 65, 54, 0.8)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){p=new ED.Point(0,0),fill="yellow";var d=4;n=Math.abs(Math.floor((-this.apexY+50)/5));for(var l=0;n>l;l++)p.setWithPolars(.8*this.initialRadius*ED.randomArray[l+10],2*Math.PI*ED.randomArray[l+100]),this.drawSpot(e,p.x,p.y,2*d,fill)}for(var l=0;this.numberOfHandles>l;l++)this.handleArray[l].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[l]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked
},ED.ChoroidalNaevus.prototype.description=function(){return"Choroidal naevus"},ED.ChoroidalNaevus.prototype.snomedCode=function(){return 255024002},ED.CiliaryInjection=function(t,e){this.className="CiliaryInjection",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.CiliaryInjection.prototype=new ED.Doodle,ED.CiliaryInjection.prototype.constructor=ED.CiliaryInjection,ED.CiliaryInjection.superclass=ED.Doodle.prototype,ED.CiliaryInjection.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.CiliaryInjection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.CiliaryInjection.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.setRotationWithDisplacements(90,-120)},ED.CiliaryInjection.prototype.draw=function(t){var e=this.drawing.context;ED.CiliaryInjection.superclass.draw.call(this,t);var r=480,a=400,i=a+(r-a)/2,o=this.arc/2;-Math.PI/2+o;var s=-Math.PI/2-o,n=i*Math.sin(o),l=-i*Math.cos(o),h=-i*Math.sin(o),d=l;if(e.beginPath(),e.arc(0,0,r,-Math.PI/2+o,-Math.PI/2-o,!0),e.arc(0,0,a,-Math.PI/2-o,-Math.PI/2+o,!1),e.closePath(),e.fillStyle="rgba(218,230,241,0)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=60,p=2*Math.PI/c,D=Math.floor(this.arc/p),u=new ED.Point(0,0),y=new ED.Point(0,0);e.beginPath();for(var g=0;D>g;g++){var o=Math.PI/2+s+g*p;u.setWithPolars(r,o),y.setWithPolars(a,o),e.moveTo(u.x,u.y),e.lineTo(y.x,y.y)}e.strokeStyle="red",e.lineWidth=16,e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CiliaryInjection.prototype.groupDescription=function(){return"Ciliary injection "},ED.Circinate=function(t,e){this.className="Circinate",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Circinate.prototype=new ED.Doodle,ED.Circinate.prototype.constructor=ED.Circinate,ED.Circinate.superclass=ED.Doodle.prototype,ED.Circinate.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Circinate.prototype.setPropertyDefaults=function(){},ED.Circinate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(60,100)},ED.Circinate.prototype.draw=function(t){var e=this.drawing.context;ED.Circinate.superclass.draw.call(this,t),e.beginPath();var r=80;if(e.arc(0,0,r,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,0,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var a=40,o=10,s=12,n=30,l=new ED.Point(0,0),h=new ED.Point(0,0);for(e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!1),e.closePath(),e.fillStyle="red",e.fill(),phi=2*Math.PI/s,i=0;s>i;i++)e.beginPath(),l.setWithPolars(a,i*phi),h.setWithPolars(a+n,i*phi),e.moveTo(l.x,l.y),e.lineTo(h.x,h.y),e.closePath(),e.lineWidth=12,e.strokeStyle="rgba(220,220,0,1)",e.lineCap="round",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Circinate.prototype.groupDescription=function(){return"Circinate maculopathy "},ED.Circinate.prototype.description=function(){return this.locationRelativeToFovea()},ED.CircumferentialBuckle=function(t,e){this.className="CircumferentialBuckle",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.CircumferentialBuckle.prototype=new ED.Doodle,ED.CircumferentialBuckle.prototype.constructor=ED.CircumferentialBuckle,ED.CircumferentialBuckle.superclass=ED.Doodle.prototype,ED.CircumferentialBuckle.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CircumferentialBuckle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-410,-320)},ED.CircumferentialBuckle.prototype.setParameterDefaults=function(){this.arc=140*Math.PI/180,this.apexY=-320,this.rotation=-45*Math.PI/180},ED.CircumferentialBuckle.prototype.draw=function(t){var e=this.drawing.context;ED.CircumferentialBuckle.superclass.draw.call(this,t);var r=320;-350>this.apexY&&this.apexY>-380?r=350:-380>this.apexY&&(r=410);var a=220,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=r*Math.sin(i),l=-r*Math.cos(i),h=-r*Math.sin(i),d=l;if(e.beginPath(),e.arc(0,0,r,o,s,!0),e.arc(0,0,a,s,o,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var c=30;rgi=a+(r-a-c)/2,rgo=r-(r-a-c)/2,e.arc(0,0,rgo,o,s,!0),e.arc(0,0,rgi,s,o,!1),e.closePath(),e.fill(),e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CircumferentialBuckle.prototype.description=function(){var t="";return t=-380>=this.apexY?"280 circumferential buckle ":-350>=this.apexY?"279 circumferential buckle ":"277 circumferential buckle ",t+=this.arc>1.8*Math.PI?"encirclement":this.clockHourExtent()+" o'clock"},ED.ConjunctivalFlap=function(t,e){this.className="ConjunctivalFlap",this.method="Fornix-based",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.ConjunctivalFlap.prototype=new ED.Doodle,ED.ConjunctivalFlap.prototype.constructor=ED.ConjunctivalFlap,ED.ConjunctivalFlap.superclass=ED.Doodle.prototype,ED.ConjunctivalFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-640,-100),this.parameterValidationArray.apexY.delta=30,this.parameterValidationArray.arc.range.setMinAndMax(60*Math.PI/180,160*Math.PI/180),this.parameterValidationArray.method={kind:"derived",type:"string",list:["Fornix-based","Limbus-based"],animate:!0}},ED.ConjunctivalFlap.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setParameterFromString("method","Fornix-based")},ED.ConjunctivalFlap.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.method=-380>e?"Fornix-based":"Limbus-based";break;case"method":switch(e){case"Fornix-based":r.apexY=-660;break;case"Limbus-based":r.apexY=-100}}return r},ED.ConjunctivalFlap.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var r=380,a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a;this.arc/6;var s=new ED.Point(this.apexX,this.apexY),n=new ED.Point(r*Math.sin(a),-r*Math.cos(a)),l=new ED.Point(-r*Math.sin(a),-r*Math.cos(a));e.beginPath(),e.arc(0,0,r,i,o,!0);var h=.8;return e.bezierCurveTo(l.x,l.y,h*l.x,s.y,s.x,s.y),e.bezierCurveTo(h*n.x,s.y,n.x,n.y,n.x,n.y),e.fillStyle="rgba(255,255,255,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(l),this.handleArray[3].location=this.transform.transformPoint(n),this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ConjunctivalFlap.prototype.description=function(){return(-280>this.apexY?"Fornix based ":"Limbus based ")+"flap"},ED.CorneaCrossSection=function(t,e){this.className="CorneaCrossSection",ED.Doodle.call(this,t,e)},ED.CorneaCrossSection.prototype=new ED.Doodle,ED.CorneaCrossSection.prototype.constructor=ED.CorneaCrossSection,ED.CorneaCrossSection.superclass=ED.Doodle.prototype,ED.CorneaCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.CorneaCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.CorneaCrossSection.prototype.draw=function(t){var e=this.drawing.context;return ED.CorneaCrossSection.superclass.draw.call(this,t),e.beginPath(),e.moveTo(60,-480),e.lineTo(-80,-480),e.bezierCurveTo(-100,-440,-100,-440,-120,-380),e.bezierCurveTo(-240,-260,-320,-160,-320,0),e.bezierCurveTo(-320,160,-240,260,-120,380),e.bezierCurveTo(-100,440,-100,440,-80,480),e.lineTo(60,480),e.lineTo(0,380),e.bezierCurveTo(-80,260,-220,180,-220,0),e.bezierCurveTo(-220,-180,-80,-260,0,-380),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(245, 245, 245, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(56,-478),e.lineTo(-78,-478),e.bezierCurveTo(-98,-440,-96,-440,-118,-378),e.lineTo(-4,-378),e.lineTo(56,-478),e.moveTo(56,478),e.lineTo(-78,478),e.bezierCurveTo(-98,440,-96,440,-118,378),e.lineTo(-4,378),e.closePath(),e.fillStyle="rgba(255,255,185,1)",e.fill()),this.isClicked},ED.CornealAbrasion=function(t,e){this.className="CornealAbrasion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealAbrasion.prototype=new ED.Doodle,ED.CornealAbrasion.prototype.constructor=ED.CornealAbrasion,ED.CornealAbrasion.superclass=ED.Doodle.prototype,ED.CornealAbrasion.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealAbrasion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealAbrasion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealAbrasion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealAbrasion.superclass.draw.call(this,t),e.beginPath();var r=120;e.arc(0,0,r,0,2*Math.PI,!1),e.closePath(),-this.apexY/100,e.fillStyle="rgba(0, 255, 0, 1)",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealAbrasion.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=2>e?"Small ":4>e?"Medium ":"Large ",t+="corneal abrasion"},ED.CornealErosion=function(t,e){this.className="CornealErosion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealErosion.prototype=new ED.Doodle,ED.CornealErosion.prototype.constructor=ED.CornealErosion,ED.CornealErosion.superclass=ED.Doodle.prototype,ED.CornealErosion.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealErosion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealErosion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealErosion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealErosion.superclass.draw.call(this,t),e.beginPath();var r=120;e.arc(0,0,r,0,2*Math.PI,!1),e.closePath(),e.lineWidth=3,e.fillStyle="rgba(230, 230, 230, 0.25)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealErosion.prototype.groupDescription=function(){return"Removal of some corneal epithelium"},ED.CornealGraft=function(t,e){this.className="CornealGraft",this.numberOfSutures=16,this.initialRadius=320,this.sutureLength=60,this.sutureType="Interrupted",this.opaque=!1,this.savedParameterArray=["apexY","sutureType","opaque"],this.controlParameterArray={sutureType:"Suture type",opaque:"Opaque"},ED.Doodle.call(this,t,e)},ED.CornealGraft.prototype=new ED.Doodle,ED.CornealGraft.prototype.constructor=ED.CornealGraft,ED.CornealGraft.superclass=ED.Doodle.prototype,ED.CornealGraft.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealGraft.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.sutureType={kind:"derived",type:"string",list:["Interrupted","Continuous","None"],animate:!1},this.parameterValidationArray.opaque={kind:"derived",type:"bool",display:!0}},ED.CornealGraft.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius},ED.CornealGraft.prototype.draw=function(t){var e=this.drawing.context;ED.CornealGraft.superclass.draw.call(this,t),e.beginPath();var r=-this.apexY+this.sutureLength/2,a=-this.apexY-this.sutureLength/2;if(e.arc(0,0,r,0,2*Math.PI,!0),e.moveTo(a,0),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,-this.apexY,0,2*Math.PI,!0),e.strokeStyle="gray",e.stroke(),this.opaque&&(e.fillStyle="rgba(150, 150, 150, 0.8)",e.fill()),e.beginPath();for(var i=0;this.numberOfSutures>i;i++){var o=2*i*Math.PI/this.numberOfSutures,s=new ED.Point(0,0);s.setWithPolars(a,o);var n=new ED.Point(0,0);n.setWithPolars(r,o),"None"==this.sutureType&&(this.drawSpot(e,s.x,s.y,3,"gray"),this.drawSpot(e,n.x,n.y,3,"gray")),0==o?e.moveTo(s.x,s.y):"Interrupted"==this.sutureType?e.moveTo(s.x,s.y):"Continuous"==this.sutureType&&e.lineTo(s.x,s.y),"None"!=this.sutureType&&e.lineTo(n.x,n.y)}"Continuous"==this.sutureType&&e.closePath(),e.strokeStyle="gray",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealGraft.prototype.description=function(){return"Corneal Graft"},ED.CornealOedema=function(t,e){this.className="CornealOedema",this.numberOfHandles=4,this.initialRadius=360,this.intensity="Mild",this.savedParameterArray=["originX","originY","apexX","apexY","rotation","intensity"],this.controlParameterArray={intensity:"Intensity"},ED.Doodle.call(this,t,e)},ED.CornealOedema.prototype=new ED.Doodle,ED.CornealOedema.prototype.constructor=ED.CornealOedema,ED.CornealOedema.superclass=ED.Doodle.prototype,ED.CornealOedema.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealOedema.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.intensity={kind:"derived",type:"string",list:["Mild","Moderate","Severe"],animate:!1}},ED.CornealOedema.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius},ED.CornealOedema.prototype.draw=function(t){var e=this.drawing.context;ED.CornealOedema.superclass.draw.call(this,t),e.beginPath();var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);switch(e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=4,this.intensity){case"Mild":e.fillStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPattern,"repeat");break;case"Severe":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPatternBullous,"repeat")}if(e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw);return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealOedema.prototype.description=function(){return"Corneal oedema"},ED.CornealScar=function(t,e){this.className="CornealScar",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealScar.prototype=new ED.Doodle,ED.CornealScar.prototype.constructor=ED.CornealScar,ED.CornealScar.superclass=ED.Doodle.prototype,ED.CornealScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealScar.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-10)},ED.CornealScar.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=.7,this.scaleY=.5,this.setOriginWithDisplacements(0,25)},ED.CornealScar.prototype.draw=function(t){var e=this.drawing.context;ED.CornealScar.superclass.draw.call(this,t),e.beginPath();var r=100;e.arc(0,0,r,0,2*Math.PI,!1),e.closePath();var a=-this.apexY/100;if(e.fillStyle="rgba(100,100,100,"+a.toFixed(2)+")",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=new ED.Point(0,0),o=this.drawing.transform.transformPoint(i),e=this.drawing.context;this.isInVisualAxis=e.isPointInPath(o.x,o.y)?!0:!1}var s=new ED.Point(0,0);return s.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(s),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealScar.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=2>e?"Small ":4>e?"Medium ":"Large ",t+="corneal scar",this.isInVisualAxis&&(t+=" involving visual axis"),t},ED.CornealScar.prototype.snomedCode=function(){return 95726001},ED.CornealScar.prototype.diagnosticHierarchy=function(){return 2},ED.CornealStriae=function(t,e){this.className="CornealStriae",ED.Doodle.call(this,t,e)},ED.CornealStriae.prototype=new ED.Doodle,ED.CornealStriae.prototype.constructor=ED.CornealStriae,ED.CornealStriae.superclass=ED.Doodle.prototype,ED.CornealStriae.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.CornealStriae.prototype.draw=function(t){var e=this.drawing.context;ED.CornealStriae.superclass.draw.call(this,t),e.beginPath();var r=300;if(e.arc(0,0,r,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(100,100,100,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var a=-300,i=50,o=30,s=80,n=-2*s;e.beginPath();for(var l=0;5>l;l++)e.moveTo(n+s*l,a),e.bezierCurveTo(n+s*l-o,a+1*i,n+s*l-o,a+2*i,n+s*l,a+3*i),e.bezierCurveTo(n+s*l+o,a+4*i,n+s*l+o,a+5*i,n+s*l,a+6*i),e.bezierCurveTo(n+s*l-o,a+7*i,n+s*l-o,a+8*i,n+s*l,a+9*i),e.bezierCurveTo(n+s*l+o,a+10*i,n+s*l+o,a+11*i,n+s*l,a+12*i);e.lineWidth=20,e.strokeStyle="rgba(100,100,100,0.6)",e.stroke()}return this.isClicked},ED.CornealStriae.prototype.description=function(){return"Striate keratopathy"},ED.CornealSuture=function(t,e){this.className="CornealSuture",this.savedParameterArray=["radius","rotation"],ED.Doodle.call(this,t,e)},ED.CornealSuture.prototype=new ED.Doodle,ED.CornealSuture.prototype.constructor=ED.CornealSuture,ED.CornealSuture.superclass=ED.Doodle.prototype,ED.CornealSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CornealSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.CornealSuture.prototype.draw=function(t){var e=this.drawing.context;ED.CornealSuture.superclass.draw.call(this,t),e.beginPath();var r=this.radius;if(e.rect(-20,-(r+40),40,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=6,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(0,-r-40),e.lineTo(0,-r+40),e.moveTo(-10,-r+10),e.lineTo(0,-r+20),e.lineTo(-10,-r+30),e.lineWidth=2;var a="rgba(0,0,120,0.7)";e.strokeStyle=a,e.stroke(),this.drawSpot(e,0,-r+20,4,a)}return this.isClicked},ED.CornealSuture.prototype.description=function(){var t="Corneal suture at ";return t+=this.clockHour()+" o'clock"},ED.CorticalCataract=function(t,e){this.className="CorticalCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.CorticalCataract.prototype=new ED.Doodle,ED.CorticalCataract.prototype.constructor=ED.CorticalCataract,ED.CorticalCataract.superclass=ED.Doodle.prototype,ED.CorticalCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens","PostSubcapCataract","NuclearCataract"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.CorticalCataract.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.grade=-120>e?"Mild":-60>e?"Moderate":"White";break;case"grade":switch(e){case"Mild":r.apexY=-180;break;case"Moderate":r.apexY=-100;break;case"White":r.apexY=-20}}return r},ED.CorticalCataract.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataract.superclass.draw.call(this,t),e.beginPath();var r=16,a=240,i=230,o=2*Math.PI/r,s=o/2,n=-this.apexY,l=new ED.Point(0,0);l.setWithPolars(i,-s),e.moveTo(l.x,l.y);for(var h=0;r>h;h++){var d=h*o-s,c=new ED.Point(0,0);c.setWithPolars(i,d),e.lineTo(c.x,c.y);var p=new ED.Point(0,0);p.setWithPolars(n,h*o),e.lineTo(p.x,p.y)}return e.lineTo(l.x,l.y),e.moveTo(a,0),e.arc(0,0,a,0,2*Math.PI,!0),e.lineWidth=4,e.lineJoin="bevel",e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CorticalCataract.prototype.description=function(){return this.getParameter("grade")+" cortical cataract"},ED.CorticalCataract.prototype.snomedCode=function(){return 193576003},ED.CorticalCataract.prototype.diagnosticHierarchy=function(){return 3},ED.CorticalCataractCrossSection=function(t,e){this.className="CorticalCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.CorticalCataractCrossSection.prototype=new ED.Doodle,ED.CorticalCataractCrossSection.prototype.constructor=ED.CorticalCataractCrossSection,ED.CorticalCataractCrossSection.superclass=ED.Doodle.prototype,ED.CorticalCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.setParameterFromString("grade","Mild")},ED.CorticalCataractCrossSection.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.grade=-120>e?"Mild":-60>e?"Moderate":"White";break;case"grade":switch(e){case"Mild":r.apexY=-180;break;case"Moderate":r.apexY=-100;break;case"White":r.apexY=-20}}return r},ED.CorticalCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataractCrossSection.superclass.draw.call(this,t);var r=240,a=300,i=100,o=Math.asin(r/a),s=a*Math.cos(o),n=a-30;o=Math.acos(s/n);var l=Math.asin(-this.apexY/n);e.beginPath(),e.arc(i-s,0,n,l,o,!1),e.arc(i+s,0,n,Math.PI-o,Math.PI-l,!1);var h=n*Math.cos(l);return e.moveTo(i-s+h,this.apexY),e.arc(i-s,0,n,-l,-o,!0),e.arc(i+s,0,n,Math.PI+o,Math.PI+l,!0),e.lineWidth=30,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(200,200,200,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(i,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CottonWoolSpot=function(t,e){this.className="CottonWoolSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CottonWoolSpot.prototype=new ED.Doodle,ED.CottonWoolSpot.prototype.constructor=ED.CottonWoolSpot,ED.CottonWoolSpot.superclass=ED.Doodle.prototype,ED.CottonWoolSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CottonWoolSpot.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CottonWoolSpot.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-150,150)},ED.CottonWoolSpot.prototype.draw=function(t){var e=this.drawing.context;ED.CottonWoolSpot.superclass.draw.call(this,t);var r=80,a=50,i=a/3;return e.beginPath(),e.moveTo(-r,-a),e.lineTo(-r+i,-a+1*i),e.lineTo(-r,-a+2*i),e.lineTo(-r+i,-a+3*i),e.lineTo(-r,-a+4*i),e.lineTo(-r+i,-a+5*i),e.lineTo(-r,-a+6*i),e.bezierCurveTo(-r+i,-a+7*i,r-i,-a+7*i,r,-a+6*i),e.lineTo(r-i,-a+5*i),e.lineTo(r,-a+4*i),e.lineTo(r-i,-a+3*i),e.lineTo(r,-a+2*i),e.lineTo(r-i,-a+1*i),e.lineTo(r,-a),e.bezierCurveTo(r-i,-a-i,-r+i,-a-i,-r,-a),e.closePath(),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(r,-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CottonWoolSpot.prototype.groupDescription=function(){return"Cotton wool spots"},ED.Cryo=function(t,e){this.className="Cryo",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.Cryo.prototype=new ED.Doodle,ED.Cryo.prototype.constructor=ED.Cryo,ED.Cryo.superclass=ED.Doodle.prototype,ED.Cryo.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Cryo.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.Cryo.prototype.setParameterDefaults=function(){this.apexY=-40,this.rotation=Math.PI/4;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),r=new ED.Point(0,0);r.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(r.x,r.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.Cryo.prototype.draw=function(t){var e=this.drawing.context;ED.Cryo.superclass.draw.call(this,t),e.beginPath();var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=8;var a=e.createPattern(this.drawing.imageArray.CryoPattern,"repeat");return e.fillStyle=a,e.strokeStyle="rgba(80, 40, 0, 1)",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Cryo.prototype.groupDescription=function(){return"Cryotherapy"},ED.CutterPI=function(t,e){this.className="CutterPI",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.CutterPI.prototype=new ED.Doodle,ED.CutterPI.prototype.constructor=ED.CutterPI,ED.CutterPI.superclass=ED.Doodle.prototype,ED.CutterPI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CutterPI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(160,40)},ED.CutterPI.prototype.draw=function(t){var e=this.drawing.context;return ED.CutterPI.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-324,40,0,2*Math.PI,!0),e.fillStyle="rgba(255,255,255,1)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.CutterPI.prototype.groupDescription=function(){return"Cutter iridectomy/s"},ED.CystoidMacularOedema=function(t,e){this.className="CystoidMacularOedema",this.savedParameterArray=["scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CystoidMacularOedema.prototype=new ED.Doodle,ED.CystoidMacularOedema.prototype.constructor=ED.CystoidMacularOedema,ED.CystoidMacularOedema.superclass=ED.Doodle.prototype,ED.CystoidMacularOedema.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.CystoidMacularOedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CystoidMacularOedema.prototype.setParameterDefaults=function(){},ED.CystoidMacularOedema.prototype.draw=function(t){var e=this.drawing.context;if(ED.CystoidMacularOedema.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,120,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var r="rgba(255, 255, 138, 0.5)",a="rgba(255, 82, 0, 0.7)",i=new ED.Point(0,0),o=8,s=0;o>s;s++){var n=2*s*Math.PI/o;i.setWithPolars(80,n),this.drawCircle(e,i.x,i.y,40,r,2,a)}this.drawCircle(e,0,0,60,r,2,a)}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CystoidMacularOedema.prototype.description=function(){return"Cystoid macular oedema"},ED.CystoidMacularOedema.prototype.snomedCode=function(){return 193387007},ED.CystoidMacularOedema.prototype.diagnosticHierarchy=function(){return 2},ED.DiabeticNV=function(t,e){this.className="DiabeticNV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.DiabeticNV.prototype=new ED.Doodle,ED.DiabeticNV.prototype.constructor=ED.DiabeticNV,ED.DiabeticNV.superclass=ED.Doodle.prototype,ED.DiabeticNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.DiabeticNV.prototype.setPropertyDefaults=function(){},ED.DiabeticNV.prototype.setParameterDefaults=function(){var t=this.drawing.numberOfDoodlesOfClass(this.className);
switch(t){case 0:this.originX=this.drawing.eye==ED.eye.Right?300:-300,this.originY=-100;break;case 1:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=-236;break;case 2:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=236;break;default:this.setOriginWithDisplacements(0,-100)}},ED.DiabeticNV.prototype.draw=function(t){var e=this.drawing.context;ED.DiabeticNV.superclass.draw.call(this,t),e.beginPath();var r=60,a=r/2,i=0,o=Math.PI/8,s=8,n=new ED.Point(0,0),l=new ED.Point(0,0),h=new ED.Point(0,0),d=new ED.Point(0,0),c=new ED.Point(0,0);e.moveTo(0,0);var p;for(p=0;s>p;p++)i=2*p*Math.PI/s,n.setWithPolars(a,i-o),l.setWithPolars(r,i-o),h.setWithPolars(r,i),d.setWithPolars(r,i+o),c.setWithPolars(a,i+o),e.bezierCurveTo(n.x,n.y,l.x,l.y,h.x,h.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,0,0);return e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red",this.drawBoundary(t),point=new ED.Point(0,0),point.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiabeticNV.prototype.groupDescription=function(){return"Diabetic new vessels "},ED.DiabeticNV.prototype.description=function(){return this.locationRelativeToDisc()},ED.DiabeticNV.prototype.snomedCode=function(){return 59276001},ED.Dialysis=function(t,e){this.className="Dialysis",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Dialysis.prototype=new ED.Doodle,ED.Dialysis.prototype.constructor=ED.Dialysis,ED.Dialysis.superclass=ED.Doodle.prototype,ED.Dialysis.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Dialysis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,Math.PI)},ED.Dialysis.prototype.setParameterDefaults=function(){this.apexY=-350,this.arc=60*Math.PI/180,this.setRotationWithDisplacements(140,60)},ED.Dialysis.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var r=476,a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=r*Math.sin(a),n=-r*Math.cos(a),l=-r*Math.sin(a),h=n;e.beginPath(),e.arc(0,0,r,i,o,!0);var d=.6;return e.bezierCurveTo(l,h,d*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n),e.lineWidth=8,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(s,n)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Dialysis.prototype.description=function(){var t="";return t=this.arc<Math.PI/4?"Small ":"Large ",t+="dialysis ",t+=this.clockHour()+" o'clock"},ED.Dialysis.prototype.snomedCode=function(){return 232003005},ED.Dialysis.prototype.diagnosticHierarchy=function(){return 4},ED.DiscHaemorrhage=function(t,e){this.className="DiscHaemorrhage",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.DiscHaemorrhage.prototype=new ED.Doodle,ED.DiscHaemorrhage.prototype.constructor=ED.DiscHaemorrhage,ED.DiscHaemorrhage.superclass=ED.Doodle.prototype,ED.DiscHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.DiscHaemorrhage.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(150,-120)},ED.DiscHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.DiscHaemorrhage.superclass.draw.call(this,t);var r=350,a=250,i=a+(r-a)/2,o=5*Math.PI/180,s=-Math.PI/2+o,n=-Math.PI/2-o;return i*Math.sin(o),-i*Math.cos(o),-i*Math.sin(o),e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscHaemorrhage.prototype.groupDescription=function(){return"Disc haemorrhage at "},ED.DiscHaemorrhage.prototype.description=function(){return this.clockHour()+" o'clock"},ED.DiscPallor=function(t,e){this.className="DiscPallor",this.grade="Sectorial",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.DiscPallor.prototype=new ED.Doodle,ED.DiscPallor.prototype.constructor=ED.DiscPallor,ED.DiscPallor.superclass=ED.Doodle.prototype,ED.DiscPallor.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.DiscPallor.prototype.setPropertyDefaults=function(){this.isArcSymmetrical=!0,this.isMoveable=!1,this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Sectorial","Diffuse"],animate:!0},this.parameterValidationArray.arc.delta=.2},ED.DiscPallor.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.setRotationWithDisplacements(45,-120),this.setParameterFromString("grade","Sectorial")},ED.DiscPallor.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"arc":r.grade=2*Math.PI>e?"Sectorial":"Diffuse";break;case"grade":switch(e){case"Sectorial":r.arc=this.arc<2*Math.PI?this.arc:Math.PI/2;break;case"Diffuse":r.arc=2*Math.PI}}return r},ED.DiscPallor.prototype.draw=function(t){var e=this.drawing.context;ED.DiscPallor.superclass.draw.call(this,t);var r=300,a=this.drawing.firstDoodleOfClass("OpticDisc");if(a)var i=a.minimumRadius();else var i=150;var o=i+(r-i)/2,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s,h=o*Math.sin(s),d=-o*Math.cos(s),c=-o*Math.sin(s),p=d;return e.beginPath(),e.arc(0,0,r,n,l,!0),e.arc(0,0,i,l,n,!1),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.5)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscPallor.prototype.groupDescription=function(){return"Diffuse"==this.grade?"Diffuse disc pallor":"Disc pallor at "},ED.DiscPallor.prototype.description=function(){return"Diffuse"==this.grade?"":this.clockHour()+" o'clock"},ED.DrainageRetinotomy=function(t,e){this.className="DrainageRetinotomy",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.DrainageRetinotomy.prototype=new ED.Doodle,ED.DrainageRetinotomy.prototype.constructor=ED.DrainageRetinotomy,ED.DrainageRetinotomy.superclass=ED.Doodle.prototype,ED.DrainageRetinotomy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.DrainageRetinotomy.prototype.draw=function(t){var e=this.drawing.context;return ED.DrainageRetinotomy.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=16,e.fillStyle="rgba(255,0,0,0.5)",e.strokeStyle="red",this.drawBoundary(t),this.isClicked},ED.DrainageRetinotomy.prototype.description=function(){return"Drainage retinotomy in "+this.quadrant()},ED.DrainageSite=function(t,e){this.className="DrainageSite",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.DrainageSite.prototype=new ED.Doodle,ED.DrainageSite.prototype.constructor=ED.DrainageSite,ED.DrainageSite.superclass=ED.Doodle.prototype,ED.DrainageSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.DrainageSite.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.DrainageSite.prototype.draw=function(t){var e=this.drawing.context;ED.DrainageSite.superclass.draw.call(this,t);var r=440,a=360,i=Math.PI/30,o=-Math.PI/2+i,s=-Math.PI/2-i;return e.beginPath(),e.arc(0,0,r,o,s,!0),e.lineTo(0,-a),e.closePath(),e.lineWidth=4,e.strokeStyle="#777",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrainageSite.prototype.groupDescription=function(){return"Drainage site at "},ED.DrainageSite.prototype.description=function(){return this.clockHour()+" o'clock"},ED.EncirclingBand=function(t,e){this.className="EncirclingBand",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.EncirclingBand.prototype=new ED.Doodle,ED.EncirclingBand.prototype.constructor=ED.EncirclingBand,ED.EncirclingBand.superclass=ED.Doodle.prototype,ED.EncirclingBand.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0},ED.EncirclingBand.prototype.setParameterDefaults=function(){this.rotation=-45*Math.PI/180},ED.EncirclingBand.prototype.draw=function(t){var e=this.drawing.context;ED.EncirclingBand.superclass.draw.call(this,t);var r=270,a=this.drawing.lastDoodleOfClass("CircumferentialBuckle");if(a){var i=a.apexY;-350>i&&i>-380?r=286:-380>i&&(r=315)}var o=r+15,s=r-15;if(e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!0),e.arc(0,0,s,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var n=Math.PI/16;e.arc(0,0,o+10,n,-n,!0),e.arc(0,0,s-10,-n,n,!1),e.closePath(),e.lineWidth=6,e.stroke()}return this.isClicked},ED.EncirclingBand.prototype.description=function(){var t="Encircling band, with Watzke in ";if(this.drawing.eye==ED.eye.Right)var e=!0;else var e=!1;var r=this.rotation+Math.PI/2;return t+=Math.cos(r)>0?"supero":"infero",t+=Math.sin(r)>0?e?"nasal":"temporal":e?"temporal":"nasal",t+=" quadrant"},ED.EntrySiteBreak=function(t,e){this.className="EntrySiteBreak",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.EntrySiteBreak.prototype=new ED.Doodle,ED.EntrySiteBreak.prototype.constructor=ED.EntrySiteBreak,ED.EntrySiteBreak.superclass=ED.Doodle.prototype,ED.EntrySiteBreak.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.EntrySiteBreak.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,3*Math.PI/16)},ED.EntrySiteBreak.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.EntrySiteBreak.prototype.draw=function(t){var e=this.drawing.context;ED.EntrySiteBreak.superclass.draw.call(this,t);var r=460,a=400,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=r*Math.sin(i),l=-r*Math.cos(i),h=-r*Math.sin(i),d=l;return e.beginPath(),e.arc(0,0,r,o,s,!0),e.bezierCurveTo(0,-a,0,-a,n,l),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane=function(t,e){this.className="EpiretinalMembrane",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.EpiretinalMembrane.prototype=new ED.Doodle,ED.EpiretinalMembrane.prototype.constructor=ED.EpiretinalMembrane,ED.EpiretinalMembrane.superclass=ED.Doodle.prototype,ED.EpiretinalMembrane.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.EpiretinalMembrane.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.EpiretinalMembrane.prototype.setParameterDefaults=function(){this.originY=0,this.originX=this.drawing.hasDoodleOfClass("PostPole")?0:this.drawing.eye==ED.eye.Right?-100:100},ED.EpiretinalMembrane.prototype.draw=function(t){var e=this.drawing.context;ED.EpiretinalMembrane.superclass.draw.call(this,t),e.beginPath();var r=120;if(e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.strokeStyle="rgba(0, 255, 0, 0.7)",e.beginPath(),e.moveTo(-r,0),e.lineTo(r,0);var a=.9*r,i=-r/2,o=.3;e.moveTo(-a,i),e.bezierCurveTo(-a*o,i*o,a*o,i*o,a,i),i=r/2,e.moveTo(-a,i),e.bezierCurveTo(-a*o,i*o,a*o,i*o,a,i),a=.6*r,i=.8*-r,o=.5,e.moveTo(-a,i),e.bezierCurveTo(-a*o,i*o,a*o,i*o,a,i),i=.8*r,e.moveTo(-a,i),e.bezierCurveTo(-a*o,i*o,a*o,i*o,a,i),e.lineWidth=18,e.lineCap="round",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*r,.7*-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane.prototype.description=function(){var t="Epiretinal membrane";return t},ED.EpiretinalMembrane.prototype.snomedCode=function(){return 367649002},ED.EpiretinalMembrane.prototype.diagnosticHierarchy=function(){return 2},ED.FibrousProliferation=function(t,e){this.className="FibrousProliferation",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.FibrousProliferation.prototype=new ED.Doodle,ED.FibrousProliferation.prototype.constructor=ED.FibrousProliferation,ED.FibrousProliferation.superclass=ED.Doodle.prototype,ED.FibrousProliferation.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.FibrousProliferation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrousProliferation.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-200,150),this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/4:Math.PI/4},ED.FibrousProliferation.prototype.draw=function(t){var e=this.drawing.context;ED.FibrousProliferation.superclass.draw.call(this,t);var r=180,a=70,i=.6*r,o=.2*a;return e.beginPath(),e.moveTo(-r,-a),e.bezierCurveTo(-i,-o,i,-o,r,-a),e.bezierCurveTo(i,-o,i,o,r,a),e.bezierCurveTo(i,o,-i,o,-r,a),e.bezierCurveTo(-i,o,-i,-o,-r,-a),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.5)",e.fillStyle="rgba(120,120,120,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(r,-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FibrousProliferation.prototype.description=function(){return"Fibrous proliferation"},ED.FieldCircle=function(t,e){this.className="FieldCircle",this.colour=new ED.Colour(255,0,0,1),this.savedParameterArray=["originX","originY","colour"],ED.Doodle.call(this,t,e)},ED.FieldCircle.prototype=new ED.Doodle,ED.FieldCircle.prototype.constructor=ED.FieldCircle,ED.FieldCircle.superclass=ED.Doodle.prototype,ED.FieldCircle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.colour={kind:"derived",type:"colour"}},ED.FieldCircle.prototype.setParameterDefaults=function(){},ED.FieldCircle.prototype.draw=function(t){var e=this.drawing.context;return ED.FieldCircle.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,50,0,2*Math.PI,!0),e.closePath(),e.lineWidth=1,e.fillStyle=this.colour.rgba(),e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.FocalLaser=function(t,e){this.className="FocalLaser",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.FocalLaser.prototype=new ED.Doodle,ED.FocalLaser.prototype.constructor=ED.FocalLaser,ED.FocalLaser.superclass=ED.Doodle.prototype,ED.FocalLaser.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.FocalLaser.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-75,-50)},ED.FocalLaser.prototype.setParameterDefaults=function(){this.apexY=-50,this.setOriginWithDisplacements(150,80)},ED.FocalLaser.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var r=-this.apexY;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(-75>=this.apexY){var a=50,i=a/Math.sqrt(2);this.drawLaserSpot(e,0,-a),this.drawLaserSpot(e,i,-i),this.drawLaserSpot(e,a,0),this.drawLaserSpot(e,i,i),this.drawLaserSpot(e,0,a),this.drawLaserSpot(e,-i,i),this.drawLaserSpot(e,-a,0),this.drawLaserSpot(e,-i,-i)}var o=25;this.drawLaserSpot(e,0,-o),this.drawLaserSpot(e,o,0),this.drawLaserSpot(e,0,o),this.drawLaserSpot(e,-o,0),this.drawLaserSpot(e,0,0)}var s=new ED.Point(0,0);return s.setWithPolars(r,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FocalLaser.prototype.groupDescription=function(){return"Focal laser"},ED.Fuchs=function(t,e){this.className="Fuchs",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Fuchs.prototype=new ED.Doodle,ED.Fuchs.prototype.constructor=ED.Fuchs,ED.Fuchs.superclass=ED.Doodle.prototype,ED.Fuchs.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.Fuchs.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.isUnique=!0},ED.Fuchs.prototype.draw=function(t){var e=this.drawing.context;ED.Fuchs.superclass.draw.call(this,t),e.beginPath();var r=300;e.arc(0,0,r,0,2*Math.PI,!1),e.closePath();var a=e.createPattern(this.drawing.imageArray.FuchsPattern,"repeat");e.fillStyle=a,e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Fuchs.prototype.description=function(){return"Fuch's Endothelial Dystrophy"},ED.Fuchs.prototype.snomedCode=function(){return 193839007},ED.Fuchs.prototype.diagnosticHierarchy=function(){return 2},ED.Fundus=function(t,e){this.className="Fundus",ED.Doodle.call(this,t,e)},ED.Fundus.prototype=new ED.Doodle,ED.Fundus.prototype.constructor=ED.Fundus,ED.Fundus.superclass=ED.Doodle.prototype,ED.Fundus.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isFilled=!1},ED.Fundus.prototype.draw=function(t){var e=this.drawing.context;if(ED.Fundus.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,480,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2,e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawing.eye!=ED.eye.Right)var r=200,a=100,i=-50,o=-100,s=100;else var r=-200,a=-100,i=50,o=100,s=-100;e.moveTo(r,-50),e.bezierCurveTo(a,-166,0,-62,0,-12),e.bezierCurveTo(0,-40,i,-100,o,-50),e.moveTo(r,50),e.bezierCurveTo(a,166,0,62,0,12),e.bezierCurveTo(0,40,i,100,o,50);var n=10;e.moveTo(s,-n),e.lineTo(s,n),e.moveTo(s-n,0),e.lineTo(s+n,0),e.moveTo(25,0),e.arc(0,0,25,0,2*Math.PI,!0),e.moveTo(12,0),e.arc(0,0,12,0,2*Math.PI,!0),e.stroke()}return this.isClicked},ED.GRT=function(t,e){this.className="GRT",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.GRT.prototype=new ED.Doodle,ED.GRT.prototype.constructor=ED.GRT,ED.GRT.superclass=ED.Doodle.prototype,ED.GRT.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.GRT.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/2,2*Math.PI)},ED.GRT.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-350,this.setRotationWithDisplacements(0,120)},ED.GRT.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var r=476,a=-this.apexY,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=this.arc/2.3,h=-Math.PI/2+l,d=-Math.PI/2-l,c=r*Math.sin(o),p=-r*Math.cos(o),D=-r*Math.sin(o),u=p,y=i*Math.sin(l),g=-i*Math.cos(l),E=-y,m=g,f=a*Math.sin(o),P=-a*Math.cos(o),w=-f,b=P;return e.beginPath(),e.arc(0,0,r,s,n,!0),e.lineTo(E,m),e.lineTo(w,b),e.arc(0,0,a,n,s,!1),e.lineTo(y,g),e.closePath(),e.lineWidth=8,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,i,h,d,!0),e.strokeStyle="darkred",e.stroke()),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(D,u)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.GRT.prototype.description=function(){var t="Giant Retinal Tear ",e=this.rotation-this.arc/2,r=Math.floor((6*(e+.2618)/Math.PI+12)%12);0==r&&(r=12);var a=180*this.arc/Math.PI;return a=10*Math.floor((a+5)/10),t=t+a+" degrees clockwise from "+r+" o'clock"},ED.GRT.prototype.snomedCode=function(){return 232004004},ED.GRT.prototype.diagnosticHierarchy=function(){return 7},ED.Geographic=function(t,e){this.className="Geographic",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Geographic.prototype=new ED.Doodle,ED.Geographic.prototype.constructor=ED.Geographic,ED.Geographic.superclass=ED.Doodle.prototype,ED.Geographic.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Geographic.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Geographic.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.Geographic.prototype.draw=function(t){var e=this.drawing.context;ED.Geographic.superclass.draw.call(this,t);var r=200,a=-this.apexY,i=-this.apexY*Math.PI/800;e.beginPath();var o=new ED.Point(0,0);return this.drawing.eye==ED.eye.Right?(e.arc(0,0,r,i,2*Math.PI-i,!1),o.setWithPolars(a,Math.PI/2-i),e.lineTo(o.x,o.y),e.arc(0,0,a,2*Math.PI-i,i,!0)):(e.arc(0,0,r,Math.PI-i,-Math.PI+i,!0),o.setWithPolars(a,i-Math.PI/2),e.lineTo(o.x,o.y),e.arc(0,0,a,-Math.PI+i,Math.PI-i,!1)),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,50,0.8)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,o=new ED.Point(0,0),o.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(o),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Geographic.prototype.description=function(){return"Geographic atrophy"},ED.Geographic.prototype.snomedCode=function(){return 414875008},ED.Geographic.prototype.diagnosticHierarchy=function(){return 2},ED.Gonioscopy=function(t,e){this.className="Gonioscopy",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Gonioscopy.prototype=new ED.Doodle,ED.Gonioscopy.prototype.constructor=ED.Gonioscopy,ED.Gonioscopy.superclass=ED.Doodle.prototype,ED.Gonioscopy.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Gonioscopy.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Gonioscopy.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Gonioscopy.prototype.draw=function(t){var e=this.drawing.context;ED.Gonioscopy.superclass.draw.call(this,t);var r=0,a=2*Math.PI;if(e.beginPath(),e.arc(0,0,this.rsl,r,a,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,this.rtmo,r,a,!0),e.moveTo(this.rtmi,0),e.arc(0,0,this.rtmi,a,r,!1),e.lineWidth=1;var i;-440>this.apexX?(i=-440>this.apexY?e.createPattern(this.drawing.imageArray.MeshworkPatternLight,"repeat"):-420>this.apexY?e.createPattern(this.drawing.imageArray.MeshworkPatternMedium,"repeat"):e.createPattern(this.drawing.imageArray.MeshworkPatternHeavy,"repeat"),e.fillStyle=i):e.fillStyle=-440>this.apexY?"rgba(250, 200, 0, 1)":-420>this.apexY?"rgba(200, 150, 0, 1)":"rgba(150, 100, 0, 1)",e.strokeStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke(),e.beginPath(),e.arc(0,0,this.rcbo,r,a,!0),e.arc(0,0,this.rcbi,a,r,!1),e.fillStyle="rgba(200, 200, 200, 1)",e.fill();var o=15,s=new ED.Point(0,0),n=new ED.Point(0,0),l=0;for(l=0;12>l;l++){var h=(o+30*l)*Math.PI/180;s.setWithPolars(this.rcbi,h),e.beginPath(),e.moveTo(s.x,s.y),1==l||4==l||7==l||10==l?(n.setWithPolars(this.rsl+80,h),e.lineWidth=6,e.strokeStyle="rgba(20, 20, 20, 1)"):(n.setWithPolars(this.rsl,h),e.lineWidth=2,e.strokeStyle="rgba(137, 137, 137, 1)"),e.lineTo(n.x,n.y),e.closePath(),e.stroke()}e.beginPath(),e.arc(0,0,this.riro,r,a,!0),e.arc(0,0,this.riri,a,r,!1),e.lineWidth=2,e.strokeStyle="rgba(180, 180, 180, 1)",e.fillStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Gonioscopy.prototype.description=function(){var t="";return t=-440>this.apexX?-440>this.apexY?"Light patchy pigment":-420>this.apexY?"Medium patchy pigment":"Heavy patchy pigment":-440>this.apexY?"Light homogenous pigment":-420>this.apexY?"Medium homogenous pigment":"Heavy homogenous pigment"},ED.HVT=function(t,e){this.className="HVT",this.hor="None",this.ver="None",this.tor="None",this.horValue=0,this.verValue=0,this.torValue=0,ED.Doodle.call(this,t,e)},ED.HVT.prototype=new ED.Doodle,ED.HVT.prototype.constructor=ED.HVT,ED.HVT.superclass=ED.Doodle.prototype,ED.HVT.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.HVT.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.parameterValidationArray.originX.range=new ED.Range(-350,-150),this.parameterValidationArray.originY.range=new ED.Range(-100,100),this.parameterValidationArray.rotation.range=new ED.Range(0,Math.PI/2),this.parameterValidationArray.hor={kind:"derived",type:"string",list:["XT","None","ET"],animate:!0},this.parameterValidationArray.ver={kind:"derived",type:"string",list:["R/L","None","L/R"],animate:!0},this.parameterValidationArray.tor={kind:"derived",type:"string",list:["Excyclotorsion","None","Incyclotorsion"],animate:!0},this.parameterValidationArray.horValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.verValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.torValue={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0}},ED.HVT.prototype.setParameterDefaults=function(){},ED.HVT.prototype.dependentParameterValues=function(t,e){var r=[],a=-250;switch(t){case"originX":var i=20;r.hor=a-i>e?"XT":e>a+i?"ET":"None",r.horValue=Math.abs(Math.round((a-e)/2));break;case"originY":var i=20;r.ver=0-i>e?"R/L":e>0+i?"L/R":"None",r.verValue=Math.abs(Math.round(-e/2));break;case"rotation":var i=Math.PI/16;r.tor=Math.PI/4-i>e?"Excyclotorsion":e>Math.PI/4+i?"Incyclotorsion":"None",r.torValue=Math.abs(Math.round(80*(e-Math.PI/4)/Math.PI));break;case"hor":switch(e){case"XT":r.originX=a-100;break;case"ET":r.originX=a+100;break;default:r.originX=a}break;case"ver":switch(e){case"R/L":r.originY=-100;break;case"L/R":r.originY=100;break;default:r.originY=0}break;case"tor":switch(e){case"Excyclotorsion":r.rotation=0;break;case"Incyclotorsion":r.rotation=Math.PI/2;break;default:r.rotation=Math.PI/4}break;case"horValue":switch(this.hor){case"XT":r.originX=a-2*e;break;case"None":r.originX=a;break;case"ET":r.originX=a+2*e}break;case"verValue":switch(this.ver){case"R/L":r.originY=2*-e;break;case"None":r.originY=Math.PI/4;break;case"L/R":r.originY=2*e}break;case"torValue":switch(this.tor){case"Excyclotorsion":r.rotation=-e*Math.PI/80+Math.PI/4;break;case"None":r.rotation=Math.PI/4;break;case"Incyclotorsion":r.rotation=e*Math.PI/80+Math.PI/4}}return r},ED.HVT.prototype.draw=function(t){var e=this.drawing.context;ED.HVT.superclass.draw.call(this,t);var r=125,a=40,i=1.75*Math.PI,o=new ED.Point(0,0);if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.moveTo(a,0),e.arc(0,0,a,2*Math.PI,0,!1),e.lineWidth=4,e.fillStyle=e.fillStyle="rgba(100, 200, 250, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var s=5;e.beginPath(),o.setWithPolars(r-s,i),e.moveTo(o.x,o.y),o.setWithPolars(a+s,i),e.lineTo(o.x,o.y),o.setWithPolars(-r+s,i),e.moveTo(o.x,o.y),o.setWithPolars(-a-s,i),e.lineTo(o.x,o.y),e.lineWidth=20,e.strokeStyle=this.originX>0?"rgba(255, 0, 0, 0.8)":"rgba(0, 155, 0, 0.8)",e.stroke()}return o.setWithPolars(r,i),this.handleArray[1].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.HVTGrid=function(t,e){this.className="HVTGrid",ED.Doodle.call(this,t,e)},ED.HVTGrid.prototype=new ED.Doodle,ED.HVTGrid.prototype.constructor=ED.HVTGrid,ED.HVTGrid.superclass=ED.Doodle.prototype,ED.HVTGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.HVTGrid.prototype.draw=function(t){var e=this.drawing.context;ED.HVTGrid.superclass.draw.call(this,t),e.beginPath();var r=125,a=2*r;return e.moveTo(-2*a,0),e.lineTo(2*a,0),e.moveTo(-a,-a),e.lineTo(-a,+a),e.moveTo(+a,-a),e.lineTo(+a,+a),e.lineWidth=4,e.strokeStyle="gray",this.drawBoundary(t),this.isClicked},ED.HardDrusen=function(t,e){this.className="HardDrusen",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.HardDrusen.prototype=new ED.Doodle,ED.HardDrusen.prototype.constructor=ED.HardDrusen,ED.HardDrusen.superclass=ED.Doodle.prototype,ED.HardDrusen.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.HardDrusen.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.HardDrusen.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.HardDrusen.prototype.draw=function(t){var e=this.drawing.context;ED.HardDrusen.superclass.draw.call(this,t),e.beginPath();var r=200;if(e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var a="yellow",i=10/this.scaleX,o=new ED.Point(0,0),s=20+Math.abs(Math.floor(this.apexY/2)),n=0;s>n;n++)o.setWithPolars(r*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,i,a);
return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*r,.7*-r)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.HardDrusen.prototype.description=function(){var t="Signficant numbers of ";return this.apexY>-100&&(t="Moderate numbers of "),this.apexY>-50&&(t="Several "),t+"hard drusen"},ED.HardExudate=function(t,e){this.className="HardExudate",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.HardExudate.prototype=new ED.Doodle,ED.HardExudate.prototype.constructor=ED.HardExudate,ED.HardExudate.superclass=ED.Doodle.prototype,ED.HardExudate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.HardExudate.prototype.draw=function(t){var e=this.drawing.context;ED.HardExudate.superclass.draw.call(this,t);var r=14;return e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(220,220,0,1)",e.fillStyle="rgba(220,220,0,1)",this.drawBoundary(t),this.isClicked},ED.HardExudate.prototype.groupDescription=function(){return"Hard exudates"},ED.Hyphaema=function(t,e){this.className="Hyphaema",this.ro=380,this.minimum=304,this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Hyphaema.prototype=new ED.Doodle,ED.Hyphaema.prototype.constructor=ED.Hyphaema,ED.Hyphaema.superclass=ED.Doodle.prototype,ED.Hyphaema.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hyphaema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hyphaema.prototype.setParameterDefaults=function(){this.apexY=152},ED.Hyphaema.prototype.draw=function(t){var e=this.drawing.context;ED.Hyphaema.superclass.draw.call(this,t);var r=Math.asin(this.apexY/this.ro);e.beginPath(),e.arc(0,0,this.ro,r,Math.PI-r,!1),e.closePath();var a=(.1+(this.apexX+50)/111).toFixed(2);return e.fillStyle="rgba(255,0,0,"+a+")",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hyphaema.prototype.description=function(){var t=10*Math.round(10*(this.ro-this.apexY)/(2*this.ro));return t+"% hyphaema"},ED.Hypopyon=function(t,e){this.className="Hypopyon",this.ro=380,this.minimum=304,this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e)},ED.Hypopyon.prototype=new ED.Doodle,ED.Hypopyon.prototype.constructor=ED.Hypopyon,ED.Hypopyon.superclass=ED.Doodle.prototype,ED.Hypopyon.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hypopyon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hypopyon.prototype.setParameterDefaults=function(){this.apexY=260},ED.Hypopyon.prototype.draw=function(t){var e=this.drawing.context;ED.Hypopyon.superclass.draw.call(this,t);var r=Math.asin(this.apexY/this.ro);return e.beginPath(),e.arc(0,0,this.ro,r,Math.PI-r,!1),e.closePath(),e.fillStyle="rgba(221,209,171,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hypopyon.prototype.description=function(){var t=Math.round(10*(this.ro-this.apexY)/(2*this.ro));return t+"mm hypopyon"},ED.ILMPeel=function(t,e){this.className="ILMPeel",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.ILMPeel.prototype=new ED.Doodle,ED.ILMPeel.prototype.constructor=ED.ILMPeel,ED.ILMPeel.superclass=ED.Doodle.prototype,ED.ILMPeel.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.ILMPeel.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.ILMPeel.prototype.setParameterDefaults=function(){this.apexY=-60,this.rotation=Math.PI/4,this.originX=this.drawing.eye==ED.eye.Right?-100:100},ED.ILMPeel.prototype.draw=function(t){var e=this.drawing.context;ED.ILMPeel.superclass.draw.call(this,t),e.beginPath();var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);return e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=2,e.fillStyle="rgba(220, 220, 220, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ILMPeel.prototype.groupDescription=function(){return"ILM peel"},ED.IRMA=function(t,e){this.className="IRMA",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.IRMA.prototype=new ED.Doodle,ED.IRMA.prototype.constructor=ED.IRMA,ED.IRMA.superclass=ED.Doodle.prototype,ED.IRMA.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.IRMA.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(1,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(1,1.5)},ED.IRMA.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(100,100)},ED.IRMA.prototype.draw=function(t){var e=this.drawing.context;return ED.IRMA.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,30),e.bezierCurveTo(-30,30,-70,0,-50,-20),e.bezierCurveTo(-30,-40,-20,-10,0,-10),e.bezierCurveTo(20,-10,30,-40,50,-20),e.bezierCurveTo(70,0,30,30,0,30),e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(50,-40)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IRMA.prototype.groupDescription=function(){return"Intraretinal microvascular abnormalities "},ED.IRMA.prototype.description=function(){return this.locationRelativeToFovea()},ED.IatrogenicBreak=function(t,e){this.className="IatrogenicBreak",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.IatrogenicBreak.prototype=new ED.Doodle,ED.IatrogenicBreak.prototype.constructor=ED.IatrogenicBreak,ED.IatrogenicBreak.superclass=ED.Doodle.prototype,ED.IatrogenicBreak.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.IatrogenicBreak.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.8,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.8,2)},ED.IatrogenicBreak.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(240,-50)},ED.IatrogenicBreak.prototype.draw=function(t){var e=this.drawing.context;ED.IatrogenicBreak.superclass.draw.call(this,t),e.beginPath();var r=40,a=.8,i=new ED.Point(-r,r),o=new ED.Point(r,-r);return e.moveTo(i.x,i.y),e.bezierCurveTo(i.x,i.y-a*r,o.x-a*r,o.y,o.x,o.y),e.bezierCurveTo(o.x,o.y+a*r,i.x+a*r,i.y,i.x,i.y),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IatrogenicBreak.prototype.description=function(){return"Iatrogenic break in "+this.quadrant()},ED.InjectionSite=function(t,e){this.className="InjectionSite",this.parsPlana=-560,this.distance="3.5",this.savedParameterArray=["apexY","rotation"],ED.Doodle.call(this,t,e)},ED.InjectionSite.prototype=new ED.Doodle,ED.InjectionSite.prototype.constructor=ED.InjectionSite,ED.InjectionSite.superclass=ED.Doodle.prototype,ED.InjectionSite.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.InjectionSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-550,-470),this.parameterValidationArray.distance={kind:"derived",type:"string",list:["4.5","4.0","3.5","3.0","2.5"],animate:!1}},ED.InjectionSite.prototype.setParameterDefaults=function(){this.apexY=-510,this.distance="3.5",this.setRotationWithDisplacements(45,30)},ED.InjectionSite.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.distance=-540>e?"4.5":-520>e?"4.0":-500>e?"3.5":-480>e?"3.0":"2.5";break;case"distance":r.apexY="4.5"==e?-550:"4.0"==e?-530:"3.5"==e?-510:"3.0"==e?-490:-470}return r},ED.InjectionSite.prototype.draw=function(t){var e=this.drawing.context;ED.InjectionSite.superclass.draw.call(this,t),e.beginPath();var r=this.parsPlana-300;if(e.moveTo(-80,r),e.lineTo(80,r),e.lineTo(70,r+30),e.lineTo(50,r+240),e.lineTo(20,r+260),e.lineTo(-20,r+260),e.lineTo(-50,r+240),e.lineTo(-70,r+30),e.closePath(),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 1)",e.fillStyle="rgba(255, 255, 0, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-70,r+30),e.lineTo(70,r+30),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(-60,r+130),e.lineTo(60,r+130),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(0,r+130),e.lineTo(0,r+230),e.lineWidth=32,e.strokeStyle="rgba(120, 120, 120, 0.2)",e.stroke(),e.beginPath(),e.moveTo(50,r+240),e.lineTo(20,r+260),e.lineTo(-20,r+260),e.lineTo(-50,r+240),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 1)",e.strokeStyle="rgba(0, 0, 0, 0.5)",e.fill(),e.stroke(),e.beginPath(),e.moveTo(-10,r+260),e.lineTo(10,r+260),e.lineTo(10,this.apexY),e.lineTo(-10,this.apexY),e.closePath(),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(-10,this.apexY),e.lineTo(10,this.apexY),e.lineTo(10,-130),e.lineTo(-10,-100),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(60, 60, 60, 1)",e.stroke();var a=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));e.save(),e.setTransform(1,0,0,1,0,0),e.lineWidth=1,e.fillStyle="gray",e.font="18px sans-serif",e.fillText(this.distance+" mm",a.x+10,a.y-5),e.restore()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.InjectionSite.prototype.groupDescription=function(){return"Injection at "},ED.InjectionSite.prototype.description=function(){return this.clockHour()+" o'clock "+this.distance+" from limbus"},ED.IrisHook=function(t,e){this.className="IrisHook",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.IrisHook.prototype=new ED.Doodle,ED.IrisHook.prototype.constructor=ED.IrisHook,ED.IrisHook.superclass=ED.Doodle.prototype,ED.IrisHook.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isScaleable=!1},ED.IrisHook.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(45,90)},ED.IrisHook.prototype.draw=function(t){var e=this.drawing.context;ED.IrisHook.superclass.draw.call(this,t),e.beginPath();var r=260,a=this.drawing.lastDoodleOfClass("AntSeg");return a&&(r=-a.apexY),e.rect(-25,-440,50,180+r),e.closePath(),e.fillStyle="rgba(255,255,255,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(10,-430),e.lineTo(10,-r+10),e.lineTo(-10,-r),e.lineWidth=12,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke(),e.beginPath(),e.moveTo(-20,-400),e.lineTo(40,-400),e.lineWidth=24,e.strokeStyle="rgba(255,120,0,0.75)",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisHook.prototype.groupDescription=function(){return"Iris hooks used at "},ED.IrisHook.prototype.description=function(){var t="";return t+=this.clockHour()},ED.IrisHook.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.IrisNaevus=function(t,e){this.className="IrisNaevus",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.IrisNaevus.prototype=new ED.Doodle,ED.IrisNaevus.prototype.constructor=ED.IrisNaevus,ED.IrisNaevus.superclass=ED.Doodle.prototype,ED.IrisNaevus.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.IrisNaevus.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0},ED.IrisNaevus.prototype.setParameterDefaults=function(){this.originY=-320,this.scaleX=1.8},ED.IrisNaevus.prototype.draw=function(t){var e=this.drawing.context;ED.IrisNaevus.superclass.draw.call(this,t),e.beginPath();var r=50;e.arc(0,0,r,0,2*Math.PI,!1),e.closePath(),e.fillStyle="brown",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisNaevus.prototype.description=function(){return"Iris naevus"},ED.KeraticPrecipitates=function(t,e){this.className="KeraticPrecipitates",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.KeraticPrecipitates.prototype=new ED.Doodle,ED.KeraticPrecipitates.prototype.constructor=ED.KeraticPrecipitates,ED.KeraticPrecipitates.superclass=ED.Doodle.prototype,ED.KeraticPrecipitates.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.KeraticPrecipitates.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,40),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.KeraticPrecipitates.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.KeraticPrecipitates.prototype.draw=function(t){var e=this.drawing.context;ED.KeraticPrecipitates.superclass.draw.call(this,t),e.beginPath();var r=200;if(e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var a="rgba(110, 110, 110, 0.5)",i=10*((this.apexX+20)/20)/this.scaleX,o=new ED.Point(0,0),s=40+Math.abs(Math.floor(this.apexY/2)),n=0;s>n;n++)o.setWithPolars(r*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,i,a);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*r,.7*-r)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KeraticPrecipitates.prototype.description=function(){return this.apexX>20?"Mutton fat keratic precipitates":"Keratic precipitates"},ED.KoeppeNodule=function(t,e){this.className="KoeppeNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.KoeppeNodule.prototype=new ED.Doodle,ED.KoeppeNodule.prototype.constructor=ED.KoeppeNodule,ED.KoeppeNodule.superclass=ED.Doodle.prototype,ED.KoeppeNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.KoeppeNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.KoeppeNodule.prototype.draw=function(t){var e=this.drawing.context;ED.KoeppeNodule.superclass.draw.call(this,t);var r=260,a=this.drawing.lastDoodleOfClass("AntSeg");return a&&(r=-a.apexY),e.beginPath(),e.arc(0,-r,20,0,2*Math.PI,!1),e.fillStyle="rgba(150,100,50,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.KoeppeNodule.prototype.groupDescription=function(){return"Koeppe nodules"},ED.KrukenbergSpindle=function(t,e){this.className="KrukenbergSpindle",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.KrukenbergSpindle.prototype=new ED.Doodle,ED.KrukenbergSpindle.prototype.constructor=ED.KrukenbergSpindle,ED.KrukenbergSpindle.superclass=ED.Doodle.prototype,ED.KrukenbergSpindle.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.KrukenbergSpindle.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80)},ED.KrukenbergSpindle.prototype.setParameterDefaults=function(){this.apexY=-150,this.originY=200},ED.KrukenbergSpindle.prototype.draw=function(t){var e=this.drawing.context;return ED.KrukenbergSpindle.superclass.draw.call(this,t),e.beginPath(),this.addEllipseToPath(e,0,0,-this.apexY/2,2*-this.apexY),e.fillStyle=e.createPattern(this.drawing.imageArray.BrownSpotPattern,"repeat"),e.strokeStyle="rgba(255,128,0,0.5)",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KrukenbergSpindle.prototype.description=function(){return"Krukenberg spindle"},ED.LaserCircle=function(t,e){this.className="LaserCircle",this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.LaserCircle.prototype=new ED.Doodle,ED.LaserCircle.prototype.constructor=ED.LaserCircle,ED.LaserCircle.superclass=ED.Doodle.prototype,ED.LaserCircle.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!0)},ED.LaserCircle.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-50)},ED.LaserCircle.prototype.setParameterDefaults=function(){this.apexX=84,this.apexY=-84;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),r=new ED.Point(0,0);r.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(r.x,r.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.LaserCircle.prototype.draw=function(t){var e=this.drawing.context;if(ED.LaserCircle.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(this.apexX,-this.apexY),e.lineTo(-this.apexX,-this.apexY),e.lineTo(-this.apexX,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=25,a=new ED.Point(0,0),i=this.apexX+this.apexY;if(0>i)var o=this.apexX;else var o=-this.apexY;for(var s=Math.round(Math.PI/(r/o)),n=0;s+1>n;n++)if(0>i){var l=-Math.PI/2+n*Math.PI/s;a.setWithPolars(o,l),this.drawLaserSpot(e,a.x,a.y+i)}else{var l=-Math.PI+n*Math.PI/s;a.setWithPolars(o,l),this.drawLaserSpot(e,a.x-i,a.y)}for(var n=1;s>n;n++)if(0>i){var l=Math.PI/2+n*Math.PI/s;a.setWithPolars(o,l),this.drawLaserSpot(e,a.x,a.y-i)}else{var l=0+n*Math.PI/s;a.setWithPolars(o,l),this.drawLaserSpot(e,a.x+i,a.y)}s=Math.abs(Math.round(i/r));for(var n=0;2*s+1>n;n++)if(0>i){var h=this.apexY+o+n*Math.abs(i/s);this.drawLaserSpot(e,-o,h),this.drawLaserSpot(e,o,h)}else{var d=-this.apexX+o+n*Math.abs(i/s);this.drawLaserSpot(e,d,-o),this.drawLaserSpot(e,d,o)}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserCircle.prototype.groupDescription=function(){return"laser retinopexy"},ED.LaserDemarcation=function(t,e){this.className="LaserDemarcation",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.LaserDemarcation.prototype=new ED.Doodle,ED.LaserDemarcation.prototype.constructor=ED.LaserDemarcation,ED.LaserDemarcation.superclass=ED.Doodle.prototype,ED.LaserDemarcation.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.LaserDemarcation.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.LaserDemarcation.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-350;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/4:this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI,t=this.drawing.lastDoodleOfClass("PeripheralRetinectomy"),t&&(this.rotation=t.rotation,this.arc=t.arc+Math.PI/16,this.apexY=t.apexY+50)},ED.LaserDemarcation.prototype.draw=function(t){var e=this.drawing.context;ED.LaserDemarcation.superclass.draw.call(this,t);var r=476,a=-this.apexY,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,i,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var p=25,D=new ED.Point(0,0);if(this.arc<1.9*Math.PI){for(var u=r-a,y=Math.PI/2,g=Math.round(y/(p/u)),E=new ED.Point(-r*Math.sin(o-u/r),-r*Math.cos(o-u/r)),m=0;g>m;m++)D.setWithPolars(u,n+.5*(u/r)-m*y/g),this.drawLaserSpot(e,E.x+D.x,E.y+D.y);for(var f=this.arc-2*u/r,P=Math.round(f/(p/a)),w=E.direction(),m=0;P+1>m;m++)D.setWithPolars(a,w+m*f/P),this.drawLaserSpot(e,D.x,D.y);for(var b=new ED.Point(-r*Math.sin(-o+u/r),-r*Math.cos(-o+u/r)),m=0;g>m;m++)D.setWithPolars(u,s+Math.PI-.5*(u/r)+m*y/g),this.drawLaserSpot(e,b.x+D.x,b.y+D.y)}else for(var g=Math.round(2*Math.PI/(p/a)),m=0;g>m;m++)D.setWithPolars(a,2*m*Math.PI/g),this.drawLaserSpot(e,D.x,D.y)}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserDemarcation.prototype.description=function(){var t="";return this.arc>1.9*Math.PI&&(t+="360 degree "),t+="laser demarcation"},ED.LaserSpot=function(t,e){this.className="LaserSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.LaserSpot.prototype=new ED.Doodle,ED.LaserSpot.prototype.constructor=ED.LaserSpot,ED.LaserSpot.superclass=ED.Doodle.prototype,ED.LaserSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.LaserSpot.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.LaserSpot.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(100,80)},ED.LaserSpot.prototype.draw=function(t){var e=this.drawing.context;ED.LaserSpot.superclass.draw.call(this,t);var r=30;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2*r/3,e.fillStyle="yellow",e.strokeStyle="rgba(255, 128, 0, 1)",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserSpot.prototype.groupDescription=function(){return"Laser spots"},ED.LasikFlap=function(t,e){this.className="LasikFlap",this.savedParameterArray=["scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.LasikFlap.prototype=new ED.Doodle,ED.LasikFlap.prototype.constructor=ED.LasikFlap,ED.LasikFlap.superclass=ED.Doodle.prototype,ED.LasikFlap.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.LasikFlap.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.75,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.75,1.15)},ED.LasikFlap.prototype.setParameterDefaults=function(){this.apexY=-100},ED.LasikFlap.prototype.draw=function(t){var e=this.drawing.context;ED.LasikFlap.superclass.draw.call(this,t);var r=320,a=Math.PI/6,i=-Math.PI/2-a,o=-Math.PI/2+a;e.beginPath(),e.arc(0,0,r,i,o,!0),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var s=new ED.Point(0,0);return s.setWithPolars(r,a),this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LasikFlap.prototype.description=function(){var t="";if(this.drawing.eye==ED.eye.Right)var e=!0;else var e=!1;var r=Math.cos(this.rotation),a=Math.sin(this.rotation),i=Math.abs(r),o=Math.abs(a),s="";return a>r&&o>i&&(s=e?"nasal":"temporal"),a>r&&i>o&&(s="inferior"),r>a&&o>i&&(s=e?"temporal":"nasal"),r>a&&i>o&&(s="superior"),t="LASIK flap with "+s+" hinge"},ED.Lens=function(t,e){this.className="Lens",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.Lens.prototype=new ED.Doodle,ED.Lens.prototype.constructor=ED.Lens,ED.Lens.superclass=ED.Doodle.prototype,ED.Lens.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500)},ED.Lens.prototype.setParameterDefaults=function(){},ED.Lens.prototype.draw=function(t){var e=this.drawing.context;ED.Lens.superclass.draw.call(this,t);var r=240;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var a=r-60;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LensCrossSection=function(t,e){this.className="LensCrossSection",ED.Doodle.call(this,t,e)},ED.LensCrossSection.prototype=new ED.Doodle,ED.LensCrossSection.prototype.constructor=ED.LensCrossSection,ED.LensCrossSection.superclass=ED.Doodle.prototype,ED.LensCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,200),this.parameterValidationArray.originY.range.setMinAndMax(-380,380)},ED.LensCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.LensCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.LensCrossSection.superclass.draw.call(this,t);var r=240,a=300,i=100,o=Math.asin(r/a),s=a*Math.cos(o),n=a-60,l=Math.acos(s/n);return e.beginPath(),e.arc(i-s,0,a,o,-o,!0),e.arc(i+s,0,a,Math.PI+o,Math.PI-o,!0),e.stroke(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(i,n*Math.sin(l)),e.arc(i-s,0,n,l,-l,!0),e.arc(i+s,0,n,Math.PI+l,Math.PI-l,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke(),e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+80,-this.originY+349),e.lineTo(64,207),e.moveTo(44-this.originX+80,-this.originY+349),e.lineTo(138,207),e.moveTo(44-this.originX+120,-this.originY+349),e.lineTo(64,207),e.moveTo(44-this.originX+120,-this.originY+349),e.lineTo(138,207),e.lineWidth=2,e.strokeStyle="gray",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LimbalRelaxingIncision=function(t,e){this.className="LimbalRelaxingIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.LimbalRelaxingIncision.prototype=new ED.Doodle,ED.LimbalRelaxingIncision.prototype.constructor=ED.LimbalRelaxingIncision,ED.LimbalRelaxingIncision.superclass=ED.Doodle.prototype,ED.LimbalRelaxingIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.LimbalRelaxingIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2)},ED.LimbalRelaxingIncision.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t?(this.rotation=t.rotation+Math.PI,this.arc=t.arc):this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/2:Math.PI/2},ED.LimbalRelaxingIncision.prototype.draw=function(t){var e=this.drawing.context;ED.LimbalRelaxingIncision.superclass.draw.call(this,t);var r=360,a=12,i=r+a,o=r-a;e.beginPath();var s=this.arc/2;e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(100,100,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t);var n=new ED.Point(0,0);return n.setWithPolars(r,s),this.handleArray[3].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LimbalRelaxingIncision.prototype.description=function(){var t="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.Macroaneurysm=function(t,e){this.className="Macroaneurysm",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Macroaneurysm.prototype=new ED.Doodle,ED.Macroaneurysm.prototype.constructor=ED.Macroaneurysm,ED.Macroaneurysm.superclass=ED.Doodle.prototype,ED.Macroaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithRotations(300,60,60)},ED.Macroaneurysm.prototype.draw=function(t){var e=this.drawing.context;ED.Macroaneurysm.superclass.draw.call(this,t);var r=50;return e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(e.beginPath(),e.arc(0,0,25,0,2*Math.PI,!0),e.fillStyle="rgba(197,186,80,1)",e.fill()),this.isClicked},ED.Macroaneurysm.prototype.description=function(){return"Macroaneurysm"},ED.Macroaneurysm.prototype.snomedCode=function(){return 247124009},ED.MacularDystrophy=function(t,e){this.className="MacularDystrophy",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularDystrophy.prototype=new ED.Doodle,ED.MacularDystrophy.prototype.constructor=ED.MacularDystrophy,ED.MacularDystrophy.superclass=ED.Doodle.prototype,ED.MacularDystrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularDystrophy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,100)},ED.MacularDystrophy.prototype.setParameterDefaults=function(){this.apexY=-100},ED.MacularDystrophy.prototype.draw=function(t){var e=this.drawing.context;ED.MacularDystrophy.superclass.draw.call(this,t);
var r=150;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(255,0,0,0)",e.fillStyle="rgba(255,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(-50>this.apexY?(e.beginPath(),e.moveTo(-200,0),e.bezierCurveTo(-200,-70,-100,-140,0,-140),e.bezierCurveTo(100,-140,200,-70,200,0),e.bezierCurveTo(200,70,100,140,0,140),e.bezierCurveTo(-100,140,-200,70,-200,0),e.fillStyle="rgba(223,80,20,1)",e.fill(),e.beginPath(),e.moveTo(-100,0),e.bezierCurveTo(-100,-35,-50,-70,0,-70),e.bezierCurveTo(50,-70,100,-35,100,0),e.bezierCurveTo(100,35,50,70,0,70),e.bezierCurveTo(-50,70,-100,35,-100,0),e.fillStyle="rgba(125,65,54,1)",e.fill()):0>this.apexY?(e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.fillStyle="yellow",e.strokeStyle="brown",e.lineWidth=20,e.fill(),e.stroke()):(e.beginPath(),e.arc(0,0,120,0,2*Math.PI,!0),e.fillStyle="rgba(255, 120, 120, 0.5)",e.strokeStyle=e.fillStyle,e.lineWidth=1,e.fill()));var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularDystrophy.prototype.groupDescription=function(){return-50>this.apexY?"Bull's eye maculopathy":0>this.apexY?"Vitelliform macular dystrophy":"Atrophic macular dystrophy"},ED.MacularDystrophy.prototype.snomedCode=function(){return 276436007},ED.MacularGrid=function(t,e){this.className="MacularGrid",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularGrid.prototype=new ED.Doodle,ED.MacularGrid.prototype.constructor=ED.MacularGrid,ED.MacularGrid.superclass=ED.Doodle.prototype,ED.MacularGrid.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularGrid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-150,-50)},ED.MacularGrid.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.MacularGrid.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var r=250,a=-this.apexY;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.arc(0,0,a,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=60;n=Math.floor(2*r/i);for(var o=-n/2*i,s=0;n+1>s;s++)for(var l=0;n+1>l;l++){var h=o+s*i+Math.round(15*(-.5+ED.randomArray[s+l])),d=o+l*i+Math.round(15*(-.5+ED.randomArray[s+l+100])),c=h*h+d*d;c>=a*a&&r*r>=c&&this.drawLaserSpot(e,h,d)}}var p=new ED.Point(0,0);return p.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(p),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularGrid.prototype.description=function(){return"Macular grid laser"},ED.MacularHole=function(t,e){this.className="MacularHole",this.savedParameterArray=["originX","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularHole.prototype=new ED.Doodle,ED.MacularHole.prototype.constructor=ED.MacularHole,ED.MacularHole.superclass=ED.Doodle.prototype,ED.MacularHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.MacularHole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MacularHole.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.MacularHole.prototype.draw=function(t){var e=this.drawing.context;ED.MacularHole.superclass.draw.call(this,t);var r=40;return e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="yellow",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,2*r/3,0,2*Math.PI,!0),e.closePath(),e.fillStyle="red",e.fill()),point=new ED.Point(0,0),point.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularHole.prototype.description=function(){return"Macular hole"},ED.MacularHole.prototype.snomedCode=function(){return 232006002},ED.MacularHole.prototype.diagnosticHierarchy=function(){return 2},ED.MacularThickening=function(t,e){this.className="MacularThickening",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e),this.rotation=-Math.PI/4},ED.MacularThickening.prototype=new ED.Doodle,ED.MacularThickening.prototype.constructor=ED.MacularThickening,ED.MacularThickening.superclass=ED.Doodle.prototype,ED.MacularThickening.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularThickening.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(100,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.MacularThickening.prototype.setParameterDefaults=function(){this.apexX=100,this.apexY=0,this.setOriginWithDisplacements(0,150)},ED.MacularThickening.prototype.draw=function(t){var e=this.drawing.context;ED.MacularThickening.superclass.draw.call(this,t);var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var a=30;e.moveTo(-r,0),e.lineTo(r,0);for(var i=-1;2>i;i+=2)for(var o=a;r>o;o+=a){var s=this.xForY(r,o);e.moveTo(-s,i*o),e.lineTo(s,i*o)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularThickening.prototype.groupDescription=function(){return"Macular thickening "},ED.MacularThickening.prototype.description=function(){return this.locationRelativeToFovea()},ED.MattressSuture=function(t,e){this.className="MattressSuture",this.savedParameterArray=["radius","rotation"],ED.Doodle.call(this,t,e)},ED.MattressSuture.prototype=new ED.Doodle,ED.MattressSuture.prototype.constructor=ED.MattressSuture,ED.MattressSuture.superclass=ED.Doodle.prototype,ED.MattressSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.MattressSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.MattressSuture.prototype.draw=function(t){var e=this.drawing.context;ED.MattressSuture.superclass.draw.call(this,t),e.beginPath();var r=this.radius;return e.rect(-40,-(r+40),80,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-40,-(r+40)),e.lineTo(40,-(r+40)),e.lineTo(-40,-(r-40)),e.lineTo(40,-(r-40)),e.lineTo(-40,-(r+40)),e.lineWidth=2,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MattressSuture.prototype.description=function(){var t="Mattress suture at ";return t+=this.clockHour()+" o'clock"},ED.Microaneurysm=function(t,e){this.className="Microaneurysm",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.Microaneurysm.prototype=new ED.Doodle,ED.Microaneurysm.prototype.constructor=ED.Microaneurysm,ED.Microaneurysm.superclass=ED.Doodle.prototype,ED.Microaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.Microaneurysm.prototype.draw=function(t){var e=this.drawing.context;ED.Microaneurysm.superclass.draw.call(this,t);var r=14;return e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.isClicked},ED.Microaneurysm.prototype.groupDescription=function(){return"Microaneurysms"},ED.Molteno=function(t,e){this.className="Molteno",this.platePosition="STQ",this.savedParameterArray=["rotation","apexY"],ED.Doodle.call(this,t,e)},ED.Molteno.prototype=new ED.Doodle,ED.Molteno.prototype.constructor=ED.Molteno,ED.Molteno.superclass=ED.Doodle.prototype,ED.Molteno.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Molteno.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var t=Math.PI/4;this.anglesArray=[t,3*t,5*t,7*t]},ED.Molteno.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ")},ED.Molteno.prototype.dependentParameterValues=function(t,e){var r=[],a=this.drawing.eye==ED.eye.Right,i=Math.PI/4;switch(t){case"rotation":r.platePosition=this.rotation>0&&2*i>=this.rotation?a?"SNQ":"STQ":this.rotation>2*i&&4*i>=this.rotation?a?"INQ":"ITQ":this.rotation>4*i&&6*i>=this.rotation?a?"ITQ":"INQ":a?"STQ":"SNQ";break;case"platePosition":switch(e){case"STQ":r.rotation=a?7*i:i;break;case"SNQ":r.rotation=a?i:7*i;break;case"INQ":r.rotation=a?3*i:5*i;break;case"ITQ":r.rotation=a?5*i:3*i}}return r},ED.Molteno.prototype.draw=function(t){var e=this.drawing.context;ED.Molteno.superclass.draw.call(this,t),e.beginPath();var r=.41666667,a=-740;return e.arc(0,a,310*r,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,a,250*r,0,2*Math.PI,!0),e.stroke(),this.drawSpot(e,-200*r,200*r+a,5,"rgba(255,255,255,1)"),this.drawSpot(e,-200*r,-200*r+a,5,"rgba(255,255,255,1)"),this.drawSpot(e,200*r,-200*r+a,5,"rgba(255,255,255,1)"),this.drawSpot(e,200*r,200*r+a,5,"rgba(255,255,255,1)"),e.moveTo(-20*r,290*r+a),e.lineTo(-20*r,this.apexY),e.lineTo(20*r,this.apexY),e.lineTo(20*r,290*r+a),e.strokeStyle="rgba(150,150,150,0.5)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Molteno.prototype.description=function(){var t={STQ:"superotemporal",SNQ:"superonasal",INQ:"inferonasal",ITQ:"inferotemporal"};return"Molteno tube in the "+t[this.platePosition]+" quadrant"},ED.NerveFibreDefect=function(t,e){this.className="NerveFibreDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.NerveFibreDefect.prototype=new ED.Doodle,ED.NerveFibreDefect.prototype.constructor=ED.NerveFibreDefect,ED.NerveFibreDefect.superclass=ED.Doodle.prototype,ED.NerveFibreDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NerveFibreDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-560,-400)},ED.NerveFibreDefect.prototype.setParameterDefaults=function(){this.arc=20*Math.PI/180,this.apexY=-460,this.setRotationWithDisplacements(150,-120)},ED.NerveFibreDefect.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var r=-this.apexY,a=360,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;return e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200, 200, 200, 0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NerveFibreDefect.prototype.groupDescription=function(){return"Nerve fibre layer defect at "},ED.NerveFibreDefect.prototype.description=function(){return this.clockHour()+" o'clock"},ED.NuclearCataract=function(t,e){this.className="NuclearCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.NuclearCataract.prototype=new ED.Doodle,ED.NuclearCataract.prototype.constructor=ED.NuclearCataract,ED.NuclearCataract.superclass=ED.Doodle.prototype,ED.NuclearCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-120,0),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.NuclearCataract.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.grade=-80>e?"Mild":-40>e?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":r.apexY=-120;break;case"Moderate":r.apexY=-80;break;case"Brunescent":r.apexY=0}}return r},ED.NuclearCataract.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,200,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var r="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",a=e.createRadialGradient(0,0,210,0,0,50);return a.addColorStop(0,yellowColour),a.addColorStop(1,r),e.fillStyle=a,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NuclearCataract.prototype.description=function(){return this.getParameter("grade")+" nuclear cataract"},ED.NuclearCataract.prototype.snomedCode=function(){return 53889007},ED.NuclearCataract.prototype.diagnosticHierarchy=function(){return 3},ED.NuclearCataractCrossSection=function(t,e){this.className="NuclearCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.NuclearCataractCrossSection.prototype=new ED.Doodle,ED.NuclearCataractCrossSection.prototype.constructor=ED.NuclearCataractCrossSection,ED.NuclearCataractCrossSection.superclass=ED.Doodle.prototype,ED.NuclearCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(100,100),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataractCrossSection.prototype.setParameterDefaults=function(){this.apexX=100,this.originX=44,this.setParameterFromString("grade","Mild")},ED.NuclearCataractCrossSection.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.grade=-80>e?"Mild":-40>e?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":r.apexY=-120;break;case"Moderate":r.apexY=-80;break;case"Brunescent":r.apexY=0}}return r},ED.NuclearCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataractCrossSection.superclass.draw.call(this,t);var r=240,a=300,i=100,o=Math.asin(r/a),s=a*Math.cos(o),n=a-60,l=Math.acos(s/n);e.beginPath(),e.arc(i-s,0,n,l,-l,!0),e.arc(i+s,0,n,Math.PI+l,Math.PI-l,!0),e.stroke(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var h="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",d=e.createRadialGradient(i,0,210,i,0,50);return d.addColorStop(0,yellowColour),d.addColorStop(1,h),e.fillStyle=d,e.strokeStyle="rgba(0,0,0,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDisc=function(t,e){this.className="OpticDisc",this.numberOfHandles=8,this.mode="Basic",this.cdRatio="0",this.savedParameterArray=["apexY","mode"],ED.Doodle.call(this,t,e)},ED.OpticDisc.prototype=new ED.Doodle,ED.OpticDisc.prototype.constructor=ED.OpticDisc,ED.OpticDisc.superclass=ED.Doodle.prototype,ED.OpticDisc.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.OpticDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.parameterValidationArray.radius.range.setMinAndMax(50,290),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1},this.parameterValidationArray.cdRatio={kind:"derived",type:"string",list:["0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0","No view"],animate:!0},this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,r={};r.length=new ED.Range(50,290),r.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=r}},ED.OpticDisc.prototype.setParameterDefaults=function(){this.apexY=-150,this.setParameterFromString("mode","Basic"),this.setParameterFromString("cdRatio","0.3");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;this.numberOfHandles>e;e++){var r=new ED.Point(0,0);r.setWithPolars(-this.apexY,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(r)}},ED.OpticDisc.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"mode":this.setHandleProperties(),"Expert"==e?this.drawing.isReady&&this.setMeanRadius(-this.apexY):this.drawing.isReady&&this.resetHandles();break;case"apexY":r.cdRatio=-300>e?"No view":(-e/300).toFixed(1);break;case"cdRatio":if("No view"!=e){var a=300*parseFloat(e);r.apexY=-a}else r.apexY=-320;break;case"handles":var i=0;i+=this.squiggleArray[0].pointsArray[0].length(),i+=this.squiggleArray[0].pointsArray[this.numberOfHandles/2].length(),r.apexY=-Math.round(i/2);var o=Math.round(10*i/600)/10;r.cdRatio=o.toFixed(1)}return r},ED.OpticDisc.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDisc.superclass.draw.call(this,t);var r=300,a=-this.apexY,i=0,o=2*Math.PI;e.beginPath(),e.arc(0,0,r,i,o,!0),e.closePath(),e.lineWidth=2;var s=e.createPattern(this.drawing.imageArray.CribriformPattern,"repeat");if(e.fillStyle=s,e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),e.arc(0,0,r,i,o,!0),"Basic"==this.mode)e.moveTo(a,0),e.arc(0,0,a,o,i,!1);else{var n,l,h,d,c=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var p=0;this.numberOfHandles>p;p++){n=this.squiggleArray[0].pointsArray[p];var D=this.numberOfHandles-1>p?p+1:0;l=this.squiggleArray[0].pointsArray[D],h=n.tangentialControlPoint(+c),d=l.tangentialControlPoint(-c),e.bezierCurveTo(h.x,h.y,d.x,d.y,l.x,l.y)}}e.closePath();var u=new ED.Colour(0,0,0,1);u.setWithHexString("FFA83C"),e.fillStyle=u.rgba(),e.fill(),e.beginPath();var y;y=this.drawing.eye==ED.eye.Right?-1:1;var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(400,-y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(450,y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(500,y*Math.PI/4),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,m.x,m.y,f.x,f.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(400,7*-y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(450,7*y*Math.PI/8);var f=new ED.Point(0,0);f.setWithPolars(500,3*y*Math.PI/4),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,m.x,m.y,f.x,f.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(300,2*-y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(350,5*-y*Math.PI/16);var f=new ED.Point(0,0);f.setWithPolars(450,3*-y*Math.PI/8),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,m.x,m.y,f.x,f.y);var g=new ED.Point(0,0);g.setWithPolars(150,-y*Math.PI/2);var E=new ED.Point(0,0);E.setWithPolars(300,6*-y*Math.PI/8);var m=new ED.Point(0,0);m.setWithPolars(350,11*-y*Math.PI/16);var f=new ED.Point(0,0);f.setWithPolars(450,5*-y*Math.PI/8),e.moveTo(g.x,g.y),e.bezierCurveTo(E.x,E.y,m.x,m.y,f.x,f.y),e.lineWidth=48,e.lineCap="round",e.strokeStyle="rgba(255, 0, 0, 0.5)",e.stroke(),"No view"==this.cdRatio&&(e.beginPath(),e.arc(0,0,400,0,2*Math.PI,!0),e.closePath(),e.fillStyle="gray",e.fill())}if("Expert"==this.mode)for(var p=0;this.numberOfHandles>p;p++)this.handleArray[p].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[p]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDisc.prototype.description=function(){var t="";if("Expert"==this.mode){for(var e,r=this.getMeanRadius(),a=[],i=!1,o=0,s=0;this.numberOfHandles>s;s++)if(1.1*r>this.squiggleArray[0].pointsArray[s].length()){o=s;break}for(var s=0;this.numberOfHandles>s;s++){var n=(s+o)%this.numberOfHandles;this.squiggleArray[0].pointsArray[n].length()>1.1*r?i?e.endHour=this.squiggleArray[0].pointsArray[n].clockHour():(e={},e.startHour=this.squiggleArray[0].pointsArray[n].clockHour(),e.endHour=this.squiggleArray[0].pointsArray[n].clockHour(),i=!0):i&&(a.push(e),i=!1),s==this.numberOfHandles-1&&i&&(e.endHour=this.squiggleArray[0].pointsArray[n].clockHour(),a.push(e),i=!1)}if(a.length>0){var l=a.length>1;t=l?"Notches":"Notch";for(var s=0;a.length>s;s++)t+=a[s].startHour==a[s].endHour?" at "+a[s].startHour:" from "+a[s].startHour+" to "+a[s].endHour+" o'clock",l&&s!=a.length-1&&(t+=", and")}else t=1==this.drawing.doodleArray.length?"No abnormality":""}else t=1==this.drawing.doodleArray.length?"No abnormality":"";return t},ED.OpticDisc.prototype.setHandleProperties=function(){if("Basic"==this.mode){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t].isVisible=!1;this.handleArray[this.numberOfHandles].isVisible=!0}else{for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t].isVisible=!0;this.handleArray[this.numberOfHandles].isVisible=!1}},ED.OpticDisc.prototype.minimumRadius=function(){var t=500;if("Basic"==this.mode)t=Math.abs(this.apexY);else for(var e=0;this.numberOfHandles>e;e++){var r=this.squiggleArray[0].pointsArray[e].length();t>r&&(t=r)}return t},ED.OpticDisc.prototype.getMeanRadius=function(){if(this.squiggleArray[0]!==void 0){for(var t=0,e=0;this.numberOfHandles>e;e++)t+=this.squiggleArray[0].pointsArray[e].length();return t/this.numberOfHandles}return-this.apexY},ED.OpticDisc.prototype.setMeanRadius=function(t){for(var e=this.getMeanRadius(),r=0;this.numberOfHandles>r;r++){var a=this.squiggleArray[0].pointsArray[r].length(),i=this.squiggleArray[0].pointsArray[r].direction(),o=a*t/e;o=o>300?300:o,this.squiggleArray[0].pointsArray[r].setWithPolars(o,i)}},ED.OpticDisc.prototype.resetHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.squiggleArray[0].pointsArray[t].setWithPolars(-this.apexY,2*t*Math.PI/this.numberOfHandles)},ED.OpticDiscPit=function(t,e){this.className="OpticDiscPit",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.OpticDiscPit.prototype=new ED.Doodle,ED.OpticDiscPit.prototype.constructor=ED.OpticDiscPit,ED.OpticDiscPit.superclass=ED.Doodle.prototype,ED.OpticDiscPit.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.OpticDiscPit.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isUnique=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.OpticDiscPit.prototype.setParameterDefaults=function(){this.originY=130,this.apexY=0,this.scaleX=1.5,this.originX=this.drawing.eye==ED.eye.Right?-50:50},ED.OpticDiscPit.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDiscPit.superclass.draw.call(this,t),e.beginPath();var r=80;e.arc(0,0,r,0,2*Math.PI,!0),e.closePath();var a="rgba(200, 200, 200, 0.75)",i="rgba(100, 100, 100, 0.75)",o=e.createRadialGradient(0,0,r,0,0,10);return o.addColorStop(0,i),o.addColorStop(1,a),e.fillStyle=o,e.lineWidth=2,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(55,-55)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDiscPit.prototype.description=function(){return"Acquired pit of optic nerve"},ED.PCIOL=function(t,e){this.className="PCIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e),this.scaleX=.75,this.scaleY=.75},ED.PCIOL.prototype=new ED.Doodle,ED.PCIOL.prototype.constructor=ED.PCIOL,ED.PCIOL.superclass=ED.Doodle.prototype,ED.PCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.PCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isUnique=!0},ED.PCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.PCIOL.superclass.draw.call(this,t),e.beginPath();var r=240;e.arc(0,0,r,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var a=new ED.Point(0,0);return a.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCIOL.prototype.description=function(){var t="Posterior chamber IOL",e=40,r="";return-e>this.originY&&(r.length>0&&(r+=" and"),r+=" superiorly"),this.originY>e&&(r.length>0&&(r+=" and"),r+=" inferiorly"),-e>this.originX&&(r.length>0&&(r+=" and"),r+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>e&&(r.length>0&&(r+=" and"),r+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),r.length>0&&(t+=" displaced"+r),t},ED.PI=function(t,e){this.className="PI",this.type="Surgical",this.patent=!0,this.savedParameterArray=["rotation","type","patent"],this.controlParameterArray={type:"Type",patent:"Patent"},ED.Doodle.call(this,t,e)},ED.PI.prototype=new ED.Doodle,ED.PI.prototype.constructor=ED.PI,ED.PI.superclass=ED.Doodle.prototype,ED.PI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.type={kind:"derived",type:"string",list:["Surgical","Laser"],animate:!1},this.parameterValidationArray.patent={kind:"derived",type:"bool",display:!0}},ED.PI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.PI.prototype.draw=function(t){var e=this.drawing.context;ED.PI.superclass.draw.call(this,t);var r=360;switch(e.beginPath(),this.type){case"Surgical":var a=Math.PI/24;e.arc(0,0,r,-a-Math.PI/2,a-Math.PI/2,!1),e.lineTo(0,.8*-r),e.closePath();break;case"Laser":e.arc(0,.9*-r,36,0,2*Math.PI,!0)}return e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle=this.patent?"rgba(255,255,255,1)":"rgba(150,150,150,1)",this.drawBoundary(t),this.isClicked},ED.PI.prototype.description=function(){return"Peripheral iridectomy at "+this.clockHour()+" o'clock"},ED.PRPPostPole=function(t,e){this.className="PRPPostPole",ED.Doodle.call(this,t,e)},ED.PRPPostPole.prototype=new ED.Doodle,ED.PRPPostPole.prototype.constructor=ED.PRPPostPole,ED.PRPPostPole.superclass=ED.Doodle.prototype,ED.PRPPostPole.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.PRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t),e.beginPath(),e.rect(-480,-480,960,960);var r=320;if(e.moveTo(r,0),e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var a=15,i=30,o=48,s=(1e3-2*o)/(2*a+i),n=2*a+i,l=10,h=0;s>h;h++)for(var d=0;s>d;d++){var c=-500+o+h*n+Math.round(20*(-.5+ED.randomArray[h+d])),p=-500+o+d*n+Math.round(20*(-.5+ED.randomArray[h+d+100]));c*c+p*p>r*r&&(this.drawing.eye==ED.eye.Right?(13!=h||6!=d&&7!=d&&8!=d&&9!=d)&&(14!=h||7!=d&&8!=d)&&this.drawCircle(e,c,p,a,"Yellow",l,"rgba(255, 128, 0, 1)"):(2!=h||6!=d&&7!=d&&8!=d&&9!=d)&&(1!=h||7!=d&&8!=d)&&this.drawCircle(e,c,p,a,"Yellow",l,"rgba(255, 128, 0, 1)"))}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PRPPostPole.prototype.description=function(){return"Panretinal photocoagulation"},ED.Papilloedema=function(t,e){this.className="Papilloedema",ED.Doodle.call(this,t,e)},ED.Papilloedema.prototype=new ED.Doodle,ED.Papilloedema.prototype.constructor=ED.Papilloedema,ED.Papilloedema.superclass=ED.Doodle.prototype,ED.Papilloedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.Papilloedema.prototype.draw=function(t){var e=this.drawing.context;ED.Papilloedema.superclass.draw.call(this,t);var r=450,a=300;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.arc(0,0,a,2*Math.PI,0,!1),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var i="rgba(240, 140, 40, 0.75)",o=e.createRadialGradient(0,0,r,0,0,a);return o.addColorStop(0,yellowColour),o.addColorStop(1,i),e.fillStyle=o,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.isClicked},ED.Papilloedema.prototype.description=function(){return"Papilloedema"},ED.Patch=function(t,e){this.className="Patch",this.material="Sclera",this.savedParameterArray=["originX","originY","width","height","apexX"],ED.Doodle.call(this,t,e)
},ED.Patch.prototype=new ED.Doodle,ED.Patch.prototype.constructor=ED.Patch,ED.Patch.superclass=ED.Doodle.prototype,ED.Patch.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Size,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Patch.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.material={kind:"derived",type:"string",list:["Sclera","Tenons","Tutoplast"],animate:!1}},ED.Patch.prototype.setParameterDefaults=function(){this.width=120,this.height=200,this.originY=-260,this.setParameterFromString("material","Sclera")},ED.Patch.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexX":r.material=-16>e?"Sclera":16>e?"Tenons":"Tutoplast";break;case"material":r.apexX="Sclera"==e?-50:"Tenons"==e?50:0}return r},ED.Patch.prototype.draw=function(t){var e=this.drawing.context;switch(ED.Patch.superclass.draw.call(this,t),e.beginPath(),e.rect(-this.width/2,-this.height/2,this.width,this.height),e.closePath(),this.material){case"Sclera":e.fillStyle="rgba(200,200,50,0.5)";break;case"Tenons":e.fillStyle="rgba(200,200,200,0.5)";break;case"Tutoplast":e.fillStyle="rgba(230,230,230,0.5)"}if(e.strokeStyle="rgba(120,120,120,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=this.width/2,a=this.height/2-10;this.drawSpot(e,-r,-a,5,"blue"),this.drawSpot(e,-r,a,5,"blue"),this.drawSpot(e,r,-a,5,"blue"),this.drawSpot(e,r,a,5,"blue")}return this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.width/2,-this.height/2)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Patch.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.fillStyle="gray",t.font="48px sans-serif",t.fillText(this.material,80,20)},ED.Patch.prototype.description=function(){return"Scleral patch"},ED.PeripapillaryAtrophy=function(t,e){this.className="PeripapillaryAtrophy",this.outerRadius=340,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.PeripapillaryAtrophy.prototype=new ED.Doodle,ED.PeripapillaryAtrophy.prototype.constructor=ED.PeripapillaryAtrophy,ED.PeripapillaryAtrophy.superclass=ED.Doodle.prototype,ED.PeripapillaryAtrophy.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Handles,!1)},ED.PeripapillaryAtrophy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.rotation.range.setMinAndMax(7*Math.PI/4,Math.PI/4),this.handleCoordinateRangeArray=[];var t=1.4*this.outerRadius,e=this.outerRadius;this.handleCoordinateRangeArray[0]={x:new ED.Range(-t,-e),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[1]={x:new ED.Range(-0,0),y:new ED.Range(-t,-e)},this.handleCoordinateRangeArray[2]={x:new ED.Range(e,t),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[3]={x:new ED.Range(-0,0),y:new ED.Range(e,t)}},ED.PeripapillaryAtrophy.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t),this.addPointToSquiggle(new ED.Point(-this.outerRadius-(this.drawing.eye==ED.eye.Right?100:0),0)),this.addPointToSquiggle(new ED.Point(0,-this.outerRadius)),this.addPointToSquiggle(new ED.Point(this.outerRadius+(this.drawing.eye==ED.eye.Right?0:100),0)),this.addPointToSquiggle(new ED.Point(0,this.outerRadius))},ED.PeripapillaryAtrophy.prototype.draw=function(t){var e=this.drawing.context;ED.PeripapillaryAtrophy.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=.55;r=this.squiggleArray[0].pointsArray[0].x,a=this.squiggleArray[0].pointsArray[0].y,i=this.squiggleArray[0].pointsArray[1].x,o=this.squiggleArray[0].pointsArray[1].y,e.moveTo(r,a),e.bezierCurveTo(r,r*s,o*s,o,i,o),r=i,a=o,i=this.squiggleArray[0].pointsArray[2].x,o=this.squiggleArray[0].pointsArray[2].y,e.bezierCurveTo(-a*s,a,i,-i*s,i,o),r=i,a=o,i=this.squiggleArray[0].pointsArray[3].x,o=this.squiggleArray[0].pointsArray[3].y,e.bezierCurveTo(r,r*s,o*s,o,i,o),r=i,a=o,i=this.squiggleArray[0].pointsArray[0].x,o=this.squiggleArray[0].pointsArray[0].y,e.bezierCurveTo(-a*s,a,i,-i*s,i,o),e.moveTo(280,0),e.arc(0,0,280,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2;var n=new ED.Colour(0,0,0,1);return n.setWithHexString("DFD989"),e.fillStyle=n.rgba(),e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.handleArray[1].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[1]),this.handleArray[2].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[2]),this.handleArray[3].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[3]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripapillaryAtrophy.prototype.description=function(){var t="",e=-this.squiggleArray[0].pointsArray[0].x,r=-this.squiggleArray[0].pointsArray[1].y,a=this.squiggleArray[0].pointsArray[2].x,i=this.squiggleArray[0].pointsArray[3].y,o="",s=this.radius;if(e>s&&(s=e,o=this.drawing.eye==ED.eye.Right?"temporally":"nasally"),r>s&&(s=r,o="superiorly"),a>s&&(s=a,o=this.drawing.eye==ED.eye.Right?"nasally":"temporally"),i>s&&(s=i,o="inferiorly"),s>this.radius){var n="Mild";s>350&&(n="Moderate"),s>400&&(n="Signficant"),t+=n,t+=" peri-papillary atrophy, maximum ",t+=o}return t},ED.PeripheralRRD=function(t,e){this.className="PeripheralRRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PeripheralRRD.prototype=new ED.Doodle,ED.PeripheralRRD.prototype.constructor=ED.PeripheralRRD,ED.PeripheralRRD.superclass=ED.Doodle.prototype,ED.PeripheralRRD.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.PeripheralRRD.prototype.setParameterDefaults=function(){this.arc=112*Math.PI/180,this.apexY=-380;var t=this.drawing.lastDoodleOfClass(this.className);t?this.drawing.eye==ED.eye.Right:this.rotation=this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI},ED.PeripheralRRD.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralRRD.superclass.draw.call(this,t);var r=476,a=-this.apexY,i=a+(r-a)/2,o=r-a,s=this.arc/2,n=-Math.PI/2+s,l=-Math.PI/2-s,h=i*Math.sin(s),d=-i*Math.cos(s),c=-i*Math.sin(s),p=d,D=new ED.Point(0,0);D.x=-r*Math.sin(s-o/r),D.y=-r*Math.cos(s-o/r);var u=new ED.Point(0,0);u.x=-r*Math.sin(-s+o/r),u.y=-r*Math.cos(-s+o/r),e.beginPath(),e.arc(0,0,r,n,l,!0);var y=l-Math.PI/2;return e.arc(D.x,D.y,o,y,y-Math.PI/2+o/r,!0),e.arc(0,0,a,D.direction()-Math.PI/2,u.direction()-Math.PI/2,!1),y=n+Math.PI/2,e.arc(u.x,u.y,o,y+Math.PI/2-o/r,y,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralRRD.prototype.snomedCode=function(){return 232008001},ED.PeripheralRRD.prototype.diagnosticHierarchy=function(){return 8},ED.PeripheralRetinectomy=function(t,e){this.className="PeripheralRetinectomy",this.extent="",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PeripheralRetinectomy.prototype=new ED.Doodle,ED.PeripheralRetinectomy.prototype.constructor=ED.PeripheralRetinectomy,ED.PeripheralRetinectomy.superclass=ED.Doodle.prototype,ED.PeripheralRetinectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRetinectomy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-350)},ED.PeripheralRetinectomy.prototype.setParameterDefaults=function(){this.arc=240*Math.PI/180,this.apexY=-380;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/4:Math.PI},ED.PeripheralRetinectomy.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralRetinectomy.superclass.draw.call(this,t);var r=476,a=-this.apexY,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,0,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),this.arc<1.95*Math.PI){var p=o-Math.PI/24,D=o-2*Math.PI/24,u=new ED.Point(r*Math.sin(o),-r*Math.cos(o)),y=new ED.Point(i*Math.sin(o),-i*Math.cos(o)),g=new ED.Point(a*Math.sin(p),-a*Math.cos(p)),E=new ED.Point(a*Math.sin(D),-a*Math.cos(D));s=-Math.PI/2+D,n=-Math.PI/2-D,new ED.Point(-a*Math.sin(D),-a*Math.cos(D));var m=new ED.Point(-a*Math.sin(p),-a*Math.cos(p)),f=new ED.Point(-i*Math.sin(o),-i*Math.cos(o)),P=new ED.Point(-r*Math.sin(o),-r*Math.cos(o));e.moveTo(u.x,u.y),e.bezierCurveTo(y.x,y.y,g.x,g.y,E.x,E.y),e.arc(0,0,a,s,n,!0),e.bezierCurveTo(m.x,m.y,f.x,f.y,P.x,P.y);var w=10*Math.floor(18*this.arc/Math.PI);this.extent="Retinectomy of "+w+" degrees centred at "+this.clockHour()+" o'clock"}else e.arc(0,0,a,0,2*Math.PI,!0),this.extent="360 degree retinectomy";e.lineWidth=16,e.strokeStyle="red",e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralRetinectomy.prototype.description=function(){return this.extent},ED.PhakoIncision=function(t,e){this.className="PhakoIncision",this.defaultRadius=330,this.sutureSeparation=1.5,this.incisionSite="Corneal",this.incisionType="Pocket",this.incisionMeridian=0,this.savedParameterArray=["apexY","arc","rotation","radius"],ED.Doodle.call(this,t,e),this.apexYDelta=this.radius+this.apexY},ED.PhakoIncision.prototype=new ED.Doodle,ED.PhakoIncision.prototype.constructor=ED.PhakoIncision,ED.PhakoIncision.superclass=ED.Doodle.prototype,ED.PhakoIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PhakoIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.incisionMeridian={kind:"derived",type:"mod",range:new ED.Range(0,360),clock:"bottom",animate:!0},this.parameterValidationArray.incisionLength={kind:"derived",type:"float",range:new ED.Range(1,9.9),precision:1,animate:!0},this.parameterValidationArray.incisionSite={kind:"derived",type:"string",list:["Corneal","Limbal","Scleral"],animate:!0},this.parameterValidationArray.incisionType={kind:"derived",type:"string",list:["Pocket","Section"],animate:!1}},ED.PhakoIncision.prototype.setParameterDefaults=function(){this.setParameterFromString("incisionSite","Corneal"),this.setParameterFromString("incisionLength","3.5"),this.setParameterFromString("incisionType","Pocket"),this.setRotationWithDisplacements(90,-90)},ED.PhakoIncision.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"rotation":var a=(180*(2*Math.PI-e+Math.PI/2)/Math.PI+360)%360;360==a&&(a=0),r.incisionMeridian=a;break;case"arc":r.incisionLength=e*6*this.radius/this.defaultRadius;break;case"radius":r.incisionSite=e>=428?"Scleral":e>=344?"Limbal":"Corneal",r.arc=this.incisionLength*this.defaultRadius/(6*e),this.updateArcRange(),r.apexY=this.apexYDelta-e,this.parameterValidationArray.apexY.range.setMinAndMax(-e,-e+34);break;case"apexY":r.apexYDelta=this.radius+e,r.incisionType=this.radius+e>0?"Section":"Pocket";break;case"incisionMeridian":r.rotation=(90-e+360)%360*Math.PI/180;break;case"incisionLength":r.arc=e*this.defaultRadius/(6*this.radius),this.updateArcRange();break;case"incisionSite":switch(e){case"Scleral":r.radius=428;break;case"Limbal":r.radius=376;break;case"Corneal":r.radius=330}break;case"incisionType":switch(e){case"Pocket":r.apexYDelta=0,r.apexY=-this.radius;break;case"Section":r.apexYDelta=34,r.apexY=34-this.radius}}return r},ED.PhakoIncision.prototype.updateArcRange=function(){this.radius>0?(this.parameterValidationArray.arc.range.min=this.parameterValidationArray.incisionLength.range.min*this.defaultRadius/(6*this.radius),this.parameterValidationArray.arc.range.max=this.parameterValidationArray.incisionLength.range.max*this.defaultRadius/(6*this.radius)):ED.errorHandler("ED.PhakoIncision","updateArcRange","Attempt to calculate a range of arc using an illegal value of radius: "+this.radius)},ED.PhakoIncision.prototype.draw=function(t){var e=this.drawing.context;ED.PhakoIncision.superclass.draw.call(this,t);var r=this.radius,a=40,i=r+a,o=r-a;e.beginPath();var s=this.arc/2;if(e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),0==this.apexYDelta?(e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)"):(e.fillStyle="rgba(200,200,200,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0)"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&0!=this.apexYDelta){e.beginPath(),e.arc(0,0,r,-Math.PI/2+s,-Math.PI/2-s,!0);var n=this.sutureSeparation*this.defaultRadius/(6*this.radius),l=new ED.Point(0,0),h=s-n/2;do l.setWithPolars(r-a,h),e.moveTo(l.x,l.y),l.setWithPolars(r+a,h),e.lineTo(l.x,l.y),h-=n;while(h>-s);e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(r,s),this.handleArray[3].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PhakoIncision.prototype.description=function(){var t="";return t=this.radius>428?"Scleral ":this.radius>344?"Limbal ":"Corneal ",t+=0==this.apexY+this.radius?"pocket ":"section ",t+="incision at ",t+=this.clockHour()+" o'clock"},ED.PostPole=function(t,e){this.className="PostPole",this.discRadius=84,this.cdRatio="0",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.PostPole.prototype=new ED.Doodle,ED.PostPole.prototype.constructor=ED.PostPole,ED.PostPole.superclass=ED.Doodle.prototype,ED.PostPole.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostPole.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0;var t=this.drawing.eye==ED.eye.Right?300:-300;this.parameterValidationArray.apexX.range.setMinAndMax(t,t),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-8),this.parameterValidationArray.cdRatio={kind:"derived",type:"float",range:new ED.Range(0,1),precision:1,animate:!0},this.parameterValidationArray.apexY.delta=5},ED.PostPole.prototype.setParameterDefaults=function(){this.setParameterFromString("cdRatio","0.5"),this.apexX=this.drawing.eye==ED.eye.Right?300:-300},ED.PostPole.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.cdRatio=-e/80;break;case"cdRatio":r.apexY=-(80*+e)}return r},ED.PostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PostPole.superclass.draw.call(this,t);var r=this.drawing.eye==ED.eye.Right?300:-300;if(e.beginPath(),e.arc(r,0,this.discRadius,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="rgba(249,187,76,1)",e.fillStyle="rgba(249,187,76,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(r,0,-this.apexY,2*Math.PI,0,!1),e.fillStyle="white";var a=e.createPattern(this.drawing.imageArray.CribriformPatternSmall,"repeat");e.fillStyle=a,e.lineWidth=4,e.fill(),e.stroke(),e.beginPath();var i=this.drawing.eye==ED.eye.Right?1:-1,o=-300*i,s=-50*i,n=300*i,l=300*i,h=300*i,d=350*i,c=400*i,p=0;e.moveTo(o,-100),e.bezierCurveTo(s,-500,n,-200,l,-24),e.bezierCurveTo(h,-80,d,-140,c,-160),e.moveTo(c,160),e.bezierCurveTo(d,140,h,80,l,24),e.bezierCurveTo(n,200,s,500,o,100);var D=10;e.moveTo(p,-D),e.lineTo(p,D),e.moveTo(p-D,0),e.lineTo(p+D,0),e.lineWidth=8,e.lineCap="round",e.strokeStyle="red",e.stroke(),e.beginPath(),e.arc(0,0,2*this.discRadius,2*Math.PI,0,!1),e.lineWidth=1,e.strokeStyle="gray",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostPole.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.PostPole.prototype.isWithinDiscDiametersOfFovea=function(t,e){return t.originX*t.originX+t.originY*t.originY<4*e*this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinDisc=function(t){var e=t.originX-(this.drawing.eye==ED.eye.Right?300:-300);return e*e+t.originY*t.originY<this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinArcades=function(t){return 9e4>t.originX*t.originX+t.originY*t.originY},ED.PostSubcapCataract=function(t,e){this.className="PostSubcapCataract",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.PostSubcapCataract.prototype=new ED.Doodle,ED.PostSubcapCataract.prototype.constructor=ED.PostSubcapCataract,ED.PostSubcapCataract.superclass=ED.Doodle.prototype,ED.PostSubcapCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostSubcapCataract.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens"],this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(35,100),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-35)},ED.PostSubcapCataract.prototype.setParameterDefaults=function(){this.apexX=35,this.apexY=35,this.radius=50},ED.PostSubcapCataract.prototype.dependentParameterValues=function(t){var e=[];switch(t){case"apexX":e.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);break;case"apexY":e.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY)}return e},ED.PostSubcapCataract.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,this.radius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4;var r=e.createPattern(this.drawing.imageArray.PSCPattern,"repeat");e.fillStyle=r,e.strokeStyle="lightgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw;var a=new ED.Point(0,0);return a.setWithPolars(this.radius,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostSubcapCataract.prototype.description=function(){return"Posterior subcapsular cataract"},ED.PostSubcapCataract.prototype.snomedCode=function(){return 315353005},ED.PostSubcapCataract.prototype.diagnosticHierarchy=function(){return 3},ED.PostSubcapCataractCrossSection=function(t,e){this.className="PostSubcapCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.PostSubcapCataractCrossSection.prototype=new ED.Doodle,ED.PostSubcapCataractCrossSection.prototype.constructor=ED.PostSubcapCataractCrossSection,ED.PostSubcapCataractCrossSection.superclass=ED.Doodle.prototype,ED.PostSubcapCataractCrossSection.prototype.setHandles=function(){},ED.PostSubcapCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20)},ED.PostSubcapCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.apexY=-35},ED.PostSubcapCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataractCrossSection.superclass.draw.call(this,t);var r=240,a=300,i=100,o=Math.asin(r/a),s=a*Math.cos(o),n=a-10;o=Math.acos(s/n);var l=Math.asin(-this.apexY/n);return e.beginPath(),e.arc(i-s,0,n,-l,l,!1),e.lineWidth=10,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(150,150,150,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorEmbryotoxon=function(t,e){this.className="PosteriorEmbryotoxon",ED.Doodle.call(this,t,e)},ED.PosteriorEmbryotoxon.prototype=new ED.Doodle,ED.PosteriorEmbryotoxon.prototype.constructor=ED.PosteriorEmbryotoxon,ED.PosteriorEmbryotoxon.superclass=ED.Doodle.prototype,ED.PosteriorEmbryotoxon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.PosteriorEmbryotoxon.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorEmbryotoxon.superclass.draw.call(this,t);var r=370,a=340,i=0,o=2*Math.PI;return e.beginPath(),e.arc(0,0,r,i,o,!0),e.arc(0,0,a,o,i,!1),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(255,255,255,0.6)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.isClicked},ED.PosteriorEmbryotoxon.prototype.description=function(){return"Posterior Embryotoxon"},ED.PosteriorRetinectomy=function(t,e){this.className="PosteriorRetinectomy",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.PosteriorRetinectomy.prototype=new ED.Doodle,ED.PosteriorRetinectomy.prototype.constructor=ED.PosteriorRetinectomy,ED.PosteriorRetinectomy.superclass=ED.Doodle.prototype,ED.PosteriorRetinectomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorRetinectomy.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-50)},ED.PosteriorRetinectomy.prototype.setParameterDefaults=function(){this.apexX=0,this.apexY=-100;var t=100;this.originX=t,this.originY=-t;var e=this.drawing.lastDoodleOfClass(this.className);if(e){var r=new ED.Point(e.originX,e.originY),a=r.direction()+Math.PI/8,i=r.length(),o=new ED.Point(0,0);o.setWithPolars(i,a),this.originX=o.x,this.originY=o.y}},ED.PosteriorRetinectomy.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorRetinectomy.superclass.draw.call(this,t),e.beginPath();var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY),a=16;return e.arc(0,0,r+a,0,2*Math.PI,!0),e.arc(0,0,r-a,2*Math.PI,0,!1),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=16,e.strokeStyle="red",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorRetinectomy.prototype.groupDescription=function(){return"Posterior retinectomy"},ED.PosteriorSynechia=function(t,e){this.className="PosteriorSynechia",this.size=150,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PosteriorSynechia.prototype=new ED.Doodle,ED.PosteriorSynechia.prototype.constructor=ED.PosteriorSynechia,ED.PosteriorSynechia.superclass=ED.Doodle.prototype,ED.PosteriorSynechia.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorSynechia.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI/3),this.parameterValidationArray.size={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.PosteriorSynechia.prototype.setParameterDefaults=function(){this.arc=Math.PI/6,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY+this.size:-200},ED.PosteriorSynechia.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"size":var a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r.apexY=a.apexY-e);break;case"apexY":var a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r.size=a.apexY-e)}return r},ED.PosteriorSynechia.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorSynechia.superclass.draw.call(this,t);var r=200,a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r=-a.apexY),-this.apexY,e.beginPath();var i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=new ED.Point(-r*Math.sin(i),-r*Math.cos(i)),l=new ED.Point(r*Math.sin(i),-r*Math.cos(i));e.beginPath(),e.arc(0,0,r,s,o,!1);var h=new ED.Point(this.apexX,this.apexY),d=l.pointAtAngleToLineToPointAtProportion(Math.PI/12,h,.33),c=h.pointAtAngleToLineToPointAtProportion(-Math.PI/12,l,.33);e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY);var p=h.pointAtAngleToLineToPointAtProportion(Math.PI/12,n,.33),D=n.pointAtAngleToLineToPointAtProportion(-Math.PI/12,h,.33);switch(e.bezierCurveTo(p.x,p.y,D.x,D.y,n.x,n.y),e.closePath(),a.colour){case"Blue":e.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":e.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":e.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":e.fillStyle="rgba(114, 172, 62, 0.5)"}return e.lineWidth=4,e.strokeStyle="rgba(250, 250, 250, 0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,r,s,o,!1),e.lineWidth=6,e.strokeStyle="white",e.stroke(),e.strokeStyle=e.fillStyle,e.stroke(),e.beginPath(),e.moveTo(l.x,l.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY),e.bezierCurveTo(p.x,p.y,D.x,D.y,n.x,n.y),e.lineWidth=4,e.strokeStyle="gray",e.stroke()),this.handleArray[0].location=this.transform.transformPoint(n),this.handleArray[3].location=this.transform.transformPoint(l),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorSynechia.prototype.groupDescription=function(){return"Posterior synechiae at "},ED.PosteriorSynechia.prototype.description=function(){return this.clockHour()+" o'clock"},ED.PreRetinalHaemorrhage=function(t,e){this.className="PreRetinalHaemorrhage",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.PreRetinalHaemorrhage.prototype=new ED.Doodle,ED.PreRetinalHaemorrhage.prototype.constructor=ED.PreRetinalHaemorrhage,ED.PreRetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.PreRetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.PreRetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,200),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.PreRetinalHaemorrhage.prototype.setParameterDefaults=function(){this.apexY=200,this.setOriginWithDisplacements(-150,150)},ED.PreRetinalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.PreRetinalHaemorrhage.superclass.draw.call(this,t);var r=100,a=.6;return e.beginPath(),e.moveTo(r,0),e.lineTo(-r,0),e.bezierCurveTo(-r*a,0,-r*a,this.apexY,0,this.apexY),e.bezierCurveTo(r*a,this.apexY,r*a,0,r,0),e.closePath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(100,0)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PreRetinalHaemorrhage.prototype.groupDescription=function(){return"Pre-retinal haemorrages"},ED.RK=function(t,e){this.className="RK",this.savedParameterArray=["apexY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.RK.prototype=new ED.Doodle,ED.RK.prototype.constructor=ED.RK,ED.RK.superclass=ED.Doodle.prototype,ED.RK.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RK.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.15),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-60)},ED.RK.prototype.setParameterDefaults=function(){this.apexY=-100},ED.RK.prototype.draw=function(t){var e=this.drawing.context;ED.RK.superclass.draw.call(this,t);var r=320,a=-this.apexY,i=8,o=0,s=2*Math.PI;if(e.beginPath(),e.arc(0,0,r,o,s,!0),e.moveTo(a,0),e.arc(0,0,a,s,o,!1),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var n=2*Math.PI/i;e.strokeStyle="rgba(100,100,100,0.7)",e.beginPath();var l;for(l=0;i>l;l++){var h=l*n,d=new ED.Point(0,0);d.setWithPolars(a,h);var c=new ED.Point(0,0);c.setWithPolars(r,h),e.moveTo(d.x,d.y),e.lineTo(c.x,c.y),e.closePath()}e.stroke()}var p=new ED.Point(0,0);return p.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(p),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RK.prototype.description=function(){return"Radial keratotomy"},ED.RPEDetachment=function(t,e){this.className="RPEDetachment",this.numberOfHandles=4,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.RPEDetachment.prototype=new ED.Doodle,ED.RPEDetachment.prototype.constructor=ED.RPEDetachment,ED.RPEDetachment.superclass=ED.Doodle.prototype,ED.RPEDetachment.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.RPEDetachment.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,r=this.numberOfHandles,a={};a.length=new ED.Range(50,290),a.angle=new ED.Range(((2*r-1)*e/(2*r)+t*e/r)%e,(1*e/(2*r)+t*e/r)%e),this.handleVectorRangeArray[t]=a
}},ED.RPEDetachment.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+150,0);this.move(e.x,e.y)}var r=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(r);for(var a=0;this.numberOfHandles>a;a++){var i=new ED.Point(0,0);i.setWithPolars(this.initialRadius,2*a*Math.PI/this.numberOfHandles),this.addPointToSquiggle(i)}},ED.RPEDetachment.prototype.draw=function(t){var e=this.drawing.context;ED.RPEDetachment.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){r=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;a=this.squiggleArray[0].pointsArray[l],i=r.tangentialControlPoint(+s),o=a.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,a.x,a.y)}e.closePath(),e.lineWidth=4,e.fillStyle="rgba(173, 48, 14, 1)",e.strokeStyle="brown",this.drawBoundary(t);for(var n=0;this.numberOfHandles>n;n++)this.handleArray[n].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[n]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPEDetachment.prototype.description=function(){return"Retinal pigment epithelial detachment"},ED.RPERip=function(t,e){this.className="RPERip",this.initialRadius=150,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RPERip.prototype=new ED.Doodle,ED.RPERip.prototype.constructor=ED.RPERip,ED.RPERip.superclass=ED.Doodle.prototype,ED.RPERip.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Scale,!0),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RPERip.prototype.setPropertyDefaults=function(){this.parameterValidationArray.originX.range.setMinAndMax(-120,120),this.parameterValidationArray.originY.range.setMinAndMax(-120,120),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.initialRadius,+this.initialRadius),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.RPERip.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setRotationWithDisplacements(90,0),this.setOriginWithDisplacements(0,100)},ED.RPERip.prototype.draw=function(t){var e=this.drawing.context;ED.RPERip.superclass.draw.call(this,t);var r=this.initialRadius,a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=r*Math.sin(a),n=-r*Math.cos(a),l=-r*Math.sin(a),h=n;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=4,e.fillStyle="rgba(251, 147, 76, 0.75)",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,r,i,o,!0);var d=.6;e.bezierCurveTo(l,h,d*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n),e.lineWidth=4,e.fillStyle="rgba(180, 125, 60, 0.75)",e.strokeStyle="brown",e.fill(),e.stroke()}this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(s,n)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));var c=new ED.Point(0,0);return c.setWithPolars(r,Math.PI/8),this.handleArray[3].location=this.transform.transformPoint(c),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPERip.prototype.description=function(){return"RPE rip"},ED.RRD=function(t,e){this.className="RRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RRD.prototype=new ED.Doodle,ED.RRD.prototype.constructor=ED.RRD,ED.RRD.superclass=ED.Doodle.prototype,ED.RRD.prototype.setHandles=function(){this.handleArray[1]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.RRD.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RRD.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var r=476,a=this.arc/2,i=-Math.PI/2+a,o=-Math.PI/2-a,s=r*Math.sin(a),n=-r*Math.cos(a),l=-r*Math.sin(a),h=n;e.beginPath(),e.arc(0,0,r,i,o,!0);var d=.6,c=25;if(-c>this.apexY)e.bezierCurveTo(l,h,d*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);else if(c>this.apexY){var p=Math.acos((0-this.apexY)/c),D=c*Math.sin(p);e.bezierCurveTo(l,h,d*l,this.apexY,-D,this.apexY),e.arc(0,0,c,-Math.PI/2-p,-Math.PI/2+p,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n)}else e.bezierCurveTo(l,h,d*l,this.apexY,0,25),e.arc(0,0,c,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-d*l,this.apexY,s,n,s,n);return e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(s,n)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RRD.prototype.description=function(){var t="";return t+=Math.cos(this.rotation)>0?"Supero":"Infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",t+=" retinal detachment",t+=this.isMacOff()?" (macula off)":" (macula on)"},ED.RRD.prototype.snomedCode=function(){return this.isMacOff()?232009009:232008001},ED.RRD.prototype.diagnosticHierarchy=function(){return this.isMacOff()?10:9},ED.RRD.prototype.isMacOff=function(){if(this.drawing.eye==ED.eye.Right)var t=new ED.Point(-100,0);else var t=new ED.Point(100,0);var e=this.drawing.transform.transformPoint(t);return this.draw(e)?!0:!1},ED.RadialSponge=function(t,e){this.className="RadialSponge",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.RadialSponge.prototype=new ED.Doodle,ED.RadialSponge.prototype.constructor=ED.RadialSponge,ED.RadialSponge.superclass=ED.Doodle.prototype,ED.RadialSponge.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0},ED.RadialSponge.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.RadialSponge.prototype.draw=function(t){var e=this.drawing.context;ED.RadialSponge.superclass.draw.call(this,t);var r=-220,a=200,i=80;return e.beginPath(),e.moveTo(-i/2,r),e.lineTo(-i/2,r-a),e.lineTo(i/2,r-a),e.lineTo(i/2,r),e.closePath(),e.lineWidth=4,e.fillStyle="lightgray",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,r-a+40,5,0,2*Math.PI,!0),e.lineTo(-20,r-a+30),e.moveTo(0,r-a+40),e.lineTo(20,r-a+30),e.moveTo(-i/2-20,r-40),e.lineTo(-i/2-20,r-a+40),e.lineTo(i/2+20,r-a+40),e.lineTo(i/2+20,r-40),e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RadialSponge.prototype.groupDescription=function(){return"Radial sponge at "},ED.RadialSponge.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Rectus=function(t,e){this.className="Rectus",this.insertionY=-200,this.hangback=!1,this.canTranspose=!0,this.recession=0,this.transposition="None",this.savedParameterArray=["apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.Rectus.prototype=new ED.Doodle,ED.Rectus.prototype.constructor=ED.Rectus,ED.Rectus.superclass=ED.Doodle.prototype,ED.Rectus.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rectus.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.recession={kind:"derived",type:"float",range:new ED.Range(-12.5,6.5),precision:1,animate:!0},this.parameterValidationArray.transposition={kind:"derived",type:"string",list:["Up","None","Down"],animate:!0},this.parameterValidationArray.canTranspose={kind:"derived",type:"bool",animate:!1}},ED.Rectus.prototype.setParameterDefaults=function(){this.setParameterFromString("recession","0"),this.setParameterFromString("transposition","None"),this.apexY=this.insertionY,this.canTranspose=!0},ED.Rectus.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.recession=Math.round(2*(e-this.insertionY)/16)/2;break;case"recession":r.apexY=16*e+this.insertionY;break;case"apexX":r.transposition=this.rotation>0&&this.rotation<Math.PI?0>e?"Up":e>0?"Down":"None":0>e?"Down":e>0?"Up":"None";break;case"transposition":switch(e){case"Up":r.apexX=this.rotation>0&&this.rotation<Math.PI?-50:50;break;case"Down":r.apexX=this.rotation>0&&this.rotation<Math.PI?50:-50;break;case"None":r.apexX=0}}var a=15;return this.apexY>this.insertionY-a&&this.apexY<this.insertionY+a&&this.canTranspose?this.parameterValidationArray.apexX.range.setMinAndMax(-100,100):this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.apexX>-a&&a>this.apexX?this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100):this.parameterValidationArray.apexY.range.setMinAndMax(-200,-200),r},ED.Rectus.prototype.draw=function(t){var e=this.drawing.context;ED.Rectus.superclass.draw.call(this,t),e.beginPath();var r=60,a=-450;if(e.moveTo(-r,a),e.lineTo(r,a),e.lineTo(this.apexX+r,this.apexY),e.lineTo(this.apexX-r,this.apexY),e.closePath(),e.lineWidth=2,e.fillStyle="rgba(255, 140 , 80, 1)",e.strokeStyle="rgba(255, 184, 93, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.insertionY<this.apexY){var i=-r+this.apexX*(this.insertionY-a)/(this.apexY-a);e.beginPath(),e.moveTo(i,this.insertionY),e.lineTo(i+2*r,this.insertionY),e.lineTo(this.apexX+r,this.apexY),e.lineTo(this.apexX-r,this.apexY),e.closePath(),e.fillStyle="rgba(255, 220, 140, 1)",e.fill()}if(0!=this.apexX||this.apexY!=this.insertionY){var o,s=15,n=15,l=10,h=20;o=this.insertionY>this.apexY?this.apexY:this.insertionY;var d;d=!this.hangback&&this.insertionY>this.apexY?this.apexY+s:this.insertionY+s;var c=this.apexX;e.beginPath(),e.moveTo(c,d),e.lineTo(c-n,d+n),e.moveTo(c+n,d+n),e.lineTo(c,d),e.arc(c,d,4,0,2*Math.PI,!0),e.moveTo(c,d),e.lineTo(c-r+l,d),e.lineTo(c-r+l,o),e.moveTo(c-r+l,o-s),e.lineTo(c-r+l+h,o-s),e.moveTo(c+r-l-h,o-s),e.lineTo(c+r-l,o-s),e.moveTo(c+r-l,o),e.lineTo(c+r-l,d),e.lineTo(c,d),e.lineWidth=4,e.strokeStyle="black",e.stroke()}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalArteryOcclusionPostPole=function(t,e){this.className="RetinalArteryOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RetinalArteryOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalArteryOcclusionPostPole.prototype.constructor=ED.RetinalArteryOcclusionPostPole,ED.RetinalArteryOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalArteryOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalArteryOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalArteryOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalArteryOcclusionPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.RetinalArteryOcclusionPostPole.superclass.draw.call(this,t);var r=420,a=-this.apexY,i=this.arc/2,o=-Math.PI/2+i,s=-Math.PI/2-i,n=r*Math.sin(i),l=-r*Math.cos(i),h=-r*Math.sin(i),d=l;return e.beginPath(),e.arc(0,0,r,o,s,!0),e.arc(0,0,a,s,o,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.5)",e.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(e.beginPath(),e.arc(0,0,-this.apexY,0,2*Math.PI,!0),e.fillStyle="rgba(200,0,0,0.5)",e.fill()),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalArteryOcclusionPostPole.prototype.description=function(){var t="",e=this.type();switch(e){case"branch":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",t+="branch ";break;case"hemispheric":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",t+="hemispheric ";break;case"central":t+="Central "}return t+="retinal artery occlusion",t+=-150>this.apexY?" sparing":" involving",t+=" the macula",this.apexY>-70&&(t+=" with a cherry red spot"),t},ED.RetinalArteryOcclusionPostPole.prototype.snomedCode=function(){var t=this.type();switch(t){case"branch":return 232035005;case"hemispheric":return 232035005;case"central":return 38742007}},ED.RetinalArteryOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.RetinalTouch=function(t,e){this.className="RetinalTouch",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.RetinalTouch.prototype=new ED.Doodle,ED.RetinalTouch.prototype.constructor=ED.RetinalTouch,ED.RetinalTouch.superclass=ED.Doodle.prototype,ED.RetinalTouch.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.RetinalTouch.prototype.draw=function(t){var e=this.drawing.context;if(ED.RetinalTouch.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,60,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,0,0,0)",e.strokeStyle="rgba(255,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=8,a=20,i=40;e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!0);for(var o=0,s=0;r>s;s++){o+=2*Math.PI/r;var n=new ED.Point(0,0),l=new ED.Point(0,0);n.setWithPolars(a,o),l.setWithPolars(i,o),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y)}e.lineWidth=8,e.strokeStyle="red",e.stroke()}return this.isClicked},ED.RetinalVeinOcclusionPostPole=function(t,e){this.className="RetinalVeinOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RetinalVeinOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalVeinOcclusionPostPole.prototype.constructor=ED.RetinalVeinOcclusionPostPole,ED.RetinalVeinOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalVeinOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalVeinOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalVeinOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalVeinOcclusionPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.RetinalVeinOcclusionPostPole.superclass.draw.call(this,t);var r=420,a=-this.apexY,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=r*Math.sin(o),h=-r*Math.cos(o),d=-r*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=30+p,u=[26,24,22,18,14,10],y=0,i=r-p;i>a;i-=D){for(var g=0,E=-Math.PI/2-s;this.arc-Math.PI/2-s>E;E+=D/i){E=-Math.PI/2-s+2*g*Math.PI/u[y];var m=new ED.Point(0,0);m.setWithPolars(i,E),this.drawNFLHaem(e,m.x,m.y),g++}y++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalVeinOcclusionPostPole.prototype.description=function(){var t="",e=this.type();switch(e){case"branch":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",t+="branch ";break;case"hemispheric":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",t+="hemispheric ";break;case"central":t+="Central "}return t+="retinal vein occlusion ",t+=-150>this.apexY?"sparing ":"involving ",t+="the macula "},ED.RetinalVeinOcclusionPostPole.prototype.snomedCode=function(){var t=this.type();switch(t){case"branch":return 24596005;case"hemispheric":return 232043e3;case"central":return 68478007}},ED.RetinalVeinOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.RoundHole=function(t,e){this.className="RoundHole",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.RoundHole.prototype=new ED.Doodle,ED.RoundHole.prototype.constructor=ED.RoundHole,ED.RoundHole.superclass=ED.Doodle.prototype,ED.RoundHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1)},ED.RoundHole.prototype.setPropertyDefaults=function(){},ED.RoundHole.prototype.setParameterDefaults=function(){var t=300;this.originX=t,this.originY=t;var e=this.drawing.lastDoodleOfClass(this.className);if(e){var r=new ED.Point(e.originX,e.originY),a=r.direction()+Math.PI/8,i=r.length(),o=new ED.Point(0,0);o.setWithPolars(i,a),this.originX=o.x,this.originY=o.y}},ED.RoundHole.prototype.draw=function(t){var e=this.drawing.context;ED.RoundHole.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var r=this.transform.transformPoint(new ED.Point(0,0)),a=this.transform.transformPoint(new ED.Point(60,0)),i=r.x-this.drawing.canvas.width/2,o=r.y-this.drawing.canvas.height/2,s=this.scaleX*Math.sqrt(i*i+o*o),n=this.scaleX*(a.x-r.x);return this.arc=Math.atan(n/s),this.isClicked},ED.RoundHole.prototype.description=function(){var t="";return 1>this.scaleX&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="Round hole ",t+=this.clockHour()+" o'clock"},ED.RoundHole.prototype.snomedCode=function(){return 302888003},ED.RoundHole.prototype.diagnosticHierarchy=function(){return 3},ED.Rubeosis=function(t,e){this.className="Rubeosis",this.severity=50,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Rubeosis.prototype=new ED.Doodle,ED.Rubeosis.prototype.constructor=ED.Rubeosis,ED.Rubeosis.superclass=ED.Doodle.prototype,ED.Rubeosis.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rubeosis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-200),this.parameterValidationArray.severity={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.Rubeosis.prototype.setParameterDefaults=function(){this.arc=Math.PI/12,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY-this.severity:-320},ED.Rubeosis.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"severity":var a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r.apexY=a.apexY-e);break;case"apexY":var a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r.severity=a.apexY-e)}return r},ED.Rubeosis.prototype.draw=function(t){var e=this.drawing.context;ED.Rubeosis.superclass.draw.call(this,t);var r=200,a=this.drawing.lastDoodleOfClass("AntSeg");a&&(r=-a.apexY);var i=r+16;this.parameterValidationArray.apexY.range.max=-r-50,this.apexY=this.parameterValidationArray.apexY.range.constrain(-r-this.severity);var o=-this.apexY,s=i+(o-i)/2;e.beginPath();var n=this.arc/2,l=-Math.PI/2+n,h=-Math.PI/2-n,d=new ED.Point(-s*Math.sin(n),-s*Math.cos(n)),c=new ED.Point(s*Math.sin(n),-s*Math.cos(n));if(e.beginPath(),e.arc(0,0,i,l,h,!0),e.arc(0,0,o,h,l,!1),e.closePath(),e.fillStyle=this.isSelected?"rgba(240,240,240,0.5)":"rgba(240,240,240,0.0)",e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var p=2*Math.PI/16,D=Math.PI/24,u=2*Math.PI/60,y=r+2*(o-r)/3,g=1+Math.floor(this.arc/p),E=0;g>E;E++){var m=d.pointAtRadiusAndClockwiseAngle(r,D+E*p),f=d.pointAtRadiusAndClockwiseAngle(o,D+E*p+u),P=d.pointAtRadiusAndClockwiseAngle(y,D+E*p),w=d.pointAtRadiusAndClockwiseAngle(o,D+E*p+u/2);e.moveTo(m.x,m.y),e.bezierCurveTo(P.x,P.y,w.x,w.y,f.x,f.y),f=d.pointAtRadiusAndClockwiseAngle(o,D+E*p-u),P=d.pointAtRadiusAndClockwiseAngle(y,D+E*p),w=d.pointAtRadiusAndClockwiseAngle(o,D+E*p-u/2),e.moveTo(m.x,m.y),e.bezierCurveTo(P.x,P.y,w.x,w.y,f.x,f.y)}e.lineWidth=4,e.strokeStyle="red",e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(d),this.handleArray[3].location=this.transform.transformPoint(c),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Rubeosis.prototype.groupDescription=function(){return"Rubeotic vessels on margin of pupil at "},ED.Rubeosis.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ScleralIncision=function(t,e){this.className="ScleralIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.ScleralIncision.prototype=new ED.Doodle,ED.ScleralIncision.prototype.constructor=ED.ScleralIncision,ED.ScleralIncision.superclass=ED.Doodle.prototype,ED.ScleralIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.ScleralIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI/2)},ED.ScleralIncision.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.ScleralIncision.prototype.draw=function(t){var e=this.drawing.context;ED.ScleralIncision.superclass.draw.call(this,t);var r=560,a=40,i=r+a,o=r-a;e.beginPath();var s=this.arc/2;if(e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0)",e.lineWidth=5,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,r,-Math.PI/2+s,-Math.PI/2-s,!0);var n=.2,l=new ED.Point(0,0),h=s-n/2;do l.setWithPolars(r-a,h),e.moveTo(l.x,l.y),l.setWithPolars(r+a,h),e.lineTo(l.x,l.y),h-=n;while(h>-s);e.lineWidth=6,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(r,s),this.handleArray[3].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ScleralIncision.prototype.groupDescription=function(){return"Scleral incision at "},ED.ScleralIncision.prototype.description=function(){return this.clockHour()},ED.ScleralIncision.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.Sclerostomy=function(t,e){this.className="Sclerostomy",this.parsPlana=-560,this.overallGauge="23g",this.gauge="23g",this.isSutured=!1,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Sclerostomy.prototype=new ED.Doodle,ED.Sclerostomy.prototype.constructor=ED.Sclerostomy,ED.Sclerostomy.superclass=ED.Doodle.prototype,ED.Sclerostomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Sclerostomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-660,-460),this.parameterValidationArray.overallGauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.gauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.isSutured={kind:"derived",type:"bool",display:!0}},ED.Sclerostomy.prototype.setParameterDefaults=function(){this.apexY=-600,this.gauge="23g",this.isSutured=!1,this.arc=1,this.setRotationWithDisplacements(60,-45)},ED.Sclerostomy.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexY":r.gauge=-610>e?"20g":-560>e?"23g":-510>e?"25g":"27g";break;case"overallGauge":r.gauge=e;break;case"gauge":r.apexY="20g"==e?-650:"23g"==e?-600:"25g"==e?-550:-500;break;case"arc":r.isSutured=2>e?!1:!0;break;case"isSutured":r.arc=e?3:1}return r},ED.Sclerostomy.prototype.draw=function(t){var e=this.drawing.context;if(ED.Sclerostomy.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-120,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.gauge){case"20g":e.beginPath(),e.moveTo(-50,this.parsPlana),e.bezierCurveTo(-30,this.parsPlana-30,30,this.parsPlana-30,50,this.parsPlana),e.bezierCurveTo(30,this.parsPlana+30,-30,this.parsPlana+30,-50,this.parsPlana),e.closePath(),e.fillStyle="red",e.fill();break;case"23g":e.beginPath(),e.rect(-60,this.parsPlana-120,120,60),e.fillStyle="rgba(0, 0, 255, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana-60,60,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana,60,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"25g":e.beginPath(),e.rect(-50,this.parsPlana-120,100,60),e.fillStyle="rgba(255, 128, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana-60,40,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana,40,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"27g":e.beginPath(),e.rect(-40,this.parsPlana-120,80,60),e.fillStyle="rgba(0, 255, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana-60,30,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana,30,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill()}e.fill(),(this.isSutured||"20g"==this.gauge)&&(e.beginPath(),e.moveTo(-40,this.parsPlana+40),e.lineTo(-40,this.parsPlana-40),e.lineTo(40,this.parsPlana+40),e.lineTo(40,this.parsPlana-40),e.lineTo(-40,this.parsPlana+40),e.lineWidth=6,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Sclerostomy.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.fillStyle="gray",t.font="64px sans-serif",t.fillText(this.gauge,80,this.parsPlana+20)},ED.Sclerostomy.prototype.groupDescription=function(){return"Sclerostomies at "},ED.Sclerostomy.prototype.description=function(){var t=this.isSutured?" (sutured)":"";return this.clockHour()+t},ED.Sclerostomy.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.SectorIridectomy=function(t,e){this.className="SectorIridectomy",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorIridectomy.prototype=new ED.Doodle,ED.SectorIridectomy.prototype.constructor=ED.SectorIridectomy,ED.SectorIridectomy.superclass=ED.Doodle.prototype,ED.SectorIridectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorIridectomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300)},ED.SectorIridectomy.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.rotation=t.rotation+Math.PI/2)},ED.SectorIridectomy.prototype.draw=function(t){var e=this.drawing.context;ED.SectorIridectomy.superclass.draw.call(this,t);var r,a=376,i=this.drawing.lastDoodleOfClass("AntSeg");r=i?-i.apexY-2:300;var o=r+(a-r)/2,s=this.arc/2;-Math.PI/2+s,-Math.PI/2-s;var n=o*Math.sin(s),l=-o*Math.cos(s),h=-o*Math.sin(s),d=l;e.beginPath();var s=this.arc/2;return e.arc(0,0,a,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,r,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(218,230,241,1)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,1)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorIridectomy.prototype.description=function(){var t="Sector iridectomy of "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.SectorPRP=function(t,e){this.className="SectorPRP",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorPRP.prototype=new ED.Doodle,ED.SectorPRP.prototype.constructor=ED.SectorPRP,ED.SectorPRP.superclass=ED.Doodle.prototype,ED.SectorPRP.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRP.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0)},ED.SectorPRP.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRP.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRP.superclass.draw.call(this,t);var r=476,a=100,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=30+p,u=[47,41,35,28,22,15],y=0,i=r-p;i>a;i-=D){for(var g=0,E=-Math.PI/2-s;this.arc-Math.PI/2-s>E;E+=D/i){E=-Math.PI/2-s+2*g*Math.PI/u[y];
var m=new ED.Point(0,0);m.setWithPolars(i,E),this.drawLaserSpot(e,m.x,m.y),g++}y++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorPRPPostPole=function(t,e){this.className="SectorPRPPostPole",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorPRPPostPole.prototype=new ED.Doodle,ED.SectorPRPPostPole.prototype.constructor=ED.SectorPRPPostPole,ED.SectorPRPPostPole.superclass=ED.Doodle.prototype,ED.SectorPRPPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRPPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.SectorPRPPostPole.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRPPostPole.superclass.draw.call(this,t);var r=500,a=300,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=30+p,u=[47,41,35,28,22,15],y=0,i=r-p;i>a;i-=D){for(var g=0,E=-Math.PI/2-s;this.arc-Math.PI/2-s>E;E+=D/i){E=-Math.PI/2-s+2*g*Math.PI/u[y];var m=new ED.Point(0,0);m.setWithPolars(i,E),this.drawLaserSpot(e,m.x,m.y),g++}y++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorPRPPostPole.prototype.description=function(){return"Sector PRP"},ED.SidePort=function(t,e){this.className="SidePort",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SidePort.prototype=new ED.Doodle,ED.SidePort.prototype.constructor=ED.SidePort,ED.SidePort.superclass=ED.Doodle.prototype,ED.SidePort.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0},ED.SidePort.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(90,180)},ED.SidePort.prototype.draw=function(t){var e=this.drawing.context;ED.SidePort.superclass.draw.call(this,t);var r=334,a=30,i=r+a,o=r-a;e.beginPath();var s=.125;return e.arc(0,0,i,-Math.PI/2+s,-Math.PI/2-s,!0),e.arc(0,0,o,-Math.PI/2-s,-Math.PI/2+s,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.SidePort.prototype.groupDescription=function(){return"Sideport at "},ED.SidePort.prototype.description=function(){return this.clockHour()},ED.SidePort.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.StarFold=function(t,e){this.className="StarFold",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.StarFold.prototype=new ED.Doodle,ED.StarFold.prototype.constructor=ED.StarFold,ED.StarFold.superclass=ED.Doodle.prototype,ED.StarFold.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.StarFold.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250),this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.StarFold.prototype.setParameterDefaults=function(){this.apexY=50,this.scaleX=.25,this.scaleY=.25;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),r=new ED.Point(0,0);r.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(r.x,r.y)}else this.move(0,400)},ED.StarFold.prototype.draw=function(t){var e=this.drawing.context;return ED.StarFold.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,-this.apexY),e.bezierCurveTo(100,-50,260,-240,300,-200),e.bezierCurveTo(340,-160,100,-100,2*this.apexY,0),e.bezierCurveTo(100,100,340,160,300,200),e.bezierCurveTo(260,240,100,50,0,this.apexY),e.bezierCurveTo(-100,50,-260,240,-300,200),e.bezierCurveTo(-340,160,-100,100,-2*this.apexY,0),e.bezierCurveTo(-100,-100,-340,-160,-300,-200),e.bezierCurveTo(-260,-240,-100,-50,0,-this.apexY),e.closePath(),e.lineWidth=0,e.fillStyle="lightgreen",e.strokeStyle="green",this.drawBoundary(t),this.arc=Math.atan2(600*this.scaleX,Math.abs(this.originY)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(-300,200)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.StarFold.prototype.description=function(){var t="Star fold at ";return t+=this.clockHour()+" o'clock"},ED.StarFold.prototype.snomedCode=function(){return 232018006},ED.StarFold.prototype.diagnosticHierarchy=function(){return 2},ED.StrabOpTemplate=function(t,e){this.className="StrabOpTemplate",ED.Doodle.call(this,t,e)},ED.StrabOpTemplate.prototype=new ED.Doodle,ED.StrabOpTemplate.prototype.constructor=ED.StrabOpTemplate,ED.StrabOpTemplate.superclass=ED.Doodle.prototype,ED.StrabOpTemplate.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isUnique=!0,this.isDeletable=!1},ED.StrabOpTemplate.prototype.draw=function(t){var e=this.drawing.context;ED.StrabOpTemplate.superclass.draw.call(this,t);var r=-200,a=70;return e.beginPath(),e.arc(0,0,80,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(100, 200, 250, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.fillStyle="black",e.fill(),e.beginPath(),e.moveTo(-a,r),e.lineTo(a,r),e.moveTo(r,-a),e.lineTo(r,a),e.moveTo(-a,-r),e.lineTo(a,-r),e.moveTo(-r,-a),e.lineTo(-r,a),e.lineWidth=16,e.strokeStyle="brown",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalFluid=function(t,e){this.className="SubretinalFluid",this.numberOfHandles=8,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.SubretinalFluid.prototype=new ED.Doodle,ED.SubretinalFluid.prototype.constructor=ED.SubretinalFluid,ED.SubretinalFluid.superclass=ED.Doodle.prototype,ED.SubretinalFluid.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.SubretinalFluid.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,r=this.numberOfHandles,a={};a.length=new ED.Range(50,290),a.angle=new ED.Range(((2*r-1)*e/(2*r)+t*e/r)%e,(1*e/(2*r)+t*e/r)%e),this.handleVectorRangeArray[t]=a}},ED.SubretinalFluid.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+100,0);this.move(e.x,e.y)}else this.move(100*(this.drawing.eye==ED.eye.Right?-1:1),0);var r=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(r);for(var a=0;this.numberOfHandles>a;a++){var i=new ED.Point(0,0);i.setWithPolars(this.initialRadius,2*a*Math.PI/this.numberOfHandles),this.addPointToSquiggle(i)}},ED.SubretinalFluid.prototype.draw=function(t){var e=this.drawing.context;ED.SubretinalFluid.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){r=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;a=this.squiggleArray[0].pointsArray[l],i=r.tangentialControlPoint(+s),o=a.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,a.x,a.y)}e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t);for(var n=0;this.numberOfHandles>n;n++)this.handleArray[n].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[n]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalFluid.prototype.description=function(){return"Subretinal fluid"},ED.SubretinalPFCL=function(t,e){this.className="SubretinalPFCL",this.savedParameterArray=["apexY","originX","originY"],ED.Doodle.call(this,t,e),this.rotation=Math.PI/4},ED.SubretinalPFCL.prototype=new ED.Doodle,ED.SubretinalPFCL.prototype.constructor=ED.SubretinalPFCL,ED.SubretinalPFCL.superclass=ED.Doodle.prototype,ED.SubretinalPFCL.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.SubretinalPFCL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-20)},ED.SubretinalPFCL.prototype.setParameterDefaults=function(){this.apexY=-40;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),r=new ED.Point(0,0);r.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(r.x,r.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),0)},ED.SubretinalPFCL.prototype.draw=function(t){var e=this.drawing.context;ED.SubretinalPFCL.superclass.draw.call(this,t),e.beginPath();var r=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);e.arc(0,0,r,0,2*Math.PI,!0),e.lineWidth=1;var a=r/1.1412135,i=e.createLinearGradient(-a,-a,a,a);return i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.7,"rgba(200,200,200,1)"),i.addColorStop(1,"rgba(140,140,140,1)"),e.fillStyle=i,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalPFCL.prototype.groupDescription=function(){return"Subretinal PFCL"},ED.Supramid=function(t,e){this.className="Supramid",this.savedParameterArray=["apexY","originX","originY"],ED.Doodle.call(this,t,e)},ED.Supramid.prototype=new ED.Doodle,ED.Supramid.prototype.constructor=ED.Supramid,ED.Supramid.superclass=ED.Doodle.prototype,ED.Supramid.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Supramid.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1,this.snapToQuadrant=!0,this.quadrantPoint=new ED.Point(10,10),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-420,-200)},ED.Supramid.prototype.setParameterDefaults=function(){this.apexX=0,this.apexY=-350,this.originY=-10,this.drawing.eye==ED.eye.Right?(this.originX=-10,this.rotation=-Math.PI/4):(this.originX=10,this.rotation=Math.PI/4)},ED.Supramid.prototype.draw=function(t){var e=this.drawing.context;ED.Supramid.superclass.draw.call(this,t);var r=new ED.Point(0,this.apexY),a=new ED.Point(0,-450),i=new ED.Point(0,-600),o=-450,s=new ED.Point(o,-300),n=new ED.Point(o,0),l=new ED.Point(o,300),h=new ED.Point(.5*o,450),d=new ED.Point(.2*o,450);return e.beginPath(),e.moveTo(this.apexX,a.y),e.lineTo(o,a.y),e.lineTo(o,d.y),e.lineTo(this.apexX,d.y),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.bezierCurveTo(i.x,i.y,s.x,s.y,n.x,n.y),e.bezierCurveTo(l.x,l.y,h.x,h.y,d.x,d.y),e.lineWidth=4,e.strokeStyle="purple",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Supramid.prototype.description=function(){var t="Supramid suture ";return t+=this.getParameter("endPosition")},ED.SwollenDisc=function(t,e){this.className="SwollenDisc",this.savedParameterArray=["originX"],ED.Doodle.call(this,t,e)},ED.SwollenDisc.prototype=new ED.Doodle,ED.SwollenDisc.prototype.constructor=ED.SwollenDisc,ED.SwollenDisc.superclass=ED.Doodle.prototype,ED.SwollenDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.SwollenDisc.prototype.setParameterDefaults=function(){this.originY=0,this.drawing.hasDoodleOfClass("PostPole")&&(this.originX=this.drawing.eye==ED.eye.Right?300:-300)},ED.SwollenDisc.prototype.draw=function(t){var e=this.drawing.context;ED.SwollenDisc.superclass.draw.call(this,t);var r=140,a=80;e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.arc(0,0,a,2*Math.PI,0,!1),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var i="rgba(240, 140, 40, 0.75)",o=e.createRadialGradient(0,0,r,0,0,a);return o.addColorStop(0,yellowColour),o.addColorStop(1,i),e.fillStyle=o,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.isClicked},ED.SwollenDisc.prototype.description=function(){return"Swollen disc"},ED.Telangiectasis=function(t,e){this.className="Telangiectasis",this.savedParameterArray=["originX","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Telangiectasis.prototype=new ED.Doodle,ED.Telangiectasis.prototype.constructor=ED.Telangiectasis,ED.Telangiectasis.superclass=ED.Doodle.prototype,ED.Telangiectasis.prototype.setHandles=function(){this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.Telangiectasis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-100,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Telangiectasis.prototype.setParameterDefaults=function(){this.originX=this.drawing.eye==ED.eye.Right?-160:160},ED.Telangiectasis.prototype.draw=function(t){var e=this.drawing.context;ED.Telangiectasis.superclass.draw.call(this,t),e.beginPath();var r=100;if(e.arc(0,0,r,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var a="red",i=10/this.scaleX,o=new ED.Point(0,0),s=10,n=0;s>n;n++)o.setWithPolars(.8*r*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,i,a);if(-50>this.apexY){a="yellow",s=18;for(var n=0;s>n;n++)o.setWithPolars(r,2*Math.PI*n/s),this.drawSpot(e,o.x,o.y,i,a)}a="brown",s=Math.abs(Math.floor(this.apexX/10));for(var n=0;s>n;n++)o.setWithPolars(.8*r*ED.randomArray[n+10],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,o.x,o.y,2*i,a)}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Telangiectasis.prototype.description=function(){return"Parafoveal telangiectasia"},ED.ToricPCIOL=function(t,e){this.className="ToricPCIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.ToricPCIOL.prototype=new ED.Doodle,ED.ToricPCIOL.prototype.constructor=ED.ToricPCIOL,ED.ToricPCIOL.superclass=ED.Doodle.prototype,ED.ToricPCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ToricPCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isOrientated=!1,this.isScaleable=!1,this.isUnique=!0},ED.ToricPCIOL.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75},ED.ToricPCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ToricPCIOL.superclass.draw.call(this,t),e.beginPath();var r=240;if(e.arc(0,0,r,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var a=.7*Math.PI/4,i=a+Math.PI,o=new ED.Point(0,0);o.setWithPolars(r-20,a);var s=new ED.Point(0,0);s.setWithPolars(r-100,a);var n=new ED.Point(0,0);n.setWithPolars(r-20,i);var l=new ED.Point(0,0);l.setWithPolars(r-100,i),e.moveTo(o.x,o.y),e.lineTo(s.x,s.y),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y),e.lineWidth=24,e.lineCap="round",e.strokeStyle="darkgray",e.stroke()}var h=new ED.Point(0,0);return h.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ToricPCIOL.prototype.description=function(){var t="Toric posterior chamber IOL",e=40,r="";return-e>this.originY&&(r.length>0&&(r+=" and"),r+=" superiorly"),this.originY>e&&(r.length>0&&(r+=" and"),r+=" inferiorly"),-e>this.originX&&(r.length>0&&(r+=" and"),r+=" temporally"),this.originX>e&&(r.length>0&&(r+=" and"),r+=" nasally"),r.length>0&&(t+=" displaced"+r),t},ED.Trabectome=function(t,e){this.className="Trabectome",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.Trabectome.prototype=new ED.Doodle,ED.Trabectome.prototype.constructor=ED.Trabectome,ED.Trabectome.superclass=ED.Doodle.prototype,ED.Trabectome.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.Trabectome.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI)},ED.Trabectome.prototype.setParameterDefaults=function(){this.arc=Math.PI/4,this.setRotationWithDisplacements(-90,-120)},ED.Trabectome.prototype.draw=function(t){var e=this.drawing.context;ED.Trabectome.superclass.draw.call(this,t);var r=440,a=400,i=500,o=10,s=760,n=100,l=150,h=170,d=this.arc/2,c=-Math.PI/2+d,p=-Math.PI/2-d,D=(r+a)/2,u=D*Math.sin(d),y=-D*Math.cos(d),g=-D*Math.sin(d),E=y;if(e.beginPath(),e.arc(0,0,r,c,p,!0),e.arc(0,0,a,p,c,!1),e.moveTo(-o,i-(n+s)),e.lineTo(0,i-(n+s)-o),e.lineTo(o,i-(n+s)),e.lineTo(o,i-n),e.lineTo(l,i),e.lineTo(l,i+h),e.lineTo(-l,i+h),e.lineTo(-l,i),e.lineTo(-o,i-n),e.lineTo(-o,i-(n+s)),e.lineWidth=4,e.fillStyle="rgba(200, 200, 200, 0.5)",e.strokeStyle="rgba(200, 200, 200, 0.8)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,r,c,p,!0),e.arc(0,0,a,p,c,!1),e.fillStyle="rgba(200, 100, 100, 0.8)",e.strokeStyle="red",e.fill(),e.stroke();var m=334,f=30,P=m+f,w=m-f;e.beginPath();var b=.125;e.arc(0,0,P,Math.PI/2+b,Math.PI/2-b,!0),e.arc(0,0,w,Math.PI/2-b,Math.PI/2+b,!1),e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="rgba(120,120,120,0.75)",e.fill(),e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(g,E)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(u,y)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Trabectome.prototype.description=function(){return"Trabecular meshwork ablation of "+this.degreesExtent()+" degrees centred around "+this.clockHour()+" o'clock"},ED.TrabyFlap=function(t,e){this.className="TrabyFlap",this.site="Superior",this.size="4x3",this.sclerostomy="Punch",this.height=-580,this.r=380,this.right=new ED.Point(0,0),this.left=new ED.Point(0,0),this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.TrabyFlap.prototype=new ED.Doodle,ED.TrabyFlap.prototype.constructor=ED.TrabyFlap,ED.TrabyFlap.superclass=ED.Doodle.prototype,ED.TrabyFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.TrabyFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.snapToArc=!0,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-440,-440),this.parameterValidationArray.rotation.delta=.1,this.parameterValidationArray.site={kind:"derived",type:"string",list:["Superior","Superonasal","Superotemporal"],animate:!0},this.parameterValidationArray.size={kind:"derived",type:"string",list:["4x3","5x2"],animate:!1},this.parameterValidationArray.sclerostomy={kind:"derived",type:"string",list:["Punch","Block"],animate:!1},this.arcArray=[.9,1.13]},ED.TrabyFlap.prototype.setParameterDefaults=function(){this.apexY=-440,this.height=-580,this.setParameterFromString("size","Superior"),this.setParameterFromString("size","4x3"),this.setParameterFromString("sclerostomy","Punch")},ED.TrabyFlap.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexX":r.sclerostomy=0>e?"Punch":"Block";break;case"arc":1>e?(r.size="4x3",r.height=-580):(r.size="5x2",r.height=-510);break;case"rotation":r.site=e>Math.PI/16&&Math.PI>e?this.drawing.eye==ED.eye.Right?"Superonasal":"Superotemporal":e>=Math.PI&&31*Math.PI/16>e?this.drawing.eye==ED.eye.Right?"Superotemporal":"Superonasal":"Superior";break;case"site":switch(e){case"Superior":r.rotation=0;break;case"Superonasal":r.rotation=this.drawing.eye==ED.eye.Right?Math.PI/4:7*Math.PI/4;break;case"Superotemporal":r.rotation=this.drawing.eye==ED.eye.Right?7*Math.PI/4:Math.PI/4}break;case"size":switch(e){case"4x3":r.arc=.9,r.height=-580,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2));break;case"5x2":r.arc=1.13,r.height=-510,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2))}break;case"sclerostomy":switch(e){case"Punch":r.apexX=-50;break;case"Block":r.apexX=50}}return r},ED.TrabyFlap.prototype.draw=function(t){var e=this.drawing.context;ED.TrabyFlap.superclass.draw.call(this,t);var r=this.arc/2,a=-Math.PI/2+r,i=-Math.PI/2-r;if(this.arc/6,new ED.Point(0,this.height),this.right.x=this.r*Math.sin(r),this.right.y=-this.r*Math.cos(r),this.left.x=-this.r*Math.sin(r),this.left.y=-this.r*Math.cos(r),e.beginPath(),e.arc(0,0,this.r,a,i,!0),e.lineTo(this.left.x,this.height),e.lineTo(this.right.x,this.height),e.closePath(),e.fillStyle="rgba(220,220,150,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),"Punch"==this.sclerostomy)e.arc(0,this.apexY,50,0,2*Math.PI,!0);else{var o=r/2;a=-Math.PI/2+o,i=-Math.PI/2-o;var s=new ED.Point(0,-this.r+(this.height+this.r)/2);e.arc(0,0,this.r,a,i,!0),e.lineTo(-this.r*Math.sin(o),s.y),e.lineTo(this.r*Math.sin(o),s.y),e.closePath()}e.fillStyle="gray",e.fill()}return this.handleArray[0].location=this.transform.transformPoint(this.left),this.handleArray[3].location=this.transform.transformPoint(this.right),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrabyFlap.prototype.description=function(){return"Trabeculectomy flap at "+this.clockHour()+" o'clock with "+this.sclerostomy.firstLetterToLowerCase()+" sclerostomy"},ED.TrabySuture=function(t,e){this.className="TrabySuture",this.type="Fixed",this.savedParameterArray=["originX","originY","apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.TrabySuture.prototype=new ED.Doodle,ED.TrabySuture.prototype.constructor=ED.TrabySuture,ED.TrabySuture.superclass=ED.Doodle.prototype,ED.TrabySuture.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.TrabySuture.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(70,70),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Fixed","Adjustable","Releasable"],animate:!1}},ED.TrabySuture.prototype.setParameterDefaults=function(){this.apexX=50,this.apexY=70,this.type="Fixed"},ED.TrabySuture.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"apexX":r.type=e>17?"Releasable":e>-17?"Adjustable":"Fixed";break;case"type":switch(e){case"Fixed":r.apexX=-50;break;case"Adjustable":r.apexX=0;break;case"Releasable":r.apexX=50}}return r},ED.TrabySuture.prototype.draw=function(t){var e=this.drawing.context;if(ED.TrabySuture.superclass.draw.call(this,t),e.beginPath(),e.rect(-40,-70,80,100),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle=this.isSelected?"gray":"rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),this.type){case"Releasable":e.moveTo(-2,64),e.bezierCurveTo(20,36,-15,16,-16,-7),e.bezierCurveTo(-18,-30,-12,-43,-4,-43),e.bezierCurveTo(6,-43,12,-28,12,-9),e.bezierCurveTo(12,11,0,23,-2,30),e.bezierCurveTo(-3,36,3,37,2,30),e.bezierCurveTo(2,20,-4,24,-3,29),e.bezierCurveTo(-3,36,14,37,23,56),e.bezierCurveTo(32,74,34,100,34,100);var r=new ED.Point(this.firstOriginX,-60),a=new ED.AffineTransform;a.translate(150,150);var i=this.drawing.lastDoodleOfClass("TrabyFlap");i&&a.rotate(i.rotation);var o=a.transformPoint(r),s=this.inverseTransform.transformPoint(o),n=119/8;n=5==this.id?0*n:6==this.id?1*n:-1*n;var l=new ED.Point(this.firstOriginX-n,-90),h=a.transformPoint(l),d=this.inverseTransform.transformPoint(h);e.bezierCurveTo(d.x,d.y,d.x,d.y,s.x,s.y);break;case"Adjustable":e.moveTo(-2,64),e.bezierCurveTo(20,36,-15,16,-16,-7),e.bezierCurveTo(-18,-30,-12,-43,-4,-43),e.bezierCurveTo(6,-43,12,-28,12,-9),e.bezierCurveTo(12,11,0,23,-2,30),e.bezierCurveTo(-3,36,3,37,2,30),e.bezierCurveTo(2,20,-4,24,-3,29),e.bezierCurveTo(-3,36,14,37,23,56),e.bezierCurveTo(32,74,34,100,34,100);break;case"Fixed":e.moveTo(0,-30),e.bezierCurveTo(5,-10,5,10,0,30),e.bezierCurveTo(-5,10,-5,-10,0,-30),e.moveTo(-5,50),e.lineTo(0,30),e.lineTo(5,50)}e.lineWidth=8,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="purple",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(40,-70)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrabySuture.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.fillStyle="gray",t.font="64px sans-serif",t.fillText(this.type,80,20)},ED.TractionRetinalDetachment=function(t,e){this.className="TractionRetinalDetachment",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.TractionRetinalDetachment.prototype=new ED.Doodle,ED.TractionRetinalDetachment.prototype.constructor=ED.TractionRetinalDetachment,ED.TractionRetinalDetachment.superclass=ED.Doodle.prototype,ED.TractionRetinalDetachment.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!0)},ED.TractionRetinalDetachment.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.TractionRetinalDetachment.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(200,-100)},ED.TractionRetinalDetachment.prototype.draw=function(t){var e=this.drawing.context;ED.TractionRetinalDetachment.superclass.draw.call(this,t),e.beginPath();var r=60,a=150;return e.moveTo(-a,-a),e.bezierCurveTo(-r,-r,r,-r,a,-a),e.bezierCurveTo(r,-r,r,r,a,a),e.bezierCurveTo(r,r,-r,r,-a,a),e.bezierCurveTo(-r,r,-r,-r,-a,-a),e.closePath(),e.lineWidth=1,e.strokeStyle="blue",e.fillStyle="blue",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(a,-a)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TractionRetinalDetachment.prototype.groupDescription=function(){return"Traction retinal detachment "},ED.TractionRetinalDetachment.prototype.description=function(){return this.locationRelativeToDisc()},ED.TransilluminationDefect=function(t,e){this.className="TransilluminationDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.TransilluminationDefect.prototype=new ED.Doodle,ED.TransilluminationDefect.prototype.constructor=ED.TransilluminationDefect,ED.TransilluminationDefect.superclass=ED.Doodle.prototype,ED.TransilluminationDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Arc,!1)},ED.TransilluminationDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.TransilluminationDefect.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.TransilluminationDefect.prototype.draw=function(t){var e=this.drawing.context;ED.TransilluminationDefect.superclass.draw.call(this,t);var r=380,a=280,i=a+(r-a)/2,o=this.arc/2,s=-Math.PI/2+o,n=-Math.PI/2-o,l=i*Math.sin(o),h=-i*Math.cos(o),d=-i*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,r,s,n,!0),e.arc(0,0,a,n,s,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var p=30,D=Math.PI/8,u=-Math.PI/2-s+D/2;this.arc-Math.PI/2-s>u;u+=D){var y=new ED.Point(0,0);y.setWithPolars(i,u),this.drawCircle(e,y.x,y.y,p,"rgba(255,255,255,1)",4,"rgba(255,255,255,1)")}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TransilluminationDefect.prototype.groupDescription=function(){return"Transillumination defects of iris"},ED.TrialFrame=function(t,e){this.className="TrialFrame",ED.Doodle.call(this,t,e)},ED.TrialFrame.prototype=new ED.Doodle,ED.TrialFrame.prototype.constructor=ED.TrialFrame,ED.TrialFrame.superclass=ED.Doodle.prototype,ED.TrialFrame.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isUnique=!0},ED.TrialFrame.prototype.draw=function(t){var e=this.drawing.context;ED.TrialFrame.superclass.draw.call(this,t),e.beginPath();var r=420,a=340,i=300,o=20,s=50,n=-Math.PI/20,l=0+n,h=Math.PI-n;if(e.beginPath(),e.arc(0,0,r,l,h,!1),e.arc(0,0,i,h,l,!0),e.closePath(),e.fillStyle="rgba(230,230,230,1)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.font=s+"px sans-serif",e.fillStyle="blue",e.beginPath();for(var d=0,c=new ED.Point(0,0),p=new ED.Point(0,0),D=new ED.Point(0,0),u=new ED.Point(0,0),y=new ED.Point(0,0),g=0;19>g;g++){var E=g.toFixed(0);d=(-90-10*g)*Math.PI/180,c.setWithPolars(i,d),p.setWithPolars(i+o,d),D.setWithPolars(a,d),y.setWithPolars(r-o,d),u.setWithPolars(r,d),e.moveTo(c.x,c.y),e.lineTo(p.x,p.y),e.moveTo(y.x,y.y),e.lineTo(u.x,u.y),e.save(),e.translate(D.x,D.y),e.rotate(Math.PI+d),e.textAlign="center",e.fillText(E,0,40),e.restore()
}e.moveTo(-20,0),e.lineTo(20,0),e.moveTo(0,-20),e.lineTo(0,20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrialLens=function(t,e){this.className="TrialLens",this.axis="0",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.TrialLens.prototype=new ED.Doodle,ED.TrialLens.prototype.constructor=ED.TrialLens,ED.TrialLens.superclass=ED.Doodle.prototype,ED.TrialLens.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.TrialLens.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.TrialLens.prototype.dependentParameterValues=function(t,e){var r=[];switch(t){case"rotation":r.axis=(360-180*e/Math.PI)%180;break;case"axis":r.rotation=(180-e)*Math.PI/180}return r},ED.TrialLens.prototype.draw=function(t){var e=this.drawing.context;ED.TrialLens.superclass.draw.call(this,t);var r=360,a=180;if(e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!0),e.moveTo(a,0),e.arc(0,0,a,2*Math.PI,0,!1),e.lineWidth=4,e.fillStyle="rgba(255,100,100,1)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=20;e.beginPath(),e.moveTo(r-i,0),e.lineTo(a+i,0),e.moveTo(-r+i,0),e.lineTo(-a-i,0),e.lineWidth=16,e.strokeStyle="black",e.stroke()}return this.isClicked},ED.UTear=function(t,e){this.className="UTear",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.UTear.prototype=new ED.Doodle,ED.UTear.prototype.constructor=ED.UTear,ED.UTear.superclass=ED.Doodle.prototype,ED.UTear.prototype.setHandles=function(){this.handleArray[3]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.UTear.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30)},ED.UTear.prototype.setParameterDefaults=function(){this.apexY=-20;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),r=new ED.Point(0,0);r.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(r.x,r.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.UTear.prototype.draw=function(t){var e=this.drawing.context;return ED.UTear.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,40),e.bezierCurveTo(-20,40,-40,-20,-40,-40),e.bezierCurveTo(-40,-60,-20,this.apexY,0,this.apexY),e.bezierCurveTo(20,this.apexY,40,-60,40,-40),e.bezierCurveTo(40,-20,20,40,0,40),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(40,-40)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.UTear.prototype.groupDescription=function(){return"'U' tear at "},ED.UTear.prototype.description=function(){return this.clockHour()},ED.UTear.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.UTear.prototype.snomedCode=function(){return 247168006},ED.UTear.prototype.diagnosticHierarchy=function(){return 6},ED.Vicryl=function(t,e){this.className="Vicryl",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.Vicryl.prototype=new ED.Doodle,ED.Vicryl.prototype.constructor=ED.Vicryl,ED.Vicryl.superclass=ED.Doodle.prototype,ED.Vicryl.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1},ED.Vicryl.prototype.setParameterDefaults=function(){this.originY=-240,this.drawing.eye==ED.eye.Right?(this.originX=-240,this.rotation=-Math.PI/4):(this.originX=240,this.rotation=Math.PI/4)},ED.Vicryl.prototype.draw=function(t){var e=this.drawing.context;return ED.Vicryl.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-20,0),e.arcTo(0,-20,20,0,30),e.arcTo(0,20,-20,0,30),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="purple",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(35,-10),e.lineTo(20,0),e.lineTo(35,10),e.stroke(),this.drawSpot(e,20,0,4,"purple")),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Vicryl.prototype.description=function(){return"Vicryl suture"},ED.VisualField=function(t,e){this.className="VisualField",this.numberOfHandles=8,this.blindSpotX=0,this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e)},ED.VisualField.prototype=new ED.Doodle,ED.VisualField.prototype.constructor=ED.VisualField,ED.VisualField.superclass=ED.Doodle.prototype,ED.VisualField.prototype.setHandles=function(){for(var t=0;this.numberOfHandles>t;t++)this.handleArray[t]=new ED.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.VisualField.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.handleVectorRangeArray=[];for(var t=0;this.numberOfHandles>t;t++){var e=2*Math.PI,r={};r.length=new ED.Range(0,400),r.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=r}},ED.VisualField.prototype.setParameterDefaults=function(){this.apexY=-40;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],r=0;this.numberOfHandles>r;r++){var a=e[r],i=new ED.Point(a[0],a[1]);this.addPointToSquiggle(i)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualField.prototype.draw=function(t){var e=this.drawing.context;ED.VisualField.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){r=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;a=this.squiggleArray[0].pointsArray[l],100>r.length()||100>a.length()?e.lineTo(a.x,a.y):(i=r.tangentialControlPoint(+s),o=a.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,a.x,a.y))}e.moveTo(this.blindSpotX-this.apexY,0),e.arc(this.blindSpotX,0,-this.apexY,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2,e.fillStyle="lightGray",e.strokeStyle="black",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(0,-450),e.lineTo(0,450),e.moveTo(-450,0),e.lineTo(450,0),e.lineWidth=8,e.strokeStyle="black",e.stroke());for(var n=0;this.numberOfHandles>n;n++)this.handleArray[n].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[n]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.blindSpotX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VisualField.prototype.description=function(){return""},ED.VisualFieldChart=function(t,e){this.className="VisualFieldChart",this.numberOfHandles=8,this.blindSpotX=0,ED.Doodle.call(this,t,e)},ED.VisualFieldChart.prototype=new ED.Doodle,ED.VisualFieldChart.prototype.constructor=ED.VisualFieldChart,ED.VisualFieldChart.superclass=ED.Doodle.prototype,ED.VisualFieldChart.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.VisualFieldChart.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],r=0;this.numberOfHandles>r;r++){var a=e[r],i=new ED.Point(a[0],a[1]);this.addPointToSquiggle(i)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualFieldChart.prototype.draw=function(t){var e=this.drawing.context;ED.VisualFieldChart.superclass.draw.call(this,t),e.beginPath();var r,a,i,o,s=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var n=0;this.numberOfHandles>n;n++){r=this.squiggleArray[0].pointsArray[n];var l=this.numberOfHandles-1>n?n+1:0;a=this.squiggleArray[0].pointsArray[l],i=r.tangentialControlPoint(+s),o=a.tangentialControlPoint(-s),e.bezierCurveTo(i.x,i.y,o.x,o.y,a.x,a.y)}return e.closePath(),e.lineWidth=2,e.fillStyle="gray",e.strokeStyle="black",this.drawBoundary(t),this.isClicked},ED.VitreousOpacity=function(t,e){this.className="VitreousOpacity",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.VitreousOpacity.prototype=new ED.Doodle,ED.VitreousOpacity.prototype.constructor=ED.VitreousOpacity,ED.VitreousOpacity.superclass=ED.Doodle.prototype,ED.VitreousOpacity.prototype.setHandles=function(){this.handleArray[2]=new ED.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Handle(null,!0,ED.Mode.Apex,!1)},ED.VitreousOpacity.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.VitreousOpacity.prototype.setParameterDefaults=function(){this.apexY=-100,this.setOriginWithDisplacements(0,-100)},ED.VitreousOpacity.prototype.draw=function(t){var e=this.drawing.context;ED.VitreousOpacity.superclass.draw.call(this,t),e.beginPath(),e.beginPath();var r=200;e.arc(0,0,r,0,2*Math.PI,!0);var a=.3+.6*(r+2*this.apexY)/r;return e.fillStyle="rgba(255, 0, 0,"+a+")",e.lineWidth=0,e.strokeStyle="rgba(255, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw,point=new ED.Point(0,0),point.setWithPolars(r,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VitreousOpacity.prototype.description=function(){return"Vitreous haemorrhage"},ED.VitreousOpacity.prototype.snomedCode=function(){return 31341008};