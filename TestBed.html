<!DOCTYPE html>
<html>
    <head>
        <title>EyeDraw</title>
        
        <link rel="stylesheet" href="css/OEEyeDraw.css" type="text/css" media="screen" />
        
        <!-- Comment this line out if not using jQuery -->
        <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->

        <!--   Include this file first to establish name space and include key drawing classes  charset="utf-8"-->
        <script language="JavaScript" src="js/ED_Drawing.js" type="text/javascript"></script>
        
        <!-- Include language specific file with tooltips. Note use of charset attribute to define utf-8 -->
        <!-- NB how to register a script with attribute charset="utf-8" using yii? -->
        <script language="JavaScript" src="js/ED_Tooltips.js" type="text/javascript" charset="utf-8"></script>
        
        <!--   Subclasses loaded according to need -->
        <script language="JavaScript" src="js/ED_General.js" type="text/javascript"></script>


        <script language="JavaScript" src="js/ED_AntSeg.js" type="text/javascript"></script>
        <!-- <script language="JavaScript" src="js/ED_Strabismus.js" type="text/javascript"></script> -->
        <!-- <script language="JavaScript" src="js/ED_Cardiology.js" type="text/javascript"></script> -->
        <!-- <script language="JavaScript" src="js/ED_MedicalRetina.js" type="text/javascript"></script> -->
        <!-- <script language="JavaScript" src="js/ED_Glaucoma.js" type="text/javascript"></script> -->
        <script language="JavaScript" src="js/ED_VitreoRetinal.js" type="text/javascript"></script>
        
        <!--   This script handles the drawings for the page   -->
        <script type="text/javascript">
            
            // This set can be written by PHP and contains doodle data for this drawing from a database
//            var doodleSet = [{"subclass": "PhakoIncision", "originX": 0, "originY": 0, "radius": 250, "apexX": 0, "apexY": -250, "scaleX": 1.00, "scaleY": 1.00, "arc": 90, "rotation": 319, "order": 0, "squiggleArray": []}];
            
            // Runs on page load
            
            // Unique variable assigned to the drawing
            var drawingEdit;
            var drawingDisplay;
            var doodle;
            
            // Runs on page load
            function init()
            {
                // Get reference to the drawingEdit canvas
                var canvasEdit = document.getElementById('canvasEdit');
                
                // Create a drawingEdit
                drawingEdit = new ED.Drawing(canvasEdit, ED.eye.Right, 'RPS', true);
                
                // Instantiate a controller object
                var controller = new eyeDrawController(drawingEdit);
                
                // Initialise drawing
                drawingEdit.init();
                
                // Set focus to canvasEdit element
                canvasEdit.focus();
                
//                for (var propertyName in ED)
//                {
//                    var doodle = ED[propertyName];
//                    
//                    if (doodle.superclass == ED.Doodle.prototype)
//                    {
//                        var dood = new ED[propertyName];
//                        console.log(dood.className);
//                    }
//                }
            }

            // Controller class
            function eyeDrawController(_drawing)
            {
                this.drawing = _drawing;
                
                var postpole;
                
                // Specify call back function
                this.callBack = callBack;
                
                // Register for notifications with drawing object
                this.drawing.registerForNotifications(this, 'callBack', []);
                
                // Method called for notification
                function callBack(_messageArray)
                {
                    //console.log("Notified for event: " + _messageArray['eventName']);
 
                    switch (_messageArray['eventName'])
                    {
                        // Eye draw image files all loaded
                        case 'ready':
                        
                        /* Vitrectomy stuff */
                        this.drawing.globalScaleFactor = 0.72;
                        
                        //var doodle = this.drawing.addDoodle('AntSeg');
                        
                        //this.drawing.addDoodle('Sclerostomy', {gauge:'20g'}, {overallGauge:{id:'gaugeSelect', attribute:'value'}});
                        //this.drawing.addDoodle('Sclerostomy', {gauge:'20g', rotation:Math.PI}, {overallGauge:{id:'gaugeSelect', attribute:'value'}});
                        
                        //var rot = this.drawing.eye == ED.eye.Right?4 * Math.PI/3:2 * Math.PI/3;
                        //this.drawing.addDoodle('Sclerostomy', {gauge:'20g', rotation:rot}, {overallGauge:{id:'gaugeSelect', attribute:'value'}});
                        
                        this.drawing.addDoodle('ScleralIncision');
                        this.drawing.addDoodle('ScleralIncision');

                        /* Trabeculectomy stuff
                        var doodle = this.drawing.addDoodle('AntSeg');
                        doodle.scaleX = 0.72;
                        doodle.scaleY = 0.72;
                        this.drawing.addDoodle('ConjunctivalFlap');
                        this.drawing.addDoodle('PartialThicknessScleralFlap');
                        var pi = this.drawing.addDoodle('PI');
                        pi.scaleX = 0.72;
                        pi.scaleY = 0.72;
                         */
                        
                        //this.drawing.addDoodle('PCIOL');
//                            this.drawing.addDoodle('LeftCoronaryArtery');
//this.drawing.addDoodle('DrugStent');

                        //this.drawing.addDoodle('Stenosis', {degree:'0'}, {degree:{id:'stenosisInput'}, type:{id:'typeInput'}});
                        //_drawing.addDoodle('AntSeg', {pupilSize:'Small'}, {pupilSize:'pupilSizeInput'});
                            this.drawing.deselectDoodles();
                            break;
                        case 'parameterChanged':
                            var dood = _messageArray['object'].doodle;
//                            if (dood.className == "Microaneurysm")
//                            {
//                                //console.log(postpole.isWithinDisc(dood));
//                            }
                        
                            break;
                    }
                }
            }
            
            </script>
    </head>
    
    <body onload="init();">
        <!-- Doodle controls toolbar -->
        <div class="ed_toolbar">
            <button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="graphics/moveToFront.gif"/></button>
            <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="graphics/moveToBack.gif" /></button>
            <button class="imgbutton" disabled="true" id="flipVerRPS" title="Flip around vertical axis" onclick="drawingEdit.flipVer(); return false;" ><img src="graphics/flipVer.gif" /></button>
            <button class="imgbutton" disabled="true" id="flipHorRPS" title="Flip around horizontal axis" onclick="drawingEdit.flipHor(); return false;" ><img src="graphics/flipHor.gif" /></button>
            <button class="imgbutton" disabled="true" id="deleteSelectedDoodleRPS" title="Delete" onclick="drawingEdit.deleteSelectedDoodle(); return false;" ><img src="graphics/deleteSelectedDoodle.gif" /></button>
            <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="graphics/lock.gif" /></button>
            <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="graphics/unlock.gif" /></button>
            <br />
        </div>
            
        <!-- Doodle selection toolbar -->
        <div class="ed_toolbar" id="canvasEdit1doodleToolbar">
            <button id="LensRPS" class="imgbutton" title="Sclerostomy" onclick="drawingEdit.addDoodle('Sclerostomy'); return false;" ><img src="graphics/Sclerostomy.gif" /></button>
            <button id="LensRPS" class="imgbutton" title="Lens" onclick="drawingEdit.addDoodle('EncirclingBand'); return false;" ><img src="graphics/ChandelierSingle.gif" /></button>
            <button id="LensRPS" class="imgbutton" title="Lens" onclick="drawingEdit.addDoodle('CutterPI'); return false;" ><img src="graphics/CutterPI.gif" /></button>
            <button class="imgbutton" title="Click to toggle suture on selected sclerostomy" onclick="var dood = drawingEdit.selectedDoodle; if (dood) dood.isSutured = dood.isSutured?false:true; drawingEdit.repaint(); return false;" ><img src="graphics/MattressSuture.gif" /></button>


            <br />
        </div>
        
        <!-- Canvas tooltip -->
        <span class="canvasTooltip" id="canvasEditTooltip"></span>
        
        <!-- Canvas element style="border: none;"-->
        <canvas id="canvasEdit" class="ed_canvas_edit" width="300" height="300" tabindex="1"></canvas>

        </br>
        
        <!-- Input element -->
        <input type="text" id="stenosisInput" value="0" />
        <input type="text" id="typeInput" value="Calcified" />
        
        <button onclick="console.log(drawingEdit.report()); return false;" >Report</button>
        
        <!-- Input element -->
        <select id="gaugeSelect">
            <option value="20g" >20g</option>
            <option value="23g" selected="true">23g</option>
            <option value="25g">25g</option>
            <option value="27g">27g</option>
        </select>

        
    </body>
</html>

<!--
 
 
//paramArray = {surgeonPosition:"Nasal"};
//paramArray = {incisionMeridian:45, incisionLength:'6', incisionSite:"Limbal"};
//paramArray = {incisionMeridian:45, incisionLength:'9.9', incisionSite:'Limbal'};
//, {incisionMeridian:'incisionMedirianTextBox'}, {incisionMeridian:'incisionMedirianTextBox', incisionLength:'incisionLengthTextBox', incisionSite:'incisionSiteSelect'}, {grade:'pupilSize', pxe:'chk_pxe'}
//doodle = this.drawing.addDoodle('AntSeg', {grade:'Small', pxe:'true'}, {grade:'pupilSize', pxe:'chk_pxe'});
 
//doodle = this.drawing.addDoodle('LaserCircle');
//doodle = this.drawing.addDoodle('LaserDemarcation');

//doodle = this.drawing.addDoodle('PhakoIncision', paramArray);
//var PhakoIncisionId = doodle.id;

//                        var sideport1 = this.drawing.addDoodle('SidePort', {incisionMeridian:180});
//                        var sideport2 = this.drawing.addDoodle('SidePort', {incisionMeridian:0});
//                        sideport1.setParameterWithAnimation('incisionMeridian', '0');
//                        sideport2.setParameterWithAnimation('incisionMeridian', '180');

//doodle = this.drawing.addDoodle('Square');

// For compatibility with update method in frameworks, add bindings later
//                            bindingsArray['PhakoIncision'] = {
//                                incisionMeridian:'incisionMedirianTextBox',
//                                incisionLength:'incisionLengthTextBox',
//                                incisionSite:'incisionSiteSelect'
//                            };

//                        this.drawing.addBindings(bindingsArray);

// First doodle
//var doodle = this.drawing.addDoodle('AntSeg', paramArray, {grade:'pupilSize'});
//var AntSegId = doodle.id;



// Second doodle
//paramArray = {incisionMeridian:45, incisionLength:5.0};
//doodle = this.drawing.addDoodle('PhakoIncision', paramArray);
//var PhakoIncisionId = doodle.id;


//bindingsArray[AntSegId] = {grade:'pupilSize'};

// Loop through doodles


//var doodleBindingsArray = bindingsArray[PhakoIncisionId];
//console.log(doodleBindingsArray);

//                            for (var param in doodleBindingsArray)
//                            {
//                                console.log("   " + param + ":" + doodleBindingsArray[param]);
//                                doodle.addBinding(param, doodleBindingsArray[param]);
//                            }

//console.log(bindingsArray);

//                        for (var doodleClass in bindingsArray)
//                        {
//                            //console.log(doodleClass);
//                            for (var param in bindingsArray[doodleClass])
//                            {
//                                console.log("   " + param + ":" + bindingsArray[doodleClass][param]);
//                            }
//                        }
-->

