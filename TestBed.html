<!DOCTYPE html>
<html>
    <head>
        <title>EyeDraw</title>
        
        <link rel="stylesheet" href="css/OEEyeDraw.css" type="text/css" media="screen" />
        
        <!--   Include this file first to establish name space and include key drawing classes -->
        <script language="JavaScript" src="js/ED_Drawing.js" type="text/javascript"></script>
        
        <!--   Subclasses loaded according to need -->
        <script language="JavaScript" src="js/ED_General.js" type="text/javascript"></script>


        <script language="JavaScript" src="js/ED_VitreoRetinal.js" type="text/javascript"></script>
        <script language="JavaScript" src="js/ED_AntSeg.js" type="text/javascript"></script>
        <script language="JavaScript" src="js/ED_Strabismus.js" type="text/javascript"></script> 
        <script language="JavaScript" src="js/ED_Glaucoma.js" type="text/javascript"></script> 
        
        <!--   This script handles the drawings for the page   -->
        <script type="text/javascript">
            
            // This set can be written by PHP and contains doodle data for this drawing from a database
//var doodleSet = [{"subclass": "Fundus", "originX": 0, "originY": 0, "radius": 0, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 180, "rotation": 0, "order": 0, "squiggleArray": []}, {"subclass": "RRD", "originX": 0, "originY": 0, "radius": 164, "apexX": 0, "apexY": -100, "scaleX": 1.00, "scaleY": 1.00, "arc": 120, "rotation": -26, "order": 1, "squiggleArray": []}, {"subclass": "Lattice", "originX": 0, "originY": 0, "radius": 319, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 60, "rotation": 74, "order": 2, "squiggleArray": []}, ]
            
            var doodleSet = [{"subclass": "PhakoIncision", "originX": 0, "originY": 0, "radius": 250, "apexX": 0, "apexY": -250, "scaleX": 1.00, "scaleY": 1.00, "arc": 90, "rotation": 319, "order": 0, "squiggleArray": []}];
            
            // Assign a global variable to each drawing on the page
            var drawingEdit;
            var doodleAngleGradeSup;
            var doodle;
            var doodleSet;
            var medialRectus;
            var lateralRectus;
            
            // Runs on page load
            function init()
            {
                // Get reference to the drawing canvas
                var canvas = document.getElementById('canvas');
                
                // Create a drawing linked to the canvas
                drawingEdit = new ED.Drawing(canvas, ED.eye.Right, 'RPS', true, 0, 0);
                
                // Preload any images
                drawingEdit.preLoadImagesFrom('graphics/');
                
                // Set focus to canvas element
                canvas.focus();
                
                // Wait for drawing object to be ready before adding objects or drawings
                drawingEdit.onLoaded = function()
                {
                    //drawingEdit.addDoodle('AntSeg');
                    doodle = drawingEdit.addDoodle('CapsularTensionRing');

//                    lateralRectus = drawingEdit.addDoodle('Rectus');
//                    
//                    if (drawingEdit.eye == ED.eye.Right)
//                    {
//                        medialRectus.rotation = Math.PI/2;
//                        lateralRectus.rotation = -Math.PI/2;
//                    }
//                    else
//                    {
//                        medialRectus.rotation = -Math.PI/2;
//                        lateralRectus.rotation = Math.PI/2;                        
//                    }


                    //doodle = drawingEdit.addDoodle('RoundHole');

                    
                    //drawingEdit.addDoodle('Iris');
                    //drawingEdit.addDoodle('Pupil');
                    
                    //drawingEdit.addDoodle('Molteno');
                    //var dood = drawingEdit.addDoodle('Supramid');
                    //dood.baseRadius = 280;
                    //drawingEdit.addDoodle('Vicryl');
                    
                    //doodleAngleGradeSup = drawingEdit.addDoodle('AngleGrade');
//                    doodle.rotation = 90 * Math.PI/180;
//                    doodle = drawingEdit.addDoodle('AngleGrade');
//                    doodle.rotation = 180 * Math.PI/180;
//                    doodle = drawingEdit.addDoodle('AngleGrade');
//                    doodle.rotation = 270 * Math.PI/180;
                    //drawingEdit.addDoodle('Patch');
                    drawingEdit.deselectDoodles();
                    
                    
                    drawingEdit.drawAllDoodles();
                }
                
                // Function to detect changes in parameters (eg from mouse dragging)
                drawingEdit.parameterListener = function()
                {
                    if (drawingEdit.selectedDoodle != null && drawingEdit.selectedDoodle.className == 'Rectus')
                    {
                        if (typeof(medialRectus) != 'undefined' && medialRectus.isSelected)
                        {
                            document.getElementById('mr_value').value = medialRectus.getParameter('recession');
                        }
                        
                        if (typeof(lateralRectus) != 'undefined' && lateralRectus.isSelected)
                        {
                            document.getElementById('lr_value').value = lateralRectus.getParameter('recession');
                        }
                        
                        if (typeof(medialRectus) != 'undefined' && medialRectus.isSelected)
                        {
                            document.getElementById('mrt_value').value = medialRectus.getParameter('transposition');
                        }                        
                    }
                }
            }
            
            function setPosition(_value)
            {
                // Set new value for doodle
                drawingEdit.setParameterForDoodle(doodle, 'surgeonPosition', _value); 
            }
            
            // Sets suture type
            function sutureType(_muscle, _value)
            {
                switch (_muscle)
                {
                    case 'mr':
                        if (_value != 'Fixed') medialRectus.hangback = true;
                        else medialRectus.hangback = false;
                    break;
                    case 'lr':
                        if (_muscle == 'lr' && _value != 'Fixed') lateralRectus.hangback = true;
                        else lateralRectus.hangback = false;
                    break;
                }
                drawingEdit.repaint();
            }
            
            </script>
    </head>
    
    <body onload="init();">
        <div>
            <div>
                <form>
                    <div>
                        <span>
                            
                            <!-- Doodle controls toolbar -->
                            <button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="graphics/moveToFront.gif"/></button>
                            <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="graphics/moveToBack.gif" /></button>
                            <button class="imgbutton" disabled="true" id="flipVerRPS" title="Flip around vertical axis" onclick="drawingEdit.flipVer(); return false;" ><img src="graphics/flipVer.gif" /></button>
                            <button class="imgbutton" disabled="true" id="flipHorRPS" title="Flip around horizontal axis" onclick="drawingEdit.flipHor(); return false;" ><img src="graphics/flipHor.gif" /></button>
                            <button class="imgbutton" disabled="true" id="deleteDoodleRPS" title="Delete" onclick="drawingEdit.deleteDoodle(); return false;" ><img src="graphics/deleteDoodle.gif" /></button>
                            <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="graphics/lock.gif" /></button>
                            <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="graphics/unlock.gif" /></button>
                            <br />
                            
                            <!-- Doodle selection toolbar -->
                            <button class="imgbutton" title="Disk haemorrhage" onclick="drawingEdit.addDoodle('DiskHaemorrhage'); return false;" ><img src="graphics/DiskHaemorrhage.gif" /></button>
                            <button class="imgbutton" title="NerveFibreDefect" onclick="drawingEdit.addDoodle('NerveFibreDefect'); return false;" ><img src="graphics/NerveFibreDefect.gif" /></button>
                            <button class="imgbutton" title="Papilloedema" onclick="drawingEdit.addDoodle('Papilloedema'); return false;" ><img src="graphics/Papilloedema.gif" /></button>
                            <button class="imgbutton" title="Baerveldt" onclick="drawingEdit.addDoodle('Baerveldt'); return false;" ><img src="graphics/Baerveldt.gif" /></button>
                            <button class="imgbutton" title="Ahmed" onclick="drawingEdit.addDoodle('Ahmed'); return false;" ><img src="graphics/Ahmed.gif" /></button>
                            <button class="imgbutton" title="Vicryl suture" onclick="drawingEdit.addDoodle('Vicryl'); return false;" ><img src="graphics/Vicryl.gif" /></button>
                            <button class="imgbutton" title="Supramid" onclick="drawingEdit.addDoodle('AntSeg'); return false;" ><img src="graphics/Supramid.gif" /></button>
                            <button class="imgbutton" title="Acquired Pit of Optic Nerve" onclick="drawingEdit.addDoodle('CornealSuture'); return false;" ><img src="graphics/OpticDiskPit.gif" /></button>
                            <button class="imgbutton" title="Capsular Tension Ring" onclick="drawingEdit.addDoodle('CapsularTensionRing'); return false;" ><img src="graphics/CapsularTensionRing.gif" /></button>

                            <br />
                            
                            <!-- Canvas element -->
                            <canvas id="canvas" class="ed_canvas_edit" width="400" height="400" tabindex="2"></canvas>
                            <br />
                            <button title="Save" onclick="console.log(drawingEdit.save()); return false;" >Save</button><br />
                            <button title="Load" onclick="drawingEdit.load(doodleSet); drawingEdit.drawAllDoodles(); return false;" >Load</button><br />
                            <select onchange="sutureType('lr', this.value)">
                                <option value="Fixed">Fixed</option>
                                <option value="Hangback">Hangback</option>
                                <option value="Adjustable">Adjustable</option>
                            </select>
                            <select onchange="sutureType('mr', this.value)">
                                <option value="Fixed">Fixed</option>
                                <option value="Hangback">Hangback</option>
                                <option value="Adjustable">Adjustable</option>
                            </select></br>
                            <input type="text" id="lr_value" onchange="lateralRectus.setParameter('recession', this.value);"/>
                            <input type="text" id="mr_value" onchange="drawingEdit.setParameterForDoodle(medialRectus, 'recession', this.value);"/>
                            <input type="text" id="mrt_value" onchange="medialRectus.setParameter('transposition', this.value);"/>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </body>
</html>