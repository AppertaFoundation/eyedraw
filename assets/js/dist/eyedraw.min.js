/*! eyedraw 04-12-2019 */

(ED=ED||{}).handleRadius=15,ED.arrowDelta=4,ED.squiggleWidth={Thin:4,Medium:12,Thick:20},ED.squiggleStyle={Outline:0,Solid:1},ED.recentClick=!1,ED.eye={Right:0,Left:1},ED.drawFunctionMode={Draw:0,HitTest:1},ED.Mode={None:0,Move:1,Scale:2,Arc:3,Rotate:4,Apex:5,Handles:6,Draw:7,Select:8,Size:9},ED.handleRing={Inner:0,Outer:1},ED.modified=!1,ED.findOffset=function(t,e,i){if(t.offsetParent){do{e+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:i}}},ED.findPosition=function(t,e){var i;return i="undefined"!=typeof jQuery?jQuery(t).offset():ED.findOffset(t,0,0),{x:e.pageX-i.left,y:e.pageY-i.top}},ED.objectIsEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},ED.isFirefox=function(){return window.navigator.userAgent.indexOf("Firefox")>0},ED.isNumeric=function(t){return t-0==t&&t.length>0},ED.Mod=function(t,e){return t-Math.floor(t/e)*e},ED.positiveAngle=function(t){for(var e=2*Math.PI;t<0;)t+=e;return t%e},ED.errorHandler=function(t,e,i){console.trace("EYEDRAW ERROR! class: ["+t+"] method: ["+e+"] message: ["+i+"]")},ED.firstLetterToUpperCase=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},ED.firstLetterToLowerCase=function(t){var e=t.charAt(1);return e===e.toUpperCase()?t:t.charAt(0).toLowerCase()+t.slice(1)},ED.addAndAfterLastComma=function(t){for(var e=!1,i=t.length-1;i>=0;i--)if(","===t.charAt(i)){e=!0;break}return e?t.substring(0,i)+", and"+t.substring(i+1,t.length):t},ED.titles={},ED.setTitles=function(t){$.extend(this.titles,t)},ED.randomArray=[.657,.2886,.7388,.1621,.9896,.0434,.1695,.9099,.1948,.4433,.158,.7392,.873,.2165,.7138,.6316,.3425,.2838,.4551,.4153,.7421,.3364,.6087,.1986,.5764,.1952,.6179,.6699,.0903,.2968,.2684,.9383,.2488,.4579,.2921,.9085,.7951,.45,.2255,.3366,.667,.73,.5511,.5623,.1376,.5553,.9898,.4317,.5922,.6452,.5008,.7077,.0704,.2293,.5697,.7415,.1557,.2944,.4566,.4129,.2449,.562,.4105,.5486,.8917,.9346,.0921,.7998,.7717,.0357,.1179,.0168,.152,.5187,.3466,.1663,.5935,.7524,.841,.1859,.6012,.8171,.9272,.3367,.8133,.4868,.3665,.9625,.7839,.3052,.1651,.6414,.7361,.0065,.3267,.0554,.3389,.8967,.8777,.0557,.9201,.6015,.2676,.3365,.2606,.0989,.2085,.3526,.8476,.0146,.019,.6896,.5198,.9871,.0288,.8037,.6741,.2148,.2584,.8447,.848,.5557,.248,.4736,.8869,.1867,.3869,.6871,.1011,.7561,.734,.1525,.9968,.8179,.7103,.5462,.415,.4187,.0478,.6511,.0386,.5243,.7271,.9093,.4461,.1264,.0756,.9405,.7287,.0684,.282,.4059,.3694,.7641,.4188,.0498,.7841,.9136,.621,.2249,.9935,.9709,.0741,.6218,.3166,.2237,.7754,.4191,.2195,.2935,.4529,.9112,.9183,.3275,.1856,.8345,.0442,.6297,.903,.4689,.9512,.2219,.9993,.8981,.1018,.9362,.6426,.4563,.1267,.7889,.5057,.8588,.4669,.0687,.6623,.3681,.8152,.9004,.0822,.3652],(ED=ED||{}).Drawing=function(t,e,i,r,a){if(t&&t instanceof HTMLCanvasElement){var o=!1,n=1,s=0;if(this.graphicsPath="assets/img",this.scaleOn="height",void 0!==a&&(a.offsetX&&a.offsetX,a.offsetY&&a.offsetY,a.toImage&&(o=a.toImage),a.graphicsPath&&(this.graphicsPath=a.graphicsPath),a.scaleOn&&(this.scaleOn=a.scaleOn),a.scale&&(n=a.scale),a.toggleScale&&(s=a.toggleScale)),this.drawingName=a.drawingName,this.canvas=t,this.eye=e,this.idSuffix=i,this.isEditable=r,this.hoverTimer=null,this.convertToImage=!(!o||this.isEditable),this.context=this.canvas.getContext("2d"),this.doodleArray=new Array,this.bindingArray=new Array,this.listenerArray=new Array,this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.selectedDoodle=null,this.mouseIsDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.lastMousePosition=new ED.Point(0,0),this.doubleClickMilliSeconds=250,this.readyNotificationSent=!1,this.newPointOnClick=!1,this.completeLine=!1,this.globalScaleFactor=n,this.toggleScaleFactor=s,this.origScaleLevel=n,this.scrollValue=0,this.lastDoodleId=0,this.isActive=!1,this.isNew=!0,this.isReady=!1,this.showDoodleControls=!1,this.onReadyCommands=[],this.resetDoodleSet=!1,this.lastTouchPoint=void 0,this.boundElementDeleteValueArray=new Array,this.canvasParent=this.canvas.parentElement,this.notificationArray=new Array,this.canvasTooltip=document.getElementById(this.canvas.id+"Tooltip"),"height"==this.scaleOn?this.scale=this.canvas.height/1001:this.scale=this.canvas.width/1001,this.doodlePlaneWidth=this.canvas.width/this.scale,this.doodlePlaneHeight=this.canvas.height/this.scale,this.imageArray=new Array,this.imageArray.LatticePattern=new Image,this.imageArray.CribriformPattern=new Image,this.imageArray.CribriformPatternSmall=new Image,this.imageArray.CryoPattern=new Image,this.imageArray.AntPVRPattern=new Image,this.imageArray.LaserPattern=new Image,this.imageArray.FuchsPattern=new Image,this.imageArray.PSCPattern=new Image,this.imageArray.MeshworkPatternLight=new Image,this.imageArray.MeshworkPatternMedium=new Image,this.imageArray.MeshworkPatternHeavy=new Image,this.imageArray.NewVesselPattern=new Image,this.imageArray.OedemaPattern=new Image,this.imageArray.OedemaPatternBullous=new Image,this.imageArray.BrownSpotPattern=new Image,this.imageArray.TranslucentPattern=new Image,this.imageArray.ThinningPattern=new Image,this.imageArray.TraumaPattern=new Image,this.transform.translate(this.canvas.width/2,this.canvas.height/2),this.transform.scale(this.scale,this.scale),this.inverseTransform=this.transform.createInverse(),this.clear(),this.selectionRectangleIsBeingDragged=!1,this.selectionRectangleStart=new ED.Point(0,0),this.selectionRectangleEnd=new ED.Point(0,0),this.isEditable){var l=this;this.canvas.addEventListener("mousedown",function(t){var e=ED.findPosition(this,t),i=new ED.Point(e.x,e.y);l.mousedown(i)},!1),this.canvas.addEventListener("mouseup",function(t){var e=ED.findPosition(this,t),i=new ED.Point(e.x,e.y);l.mouseup(i)},!1),this.canvas.addEventListener("mousemove",function(t){var e=ED.findPosition(this,t),i=new ED.Point(e.x,e.y);l.mousemove(i)},!1),this.canvas.addEventListener("mouseover",function(t){var e=ED.findPosition(this,t),i=new ED.Point(e.x,e.y);l.mouseover(i)},!1),this.canvas.addEventListener("mouseout",function(t){var e=ED.findPosition(this,t),i=new ED.Point(e.x,e.y);l.mouseout(i)},!1),document.body.addEventListener("mousedown",function(t){var e=t.target,i=!1,r="("+["ed-doodle-popup","ed-button","ed-canvas","ed_canvas","ed-selected-doodle-select"].join(")|(")+")";do{i=new RegExp(r).test(e.className)}while((e=e.parentNode)&&e!==document.body&&!i);i||l.deselectDoodles()},!1),this.canvas.addEventListener("touchstart",function(t){if(void 0!==t.targetTouches[0]){var e=l.getPositionOfElement(l.canvas),i=new ED.Point(t.targetTouches[0].pageX-e[0]-this.offsetLeft,t.targetTouches[0].pageY-e[1]);t.preventDefault()}else ED.errorHandler("ED.Drawing","Class","Touches undefined: ");this.lastTouchPoint=i,l.mousedown(i)},!1),this.canvas.addEventListener("touchend",function(t){void 0!==this.lastTouchPoint&&(l.mouseup(this.lastTouchPoint),this.lastTouchPoint=void 0)},!1),this.canvas.addEventListener("touchmove",function(t){if(void 0!==t.targetTouches[0]){var e=l.getPositionOfElement(l.canvas),i=new ED.Point(t.targetTouches[0].pageX-e[0]-this.offsetLeft,t.targetTouches[0].pageY-e[1]);this.lastTouchPoint=i,l.mousemove(i)}},!1),window.addEventListener("keydown",function(e){document.activeElement===t&&l.keydown(e)},!0),this.canvas.onselectstart=function(){return!1}}}else ED.errorHandler("ED.Drawing","constructor","Invalid canvas element")},ED.Drawing.prototype.getPositionOfElement=function(t){for(var e=0,i=0;e+=t.offsetLeft,i+=t.offsetTop,null!==t.offsetParent;)t=t.offsetParent;return[e,i]},ED.Drawing.prototype.init=function(){this.preLoadImagesFrom(this.graphicsPath+"/patterns/")},ED.Drawing.prototype.replaceWithImage=function(){var t=document.createElement("img");if(t.setAttribute("src",this.canvas.toDataURL("image/png")),this.canvasParent.hasChildNodes())for(;this.canvasParent.childNodes.length>=1;)this.canvasParent.removeChild(this.canvasParent.firstChild);this.canvasParent.appendChild(t)},ED.Drawing.prototype.preLoadImagesFrom=function(t){var e=this;for(var i in this.imageArray)this.imageArray[i].onload=function(){e.checkAllLoaded()},this.imageArray[i].onerror=function(e){return function(){ED.errorHandler("ED.Drawing","preLoadImagesFrom",'Error loading image file "'+e+'.gif" from directory: "'+t+'"')}}(i),this.imageArray[i].src=t+i+".gif"},ED.Drawing.prototype.checkAllLoaded=function(){var t=!0;for(var e in this.imageArray){var i=!1;this.imageArray[e].width>0&&(i=!0),t=t&&i}t&&(this.readyNotificationSent||(this.readyNotificationSent=!0,this.notify("ready")))},ED.Drawing.prototype.registerForNotifications=function(t,e,i){void 0===e&&(e="notificationHandler"),void 0===i&&(i=new Array),this.notificationArray.push({object:t,methodName:e,notificationList:i})},ED.Drawing.prototype.unRegisterForNotifications=function(t){var e=this.notificationArray.indexOf(t);e>=0&&this.notificationArray.splice(e,1)},ED.Drawing.prototype.notify=function(t,e){for(var i={eventName:t,selectedDoodle:this.selectedDoodle,object:e},r=0;r<this.notificationArray.length;r++){var a=this.notificationArray[r].notificationList,o=this.notificationArray[r].object,n=this.notificationArray[r].methodName;(0==a.length||a.indexOf(t)>=0)&&(void 0!==o[n]?o[n].apply(o,[i]):ED.errorHandler("ED.Drawing","notify","Attempt to call undefined notification handler method"))}},ED.Drawing.prototype.loadDoodles=function(t){var e=document.getElementById(t);if(e&&e.value.length>0){var i=window.JSON.parse(e.value);this.resetDoodleSet=i,this.load(i),this.isNew=!1,this.notify("doodlesLoaded")}},ED.Drawing.prototype.load=function(t){for(var e=0;e<t.length;e++){if(void 0===ED[t[e].subclass]){ED.errorHandler("ED.Drawing","load","Unrecognised doodle: "+t[e].subclass);break}this.doodleArray[e]=new ED[t[e].subclass](this,t[e]),this.doodleArray[e].id=e}this.doodleArray.sort(function(t,e){return t.order-e.order})},ED.Drawing.prototype.save=function(){return"["+this.json()+"]"},ED.Drawing.prototype.json=function(){for(var t="",e=0;e<this.doodleArray.length;e++){var i=this.doodleArray[e];i.isSaveable&&(t=t+i.json()+",")}return t=t.substring(0,t.length-1)},ED.Drawing.prototype.drawAllDoodles=function(){var t=this.context;t.beginPath();for(var e,i=!1,r=0;r<this.doodleArray.length;r++)this.doodleArray[r].isPointInLine&&(i?t.lineTo(this.doodleArray[r].originX,this.doodleArray[r].originY):(t.moveTo(this.doodleArray[r].originX,this.doodleArray[r].originY),i=!0,e=new ED.Point(this.doodleArray[r].originX,this.doodleArray[r].originY)));this.completeLine&&void 0!==e&&t.lineTo(e.x,e.y),i&&(t.lineWidth=4,t.strokeStyle="rgba(20,20,20,1)",t.stroke());for(r=0;r<this.doodleArray.length;r++)this.context.save(),this.doodleArray[r].draw(),this.context.restore()},ED.Drawing.prototype.mousedown=function(t){this.mouseIsDown=!0;this.selectedDoodle;ED.recentClick&&(this.doubleClick=!0),ED.recentClick=!0;setTimeout("ED.recentClick = false;",this.doubleClickMilliSeconds);var e=!1;this.lastSelectedDoodle=this.selectedDoodle,this.selectedDoodle=null;for(var i=this.doodleArray.length-1;i>-1;i--)e?(this.doodleArray[i].isSelected=!1,this.doodleArray[i].isForDrawing=!1):(this.context.save(),this.doodleArray[i].draw(t)?this.doodleArray[i].isSelectable&&(this.doubleClick&&this.doodleArray[i].isSelected&&this.doodleArray[i].isDrawable&&(this.doodleArray[i].isForDrawing=!0),e=!0,this.selectDoodle(this.doodleArray[i]),!this.doubleClick&&this.doodleArray[i].isForDrawing&&this.doodleArray[i].addSquiggle()):(this.doodleArray[i].isSelected=!1,this.doodleArray[i].isForDrawing=!1),this.context.restore()),this.doodleArray[i].isBeingDragged=!1;if(this.selectedDoodle||this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.lastSelectedDoodle&&this.lastSelectedDoodle!=this.selectedDoodle&&this.notify("doodleDeselected"),this.newPointOnClick&&!e){var r=this.inverseTransform.transformPoint(t),a=this.addDoodle("PointInLine");a.originX=r.x,a.originY=r.y}this.repaint(),this.notify("mousedown",{drawing:this,point:t})},ED.Drawing.prototype.click=function(t){this.notify("click",{drawing:this,point:t})},ED.Drawing.prototype.mousemove=function(t){this.notify("mousemove",{drawing:this,point:t});var e=this.selectedDoodle;if(!e||!this.selectedDoodle.isLocked){var i="";if(this.startHoverTimer(t),this.mouseIsDown&&null!=e){if(e.isBeingDragged){var r=this.inverseTransform.transformPoint(t),a=this.inverseTransform.transformPoint(this.lastMousePosition),o=e.inverseTransform.transformPoint(t),n=e.inverseTransform.transformPoint(this.lastMousePosition),s=new ED.Point(t.x-this.canvas.width/2,t.y-this.canvas.height/2),l=new ED.Point(this.lastMousePosition.x-this.canvas.width/2,this.lastMousePosition.y-this.canvas.height/2),h=new ED.Point(0,0),d=new ED.Point(0,-100),c=new ED.Point(e.originX,e.originY),p=new ED.Point(e.originX,e.originY-100);switch(this.mode){case ED.Mode.None:break;case ED.Mode.Move:if(e.isMoveable){var y=e.originX,D=e.originY;if(e.snapToGrid){var u=r.x-e.gridDisplacementX,g=Math.floor(u/e.gridSpacing),P=ED.Mod(u,e.gridSpacing);y=e.gridDisplacementX+e.gridSpacing*(g+Math.round(P/e.gridSpacing));var E=r.y-e.gridDisplacementY,m=Math.floor(E/e.gridSpacing),f=ED.Mod(E,e.gridSpacing);D=e.gridDisplacementY+e.gridSpacing*(m+Math.round(f/e.gridSpacing)),e.move(y-e.originX,D-e.originY)}else e.snapToQuadrant?(0!=r.x&&(y=e.quadrantPoint.x*r.x/Math.abs(r.x)),0!=r.y&&(D=e.quadrantPoint.y*r.y/Math.abs(r.y)),e.move(y-e.originX,D-e.originY)):e.snapToPoints?(y=e.nearestPointTo(r).x,D=e.nearestPointTo(r).y,e.move(y-e.originX,D-e.originY)):e.move(r.x-a.x,r.y-a.y);i="move"}else if(e.isRotatable){var w=this.innerAngle(d,h,l),x=(I=this.innerAngle(d,h,s))-w;if(e.snapToAngles)var b=e.nearestAngleTo(I);else b=ED.Mod(e.rotation+x,2*Math.PI);e.setSimpleParameter("rotation",e.parameterValidationArray.rotation.range.constrainToAngularRange(b,!1)),e.updateDependentParameters("rotation");var v=Math.sqrt(a.x*a.x+a.y*a.y),A=Math.sqrt(r.x*r.x+r.y*r.y),C=e.radius+(A-v);e.setSimpleParameter("radius",e.parameterValidationArray.radius.range.constrain(C)),e.updateDependentParameters("radius")}break;case ED.Mode.Scale:if(e.isScaleable){var M=e.scaleX/Math.abs(e.scaleX),S=e.scaleY/Math.abs(e.scaleY),T=o.x/n.x,k=o.y/n.y;e.isSqueezable||(k=T),T>0&&k>0?(newScaleX=e.scaleX*T,newScaleY=e.scaleY*k,newScaleX=e.parameterValidationArray.scaleX.range.constrain(Math.abs(newScaleX),this.globalScaleFactor),newScaleY=e.parameterValidationArray.scaleY.range.constrain(Math.abs(newScaleY),this.globalScaleFactor),e.setSimpleParameter("scaleX",newScaleX*M),e.setSimpleParameter("scaleY",newScaleY*S),e.updateDependentParameters("scaleX"),e.updateDependentParameters("scaleY")):this.mode=ED.Mode.None}break;case ED.Mode.Arc:var Y=(I=this.innerAngle(p,c,o))-(w=this.innerAngle(p,c,n));e.isArcSymmetrical&&(Y*=2),rotationCorrection=1,e.draggingHandleIndex<2&&(Y=-Y,rotationCorrection=-1),e.snapToArc?(rotationCorrection<0&&(I=2*Math.PI-ED.positiveAngle(I)),e.setSimpleParameter("arc",e.nearestArcTo(e.arc/2+I))):e.parameterValidationArray.arc.range.isBelow(e.arc+Y)?(Y=e.parameterValidationArray.arc.range.min-e.arc,e.setSimpleParameter("arc",e.parameterValidationArray.arc.range.min),this.mode=ED.Mode.None):e.parameterValidationArray.arc.range.isAbove(e.arc+Y)?(Y=e.parameterValidationArray.arc.range.max-e.arc,e.setSimpleParameter("arc",e.parameterValidationArray.arc.range.max),this.mode=ED.Mode.None):e.setSimpleParameter("arc",e.arc+Y),e.updateDependentParameters("arc"),e.isArcSymmetrical||(rotationCorrection=rotationCorrection*Y/2,e.setSimpleParameter("rotation",e.rotation+rotationCorrection),e.updateDependentParameters("rotation"));break;case ED.Mode.Rotate:if(e.isRotatable){var I;w=this.innerAngle(p,c,a),Y=(I=this.innerAngle(p,c,r))-w,b=e.rotation+Y;b=ED.positiveAngle(b),e.setSimpleParameter("rotation",e.parameterValidationArray.rotation.range.constrainToAngularRange(b,!1)),e.updateDependentParameters("rotation")}break;case ED.Mode.Apex:var H=e.apexX+(o.x-n.x),R=e.apexY+(o.y-n.y);e.setSimpleParameter("apexX",e.parameterValidationArray.apexX.range.constrain(H)),e.setSimpleParameter("apexY",e.parameterValidationArray.apexY.range.constrain(R)),e.updateDependentParameters("apexX"),e.updateDependentParameters("apexY");break;case ED.Mode.Size:var X=e.width+2*(o.x-n.x),V=e.height-2*(o.y-n.y);e.setSimpleParameter("width",e.parameterValidationArray.width.range.constrain(X)),e.setSimpleParameter("height",e.parameterValidationArray.height.range.constrain(V)),e.updateDependentParameters("width"),e.updateDependentParameters("height");break;case ED.Mode.Handles:var F=e.draggingHandleIndex,O=new ED.Point(0,0);if(O.x=e.squiggleArray[0].pointsArray[F].x+(o.x-n.x),O.y=e.squiggleArray[0].pointsArray[F].y+(o.y-n.y),void 0!==e.handleCoordinateRangeArray&&(O.x=e.handleCoordinateRangeArray[F].x.constrain(O.x),O.y=e.handleCoordinateRangeArray[F].y.constrain(O.y)),void 0!==e.handleVectorRangeArray){var W=e.handleVectorRangeArray[F].length.constrain(O.length()),z=e.handleVectorRangeArray[F].angle.constrainToAngularRange(O.direction(),!1);O.setWithPolars(W,z)}e.squiggleArray[0].pointsArray[F].x=O.x,e.squiggleArray[0].pointsArray[F].y=O.y,e.updateDependentParameters("handles");break;case ED.Mode.Draw:var L=new ED.Point(o.x,o.y);e.addPointToSquiggle(L);break;case ED.Mode.Select:L=new ED.Point(o.x,o.y)}}else e.isBeingDragged=!0;this.lastMousePosition=t,this.notify("mousedragged",{point:t,action:i}),this.repaint()}}},ED.Drawing.prototype.mouseup=function(t){this.mouseIsDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.selectionRectangleIsBeingDragged=!1,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles()),this.selectedDoodle.willStaySelected||(this.selectedDoodle.isSelected=!1,this.selectedDoodle=null)),this.repaint(),this.notify("mouseup",t)},ED.Drawing.prototype.mouseover=function(t){this.isActive=!0,this.notify("mouseover",t)},ED.Drawing.prototype.mouseout=function(t){this.isActive=!1,this.stopHoverTimer(),this.mouseIsDown=!1,this.mode=ED.Mode.None,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles())),this.notify("mouseout",t)},ED.Drawing.prototype.keydown=function(t){if(null!=this.selectedDoodle){switch(t.keyCode){case 8:"Label"!=this.selectedDoodle.className&&this.deleteSelectedDoodle();break;case 37:this.selectedDoodle.move(-ED.arrowDelta,0);break;case 38:this.selectedDoodle.move(0,-ED.arrowDelta);break;case 39:this.selectedDoodle.move(ED.arrowDelta,0);break;case 40:this.selectedDoodle.move(0,ED.arrowDelta)}this.repaint(),t.stopPropagation(),t.preventDefault(),this.notify("keydown",t.keyCode)}},ED.Drawing.prototype.startHoverTimer=function(t){if(this.isEditable&&null!=this.canvasTooltip){this.stopHoverTimer();var e=this;this.hoverTimer=setTimeout(function(){e.hover(t)},1e3)}},ED.Drawing.prototype.stopHoverTimer=function(){null!=this.canvasTooltip&&(clearTimeout(this.hoverTimer),this.canvasTooltip.innerHTML="",this.hideTooltip())},ED.Drawing.prototype.hover=function(t){this.showTooltip(t),this.notify("hover",t)},ED.Drawing.prototype.showTooltip=function(t){},ED.Drawing.prototype.hideTooltip=function(){this.canvasTooltip.style.display="none"},ED.Drawing.prototype.moveToFront=function(){if(null!=this.selectedDoodle){if(this.selectedDoodle.isLocked)return;this.selectedDoodle.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;t<this.doodleArray.length;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToFront")},ED.Drawing.prototype.moveToBack=function(){if(null!==this.selectedDoodle){if(this.selectedDoodle.isLocked)return;this.selectedDoodle.order=-1,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var t=0;t<this.doodleArray.length;t++)this.doodleArray[t].order=t;this.repaint()}this.notify("moveToBack")},ED.Drawing.prototype.moveNextTo=function(t,e,i){if(this.hasDoodleOfClass(e)){t.order=1e3,this.doodleArray.sort(function(t,e){return t.order-e.order});for(var r=0;r<this.doodleArray.length;r++)this.doodleArray[r].order=r;var a=0;for(r=0;r<this.doodleArray.length-1;r++)this.doodleArray[r].order=r+a,this.doodleArray[r].className==e&&(a=1,i?t.order=r+1:(t.order=r,this.doodleArray[r].order=r+1));this.doodleArray.sort(function(t,e){return t.order-e.order})}},ED.Drawing.prototype.flipVer=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleY=-1*this.selectedDoodle.scaleY,this.repaint()),this.notify("flipVer")},ED.Drawing.prototype.flipHor=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleX=-1*this.selectedDoodle.scaleX,this.repaint()),this.notify("flipHor")},ED.Drawing.prototype.deleteDoodle=function(t,e){var i=!1,r="Attempt to delete a doodle that does not exist";if(e||t.willDelete()){for(var a=0;a<this.doodleArray.length;a++)if(this.doodleArray[a].id==t.id)if(e||this.doodleArray[a].isDeletable){for(var o in i=t,null!=this.selectedDoodle&&this.selectedDoodle.id==t.id&&(this.selectedDoodle.onDeselection(),this.selectedDoodle=null),t.bindingArray){var n=t.bindingArray[o].id,s=t.bindingArray[o].attribute,l=document.getElementById(n),h=this.boundElementDeleteValueArray[n];if(null!=l&&void 0!==h)switch(l.type){case"checkbox":s?ED.errorHandler("ED.Drawing","deleteDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==h?l.setAttribute("checked","checked"):l.removeAttribute("checked");break;case"select-one":if(s){for(var d=0;d<l.length;d++)if(l.options[d].getAttribute(s)==h){l.value=l.options[d].value;break}}else l.value=h;break;default:s?l.setAttribute(s,h):l.value=h}t.removeBinding(o)}this.doodleArray.splice(a,1)}else r="Attempt to delete a doodle that is not deletable, className: "+t.className}else r="Doodle refused permission to be deleted, className: "+t.className;if(i){for(a=0;a<this.doodleArray.length;a++)this.doodleArray[a].order=a;this.repaint(),this.notify("doodleDeleted",i)}else ED.errorHandler("ED.Drawing","deleteDoodle",r)},ED.Drawing.prototype.deleteSelectedDoodle=function(){null!=this.selectedDoodle?this.deleteDoodle(this.selectedDoodle,!1):ED.errorHandler("ED.Drawing","deleteSelectedDoodle","Attempt to delete selected doodle, when none selected")},ED.Drawing.prototype.resetEyedraw=function(){if(this.notify("beforeReset"),this.deleteAllDoodles(!0),!1!==this.resetDoodleSet?this.notify("resetEdit"):this.notify("reset"),!1!==this.resetDoodleSet)this.load(this.resetDoodleSet),this.isNew=!1,this.notify("doodlesLoaded");else for(var t=0;t<this.onReadyCommands.length;t++)for(var e=0;e<this.onReadyCommands[t].length;e++){var i=this.onReadyCommands[t][e][0],r=this.onReadyCommands[t][e][1];this[i].apply(this,r)}this.drawAllDoodles(),this.deselectDoodles(),this.addBindings(this.bindingArray),this.notify("afterReset")},ED.Drawing.prototype.setScaleForDrawingAndDoodles=function(t){this.globalScaleFactor=t,this.doodleArray.forEach(function(e){e.setScaleLevel(t)}),this.repaint()},ED.Drawing.prototype.setScaleLevel=function(t){this.setScaleForDrawingAndDoodles(t),this.notifyZoomLevel()},ED.Drawing.prototype.toggleZoom=function(){if(this.toggleScaleFactor){var t=this.globalScaleFactor===this.toggleScaleFactor?this.origScaleLevel:this.toggleScaleFactor;this.setScaleLevel(t)}},ED.Drawing.prototype.notifyZoomLevel=function(){var t;t=this.origScaleLevel<this.toggleScaleFactor?this.globalScaleFactor<this.toggleScaleFactor?"drawingZoomOut":"drawingZoomIn":this.globalScaleFactor<=this.toggleScaleFactor?"drawingZoomOut":"drawingZoomIn",this.notify("drawingZoom"),this.notify(t)},ED.Drawing.prototype.setSelectedDoodle=function(t,e){var i=t.checked?"true":"false";null!=this.selectedDoodle?this.selectedDoodle.setParameterFromString(e,i):ED.errorHandler("ED.Drawing","setSelectedDoodle","Attempt to set a property on the selected doodle, when none selected")},ED.Drawing.prototype.deleteDoodleOfId=function(t){var e=this.doodleOfId(t);e?this.deleteDoodle(e,!1):ED.errorHandler("ED.Drawing","deleteDoodleOfId","Attempt to delete doodle with invalid id")},ED.Drawing.prototype.lock=function(){null!==this.selectedDoodle&&(this.selectedDoodle.isLocked=!0,this.notify("doodleLocked"),this.repaint())},ED.Drawing.prototype.unlock=function(){for(var t=0;t<this.doodleArray.length;t++)this.doodleArray[t].isLocked=!1;this.notify("doodleUnlocked"),this.repaint()},ED.Drawing.prototype.toggleHelp=function(){this.notify("toggleDoodleHelp")},ED.Drawing.prototype.deselectDoodles=function(){for(var t=0;t<this.doodleArray.length;t++)this.doodleArray[t].isSelected=!1;this.selectedDoodle&&(this.selectedDoodle.onDeselection(),this.selectedDoodle=null),this.notify("doodleDeselected"),this.repaint()},ED.Drawing.prototype.selectNextDoodle=function(t){this.scrollValue+=t;var e=t>0;if(this.scrollValue>96||this.scrollValue<-96){this.scrollValue=0;for(var i=-1,r=0;r<this.doodleArray.length;r++)this.doodleArray[r].isSelected&&(i=r,this.doodleArray[r].isSelected=!1);i>=0&&(e?++i==this.doodleArray.length&&(i=0):--i<0&&(i=this.doodleArray.length-1),this.doodleArray.length,this.doodleArray[i].isSelected=!0,this.selectedDoodle=this.doodleArray[i]),this.repaint()}},ED.Drawing.prototype.setDoodleAsSelected=function(t){for(var e=-1,i=0;i<this.doodleArray.length;i++)this.doodleArray[i].id==t&&(e=i);if(e>=0){var r=this.doodleArray[e];this.selectDoodle(r)}},ED.Drawing.prototype.selectDoodle=function(t){this.deselectDoodles(),t.isSelected=!0,this.selectedDoodle=t,this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.notify("doodleSelected"),this.selectedDoodle.onSelection(),this.repaint()},ED.Drawing.prototype.isReady=function(){this.modified=!1,this.convertToImage&&this.replaceWithImage()},ED.Drawing.prototype.addDoodle=function(t,e,i){var r=this.hasDoodleOfClass(t);if(!ED.hasOwnProperty(t))return ED.errorHandler("ED.Drawing","addDoodle","Unable to find definition for subclass "+t),null;var a=new ED[t](this);if(a.isUnique&&this.hasDoodleOfClass(t))return ED.errorHandler("ED.Drawing","addDoodle","Attempt to add a second unique doodle of class "+t),null;for(var o=0;o<this.doodleArray.length;o++)this.doodleArray[o].isSelected&&this.doodleArray[o].onDeselection(),this.doodleArray[o].isSelected=!1;if(void 0!==e)for(var n in e){var s=a.validateParameter(n,e[n]);s.valid?a.setParameterFromString(n,s.value):ED.errorHandler("ED.Drawing","addDoodle","ParameterDefaults array contains an invalid value for parameter "+n)}if(this.selectedDoodle=a,a.isDrawable&&(a.isForDrawing=!0),this.doodleArray[this.doodleArray.length]=a,!r)for(var l in this.bindingArray[t]){var h,d=this.bindingArray[t][l].id,c=this.bindingArray[t][l].attribute,p=document.getElementById(d);switch(p.type){case"checkbox":c?ED.errorHandler("ED.Drawing","addDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):h=p.checked.toString();break;case"select-one":c?p.selectedIndex>-1&&(h=p.options[p.selectedIndex].getAttribute(c)):h=p.value;break;default:h=c?p.getAttribute(c):p.value}h==this.boundElementDeleteValueArray[d]&&(h=a[l]);var y=a.validateParameter(l,h);y.valid?(a.setParameterFromString(l,y.value),a.updateDependentParameters(l)):(h=a[l],ED.errorHandler("ED.Drawing","addDoodle","Invalid value for parameter: "+l)),a.addBinding(l,this.bindingArray[t][l]),a.setParameterFromString(l,y.value),a.updateDependentParameters(l),this.updateBindings(a)}if(void 0!==i)for(var n in i)a.addBinding(n,i[n]);return a.addAtBack?this.moveToBack():this.repaint(),this.notify("doodleAdded",a),this.selectedDoodle&&this.selectedDoodle.onSelection(),a},ED.Drawing.prototype.addBindings=function(t){this.bindingArray=t;var e=this;for(var i in t){var r=this.firstDoodleOfClass(i);for(var a in t[i]){var o=t[i][a].id,n=document.getElementById(o);n?(n.addEventListener("change",function(t){return function(i){e.hasDoodleOfClass(t)||(e.addDoodle(t),e.deselectDoodles())}}(i),!1),r&&r.addBinding(a,t[i][a])):ED.errorHandler("ED.Drawing","addBindings","Attempt to add binding for an element that does not exist for parameter: "+a+" with id "+o)}}},ED.Drawing.prototype.addDeleteValues=function(t){for(elementId in t)this.boundElementDeleteValueArray[elementId]=t[elementId]},ED.Drawing.prototype.eventHandler=function(t,e,i,r,a){switch(t){case"oninput":case"onchange":var o=this.doodleOfId(e);if(o)if(this.boundElementDeleteValueArray[r]==a)this.deleteDoodleOfId(e);else{var n;for(var s in o.drawing.isActive=!0,o.bindingArray)o.bindingArray[s].id==r&&(n=s);var l=o.validateParameter(n,a,"onchange"===t);if(l.valid){o.setParameterWithAnimation(n,l.value,!1)}else ED.errorHandler("ED.Drawing","eventHandler","Attempt to change HTML element value to an invalid value for parameter "+n);if(a!=l.value){var h=document.getElementById(r),d=o.bindingArray[n].attribute;switch(h.type){case"checkbox":d?ED.errorHandler("ED.Drawing","eventHandler","Binding to a checkbox with a non-standard attribute not yet supported"):(console.log("setting checkbox - needs testing with a suitable doodle"),"true"==value?h.setAttribute("checked","checked"):h.removeAttribute("checked"));break;case"select-one":if(d){for(var c=0;c<h.length;c++)if(h.options[c].getAttribute(d)==l.value){h.value=h.options[c].value;break}}else h.value=l.value;break;case"text":d?ED.errorHandler("ED.Drawing","eventHandler","Binding to a textfield with a non-standard attribute not yet supported"):h.value=l.value;break;default:d?h.setAttribute(d,l.value):h.value=l.value}}}else ED.errorHandler("ED.Drawing","eventHandler","Doodle of id: "+e+" no longer exists")}},ED.Drawing.prototype.updateBindings=function(t){var e=t;if(void 0===e&&(e=this.selectedDoodle),null!=e)for(var i in e.bindingArray){var r=document.getElementById(e.bindingArray[i].id);if(r){var a=e.bindingArray[i].attribute,o=e.getParameter(i);switch(r.type){case"checkbox":a?ED.errorHandler("ED.Drawing","updateBindings","Binding to a checkbox with a non-standard attribute not yet supported"):r.checked="true"==o;break;case"select-one":var n=r.value;if(a){for(var s=0;s<r.length;s++)if(r.options[s].getAttribute(a)==o){r.value=r.options[s].value;break}}else r.value=o;n!==r.value&&window.setTimeout(function(t){t.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))}.bind(null,r),100);break;case"text":a?ED.errorHandler("ED.Drawing","updateBindings","Binding to a textfield with a non-standard attribute not yet supported"):r.value=o;break;default:a?r.setAttribute(a,o):r.value=o}}}},ED.Drawing.prototype.hasDoodleOfClass=function(t){for(var e=!1,i=0;i<this.doodleArray.length;i++)this.doodleArray[i].className==t&&(e=!0);return e},ED.Drawing.prototype.numberOfDoodlesOfClass=function(t){for(var e=0,i=0;i<this.doodleArray.length;i++)this.doodleArray[i].className==t&&e++;return e},ED.Drawing.prototype.firstDoodleOfClass=function(t){for(var e=!1,i=0;i<this.doodleArray.length;i++)if(this.doodleArray[i].className==t){e=this.doodleArray[i];break}return e},ED.Drawing.prototype.lastDoodleOfClass=function(t){for(var e=!1,i=this.doodleArray.length-1;i>=0;i--)if(this.doodleArray[i].className==t){e=this.doodleArray[i];break}return e},ED.Drawing.prototype.allDoodlesOfClass=function(t){for(var e=[],i=this.doodleArray.length-1;i>=0;i--)this.doodleArray[i].className==t&&e.push(this.doodleArray[i]);return e},ED.Drawing.prototype.setParameterValueForClass=function(t,e,i){for(var r=this.doodleArray.length-1;r>=0;r--){if(this.doodleArray[r].className==i)this.doodleArray[r].setParameterWithAnimation(t,e)}this.repaint()},ED.Drawing.prototype.doodleOfId=function(t){for(var e=!1,i=0;i<this.doodleArray.length;i++)if(this.doodleArray[i].id==t){e=this.doodleArray[i];break}return e},ED.Drawing.prototype.deleteAllDoodles=function(t){for(var e=this.doodleArray.length-1;e>=0;e--)(t||this.doodleArray[e].isDeletable)&&this.deleteDoodle(this.doodleArray[e],t)},ED.Drawing.prototype.deleteDoodlesOfClass=function(t){for(var e=this.doodleArray.length-1;e>=0;e--)this.doodleArray[e].className==t&&this.deleteDoodle(this.doodleArray[e],!1)},ED.Drawing.prototype.setParameterForDoodle=function(t,e,i){void 0!==t[e]?t[e]=+i:t.setParameterFromString(e,i),void 0!==this.saveToInputElement&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.setParameterForDoodleOfClass=function(t,e,i){this.firstDoodleOfClass(t).setParameterWithAnimation(e,i),void 0!==this.saveToInputElement&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.totalDegreesExtent=function(t){for(var e=0,i=0;i<this.doodleArray.length;i++)this.doodleArray[i].className==t&&(e+=this.doodleArray[i].degreesExtent());return e>360&&(e=360),e},ED.Drawing.prototype.suppressReports=function(){for(var t=0;t<this.doodleArray.length;t++)this.doodleArray[t].willReport=!1},ED.Drawing.prototype.reportData=function(){for(var t=[],e={},i=0;i<this.doodleArray.length;i++){var r=this.doodleArray[i],a=r.description();if(r.willReport){var o=r.groupDescription();o.length>0?(void 0===e[r.className]&&(e[r.className]={start:o,descriptions:[],end:r.groupDescriptionEnd()}),a.length&&e[r.className].descriptions.push(a)):a.length&&t.push(a)}}for(var n in e){var s="";e.hasOwnProperty(n)&&(s=e[n].start,s+=ED.addAndAfterLastComma(e[n].descriptions.join(", ")),s+=e[n].end,t.push(s))}return t},ED.Drawing.prototype.report=function(){for(var t="",e=this.doodleArray,i=this.reportData(),r=0;r<i.length;r++){var a=i[r],o=function(t){return e.find(function(e){return e.description()===t&&"function"==typeof e.formatReport})}(a);a=o?o.formatReport():ED.firstLetterToLowerCase(i[r]),t+=0===r?ED.firstLetterToUpperCase(a):", "+a}return t},ED.Drawing.prototype.diagnosis=function(){for(var t=0,e=new Array,i=0;i<this.doodleArray.length;i++)for(var r=this.doodleArray[i].snomedCodes(),a=0;a<r.length;a++){var o=r[a][0];if(o>0){var n=r[a][1];n>t?(t=n,e.push(o)):n==t&&e.indexOf(o)<0&&e.push(o)}}return e},ED.Drawing.prototype.setEye=function(t){"Right"==t&&(this.eye=ED.eye.Right),"Left"==t&&(this.eye=ED.eye.Left),this.repaint()},ED.Drawing.prototype.clear=function(){this.canvas.width=this.canvas.width,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.canvas.width/2,this.canvas.height/2),this.context.scale(this.scale,this.scale)},ED.Drawing.prototype.repaint=function(){if(this.clear(),void 0!==this.image)if(this.image.width>=this.image.height){var t=1e3*this.image.height/this.image.width;this.context.drawImage(this.image,-500,-t/2,1e3,t)}else{var e=1e3*this.image.width/this.image.height;this.context.drawImage(this.image,-e/2,-500,e,1e3)}this.drawAllDoodles();for(var i=0;i<this.doodleArray.length;i++)this.doodleArray[i].setDisplayOfParameterControls(!1);if(null!=this.selectedDoodle&&this.selectedDoodle.setDisplayOfParameterControls(!0),this.modified||(this.modified=!0),this.selectionRectangleIsBeingDragged){var r=this.context;r.beginPath(),r.moveTo(this.selectionRectangleStart.x,this.selectionRectangleStart.y),r.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleStart.y),r.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleEnd.y),r.lineTo(this.selectionRectangleStart.x,this.selectionRectangleEnd.y),r.closePath(),r.lineWidth=1,r.strokeStyle="gray",r.stroke()}this.notify("drawingRepainted")},ED.Drawing.prototype.innerAngle=function(t,e,i){var r=new ED.Point(t.x-e.x,t.y-e.y),a=new ED.Point(i.x-e.x,i.y-e.y);return r.clockwiseAngleTo(a)},ED.Drawing.prototype.togglePointInLine=function(){this.newPointOnClick?(this.newPointOnClick=!1,this.completeLine=!0,this.deselectDoodles(),this.repaint()):(this.newPointOnClick=!0,this.completeLine=!1)},ED.Drawing.prototype.nextDoodleId=function(){return this.lastDoodleId++},ED.Drawing.prototype.getScaleLevel=function(){return this.globalScaleFactor},ED.Doodle=function(t,e){if(void 0!==t){this.drawing=t,this.id=this.drawing.nextDoodleId(),this.hitTestMethod="path",this.squiggleArray=new Array,this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.createdTime=(new Date).getTime(),this.scaleLevel=1,this.linkedDoodleParameters={},this.isLocked=!1,this.isSelectable=!0,this.isShowHighlight=!0,this.willStaySelected=!0,this.isDeletable=!0,this.isSaveable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!0,this.isDrawable=!1,this.isUnique=!1,this.isArcSymmetrical=!1,this.addAtBack=!1,this.isPointInLine=!1,this.snapToGrid=!1,this.snapToQuadrant=!1,this.snapToPoints=!1,this.snapToAngles=!1,this.snapToArc=!1,this.willReport=!0,this.willSync=!0;var i=Math.round(this.drawing.doodlePlaneWidth/2),r=Math.round(this.drawing.doodlePlaneHeight/2);for(var a in this.parameterValidationArray={originX:{kind:"simple",type:"int",range:new ED.Range(-i,+i),defaultValue:0,delta:15},originY:{kind:"simple",type:"int",range:new ED.Range(-r,+r),defaultValue:0,delta:15},width:{kind:"simple",type:"int",range:new ED.Range(100,+r),defaultValue:50,delta:15},height:{kind:"simple",type:"int",range:new ED.Range(100,+i),defaultValue:50,delta:15},radius:{kind:"simple",type:"float",range:new ED.Range(100,450),precision:6,defaultValue:100,delta:15},apexX:{kind:"simple",type:"int",defaultValue:0,range:new ED.Range(-500,500),delta:15},apexY:{kind:"simple",type:"int",range:new ED.Range(-500,500),defaultValue:0,delta:15},scaleX:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},scaleY:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},arc:{kind:"simple",type:"float",range:new ED.Range(Math.PI/12,2*Math.PI),precision:6,defaultValue:Math.PI,delta:.1},rotation:{kind:"simple",type:"float",range:new ED.Range(0,2*Math.PI),precision:6,defaultValue:0,delta:.2}},this.savedParameterArray||(this.savedParameterArray=[]),this.controlParameterArray||(this.controlParameterArray=[]),this.parameterObjectTypeArray||(this.parameterObjectTypeArray=[]),this.gridSpacing=200,this.gridDisplacementX=0,this.gridDisplacementY=0,this.isBeingDragged=!1,this.draggingHandleIndex=null,this.draggingHandleRing=null,this.isClicked=!1,this.drawFunctionMode=ED.drawFunctionMode.Draw,this.isFilled=!0,this.showsToolTip=!0,this.derivedParametersArray=new Array,this.animationFrameRate=30,this.animationDataArray=new Array,this.parentClass="",this.inFrontOfClassArray=new Array,this.pointsArray=new Array,this.anglesArray=new Array,this.arcArray=new Array,this.quadrantPoint=new ED.Point(200,200),this.bindingArray=new Array,this.drawing.listenerArray[this.id]=new Array,this.handleArray=new Array,this.handleArray[0]=new ED.Doodle.Handle(new ED.Point(-50,50),!1,ED.Mode.Scale,!1),this.handleArray[1]=new ED.Doodle.Handle(new ED.Point(-50,-50),!1,ED.Mode.Scale,!1),this.handleArray[2]=new ED.Doodle.Handle(new ED.Point(50,-50),!1,ED.Mode.Scale,!1),this.handleArray[3]=new ED.Doodle.Handle(new ED.Point(50,50),!1,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(new ED.Point(this.apexX,this.apexY),!1,ED.Mode.Apex,!1),this.setHandles(),this.leftExtremity=new ED.Point(-100,-100),this.rightExtremity=new ED.Point(0,-100),this.version=1.1,this.setPropertyDefaults(),this.parameterValidationArray){var o=this.parameterValidationArray[a];"simple"==o.kind&&(this[a]=o.defaultValue)}if(void 0===e)this.order=this.drawing.doodleArray.length,this.setParameterDefaults(),this.setScaleLevel(this.drawing.globalScaleFactor),this.isSelected=!0;else{for(var n in e)if("scaleLevel"!==n)if("arc"==n||"rotation"==n)this[n]=e[n]*Math.PI/180;else if("squiggleArray"==n)for(var s=e[n],l=0;l<s.length;l++){for(var h=s[l].colour,d=new ED.Colour(h.red,h.green,h.blue,h.alpha),c=s[l].thickness,p=s[l].filled,y=new ED.Squiggle(this,d,c,p),D=s[l].pointsArray,u=0;u<D.length;u++){var g=void 0;isNaN(parseFloat(D[u].x))||isNaN(parseFloat(D[u].y))||(g=new ED.Point(D[u].x,D[u].y)),y.addPoint(g)}y.complete=!0,this.squiggleArray.push(y)}else if("params"==n)for(l=0;l<e[n].length;l++){var P=e[n][l].name,E=e[n][l].value;this.setParameterFromString(P,E)}else n in this.parameterObjectTypeArray?this[n]=this.parseObjectString(e[n],this.parameterObjectTypeArray[n]):this[n]=e[n];for(var n in this.isOrientated&&(this.rotation=this.orientation()),this.order=+e.order,this.setScaleLevel(this.drawing.globalScaleFactor),this.savedParameterArray)this.updateDependentParameters(this.savedParameterArray[n]);this.isSelected=!1,this.isForDrawing=!1}}},ED.Doodle.prototype.parseObjectString=function(t,e){var i=!1;switch(e){case"date":var r=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(t);i=new Date(Date.UTC(+r[1],+r[2]-1,+r[3],+r[4],+r[5],+r[6]));break;default:ED.errorHandler("ED.Doodle","parseObjectString","Object type: "+e+" currently not supported")}return i},ED.Doodle.prototype.setHandles=function(){},ED.Doodle.prototype.setPropertyDefaults=function(){},ED.Doodle.prototype.setParameterDefaults=function(){},ED.Doodle.prototype.position=function(){},ED.Doodle.prototype.willDelete=function(){return!0},ED.Doodle.prototype.move=function(t,e){var i=Math.round(+t),r=Math.round(+e);if(this.isMoveable){var a=this.parameterValidationArray.originX.range.constrain(this.originX+i,this.scaleLevel),o=this.parameterValidationArray.originY.range.constrain(this.originY+r,this.scaleLevel);0!=i&&this.setSimpleParameter("originX",a),0!=r&&this.setSimpleParameter("originY",o),this.updateDependentParameters("originX"),this.updateDependentParameters("originY"),0==i&&0==r||this.isOrientated&&(this.setSimpleParameter("rotation",this.orientation()),this.updateDependentParameters("rotation")),this.drawing.notify("doodleMoved",{doodle:this})}},ED.Doodle.prototype.orientation=function(){var t=new ED.Point(0,0),e=new ED.Point(0,-100),i=new ED.Point(this.originX,this.originY);return this.drawing.innerAngle(e,t,i)},ED.Doodle.prototype.draw=function(t){this.drawFunctionMode=void 0!==t?ED.drawFunctionMode.HitTest:ED.drawFunctionMode.Draw;var e=this.drawing.context;e.translate(this.originX,this.originY),e.rotate(this.rotation),e.scale(this.scaleX,this.scaleY),this.transform.setToTransform(this.drawing.transform),this.transform.translate(this.originX,this.originY),this.transform.rotate(this.rotation),this.transform.scale(this.scaleX,this.scaleY),this.inverseTransform=this.transform.createInverse(),this.isClicked=!1},ED.Doodle.prototype.drawHandles=function(t){this.drawFunctionMode==ED.drawFunctionMode.HitTest&&(this.draggingHandleIndex=null,this.draggingHandleRing=null);var e=this.drawing.context;e.save(),e.setTransform(1,0,0,1,0,0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="yellow";for(var i=2*Math.PI,r=0;r<this.handleArray.length;r++){var a=this.handleArray[r];a.isVisible&&(e.beginPath(),e.arc(a.location.x,a.location.y,ED.handleRadius/2,0,i,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=r,this.draggingHandleRing=ED.handleRing.Inner,this.drawing.mode=a.mode,this.isClicked=!0),this.isRotatable&&a.isRotatable&&(e.moveTo(a.location.x+ED.handleRadius,a.location.y),e.arc(a.location.x,a.location.y,ED.handleRadius,0,i,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&e.isPointInPath(t.x,t.y)&&(this.draggingHandleIndex=r,null==this.draggingHandleRing&&(this.draggingHandleRing=ED.handleRing.Outer,this.drawing.mode=ED.Mode.Rotate),this.isClicked=!0)),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fill(),e.stroke()))}e.restore()},ED.Doodle.prototype.hitTest=function(t,e){var i;return ED.isFirefox()?(t.save(),t.setTransform(1,0,0,1,0,0),i="stroke"===this.hitTestMethod?t.isPointInStroke(e.x,e.y):t.isPointInPath(e.x,e.y),t.restore()):i="stroke"===this.hitTestMethod?t.isPointInStroke(e.x,e.y):t.isPointInPath(e.x,e.y),i},ED.Doodle.prototype.drawBoundary=function(t,e){void 0===e&&(e=this.drawFunctionMode);var i=this.drawing.context;e==ED.drawFunctionMode.HitTest?this.hitTest(i,t)&&(this.isDrawable&&this.isForDrawing?this.drawing.mode=ED.Mode.Draw:this.drawing.mode=ED.Mode.Move,this.isClicked=!0):(this.isSelected&&this.isShowHighlight&&(i.shadowColor="gray",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=20),this.isForDrawing&&(i.shadowColor="blue",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=20),this.isFilled&&i.fill(),i.stroke(),i.shadowBlur=0,this.isSelected&&this.isShowHighlight&&this.drawHighlightExtras())},ED.Doodle.prototype.drawHighlightExtras=function(){},ED.Doodle.prototype.setDisplayOfParameterControls=function(t){for(var e in this.parameterValidationArray){if(this.parameterValidationArray[e].display){var i=e+this.className+this.drawing.idSuffix,r=document.getElementById(i);if(r){var a=r.parentNode;a.style.display=t?"inline":"none",r.checked=this[e]}}}},ED.Doodle.prototype.groupDescription=function(){return""},ED.Doodle.prototype.description=function(){return""},ED.Doodle.prototype.groupDescriptionEnd=function(){return""},ED.Doodle.prototype.snomedCode=function(){return 0},ED.Doodle.prototype.diagnosticHierarchy=function(){return 0},ED.Doodle.prototype.snomedCodes=function(){return new Array([this.snomedCode(),this.diagnosticHierarchy()])},ED.Doodle.prototype.dependentParameterValues=function(t,e){return new Array},ED.Doodle.prototype.updateDependentParameters=function(t,e){var i=this.dependentParameterValues(t,this[t]);for(var r in i)this.setSimpleParameter(r,i[r]);(e||void 0===e)&&this.drawing.updateBindings(this)},ED.Doodle.prototype.validateParameter=function(t,e,i){i=void 0===i||i;var r=this.parameterValidationArray[t],a="";if(r){var o=!1;switch(a=e.toString(),i&&(a=a.trim()),r.type){case"string":r.list.indexOf(a)>=0&&(o=!0);break;case"float":ED.isNumeric(a)&&(a=parseFloat(a),a=(a=r.range.constrain(a)).toFixed(r.precision),o=!0);break;case"int":ED.isNumeric(a)&&(a=parseInt(a),a=(a=r.range.constrain(a)).toFixed(0),o=!0);break;case"mod":ED.isNumeric(a)&&(a=parseInt(a),a=r.range.constrain(a),"top"==r.clock?a==r.range.min&&(a=r.range.max):"bottom"==r.clock&&a==r.range.max&&(a=r.range.min),a=a.toFixed(0),o=!0);break;case"bool":"true"!=e&&"false"!=e||(a=e,o=!0);break;case"colourString":o=!0;break;case"freeText":o=!0,r.validate&&"function"==typeof r.validate?o=r.validate(e):void 0!==r.maxLength&&(o=e.length<=r.maxLength);break;default:ED.errorHandler("ED.Drawing","eventHandler","Illegal validation type")}}else ED.errorHandler("ED.Doodle","validateParameter","Unknown parameter name: "+t+" with value: "+e);o||(a=this.getParameter(t),ED.errorHandler("ED.Doodle","validateParameter","Validation failure for parameter: "+t+" with value: "+e)),this.showControlValidationMsg(t,o);var n=new Array;return n.valid=o,n.value=a,n},ED.Doodle.prototype.parameterControlElementId=function(t){return this.drawing.canvas.id+"_"+t+"_control"},ED.Doodle.prototype.onSelection=function(){this.drawing.showDoodleControls&&this.showDoodleControls()},ED.Doodle.prototype.onDeselection=function(){this.drawing.showDoodleControls&&this.removeDoodleControls()},ED.Doodle.prototype.getControlElements=function(){var t=[];for(var e in this.controlParameterArray)t.push(this.parameterElement(e));return t},ED.Doodle.prototype.addControlBindings=function(){for(var t in this.controlParameterArray)if(!(!t in this.parameterValidationArray))if("combo"==this.parameterValidationArray[t].type)for(var e in this.parameterValidationArray[t].list){var i=this.parameterValidationArray[t].list[e];this.addBinding(i,{id:this.parameterControlElementId(i)})}else this.addBinding(t,{id:this.parameterControlElementId(t)})},ED.Doodle.prototype.showControlValidationMsg=function(t,e){if(t in this.controlParameterArray){var i=this.parameterControlElementId(t),r=document.querySelector("[for="+i+"]");if(r){var a=r.querySelector(".validation-msg");a&&(e?a&&a.parentNode.removeChild(a):(a||(a=document.createElement("span"),r.appendChild(a),a.classList.add("validation-msg")),a.textContent="*"))}}},ED.Doodle.prototype.showDoodleControls=function(t){if(!t){var e=this.drawing.canvas.id+"_controls";if(!(t=document.getElementById(e)))return ED.errorHandler("ED.Doodle","showDoodleControls","Unable to create doodle controls: element with id "+e+" does not exist")}this.getControlElements().forEach(function(e){t.appendChild(e)}),this.addControlBindings()},ED.Doodle.prototype.removeDoodleControls=function(t){if(!t){var e=this.drawing.canvas.id+"_controls";if(!(t=document.getElementById(e)))return ED.errorHandler("ED.Doodle","removeDoodleControls","Unable to remove doodle controls: element with id "+e+" does not exist")}for(var i in this.controlParameterArray)this.removeBinding(i);for(;t.hasChildNodes();)t.removeChild(t.lastChild)},ED.Doodle.prototype.parameterElement=function(t,e){var i;switch(void 0===e&&(e=!0),this.parameterValidationArray[t].type){case"combo":for(var r in(i=document.createElement("span")).setAttribute("class","combo"),this.parameterValidationArray[t].list)i.appendChild(this.parameterElement(this.parameterValidationArray[t].list[r],!1));break;case"string":for(var r in(i=document.createElement("select")).setAttribute("id",this.parameterControlElementId(t)),this.parameterValidationArray[t].list){(a=document.createElement("option")).innerText=this.parameterValidationArray[t].list[r],a.innerText==this[t]&&(a.selected=!0),i.appendChild(a)}break;case"bool":(i=document.createElement("input")).type="checkbox",i.setAttribute("id",this.parameterControlElementId(t));break;case"colourString":for(var r in(i=document.createElement("select")).setAttribute("id",this.parameterControlElementId(t)),this.parameterValidationArray[t].list){var a=document.createElement("option");"FF0000FF"==this.parameterValidationArray[t].list[r]?a.innerText="Red":"00FF00FF"==this.parameterValidationArray[t].list[r]?a.innerText="Green":"0000FFFF"==this.parameterValidationArray[t].list[r]?a.innerText="Blue":"FFB8ED"==this.parameterValidationArray[t].list[r]?a.innerText="Pink":"FF9806"==this.parameterValidationArray[t].list[r]?a.innerText="Orange":"FFED3D"==this.parameterValidationArray[t].list[r]?a.innerText="Yellow":"E5A222"==this.parameterValidationArray[t].list[r]?a.innerText="Light brown":"A35100"==this.parameterValidationArray[t].list[r]?a.innerText="Dark brown":"252525"==this.parameterValidationArray[t].list[r]?a.innerText="Black":"979797"==this.parameterValidationArray[t].list[r]?a.innerText="Grey":"FFFFFF"==this.parameterValidationArray[t].list[r]?a.innerText="White":a.innerText="Brown",a.value=this.parameterValidationArray[t].list[r],i.appendChild(a)}break;case"float":case"int":case"mod":case"freeText":(i=document.createElement("input")).type="text",i.setAttribute("id",this.parameterControlElementId(t));break;default:ED.errorHandler("ED.Doodle","parameterElement","Unexpected type: "+this.parameterValidationArray[t].type+" for parameter: "+t)}var o=document.createElement("div");if(e){var n=document.createElement("label");n.innerText=this.controlParameterArray[t],n.setAttribute("for",this.parameterControlElementId(t)),o.appendChild(n)}return o.appendChild(i),o},ED.Doodle.prototype.setParameterWithAnimation=function(t,e,i){var r=this.dependentParameterValues(t,e);if(this.parameterValidationArray[t].animate&&!ED.objectIsEmpty(r))for(var a in r){var o=this.parameterValidationArray[a].delta,n=r[a]-this[a];if("rotation"==a)(n*=s=(Math.PI-Math.abs(n))*n<0?-1:1)<0&&(n+=2*Math.PI),n>3.141&&this.rotation<Math.PI&&(s=-s);else var s=n<0?-1:1;o*=s;var l=Math.abs(Math.floor(n/o)),h={timer:null,delta:o,frames:l,frameCounter:0};this.animationDataArray[a]=h,l>0?this.increment(a,r[a],i):(this.setSimpleParameter(a,r[a]),this.updateDependentParameters(a,i),this.drawing.repaint())}else this.setParameterFromString(t,e.toString(),i);this.drawing.notify("setParameterWithAnimationComplete")},ED.Doodle.prototype.setSimpleParameter=function(t,e){var i=new Object;i.doodle=this,i.parameter=t,i.value=e,i.oldValue=this[t],this[t]=e,this.drawing.notify("parameterChanged",i)},ED.Doodle.prototype.setParameterFromString=function(t,e,i){var r=typeof e;"string"!=r&&ED.errorHandler("ED.Doodle","setParameterFromString","_value parameter should be of type string, not "+r);var a=this.parameterValidationArray[t];if(a){switch(a.type){case"string":this[t]=e;break;case"float":this[t]=parseFloat(e);break;case"int":case"mod":this[t]=parseInt(e);break;case"bool":this[t]="true"==e;break;case"colourString":case"freeText":this[t]=e;break;default:ED.errorHandler("ED.Doodle","setParameterFromString","Illegal validation type: "+a.type)}if(this.updateDependentParameters(t,i),"derived"==this.parameterValidationArray[t].kind){var o=this.dependentParameterValues(t,e);for(var n in o)this.updateDependentParameters(n,i)}var s=new Object;s.doodle=this,s.parameter=t,s.value=e,s.oldValue=this[t],this.drawing.notify("parameterChanged",s)}else ED.errorHandler("ED.Doodle","setParameterFromString","No item in parameterValidationArray corresponding to parameter: "+t);this.drawing.repaint()},ED.Doodle.prototype.setOriginWithDisplacements=function(t,e){if(this.originX=this.drawing.eye==ED.eye.Right?-t:t,this.originY=-t,this.addAtBack)var i=this.drawing.firstDoodleOfClass(this.className);else i=this.drawing.lastDoodleOfClass(this.className);if(i){var r=i.originX-e,a=i.originY-e;this.originX=this.parameterValidationArray.originX.range.constrain(r),this.originY=this.parameterValidationArray.originY.range.constrain(a)}},ED.Doodle.prototype.setOriginWithRotations=function(t,e,i){var r=this.drawing.eye==ED.eye.Right?-1:1,a=new ED.Point(0,0);if(a.setWithPolars(t,r*e*Math.PI/180),this.addAtBack)var o=this.drawing.firstDoodleOfClass(this.className);else o=this.drawing.lastDoodleOfClass(this.className);if(o){var n=new ED.Point(o.originX,o.originY);a.setWithPolars(t,n.direction()+r*i*Math.PI/180)}this.originX=a.x,this.originY=a.y},ED.Doodle.prototype.setRotationWithDisplacements=function(t,e){var i,r,a=this.drawing.eye==ED.eye.Right?-1:1;i=(r=this.addAtBack?this.drawing.firstDoodleOfClass(this.className):this.drawing.lastDoodleOfClass(this.className))?(180*r.rotation/Math.PI+a*e+360)%360*Math.PI/180:(a*t+360)%360*Math.PI/180,this.rotation=this.parameterValidationArray.rotation.range.constrain(i)},ED.Doodle.prototype.deselect=function(){this.isSelected=!1,this.drawing.selectedDoodle=null,this.drawing.repaint()},ED.Doodle.prototype.getParameter=function(t){var e=this.parameterValidationArray[t],i="";if(e)switch(e.type){case"string":i=this[t];break;case"float":i=this[t].toFixed(e.precision);break;case"int":i=this[t].toFixed(0);break;case"mod":i=Math.round(this[t]),"top"==e.clock?i==e.range.min&&(i=e.range.max):"bottom"==e.clock&&i==e.range.max&&(i=e.range.min),i=i.toFixed(0);break;case"bool":i=this[t].toString();break;case"colourString":case"freeText":i=this[t];break;default:ED.errorHandler("ED.Doodle","getParameter","Illegal validation type")}else ED.errorHandler("ED.Doodle","getParameter","No entry in parameterValidationArray corresponding to parameter: "+t);return i},ED.Doodle.prototype.increment=function(t,e,i){var r=this[t];this.animationDataArray[t].frameCounter++;var a=1e3/this.animationFrameRate;if(this.animationDataArray[t].frameCounter>=this.animationDataArray[t].frames)this.setSimpleParameter(t,e),this.updateDependentParameters(t,i),clearTimeout(this.animationDataArray[t].timer);else{this.setSimpleParameter(t,r+this.animationDataArray[t].delta),this.updateDependentParameters(t,i);var o=this;this.animationDataArray[t].timer=setTimeout(function(){o.increment(t,e,i)},a)}this.drawing.repaint()},ED.Doodle.prototype.addBinding=function(t,e){var i=e.id,r=e.attribute;if(void 0!==this[t]){var a=document.getElementById(i);if(null!=a){this.bindingArray[t]={id:i,attribute:r};var o,n=this.drawing,s=this.id,l=this.className;switch(a.type){case"checkbox":r?ED.errorHandler("ED.Doodle","addBinding","Binding to a checkbox with a non-standard attribute not yet supported"):(this.savedParameterArray.indexOf(t)<0?this.setParameterFromString(t,a.checked.toString()):this.drawing.updateBindings(this),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.checked.toString())},!1));break;case"select-one":r?(a.selectedIndex>-1&&this.savedParameterArray.indexOf(t)<0&&this.setParameterFromString(t,a.options[a.selectedIndex].getAttribute(r)),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.options[this.selectedIndex].getAttribute(r))},!1)):(this.savedParameterArray.indexOf(t)<0?this.setParameterFromString(t,a.value):this.drawing.updateBindings(this),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.value)},!1));break;case"text":r?ED.errorHandler("ED.Doodle","addBinding","Binding to a text field with a non-standard attribute not yet supported"):(this.savedParameterArray.indexOf(t)<0?this.setParameterFromString(t,a.value):this.drawing.updateBindings(this),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.value)},!1));break;default:r?(this.setParameterFromString(t,a.getAttribute(r)),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.getAttribute(r))},!1)):(this.setParameterFromString(t,a.value),a.addEventListener("change",o=function(t){n.eventHandler("onchange",s,l,this.id,this.value)},!1))}this.drawing.listenerArray[this.id][t]=o}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. DOM has no element with id: "+i)}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. Doodle of class: "+this.className+" has no parameter of name: "+t)},ED.Doodle.prototype.removeBinding=function(t){var e;for(var i in this.bindingArray)i==t&&(e=this.bindingArray[t].id);delete this.bindingArray[t];var r=document.getElementById(e);r&&r.removeEventListener("change",this.drawing.listenerArray[this.id][t],!1),delete this.drawing.listenerArray[this.id][t]},ED.Doodle.prototype.clockHour=function(t){var e,i;if(i=void 0!==t?t:0,this.isRotatable&&!this.isMoveable)e=(6*this.rotation/Math.PI+12+i)%12;else{var r=new ED.Point(0,-100),a=new ED.Point(this.originX,this.originY);e=(6*r.clockwiseAngleTo(a)/Math.PI+12+i)%12}return 0==(e=e.toFixed(0))&&(e=12),e},ED.Doodle.prototype.quadrant=function(){var t="";return t+=this.originY<0?"supero":"infero",this.drawing.eye==ED.eye.Right?t+=this.originX<0?"temporal":"nasal":t+=this.originX<0?"nasal":"temporal",t+=" quadrant"},ED.Doodle.prototype.degrees=function(){var t;if(this.isRotatable&&!this.isMoveable)t=(180*this.rotation/Math.PI+360)%360;else{var e=new ED.Point(0,-100),i=new ED.Point(this.originX,this.originY);t=(180*e.clockwiseAngleTo(i)/Math.PI+360)%360}return 0==(t=t.toFixed(0))&&(t=0),t},ED.Doodle.prototype.clockHourExtent=function(t){var e,i;if(t=void 0===t?"":" "+t,this.isRotatable&&!this.isMoveable)e=(6*(this.rotation-this.arc/2)/Math.PI+12)%12,i=(6*(this.rotation+this.arc/2)/Math.PI+12)%12;else{var r=new ED.Point(0,-100),a=new ED.Point(this.originX,this.originY);r.clockwiseAngleTo(a),Math.PI}return 0==(e=e.toFixed(0))&&(e=12),0==(i=i.toFixed(0))&&(i=12),"from "+e+t+" to "+i+t},ED.Doodle.prototype.degreesExtent=function(){var t=180*this.arc/Math.PI;return Math.round(t)},ED.Doodle.prototype.locationRelativeToDisc=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>180&&this.originX<420&&this.originY>-120&&this.originY<120?t="at the disc":(t+=this.originY<=0?"supero":"infero",t+=this.originX<=300?"temporally":"nasally"):this.originX<-180&&this.originX>-420&&this.originY>-120&&this.originY<120?t="at the disc":(t+=this.originY<=0?"supero":"infero",t+=this.originX>=-300?"temporally":"nasally"),t},ED.Doodle.prototype.locationRelativeToFovea=function(){var t="";return this.drawing.eye==ED.eye.Right?this.originX>-10&&this.originX<10&&this.originY>-10&&this.originY<10?t="at the fovea":(t+=this.originY<=0?"supero":"infero",t+=this.originX<=0?"temporal":"nasal",t+=" to the fovea"):this.originX>-10&&this.originX<10&&this.originY>-10&&this.originY<10?t="at the fovea":(t+=this.originY<=0?"supero":"infero",t+=this.originX>=0?"temporally":"nasally",t+=" to the fovea"),t},ED.Doodle.prototype.addSquiggle=function(){var t,e=new ED.Colour(0,0,0,1);switch(e.setWithHexString(this.colourString),this.thickness){case"Thin":t=ED.squiggleWidth.Thin;break;case"Medium":t=ED.squiggleWidth.Medium;break;case"Thick":t=ED.squiggleWidth.Thick;break;default:t=ED.squiggleWidth.Thin}var i=new ED.Squiggle(this,e,t,this.filled);this.squiggleArray.push(i)},ED.Doodle.prototype.addPointToSquiggle=function(t){if(this.squiggleArray.length>0){var e=this.squiggleArray.length-1;this.squiggleArray[e].addPoint(t)}},ED.Doodle.prototype.completeSquiggle=function(){if(this.squiggleArray.length>0){var t=this.squiggleArray.length-1;this.squiggleArray[t].complete=!0}},ED.Doodle.prototype.calculateArc=function(){var t=new ED.Point(this.leftExtremity.x-this.drawing.canvas.width/2,this.leftExtremity.y-this.drawing.canvas.height/2),e=new ED.Point(this.rightExtremity.x-this.drawing.canvas.width/2,this.rightExtremity.y-this.drawing.canvas.height/2);return t.clockwiseAngleTo(e)},ED.Doodle.prototype.nearestPointTo=function(t){if(this.pointsArray.length>0){for(var e=1e7,i=0,r=0;r<this.pointsArray.length;r++){var a=this.pointsArray[r],o=(t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y);o<e&&(e=o,i=r)}return this.pointsArray[i]}return ED.errorHandler("ED.Doodle","nearestPointTo","Attempt to calculate nearest points with an empty points array"),t},ED.Doodle.prototype.nearestAngleTo=function(t){if(this.anglesArray.length>0){for(var e=2*Math.PI,i=0,r=0;r<this.anglesArray.length;r++){var a=this.anglesArray[r],o=Math.abs(a-t);o<e&&(e=o,i=r)}return this.anglesArray[i]}return ED.errorHandler("ED.Doodle","nearestAngleTo","Attempt to calculate nearest angle with an empty angles array"),t},ED.Doodle.prototype.nearestArcTo=function(t){if(this.arcArray.length>0){for(var e=2*Math.PI,i=0,r=0;r<this.arcArray.length;r++){var a=this.arcArray[r],o=Math.abs(a-t);o<e&&(e=o,i=r)}return this.arcArray[i]}return ED.errorHandler("ED.Doodle","nearestArcTo","Attempt to calculate nearest arc with an empty arc array"),t},ED.Doodle.prototype.json=function(){var t="{";if(t=(t=(t=t+'"scaleLevel": '+this.scaleLevel+",")+'"version":'+this.version.toFixed(1)+",")+'"subclass":"'+this.className+'",',void 0!==this.savedParameterArray&&this.savedParameterArray.length>0)for(var e=0;e<this.savedParameterArray.length;e++){var i=this.savedParameterArray[e],r=this[i];switch(i){case"scaleX":case"scaleY":case"originX":case"originY":case"lastOriginX":case"lastOriginY":r*=1/this.scaleLevel}"scaleX"==i||"scaleY"==i?r=r.toFixed(2):"arc"==i||"rotation"==i?r=(180*r/Math.PI).toFixed(0):"originX"==i||"originY"==i||"radius"==i||"apexX"==i||"apexY"==i||"width"==i||"height"==i?r=r.toFixed(0):"number"==typeof r?r=r.toFixed(2):"string"==typeof r?r='"'+r+'"':"boolean"==typeof r?r=r:"object"==typeof r?r=JSON.stringify(r):(ED.errorHandler("ED.Doodle","json","Attempt to create json for parameter "+i+" with an unhandled parameter type: "+typeof r),r="ERROR"),t=t+'"'+i+'":'+r+","}if(this.squiggleArray.length>0){t+='"squiggleArray":[';for(var a=0;a<this.squiggleArray.length;a++)t+=this.squiggleArray[a].json(),this.squiggleArray.length-a>1&&(t+=",");t+="],"}return t=t+'"order":'+this.order.toFixed(0),t+="}"},ED.Doodle.prototype.drawSpot=function(t,e,i,r,a){t.save(),t.beginPath(),t.arc(e,i,r,0,2*Math.PI,!0),t.fillStyle=a,t.strokeStyle=a,t.lineWidth=0,t.fill(),t.stroke(),t.restore()},ED.Doodle.prototype.drawCircle=function(t,e,i,r,a,o,n){t.save(),t.beginPath(),t.arc(e,i,r,0,2*Math.PI,!0),t.fillStyle=a,t.fill(),t.lineWidth=o,t.strokeStyle=n,t.stroke(),t.restore()},ED.Doodle.prototype.drawLine=function(t,e,i,r,a,o,n){t.save(),t.beginPath(),t.moveTo(e,i),t.lineTo(r,a),t.lineWidth=o,t.strokeStyle=n,t.stroke(),t.restore()},ED.Doodle.prototype.drawLaserSpot=function(t,e,i){this.drawCircle(t,e,i,15,"Yellow",10,"rgba(255, 128, 0, 1)")},ED.Doodle.prototype.drawNFLHaem=function(t,e,i){var r=new ED.Point(e,i),a=r.direction()+Math.PI/2,o=r.direction()+3*Math.PI/2,n=new ED.Point(0,0);n.setWithPolars(10,a);var s=new ED.Point(0,0);s.setWithPolars(10,o),t.beginPath(),t.moveTo(e+n.x,i+n.y),t.lineTo(e+s.x,i+s.y),t.lineWidth=16,t.lineCap="round",t.strokeStyle="rgba(255,0,0,0.5)",t.stroke()},ED.Doodle.prototype.addEllipseToPath=function(t,e,i,r,a){var o=r/2*.5522848,n=a/2*.5522848;t.moveTo(-r/2,0),t.bezierCurveTo(e-r/2,i-n,e-o,i-a/2,e,i-a/2),t.bezierCurveTo(e+o,i-a/2,e+r/2,i-n,e+r/2,i),t.bezierCurveTo(e+r/2,i+n,e+o,i+a/2,e,i+a/2),t.bezierCurveTo(e-o,i+a/2,e-r/2,i+n,e-r/2,i)},ED.Doodle.prototype.xForY=function(t,e){return Math.sqrt(t*t-e*e)},ED.Doodle.prototype.setScaleLevel=function(t){var e=t/this.scaleLevel;this.adjustScaleAndPosition(e),this.scaleLevel=t},ED.Doodle.prototype.adjustScaleAndPosition=function(t){this.scaleX*=t,this.scaleY*=t,this.originX*=t,this.originY*=t,this.lastOriginX&&(this.lastOriginX*=t),this.lastOriginY&&(this.lastOriginY*=t)},ED.Doodle.prototype.getLinkedParameters=function(t){if(void 0!==this.linkedDoodleParameters[t])return this.linkedDoodleParameters[t]},ED.Doodle.prototype.debug=function(){console.log("org: "+this.originX+" : "+this.originY),console.log("apx: "+this.apexX+" : "+this.apexY),console.log("rot: "+180*this.rotation/Math.PI),console.log("arc: "+180*this.arc/Math.PI)},ED.Doodle.Handle=function(t,e,i,r){this.location=null==t?new ED.Point(0,0):t,this.isVisible=e,this.mode=i,this.isRotatable=r},ED.Report=function(t){this.drawing=t,this.breaksInAttached=0,this.breaksInDetached=0,this.largestBreakType="Not found",this.largestBreakSize=0,this.lowestBreakPosition=12,this.pvrType="None",this.pvrCClockHours=0,this.antPvrClockHours=0;var e,i,r=0,a=0,o=180,n=new Array;for(n.UTear="U tear",n.RoundHole="Round hole",n.Dialysis="Dialysis",n.GRT="GRT",n.MacularHole="Macular hole",n.OuterLeafBreak="Outer Leaf Break",this.rrdArray=new Array,e=0;e<this.drawing.doodleArray.length;e++)"RRD"==(i=this.drawing.doodleArray[e]).className&&this.rrdArray.push(i);for(e=0;e<this.drawing.doodleArray.length;e++)if("StarFold"==(i=this.drawing.doodleArray[e]).className)this.pvrType="C",r+=180*i.arc/Math.PI;else if("AntPVR"==i.className)this.pvrType="C",a+=180*i.arc/Math.PI;else if(i.className in n){var s=0;s="UTear"==i.className||"RoundHole"==i.className||"OuterLeafBreak"==i.className?(Math.round(180*Math.atan2(i.originX,-i.originY)/Math.PI)+360)%360:Math.round(180*i.rotation/Math.PI+360)%360;var l=this.inDetachment(s);l?this.breaksInDetached++:this.breaksInAttached++,l&&i.arc>this.largestBreakSize&&(this.largestBreakSize=i.arc,this.largestBreakType=n[i.className]);var h=Math.abs(s-180);if(l&&h<o){o=h;var d=s+15;c=d%30,this.lowestBreakPosition=Math.floor((d-c)/30),0==this.lowestBreakPosition&&(this.lowestBreakPosition=12)}}var c=(r+=25)%30;this.pvrCClockHours=Math.floor((r-c)/30),c=(a+=25)%30,this.antPvrClockHours=Math.floor((a-c)/30);var p=180*this.largestBreakSize/Math.PI+25;c=p%30;this.largestBreakSize=Math.floor((p-c)/30)},ED.Report.prototype.inDetachment=function(t){var e=!1;for(key in this.rrdArray){var i,r=this.rrdArray[key],a=180*(r.rotation-r.arc/2)/Math.PI;if((i=((i=180*(r.rotation+r.arc/2)/Math.PI)+360)%360)<(a=(a+360)%360))(0<=t&&t<=i||a<=t&&t<=360)&&(e=!0);else{if(i==a)return!0;a<=t&&t<=i&&(e=!0)}}return e},ED.Report.prototype.extent=function(){var t=new Array;this.drawing.eye==ED.eye.Right?(t.SN=0,t.IN=0,t.IT=0,t.ST=0):(t.ST=0,t.IT=0,t.IN=0,t.SN=0);var e=15;for(quadrant in t)for(var i=0;i<3;i++){var r=this.inDetachment(e)?1:0;t[quadrant]=t[quadrant]+r,e+=30}return t},ED.Report.prototype.isMacOff=function(){var t=!1;for(key in this.rrdArray){this.rrdArray[key].isMacOff()&&(t=!0)}return t},ED.AffineTransform=function(){this.components=[[1,0,0],[0,1,0],[0,0,1]]},ED.AffineTransform.prototype.setToIdentity=function(){this.components[0][0]=1,this.components[0][1]=0,this.components[0][2]=0,this.components[1][0]=0,this.components[1][1]=1,this.components[1][2]=0,this.components[2][0]=0,this.components[2][1]=0,this.components[2][2]=1},ED.AffineTransform.prototype.setToTransform=function(t){this.components[0][0]=t.components[0][0],this.components[0][1]=t.components[0][1],this.components[0][2]=t.components[0][2],this.components[1][0]=t.components[1][0],this.components[1][1]=t.components[1][1],this.components[1][2]=t.components[1][2],this.components[2][0]=t.components[2][0],this.components[2][1]=t.components[2][1],this.components[2][2]=t.components[2][2]},ED.AffineTransform.prototype.translate=function(t,e){this.components[0][2]=this.components[0][0]*t+this.components[0][1]*e+this.components[0][2],this.components[1][2]=this.components[1][0]*t+this.components[1][1]*e+this.components[1][2],this.components[2][2]=this.components[2][0]*t+this.components[2][1]*e+this.components[2][2]},ED.AffineTransform.prototype.scale=function(t,e){this.components[0][0]=this.components[0][0]*t,this.components[0][1]=this.components[0][1]*e,this.components[1][0]=this.components[1][0]*t,this.components[1][1]=this.components[1][1]*e,this.components[2][0]=this.components[2][0]*t,this.components[2][1]=this.components[2][1]*e},ED.AffineTransform.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=[[0,0,0],[0,0,0],[0,0,0]];r[0][0]=this.components[0][0]*e+this.components[0][1]*i,r[0][1]=this.components[0][1]*e-this.components[0][0]*i,r[1][0]=this.components[1][0]*e+this.components[1][1]*i,r[1][1]=this.components[1][1]*e-this.components[1][0]*i,r[2][0]=this.components[2][0]*e+this.components[2][1]*i,r[2][1]=this.components[2][1]*e-this.components[2][0]*i,this.components[0][0]=r[0][0],this.components[0][1]=r[0][1],this.components[1][0]=r[1][0],this.components[1][1]=r[1][1],this.components[2][0]=r[2][0],this.components[2][1]=r[2][1]},ED.AffineTransform.prototype.transformPoint=function(t){var e=t.x*this.components[0][0]+t.y*this.components[0][1]+1*this.components[0][2],i=t.x*this.components[1][0]+t.y*this.components[1][1]+1*this.components[1][2];return new ED.Point(e,i)},ED.AffineTransform.prototype.determinant=function(){return this.components[0][0]*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1])-this.components[0][1]*(this.components[1][0]*this.components[2][2]-this.components[1][2]*this.components[2][0])+this.components[0][2]*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0])},ED.AffineTransform.prototype.createInverse=function(){var t=new ED.AffineTransform,e=1/this.determinant();return t.components[0][0]=e*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1]),t.components[0][1]=e*(this.components[0][2]*this.components[2][1]-this.components[0][1]*this.components[2][2]),t.components[0][2]=e*(this.components[0][1]*this.components[1][2]-this.components[0][2]*this.components[1][1]),t.components[1][0]=e*(this.components[1][2]*this.components[2][0]-this.components[1][0]*this.components[2][2]),t.components[1][1]=e*(this.components[0][0]*this.components[2][2]-this.components[0][2]*this.components[2][0]),t.components[1][2]=e*(this.components[0][2]*this.components[1][0]-this.components[0][0]*this.components[1][2]),t.components[2][0]=e*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0]),t.components[2][1]=e*(this.components[0][1]*this.components[2][0]-this.components[0][0]*this.components[2][1]),t.components[2][2]=e*(this.components[0][0]*this.components[1][1]-this.components[0][1]*this.components[1][0]),t},ED.Colour=function(t,e,i,r){this.red=t,this.green=e,this.blue=i,this.alpha=r},ED.Colour.prototype.setWithHexString=function(t){this.red=parseInt(t.charAt(0)+t.charAt(1),16),this.green=parseInt(t.charAt(2)+t.charAt(3),16),this.blue=parseInt(t.charAt(4)+t.charAt(5),16),t.length>6&&(this.alpha=parseInt(t.charAt(6)+t.charAt(7),16))},ED.Colour.prototype.hexString=function(){return this.red>0?"FF0000FF":"00FF00FF"},ED.Colour.prototype.rgba=function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},ED.Colour.prototype.json=function(){return'{"red":'+this.red+',"green":'+this.green+',"blue":'+this.blue+',"alpha":'+this.alpha+"}"},ED.Point=function(t,e){this.x=Math.round(+t),this.y=Math.round(+e),this.components=[this.x,this.y,1]},ED.Point.prototype.setWithPolars=function(t,e){this.x=Math.round(t*Math.sin(e)),this.y=Math.round(-t*Math.cos(e))},ED.Point.prototype.setCoordinates=function(t,e){this.x=t,this.y=e},ED.Point.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},ED.Point.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},ED.Point.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},ED.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},ED.Point.prototype.direction=function(){return new ED.Point(0,-100).clockwiseAngleTo(this)},ED.Point.prototype.clockwiseAngleTo=function(t){var e=this.length()*t.length();if(0==e)return 0;var i=this.dotProduct(t)/e;i>1&&(i=1);var r=Math.acos(i);return this.crossProduct(t)<0?2*Math.PI-r:r},ED.Point.prototype.pointAtRadiusAndClockwiseAngle=function(t,e){var i=this.direction(),r=new ED.Point(0,0);return r.setWithPolars(t,i+e),r},ED.Point.prototype.pointAtAngleToLineToPointAtProportion=function(t,e,i){var a=new ED.Point((e.x-this.x)*i,(e.y-this.y)*i);r=a.length();var o=a.pointAtRadiusAndClockwiseAngle(r,t);return o.x+=this.x,o.y+=this.y,o},ED.Point.prototype.clockHour=function(t){var e=(6*new ED.Point(0,-100).clockwiseAngleTo(this)/Math.PI+12)%12;return 0==(e=e.toFixed(0))&&(e=12),e},ED.Point.prototype.tangentialControlPoint=function(t){var e=this.length(),i=this.direction(),r=e/Math.cos(t),a=new ED.Point(0,0);return a.setWithPolars(r,i+t),a},ED.Point.prototype.pointAtPercentageFromPointToPoint=function(t,e){var i=(e.x-this.x)*t/100,r=(e.y-this.y)*t/100;return new ED.Point(this.x+i,this.y+r)},ED.Point.prototype.bezierPointAtParameter=function(t,e,i,r){var a=t*t,o=a*t,n=1-t,s=n*n,l=s*n,h=this.x*l+3*e.x*s*t+3*i.x*n*a+r.x*o,d=this.y*l+3*e.y*s*t+3*i.y*n*a+r.y*o;return new ED.Point(h,d)},ED.Point.prototype.json=function(){return'{"x":'+this.x.toFixed(2)+',"y":'+this.y.toFixed(2)+"}"},ED.Range=function(t,e){this.min=t,this.max=e},ED.Range.prototype.setMinAndMax=function(t,e){this.min=t,this.max=e},ED.Range.prototype.isBelow=function(t){return t<this.min},ED.Range.prototype.isAbove=function(t){return t>this.max},ED.Range.prototype.includes=function(t){return!(t<this.min||t>this.max)},ED.Range.prototype.constrain=function(t,e){e=void 0===e?1:e;var i=this.min*e,r=this.max*e;return t<i?i:t>r?r:t},ED.Range.prototype.includesInAngularRange=function(t,e){var i=100,r=new ED.Point(0,0),a=new ED.Point(0,0),o=new ED.Point(0,0);return e?(r.setWithPolars(i,this.min*Math.PI/180),a.setWithPolars(i,this.max*Math.PI/180),o.setWithPolars(i,t*Math.PI/180)):(r.setWithPolars(i,this.min),a.setWithPolars(i,this.max),o.setWithPolars(i,t)),r.clockwiseAngleTo(o)<=r.clockwiseAngleTo(a)},ED.Range.prototype.constrainToAngularRange=function(t,e){if(this.max-this.min<(e?360:2*Math.PI)){var i=100,r=new ED.Point(0,0),a=new ED.Point(0,0),o=new ED.Point(0,0);return e?(r.setWithPolars(i,this.min*Math.PI/180),a.setWithPolars(i,this.max*Math.PI/180),o.setWithPolars(i,t*Math.PI/180)):(r.setWithPolars(i,this.min),a.setWithPolars(i,this.max),o.setWithPolars(i,t)),r.clockwiseAngleTo(o)<=r.clockwiseAngleTo(a)?t:o.clockwiseAngleTo(r)<a.clockwiseAngleTo(o)?this.min:this.max}return t},ED.Squiggle=function(t,e,i,r){this.doodle=t,this.colour=e,this.thickness=i,this.filled=r,this.pointsArray=new Array,this.complete=!1},ED.Squiggle.prototype.addPoint=function(t){this.pointsArray.push(t)},ED.Squiggle.prototype.json=function(){var t="{";t=(t=(t=t+'"colour":'+this.colour.json()+",")+'"thickness": '+this.thickness+",")+'"filled": "'+this.filled+'",',t+='"pointsArray":[';for(var e=0;e<this.pointsArray.length;e++)this.pointsArray[e]?t+=this.pointsArray[e].json():t+="{}",this.pointsArray.length-e>1&&(t+=",");return t+="]",t+="}"};var Vector2D=function(t,e){this.x=t,this.y=e};if(Vector2D.prototype.add=function(t){return new Vector2D(this.x+t.x,this.y+t.y)},Vector2D.prototype.sub=function(t){return this.add(t.scale(-1))},Vector2D.prototype.scale=function(t){return new Vector2D(this.x*t,this.y*t)},Vector2D.prototype.log=function(){console.log("Vector2D {x: "+this.x+", y: "+this.y+"}")},null==ED||"object"!=typeof ED)var ED=new Object;ED.Categories=new Object,ED.Categories.EntrySiteBreak={complication:"Entry site break"},ED.Categories.RetinalTouch={complication:"Retinal touch"},ED.Categories.IatrogenicBreak={complication:"Iatrogenic break"},ED.Categories.SubretinalPFCL={complication:"Subretinal PFCL"},ED.FamilyMember=function(t,e){this.className="FamilyMember",this.node=null,this.dimension=32,this.gender="Male",this.drawStub=!1,this.affected=!1,this.deceased=!1,this.isProband=!1,this.condition="",this.savedParameterArray=["gender","affected","deceased","condition"],this.controlParameterArray={gender:"Gender",affected:"Affected",deceased:"Deceased",condition:"Text"},ED.Doodle.call(this,t,e)},ED.FamilyMember.prototype=new ED.Doodle,ED.FamilyMember.prototype.constructor=ED.FamilyMember,ED.FamilyMember.superclass=ED.Doodle.prototype,ED.FamilyMember.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.dimension={kind:"derived",type:"int",range:new ED.Range(0,1e3),animate:!0},this.parameterValidationArray.gender={kind:"derived",type:"string",list:["Male","Female","Unknown"],animate:!0},this.parameterValidationArray.drawStub={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.affected={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.deceased={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.isProband={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.condition={kind:"derived",type:"freeText",animate:!0}},ED.FamilyMember.prototype.setParameterDefaults=function(){},ED.FamilyMember.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"gender":this.node&&(this.node.member.gender=e.charAt(0)),updateMemberSet(this.node.member.name,"gender",this.node.member.gender);break;case"affected":this.node&&(this.node.member.affected="true"==e),updateMemberSet(this.node.member.name,"affected",this.node.member.affected);break;case"deceased":this.node&&(this.node.member.deceased="true"==e),updateMemberSet(this.node.member.name,"deceased",this.node.member.deceased)}return i},ED.FamilyMember.prototype.draw=function(t){var e=this.drawing.context;switch(ED.FamilyMember.superclass.draw.call(this,t),e.beginPath(),this.gender){case"Male":e.rect(-this.dimension,-this.dimension,2*this.dimension,2*this.dimension);break;case"Female":e.arc(0,0,this.dimension,0,2*Math.PI,!0);break;case"Unknown":e.moveTo(0,-this.dimension),e.lineTo(-this.dimension,0),e.lineTo(0,this.dimension),e.lineTo(this.dimension,0),e.lineTo(0,-this.dimension)}if(e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.affected?e.fillStyle="rgba(150,150,150,0.75)":e.fillStyle="rgba(255,255,255,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawStub&&(e.beginPath(),e.moveTo(0,-this.dimension),e.lineTo(0,2*-this.dimension),e.stroke()),this.deceased){var i=1.2*this.dimension;e.beginPath(),e.moveTo(-i,i),e.lineTo(i,-i),e.stroke()}if(this.isProband){i=1.3*this.dimension;e.beginPath(),e.moveTo(-5,i),e.lineTo(5,i),e.lineTo(0,i-5),e.closePath(),e.fillStyle="rgba(150,150,150,0.75)",e.fill(),e.stroke()}e.font="24px sans-serif",e.fillStyle="rgba(100,100,100,0.75)";var r=e.measureText(this.condition).width+20;e.fillText(this.condition,-r/2+10,64)}return this.isClicked},ED.FamilyMember.prototype.setNode=function(t){this.node=t,this.node.type==PD.NodeType.Female&&(this.gender="Female"),this.node.type==PD.NodeType.Male&&(this.gender="Male"),this.node.type==PD.NodeType.Unknown&&(this.gender="Unknown"),this.isProband=this.node.member.isProband,this.affected=this.node.member.affected,this.deceased=this.node.member.deceased,this.condition=this.node.member.condition},ED.Freehand=function(t,e){this.className="Freehand",this.labelWidth=0,this.labelHeight=80,this.labelFont="60px sans-serif",this.colourString="A35100",this.filled=!0,this.thickness="Thin",this.labelText="",this.savedParameterArray=["originX","originY","colourString","filled","thickness","labelText"],this.controlParameterArray={colourString:"Colour",filled:"Fill",thickness:"Thickness",labelText:"Label"},ED.Doodle.call(this,t,e)},ED.Freehand.prototype=new ED.Doodle,ED.Freehand.prototype.constructor=ED.Freehand,ED.Freehand.superclass=ED.Doodle.prototype,ED.Freehand.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.Freehand.prototype.setPropertyDefaults=function(){this.isDrawable=!0,this.parameterValidationArray.colourString={kind:"derived",type:"colourString",list:["FF0000FF","FFB8ED","FF9806","E5A222","A35100","FFED3D","00FF00FF","0000FFFF","979797","252525","FFFFFF"],animate:!0},this.parameterValidationArray.filled={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.thickness={kind:"derived",type:"string",list:["Thin","Medium","Thick"],animate:!0},this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!0}},ED.Freehand.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,100)},ED.Freehand.prototype.draw=function(t){var e=this.drawing.context;ED.Freehand.superclass.draw.call(this,t),e.beginPath();if(e.rect(-400,-400,800,800),e.closePath(),new ED.Colour(0,0,0,1).setWithHexString(this.colourString),e.lineWidth=2,this.isFilled=!1,e.strokeStyle="rgba(255, 255, 255, 0)",this.isSelected&&(e.strokeStyle="gray"),this.isForDrawing&&(e.strokeStyle="blue"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var i=0;i<this.squiggleArray.length;i++){var r=this.squiggleArray[i];e.beginPath(),e.lineWidth=r.thickness,e.strokeStyle=r.colour.rgba(),e.fillStyle=r.colour.rgba();for(var a=0;a<r.pointsArray.length;a++)e.lineTo(r.pointsArray[a].x,r.pointsArray[a].y);e.stroke(),r.filled&&this.filled&&r.complete&&e.fill()}this.labelText.length>0&&(e.font=this.labelFont,this.labelWidth=e.measureText(this.labelText).width,e.fillStyle="black",e.fillText(this.labelText,this.apexX,this.labelHeight/6),console.log(this.apexX))}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(400,-400)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MouseTest=function(t,e){this.className="MouseTest",ED.Doodle.call(this,t,e)},ED.MouseTest.prototype=new ED.Doodle,ED.MouseTest.prototype.constructor=ED.MouseTest,ED.MouseTest.superclass=ED.Doodle.prototype,ED.MouseTest.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.MouseTest.prototype.draw=function(t){var e=this.drawing.context;ED.MouseTest.superclass.draw.call(this,t),e.beginPath();return e.rect(-100,-100,200,200),e.closePath(),e.lineWidth=1,e.fillStyle="white",e.strokeStyle="blue",this.drawBoundary(t),this.isClicked&&console.log(t.x,t.y),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isClicked},ED.GraphAxes=function(t,e){this.className="GraphAxes",ED.Doodle.call(this,t,e)},ED.GraphAxes.prototype=new ED.Doodle,ED.GraphAxes.prototype.constructor=ED.GraphAxes,ED.GraphAxes.superclass=ED.Doodle.prototype,ED.GraphAxes.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.GraphAxes.prototype.draw=function(t){var e=this.drawing.context;ED.GraphAxes.superclass.draw.call(this,t),e.beginPath();var i=400;if(e.moveTo(0,-i),e.lineTo(0,i),e.moveTo(-i,0),e.lineTo(i,0),e.moveTo(0,-i),e.closePath(),e.lineWidth=4,e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var r=-i;r<=i;r+=100)0!=r&&(e.moveTo(-20,r),e.lineTo(20,r));for(var a=-i;a<=i;a+=100)0!=a&&(e.moveTo(a,-20),e.lineTo(a,20));e.stroke(),e.font="80px sans-serif",e.fillStyle="gray",e.textAlign="center",e.fillText("+Sph",0,-440),e.fillText("-Sph",0,480),e.fillText("+Cyl",400,-40),e.fillText("-Cyl",-400,-40)}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Label=function(t,e){this.className="Label",this.labelText="",this.lastOriginX=0,this.lastOriginY=0,this.labelWidth=0,this.labelHeight=80;var i=1;t.globalScaleFactor&&(i=t.globalScaleFactor);var r=1/i*60;this.labelFont=r.toString()+"px sans-serif",this.padding=10,this.maximumLength=20,this.isEdited=!1,this.savedParameterArray=["originX","originY","apexX","apexY","labelText","lastOriginX","lastOriginY"],this.controlParameterArray={labelText:"Text"},ED.Doodle.call(this,t,e)},ED.Label.prototype=new ED.Doodle,ED.Label.prototype.constructor=ED.Label,ED.Label.superclass=ED.Doodle.prototype,ED.Label.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Label.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.apexY.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!1,validate:this.validateValue.bind(this)},this.storeOriginalParams()},ED.Label.prototype.validateValue=function(t){if(t.length<this.labelText.length)return!0;var e=this.drawing.context;e.font=this.labelFont;return(e.measureText(t).width+2*this.padding)*this.drawing.scale*1<=this.drawing.canvas.width},ED.Label.prototype.storeOriginalParams=function(){this.originalParams={originX:{min:this.parameterValidationArray.originX.range.min,max:this.parameterValidationArray.originX.range.max},originY:{min:this.parameterValidationArray.originY.range.min,max:this.parameterValidationArray.originY.range.max}}},ED.Label.prototype.setScaleLevel=function(t){ED.Doodle.prototype.setScaleLevel.apply(this,arguments);var e=this.originalParams.originX.min/this.scaleLevel,i=this.originalParams.originX.max/this.scaleLevel,r=this.originalParams.originY.min/this.scaleLevel,a=this.originalParams.originY.max/this.scaleLevel;this.parameterValidationArray.originX.range.setMinAndMax(e,i),this.parameterValidationArray.originY.range.setMinAndMax(r,a)},ED.Label.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.lastOriginX=this.originX,this.lastOriginY=this.originY,this.apexX=100,this.apexY=-150},ED.Label.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"originX":i.apexX=this.apexX-(e-this.lastOriginX),this.lastOriginX=e;break;case"originY":i.apexY=this.apexY-(e-this.lastOriginY),this.lastOriginY=e}return i},ED.Label.prototype.addBinding=function(t,e){ED.Doodle.prototype.addBinding.apply(this,arguments);var i=this.drawing,r=this.id,a=this.className,o=document.getElementById(e.id);"labelText"===t&&o.addEventListener("input",function(t){i.eventHandler("oninput",r,a,this.id,this.value)},!1)},ED.Label.prototype.draw=function(t){var e=this.drawing.context;if(ED.Label.superclass.draw.call(this,t),e.font=this.labelFont,this.labelWidth=e.measureText(this.labelText).width+2*this.padding,e.beginPath(),e.rect(-this.labelWidth/2,-this.labelHeight/2,this.labelWidth,this.labelHeight),e.closePath(),e.lineWidth=2,this.isFilled=!1,e.strokeStyle="rgba(0, 0, 0, 0)",this.isSelected&&(e.strokeStyle="gray"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.fillText(this.labelText,-this.labelWidth/2+this.padding,this.labelHeight/6);var i,r=new ED.Point(0,0);i=0==this.apexX?2:Math.abs(this.apexY/this.apexX),this.apexY<=0&&i>=1&&(r.x=0,r.y=-this.labelHeight/2),this.apexX<=0&&i<1&&(r.x=-this.labelWidth/2,r.y=0),this.apexY>0&&i>=1&&(r.x=0,r.y=this.labelHeight/2),this.apexX>0&&i<1&&(r.x=this.labelWidth/2,r.y=0);var a=new ED.Point(this.apexX,this.apexY);e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.strokeStyle="Gray",e.lineWidth=4,e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Label.prototype.onSelection=function(){ED.Label.superclass.onSelection.call(this),document.getElementById(this.parameterControlElementId("labelText")).focus()};var MathHelper=MathHelper||{};if(MathHelper.calculateLinearFunctionFromPoints=function(t,e,i,r,a){var o=(r-e)/(i-t);return o*a+(r-o*i)},ED.MemberConnector=function(t,e){this.className="MemberConnector",this.node=null,this.length=0,this.type="Pair",ED.Doodle.call(this,t,e)},ED.MemberConnector.prototype=new ED.Doodle,ED.MemberConnector.prototype.constructor=ED.MemberConnector,ED.MemberConnector.superclass=ED.Doodle.prototype,ED.MemberConnector.prototype.setPropertyDefaults=function(){this.parameterValidationArray.length={kind:"derived",type:"int",range:new ED.Range(0,1e3),animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Pair","Sibling"],animate:!0}},ED.MemberConnector.prototype.setParameterDefaults=function(){},ED.MemberConnector.prototype.draw=function(t){var e=this.drawing.context;switch(ED.MemberConnector.superclass.draw.call(this,t),e.beginPath(),this.type){case"Pair":e.moveTo(-this.length/2,0),e.lineTo(this.length/2,0),e.moveTo(0,0),e.lineTo(0,this.length);break;case"Sibling":e.moveTo(-this.length/2,0),e.lineTo(this.length/2,0)}return e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.OperatingTable=function(t,e){this.className="OperatingTable",ED.Doodle.call(this,t,e)},ED.OperatingTable.prototype=new ED.Doodle,ED.OperatingTable.prototype.constructor=ED.OperatingTable,ED.OperatingTable.superclass=ED.Doodle.prototype,ED.OperatingTable.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.OperatingTable.prototype.draw=function(t){var e=this.drawing.context;return ED.OperatingTable.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-0,60,0,2*Math.PI,!0),e.lineWidth=30,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.rect(-100,20,200,400),e.lineWidth=8,e.strokeStyle="rgba(120,120,120,1)",e.fillStyle="rgba(220,220,220,1)",e.fill(),e.stroke()),this.isClicked},ED.Patient=function(t,e){this.className="Patient",this.recliningAngle=0,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.Patient.prototype=new ED.Doodle,ED.Patient.prototype.constructor=ED.Patient,ED.Patient.superclass=ED.Doodle.prototype,ED.Patient.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isDeletable=!1,this.willStaySelected=!1,this.parameterValidationArray.rotation.range=new ED.Range(270*Math.PI/180,360*Math.PI/180),this.parameterValidationArray.recliningAngle={kind:"derived",type:"mod",range:new ED.Range(0,91),clock:"bottom",animate:!0}},ED.Patient.prototype.setParameterDefaults=function(){this.scaleX=.65,this.scaleY=.7,this.recliningAngle=0},ED.Patient.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"rotation":(r=360-180*e/Math.PI)>300&&(r=0),r>90&&(r=90),i.recliningAngle=r;break;case"recliningAngle":var r=(360-e)*Math.PI/180;i.rotation=r}return i},ED.Patient.prototype.draw=function(t){var e=this.drawing.context;ED.Patient.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-642,41),e.bezierCurveTo(-653,-91,-522,-146,-496,-148),e.bezierCurveTo(-470,-150,-221,-159,-199,-166),e.bezierCurveTo(-177,-174,-168,-201,-126,-221),e.bezierCurveTo(-95,-232,-71,-223,-54,-214),e.bezierCurveTo(-38,-205,-32,-170,-16,-168),e.bezierCurveTo(1,-166,21,-184,37,-166),e.bezierCurveTo(54,-148,21,-137,36,-126),e.bezierCurveTo(50,-115,58,-130,83,-122),e.bezierCurveTo(109,-115,169,-91,190,-82),e.bezierCurveTo(210,-73,232,-64,270,-67),e.bezierCurveTo(309,-71,301,-87,318,-106),e.bezierCurveTo(334,-124,316,-130,343,-155),e.bezierCurveTo(362,-170,395,-166,395,-166),e.lineTo(406,-177),e.lineTo(420,-168),e.lineTo(441,-175),e.bezierCurveTo(441,-175,441,-201,453,-203),e.bezierCurveTo(466,-205,492,-170,510,-168),e.bezierCurveTo(529,-166,508,-181,538,-181),e.bezierCurveTo(567,-181,617,-150,640,-137),e.bezierCurveTo(662,-108,651,-120,662,-90),e.bezierCurveTo(673,-60,677,-16,666,12),e.bezierCurveTo(655,39,642,52,618,61),e.bezierCurveTo(595,70,529,74,549,74),e.bezierCurveTo(569,74,442,74,463,72),e.bezierCurveTo(371,79,389,78,365,100),e.bezierCurveTo(342,122,354,158,336,191),e.bezierCurveTo(318,224,305,228,266,253),e.bezierCurveTo(125,279,-56,336,-106,296),e.bezierCurveTo(-122,270,-118,266,-139,224),e.bezierCurveTo(-175,221,-357,234,-446,236),e.bezierCurveTo(-536,239,-631,173,-642,41),e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,1)";var i=new ED.Colour(0,0,0,1);return i.setWithHexString("3AFEFA"),e.fillStyle=i.rgba(),this.drawBoundary(t),this.isClicked},ED.Signature=function(t,e){this.className="Signature",this.colourString="00FF00FF",this.savedParameterArray=[],ED.Doodle.call(this,t,e)},ED.Signature.prototype=new ED.Doodle,ED.Signature.prototype.constructor=ED.Signature,ED.Signature.superclass=ED.Doodle.prototype,ED.Signature.prototype.setHandles=function(){},ED.Signature.prototype.setPropertyDefaults=function(){this.isDrawable=!0,this.isMoveable=!1,this.isRotatable=!1,this.isFilled=!1},ED.Signature.prototype.setParameterDefaults=function(){},ED.Signature.prototype.draw=function(t){var e=this.drawing.context;ED.Signature.superclass.draw.call(this,t),e.beginPath();var i=this.drawing.canvas.height/this.drawing.scale*.99,r=this.drawing.canvas.width/this.drawing.scale*.99,a=r/2,o=i/2;if(e.rect(-a,-o,r,i),e.closePath(),e.lineWidth=2,e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var n=parseInt(.85*r/40);e.beginPath(),e.moveTo(.85*-a,.75*o-40),e.lineTo(.85*-a+50,.75*o+10),e.moveTo(.85*-a,.75*o+10),e.lineTo(.85*-a+50,.75*o-40);for(var s=2;s<n;s++)e.moveTo(.85*-a+40*s,.75*o),e.lineTo(.85*-a+40*s+20,.75*o);e.lineWidth=6,e.strokeStyle="gray",this.isForDrawing&&this.isSelected&&(e.strokeStyle="blue"),e.stroke();for(var l=0;l<this.squiggleArray.length;l++){var h=this.squiggleArray[l];e.beginPath(),e.lineWidth=6,e.strokeStyle="black";for(var d=0;d<h.pointsArray.length;d++)e.lineTo(h.pointsArray[d].x,h.pointsArray[d].y);e.stroke()}}return this.isClicked},ED.Slider2D=function(t,e){this.className="Slider2D",this.sphereSign=" ",this.sphereInteger=0,this.sphereFractional=0,this.cylinderSign=" ",this.cylinderInteger=0,this.cylinderFractional=0,ED.Doodle.call(this,t,e)},ED.Slider2D.prototype=new ED.Doodle,ED.Slider2D.prototype.constructor=ED.Slider2D,ED.Slider2D.superclass=ED.Doodle.prototype,ED.Slider2D.prototype.setPropertyDefaults=function(){this.snapToGrid=!0,this.gridSpacing=5,this.isShowHighlight=!1,this.parameterValidationArray.originX.range.setMinAndMax(-400,400),this.parameterValidationArray.originY.range.setMinAndMax(-400,400),this.parameterValidationArray.sphereSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.sphereInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.sphereFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0},this.parameterValidationArray.cylinderSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.cylinderInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.cylinderFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0}},ED.Slider2D.prototype.setParameterDefaults=function(){this.setParameterFromString("sphereSign","="),this.setParameterFromString("sphereInteger","0"),this.setParameterFromString("sphereFractional",".00"),this.setParameterFromString("cylinderSign","="),this.setParameterFromString("cylinderInteger","0"),this.setParameterFromString("cylinderFractional",".00")},ED.Slider2D.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"sphereSign":switch(e){case"+":i.originY=-1*Math.abs(this.originY);break;case"=":i.originY=0;break;case"-":i.originY=Math.abs(this.originY)}break;case"sphereInteger":i.originY=20*(parseInt(e)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?1:-1);break;case"sphereFractional":i.originY=20*(this.sphereInteger+parseFloat(e))*("-"==this.sphereSign?1:-1);break;case"cylinderSign":switch(e){case"+":i.originX=Math.abs(this.originX);break;case"=":i.originX=0;break;case"-":i.originX=-1*Math.abs(this.originX)}break;case"cylinderInteger":i.originX=20*(parseInt(e)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?-1:1);break;case"cylinderFractional":i.originX=20*(this.sphereInteger+parseFloat(e))*("-"==this.sphereSign?-1:1);break;case"originY":i.sphereSign=e>0?"-":e<0?"+":"=",i.sphereInteger=Math.floor(Math.abs(e/20)),0==(r=Math.abs(e/20)-Math.floor(Math.abs(e/20)))&&(i.sphereFractional=".00"),.25==r&&(i.sphereFractional=".25"),.5==r&&(i.sphereFractional=".50"),.75==r&&(i.sphereFractional=".75");break;case"originX":var r;i.cylinderSign=e<0?"-":e>0?"+":"=",i.cylinderInteger=Math.floor(Math.abs(e/20)),0==(r=Math.abs(e/20)-Math.floor(Math.abs(e/20)))&&(i.cylinderFractional=".00"),.25==r&&(i.cylinderFractional=".25"),.5==r&&(i.cylinderFractional=".50"),.75==r&&(i.cylinderFractional=".75")}return i},ED.Slider2D.prototype.draw=function(t){var e=this.drawing.context;ED.Slider2D.superclass.draw.call(this,t),e.beginPath();var i=30,r=80;e.moveTo(0,-110),e.lineTo(i,-r),e.lineTo(r,-r),e.lineTo(r,-i),e.lineTo(110,0),e.lineTo(r,i),e.lineTo(r,r),e.lineTo(i,r),e.lineTo(0,110),e.lineTo(-i,r),e.lineTo(-r,r),e.lineTo(-r,i),e.lineTo(-110,0),e.lineTo(-r,-i),e.lineTo(-r,-r),e.lineTo(-i,-r),e.closePath(),e.lineWidth=2,e.strokeStyle="blue";var a=e.createLinearGradient(0,-25,0,25);if(a.addColorStop(0,"rgba(170, 225, 225, 0.5)"),a.addColorStop(1,"rgba(130, 205, 205, 0.5)"),e.fillStyle=a,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var o=100;e.moveTo(0,-o),e.lineTo(0,o),e.moveTo(-o,0),e.lineTo(o,0),e.moveTo(0,-o),e.strokeStyle="gray",e.stroke()}return this.isClicked},ED.Surgeon=function(t,e){this.className="Surgeon",this.surgeonPosition="Temporal",this.savedParameterArray=["surgeonPosition"],ED.Doodle.call(this,t,e)},ED.Surgeon.prototype=new ED.Doodle,ED.Surgeon.prototype.constructor=ED.Surgeon,ED.Surgeon.superclass=ED.Doodle.prototype,ED.Surgeon.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.snapToAngles=!0,this.willStaySelected=!1,this.isUnique=!0,this.isDeletable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(100,500),this.parameterValidationArray.surgeonPosition={kind:"derived",type:"string",list:["Superior","Supero-temporal","Temporal","Infero-temporal","Inferior","Infero-nasal","Nasal","Supero-nasal"],animate:!0};var t=Math.PI/4;this.anglesArray=[0,t,2*t,3*t,4*t,5*t,6*t,7*t]},ED.Surgeon.prototype.setParameterDefaults=function(){this.rotation=0,this.setParameterFromString("surgeonPosition","Temporal")},ED.Surgeon.prototype.dependentParameterValues=function(t,e){var i={},r=this.drawing.eye==ED.eye.Right,a=2*Math.PI;switch(t){case"rotation":i.surgeonPosition=r?e<a/16?"Superior":e<3*a/16?"Supero-nasal":e<5*a/16?"Nasal":e<7*a/16?"Infero-nasal":e<9*a/16?"Inferior":e<11*a/16?"Infero-temporal":e<13*a/16?"Temporal":e<15*a/16?"Supero-temporal":"Superior":e<a/16?"Superior":e<3*a/16?"Supero-temporal":e<5*a/16?"Temporal":e<7*a/16?"Infero-temporal":e<9*a/16?"Inferior":e<11*a/16?"Infero-nasal":e<13*a/16?"Nasal":e<15*a/16?"Supero-nasal":"Superior";break;case"surgeonPosition":switch(e){case"Superior":i.rotation=0;break;case"Supero-temporal":i.rotation=r?7*Math.PI/4:1*Math.PI/4;break;case"Temporal":i.rotation=r?6*Math.PI/4:2*Math.PI/4;break;case"Infero-temporal":i.rotation=r?5*Math.PI/4:3*Math.PI/4;break;case"Inferior":i.rotation=Math.PI;break;case"Infero-nasal":i.rotation=r?3*Math.PI/4:5*Math.PI/4;break;case"Nasal":i.rotation=r?2*Math.PI/4:6*Math.PI/4;break;case"Supero-nasal":i.rotation=r?1*Math.PI/4:7*Math.PI/4}}return i},ED.Surgeon.prototype.draw=function(t){var e=this.drawing.context;ED.Surgeon.superclass.draw.call(this,t),e.beginPath();var i=.2,r=-300;e.moveTo(0,-340),e.bezierCurveTo(-20,-350,-29,-338,-40,-336),e.bezierCurveTo(-62,-332,-498*i,-315,-100,r+0),e.bezierCurveTo(-100,-290,-100,-208,-94,-160),e.bezierCurveTo(-94,-158,-100,-146,-100,-138),e.bezierCurveTo(-100,-132,-88,-130,-84,-132),e.bezierCurveTo(-78,-134,-76,-158,-76,-160),e.bezierCurveTo(-74,-160,-72,-144,-70,-144),e.bezierCurveTo(-66,-144,-68,-154,-68,-160),e.bezierCurveTo(-68,-162,-70,-164,-70,-166),e.bezierCurveTo(-70,-182,-77,-263,-60,-280),e.bezierCurveTo(-30,-272,-50,-260,0,-240),e.bezierCurveTo(50,-260,30,-272,60,-280),e.bezierCurveTo(76,-264,70,-182,70,-166),e.bezierCurveTo(70,-164,68,-162,68,-160),e.bezierCurveTo(68,-154,66,-144,70,-144),e.bezierCurveTo(72,-144,74,-160,76,-160),e.bezierCurveTo(76,-158,78,-134,84,-132),e.bezierCurveTo(86,-131,101,-132,101,-138),e.bezierCurveTo(101,-148,94,-158,94,-160),e.bezierCurveTo(100,-208,499*i,r+9,100,r+0),e.bezierCurveTo(498*i,-315.6,61.6,-332.8,40,-336.4),e.bezierCurveTo(29,-338,20,-350,0,-340),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,1)";var a=new ED.Colour(0,0,0,1);return a.setWithHexString("3AFEFA"),e.fillStyle=a.rgba(),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(0,-350),e.bezierCurveTo(-20,-350,-36,-340,-40,-334),e.bezierCurveTo(-209*i,-331.4,-44,-320,-46,-310),e.bezierCurveTo(-52,-314,-52,r-4,-52,r+0),e.bezierCurveTo(-52,r+4,-52,-284,-46,-288),e.bezierCurveTo(-46,-282,-44,-271.8,-42,-268),e.bezierCurveTo(-38,-260,-20,-244,-8,-240),e.bezierCurveTo(-34*i,-239.4,-4,-230,0,-230),e.bezierCurveTo(4,-230,34*i,-240,8,-240),e.bezierCurveTo(20,-244,38,-260,42,-268),e.bezierCurveTo(43.6,-271.4,46,-282,46,-288),e.bezierCurveTo(52,-284,52,r+4,52,r+0),e.bezierCurveTo(52,r-4,52,-314,46,-310),e.bezierCurveTo(44,-320,41.6,-331.6,40,-334),e.bezierCurveTo(36,-340,20,-350,0,-350),e.fill(),e.stroke()),this.isClicked},null==ED||"object"!=typeof ED)ED=new Object;if(ED.trans=new Object,ED.trans.ACIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.ACMaintainer="Drag to move",ED.trans.AngleGradeEast="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeNorth="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeSouth="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeWest="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleNV="Drag to move around angle<br/>Drag handles to change extent",ED.trans.AngleRecession="Drag to move around angle<br/>Drag handles to change extent",ED.trans.AntSeg="Drag the handle to resize the pupil<br/><br/>The iris is semi-transparent so that IOLs, and<br/>other structures can be seen behind it",ED.trans.AntSegCrossSection="",ED.trans.AntSynech="Drag to move around angle<br/>Drag handles to change extent",ED.trans.ArcuateKeratotomy="Drag to rotate<br/>Drag end handle to increase extent<br/>Drag middle handle to change radius",ED.trans.ArcuateScotoma="Drag handle to change size",ED.trans.BiopsySite="Drag to position",ED.trans.Bleb="Drag to move around the limbus<br/>Drag handle to change size",ED.trans.BlotHaemorrhage="Drag to position<br/>Drag the handle to change size",ED.trans.BuckleSuture="Drag to position",ED.trans.BusaccaNodule="Drag to move around the iris",ED.trans.CapsularTensionRing="This cannot be selected directly since it is behind the iris<br/>Select the iris first<br/>Then move the scroll wheel until the ring is selected<br/>Click the 'Move to front' button<br/>Err.. of course if you are seeing this tooltip you have already done it",ED.trans.ChandelierSingle="Drag to rotate around centre<br/>",ED.trans.ChandelierDouble="Drag to rotate around centre<br/>",ED.trans.ChoroidalHaemorrhage="Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.ChoroidalNaevus="Drag to position<br/>Drag outer handles to change shape<br/>Drag outer ring of top handles to rotate<br/>Drag middle handle to add drusen",ED.trans.CiliaryInjection="Drag to rotate around centre<br/>Drag handles to change extent",ED.trans.Circinate="Drag to position<br/>Drag handle to change size",ED.trans.CircumferentialBuckle="Drag to position<br/>Drag outer handles to change extent<br/>Drag middle handle to change width",ED.trans.ConjunctivalFlap="Drag to move around the limbus<br/>Drag handles to change size and depth",ED.trans.ContinuousCornealSuture="",ED.trans.CornealAbrasion="Drag to position<br/>Drag handle to change size",ED.trans.CorneaCrossSection="",ED.trans.CornealErosion="Drag to position<br/>Drag handle to change size",ED.trans.CornealGraft="Drag handle to change size<br/>Drag to position",ED.trans.CornealGraftCrossSection="",ED.trans.CornealInlay="",ED.trans.CornealOedema="Drag to position<br/>Drag handle to change size",ED.trans.CornealStriae="",ED.trans.CornealScar="Drag outer handle to change shape<br/>Drag inner handle to change density",ED.trans.CornealSuture="Drag to move",ED.trans.CornealLaceration="Please click to draw each point of the laceration.<br />Double click to complete.",ED.trans.CorticalCataract="Drag to move<br/>Drag handle to change density",ED.trans.CottonWoolSpot="Drag to position<br/>Drag handle to change shape and size",ED.trans.CNV="Drag to move<br/>Drag handle to scale",ED.trans.CutterPI="Drag to move around the iris",ED.trans.CystoidMacularOedema="Drag handle to change size",ED.trans.DiabeticNV="Drag to position<br/>Drag handle to change size",ED.trans.DiscHaemorrhage="Drag to position",ED.trans.DiscPallor="Drag to position<br/>Drag handles to adjust extent",ED.trans.DrainageRetinotomy="Drag to position",ED.trans.DrainageSite="Drag to change position",ED.trans.EndothelialKeratoplasty="Drag handle to change size<br/>Drag to position",ED.trans.EndothelialKeratoplastyCrossSection="",ED.trans.EncirclingBand="Drag to change orientation of Watzke sleeve",ED.trans.EntrySiteBreak="Drag to position<br/>Drag either end handle to increase extent",ED.trans.EpiretinalMembrane="Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrousProliferation="Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrovascularScar="Drag to move<br/>Drag handle to scale",ED.trans.FocalLaser="Drag the handle for a bigger area with more burns",ED.trans.Freehand="Double-click to start drawing<br/>Drag inner handle to change size<br/>Drag outer handle to rotate<br/><br/>Adjust colours and settings in tool bar",ED.trans.Fundus="",ED.trans.Fuchs="Drag handle to change shape",ED.trans.Geographic="Drag middle handle to alter size of remaining central island of RPE<br/>Drag outside handle to scale",ED.trans.Gonioscopy="Select Meshwork Pigmentation from the list",ED.trans.HardDrusen="Drag middle handle up and down to alter density of drusen<br/>Drag outside handle to scale",ED.trans.Drusen="Drag to position<br/>Drag middle handle up and down to alter density of drusen<br/>Drag outside handle to scale",ED.trans.HardExudate="Drag to position",ED.trans.Hyphaema="Drag handle vertically to change size<br/>Drag handle horizontally to change density",ED.trans.Hypopyon="Drag handle vertically to change size",ED.trans.IatrogenicBreak="Drag to position<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.ILMPeel="Drag to position<br/>Drag handle to change size",ED.trans.InjectionSite="Drag to position<br/>Drag handle to adjust distance from limbus",ED.trans.ICL="Drag to move<br/>Drag handle to scale and rotate",ED.trans.IOL="Drag to move<br/>Drag handle to rotate",ED.trans.IrisHook="Drag to move around the clock<br/><br/>The hook will match the size of the pupil as it changes<br/>Subsequent hooks are added to the next quadrant",ED.trans.IrisNaevus="Drag to move<br/>Drag handle to change size",ED.trans.IrisTrauma="Drag to rotate<br/>Drag handle to change extent of trauma",ED.trans.IRMA="Drag to move<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.KeraticPrecipitates="Drag middle handle up and down to alter density<br/>Drag middle handle left and right to alter size<br/>Drag outside handle to scale",ED.trans.KoeppeNodule="Drag to move around the iris",ED.trans.KrukenbergSpindle="Drag to move</br>Drag outer handle to change shape",ED.trans.Label="Drag to move label, type text to edit<br/>Drag handle to move pointer",ED.trans.LaserCircle="Drag handle to change shape",ED.trans.LaserDemarcation="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move line more posteriorly",ED.trans.LaserSpot="Drag to position<br/>Drag the handle to change size",ED.trans.LasikFlap="Drag to rotate<br/>Drag the handle to scale",ED.trans.Lens="Drag to move<br/>Edit properties when selected<br/>Delete to remove",ED.trans.LensCrossSection="",ED.trans.LimbalRelaxingIncision="Drag to move",ED.trans.Macroaneurysm="Drag to move",ED.trans.MacularDystrophy="Drag outer handle to change size<br/>Drag middle handle to change type",ED.trans.MacularGrid="Drag the handle to scale",ED.trans.MacularHole="Drag the handle to scale",ED.trans.MacularThickening="Drag to position<br/>Drag handle to change size",ED.trans.MattressSuture="Drag to move",ED.trans.Microaneurysm="Drag to position",ED.trans.NerveFibreDefect="Drag to position<br/>Drag handles to change size",ED.trans.NuclearCataract="Drag to move<br/>Drag handle to change density",ED.trans.OperatingTable="",ED.trans.OpticDisc="Basic mode: Drag handle to adjust cup/disc ratio<br/>Expert mode: Drag handles to re-shape disc",ED.trans.OpticDiscPit="Drag to position<br/>Drag handle to change shape",ED.trans.Patch="Drag to position<br/>Drag handle to change size",ED.trans.Papilloedema="",ED.trans.PCIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.PeripapillaryAtrophy="Drag to rotate<br/>Drag handles to change extent",ED.trans.PeripheralRetinectomy="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PeripheralRRD="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PhakoIncision="Drag end handle to change length<br/>Drag the middle handle to change section type<br/>Drag the incision itself to move",ED.trans.PI="Drag to move around the iris",ED.trans.PigmentEpitheliumDetachment="Drag to move<br/>Drag the handle to scale",ED.trans.PosteriorCapsule="",ED.trans.PosteriorEmbryotoxon="",ED.trans.PosteriorRetinectomy="Drag to position<br/>Drag the handle to change size",ED.trans.PosteriorSynechia="Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.PostPole="The disc cup can be edited by clicking on the disc, and dragging the yellow handle<br/>The gray circle marks one disc diameter from the fovea",ED.trans.PostSubcapCataract="Drag handle to change size",ED.trans.PreRetinalHaemorrhage="Drag to position<br/>Drag handles to change shape and size",ED.trans.PRPPostPole="",ED.trans.PTK="Drag handle to change size",ED.trans.RadialSponge="Drag to change position",ED.trans.RetinalArteryOcclusionPostPole="Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RetinalTouch="Drag to change position",ED.trans.RetinalVeinOcclusionPostPole="Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RK="Drag to rotate<br/>Drag outer handle to resize<br/>Drag inner handle to adjust central extent",ED.trans.RoundHole="",ED.trans.RPEAtrophy="Drag to position<br/>Drag the handle to change size",ED.trans.RPEDetachment="Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.RetinalHaemorrhage="Drag to position<br/>Drag the handle to change size",ED.trans.RPEHypertrophy="Drag to position<br/>Drag the handle to change size",ED.trans.RPERip="Drag to move<br/>Drag large handle to resize and rotate<br/>Drag other handles to adjust shape",ED.trans.RRD="Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.Rubeosis="Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.SectorPRP="Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.SectorPRPPostPole="Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.ScleralIncision="Drag to move around the sclera",ED.trans.SectorIridectomy="Drag to position<br/>Drag handles to adjust extent",ED.trans.Sclerostomy="Drag to rotate around centre<br/>Drag each handle to alter gauge<br/>Click suture button to toggle suture",ED.trans.SidePort="Drag to move",ED.trans.SMILE="Drag to handle to change size",ED.trans.SubretinalFluid="Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.SubretinalPFCL="Drag to position<br/>Drag handle to change size",ED.trans.Supramid="Drag handle to move conjunctival end of suture",ED.trans.Surgeon="",ED.trans.SwollenDisc="",ED.trans.Telangiectasis="Drag middle handle to add pigment and exudate",ED.trans.ToricPCIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.Trabectome="Drag to position<br/>Drag either end handle to adjust extent",ED.trans.TrabyConjIncision="Drag to position<br/>Drag end handle to adjust extent",ED.trans.TrabyFlap="Drag to position<br/>Drag either end handle to adjust size</br>Drag middle handle to change sclerostomy",ED.trans.TrabySuture="Drag to position<br/>Drag corner handle to adjust orientation</br>Drag lower handle to change suture type",ED.trans.TractionRetinalDetachment="Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.TransilluminationDefect="Drag to rotate around centre<br/>Drag each end handle to alter extent",ED.trans.Tube="Drag to change quadrant<br/>Drag handle to move end of tube",ED.trans.TubeExtender="Drag to change quadrant<br/>Drag handle to move end of tube",ED.trans.TubeLigation="Drag to change position",ED.trans.UTear="",ED.trans.ViewObscured="Drag handle to change opacity",ED.trans.VitelliformMacularLesion="Drag to move<br/>Drag the handle to scale",ED.trans.VitreousOpacity="Drag to move<br/>Drag the inner handle up and down to alter opacity<br/>Drag the outer handle to scale",ED.trans.Grommet="Drag to position",ED.trans.Perforation="Drag to move<br/>Drag handle to change size",ED.trans.Crepitations="Drag to move<br/>Drag handle to resize",ED.trans.Stenosis="Drag to move<br/>Drag handle up and down to change degree<br/>Drag handle to left and right to change type",ED.trans.Wheeze="Drag to move",ED.trans.Effusion="Drag handle to move up",ED.trans.LeftCoronaryArtery="Drag handle to move origin and make anomolous",ED.trans.DrugStent="Drag to move",ED.trans.MetalStent="Drag to move",ED.trans.Bypass="Drag handle to alter destination",ED.trans.Bruit="Drag to move",ED.trans.Bruising="Drag to move<br/>Drag handle to resize",ED.trans.Haematoma="Drag to move<br/>Drag handle to resize",ED.AgentDose=function(t,e){this.className="AgentDose",this.halfWidth=50,this.halfHeight=20,this.minimumWidth=40,this.valueString="200mg",ED.Doodle.call(this,t,e)},ED.AgentDose.prototype=new ED.Doodle,ED.AgentDose.prototype.constructor=ED.AgentDose,ED.AgentDose.superclass=ED.Doodle.prototype,ED.AgentDose.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDose.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-1e3+this.halfWidth,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(-this.halfWidth+this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDose.prototype.setParameterDefaults=function(){this.apexX=100},ED.AgentDose.prototype.draw=function(t){var e=this.drawing.context;ED.AgentDose.superclass.draw.call(this,t),e.beginPath();if(this.halfWidth=1.5*e.measureText(this.valueString).width,e.moveTo(-this.halfWidth,5-this.halfHeight),e.lineTo(-5,5-this.halfHeight),e.lineTo(0,-this.halfHeight),e.lineTo(5,5-this.halfHeight),e.lineTo(this.halfWidth,5-this.halfHeight),e.lineTo(this.halfWidth,this.halfHeight-5),e.lineTo(5,this.halfHeight-5),e.lineTo(0,this.halfHeight),e.lineTo(-5,this.halfHeight-5),e.lineTo(-this.halfWidth,this.halfHeight-5),e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(50,50,50,1)",e.fillStyle="white",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.font="24px sans-serif",e.strokeStyle="gray",e.fillStyle="gray";var i=e.measureText(this.valueString).width;e.fillText(this.valueString,-i/2,8)}return this.isClicked},ED.AgentDuration=function(t,e){this.className="AgentDuration",this.unit="mg",this.type="range",this.halfHeight=20,this.minimumWidth=40,this.dose="",this.savedParameterArray=["originX","apexX","unit","type","dose"],ED.Doodle.call(this,t,e)},ED.AgentDuration.prototype=new ED.Doodle,ED.AgentDuration.prototype.constructor=ED.AgentDuration,ED.AgentDuration.superclass=ED.Doodle.prototype,ED.AgentDuration.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDuration.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.unit={kind:"derived",type:"string",list:["mg","mls","ug","mg/kg/hr","ug/kg/hr","drops","IU"],animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["range","fixed"],animate:!0},this.parameterValidationArray.originX.range.setMinAndMax(-500,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDuration.prototype.setParameterDefaults=function(){this.apexX=this.minimumWidth},ED.AgentDuration.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"type":this.apexX="range"==e?200:40}return i},ED.AgentDuration.prototype.draw=function(t){var e=this.drawing.context;ED.AgentDuration.superclass.draw.call(this,t),e.beginPath();var i=this.minimumWidth/2;if("range"==this.type&&(i=0),e.rect(0-i,-this.halfHeight,this.apexX,2*this.halfHeight),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(125,125,125,0)",e.fillStyle="rgba(125,125,125,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),"range"==this.type?(e.moveTo(0-i,-this.halfHeight),e.lineTo(0-i,this.halfHeight),e.moveTo(0-i,0),e.lineTo(this.apexX-i,0),e.moveTo(this.apexX-i,-this.halfHeight),e.lineTo(this.apexX-i,this.halfHeight)):(e.moveTo(-i,0),e.lineTo(0,this.halfHeight),e.lineTo(i,0),e.lineTo(0,-this.halfHeight),e.closePath()),e.lineWidth=4,e.strokeStyle="rgba(50,50,50,1)",e.stroke(),e.lineWidth=1,e.font="24px sans-serif",e.strokeStyle="blue",e.fillStyle="blue";var r=String(this.dose);r.length>0&&(r=r+" "+this.unit);e.measureText(r).width;e.fillText(r,i+10,-8)}return"range"==this.type&&(this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t)),this.isClicked},ED.AgentDuration.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.beginPath();var e=this.minimumWidth/2;"range"==this.type&&(e=0);t.rect(0-e-3,-this.halfHeight-3,this.apexX+6,2*this.halfHeight+6),t.lineWidth=3,t.strokeStyle="yellow",t.stroke()},ED.RecordGrid=function(t,e){this.className="RecordGrid",this.values={sys:160,dia:80,pul:60,res:30,oxi:100},this.minutesPerCell=5,this.minutesLabelArray=[0,30],this.totalMinutes=180,this.numberCellsHorizontal=Math.round(this.totalMinutes/this.minutesPerCell)+2,this.numberCellsVertical=12,this.separationOfVerticalGridLines=t.doodlePlaneWidth/this.numberCellsHorizontal,this.index=0,this.firstCoordinate=-t.doodlePlaneWidth/2,this.startDate=new Date,this.gridStartDate=new Date,this.nowDate=new Date,this.setGridStartDate(this.startDate),this.savedParameterArray=["startDate"],this.parameterObjectTypeArray={startDate:"date",gridStartDate:"date"},ED.Doodle.call(this,t,e)},ED.RecordGrid.prototype=new ED.Doodle,ED.RecordGrid.prototype.constructor=ED.RecordGrid,ED.RecordGrid.superclass=ED.Doodle.prototype,ED.RecordGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.RecordGrid.prototype.draw=function(t){var e=this.drawing.context;ED.RecordGrid.superclass.draw.call(this,t),e.beginPath();var i=-this.drawing.doodlePlaneWidth/2,r=-this.drawing.doodlePlaneHeight/2,a=this.drawing.doodlePlaneWidth/this.numberCellsHorizontal,o=this.drawing.doodlePlaneHeight/this.numberCellsVertical;if(e.rect(i,r,this.drawing.doodlePlaneWidth,this.drawing.doodlePlaneHeight),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var n=0;n<this.numberCellsVertical;n++)e.moveTo(i,r+n*o),e.lineTo(i+this.drawing.doodlePlaneWidth,r+n*o);for(var s=0;s<this.numberCellsHorizontal;s++)e.moveTo(i+s*a,r),e.lineTo(i+s*a,r+this.drawing.doodlePlaneHeight);e.lineWidth=4,e.strokeStyle="rgba(200,200,200,1)",e.stroke();var l=this.nowDate-this.gridStartDate;this.timeLineX=this.firstCoordinate+this.drawing.doodlePlaneWidth/this.numberCellsHorizontal*l/(6e4*this.minutesPerCell),e.beginPath(),e.moveTo(this.timeLineX,r),e.lineTo(this.timeLineX,r+this.drawing.doodlePlaneHeight),e.lineWidth=4,e.strokeStyle="red",e.stroke();for(s=1;s<this.numberCellsHorizontal;s++){dateOfGridLine=new Date(this.gridStartDate.getTime()+s*this.minutesPerCell*6e4);var h=dateOfGridLine.getHours(),d=dateOfGridLine.getMinutes();if(this.minutesLabelArray.indexOf(d)>=0){var c=h.toString();c.length<2&&(c="0"+c);var p=d.toString();p.length<2&&(p="0"+p);var y=c+":"+p;e.lineWidth=1,e.font="48px sans-serif",e.strokeStyle="gray",e.fillStyle="gray";var D=e.measureText(y).width;e.fillText(y,i+s*a-D/2,r+50)}}}return this.isClicked},ED.RecordGrid.prototype.getNextValues=function(t){for(var e=this.drawing.allDoodlesOfClass("RecordReading"),i=-2e3,r=0;r<e.length;r++)if(e[r].type==t){this.values[t]=e[r].value,i=e[r].originX;break}var a=this.getGridX();return a>i&&{value:this.values[t],originX:a}},ED.RecordGrid.prototype.setGridStartDate=function(t){var e=Math.round(t.getMinutes()/this.minutesPerCell)*this.minutesPerCell,i=Math.floor(t.getMinutes()/this.minutesPerCell)*this.minutesPerCell;this.gridStartDate=t,this.gridStartDate.setMinutes(i),e==i&&(this.gridStartDate=new Date(this.gridStartDate.getTime()-6e4*this.minutesPerCell)),this.gridStartDate.setSeconds(0)},ED.RecordGrid.prototype.getGridX=function(){var t=this.nowDate-this.gridStartDate;return this.index=Math.round(t/(6e4*this.minutesPerCell)),Math.round(this.firstCoordinate+this.index*this.separationOfVerticalGridLines)},ED.RecordReading=function(t,e){this.className="RecordReading",this.type="sys",this.value="0",this.savedParameterArray=["originX","originY","value","type"],ED.Doodle.call(this,t,e)},ED.RecordReading.prototype=new ED.Doodle,ED.RecordReading.prototype.constructor=ED.RecordReading,ED.RecordReading.superclass=ED.Doodle.prototype,ED.RecordReading.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.value={kind:"derived",type:"int",range:new ED.Range(0,240),animate:!1},this.parameterValidationArray.type={kind:"derived",type:"string",list:["sys","dia","pul","res","oxi"],animate:!1}},ED.RecordReading.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"originY":i.value=Math.round(240*(this.drawing.doodlePlaneHeight/2-e)/this.drawing.doodlePlaneHeight);break;case"value":i.originY=-e*this.drawing.doodlePlaneHeight/240+this.drawing.doodlePlaneHeight/2;break;case"originX":this.parameterValidationArray.originX.range.setMinAndMax(this.originX,this.originX)}return i},ED.RecordReading.prototype.draw=function(t){var e=this.drawing.context;ED.RecordReading.superclass.draw.call(this,t),e.beginPath();var i=56,r=30;switch(this.type){case"sys":e.rect(-28,-r,i,r);break;case"dia":e.rect(-28,0,i,r);break;case"pul":case"res":e.arc(0,0,r,0,2*Math.PI,!0);break;case"oxi":e.rect(-28,-15,i,r)}if(e.closePath(),e.strokeStyle="rgba(255,255,255,0)",e.fillStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),this.type){case"sys":e.moveTo(-28,-r),e.lineTo(0,0),e.lineTo(28,-r);break;case"dia":e.moveTo(-28,r),e.lineTo(0,0),e.lineTo(28,r);break;case"pul":case"res":e.arc(0,0,20,0,2*Math.PI,!0);break;case"oxi":e.rect(-28,-15,i,r)}e.lineWidth=8,e.lineJoin="round",e.lineCap="round",e.strokeStyle="gray",e.fillStyle=e.strokeStyle,e.stroke(),"pul"==this.type&&e.fill()}return this.isClicked},ED.RecordReading.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.font="64px sans-serif",t.strokeStyle="blue",t.fillStyle="blue",t.fillText(this.value,40,20)},null==ED||"object"!=typeof ED)ED=new Object;ED.Heart=function(t,e){this.className="Heart",ED.Doodle.call(this,t,e)},ED.Heart.prototype=new ED.Doodle,ED.Heart.prototype.constructor=ED.Heart,ED.Heart.superclass=ED.Doodle.prototype,ED.Heart.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Heart.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Heart.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Heart.prototype.draw=function(t){var e=this.drawing.context;ED.Heart.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,400,0,i,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-287,-51),e.bezierCurveTo(-344,53,-346,243,-116,209),e.bezierCurveTo(5,297,269,341,312,268),e.bezierCurveTo(387,141,319,-17,237,-59),e.bezierCurveTo(225,-133,141,-209,65,-215),e.bezierCurveTo(55,-209,43,-219,53,-193),e.bezierCurveTo(133,-185,201,-129,216,-46),e.bezierCurveTo(205,-23,167,11,187,25),e.bezierCurveTo(202,36,192,-37,235,-3),e.bezierCurveTo(291,41,333,227,295,207),e.bezierCurveTo(195,155,153,111,97,43),e.bezierCurveTo(74,15,177,62,181,43),e.bezierCurveTo(187,17,109,25,55,19),e.bezierCurveTo(31,-7,-172,-89,-173,-87),e.bezierCurveTo(-173,-84,-232,-117,-191,-73),e.bezierCurveTo(-115,-49,-61,-13,-37,-3),e.bezierCurveTo(-67,45,-14,171,3,165),e.bezierCurveTo(21,159,-53,45,15,23),e.bezierCurveTo(103,87,199,183,231,249),e.bezierCurveTo(199,297,-31,243,-81,199),e.bezierCurveTo(-53,175,-8,204,-13,187),e.bezierCurveTo(-17,171,-66,181,-105,185),e.bezierCurveTo(-331,209,-289,33,-273,-37),e.bezierCurveTo(-270,-47,-287,-51,-287,-51),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Heart.prototype.description=function(){return"Heart"},ED.Aorta=function(t,e){this.className="Aorta",ED.Doodle.call(this,t,e)},ED.Aorta.prototype=new ED.Doodle,ED.Aorta.prototype.constructor=ED.Aorta,ED.Aorta.superclass=ED.Doodle.prototype,ED.Aorta.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Aorta.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Aorta.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.5,this.originX=-352,this.originY=-416,this.apexX=-460,this.apexY=-460},ED.Aorta.prototype.draw=function(t){var e=this.drawing.context;ED.Aorta.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,400,0,i,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(216,-112),e.bezierCurveTo(216,-112,181,46,210,40),e.bezierCurveTo(239,33,282,-111,282,-111),e.moveTo(423,335),e.bezierCurveTo(423,335,453,57,313,31),e.bezierCurveTo(281,26,330,-100,330,-100),e.moveTo(-1,-25),e.bezierCurveTo(-1,-25,57,2,74,41),e.bezierCurveTo(82,61,93,79,116,78),e.bezierCurveTo(144,78,141,42,141,7),e.bezierCurveTo(141,-50,159,-97,159,-97),e.moveTo(198,582),e.bezierCurveTo(214,619,155,663,105,649),e.moveTo(-39,12),e.bezierCurveTo(-39,12,52,54,28,133),e.bezierCurveTo(28,133,-2,180,-16,200),e.bezierCurveTo(-49,246,-125,446,-28,595),e.lineTo(-1,640),e.bezierCurveTo(67,725,152,624,119,566),e.bezierCurveTo(151,598,255,603,251,514),e.bezierCurveTo(250,473,182,418,182,418),e.bezierCurveTo(118,352,162,209,254,211),e.bezierCurveTo(314,212,287,365,287,365),e.lineWidth=12,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Aorta.prototype.description=function(){return""},ED.RightCoronaryArtery=function(t,e){this.className="RightCoronaryArtery",ED.Doodle.call(this,t,e)},ED.RightCoronaryArtery.prototype=new ED.Doodle,ED.RightCoronaryArtery.prototype.constructor=ED.RightCoronaryArtery,ED.RightCoronaryArtery.superclass=ED.Doodle.prototype,ED.RightCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RightCoronaryArtery.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.RightCoronaryArtery.prototype.setParameterDefaults=function(){this.originX=24,this.originY=2,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.RightCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.RightCoronaryArtery.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,400,0,i,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.moveTo(-82,306),e.lineTo(-142,247),e.moveTo(-42,286),e.lineTo(-96,232),e.bezierCurveTo(-84,218,-36,250,-24,276),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RightCoronaryArtery.prototype.description=function(){return""},ED.LeftCoronaryArtery=function(t,e){this.className="LeftCoronaryArtery",ED.Doodle.call(this,t,e)},ED.LeftCoronaryArtery.prototype=new ED.Doodle,ED.LeftCoronaryArtery.prototype.constructor=ED.LeftCoronaryArtery,ED.LeftCoronaryArtery.superclass=ED.Doodle.prototype,ED.LeftCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.LeftCoronaryArtery.prototype.setPropertyDefaults=function(){this.isDeletable=!1},ED.LeftCoronaryArtery.prototype.setParameterDefaults=function(){this.originY=0,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-153,this.apexY=-84},ED.LeftCoronaryArtery.prototype.draw=function(t){var e=this.drawing.context;ED.LeftCoronaryArtery.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(-100,-50,100,0,i,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(this.apexX,this.apexY),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(-4,98),e.bezierCurveTo(-10,136,-10,136,-22,156),e.moveTo(58,-10),e.bezierCurveTo(62,18,62,18,54,42),e.moveTo(102,10),e.bezierCurveTo(106,38,106,38,102,56),e.moveTo(222,90),e.bezierCurveTo(242,92,242,92,258,94),e.moveTo(258,142),e.bezierCurveTo(340,264,316,250,204,244),e.moveTo(258,142),e.bezierCurveTo(264,164,264,164,260,176),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),this.apexX>-200?e.bezierCurveTo(-152,-40,-146,-27,this.apexX-20,this.apexY):e.bezierCurveTo(-152,-40,-146,-27,this.apexX-8,this.apexY+15),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LeftCoronaryArtery.prototype.description=function(){return this.apexX<-200?"Anomalous insertion of left coronary artery":""},ED.AnomalousVessels=function(t,e){this.className="AnomalousVessels",ED.Doodle.call(this,t,e)},ED.AnomalousVessels.prototype=new ED.Doodle,ED.AnomalousVessels.prototype.constructor=ED.AnomalousVessels,ED.AnomalousVessels.superclass=ED.Doodle.prototype,ED.AnomalousVessels.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AnomalousVessels.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.AnomalousVessels.prototype.setParameterDefaults=function(){this.originY=-100,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.AnomalousVessels.prototype.draw=function(t){var e=this.drawing.context;ED.AnomalousVessels.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,400,0,i,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(68,136),e.bezierCurveTo(50,130,23,124,14,110),e.bezierCurveTo(2,92,-2,66,-7,39),e.bezierCurveTo(-11,23,-24,-5,-35,-26),e.bezierCurveTo(-50,-55,41,-34,42,-8),e.bezierCurveTo(45,25,39,41,39,41),e.moveTo(200,257),e.bezierCurveTo(223,258,289,267,311,253),e.bezierCurveTo(331,240,314,208,304,193),e.bezierCurveTo(282,155,246,114,224,90),e.lineTo(254,89),e.moveTo(-6,94),e.bezierCurveTo(-8,113,-11,132,-33,164),e.moveTo(67,143),e.bezierCurveTo(67,143,42,138,16,129),e.bezierCurveTo(21,144,26,171,40,185),e.bezierCurveTo(63,208,102,210,102,210),e.moveTo(103,218),e.bezierCurveTo(103,218,55,208,39,202),e.bezierCurveTo(49,273,165,280,165,280),e.moveTo(-54,292),e.bezierCurveTo(-54,292,-103,238,-110,234),e.bezierCurveTo(-125,237,-142,247,-142,247),e.lineTo(-91,307),e.moveTo(195,136),e.bezierCurveTo(195,136,197,101,196,86),e.bezierCurveTo(214,97,232,110,243,130),e.bezierCurveTo(249,142,247,180,247,180),e.moveTo(164,284),e.bezierCurveTo(164,284,101,286,55,253),e.bezierCurveTo(35,238,24,200,16,175),e.lineTo(-6,94),e.moveTo(221,80),e.moveTo(257,151),e.bezierCurveTo(257,151,278,176,288,190),e.bezierCurveTo(297,204,312,227,304,240),e.bezierCurveTo(291,264,223,250,200,250),e.moveTo(-14,278),e.bezierCurveTo(-14,278,-49,217,-98,230),e.moveTo(135,-33),e.bezierCurveTo(135,-33,104,-23,71,-28),e.bezierCurveTo(110,-7,147,18,182,48),e.bezierCurveTo(193,57,205,73,215,77),e.bezierCurveTo(226,81,241,81,253,83),e.moveTo(190,133),e.bezierCurveTo(190,133,191,87,178,68),e.bezierCurveTo(165,49,96,11,96,11),e.moveTo(54,-12),e.bezierCurveTo(54,-12,77,-4,84,7),e.bezierCurveTo(94,24,89,57,89,57),e.moveTo(-210,-104),e.bezierCurveTo(-253,-100,-259,-73,-254,-66),e.bezierCurveTo(-379,8,-313,171,-289,204),e.bezierCurveTo(-245,265,-184,266,-151,252),e.bezierCurveTo(-144,261,-94,311,-94,311),e.moveTo(-38,158),e.bezierCurveTo(-38,158,17,81,-58,-42),e.bezierCurveTo(-152,-40,-206,-27,-238,-56),e.moveTo(-244,-58),e.bezierCurveTo(-364,-23,-327,263,-173,247),e.bezierCurveTo(-138,243,-88,191,-36,242),e.bezierCurveTo(-15,261,-9,276,-9,276),e.moveTo(-210,-94),e.bezierCurveTo(-277,-82,-206,-47,-186,-48),e.bezierCurveTo(-165,-48,-94,-52,-37,-58),e.bezierCurveTo(20,-63,40,-34,102,-34),e.bezierCurveTo(119,-34,135,-36,135,-36),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AnomalousVessels.prototype.description=function(){return"AnomalousVessels"},ED.Bypass=function(t,e){this.className="Bypass",ED.Doodle.call(this,t,e)},ED.Bypass.prototype=new ED.Doodle,ED.Bypass.prototype.constructor=ED.Bypass,ED.Bypass.superclass=ED.Doodle.prototype,ED.Bypass.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Bypass.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Bypass.prototype.setParameterDefaults=function(){var t=this.drawing.numberOfDoodlesOfClass(this.className);0==t?(this.apexX=40,this.apexY=-60):1==t?(this.apexX=-11,this.apexY=133):(this.apexX=-445,this.apexY=205)},ED.Bypass.prototype.draw=function(t){var e=this.drawing.context;ED.Bypass.superclass.draw.call(this,t),e.beginPath();var i=new ED.Point(-320,-200),r=new ED.Point(this.apexX,this.apexY),a=i.distanceTo(r),o=Math.PI/8;e.moveTo(i.x,i.y);var n=Math.atan((r.y-i.y)/(r.x-i.x));n<0&&(n=Math.PI/2+(Math.PI/2+n));var s=new ED.Point(0,0);s.setWithPolars(20,n);var l=new ED.Point(0,0);l.setWithPolars(a/2,n+Math.PI/2-o);var h=new ED.Point(s.x+r.x,s.y+r.y),d=new ED.Point(0,0);d.setWithPolars(20,n+Math.PI);var c=new ED.Point(d.x+r.x,d.y+r.y);return e.lineTo(i.x+s.x,i.y+s.y),e.bezierCurveTo(i.x+s.x+l.x,i.y+s.y+l.y,i.x+s.x+l.x,i.y+s.y+l.y,h.x,h.y),e.lineTo(r.x,r.y),e.lineTo(c.x,c.y),e.bezierCurveTo(i.x+d.x+l.x,i.y+d.y+l.y,i.x+d.x+l.x,i.y+d.y+l.y,i.x+d.x,i.y+d.y),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 000, 000, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.Bypass.prototype.description=function(){return"Bypass graft to "+(this.apexX>0?"left coronary artery":this.apexX>-300?"circumflex artery":"right coronary artery")},ED.MetalStent=function(t,e){this.className="MetalStent",ED.Doodle.call(this,t,e)},ED.MetalStent.prototype=new ED.Doodle,ED.MetalStent.prototype.constructor=ED.MetalStent,ED.MetalStent.superclass=ED.Doodle.prototype,ED.MetalStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.MetalStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MetalStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.MetalStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.MetalStent.superclass.draw.call(this,t);if(e.beginPath(),e.rect(-50,-10,100,20),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var i=0;i<10;i++)e.moveTo(10*i-50,-10),e.lineTo(10*i-50,10);e.stroke()}var r=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MetalStent.prototype.description=function(){return"Metal stent in "+(this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery")},ED.DrugStent=function(t,e){this.className="DrugStent",ED.Doodle.call(this,t,e)},ED.DrugStent.prototype=new ED.Doodle,ED.DrugStent.prototype.constructor=ED.DrugStent,ED.DrugStent.superclass=ED.Doodle.prototype,ED.DrugStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.DrugStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.DrugStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.DrugStent.prototype.draw=function(t){console.log(this.originX,this.originY,this.rotation);var e=this.drawing.context;ED.DrugStent.superclass.draw.call(this,t);var i=50,r=10;if(e.beginPath(),e.rect(-i,-r,100,20),e.lineWidth=4,e.strokeStyle="blue",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var a=0;a<5;a++)e.moveTo(20*a-i,-r),e.lineTo(20*(a+1)-i,10),e.moveTo(20*(a+1)-i,-r),e.lineTo(20*a-i,10);e.stroke()}var o=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrugStent.prototype.description=function(){return"Metal stent in "+(this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery")},ED.Stenosis=function(t,e){this.className="Stenosis",this.degree=0,this.type="Calcified",ED.Doodle.call(this,t,e)},ED.Stenosis.prototype=new ED.Doodle,ED.Stenosis.prototype.constructor=ED.Stenosis,ED.Stenosis.superclass=ED.Doodle.prototype,ED.Stenosis.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Stenosis.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-10,10),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0),this.parameterValidationArray.degree={kind:"derived",type:"int",range:new ED.Range(0,100),precision:0,animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Calcified","Non-calcified"],animate:!0}},ED.Stenosis.prototype.setParameterDefaults=function(){this.setParameterFromString("degree","0"),this.setParameterFromString("type","Calcified"),this.apexX=0,this.apexY=0,this.originX=-373,this.originY=323},ED.Stenosis.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexX":i.type=e>0?"Calcified":"Non-calcified";break;case"apexY":i.degree=e/-1;break;case"type":i.apexX="Calcified"==e?10:-10;break;case"degree":i.apexY=-1*e}return i},ED.Stenosis.prototype.draw=function(t){var e=this.drawing.context;ED.Stenosis.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle="blue",e.fillStyle="rgba(155, 155, 0,"+this.apexY/-100+")",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&"Calcified"==this.type&&(e.beginPath(),e.arc(-10,-10,8,0,2*Math.PI,!1),e.moveTo(10,-10),e.arc(10,-10,8,0,2*Math.PI,!1),e.moveTo(10,10),e.arc(10,10,8,0,2*Math.PI,!1),e.moveTo(-10,10),e.arc(-10,10,8,0,2*Math.PI,!1),e.fillStyle="white",e.fill()),point=new ED.Point(this.apexX,this.apexY),this.handleArray[4].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Stenosis.prototype.description=function(){var t;return t=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery",this.degree.toString()+"% "+this.type+" stenosis in the "+t},ED.Groin=function(t,e){this.className="Groin",ED.Doodle.call(this,t,e)},ED.Groin.prototype=new ED.Doodle,ED.Groin.prototype.constructor=ED.Groin,ED.Groin.superclass=ED.Doodle.prototype,ED.Groin.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Groin.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Groin.prototype.setParameterDefaults=function(){},ED.Groin.prototype.draw=function(t){var e=this.drawing.context;ED.Groin.superclass.draw.call(this,t);Math.PI;return e.beginPath(),e.moveTo(12,49),e.bezierCurveTo(37,49,68,24,68,24),e.bezierCurveTo(73,42,136,318,136,318),e.lineTo(460,318),e.bezierCurveTo(460,318,468,191,468,159),e.bezierCurveTo(468,127,451,-48,451,-67),e.bezierCurveTo(451,-87,444,-188,444,-215),e.bezierCurveTo(444,-242,407,-402,407,-402),e.lineTo(-380,-402),e.bezierCurveTo(-380,-402,-417,-242,-417,-215),e.bezierCurveTo(-417,-189,-423,-87,-423,-67),e.bezierCurveTo(-423,-48,-440,127,-440,159),e.bezierCurveTo(-440,191,-432,318,-432,318),e.lineTo(-112,318),e.lineTo(-40,24),e.bezierCurveTo(-27,39,-10,49,15,49),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 175, 175, 0.5)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-228,-189),e.lineTo(-158,-155),e.bezierCurveTo(-158,-155,-109,-113,-88,-75),e.bezierCurveTo(-74,-51,-65,-5,-40,24),e.moveTo(255,-189),e.lineTo(186,-155),e.bezierCurveTo(186,-155,136,-113,115,-75),e.bezierCurveTo(102,-51,92,-5,68,23),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(100, 100, 100, 1)",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Groin.prototype.description=function(){return"Groin"},ED.Haematoma=function(t,e){this.className="Haematoma",ED.Doodle.call(this,t,e)},ED.Haematoma.prototype=new ED.Doodle,ED.Haematoma.prototype.constructor=ED.Haematoma,ED.Haematoma.superclass=ED.Doodle.prototype,ED.Haematoma.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Haematoma.prototype.setParameterDefaults=function(){this.originX=-150},ED.Haematoma.prototype.draw=function(t){var e=this.drawing.context;ED.Haematoma.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(30,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Haematoma.prototype.groupDescription=function(){return"Haematoma"},ED.Bruising=function(t,e){this.className="Bruising",ED.Doodle.call(this,t,e)},ED.Bruising.prototype=new ED.Doodle,ED.Bruising.prototype.constructor=ED.Bruising,ED.Bruising.superclass=ED.Doodle.prototype,ED.Bruising.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Bruising.prototype.setParameterDefaults=function(){this.originX=-190,this.originY=100,this.scaleY=2},ED.Bruising.prototype.setPropertyDefaults=function(){this.isSqueezable=!0},ED.Bruising.prototype.draw=function(t){var e=this.drawing.context;ED.Bruising.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(127, 0, 127, 0.5)",e.fillStyle="rgba(127, 0, 127, 0.5)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(100,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruising.prototype.description=function(){return"Bruising"},ED.Bruit=function(t,e){this.className="Bruit",ED.Doodle.call(this,t,e)},ED.Bruit.prototype=new ED.Doodle,ED.Bruit.prototype.constructor=ED.Bruit,ED.Bruit.superclass=ED.Doodle.prototype,ED.Bruit.prototype.setHandles=function(){},ED.Bruit.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.Bruit.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.originX=-150,this.originY=-62},ED.Bruit.prototype.draw=function(t){var e=this.drawing.context;ED.Bruit.superclass.draw.call(this,t);e.beginPath(),e.arc(0,-50,100,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(155, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(0,-80),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var i=new ED.Point(0,0);return i.setWithPolars(100,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bruit.prototype.description=function(){return"Bruit"},ED.Crepitations=function(t,e){this.className="Crepitations",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Crepitations.prototype=new ED.Doodle,ED.Crepitations.prototype.constructor=ED.Crepitations,ED.Crepitations.superclass=ED.Doodle.prototype,ED.Crepitations.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Crepitations.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,200),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.Crepitations.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/4,this.apexX=50,this.apexY=0,this.setOriginWithDisplacements(-150,300)},ED.Crepitations.prototype.draw=function(t){var e=this.drawing.context;ED.Crepitations.superclass.draw.call(this,t);var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();e.moveTo(-i,0),e.lineTo(i,0);for(var r=-1;r<2;r+=2)for(var a=30;a<i;a+=30){var o=this.xForY(i,a);e.moveTo(-o,r*a),e.lineTo(o,r*a)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Crepitations.prototype.description=function(){var t=this.originX>0?" left lung":" right lung";return"crepitations"+(this.originY>0?" lower lobe of":" upper lobe of")+t},ED.Effusion=function(t,e){this.className="Effusion",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Effusion.prototype=new ED.Doodle,ED.Effusion.prototype.constructor=ED.Effusion,ED.Effusion.superclass=ED.Doodle.prototype,ED.Effusion.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Effusion.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Effusion.prototype.setParameterDefaults=function(){this.apexX=-231,this.apexY=136},ED.Effusion.prototype.draw=function(t){var e=this.drawing.context;return ED.Effusion.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(-.3*(-136+this.apexY)-400,this.apexY),e.lineTo(-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.lineTo(-44,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=4,e.fillStyle="yellow",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Effusion.prototype.description=function(){return"pleural effusion in right lung"},ED.Lungs=function(t,e){this.className="Lungs",ED.Doodle.call(this,t,e)},ED.Lungs.prototype=new ED.Doodle,ED.Lungs.prototype.constructor=ED.Lungs,ED.Lungs.superclass=ED.Doodle.prototype,ED.Lungs.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1},ED.Lungs.prototype.draw=function(t){var e=this.drawing.context;return ED.Lungs.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-147,-281),e.bezierCurveTo(-224,-279,-414,29,-426,289),e.bezierCurveTo(-334,226,-219,196,-79,236),e.bezierCurveTo(-6,231,-71,-284,-147,-281),e.moveTo(147,-281),e.bezierCurveTo(224,-279,414,29,426,289),e.bezierCurveTo(334,226,219,196,79,236),e.bezierCurveTo(6,231,71,-284,147,-281),e.closePath(),e.lineWidth=4,e.fillStyle="white",e.strokeStyle="gray",this.drawBoundary(t),this.isClicked},ED.Lungs.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.Wheeze=function(t,e){this.className="Wheeze",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Wheeze.prototype=new ED.Doodle,ED.Wheeze.prototype.constructor=ED.Wheeze,ED.Wheeze.superclass=ED.Doodle.prototype,ED.Wheeze.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.setOriginWithDisplacements(-200,100)},ED.Wheeze.prototype.draw=function(t){var e=this.drawing.context;ED.Wheeze.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,-50,100,0,2*Math.PI,!0),e.lineWidth=2,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="gray",e.strokeStyle="gray",e.lineWidth=8,e.beginPath(),e.arc(-50,0,20,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.moveTo(-34,0),e.lineTo(-34,-100),e.lineTo(66,-150),e.lineTo(66,-50),e.stroke(),e.beginPath(),e.arc(50,-50,20,0,2*Math.PI,!1),e.fill(),e.closePath(),e.fillStyle="gray",e.fill()),this.isClicked},ED.Wheeze.prototype.description=function(){var t=this.originX>0?" left lung":" right lung";return"wheeze"+(this.originY>0?" lower lobe of":" upper lobe of")+t},ED.EarDrum=function(t,e){this.className="EarDrum",ED.Doodle.call(this,t,e)},ED.EarDrum.prototype=new ED.Doodle,ED.EarDrum.prototype.constructor=ED.EarDrum,ED.EarDrum.superclass=ED.Doodle.prototype,ED.EarDrum.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.EarDrum.prototype.setParameterDefaults=function(){},ED.EarDrum.prototype.draw=function(t){var e=this.drawing.context;return ED.EarDrum.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-319,-94),e.bezierCurveTo(-321,-68,-330,81,-278,194),e.bezierCurveTo(-247,261,-175,336,-105,371),e.bezierCurveTo(-58,395,-5,397,46,395),e.bezierCurveTo(166,390,231,294,236,287),e.bezierCurveTo(301,194,347,8,322,-133),e.bezierCurveTo(304,-234,284,-259,251,-302),e.bezierCurveTo(191,-383,69,-373,15,-373),e.bezierCurveTo(-10,-373,-23,-393,-61,-390),e.bezierCurveTo(-93,-388,-107,-366,-141,-352),e.bezierCurveTo(-167,-337,-194,-345,-211,-330),e.bezierCurveTo(-229,-313,-236,-289,-254,-253),e.bezierCurveTo(-271,-218,-308,-152,-319,-94),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(245,224,173,0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="rgba(255,255,255,0",e.beginPath(),e.moveTo(-237,-255),e.bezierCurveTo(-224,-269,-198,-270,-175,-272),e.bezierCurveTo(-151,-274,-127,-268,-92,-279),e.bezierCurveTo(-58,-290,-44,-303,-31,-314),e.bezierCurveTo(-18,-325,-4,-339,30,-348),e.stroke(),e.beginPath(),e.moveTo(328,-14),e.bezierCurveTo(334,-136,269,-283,204,-320),e.bezierCurveTo(139,-357,94,-347,47,-339),e.bezierCurveTo(17,-332,-5,-304,-25,-291),e.bezierCurveTo(-46,-278,-71,-268,-86,-255),e.bezierCurveTo(-102,-242,-102,-227,-107,-212),e.bezierCurveTo(-112,-200,-115,-200,-128,-200),e.bezierCurveTo(-143,-201,-143,-202,-152,-212),e.bezierCurveTo(-162,-223,-156,-244,-169,-248),e.bezierCurveTo(-182,-251,-204,-246,-204,-246),e.bezierCurveTo(-259,-227,-321,-138,-321,-63),e.stroke(),e.beginPath(),e.moveTo(-207,-282),e.bezierCurveTo(-179,-279,-164,-280,-143,-292),e.moveTo(-207,-292),e.bezierCurveTo(-197,-289,-181,-290,-165,-295),e.moveTo(-201,-302),e.bezierCurveTo(-193,-299,-182,-302,-174,-305),e.moveTo(-96,-345),e.bezierCurveTo(-88,-351,-87,-352,-82,-363),e.moveTo(-92,-335),e.bezierCurveTo(-83,-341,-75,-349,-70,-359),e.moveTo(-92,-321),e.bezierCurveTo(-76,-330,-65,-345,-58,-359),e.moveTo(-87,-308),e.bezierCurveTo(-71,-317,-50,-339,-44,-354),e.moveTo(-87,-297),e.bezierCurveTo(-70,-308,-45,-327,-33,-348),e.moveTo(-82,-290),e.bezierCurveTo(-62,-301,-33,-324,-18,-348),e.stroke(),e.beginPath(),e.moveTo(-204,-246),e.bezierCurveTo(-189,-199,-146,-200,-123,-195),e.bezierCurveTo(-99,-189,-91,-152,-92,-120),e.bezierCurveTo(-92,-88,-100,-58,-92,-21),e.bezierCurveTo(-83,16,-55,40,-47,64),e.bezierCurveTo(-40,87,-53,99,-44,117),e.bezierCurveTo(-38,128,-38,135,-18,137),e.bezierCurveTo(1,140,2,131,7,120),e.bezierCurveTo(16,99,16,86,10,63),e.bezierCurveTo(4,40,-20,8,-27,-66),e.bezierCurveTo(-33,-129,-17,-167,-3,-223),e.bezierCurveTo(12,-278,58,-321,99,-345),e.setLineDash([10]),e.stroke(),e.beginPath(),e.moveTo(56,-315),e.bezierCurveTo(56,-315,68,-321,84,-308),e.bezierCurveTo(100,-296,126,-182,137,-158),e.bezierCurveTo(148,-135,143,-130,159,-130),e.bezierCurveTo(175,-130,183,-136,185,-162),e.bezierCurveTo(187,-188,169,-293,151,-340),e.setLineDash([10]),e.stroke(),e.beginPath(),e.moveTo(-165,230),e.lineTo(-44,117),e.moveTo(-63,356),e.lineTo(-1,138),e.setLineDash([30,10]),e.stroke()),this.isClicked},ED.Grommet=function(t,e){this.className="Grommet",this.type="Short term",this.savedParameterArray=["originX","originY","scaleX","scaleY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.Grommet.prototype=new ED.Doodle,ED.Grommet.prototype.constructor=ED.Grommet,ED.Grommet.superclass=ED.Doodle.prototype,ED.Grommet.prototype.setHandles=function(){},ED.Grommet.prototype.setPropertyDefaults=function(){this.parameterValidationArray.type={kind:"derived",type:"string",list:["Short term","Long term"],animate:!0}},ED.Grommet.prototype.setParameterDefaults=function(){this.originX=100,this.originY=100},ED.Grommet.prototype.draw=function(t){var e=this.drawing.context;ED.Grommet.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,40,0,2*Math.PI,!0),e.closePath(),e.lineWidth=32,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="white",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var i=this.transform.transformPoint(new ED.Point(0,0)),r=this.transform.transformPoint(new ED.Point(60,0)),a=i.x-this.drawing.canvas.width/2,o=i.y-this.drawing.canvas.height/2,n=this.scaleX*Math.sqrt(a*a+o*o),s=this.scaleX*(r.x-i.x);return this.arc=Math.atan(s/n),this.isClicked},ED.Grommet.prototype.description=function(){return"Grommet"},ED.Perforation=function(t,e){this.className="Perforation",this.margin=3e4,this.isMarginal=!1,this.safe=!0,this.savedParameterArray=["originX","originY","scaleX","scaleY","safe"],this.controlParameterArray={safe:"Safe"},ED.Doodle.call(this,t,e)},ED.Perforation.prototype=new ED.Doodle,ED.Perforation.prototype.constructor=ED.Perforation,ED.Perforation.superclass=ED.Doodle.prototype,ED.Perforation.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Perforation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-300,300),this.parameterValidationArray.originY.range.setMinAndMax(-300,300),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2),this.parameterValidationArray.isMarginal={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.safe={kind:"derived",type:"bool",display:!0}},ED.Perforation.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.75,this.setOriginWithDisplacements(-100,25)},ED.Perforation.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"originX":case"originY":this.originX*this.originX+this.originY*this.originY>this.margin?i.isMarginal=!0:i.isMarginal=!1}return i},ED.Perforation.prototype.draw=function(t){var e=this.drawing.context;ED.Perforation.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,120,0,2*Math.PI,!1),e.closePath(),e.lineWidth=3,e.fillStyle="rgba(255, 155, 110, 1)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(120,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Perforation.prototype.description=function(){var t="";return t=this.originX<=0?"Antero":"Postero",this.originY<=0?t+="superior":t+="inferior",t+=" perforation of eardrum"},ED.Perforation.prototype.snomedCode=function(){return this.isMarginal?39895008:40723007},ED.Perforation.prototype.diagnosticHierarchy=function(){return 0},ED.ACIOL=function(t,e){this.className="ACIOL",this.csOriginX=-140,this.savedParameterArray=["originX","originY","rotation","csOriginX"],ED.Doodle.call(this,t,e),this.scaleX=.8,this.scaleY=.8},ED.ACIOL.prototype=new ED.Doodle,ED.ACIOL.prototype.constructor=ED.ACIOL,ED.ACIOL.superclass=ED.Doodle.prototype,ED.ACIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ACIOL.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isUnique=!0,this.parameterValidationArray.originX.range.setMinAndMax(-200,200),this.parameterValidationArray.originY.range.setMinAndMax(-200,200)},ED.ACIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ACIOL.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,240,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,170,-210,160,-230),e.bezierCurveTo(150,-250,100,-280,50,-290),e.bezierCurveTo(0,-300,-220,-330,-230,-340),e.bezierCurveTo(-250,-360,-220,-420,-200,-430),e.bezierCurveTo(-180,-440,-180,-440,-150,-450),e.bezierCurveTo(-120,-460,-130,-430,-120,-420),e.bezierCurveTo(-110,-410,110,-410,120,-420),e.bezierCurveTo(130,-430,120,-460,150,-450),e.bezierCurveTo(180,-440,180,-440,200,-430),e.bezierCurveTo(220,-420,180,-400,150,-390),e.bezierCurveTo(120,-380,-120,-380,-150,-390),e.bezierCurveTo(-180,-400,-190,-370,-170,-360),e.bezierCurveTo(-150,-350,20,-330,70,-320),e.bezierCurveTo(120,-310,190,-280,210,-250),e.bezierCurveTo(230,-220,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-170,210,-160,230),e.bezierCurveTo(-150,250,-100,280,-50,290),e.bezierCurveTo(0,300,220,330,230,340),e.bezierCurveTo(250,360,220,420,200,430),e.bezierCurveTo(180,440,180,440,150,450),e.bezierCurveTo(120,460,130,430,120,420),e.bezierCurveTo(110,410,-110,410,-120,420),e.bezierCurveTo(-130,430,-120,460,-150,450),e.bezierCurveTo(-180,440,-180,440,-200,430),e.bezierCurveTo(-220,420,-180,400,-150,390),e.bezierCurveTo(-120,380,120,380,150,390),e.bezierCurveTo(180,400,190,370,170,360),e.bezierCurveTo(150,350,-20,330,-70,320),e.bezierCurveTo(-120,310,-190,280,-210,250),e.bezierCurveTo(-230,220,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(240,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ACIOL.prototype.description=function(){var t="Anterior chamber IOL",e="";return this.originY<-40&&(e.length>0&&(e+=" and"),e+=" superiorly"),this.originY>40&&(e.length>0&&(e+=" and"),e+=" inferiorly"),this.originX<-40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),e.length>0&&(t+=" displaced"+e),t},ED.ACIOLCrossSection=function(t,e){this.className="ACIOLCrossSection",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e),this.linkedDoodleParameters={ACIOL:{source:["originY"],store:[["originX","csOriginX"]]}}},ED.ACIOLCrossSection.prototype=new ED.Doodle,ED.ACIOLCrossSection.prototype.constructor=ED.ACIOLCrossSection,ED.ACIOLCrossSection.superclass=ED.Doodle.prototype,ED.ACIOLCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.inFrontOfClassArray=["HypopyonCrossSection","HyphaemaCrossSection"],this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-220,-100),this.parameterValidationArray.originY.range.setMinAndMax(-140,140)},ED.ACIOLCrossSection.prototype.setParameterDefaults=function(){this.originX=-140},ED.ACIOLCrossSection.prototype.draw=function(t){var e=this.drawing.context;return ED.ACIOLCrossSection.superclass.draw.call(this,t),e.beginPath(),e.ellipse(100,0,160,20,.5*Math.PI,0,2*Math.PI),e.lineWidth=5,e.fillStyle="rgba(255, 255, 255, 0.75)",e.strokeStyle="#898989",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(10-this.originX,-310-this.originY,10,0*Math.PI,1*Math.PI,!1),e.moveTo(5-this.originX,-310-this.originY),e.bezierCurveTo(80-this.originX,-300-this.originY,70,-220,100,-160),e.moveTo(40-this.originX,300-this.originY),e.arc(10-this.originX,310-this.originY,10,0,1*Math.PI,!0),e.moveTo(5-this.originX,310-this.originY),e.bezierCurveTo(80-this.originX,300-this.originY,70,220,100,160),e.strokeStyle="#898989",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ACMaintainer=function(t,e){this.className="ACMaintainer",this.limbus=-400,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.ACMaintainer.prototype=new ED.Doodle,ED.ACMaintainer.prototype.constructor=ED.ACMaintainer,ED.ACMaintainer.superclass=ED.Doodle.prototype,ED.ACMaintainer.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ACMaintainer.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90);var t=this.drawing.lastDoodleOfClass("SidePort");t&&(this.rotation=t.rotation)},ED.ACMaintainer.prototype.draw=function(t){var e=this.drawing.context;return ED.ACMaintainer.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.limbus-60,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-20,this.limbus+60),e.lineTo(20,this.limbus+60),e.lineTo(20,this.limbus+160),e.lineTo(-20,this.limbus+200),e.lineTo(-20,this.limbus+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.limbus,60,80),e.fillStyle="rgba(120, 120, 120, 0.75)",e.fill(),e.beginPath(),e.moveTo(0,this.limbus),e.bezierCurveTo(0,this.limbus-50,50,this.limbus-100,100,this.limbus-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()),this.isClicked},ED.ACMaintainer.prototype.groupDescription=function(){return"Chandelier at "},ED.ACMaintainer.prototype.description=function(){return this.clockHour()+" o'clock"},ED.AdenoviralKeratitis=function(t,e){this.className="AdenoviralKeratitis",this.h=250,this.savedParameterArray=["apexX","apexY","scaleX","scaleY","originX","originY","h"],ED.Doodle.call(this,t,e)},ED.AdenoviralKeratitis.prototype=new ED.Doodle,ED.AdenoviralKeratitis.prototype.constructor=ED.AdenoviralKeratitis,ED.AdenoviralKeratitis.superclass=ED.Doodle.prototype,ED.AdenoviralKeratitis.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AdenoviralKeratitis.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,40),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5),this.parameterValidationArray.h={kind:"derived",type:"int",animate:!1}},ED.AdenoviralKeratitis.prototype.setParameterDefaults=function(){this.apexY=-5},ED.AdenoviralKeratitis.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"scaleX":i.h=Math.round(250*e);break;case"h":i.h=e}return i},ED.AdenoviralKeratitis.prototype.draw=function(t){var e=this.drawing.context;ED.AdenoviralKeratitis.superclass.draw.call(this,t),e.beginPath();var i=250;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r="rgba(230, 230, 230, 0.8)";e.shadowBlur=3,e.shadowColor="black";for(var a=(this.apexX+20)/20*8/this.scaleX,o=new ED.Point(0,0),n=2+Math.abs(Math.floor(this.apexY/2)),s=0;s<n;s++)o.setWithPolars(i*ED.randomArray[s],2*Math.PI*ED.randomArray[s+100]),this.drawSpot(e,o.x,o.y,a,r);this.drawSpot(e,0,i,a,r),this.drawSpot(e,0,-i,a,r),this.drawSpot(e,i,0,a,r),this.drawSpot(e,-i,0,a,r),e.shadowColor="rgba(0, 0, 0, 0)"}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(175,-175)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AdenoviralKeratitis.prototype.description=function(){return"Adenoviral keratitis"},ED.AdenoviralKeratitis.prototype.snomedCode=function(){"use strict";return 314559002},ED.AdenoviralKeratitisCrossSection=function(t,e){this.className="AdenoviralKeratitisCrossSection",this.h=250,this.savedParameterArray=["originX","originY","h"],this.controlParameterArray={},ED.Doodle.call(this,t,e)},ED.AdenoviralKeratitisCrossSection.prototype=new ED.Doodle,ED.AdenoviralKeratitisCrossSection.prototype.constructor=ED.AdenoviralKeratitisCrossSection,ED.AdenoviralKeratitisCrossSection.superclass=ED.Doodle.prototype,ED.AdenoviralKeratitisCrossSection.prototype.setHandles=function(){},ED.AdenoviralKeratitisCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isFilled=!1,this.parameterValidationArray.originX.range.setMinAndMax(50,50),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.h={kind:"other",type:"int",range:[0,1080],animate:!0}},ED.AdenoviralKeratitisCrossSection.prototype.setParameterDefaults=function(){this.originX=50},ED.AdenoviralKeratitisCrossSection.prototype.drawOval=function(t,e,i,r,a){t.save(),t.beginPath(),t.ellipse(e,i,.5*r,r,a,0,2*Math.PI,!0),t.fillStyle="rgba(215, 215, 215, 0.8)",t.strokeStyle="rgba(215, 215, 215, 0.8)",t.shadowBlur=2,t.shadowColor="black",t.lineWidth=0,t.fill(),t.stroke(),t.restore()},ED.AdenoviralKeratitisCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection");i.pachymetry;ED.AdenoviralKeratitisCrossSection.superclass.draw.call(this,t),e.beginPath();var r=this.h,a=this.originY-r,o=this.originY+r,n=(a+380)/760;n<0&&(n=0);var s=(o+380)/760;if(s>1&&(s=1),n<.5){var l=new Object,h=2*n,d=s<.5?2*s:1;if(i&&"Keratoconus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(i.apexX,i.apexY-100-this.originY),l.EP=new ED.Point(i.apexX,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-380,-100-this.originY),l.EP=new ED.Point(-380,100-this.originY)):(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-320,-160-this.originY),l.EP=new ED.Point(-320,0-this.originY)),h>0){(f=new ED.Point(0,0)).y=(1-h)*(1-h)*(1-h)*l.SP.y+3*(1-h)*(1-h)*h*l.CP1.y+3*(1-h)*h*h*l.CP2.y+h*h*h*l.EP.y,f.x=(1-h)*(1-h)*(1-h)*l.SP.x+3*(1-h)*(1-h)*h*l.CP1.x+3*(1-h)*h*h*l.CP2.x+h*h*h*l.EP.x,(D=new ED.Point(0,0)).x=l.CP1.x+h*(l.CP2.x-l.CP1.x),D.y=l.CP1.y+h*(l.CP2.y-l.CP1.y);var c=new ED.Point(0,0);c.x=l.CP2.x+h*(l.EP.x-l.CP2.x),c.y=l.CP2.y+h*(l.EP.y-l.CP2.y);var p=new ED.Point(0,0);p.x=D.x+h*(c.x-D.x),p.y=D.y+h*(c.y-D.y),l.SP=f,l.CP1=p,l.CP2=c}if(d<1){var y=new ED.Point(0,0);y.y=(1-d)*(1-d)*(1-d)*l.SP.y+3*(1-d)*(1-d)*d*l.CP1.y+3*(1-d)*d*d*l.CP2.y+d*d*d*l.EP.y,y.x=(1-d)*(1-d)*(1-d)*l.SP.x+3*(1-d)*(1-d)*d*l.CP1.x+3*(1-d)*d*d*l.CP2.x+d*d*d*l.EP.x;var D,u=new ED.Point(0,0);u.x=l.SP.x+d*(l.CP1.x-l.SP.x),u.y=l.SP.y+d*(l.CP1.y-l.SP.y),(D=new ED.Point(0,0)).x=l.CP1.x+d*(l.CP2.x-l.CP1.x),D.y=l.CP1.y+d*(l.CP2.y-l.CP1.y);var g=new ED.Point(0,0);g.x=u.x+d*(D.x-u.x),g.y=u.y+d*(D.y-u.y),l.CP1=u,l.CP2=g,l.EP=y}}if(s>.5){var P=new Object,E=n>.5?2*(n-.5):0,m=2*(s-.5);if(i&&"Keratoconus"==i.shape?(P.SP=new ED.Point(i.apexX,i.apexY-this.originY),P.CP1=new ED.Point(i.apexX,i.apexY+100-this.originY),P.CP2=new ED.Point(-240,260-this.originY),P.EP=new ED.Point(-120,380-this.originY)):i&&"Keratoglobus"==i.shape?(P.SP=new ED.Point(-380,100-this.originY),P.CP1=new ED.Point(-380,200-this.originY),P.CP2=new ED.Point(-240,360-this.originY),P.EP=new ED.Point(-120,380-this.originY)):(P.SP=new ED.Point(-320,-0-this.originY),P.CP1=new ED.Point(-320,160-this.originY),P.CP2=new ED.Point(-240,260-this.originY),P.EP=new ED.Point(-120,380-this.originY)),E>0){var f;(f=new ED.Point(0,0)).y=(1-E)*(1-E)*(1-E)*P.SP.y+3*(1-E)*(1-E)*E*P.CP1.y+3*(1-E)*E*E*P.CP2.y+E*E*E*P.EP.y,f.x=(1-E)*(1-E)*(1-E)*P.SP.x+3*(1-E)*(1-E)*E*P.CP1.x+3*(1-E)*E*E*P.CP2.x+E*E*E*P.EP.x,(v=new ED.Point(0,0)).x=P.CP1.x+E*(P.CP2.x-P.CP1.x),v.y=P.CP1.y+E*(P.CP2.y-P.CP1.y);var w=new ED.Point(0,0);w.x=P.CP2.x+E*(P.EP.x-P.CP2.x),w.y=P.CP2.y+E*(P.EP.y-P.CP2.y);var x=new ED.Point(0,0);x.x=v.x+E*(w.x-v.x),x.y=v.y+E*(w.y-v.y),P.SP=f,P.CP1=x,P.CP2=w}if(m<1){var b=new ED.Point(0,0);b.y=(1-m)*(1-m)*(1-m)*P.SP.y+3*(1-m)*(1-m)*m*P.CP1.y+3*(1-m)*m*m*P.CP2.y+m*m*m*P.EP.y,b.x=(1-m)*(1-m)*(1-m)*P.SP.x+3*(1-m)*(1-m)*m*P.CP1.x+3*(1-m)*m*m*P.CP2.x+m*m*m*P.EP.x;var v,A=new ED.Point(0,0);A.x=P.SP.x+m*(P.CP1.x-P.SP.x),A.y=P.SP.y+m*(P.CP1.y-P.SP.y),(v=new ED.Point(0,0)).x=P.CP1.x+m*(P.CP2.x-P.CP1.x),v.y=P.CP1.y+m*(P.CP2.y-P.CP1.y);var C=new ED.Point(0,0);C.x=A.x+m*(v.x-A.x),C.y=A.y+m*(v.y-A.y),P.CP1=A,P.CP2=C,P.EP=b}}if(P&&(e.moveTo(P.SP.x,P.SP.y),e.bezierCurveTo(P.CP1.x,P.CP1.y,P.CP2.x,P.CP2.y,P.EP.x,P.EP.y)),l&&(e.moveTo(l.SP.x,l.SP.y),e.bezierCurveTo(l.CP1.x,l.CP1.y,l.CP2.x,l.CP2.y,l.EP.x,l.EP.y)),e.closePath(),e.lineWidth=0,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var M,S,T,k=(this.apexX+20)/20*8/this.scaleX,Y=4+Math.abs(Math.floor(this.apexY/8)),I=new ED.Point(0,0),H=(new ED.Point(0,0),0);H<Y;H++)S=ED.randomArray[H+100],M=-r+2*this.h*S+this.originY>0?P:l,S=S<=.5?2*S:2*(S-.5),I.x=.5*k+(1-S)*(1-S)*(1-S)*M.SP.x+3*(1-S)*(1-S)*S*M.CP1.x+3*(1-S)*S*S*M.CP2.x+S*S*S*M.EP.x,I.y=(1-S)*(1-S)*(1-S)*M.SP.y+3*(1-S)*(1-S)*S*M.CP1.y+3*(1-S)*S*S*M.CP2.y+S*S*S*M.EP.y,T=I.direction()+.5*Math.PI,this.drawOval(e,I.x,I.y,k,T);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeEast=function(t,e){this.className="AngleGradeEast",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=306,this.riro=270,this.riri=230,this.rpu=100,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY","colour"],this.controlParameterArray={colour:"Colour"},ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=Math.PI/2},ED.AngleGradeEast.prototype=new ED.Doodle,ED.AngleGradeEast.prototype.constructor=ED.AngleGradeEast,ED.AngleGradeEast.superclass=ED.Doodle.prototype,ED.AngleGradeEast.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeEast.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AngleGradeEast.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeEast.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":var r="4";-e>=this.riro&&(r="3"),-e>=this.rcbo&&(r="2"),-e>=this.rtmo&&(r="1"),-e>=this.rsli&&(r="0"),i.grade=r,i.seen=-e>=this.rsli?"No":"Yes";break;case"grade":r="";switch(e){case"0":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":r=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":r=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-306;break;case"3":r=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-270;break;case"4":r=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}i.apexY=r;break;case"seen":r="";switch(e){case"No":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"Yes":r=-this.apexY<this.rsli?this.apexY:-this.riri}i.apexY=r}return i},ED.AngleGradeEast.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeEast.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i;switch(e.beginPath(),e.arc(0,0,-this.apexY,r,a,!0),e.arc(0,0,this.rpu,a,r,!1),e.closePath(),this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}return e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeNorth=function(t,e){this.className="AngleGradeNorth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=306,this.riro=270,this.riri=230,this.rpu=100,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY","colour"],this.controlParameterArray={colour:"Colour"},ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=0},ED.AngleGradeNorth.prototype=new ED.Doodle,ED.AngleGradeNorth.prototype.constructor=ED.AngleGradeNorth,ED.AngleGradeNorth.superclass=ED.Doodle.prototype,ED.AngleGradeNorth.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeNorth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AngleGradeNorth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeNorth.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":var r="4";-e>=this.riro&&(r="3"),-e>=this.rcbo&&(r="2"),-e>=this.rtmo&&(r="1"),-e>=this.rsli&&(r="0"),i.grade=r,i.seen=-e>=this.rsli?"No":"Yes";break;case"grade":r="";switch(e){case"0":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":r=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":r=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-306;break;case"3":r=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-270;break;case"4":r=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}i.apexY=r;break;case"seen":r="";switch(e){case"No":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"Yes":r=-this.apexY<this.rsli?this.apexY:-this.riri}i.apexY=r}return i},ED.AngleGradeNorth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeNorth.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i;switch(e.beginPath(),e.arc(0,0,-this.apexY,r,a,!0),e.arc(0,0,this.rpu,a,r,!1),e.closePath(),this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}return e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeSouth=function(t,e){this.className="AngleGradeSouth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=306,this.riro=270,this.riri=230,this.rpu=100,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY","colour"],this.controlParameterArray={colour:"Colour"},ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=Math.PI},ED.AngleGradeSouth.prototype=new ED.Doodle,ED.AngleGradeSouth.prototype.constructor=ED.AngleGradeSouth,ED.AngleGradeSouth.superclass=ED.Doodle.prototype,ED.AngleGradeSouth.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeSouth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AngleGradeSouth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeSouth.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":var r="4";-e>=this.riro&&(r="3"),-e>=this.rcbo&&(r="2"),-e>=this.rtmo&&(r="1"),-e>=this.rsli&&(r="0"),i.grade=r,i.seen=-e>=this.rsli?"No":"Yes";break;case"grade":r="";switch(e){case"0":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":r=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":r=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-306;break;case"3":r=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-270;break;case"4":r=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}i.apexY=r;break;case"seen":r="";switch(e){case"No":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"Yes":r=-this.apexY<this.rsli?this.apexY:-this.riri}i.apexY=r}return i},ED.AngleGradeSouth.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeSouth.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i;switch(e.beginPath(),e.arc(0,0,-this.apexY,r,a,!0),e.arc(0,0,this.rpu,a,r,!1),e.closePath(),this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}return e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleGradeWest=function(t,e){this.className="AngleGradeWest",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=306,this.riro=270,this.riri=230,this.rpu=100,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY","colour"],this.controlParameterArray={colour:"Colour"},ED.Doodle.call(this,t,e),this.arc=90*Math.PI/180,this.rotation=3*Math.PI/2},ED.AngleGradeWest.prototype=new ED.Doodle,ED.AngleGradeWest.prototype.constructor=ED.AngleGradeWest,ED.AngleGradeWest.superclass=ED.Doodle.prototype,ED.AngleGradeWest.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeWest.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AngleGradeWest.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeWest.prototype.dependentParameterValues=function(t,e){var i=new Array,r="4";switch(t){case"apexY":-e>=this.riro&&(r="3"),-e>=this.rcbo&&(r="2"),-e>=this.rtmo&&(r="1"),-e>=this.rsli&&(r="0"),i.grade=r,i.seen=-e>=this.rsli?"No":"Yes";break;case"grade":switch(r="",e){case"0":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":r=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":r=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-306;break;case"3":r=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-270;break;case"4":r=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}i.apexY=r;break;case"seen":switch(r="",e){case"No":r=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"Yes":r=-this.apexY<this.rsli?this.apexY:-this.riri}i.apexY=r}return i},ED.AngleGradeWest.prototype.draw=function(t){var e=this.drawing.context;ED.AngleGradeWest.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i;switch(e.beginPath(),e.arc(0,0,-this.apexY,r,a,!0),e.arc(0,0,this.rpu,a,r,!1),e.closePath(),this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}return e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV=function(t,e){this.className="AngleNV",this.rtmo=404,this.rtmi=304,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.AngleNV.prototype=new ED.Doodle,ED.AngleNV.prototype.constructor=ED.AngleNV,ED.AngleNV.superclass=ED.Doodle.prototype,ED.AngleNV.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleNV.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleNV.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleNV.prototype.draw=function(t){var e=this.drawing.context;ED.AngleNV.superclass.draw.call(this,t);var i=this.rtmo;this.rir=this.rtmi;var r=this.rir+(i-this.rir)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=r*Math.sin(a),l=-r*Math.cos(a),h=-r*Math.sin(a),d=l;e.beginPath(),e.arc(0,0,this.rir,o,n,!0),e.arc(0,0,i,n,o,!1),e.closePath();var c=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return e.fillStyle=c,e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(s,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleNV.prototype.groupDescription=function(){return"Angle new vessels over "+this.drawing.totalDegreesExtent(this.className).toString()+" degrees"},ED.AngleRecession=function(t,e){this.className="AngleRecession",this.riri=176,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.AngleRecession.prototype=new ED.Doodle,ED.AngleRecession.prototype.constructor=ED.AngleRecession,ED.AngleRecession.superclass=ED.Doodle.prototype,ED.AngleRecession.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleRecession.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleRecession.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleRecession.prototype.draw=function(t){var e=this.drawing.context;ED.AngleRecession.superclass.draw.call(this,t);var i=this.riri-30;this.rir=this.riri;this.rir,this.rir;var r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=-Math.PI/2+r-Math.PI/24,s=-Math.PI/2-r+Math.PI/24,l=this.rir*Math.sin(r),h=-this.rir*Math.cos(r),d=-this.rir*Math.sin(r),c=h;return e.beginPath(),e.arc(0,0,this.rir,a,o,!0),e.arc(0,0,i,s,n,!1),e.closePath(),e.fillStyle="rgba(255, 255, 200, 1.0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AngleRecession.prototype.groupDescription=function(){return"Angle recession over "+this.drawing.totalDegreesExtent(this.className).toString()+" degrees"},ED.AnteriorCapsulotomy=function(t,e){this.className="AnteriorCapsulotomy",ED.Doodle.call(this,t,e)},ED.AnteriorCapsulotomy.prototype=new ED.Doodle,ED.AnteriorCapsulotomy.prototype.constructor=ED.AnteriorCapsulotomy,ED.AnteriorCapsulotomy.superclass=ED.Doodle.prototype,ED.AnteriorCapsulotomy.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500)},ED.AnteriorCapsulotomy.prototype.setParameterDefaults=function(){},ED.AnteriorCapsulotomy.prototype.draw=function(t){var e=this.drawing.context;ED.AnteriorCapsulotomy.superclass.draw.call(this,t);if(e.beginPath(),e.arc(0,0,240,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,180,0,2*Math.PI,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntPVR=function(t,e){this.className="AntPVR",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.AntPVR.prototype=new ED.Doodle,ED.AntPVR.prototype.constructor=ED.AntPVR,ED.AntPVR.superclass=ED.Doodle.prototype,ED.AntPVR.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntPVR.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,4),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,4),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.AntPVR.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-400,this.setRotationWithDisplacements(180,120)},ED.AntPVR.prototype.draw=function(t){var e=this.drawing.context;ED.AntPVR.superclass.draw.call(this,t);var i=-this.apexY,r=i+(476-i)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=r*Math.sin(a),l=-r*Math.cos(a),h=-r*Math.sin(a),d=l;e.beginPath(),e.arc(0,0,476,o,n,!0),e.arc(0,0,i,n,o,!1),e.closePath(),e.lineWidth=4;var c=e.createPattern(this.drawing.imageArray.AntPVRPattern,"repeat");return e.fillStyle=c,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntPVR.prototype.description=function(){return"PVR (anterior) "+this.clockHourExtent("o'clock")},ED.AntPVR.prototype.snomedCode=function(){return 232017001},ED.AntPVR.prototype.diagnosticHierarchy=function(){return 0},ED.AntSeg=function(t,e){this.className="AntSeg",this.pupilSize="Large",this.pxe=!1,this.coloboma=!1,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.ectropion=!1,this.cornealSize="Not Checked",this.cells="Not Checked",this.flare="Not Checked",this.csApexX=0,this.savedParameterArray=["pupilSize","apexY","rotation","pxe","coloboma","colour","ectropion","cornealSize","cells","flare","csApexX"],this.controlParameterArray={pupilSize:"Pupil size",pxe:"Pseudoexfoliation",coloboma:"Coloboma",colour:"Colour",ectropion:"Ectropion uveae",cornealSize:"Corneal size",cells:"Cells",flare:"Flare"},ED.Doodle.call(this,t,e)},ED.AntSeg.prototype=new ED.Doodle,ED.AntSeg.prototype.constructor=ED.AntSeg,ED.AntSeg.superclass=ED.Doodle.prototype,ED.AntSeg.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSeg.prototype.setPropertyDefaults=function(){this.version=1.1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-300,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0},this.parameterValidationArray.pxe={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.coloboma={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1},this.parameterValidationArray.ectropion={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.cornealSize={kind:"other",type:"string",list:["Not Checked","Micro","Normal","Macro"],animate:!1},this.parameterValidationArray.cells={kind:"other",type:"string",list:["Not Checked","0 (<1)","0.5+ (1-5)","1+ (6-15)","2+ (16-25)","3+ (26-50)","4+ (>50)"],animate:!1},this.parameterValidationArray.flare={kind:"other",type:"string",list:["Not Checked","0 (None)","1+ (Faint)","2+ (Moderate)","3+ (Marked)","4+ (Intense)"],animate:!1}},ED.AntSeg.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.setParameterFromString("pxe","false"),this.setParameterFromString("cornealSize","Not Checked")},ED.AntSeg.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"apexY":i.pupilSize=e<-200?"Large":e<-100?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":this.apexY<-200?this.apexY:i.apexY=-260;break;case"Medium":this.apexY>=-200&&this.apexY<-100?this.apexY:i.apexY=-200;break;case"Small":this.apexY>=-100?this.apexY:i.apexY=-100}break;case"coloboma":this.isRotatable="true"===e,this.rotation="true"===e?this.rotation:0}return i},ED.AntSeg.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.AntSeg.superclass.draw.call(this,t);var n=-this.apexY,s=2*Math.PI;switch(o.beginPath(),o.arc(0,0,380,0,s,!0),this.coloboma?(e=Math.PI/3*280/n,i=Math.PI/6,r=20,new ED.Point(0,0).setWithPolars(n,Math.PI+e/2),(a=new ED.Point(0,0)).setWithPolars(380-r,Math.PI+i/2),o.moveTo(-a.x,a.y),o.arc(0,0,380-r,Math.PI/2-i/2,Math.PI/2+i/2,!1),o.arc(0,0,n,Math.PI/2+e/2,Math.PI/2-e/2,!1),o.lineTo(-a.x,a.y)):(o.moveTo(n,0),o.arc(0,0,n,s,0,!1)),o.lineWidth=4,o.strokeStyle="gray",this.colour){case"Blue":o.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":o.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":o.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":o.fillStyle="rgba(114, 172, 62, 0.5)"}if(this.drawBoundary(t),this.drawFunctionMode===ED.drawFunctionMode.Draw){if(this.pxe){o.lineWidth=8,o.strokeStyle="darkgray";var l,h=.8*n,d=1.05*n,c=2*Math.PI/36;for(l=0;l<36;l++)o.beginPath(),o.arc(0,0,h,l*c,l*c+c/2,!1),o.stroke(),o.beginPath(),o.arc(0,0,d,l*c,l*c+c/2,!1),o.stroke()}this.ectropion&&(o.beginPath(),this.coloboma?o.arc(0,0,n,Math.PI/2-e/2,Math.PI/2+e/2,!0):o.arc(0,0,n+16,0,s,!0),o.lineWidth=32,o.lineCap="round",o.strokeStyle="brown",o.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSeg.prototype.description=function(){var t="",e=Math.round(.03*-this.apexY);return t+=this.pupilSize.toLowerCase()+" pupil (diameter: "+e+"mm)","not checked"!==this.cornealSize.toLowerCase()&&(t+=", corneal size : "+this.cornealSize.toLowerCase()),this.coloboma&&(t+="coloboma at "+this.clockHour(6)+" o'clock, "),this.ectropion&&(t+="ectropion uveae, "),this.pxe&&(t+="pseudoexfoliation, "),this.cells&&"Not Checked"!==this.cells&&(t+="cells: "+this.cells+", "),this.flare&&"Not Checked"!==this.flare&&(t+="flare: "+this.flare+", "),0===t.length&&1===this.drawing.doodleArray.length&&(t="No abnormality"),t=(t=t.replace(/, +$/,"")).charAt(0).toUpperCase()+t.slice(1)},ED.AntSeg.prototype.snomedCodes=function(){return snomedCodes=[],this.pxe&&snomedCodes.push([44219007,3]),snomedCodes},ED.AntSegAngleMarks=function(t,e){this.className="AntSegAngleMarks",this.axis=180,this.flatK=999.9,this.steepK=999.9,this.deltaK=0,this.savedParameterArray=["axis","flatK","steepK","deltaK"],ED.Doodle.call(this,t,e)},ED.AntSegAngleMarks.prototype=new ED.Doodle,ED.AntSegAngleMarks.prototype.constructor=ED.AntSegAngleMarks,ED.AntSegAngleMarks.superclass=ED.Doodle.prototype,ED.AntSegAngleMarks.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0},this.parameterValidationArray.flatK={kind:"derived",type:"float",range:new ED.Range(0,1e3),precision:2,animate:!0},this.parameterValidationArray.steepK={kind:"derived",type:"float",range:new ED.Range(0,1e3),precision:2,animate:!0}},ED.AntSegAngleMarks.prototype.setParameterDefaults=function(){},ED.AntSegAngleMarks.prototype.dependentParameterValues=function(t,e){},ED.AntSegAngleMarks.prototype.draw=function(t){var e=499,i=this.drawing.context;if(ccc=i,ED.AntSegAngleMarks.superclass.draw.call(this,t),i.moveTo(-e,-e),i.lineTo(-e,e),i.lineTo(e,e),i.lineTo(e,-e),i.lineTo(-e,-e),i.fillStyle="rgba(255, 255, 255, 0)",i.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode===ED.drawFunctionMode.Draw){i.beginPath(),i.font="36px Arial",i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.lineWidth=3,i.strokeStyle="black";for(var r=400,a=25,o=new ED.Point(0,0),n=new ED.Point(0,0),s=new ED.Point(0,0),l=0;l<8;l++){var h=2*Math.PI/8*l,d=180*h/Math.PI;o.setWithPolars(r,2*Math.PI-h+.5*Math.PI),n.setWithPolars(425,2*Math.PI-h+.5*Math.PI),s.setWithPolars(462.5,2*Math.PI-h+.5*Math.PI),i.moveTo(o.x,o.y),i.lineTo(n.x,n.y),i.fillText(d+"",s.x,s.y)}i.stroke(),i.beginPath(),i.fillStyle=this.drawing.eye==ED.eye.Right?"green":"red";var c=this.drawing.eye==ED.eye.Right?1:-1;i.moveTo(300*c,-500),i.lineTo(500*c,-500),i.lineTo(500*c,-300),i.fill(),i.font="84px Arial",i.lineWidth=3,i.strokeStyle=i.fillStyle;var p=this.drawing.eye==ED.eye.Right?"R":"L";i.fillText(p,-445*c,-440),i.font="56px Arial",i.fillStyle="white",i.textAlign="center",i.textBaseline="middle",i.lineWidth=3,i.strokeStyle="white",i.fillText("SN",440*c,-440);var y=this.axis/180*Math.PI;i.beginPath(),i.strokeStyle="rgb(242, 72, 72)",i.lineWidth=8,i.save(),i.rotate(-y);for(var D=Math.round(16.8),u=0;u<D;u++)i.moveTo(u*a*2-420,0),i.lineTo(u*a*2-420+a,0);i.stroke(),i.restore(),i.save(),i.beginPath();var g=new ED.Point(0,0);g.setWithPolars(460,2*Math.PI-y+.5*Math.PI),i.fillStyle="#e4edf5",i.strokeStyle="black",i.rect(g.x-50,g.y-25,100,50),i.stroke(),i.fill(),i.font="bold 40px Arial",i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.lineWidth=3,i.strokeStyle="black",i.fillText(this.axis+"",g.x,g.y),i.restore(),i.beginPath(),i.moveTo(-495*c,480),i.lineTo(-480*c,480),i.moveTo(-475*c,480),i.lineTo(-460*c,480),i.moveTo(-455*c,480),i.lineTo(-440*c,480),i.stroke(),i.font="italic 36px Arial",i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.lineWidth=3,i.strokeStyle="black",i.fillText("Steep axis",-350*c,480),999.9!==this.flatK&&999.9!==this.steepK&&(this.calculateDeltaK(),i.font="bold 44px Arial",i.fillText(" "+this.deltaK+"D",-400*c,430))}return this.isClicked},ED.AntSegAngleMarks.prototype.calculateDeltaK=function(t){this.deltaK=(this.steepK-this.flatK).toFixed(2)},ED.AntSegCrossSection=function(t,e){this.className="AntSegCrossSection",this.pupilSize="Large",this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.savedParameterArray=["apexY","apexX","colour","c"],ED.Doodle.call(this,t,e),this.linkedDoodleParameters={AntSeg:{source:["apexY","colour"],store:[["apexX","csApexX"]]}},this.originX=44},ED.AntSegCrossSection.prototype=new ED.Doodle,ED.AntSegCrossSection.prototype.constructor=ED.AntSegCrossSection,ED.AntSegCrossSection.superclass=ED.Doodle.prototype,ED.AntSegCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSegCrossSection.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0},this.parameterValidationArray.c={kind:"other",type:"int",animate:!1},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AntSegCrossSection.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.setParameterFromString("c","1"),this.apexX=24},ED.AntSegCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":var r=this.drawing.lastDoodleOfClass("LensCrossSection");r||(r=this.drawing.lastDoodleOfClass("PCIOLCrossSection")),r||(r=this.drawing.lastDoodleOfClass("ToricPCIOLCrossSection"));var a="LensCrossSection"==r.className?32-72/220*(this.apexY+280)+r.originX-44:"PCIOLCrossSection"==r.className||"ToricPCIOLCrossSection"==r.className?r.originX-21:25;if(this.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(this.apexY+280),a),this.drawing.isActive)o=this.parameterValidationArray.apexX.range.constrain(this.apexX);else var o=this.parameterValidationArray.apexX.range.max;this.setSimpleParameter("apexX",o),i.pupilSize=e<-200?"Large":e<-100?"Medium":"Small";break;case"pupilSize":switch(e){case"Large":i.apexY=-260;break;case"Medium":i.apexY=-200;break;case"Small":i.apexY=-100}}return i},ED.AntSegCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.AntSegCrossSection.superclass.draw.call(this,t);var i=this.apexX;e.beginPath(),e.moveTo(60,480),e.lineTo(140,480),e.lineTo(140,380),e.bezierCurveTo(120,340,120,340,100,380),e.bezierCurveTo(80,340,80,340,60,380);var r=.15*Math.abs(i);if(e.bezierCurveTo(40,460,i+60+r,-this.apexY,i,-this.apexY),e.bezierCurveTo(i-60-r,-this.apexY,-21,317,0,380),e.moveTo(60,-480),e.lineTo(140,-480),e.lineTo(140,-380),e.bezierCurveTo(120,-340,120,-340,100,-380),e.bezierCurveTo(80,-340,80,-340,60,-380),e.bezierCurveTo(40,-460,i+60+r,this.apexY,i,this.apexY),e.bezierCurveTo(i-60-r,this.apexY,-21,-317,0,-380),e.closePath(),e.lineWidth=0,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.lineWidth=4,e.strokeStyle="gray",this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}e.beginPath(),e.moveTo(70,380),e.lineTo(55,380),e.bezierCurveTo(40,460,i+60+r,-this.apexY,i,-this.apexY),e.bezierCurveTo(i-60-r,-this.apexY,-21,317,0,380),e.lineTo(55,480),e.fill(),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(70,-380),e.lineTo(55,-380),e.bezierCurveTo(40,-460,i+60+r,this.apexY,i,this.apexY),e.bezierCurveTo(i-60-r,this.apexY,-21,-317,0,-380),e.lineTo(55,-480),e.fill(),e.stroke(),e.closePath(),e.fillStyle="rgba(255, 160, 40, 1)",e.beginPath(),e.moveTo(55,-480),e.lineTo(140,-480),e.lineTo(140,-380),e.bezierCurveTo(120,-340,120,-340,100,-380),e.bezierCurveTo(80,-340,80,-340,55,-380),e.fill(),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(55,480),e.lineTo(140,480),e.lineTo(140,380),e.bezierCurveTo(120,340,120,340,100,380),e.bezierCurveTo(80,340,80,340,55,380),e.fill(),e.stroke(),e.closePath()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSynech=function(t,e){this.className="AntSynech",this.rtmi=304,this.riri=176,this.colour="undefined"!=typeof default_iris_colour?default_iris_colour:"Blue",this.savedParameterArray=["arc","rotation","apexY","colour"],this.controlParameterArray={colour:"Colour"},ED.Doodle.call(this,t,e)},ED.AntSynech.prototype=new ED.Doodle,ED.AntSynech.prototype.constructor=ED.AntSynech,ED.AntSynech.superclass=ED.Doodle.prototype,ED.AntSynech.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSynech.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-480,-260),this.parameterValidationArray.arc.range.setMinAndMax(30*Math.PI/180,2*Math.PI),this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1}},ED.AntSynech.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.apexY=-this.rtmi,this.setRotationWithDisplacements(0,-60)},ED.AntSynech.prototype.draw=function(t){var e=this.drawing.context;ED.AntSynech.superclass.draw.call(this,t);var i=-this.apexY;this.rir=this.riri;this.rir,this.rir;var r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=-Math.PI/2+r-Math.PI/14,s=-Math.PI/2-r+Math.PI/14,l=this.rir*Math.sin(r),h=-this.rir*Math.cos(r),d=-this.rir*Math.sin(r),c=h;switch(e.beginPath(),e.arc(0,0,this.rir,a,o,!0),e.arc(0,0,i,s,n,!1),e.closePath(),this.colour){case"Blue":e.fillStyle="rgba(160, 221, 251, 1)";break;case"Brown":e.fillStyle="rgba(203, 161, 134, 1)";break;case"Gray":e.fillStyle="rgba(177, 181, 172, 1)";break;case"Green":e.fillStyle="rgba(169, 206, 141, 1)"}return e.strokeStyle="rgba(100, 100, 100, 1.0)",e.lineWidth=4,this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.AntSynech.prototype.groupDescription=function(){return"Anterior synechiae over "+this.drawing.totalDegreesExtent(this.className).toString()+" degrees"},ED.ArcuateKeratotomy=function(t,e){this.className="ArcuateKeratotomy",this.diameter=8,this.arcLength=0,this.axis=0,this.anteriorDepth=0,this.posteriorDepth=0,this.angle=0,this.spotSeparation="",this.lineSeparation="",this.energyLevel="",this.savedParameterArray=["arc","rotation","apexY","diameter","arcLength","axis","anteriorDepth","posteriorDepth","angle","spotSeparation","lineSeparation","energyLevel"],this.controlParameterArray={diameter:"Diameter (mm)",arcLength:"Arc length (deg)",axis:"Axis (deg)",anteriorDepth:"Anterior depth (um)",posteriorDepth:"Posterior depth (um)",angle:"Cut angle (deg)",spotSeparation:"Spot separation",lineSeparation:"Line separation",energyLevel:"Energy level"},ED.Doodle.call(this,t,e)},ED.ArcuateKeratotomy.prototype=new ED.Doodle,ED.ArcuateKeratotomy.prototype.constructor=ED.ArcuateKeratotomy,ED.ArcuateKeratotomy.superclass=ED.Doodle.prototype,ED.ArcuateKeratotomy.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ArcuateKeratotomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(10*Math.PI/180,2*Math.PI/3),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-96),this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(3,10),precision:1,animate:!0},this.parameterValidationArray.arcLength={kind:"derived",type:"int",range:new ED.Range(10,120),precision:1,animate:!0},this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,360),clock:"bottom",animate:!0},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(3,10),precision:1,animate:!0},this.parameterValidationArray.anteriorDepth={kind:"other",type:"float",range:new ED.Range(-50,100),precision:0,animate:!1},this.parameterValidationArray.posteriorDepth={kind:"other",type:"float",range:new ED.Range(300,800),precision:0,animate:!1},this.parameterValidationArray.angle={kind:"other",type:"int",range:new ED.Range(30,150),precision:1,animate:!1},this.parameterValidationArray.spotSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.lineSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.energyLevel={kind:"other",type:"string",list:["0.50uJ","0.55uJ","0.60uJ","0.65uJ","0.70uJ","0.75uJ","0.80uJ","0.85uJ","0.90uJ","0.95uJ","1.00uJ"],animate:!1}},ED.ArcuateKeratotomy.prototype.setParameterDefaults=function(){this.setParameterFromString("diameter","6.0"),this.setParameterFromString("arcLength","60"),this.setParameterFromString("axis","90"),this.setParameterFromString("anteriorDepth","70"),this.setParameterFromString("posteriorDepth","600"),this.setParameterFromString("angle","90"),this.setParameterFromString("spotSeparation","0.6um"),this.setParameterFromString("lineSeparation","0.6um"),this.setParameterFromString("energyLevel","0.75uJ");var t=this.drawing.numberOfDoodlesOfClass(this.className);if(t>0){var e=this.drawing.firstDoodleOfClass(this.className);switch(t){case 1:this.rotation=e.rotation+Math.PI,this.arc=e.arc,this.setParameterFromString("diameter",e.diameter.toString());break;case 2:this.rotation=e.rotation;var i=.8*e.diameter;this.setParameterFromString("diameter",i.toString());break;case 3:this.rotation=e.rotation+Math.PI;i=.8*e.diameter;this.setParameterFromString("diameter",i.toString());break;case 4:this.rotation=e.rotation+Math.PI/2;break;default:e=this.drawing.lastDoodleOfClass(this.className),this.rotation=e.rotation+Math.PI/6}}},ED.ArcuateKeratotomy.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.diameter=-10*e/320;break;case"diameter":i.apexY=-320*parseFloat(e)/10;break;case"arc":i.arcLength=180*e/Math.PI;break;case"arcLength":i.arc=parseInt(e)*Math.PI/180;break;case"rotation":var r=(180*(2*Math.PI-e+Math.PI/2)/Math.PI+360)%360;360==r&&(r=0),i.axis=r;break;case"axis":i.rotation=(90-e+360)%360*Math.PI/180}return i},ED.ArcuateKeratotomy.prototype.draw=function(t){var e=this.drawing.context;ED.ArcuateKeratotomy.superclass.draw.call(this,t);var i=-this.apexY,r=i+12,a=i-12;e.beginPath();var o=this.arc/2,n=-Math.PI/2;e.arc(0,0,r,n+o,n-o,!0),e.arc(0,0,a,n-o,n+o,!1),e.closePath(),e.fillStyle="rgba(100,100,200,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),(s=new ED.Point(0,0)).setWithPolars(i,o),this.handleArray[3].location=this.transform.transformPoint(s);var s=new ED.Point(this.apexX,this.apexY);return this.handleArray[4].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ArcuateKeratotomy.prototype.groupDescription=function(){return"Arcuate Keratotomy"},ED.ArcuateKeratotomy.prototype.description=function(){return""},ED.ArcuateScotoma=function(t,e){this.className="ArcuateScotoma",this.savedParameterArray=["scaleX","scaleY","apexY","arc"],ED.Doodle.call(this,t,e)},ED.ArcuateScotoma.prototype=new ED.Doodle,ED.ArcuateScotoma.prototype.constructor=ED.ArcuateScotoma,ED.ArcuateScotoma.superclass=ED.Doodle.prototype,ED.ArcuateScotoma.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ArcuateScotoma.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(140,300),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.ArcuateScotoma.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexX=200,this.drawing.eye==ED.eye.Left&&(this.scaleX=-1*this.scaleX);var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.scaleY=-1*t.scaleY)},ED.ArcuateScotoma.prototype.draw=function(t){var e=this.drawing.context;ED.ArcuateScotoma.superclass.draw.call(this,t);var i=100,r=-100+i;return e.beginPath(),e.arc(r,0,i,-Math.PI,0,!1),e.lineTo(this.apexX,0),r=-140+(i=(this.apexX- -140)/2),e.arc(r,0,i,0,-Math.PI,!0),e.closePath(),e.lineWidth=6,e.fillStyle="gray",e.strokeStyle="black",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ArcuateScotoma.prototype.description=function(){return this.scaleY>0?"Superior":"Inferior arcuate scotoma"},ED.AxialLengthGraph=function(t,e){this.className="AxialLengthGraph",this.padding=100,this.offset=120,this.xAxis=24,this.xFirst=14,this.interval=2,this.stubLength=30,this.axialLength=25,this.standardDeviation=1,this.lowerLimit=21.2,this.upperLimit=26.6,ED.Doodle.call(this,t,e)},ED.AxialLengthGraph.prototype=new ED.Doodle,ED.AxialLengthGraph.prototype.constructor=ED.AxialLengthGraph,ED.AxialLengthGraph.superclass=ED.Doodle.prototype,ED.AxialLengthGraph.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1,this.parameterValidationArray.axialLength={kind:"derived",type:"float",precision:2,range:new ED.Range(14,38),animate:!1}},ED.AxialLengthGraph.prototype.draw=function(t){var e=this.drawing.context;ED.AxialLengthGraph.superclass.draw.call(this,t),e.beginPath();var i=-this.drawing.doodlePlaneWidth/2,r=-this.drawing.doodlePlaneHeight/2,a=this.drawing.doodlePlaneWidth/2,o=this.drawing.doodlePlaneHeight/2,n=(this.drawing.doodlePlaneWidth-2*this.padding)/this.xAxis;if(e.rect(i,r,this.drawing.doodlePlaneWidth,this.drawing.doodlePlaneHeight),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.rect(i+this.padding,r+this.padding,(this.lowerLimit-this.xFirst)*n,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),e.rect(i+this.padding+(this.upperLimit-this.xFirst)*n,r+this.padding,this.drawing.doodlePlaneWidth-2*this.padding-(this.upperLimit-this.xFirst)*n,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),e.fillStyle="rgba(255,167,152,0.5)",e.fill(),e.beginPath(),e.rect(i+this.padding+(this.lowerLimit-this.xFirst)*n,r+this.padding,(this.upperLimit-this.lowerLimit)*n,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),e.fillStyle="rgba(208,255,197,0.5)",e.fill(),e.beginPath(),e.moveTo(i+this.padding,o-this.padding-this.offset),e.lineTo(a-this.padding,o-this.padding-this.offset),e.moveTo(i+this.padding,o-this.padding-this.offset),e.lineTo(i+this.padding,r+this.padding),e.lineWidth=4,e.stroke();for(var s=Math.floor(this.xAxis/this.interval)+1,l=0;l<s;l++){var h=(this.xFirst+l*this.interval).toString(),d=l*(this.drawing.doodlePlaneWidth-2*this.padding)/(s-1);e.lineWidth=4,e.font="112px sans-serif",e.strokeStyle="gray",e.fillStyle="gray",e.beginPath(),e.moveTo(i+this.padding+d,o-this.padding-this.offset),e.lineTo(i+this.padding+d,o-this.padding-this.offset+this.stubLength),e.stroke();var c=e.measureText(h).width;e.fillText(h,i+this.padding+d-c/2,o-this.padding)}var p=i+this.padding+(this.axialLength-this.xFirst)*n;e.beginPath(),e.moveTo(p,o-this.padding-this.offset),e.lineTo(p,r+this.padding),e.lineWidth=16,e.strokeStyle="rgba(50,50,50,1)",e.stroke();var y=this.standardDeviation*n;e.beginPath(),e.rect(p-y/2,0-this.offset/2,y,50),e.lineWidth=16,e.strokeStyle="red",e.stroke()}return this.isClicked},ED.BandKeratopathy=function(t,e){this.className="BandKeratopathy",this.numberOfOuterHandles=4,this.numberOfInnerHandles=6,this.initialRadius=380,this.opacity=.25,this.savedParameterArray=["originX","originY","rotation","gradeOfOpacity"],this.controlParameterArray={gradeOfOpacity:"Opacity grade"},ED.Doodle.call(this,t,e)},ED.BandKeratopathy.prototype=new ED.Doodle,ED.BandKeratopathy.prototype.constructor=ED.BandKeratopathy,ED.BandKeratopathy.superclass=ED.Doodle.prototype,ED.BandKeratopathy.prototype.setHandles=function(){for(var t=0;t<this.numberOfOuterHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[5]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[6]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[7]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[8]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[9]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.BandKeratopathy.prototype.updateHandleCoordinateRanges=function(t){this.handleCoordinateRangeArray=[],this.handleVectorRangeArray=[];for(var e=0;e<this.numberOfOuterHandles;e++)this.handleCoordinateRangeArray[e]={x:new ED.Range(-400,400),y:new ED.Range(-400,400)};for(var i=3/180*Math.PI,r=15/180*Math.PI,a=[{min:this.squiggleArray[0].pointsArray[3].direction()+r,max:Math.PI-i},{min:Math.PI+i,max:this.squiggleArray[0].pointsArray[2].direction()-r},{min:this.squiggleArray[0].pointsArray[1].direction()+r,max:2*Math.PI-i},{min:2*Math.PI+i,max:this.squiggleArray[0].pointsArray[0].direction()-r}],o=0;o<this.numberOfOuterHandles;o++){var n={};n.length=new ED.Range(390,390),n.angle=new ED.Range(a[o].min,a[o].max),this.handleVectorRangeArray[o]=n}for(var s=0;s<this.numberOfInnerHandles;s++)this.handleVectorRangeArray.push({length:new ED.Range(0,390),angle:new ED.Range(0,2*Math.PI)});var l=this.createTopCatmullRomSpline(t),h=this.createBottomCatmullRomSpline(t),d=function(t,e,i){for(var r=i?Math.min:Math.max,a=i?500:-500,o=0;o<=1;o+=.001){var n=t(o);Math.abs(n.x-e)<3&&(a=r(a,n.y))}return a};this.handleCoordinateRangeArray[4]={x:new ED.Range(-300,-100),y:new ED.Range(-390,d(h,t.controlPointInnerTopLeft.x,!0)-60)},this.handleCoordinateRangeArray[5]={x:new ED.Range(100,300),y:new ED.Range(-390,d(h,t.controlPointInnerTopRight.x,!0)-60)},this.handleCoordinateRangeArray[6]={x:new ED.Range(-300,-100),y:new ED.Range(d(l,t.controlPointInnerBottomLeft.x,!1)+60,390)},this.handleCoordinateRangeArray[7]={x:new ED.Range(100,300),y:new ED.Range(d(l,t.controlPointInnerBottomRight.x,!1)+60,390)},this.handleCoordinateRangeArray[8]={x:new ED.Range(-100,100),y:new ED.Range(-390,d(h,t.controlPointInnerTopCenter.x,!0)-60)},this.handleCoordinateRangeArray[9]={x:new ED.Range(-100,100),y:new ED.Range(d(l,t.controlPointInnerBottomCenter.x,!1)+60,390)}},ED.BandKeratopathy.prototype.updateHandlePositions=function(){for(var t=0;t<this.squiggleArray[0].pointsArray.length;++t){var e=new ED.Point(this.handleCoordinateRangeArray[t].x.constrain(this.squiggleArray[0].pointsArray[t].x),this.handleCoordinateRangeArray[t].y.constrain(this.squiggleArray[0].pointsArray[t].y)),i=this.handleVectorRangeArray[t].length.constrain(e.length()),r=this.handleVectorRangeArray[t].angle.constrainToAngularRange(e.direction(),!1);e.setWithPolars(i,r),this.squiggleArray[0].pointsArray[t].x=e.x,this.squiggleArray[0].pointsArray[t].y=e.y}},ED.BandKeratopathy.prototype.createTopCatmullRomSpline=function(t){return this.createCatmullRomSpline([t.controlPointOuterTopRight,t.controlPointInnerTopRight,t.controlPointInnerTopCenter,t.controlPointInnerTopLeft,t.controlPointOuterTopLeft])},ED.BandKeratopathy.prototype.createBottomCatmullRomSpline=function(t){return this.createCatmullRomSpline([t.controlPointOuterBottomLeft,t.controlPointInnerBottomLeft,t.controlPointInnerBottomCenter,t.controlPointInnerBottomRight,t.controlPointOuterBottomRight])},ED.BandKeratopathy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0,this.isRotatable=!1,this.parameterValidationArray.gradeOfOpacity={kind:"derived",type:"string",list:["+","++","+++","++++"]}},ED.BandKeratopathy.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"gradeOfOpacity":i.opacity=25*e.length/100}return i},ED.BandKeratopathy.prototype.setParameterDefaults=function(){this.setParameterFromString("gradeOfOpacity","+");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[120,240,300,60],i=0;i<this.numberOfOuterHandles;i++){var r=new ED.Point(0,0);r.setWithPolars(this.initialRadius,e[i]*Math.PI/180),this.addPointToSquiggle(r)}this.addPointToSquiggle(new ED.Point(-100,-100)),this.addPointToSquiggle(new ED.Point(100,-100)),this.addPointToSquiggle(new ED.Point(-100,100)),this.addPointToSquiggle(new ED.Point(100,100)),this.addPointToSquiggle(new ED.Point(0,-90)),this.addPointToSquiggle(new ED.Point(0,90))},ED.BandKeratopathy.prototype.createArcCurveFromPoints=function(t,e,i,r){var a=-1*Math.atan2(i.y-t.y,i.x-t.x),o=-1*Math.atan2(r.y-t.y,r.x-t.x);return a>o&&(a-=2*Math.PI),function(t,e,i,r){return function(a){var o;return o=a*(r-i)+i,new Vector2D(t.x+e*Math.cos(o),t.y-e*Math.sin(o))}}(t,e,a,o)},ED.BandKeratopathy.prototype.createCatmullRomSpline=function(t,e,i,r){if(void 0===e){e=[];for(var a=0;a<t.length;++a)e.push(a)}i=i||new Vector2D(0,0),r=r||new Vector2D(0,0);return function(a){return function(a){a=Math.min(a,e[e.length-1]),a=Math.max(a,e[0]);var o=Math.floor(a),n=0===o?i:t[o+1].sub(t[o]).scale(1/(e[o+1]-e[o])).add(t[o].sub(t[o-1]).scale(1/(e[o]-e[o-1]))).scale(.5),s=o===t.length-2?r:t[o+2].sub(t[o+1]).scale(1/(e[o+2]-e[o+1])).add(t[o+1].sub(t[o]).scale(1/(e[o+1]-e[o]))).scale(.5);return function(t,e,i,r,a,o,n){var s=t,l=e,h=o-i,d=h*h,c=d*h,p=r.sub(t).scale(3).scale(1/d).sub(a.add(e.scale(2)).scale(1/h)),y=n-i,D=y*y,u=D*y;return t.sub(r).scale(2).scale(1/c).add(a.add(e).scale(1/d)).scale(u).add(p.scale(D).add(l.scale(y).add(s)))}(t[o],n,e[o],t[o+1],s,e[o+1],a)}(a*(e[e.length-1]-e[0])+e[0])}},ED.BandKeratopathy.prototype.drawShape=function(t,e,i,r){var a=[this.createArcCurveFromPoints(e,i,r.controlPointOuterBottomRight,r.controlPointOuterTopRight),this.createTopCatmullRomSpline(r),this.createArcCurveFromPoints(e,i,r.controlPointOuterTopLeft,r.controlPointOuterBottomLeft),this.createBottomCatmullRomSpline(r)],o=[!1,!0,!1,!0],n=a[0](0);t.moveTo(n.x,n.y);for(var s=0;s<a.length;++s)for(var l=o[s]?.97:1,h=o[s]?.03:0;h<=l;h+=.01){var d=a[s](h);t.lineTo(d.x,d.y)}t.strokeStyle="rgb(0,0,0,0)",t.fillStyle="rgb(169,169,169,"+this.opacity+")",t.fill()},ED.BandKeratopathy.prototype.draw=function(t){var e={};e.controlPointOuterTopLeft=new Vector2D(this.squiggleArray[0].pointsArray[2].x,this.squiggleArray[0].pointsArray[2].y),e.controlPointInnerTopLeft=new Vector2D(this.squiggleArray[0].pointsArray[4].x,this.squiggleArray[0].pointsArray[4].y),e.controlPointInnerTopRight=new Vector2D(this.squiggleArray[0].pointsArray[5].x,this.squiggleArray[0].pointsArray[5].y),e.controlPointOuterTopRight=new Vector2D(this.squiggleArray[0].pointsArray[3].x,this.squiggleArray[0].pointsArray[3].y),e.controlPointOuterBottomRight=new Vector2D(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y),e.controlPointInnerBottomRight=new Vector2D(this.squiggleArray[0].pointsArray[7].x,this.squiggleArray[0].pointsArray[7].y),e.controlPointInnerBottomLeft=new Vector2D(this.squiggleArray[0].pointsArray[6].x,this.squiggleArray[0].pointsArray[6].y),e.controlPointOuterBottomLeft=new Vector2D(this.squiggleArray[0].pointsArray[1].x,this.squiggleArray[0].pointsArray[1].y),e.controlPointInnerTopCenter=new Vector2D(this.squiggleArray[0].pointsArray[8].x,this.squiggleArray[0].pointsArray[8].y),e.controlPointInnerBottomCenter=new Vector2D(this.squiggleArray[0].pointsArray[9].x,this.squiggleArray[0].pointsArray[9].y),this.updateHandleCoordinateRanges(e),this.updateHandlePositions();var i=this.drawing.context;ED.BandKeratopathy.superclass.draw.call(this,t),i.beginPath(),this.drawShape(i,new Vector2D(0,0),this.initialRadius,e),this.drawBoundary(t),i.beginPath();for(var r=0;r<this.numberOfOuterHandles;r++)this.handleArray[r].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[r]);return this.handleArray[4].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[4]),this.handleArray[5].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[5]),this.handleArray[6].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[6]),this.handleArray[7].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[7]),this.handleArray[8].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[8]),this.handleArray[9].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[9]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BandKeratopathy.prototype.description=function(){return"Band Keratopathy "+this.gradeOfOpacity},ED.BandKeratopathy.prototype.snomedCode=function(){return 35055e3},ED.BiopsySite=function(t,e){this.className="BiopsySite",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.BiopsySite.prototype=new ED.Doodle,ED.BiopsySite.prototype.constructor=ED.BiopsySite,ED.BiopsySite.superclass=ED.Doodle.prototype,ED.BiopsySite.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.BiopsySite.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.BiopsySite.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(300,-80)},ED.BiopsySite.prototype.draw=function(t){var e=this.drawing.context;ED.BiopsySite.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=20,e.fillStyle="yellow",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw;var i=new ED.Point(0,0);return i.setWithPolars(30,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BiopsySite.prototype.description=function(){return"Biopsy site in the "+this.quadrant()},ED.Bleb=function(t,e){this.className="Bleb",this.leakage="None",this.savedParameterArray=["rotation","arc","leakage","apexX","apexY"],this.controlParameterArray={leakage:"Leakage"},ED.Doodle.call(this,t,e)},ED.Bleb.prototype=new ED.Doodle,ED.Bleb.prototype.constructor=ED.Bleb,ED.Bleb.superclass=ED.Doodle.prototype,ED.Bleb.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Bleb.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/12,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-100,100),this.parameterValidationArray.apexY.range.setMinAndMax(-500,-380),this.parameterValidationArray.leakage={kind:"derived",type:"string",list:["None","Minimal","Moderate","Brisk"],animate:!0}},ED.Bleb.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30),this.arc=Math.PI/8,this.apexY=-400,this.setParameterFromString("leakage","None")},ED.Bleb.prototype.dependentParameterValues=function(t,e){switch(t){case"arc":var i=480*Math.tan(e/2);this.parameterValidationArray.apexX.range.setMinAndMax(-i,+i);var r=360*Math.cos(e/2);this.parameterValidationArray.apexY.range.setMinAndMax(-500,-r)}return[]},ED.Bleb.prototype.draw=function(t){var e=this.drawing.context;ED.Bleb.superclass.draw.call(this,t);var i=470;e.beginPath();var r=384,a=this.arc/2,o=Math.PI/30,n=Math.PI/40,s=(Math.PI,Math.PI,500*Math.sin(a)),l=-500*Math.cos(a),h=(Math.sin(a),i*Math.sin(a+o)),d=-i*Math.cos(a+o),c=(Math.sin(a+o),i*Math.sin(a+o+n)),p=-i*Math.cos(a+o+n),y=-i*Math.sin(a+o+n),D=p,u=(Math.sin(a),-r*Math.cos(a)),g=-r*Math.sin(a),P=u;if(e.beginPath(),e.arc(0,0,500,-Math.PI/2+a,-Math.PI/2-a,!0),e.quadraticCurveTo(y,D,g,P),e.arc(0,0,r,-Math.PI/2-a,-Math.PI/2+a,!1),e.quadraticCurveTo(c,p,s,l),e.closePath(),e.fillStyle="rgba(240,240,240,0.9)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-50,-r),e.lineTo(-50,1.2*-r),e.lineTo(50,1.2*-r),e.lineTo(50,-r),e.stroke(),"None"!==this.leakage)){var E;switch(this.leakage){case"Minimal":E=100;break;case"Moderate":E=150;break;case"Brisk":E=200}n=Math.PI/8;e.beginPath(),e.moveTo(this.apexX,this.apexY);var m=new ED.Point(0,0);m.setWithPolars(-E,n-this.rotation);var f=new ED.Point(0,0);f.setWithPolars(-E,-n-this.rotation),i=m.distanceTo(f)/2;var w=new ED.Point(0,0);w.setWithPolars(-E,-this.rotation),e.lineTo(this.apexX+m.x,this.apexY+m.y),e.arc(this.apexX+w.x,this.apexY+w.y,i,Math.PI-this.rotation,2*Math.PI-this.rotation,!0),e.lineTo(this.apexX+f.x,this.apexY+f.y),e.closePath(),e.fillStyle="rgba(0, 255, 0, 0.75)",e.fill()}return this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),"None"!==this.leakage?this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)):this.handleArray[4].location=this.transform.transformPoint(new ED.Point(-600,-600)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Bleb.prototype.description=function(){var t="Trabeculectomy bleb at "+this.clockHour()+" o'clock";return"None"!==this.leakage&&(t+=" with "+this.leakage.toLowerCase()+" leakage"),t},ED.BlotHaemorrhage=function(t,e){this.className="BlotHaemorrhage",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.BlotHaemorrhage.prototype=new ED.Doodle,ED.BlotHaemorrhage.prototype.constructor=ED.BlotHaemorrhage,ED.BlotHaemorrhage.superclass=ED.Doodle.prototype,ED.BlotHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.BlotHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-60,-60)},ED.BlotHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.BlotHaemorrhage.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(30,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BlotHaemorrhage.prototype.groupDescription=function(){return"Blot haemorrhages"},ED.BuckleOperation=function(t,e){this.className="BuckleOperation",ED.Doodle.call(this,t,e)},ED.BuckleOperation.prototype=new ED.Doodle,ED.BuckleOperation.prototype.constructor=ED.BuckleOperation,ED.BuckleOperation.superclass=ED.Doodle.prototype,ED.BuckleOperation.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.willReport=!1},ED.BuckleOperation.prototype.draw=function(t){var e=this.drawing.context;return ED.BuckleOperation.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#444",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawRectus(e,"Sup"),this.drawRectus(e,"Nas"),this.drawRectus(e,"Inf"),this.drawRectus(e,"Tem")),this.isClicked},ED.BuckleOperation.prototype.drawRectus=function(t,e){switch(t.beginPath(),e){case"Sup":x1=-60,y1=-480,x2=-60,y2=-200,x3=60,y3=-200,x4=60,y4=-480,xd=30,yd=0;break;case"Nas":x1=480,y1=-60,x2=200,y2=-60,x3=200,y3=60,x4=480,y4=60,xd=0,yd=30;break;case"Inf":x1=60,y1=480,x2=60,y2=200,x3=-60,y3=200,x4=-60,y4=480,xd=-30,yd=0;break;case"Tem":x1=-480,y1=60,x2=-200,y2=60,x3=-200,y3=-60,x4=-480,y4=-60,xd=0,yd=-30}t.moveTo(x1,y1),t.lineTo(x2,y2),t.lineTo(x3,y3),t.lineTo(x4,y4),t.moveTo(x1+xd,y1+yd),t.lineTo(x2+xd,y2+yd),t.moveTo(x1+2*xd,y1+2*yd),t.lineTo(x2+2*xd,y2+2*yd),t.moveTo(x1+3*xd,y1+3*yd),t.lineTo(x2+3*xd,y2+3*yd),t.fillStyle="#CA6800",t.fill(),t.lineWidth=8,t.strokeStyle="#804000",t.stroke()},ED.BuckleSuture=function(t,e){this.className="BuckleSuture",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e),this.arc=15*Math.PI/180},ED.BuckleSuture.prototype=new ED.Doodle,ED.BuckleSuture.prototype.constructor=ED.BuckleSuture,ED.BuckleSuture.superclass=ED.Doodle.prototype,ED.BuckleSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.willReport=!1},ED.BuckleSuture.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BuckleSuture.prototype.draw=function(t){var e=this.drawing.context;ED.BuckleSuture.superclass.draw.call(this,t);var i=340,a=this.drawing.lastDoodleOfClass("CircumferentialBuckle");a&&(i=20-a.apexY);var o=this.arc/2,n=-Math.PI/2+o,s=-Math.PI/2-o;if(e.beginPath(),e.arc(0,0,i,n,s,!0),e.arc(0,0,200,s,n,!1),e.closePath(),e.lineWidth=4,this.isFilled=!1,e.strokeStyle="#666",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){r=200+(i-200)/2;var l=r*Math.sin(o),h=-r*Math.cos(o);e.beginPath(),e.arc(l,h,5,0,2*Math.PI,!0),e.moveTo(l+20,h+20),e.lineTo(l,h),e.lineTo(l+20,h-20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.BusaccaNodule=function(t,e){this.className="BusaccaNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.BusaccaNodule.prototype=new ED.Doodle,ED.BusaccaNodule.prototype.constructor=ED.BusaccaNodule,ED.BusaccaNodule.superclass=ED.Doodle.prototype,ED.BusaccaNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.BusaccaNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BusaccaNodule.prototype.draw=function(t){var e=this.drawing.context;ED.BusaccaNodule.superclass.draw.call(this,t);var i=260,r=this.drawing.lastDoodleOfClass("AntSeg");r&&(i=-r.apexY);var a=i+(380-i)/2;return e.beginPath(),e.arc(0,-a,30,0,2*Math.PI,!1),e.fillStyle="rgba(150,100,50,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.BusaccaNodule.prototype.groupDescription=function(){return"Busacca nodules"},ED.CapsularTensionRing=function(t,e){this.className="CapsularTensionRing",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.CapsularTensionRing.prototype=new ED.Doodle,ED.CapsularTensionRing.prototype.constructor=ED.CapsularTensionRing,ED.CapsularTensionRing.superclass=ED.Doodle.prototype,ED.CapsularTensionRing.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0},ED.CapsularTensionRing.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/2},ED.CapsularTensionRing.prototype.draw=function(t){var e=this.drawing.context;ED.CapsularTensionRing.superclass.draw.call(this,t),e.beginPath();var i=340,r=.2*Math.PI;e.arc(0,0,360,-r,r,!0);var a=new ED.Point(0,0);a.setWithPolars(360,Math.PI/2+.8*r);var o=new ED.Point(0,0);o.setWithPolars(300,Math.PI/2+.8*r);var n=new ED.Point(0,0);n.setWithPolars(300,Math.PI/2+r);var s=new ED.Point(0,0);s.setWithPolars(300,Math.PI/2+1.1*r);var l=new ED.Point(0,0);l.setWithPolars(i,Math.PI/2+1.1*r);var h=new ED.Point(0,0);h.setWithPolars(i,Math.PI/2+1.2*r),e.bezierCurveTo(a.x,a.y,o.x,o.y,n.x,n.y),e.bezierCurveTo(s.x,s.y,l.x,l.y,h.x,h.y),e.arc(0,0,i,1.2*r,-1.2*r,!1);var d=new ED.Point(0,0);d.setWithPolars(i,Math.PI/2-1.1*r);var c=new ED.Point(0,0);c.setWithPolars(300,Math.PI/2-1.1*r);var p=new ED.Point(0,0);p.setWithPolars(300,Math.PI/2-r);var y=new ED.Point(0,0);y.setWithPolars(300,Math.PI/2-.8*r);var D=new ED.Point(0,0);D.setWithPolars(360,Math.PI/2-.8*r);var u=new ED.Point(0,0);u.setWithPolars(360,Math.PI/2-r),e.bezierCurveTo(d.x,d.y,c.x,c.y,p.x,p.y),e.bezierCurveTo(y.x,y.y,D.x,D.y,u.x,u.y);var g=new ED.Point(0,0);g.setWithPolars(332,Math.PI/2-r);var P=new ED.Point(0,0);P.setWithPolars(347,Math.PI/2-r),e.moveTo(P.x,P.y),e.arc(g.x,g.y,15,0,2*Math.PI,!1);var E=new ED.Point(0,0);E.setWithPolars(332,Math.PI/2+r);var m=new ED.Point(0,0);return m.setWithPolars(347,Math.PI/2+r),e.moveTo(m.x,m.y),e.arc(E.x,E.y,15,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.isClicked},ED.CapsularTensionRing.prototype.description=function(){return"Capsular Tension Ring"},ED.ChandelierDouble=function(t,e){this.className="ChandelierDouble",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.ChandelierDouble.prototype=new ED.Doodle,ED.ChandelierDouble.prototype.constructor=ED.ChandelierDouble,ED.ChandelierDouble.superclass=ED.Doodle.prototype,ED.ChandelierDouble.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierDouble.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierDouble.prototype.draw=function(t){var e=this.drawing.context;if(ED.ChandelierDouble.superclass.draw.call(this,t),e.beginPath(),e.rect(-120,this.parsPlana-60,240,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var i=-80;e.moveTo(i-20,this.parsPlana+60),e.lineTo(i+20,this.parsPlana+60),e.lineTo(i+20,this.parsPlana+120),e.lineTo(i,this.parsPlana+140),e.lineTo(i-20,this.parsPlana+120),e.lineTo(i-20,this.parsPlana+60);i=80;e.moveTo(i-20,this.parsPlana+60),e.lineTo(i+20,this.parsPlana+60),e.lineTo(i+20,this.parsPlana+120),e.lineTo(i,this.parsPlana+140),e.lineTo(i-20,this.parsPlana+120),e.lineTo(i-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-120,this.parsPlana,240,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()}return this.isClicked},ED.ChandelierDouble.prototype.groupDescription=function(){return"Twin chandelier at "},ED.ChandelierDouble.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChandelierSingle=function(t,e){this.className="ChandelierSingle",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.ChandelierSingle.prototype=new ED.Doodle,ED.ChandelierSingle.prototype.constructor=ED.ChandelierSingle,ED.ChandelierSingle.superclass=ED.Doodle.prototype,ED.ChandelierSingle.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierSingle.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierSingle.prototype.draw=function(t){var e=this.drawing.context;return ED.ChandelierSingle.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-60,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-20,this.parsPlana+60),e.lineTo(20,this.parsPlana+60),e.lineTo(20,this.parsPlana+120),e.lineTo(0,this.parsPlana+140),e.lineTo(-20,this.parsPlana+120),e.lineTo(-20,this.parsPlana+60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-60,this.parsPlana,120,60),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(0,this.parsPlana),e.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),e.lineWidth=40,e.strokeStyle="rgba(120, 120, 120, 0.5)",e.stroke()),this.isClicked},ED.ChandelierSingle.prototype.groupDescription=function(){return"Chandelier at "},ED.ChandelierSingle.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChoroidalEffusion=function(t,e){this.className="ChoroidalEffusion",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.ChoroidalEffusion.prototype=new ED.Doodle,ED.ChoroidalEffusion.prototype.constructor=ED.ChoroidalEffusion,ED.ChoroidalEffusion.superclass=ED.Doodle.prototype,ED.ChoroidalEffusion.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalEffusion.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.ChoroidalEffusion.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexY=-200,this.setRotationWithDisplacements(45,60)},ED.ChoroidalEffusion.prototype.draw=function(t){var e=this.drawing.context;ED.ChoroidalEffusion.superclass.draw.call(this,t);var i=476,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);return e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s),e.lineWidth=4,e.fillStyle="rgba(134, 151, 176, 1)",e.strokeStyle="rgba(134, 151, 176, 1)",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ChoroidalEffusion.prototype.groupDescription=function(){for(var t,e=this.drawing.allDoodlesOfClass(this.className),i={},r="",a=0;a<e.length;a++)t=e[a],i[this.getDescriptionForDoodle(t)]=void 0!==i[this.getDescriptionForDoodle(t)]?i[this.getDescriptionForDoodle(t)]+1:1;for(var o in i)i.hasOwnProperty(o)&&(""!==r&&(r+=", "),r+=o+" ["+i[o]+"]");return r},ED.ChoroidalEffusion.prototype.getDescriptionForDoodle=function(t){var e="";return e+=Math.cos(t.rotation)>0?"Supero":"Infero",e+=Math.sin(t.rotation)>0?t.drawing.eye===ED.eye.Right?"nasal":"temporal":t.drawing.eye===ED.eye.Right?"temporal":"nasal",e+=" choroidal effusion"},ED.ChoroidalEffusion.prototype.snomedCode=function(){return 232000008},ED.ChoroidalHaemorrhage=function(t,e){this.className="ChoroidalHaemorrhage",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.ChoroidalHaemorrhage.prototype=new ED.Doodle,ED.ChoroidalHaemorrhage.prototype.constructor=ED.ChoroidalHaemorrhage,ED.ChoroidalHaemorrhage.superclass=ED.Doodle.prototype,ED.ChoroidalHaemorrhage.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.ChoroidalHaemorrhage.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexY=-200,this.setRotationWithDisplacements(315,60)},ED.ChoroidalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.ChoroidalHaemorrhage.superclass.draw.call(this,t);var i=476,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);if(this.apexY<-25)e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);else if(this.apexY<25){var d=Math.acos((0-this.apexY)/25),c=25*Math.sin(d);e.bezierCurveTo(l,h,.6*l,this.apexY,-c,this.apexY),e.arc(0,0,25,-Math.PI/2-d,-Math.PI/2+d,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s)}else e.bezierCurveTo(l,h,.6*l,this.apexY,0,25),e.arc(0,0,25,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);return e.lineWidth=4,e.fillStyle="rgba(153, 102, 51, 1)",e.strokeStyle="rgba(153, 102, 51, 1)",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ChoroidalHaemorrhage.prototype.description=function(){var t="";return t+=Math.cos(this.rotation)>0?"Supero":"Infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",t+=" choroidal haemorrhage"},ED.ChoroidalHaemorrhage.prototype.snomedCode=function(){return 419596007},ED.ChoroidalHaemorrhage.prototype.snomedCode=function(){"use strict";return 122003},ED.ChoroidalNaevus=function(t,e){this.className="ChoroidalNaevus",this.numberOfHandles=4,this.initialRadius=120,this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.ChoroidalNaevus.prototype=new ED.Doodle,ED.ChoroidalNaevus.prototype.constructor=ED.ChoroidalNaevus,ED.ChoroidalNaevus.superclass=ED.Doodle.prototype,ED.ChoroidalNaevus.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0,this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalNaevus.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,290),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0},ED.ChoroidalNaevus.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;e<this.numberOfHandles;e++){var i=new ED.Point(0,0);i.setWithPolars(this.initialRadius,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(i)}},ED.ChoroidalNaevus.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.ChoroidalNaevus.superclass.draw.call(this,t),o.beginPath();var s=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var l=0;l<this.numberOfHandles;l++){e=this.squiggleArray[0].pointsArray[l];var h=l<this.numberOfHandles-1?l+1:0;i=this.squiggleArray[0].pointsArray[h],r=e.tangentialControlPoint(+s),a=i.tangentialControlPoint(-s),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}if(o.closePath(),o.lineWidth=4,o.fillStyle="rgba(125, 65, 54, 0.8)",o.strokeStyle=o.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){p=new ED.Point(0,0),fill="yellow";n=Math.abs(Math.floor((50-this.apexY)/5));for(l=0;l<n;l++)p.setWithPolars(.8*this.initialRadius*ED.randomArray[l+10],2*Math.PI*ED.randomArray[l+100]),this.drawSpot(o,p.x,p.y,8,fill)}for(l=0;l<this.numberOfHandles;l++)this.handleArray[l].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[l]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ChoroidalNaevus.prototype.description=function(){return"Choroidal naevus"},ED.ChoroidalNaevus.prototype.snomedCode=function(){return 255024002},ED.CiliaryInjection=function(t,e){this.className="CiliaryInjection",this.severity="Medium",this.savedParameterArray=["arc","rotation","severity"],this.controlParameterArray={severity:"Severity"},ED.Doodle.call(this,t,e)},ED.CiliaryInjection.prototype=new ED.Doodle,ED.CiliaryInjection.prototype.constructor=ED.CiliaryInjection,ED.CiliaryInjection.superclass=ED.Doodle.prototype,ED.CiliaryInjection.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.CiliaryInjection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.severity={kind:"other",type:"string",list:["Severe","Medium","Mild"],animate:!1}},ED.CiliaryInjection.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.setRotationWithDisplacements(45,-90);var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.arc=t.arc,this.severity=t.severity)},ED.CiliaryInjection.prototype.draw=function(t){var e=this.drawing.context;ED.CiliaryInjection.superclass.draw.call(this,t);var i=this.arc/2,r=(Math.PI,-Math.PI/2-i),a=440*Math.sin(i),o=-440*Math.cos(i),n=-440*Math.sin(i),s=o;if(e.beginPath(),e.arc(0,0,480,-Math.PI/2+i,-Math.PI/2-i,!0),e.arc(0,0,400,-Math.PI/2-i,-Math.PI/2+i,!1),e.closePath(),e.fillStyle="rgba(218,230,241,0)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var l,h=2*Math.PI/60,d=Math.floor(this.arc/h),c=new ED.Point(0,0),p=new ED.Point(0,0);switch(e.beginPath(),this.severity){case"Severe":l=480;break;case"Medium":l=460;break;case"Mild":l=440}for(var y=0;y<d;y++){i=Math.PI/2+r+y*h;c.setWithPolars(l,i),p.setWithPolars(400,i),e.moveTo(c.x,c.y),e.lineTo(p.x,p.y)}switch(e.strokeStyle="red",this.severity){case"Severe":e.lineWidth=16;break;case"Medium":e.lineWidth=12;break;case"Mild":e.lineWidth=8}e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(a,o)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CiliaryInjection.prototype.groupDescription=function(){var t=this.severity+" ciliary injection";return this.arc<1.8*Math.PI&&(t+=" centred ",t+=Math.cos(this.rotation)>0?"supero":"infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasally":"temporally":this.drawing.eye==ED.eye.Right?"temporally":"nasally"),t},ED.CiliaryInjection.prototype.drawSoftLine=function(t,e,i,r,a,o,n,s,l){var h=this.drawing.context,d=i-t,c=r-e,p=Math.sqrt(d*d+c*c),y=d/p*a,D=c/p*a,u=h.createLinearGradient(t-D/2,e+y/2,t+D/2,e-y/2);u.addColorStop(0,"rgba("+o+","+n+","+s+",0)"),u.addColorStop(.43,"rgba("+o+","+n+","+s+","+l+")"),u.addColorStop(.57,"rgba("+o+","+n+","+s+","+l+")"),u.addColorStop(1,"rgba("+o+","+n+","+s+",0)"),h.save(),h.beginPath(),h.lineWidth=a,h.strokeStyle=u,h.moveTo(t,e),h.lineTo(i,r),h.stroke(),h.restore()},ED.Circinate=function(t,e){this.className="Circinate",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Circinate.prototype=new ED.Doodle,ED.Circinate.prototype.constructor=ED.Circinate,ED.Circinate.superclass=ED.Doodle.prototype,ED.Circinate.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Circinate.prototype.setPropertyDefaults=function(){},ED.Circinate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(60,100)},ED.Circinate.prototype.draw=function(t){var e=this.drawing.context;ED.Circinate.superclass.draw.call(this,t),e.beginPath();if(e.arc(0,0,80,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,0,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=new ED.Point(0,0),a=new ED.Point(0,0);for(e.beginPath(),e.arc(0,0,10,0,2*Math.PI,!1),e.closePath(),e.fillStyle="red",e.fill(),phi=2*Math.PI/12,i=0;i<12;i++)e.beginPath(),r.setWithPolars(40,i*phi),a.setWithPolars(70,i*phi),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.closePath(),e.lineWidth=12,e.strokeStyle="rgba(220,220,0,1)",e.lineCap="round",e.stroke()}var o=new ED.Point(0,0);return o.setWithPolars(80,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Circinate.prototype.groupDescription=function(){return"Circinate retinopathy "},ED.Circinate.prototype.description=function(){return this.locationRelativeToFovea()},ED.CircumferentialBuckle=function(t,e){this.className="CircumferentialBuckle",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.CircumferentialBuckle.prototype=new ED.Doodle,ED.CircumferentialBuckle.prototype.constructor=ED.CircumferentialBuckle,ED.CircumferentialBuckle.superclass=ED.Doodle.prototype,ED.CircumferentialBuckle.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CircumferentialBuckle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-410,-320)},ED.CircumferentialBuckle.prototype.setParameterDefaults=function(){this.arc=140*Math.PI/180,this.apexY=-320,this.rotation=-45*Math.PI/180},ED.CircumferentialBuckle.prototype.draw=function(t){var e=this.drawing.context;ED.CircumferentialBuckle.superclass.draw.call(this,t);var i=320;-350>this.apexY&&this.apexY>-380?i=350:this.apexY<-380&&(i=410);var r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,i,a,o,!0),e.arc(0,0,220,o,a,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();rgi=220+(i-220-30)/2,rgo=i-(i-220-30)/2,e.arc(0,0,rgo,a,o,!0),e.arc(0,0,rgi,o,a,!1),e.closePath(),e.fill(),e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,-i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CircumferentialBuckle.prototype.description=function(){var t="";return t=this.apexY<=-380?"280 circumferential buckle ":this.apexY<=-350?"279 circumferential buckle ":"277 circumferential buckle ",this.arc>1.8*Math.PI?t+="encirclement":t+=this.clockHourExtent()+" o'clock",t},ED.CNV=function(t,e){this.className="CNV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CNV.prototype=new ED.Doodle,ED.CNV.prototype.constructor=ED.CNV,ED.CNV.superclass=ED.Doodle.prototype,ED.CNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CNV.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.CNV.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.CNV.prototype.draw=function(t){var e=this.drawing.context;ED.CNV.superclass.draw.call(this,t),e.beginPath();var i=2*Math.PI/16,r=.5*Math.PI/16,a=new ED.Point(0,0),o=new ED.Point(0,0);o.setWithPolars(80,0),e.moveTo(o.x,o.y);for(var n=80,s=0;s<16;s++){var l=80*(4+ED.randomArray[s])/4,h=new ED.Point(0,0);h.setWithPolars(n,s*i+r);var d=new ED.Point(0,0);d.setWithPolars(l,(s+1)*i-r);var c=new ED.Point(0,0);c.setWithPolars(l,(s+1)*i),n=l,15==s?e.bezierCurveTo(h.x,h.y,d.x,d.y,o.x,o.y):e.bezierCurveTo(h.x,h.y,d.x,d.y,c.x,c.y),1==s&&(a.x=c.x,a.y=c.y)}return e.closePath(),e.lineWidth=0,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,64,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,190,1)",e.fill()),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CNV.prototype.description=function(){return"CNV"},ED.CNV.prototype.snomedCode=function(){return 75971007},ED.CNV.prototype.diagnosticHierarchy=function(){return 0},ED.Conjunctivitis=function(t,e){this.className="Conjunctivitis",this.type="Papillary",this.mucopurulent=!1,this.hyperaemia="+",this.savedParameterArray=["type","mucopurulent","hyperaemia"],this.controlParameterArray={type:"Type",mucopurulent:"Mucopurulent",hyperaemia:"Hyperaemia"},ED.Doodle.call(this,t,e)},ED.Conjunctivitis.prototype=new ED.Doodle,ED.Conjunctivitis.prototype.constructor=ED.Conjunctivitis,ED.Conjunctivitis.superclass=ED.Doodle.prototype,ED.Conjunctivitis.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.type={kind:"other",type:"string",list:["Papillary","Follicular"],animate:!1},this.parameterValidationArray.mucopurulent={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.hyperaemia={kind:"other",type:"string",list:["+","++","+++"],animate:!1}},ED.Conjunctivitis.prototype.setParameterDefaults=function(){},ED.Conjunctivitis.prototype.draw=function(t){var e=this.drawing.context;ED.AntSeg.superclass.draw.call(this,t);var i=380,r=(this.apexY,-Math.PI/2),a=2*Math.PI-Math.PI/2;e.beginPath();e.lineTo(0,-i),e.bezierCurveTo(-350,-i,-500,-150,-500,0),e.bezierCurveTo(-500,150,-350,380,0,380),e.bezierCurveTo(350,380,500,150,500,0),e.bezierCurveTo(500,-150,350,-i,0,-i),e.arc(0,0,i,r,a,!1),e.lineWidth=4;var o=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return e.fillStyle=o,e.strokeStyle="pink","+"==this.hyperaemia&&(e.filter="opacity(10%)"),"++"==this.hyperaemia&&(e.filter="opacity(30%)"),"+++"==this.hyperaemia&&(e.filter="opacity(50%)"),this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,e.filter="none",this.isClicked},ED.Conjunctivitis.prototype.description=function(){var t=this.type+" conjunctivitis";return this.mucopurulent&&(t+=", mucopurulent,"),t+=" with "+this.hyperaemia+" hyperaemia"},ED.Conjunctiva=function(t,e){this.className="Conjunctiva",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.Conjunctiva.prototype=new ED.Doodle,ED.Conjunctiva.prototype.constructor=ED.Conjunctiva,ED.Conjunctiva.superclass=ED.Doodle.prototype,ED.Conjunctiva.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Conjunctiva.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0)},ED.Conjunctiva.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.Conjunctiva.prototype.draw=function(t){var e=this.drawing.context;ED.Conjunctiva.superclass.draw.call(this,t);var i=288,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,476,a,o,!0),e.arc(0,0,100,o,a,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=[47,41,35,28,22,15],c=0;for(i=446;i>100;i-=60){for(var p=0,y=-Math.PI/2-a;y<this.arc-Math.PI/2-a;y+=60/i){y=-Math.PI/2-a+2*p*Math.PI/d[c];var D=new ED.Point(0,0);D.setWithPolars(i,y),this.drawLaserSpot(e,D.x,D.y),this.drawCircle(e,D.x,D.y,i,"brown",1,"brown"),p++}c++}}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ConjunctivalFlap=function(t,e){this.className="ConjunctivalFlap",this.method="Fornix-based",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.ConjunctivalFlap.prototype=new ED.Doodle,ED.ConjunctivalFlap.prototype.constructor=ED.ConjunctivalFlap,ED.ConjunctivalFlap.superclass=ED.Doodle.prototype,ED.ConjunctivalFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-640,-100),this.parameterValidationArray.apexY.delta=30,this.parameterValidationArray.arc.range.setMinAndMax(60*Math.PI/180,160*Math.PI/180),this.parameterValidationArray.method={kind:"derived",type:"string",list:["Fornix-based","Limbus-based"],animate:!0}},ED.ConjunctivalFlap.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setParameterFromString("method","Fornix-based")},ED.ConjunctivalFlap.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.method=e<-380?"Fornix-based":"Limbus-based";break;case"method":switch(e){case"Fornix-based":i.apexY=-660;break;case"Limbus-based":i.apexY=-100}}return i},ED.ConjunctivalFlap.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var i=380,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=(this.arc,new ED.Point(this.apexX,this.apexY)),s=new ED.Point(i*Math.sin(r),-i*Math.cos(r)),l=new ED.Point(-i*Math.sin(r),-i*Math.cos(r));e.beginPath(),e.arc(0,0,i,a,o,!0);return e.bezierCurveTo(l.x,l.y,.8*l.x,n.y,n.x,n.y),e.bezierCurveTo(.8*s.x,n.y,s.x,s.y,s.x,s.y),e.fillStyle="rgba(255,255,255,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(l),this.handleArray[3].location=this.transform.transformPoint(s),this.handleArray[4].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ConjunctivalFlap.prototype.description=function(){return(this.apexY<-280?"Fornix based ":"Limbus based ")+"flap"},ED.ConjunctivalSuture=function(t,e){this.className="ConjunctivalSuture",this.boundaryWidth=180,this.boundaryHeight=180,this.type="Buried Mattress",this.material="Nylon",this.size="10/0",this.savedParameterArray=["originX","originY","rotation","isOrientated","type","material","size"],this.controlParameterArray={isOrientated:"Orientated",type:"Type",material:"Material",size:"Size"},ED.Doodle.call(this,t,e)},ED.ConjunctivalSuture.prototype=new ED.Doodle,ED.ConjunctivalSuture.prototype.constructor=ED.ConjunctivalSuture,ED.ConjunctivalSuture.superclass=ED.Doodle.prototype,ED.ConjunctivalSuture.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalSuture.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.handleArray[2].isVisible=!1,this.parameterValidationArray.apexX.range.setMinAndMax(80,220),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Purse String","Mattress","Buried Mattress","Interrupted","Continuous"],animate:!1},this.parameterValidationArray.material={kind:"derived",type:"string",list:["Nylon","Prolene","Vicryl","Silk"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["11/0","10/0","9/0","8/0","7/0","6/0"],animate:!1},this.parameterValidationArray.isOrientated={kind:"derived",type:"bool",display:!1}},ED.ConjunctivalSuture.prototype.setParameterDefaults=function(){this.apexX=this.boundaryWidth/2,this.setParameterFromString("type","Purse String");var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY);(i=new ED.Point(0,0)).setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else{var i=new ED.Point(0,0),r=this.drawing.eye==ED.eye.Right?11:1;i.setWithPolars(290,r*Math.PI/6),this.move(i.x,i.y)}},ED.ConjunctivalSuture.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"type":"Mattress"==e||"Continuous"==e?(this.boundaryWidth=160,this.boundaryHeight=50,this.parameterValidationArray.apexX.range.setMinAndMax(80,220),this.handleArray[4].isVisible=!0):(this.boundaryWidth=100,this.boundaryHeight=100,this.parameterValidationArray.apexX.range.setMinAndMax(50,50),this.handleArray[4].isVisible=!1),this.apexX=this.boundaryWidth/2;break;case"isOrientated":this.handleArray[2].isVisible="true"!=e;break;case"apexX":this.boundaryWidth=2*this.apexX}return i},ED.ConjunctivalSuture.prototype.draw=function(t){var e=this.drawing.context;if(ED.ConjunctivalSuture.superclass.draw.call(this,t),e.beginPath(),e.rect(-this.boundaryWidth/2,-this.boundaryHeight/2,this.boundaryWidth,this.boundaryHeight),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle=e.fillStyle,this.isSelected&&(e.strokeStyle="gray"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=this.boundaryHeight/2;switch(e.beginPath(),this.type){case"Purse String":e.arc(0,0,i,0,2*Math.PI,!0),e.moveTo(-20,i+20),e.lineTo(0,i),e.lineTo(20,i+20);break;case"Mattress":e.rect(-this.boundaryWidth/2,-this.boundaryHeight/2,this.boundaryWidth,this.boundaryHeight);var r=-this.boundaryWidth/2+40;e.moveTo(r-20,i+20),e.lineTo(r,i),e.lineTo(r+20,i+20);break;case"Buried Mattress":e.moveTo(10-i,-i),e.lineTo(i-10,-i),e.lineTo(i-40,i),e.lineTo(40-i,i),e.lineTo(10-i,-i),e.moveTo(-20,i+20),e.lineTo(0,i),e.lineTo(20,i+20);break;case"Interrupted":e.moveTo(0,-i),e.bezierCurveTo(-10,30-i,-10,i-30,0,i),e.bezierCurveTo(10,i-30,10,30-i,0,-i),e.moveTo(-20,i+20),e.lineTo(0,i),e.lineTo(20,i+20);break;case"Continuous":var a=-this.boundaryWidth/2;for(e.moveTo(a,0);a+40<this.boundaryWidth/2;)a+=20,e.lineTo(a,-20),a+=20,e.lineTo(a,20);e.lineTo(a+20,0),e.closePath()}e.lineWidth=4,e.strokeStyle="blue",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(-this.boundaryWidth/2,-this.boundaryHeight/2)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ConjunctivalSuture.prototype.description=function(){return this.size+" "+this.material+" "+this.type+" conjunctival suture at "+this.clockHour()+" o'clock"},ED.ContinuousCornealSuture=function(t,e){this.className="ContinuousCornealSuture",this.pixelsPerMillimetre=63.3333;var i=t.firstDoodleOfClass("CornealGraft");this.cornealGraft=i||null,this.setParametersFromCornealGraft(),this.suture="Nylon 10-0",this.removed=!1,this.sutureBites=16,this.biteLength=2,this.sutureLength=this.biteLength*this.pixelsPerMillimetre,this.savedParameterArray=["originX","originY","apexX","radius","rotation","removed","suture","sutureBites","biteLength","sutureLength"],this.controlParameterArray={removed:"Removed",suture:"Suture",sutureBites:"Suture bites",biteLength:"Bite length"},ED.Doodle.call(this,t,e)},ED.ContinuousCornealSuture.prototype=new ED.Doodle,ED.ContinuousCornealSuture.prototype.constructor=ED.ContinuousCornealSuture,ED.ContinuousCornealSuture.superclass=ED.Doodle.prototype,ED.ContinuousCornealSuture.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ContinuousCornealSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(6.5*this.pixelsPerMillimetre/2,15*this.pixelsPerMillimetre/2),this.parameterValidationArray.suture={kind:"derived",type:"string",list:["Nylon 10-0","Nylon 11-0","Prolene","Vicryl"],animate:!1},this.parameterValidationArray.removed={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.sutureBites={kind:"other",type:"int",range:new ED.Range(8,40),animate:!1},this.parameterValidationArray.biteLength={kind:"other",type:"int",range:new ED.Range(1,3),animate:!1}},ED.ContinuousCornealSuture.prototype.setParametersFromCornealGraft=function(){this.cornealGraft&&(this.radius=this.cornealGraft.diameter*this.pixelsPerMillimetre/2,this.originX=this.cornealGraft.originX,this.originY=this.cornealGraft.originY)},ED.ContinuousCornealSuture.prototype.setParameterDefaults=function(){this.apexX=11.9*this.pixelsPerMillimetre/2-50,this.radius=374,this.setRotationWithDisplacements(0,30),this.setParametersFromCornealGraft();var t=this.drawing.allDoodlesOfClass(this.className);if(t.length>0){var e=t[t.length-1];this.setParameterWithAnimation("suture",e.suture),this.setParameterWithAnimation("sutureBites",e.sutureBites),this.setParameterWithAnimation("biteLength",e.biteLength),this.setParameterWithAnimation("apexX",e.apexX),t.push(this);for(var i=2*Math.PI/t.length/e.sutureBites,r=0;r<t.length;r++)t[r].setSimpleParameter("rotation",r*i)}},ED.ContinuousCornealSuture.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"biteLength":i.sutureLength=e*this.pixelsPerMillimetre;break;case"apexX":i.radius=50+e}return i},ED.ContinuousCornealSuture.prototype.draw=function(t){var e=this.drawing.context;if(ED.ContinuousCornealSuture.superclass.draw.call(this,t),this.cornealGraft&&(this.radius=this.cornealGraft.diameter*this.pixelsPerMillimetre/2),e.beginPath(),e.arc(0,0,this.radius+this.sutureLength/2,0,2*Math.PI,!0),e.arc(0,0,this.radius-this.sutureLength/2,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=0,e.strokeStyle="rgba(255,255,255,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=this.radius+this.sutureLength/2,r=this.radius-this.sutureLength/2;e.beginPath();for(var a=0;a<this.sutureBites;a++){var o=2*a*Math.PI/this.sutureBites,n=o+Math.PI/this.sutureBites,s=new ED.Point(0,0);s.setWithPolars(r,o);var l=new ED.Point(0,0);l.setWithPolars(i,n),0==o?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y),e.lineTo(l.x,l.y)}e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(0,0,0,0.8)",this.removed?e.strokeStyle="rgba(150,150,150,0.5)":"Vicryl"==this.suture?e.strokeStyle="rgba(55,0,123,1)":"Prolene"==this.suture&&(e.strokeStyle="rgba(0,15,90,1)"),e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),!this.isSelected||this.isForDrawing||this.cornealGraft||this.drawHandles(t),this.isClicked},ED.ContinuousCornealSuture.prototype.description=function(){return"Continuous corneal suture"},ED.Cornea=function(t,e){this.className="Cornea",this.shape="",this.pachymetry=540,this.savedParameterArray=["shape","pachymetry","csOriginX","csApexX","csApexY"],ED.Doodle.call(this,t,e)},ED.Cornea.prototype=new ED.Doodle,ED.Cornea.prototype.constructor=ED.Cornea,ED.Cornea.superclass=ED.Doodle.prototype,ED.Cornea.prototype.setParameterDefaults=function(){this.csOriginX=50,this.csApexX=-363,this.csApexY=0,this.setParameterFromString("shape","Normal"),this.setParameterFromString("pachymetry","540")},ED.Cornea.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.willReport=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-365,-300),this.parameterValidationArray.apexY.range.setMinAndMax(-100,100),this.parameterValidationArray.shape={kind:"other",type:"string",list:["Normal","Keratoconus","Keratoglobus"],animate:!1},this.parameterValidationArray.pachymetry={kind:"other",type:"int",range:new ED.Range(400,700),precision:1,animate:!1}},ED.Cornea.prototype.draw=function(t){return!1},ED.Cornea.prototype.description=function(){return this.shape&&"Normal"!=this.shape?this.shape:""},ED.CorneaCrossSection=function(t,e){this.className="CorneaCrossSection",this.shape="",this.pachymetry=540,this.savedParameterArray=["shape","pachymetry","originX","apexX","apexY"],this.controlParameterArray={shape:"Shape",pachymetry:"Pachymetry"},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={Cornea:{source:["shape","pachymetry"],store:[["apexX","csApexX"],["apexY","csApexY"],["originX","csOriginX"]]}}},ED.CorneaCrossSection.prototype=new ED.Doodle,ED.CorneaCrossSection.prototype.constructor=ED.CorneaCrossSection,ED.CorneaCrossSection.superclass=ED.Doodle.prototype,ED.CorneaCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorneaCrossSection.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-365,-300),this.parameterValidationArray.apexY.range.setMinAndMax(-100,100),this.parameterValidationArray.shape={kind:"other",type:"string",list:["Normal","Keratoconus","Keratoglobus"],animate:!1},this.parameterValidationArray.pachymetry={kind:"other",type:"int",range:new ED.Range(400,700),precision:1,animate:!1}},ED.CorneaCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.apexX=-363,this.apexY=0,this.setParameterFromString("shape","Normal"),this.setParameterFromString("pachymetry","540")},ED.CorneaCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"pachymetry":i.pachymetry=e}return i},ED.CorneaCrossSection.prototype.draw=function(t){var e=this.drawing.context;switch(ED.CorneaCrossSection.superclass.draw.call(this,t),e.beginPath(),e.moveTo(60,-480),e.lineTo(-80,-480),e.bezierCurveTo(-100,-440,-100,-440,-120,-380),this.shape){case"Normal":e.bezierCurveTo(-240,-260,-320,-160,-320,0),e.bezierCurveTo(-320,160,-240,260,-120,380);break;case"Keratoconus":e.bezierCurveTo(-240,-260,this.apexX,this.apexY-100,this.apexX,this.apexY),e.bezierCurveTo(this.apexX,this.apexY+100,-240,260,-120,380);break;case"Keratoglobus":e.bezierCurveTo(-240,-260,-380,-100,-380,100),e.bezierCurveTo(-380,200,-240,360,-120,380)}e.bezierCurveTo(-100,440,-100,440,-80,480),e.lineTo(60,480),e.lineTo(0,380);var i=this.pachymetry/5;switch(this.shape){case"Normal":e.bezierCurveTo(-80,260,-220,180,-220,0),e.bezierCurveTo(-220,-180,-80,-260,0,-380);break;case"Keratoconus":e.bezierCurveTo(-80,260,this.apexX+i,this.apexY+120,this.apexX+i,this.apexY),e.bezierCurveTo(this.apexX+i,this.apexY-120,-80,-260,0,-380);break;case"Keratoglobus":e.bezierCurveTo(-80,260,-260,220,-280,100),e.bezierCurveTo(-280,-140,-120,-200,0,-380)}return e.closePath(),e.lineWidth=4,e.fillStyle="rgba(245, 245, 245, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(56,-478),e.lineTo(-78,-478),e.bezierCurveTo(-98,-440,-96,-440,-118,-378),e.lineTo(-4,-378),e.lineTo(56,-478),e.moveTo(56,478),e.lineTo(-78,478),e.bezierCurveTo(-98,440,-96,440,-118,378),e.lineTo(-4,378),e.closePath(),e.fillStyle="rgba(255,255,185,1)",e.fill()),"Keratoconus"==this.shape&&(this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t)),this.isClicked},ED.CorneaCrossSection.prototype.description=function(){var t=[];return"Normal"!==this.shape&&t.push(this.shape),(t=t.join(", ")).charAt(0).toUpperCase()+t.slice(1)},ED.CornealAbrasion=function(t,e){this.className="CornealAbrasion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealAbrasion.prototype=new ED.Doodle,ED.CornealAbrasion.prototype.constructor=ED.CornealAbrasion,ED.CornealAbrasion.superclass=ED.Doodle.prototype,ED.CornealAbrasion.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealAbrasion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealAbrasion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealAbrasion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealAbrasion.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,120,0,2*Math.PI,!1),e.closePath();this.apexY;e.fillStyle="rgba(0, 255, 0, 1)",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(120,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealAbrasion.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=e<2?"Small ":e<4?"Medium ":"Large ",t+="corneal abrasion"},ED.CornealEpithelialDefect=function(t,e){this.className="CornealEpithelialDefect",this.numberOfHandles=4,this.initialRadius=81,this.resetWidth=!0,this.resetHeight=!0,this.resetInfiltrate=!0,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.savedParameterArray=["originX","originY","rotation","height","width"],this.controlParameterArray={height:"Height",width:"Width"},ED.Doodle.call(this,t,e)},ED.CornealEpithelialDefect.prototype=new ED.Doodle,ED.CornealEpithelialDefect.prototype.constructor=ED.CornealEpithelialDefect,ED.CornealEpithelialDefect.superclass=ED.Doodle.prototype,ED.CornealEpithelialDefect.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.CornealEpithelialDefect.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,380),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.originX.range.setMinAndMax(-350,350),this.parameterValidationArray.originY.range.setMinAndMax(-350,350),this.parameterValidationArray.height={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.width={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.resetWidth={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.resetHeight={kind:"derived",type:"bool",display:!1}},ED.CornealEpithelialDefect.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"width":i.resetWidth=!0;break;case"height":i.resetHeight=!0}return i},ED.CornealEpithelialDefect.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+100,t.originY);this.move(e.x,e.y)}else this.move(150,50);var i=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(i);for(var r=0;r<this.numberOfHandles;r++){var a=new ED.Point(0,0);a.setWithPolars(this.initialRadius,2*r*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}},ED.CornealEpithelialDefect.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.CornealEpithelialDefect.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles),s=[0,.125,.25,.375,.5,.625,.75,.875,1],l="",h="";if(this.resetWidth)this.squiggleArray[0].pointsArray[1].x=.5*this.width*54,this.squiggleArray[0].pointsArray[3].x=.5*this.width*-54,this.resetWidth=!1;else{for(var d="",c="",p=(this.squiggleArray[0],0);p<this.numberOfHandles;p++){e=this.squiggleArray[0].pointsArray[p];var y=p<this.numberOfHandles-1?p+1:0;i=this.squiggleArray[0].pointsArray[y];for(var D=e.x,u=e.tangentialControlPoint(+n).x,g=i.tangentialControlPoint(-n).x,P=i.x,E=0;E<s.length;E++){var m=(1-(v=s[E]))*(1-v)*(1-v)*D+3*(1-v)*(1-v)*v*u+3*(1-v)*v*v*g+v*v*v*P;(""==d||m>d)&&(d=m),(""==c||m<c)&&(c=m)}}this.width=Math.round((d-c)/54),this.w=this.width}if(this.resetHeight)this.squiggleArray[0].pointsArray[0].y=.5*this.height*-54,this.squiggleArray[0].pointsArray[2].y=.5*this.height*54,this.resetHeight=!1,l=this.squiggleArray[0].pointsArray[0].y,h=this.squiggleArray[0].pointsArray[2].y;else{for(this.squiggleArray[0],p=0;p<this.numberOfHandles;p++){e=this.squiggleArray[0].pointsArray[p];y=p<this.numberOfHandles-1?p+1:0;i=this.squiggleArray[0].pointsArray[y];var f=e.y,w=e.tangentialControlPoint(+n).y,x=i.tangentialControlPoint(-n).y,b=i.y;for(E=0;E<s.length;E++){var v,A=(1-(v=s[E]))*(1-v)*(1-v)*f+3*(1-v)*(1-v)*v*w+3*(1-v)*v*v*x+v*v*v*b;(""==h||A>h)&&(h=A),(""==l||A<l)&&(l=A)}}this.height=Math.round((h-l)/54),this.h=this.height}o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(p=0;p<this.numberOfHandles;p++){e=this.squiggleArray[0].pointsArray[p];y=p<this.numberOfHandles-1?p+1:0;i=this.squiggleArray[0].pointsArray[y],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=1,o.fillStyle="rgba(50,205,50,0.8)",o.strokeStyle="rgba(50,205,50,1)",this.drawBoundary(t);for(p=0;p<this.numberOfHandles;p++)this.handleArray[p].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[p]);return this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealEpithelialDefect.prototype.description=function(){return"Epithelial defect H-W: "+this.height+"x"+this.width+"mm"},ED.CornealErosion=function(t,e){this.className="CornealErosion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealErosion.prototype=new ED.Doodle,ED.CornealErosion.prototype.constructor=ED.CornealErosion,ED.CornealErosion.superclass=ED.Doodle.prototype,ED.CornealErosion.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealErosion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealErosion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealErosion.prototype.draw=function(t){var e=this.drawing.context;ED.CornealErosion.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,120,0,2*Math.PI,!1),e.closePath(),e.lineWidth=3,e.fillStyle="rgba(230, 230, 230, 0.25)",e.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(120,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealErosion.prototype.groupDescription=function(){return"Removal of some corneal epithelium"},ED.CornealGraft=function(t,e){this.className="CornealGraft",this.pixelsPerMillimetre=63.3333,this.antsegRadius=190,this.diameter=9,this.depth=100,this.interruptedSutures=0,this.existingSutures=0,this.csOriginX=50,this.d=100,this.savedParameterArray=["originX","originY","apexY","depth","d","interruptedSutures","existingSutures","csOriginX"],this.controlParameterArray={depth:"Depth (%)",interruptedSutures:"Interrupted sutures"};for(var i=t.allDoodlesOfClass("CornealSuture"),r=t.allDoodlesOfClass("ContinuousCornealSuture"),a=i.concat(r),o=0;o<a.length;o++){var n=a[o];n.cornealGraft||(n.cornealGraft=this,n.setParametersFromCornealGraft())}ED.Doodle.call(this,t,e)},ED.CornealGraft.prototype=new ED.Doodle,ED.CornealGraft.prototype.constructor=ED.CornealGraft,ED.CornealGraft.superclass=ED.Doodle.prototype,ED.CornealGraft.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.CornealGraft.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-11.9*this.pixelsPerMillimetre/2,-6.5*this.pixelsPerMillimetre/2),this.handleCoordinateRangeArray=new Array,this.handleCoordinateRangeArray[0]={x:new ED.Range(-0,0),y:new ED.Range(-2.9*this.pixelsPerMillimetre/2,2.5*this.pixelsPerMillimetre/2)},this.parameterValidationArray.depth={kind:"derived",type:"int",range:new ED.Range(1,100),precision:1,animate:!1},this.parameterValidationArray.d={kind:"other",type:"int",range:new ED.Range(1,100),animate:!1},this.parameterValidationArray.interruptedSutures={kind:"other",type:"int",range:new ED.Range(0,50),animate:!1},this.parameterValidationArray.existingSutures={kind:"other",type:"int",range:new ED.Range(0,50),animate:!1},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(6.5,12),animate:!0}},ED.CornealGraft.prototype.setParameterDefaults=function(){this.setParameterFromString("diameter","9.0");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(0,0);this.addPointToSquiggle(e),this.existingSutures=this.drawing.numberOfDoodlesOfClass("CornealSuture")},ED.CornealGraft.prototype.dependentParameterValues=function(t,e){var i=[];if((c=this.drawing.allDoodlesOfClass("ContinuousCornealSuture")).length>0)for(var r=0;r<c.length;r++)c[r].cornealGraft===this&&(void 0===c[r].originX&&c[r].setSimpleParameter("originX",this.originX),void 0===c[r].originY&&c[r].setSimpleParameter("originY",this.originY));switch(t){case"apexY":i.diameter=-2*e/this.pixelsPerMillimetre;var a=Math.sqrt((this.antsegRadius+this.antsegRadius+e)*(this.antsegRadius+this.antsegRadius+e)-this.originX*this.originX),o=Math.sqrt((this.antsegRadius+this.antsegRadius+e)*(this.antsegRadius+this.antsegRadius+e)-this.originY*this.originY);this.parameterValidationArray.originY.range.setMinAndMax(-a,+a),this.parameterValidationArray.originX.range.setMinAndMax(-o,+o);var n=this.parameterValidationArray.originX.range.constrain(this.originX),s=this.parameterValidationArray.originY.range.constrain(this.originY);this.setSimpleParameter("originY",s),this.setSimpleParameter("originX",n);break;case"diameter":i.apexY=-e*this.pixelsPerMillimetre/2;break;case"originX":a=Math.sqrt((this.antsegRadius+this.antsegRadius+this.apexY)*(this.antsegRadius+this.antsegRadius+this.apexY)-e*e);if(this.parameterValidationArray.originY.range.setMinAndMax(-a,+a),this.drawing.isActive)s=this.parameterValidationArray.originY.range.constrain(this.originY);else var s=this.originY;if(this.setSimpleParameter("originY",s),c.length>0)for(r=0;r<c.length;r++)c[r].cornealGraft===this&&c[r].setSimpleParameter("originX",e);if((p=this.drawing.allDoodlesOfClass("CornealSuture")).length>0)for(var l=0;l<p.length;l++)p[l].cornealGraft===this&&p[l].setSimpleParameter("originX",e);(h=this.drawing.lastDoodleOfClass("CornealGraftRejection"))&&h.cornealGraft==this&&(h.setSimpleParameter("originX",e),h.computeDoodleHeight());break;case"originY":var h;o=Math.sqrt((this.antsegRadius+this.antsegRadius+this.apexY)*(this.antsegRadius+this.antsegRadius+this.apexY)-e*e);if(this.parameterValidationArray.originX.range.setMinAndMax(-o,+o),this.drawing.isActive)n=this.parameterValidationArray.originX.range.constrain(this.originX);else var n=this.originX;if(this.setSimpleParameter("originX",n),(c=this.drawing.allDoodlesOfClass("ContinuousCornealSuture")).length>0)for(r=0;r<c.length;r++)c[r].cornealGraft==this&&c[r].setSimpleParameter("originY",e);if((p=this.drawing.allDoodlesOfClass("CornealSuture")).length>0)for(r=0;r<p.length;r++)p[r].cornealGraft==this&&p[r].setSimpleParameter("originY",e);(h=this.drawing.lastDoodleOfClass("CornealGraftRejection"))&&h.cornealGraft==this&&(h.setSimpleParameter("originY",e),h.computeDoodleHeight());break;case"depth":i.d=parseInt(e);break;case"handles":var d=this.squiggleArray[0].pointsArray[0].y-9*this.pixelsPerMillimetre/2;i.diameter=-2*d/this.pixelsPerMillimetre,i.apexY=d;a=Math.sqrt((this.antsegRadius+this.antsegRadius+d)*(this.antsegRadius+this.antsegRadius+d)-this.originX*this.originX),o=Math.sqrt((this.antsegRadius+this.antsegRadius+d)*(this.antsegRadius+this.antsegRadius+d)-this.originY*this.originY);this.parameterValidationArray.originY.range.setMinAndMax(-a,+a),this.parameterValidationArray.originX.range.setMinAndMax(-o,+o);var c,p;n=this.parameterValidationArray.originX.range.constrain(this.originX),s=this.parameterValidationArray.originY.range.constrain(this.originY);if(this.setSimpleParameter("originY",s),this.setSimpleParameter("originX",n),(c=this.drawing.allDoodlesOfClass("ContinuousCornealSuture")).length>0)for(r=0;r<c.length;r++)c[r].cornealGraft==this&&(c[r].setSimpleParameter("originY",s),c[r].setSimpleParameter("originX",n));if((p=this.drawing.allDoodlesOfClass("CornealSuture")).length>0)for(r=0;r<p.length;r++)p[r].cornealGraft==this&&(p[r].setSimpleParameter("originY",s),p[r].setSimpleParameter("originX",n));break;case"interruptedSutures":if(this.drawing.isActive){var y=e-this.getSutures();if(y>0)for(r=0;r<y;r++)this.drawing.addDoodle("CornealSuture");else if(y<0){y=Math.abs(y);for(r=0;r<y;r++){var D=this.drawing.lastDoodleOfClass("CornealSuture");this.drawing.deleteDoodle(D)}}for(var u=this.drawing.allDoodlesOfClass("CornealSuture"),g=2*Math.PI/e,P=0;P<u.length;P++)u[P].setSimpleParameter("rotation",g*P)}}return i},ED.CornealGraft.prototype.draw=function(t){var e=this.drawing.context;ED.CornealGraft.superclass.draw.call(this,t),e.beginPath();var i=-this.apexY;return e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(255, 255, 255, 0)",e.stroke(),this.drawBoundary(t),e.closePath(),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealGraft.prototype.snomedCode=function(){return"Full"==this.depth?424960002:0},ED.CornealGraft.prototype.description=function(){this.interruptedSutures=this.getSutures();var t="Penetrating keratoplasty";return this.depth<100&&(t="Deep anterior lamellar keratoplasty"),t},ED.CornealGraft.prototype.getSutures=function(){for(var t=this.drawing.allDoodlesOfClass("CornealSuture"),e=0,i=0;i<t.length;i++)t[i].cornealGraft!==this||t[i].removed||e++;return e},ED.CornealGraftCrossSection=function(t,e){this.className="CornealGraftCrossSection",this.pixelsPerMillimetre=63.3333,this.initialRadius=360,this.diameter=9,this.d=100,this.savedParameterArray=["originX","originY","apexY","d","diameter"],this.controlParameterArray={},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={CornealGraft:{source:["originY","apexY","d","diameter"],store:[["originX","csOriginX"]]}}},ED.CornealGraftCrossSection.prototype=new ED.Doodle,ED.CornealGraftCrossSection.prototype.constructor=ED.CornealGraftCrossSection,ED.CornealGraftCrossSection.superclass=ED.Doodle.prototype,ED.CornealGraftCrossSection.prototype.setHandles=function(){},ED.CornealGraftCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isUnique=!1,this.isFilled=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-12*this.pixelsPerMillimetre/2,-6.5*this.pixelsPerMillimetre/2),this.parameterValidationArray.d={kind:"other",type:"int",range:new ED.Range(1,100),animate:!1},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(6.5,12),precision:1,animate:!0}},ED.CornealGraftCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.setParameterFromString("diameter","9.0")},ED.CornealGraftCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.diameter=-2*e/this.pixelsPerMillimetre;break;case"diameter":i.apexY=-e*this.pixelsPerMillimetre/2;break;case"d":i.d=parseInt(e)}return i},ED.CornealGraftCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=i.pachymetry/5;ED.CornealGraftCrossSection.superclass.draw.call(this,t),e.beginPath();var a=this.originY+this.apexY,o=this.originY-this.apexY,n=(a+380)/760;n<0&&(n=0);var s=(o+380)/760;if(s>1&&(s=1),n<.5){var l=new Object,h=new Object,d=2*n,c=s<.5?2*s:1;if(i&&"Keratoconus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(i.apexX,i.apexY-100-this.originY),l.EP=new ED.Point(i.apexX,i.apexY-this.originY),h.SP=new ED.Point(120*this.d/100-120,-380-this.originY),h.CP1=new ED.Point(160*this.d/100-240,-260-this.originY),h.CP2=new ED.Point(i.apexX+r*this.d/100,i.apexY-120-this.originY),h.EP=new ED.Point(i.apexX+r*this.d/100,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-380,-100-this.originY),l.EP=new ED.Point(-380,100-this.originY),h.SP=new ED.Point(120*this.d/100-120,-380-this.originY),h.CP1=new ED.Point(120*this.d/100-240,-200-this.originY),h.CP2=new ED.Point(100*this.d/100-380,-140-this.originY),h.EP=new ED.Point(100*this.d/100-380,100-this.originY)):(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-320,-160-this.originY),l.EP=new ED.Point(-320,0-this.originY),h.SP=new ED.Point(120*this.d/100-120,-380-this.originY),h.CP1=new ED.Point(160*this.d/100-240,-260-this.originY),h.CP2=new ED.Point(100*this.d/100-320,-160-this.originY),h.EP=new ED.Point(100*this.d/100-320,0-this.originY)),d>0){(S=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*l.SP.y+3*(1-d)*(1-d)*d*l.CP1.y+3*(1-d)*d*d*l.CP2.y+d*d*d*l.EP.y,S.x=(1-d)*(1-d)*(1-d)*l.SP.x+3*(1-d)*(1-d)*d*l.CP1.x+3*(1-d)*d*d*l.CP2.x+d*d*d*l.EP.x,(P=new ED.Point(0,0)).x=l.CP1.x+d*(l.CP2.x-l.CP1.x),P.y=l.CP1.y+d*(l.CP2.y-l.CP1.y);var p=new ED.Point(0,0);p.x=l.CP2.x+d*(l.EP.x-l.CP2.x),p.y=l.CP2.y+d*(l.EP.y-l.CP2.y);var y=new ED.Point(0,0);y.x=P.x+d*(p.x-P.x),y.y=P.y+d*(p.y-P.y),l.SP=S,l.CP1=y,l.CP2=p,(k=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*h.SP.y+3*(1-d)*(1-d)*d*h.CP1.y+3*(1-d)*d*d*h.CP2.y+d*d*d*h.EP.y,k.x=(1-d)*(1-d)*(1-d)*h.SP.x+3*(1-d)*(1-d)*d*h.CP1.x+3*(1-d)*d*d*h.CP2.x+d*d*d*h.EP.x,(w=new ED.Point(0,0)).x=h.CP1.x+d*(h.CP2.x-h.CP1.x),w.y=h.CP1.y+d*(h.CP2.y-h.CP1.y);var D=new ED.Point(0,0);D.x=h.CP2.x+d*(h.EP.x-h.CP2.x),D.y=h.CP2.y+d*(h.EP.y-h.CP2.y);var u=new ED.Point(0,0);u.x=w.x+d*(D.x-w.x),u.y=w.y+d*(D.y-w.y),h.SP=k,h.CP1=u,h.CP2=D}if(c<1){var g=new ED.Point(0,0);g.y=(1-c)*(1-c)*(1-c)*l.SP.y+3*(1-c)*(1-c)*c*l.CP1.y+3*(1-c)*c*c*l.CP2.y+c*c*c*l.EP.y,g.x=(1-c)*(1-c)*(1-c)*l.SP.x+3*(1-c)*(1-c)*c*l.CP1.x+3*(1-c)*c*c*l.CP2.x+c*c*c*l.EP.x;var P,E=new ED.Point(0,0);E.x=l.SP.x+c*(l.CP1.x-l.SP.x),E.y=l.SP.y+c*(l.CP1.y-l.SP.y),(P=new ED.Point(0,0)).x=l.CP1.x+c*(l.CP2.x-l.CP1.x),P.y=l.CP1.y+c*(l.CP2.y-l.CP1.y);var m=new ED.Point(0,0);m.x=E.x+c*(P.x-E.x),m.y=E.y+c*(P.y-E.y),l.CP1=E,l.CP2=m,l.EP=g;var f=new ED.Point(0,0);f.y=(1-c)*(1-c)*(1-c)*h.SP.y+3*(1-c)*(1-c)*c*h.CP1.y+3*(1-c)*c*c*h.CP2.y+c*c*c*h.EP.y,f.x=(1-c)*(1-c)*(1-c)*h.SP.x+3*(1-c)*(1-c)*c*h.CP1.x+3*(1-c)*c*c*h.CP2.x+c*c*c*h.EP.x;var w,x=new ED.Point(0,0);x.x=h.SP.x+c*(h.CP1.x-h.SP.x),x.y=h.SP.y+c*(h.CP1.y-h.SP.y),(w=new ED.Point(0,0)).x=h.CP1.x+c*(h.CP2.x-h.CP1.x),w.y=h.CP1.y+c*(h.CP2.y-h.CP1.y);var b=new ED.Point(0,0);b.x=x.x+c*(w.x-x.x),b.y=x.y+c*(w.y-x.y),h.CP1=x,h.CP2=b,h.EP=f}}if(s>.5){var v=new Object,A=new Object,C=n>.5?2*(n-.5):0,M=2*(s-.5);if(i&&"Keratoconus"==i.shape?(v.SP=new ED.Point(i.apexX,i.apexY-this.originY),v.CP1=new ED.Point(i.apexX,i.apexY+100-this.originY),v.CP2=new ED.Point(-240,260-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(i.apexX+r*this.d/100,i.apexY-this.originY),A.CP1=new ED.Point(i.apexX+r*this.d/100,i.apexY+120-this.originY),A.CP2=new ED.Point(160*this.d/100-240,260-this.originY),A.EP=new ED.Point(120*this.d/100-120,380-this.originY)):i&&"Keratoglobus"==i.shape?(v.SP=new ED.Point(-380,100-this.originY),v.CP1=new ED.Point(-380,200-this.originY),v.CP2=new ED.Point(-240,360-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(100*this.d/100-380,100-this.originY),A.CP1=new ED.Point(120*this.d/100-380,220-this.originY),A.CP2=new ED.Point(160*this.d/100-240,260-this.originY),A.EP=new ED.Point(120*this.d/100-120,380-this.originY)):(v.SP=new ED.Point(-320,-0-this.originY),v.CP1=new ED.Point(-320,160-this.originY),v.CP2=new ED.Point(-240,260-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(100*this.d/100-320,-0-this.originY),A.CP1=new ED.Point(100*this.d/100-320,160-this.originY),A.CP2=new ED.Point(160*this.d/100-240,260-this.originY),A.EP=new ED.Point(120*this.d/100-120,380-this.originY)),C>0){var S;(S=new ED.Point(0,0)).y=(1-C)*(1-C)*(1-C)*v.SP.y+3*(1-C)*(1-C)*C*v.CP1.y+3*(1-C)*C*C*v.CP2.y+C*C*C*v.EP.y,S.x=(1-C)*(1-C)*(1-C)*v.SP.x+3*(1-C)*(1-C)*C*v.CP1.x+3*(1-C)*C*C*v.CP2.x+C*C*C*v.EP.x,(X=new ED.Point(0,0)).x=v.CP1.x+C*(v.CP2.x-v.CP1.x),X.y=v.CP1.y+C*(v.CP2.y-v.CP1.y);var T=new ED.Point(0,0);T.x=v.CP2.x+C*(v.EP.x-v.CP2.x),T.y=v.CP2.y+C*(v.EP.y-v.CP2.y);var k,Y=new ED.Point(0,0);Y.x=X.x+C*(T.x-X.x),Y.y=X.y+C*(T.y-X.y),v.SP=S,v.CP1=Y,v.CP2=T,(k=new ED.Point(0,0)).y=(1-C)*(1-C)*(1-C)*A.SP.y+3*(1-C)*(1-C)*C*A.CP1.y+3*(1-C)*C*C*A.CP2.y+C*C*C*A.EP.y,k.x=(1-C)*(1-C)*(1-C)*A.SP.x+3*(1-C)*(1-C)*C*A.CP1.x+3*(1-C)*C*C*A.CP2.x+C*C*C*A.EP.x,(W=new ED.Point(0,0)).x=A.CP1.x+C*(A.CP2.x-A.CP1.x),W.y=A.CP1.y+C*(A.CP2.y-A.CP1.y);var I=new ED.Point(0,0);I.x=A.CP2.x+C*(A.EP.x-A.CP2.x),I.y=A.CP2.y+C*(A.EP.y-A.CP2.y);var H=new ED.Point(0,0);H.x=W.x+C*(I.x-W.x),H.y=W.y+C*(I.y-W.y),A.SP=k,A.CP1=H,A.CP2=I}if(M<1){var R=new ED.Point(0,0);R.y=(1-M)*(1-M)*(1-M)*v.SP.y+3*(1-M)*(1-M)*M*v.CP1.y+3*(1-M)*M*M*v.CP2.y+M*M*M*v.EP.y,R.x=(1-M)*(1-M)*(1-M)*v.SP.x+3*(1-M)*(1-M)*M*v.CP1.x+3*(1-M)*M*M*v.CP2.x+M*M*M*v.EP.x;var X,V=new ED.Point(0,0);V.x=v.SP.x+M*(v.CP1.x-v.SP.x),V.y=v.SP.y+M*(v.CP1.y-v.SP.y),(X=new ED.Point(0,0)).x=v.CP1.x+M*(v.CP2.x-v.CP1.x),X.y=v.CP1.y+M*(v.CP2.y-v.CP1.y);var F=new ED.Point(0,0);F.x=V.x+M*(X.x-V.x),F.y=V.y+M*(X.y-V.y),v.CP1=V,v.CP2=F,v.EP=R;var O=new ED.Point(0,0);O.y=(1-M)*(1-M)*(1-M)*A.SP.y+3*(1-M)*(1-M)*M*A.CP1.y+3*(1-M)*M*M*A.CP2.y+M*M*M*A.EP.y,O.x=(1-M)*(1-M)*(1-M)*A.SP.x+3*(1-M)*(1-M)*M*A.CP1.x+3*(1-M)*M*M*A.CP2.x+M*M*M*A.EP.x;var W,z=new ED.Point(0,0);z.x=A.SP.x+M*(A.CP1.x-A.SP.x),z.y=A.SP.y+M*(A.CP1.y-A.SP.y),(W=new ED.Point(0,0)).x=A.CP1.x+M*(A.CP2.x-A.CP1.x),W.y=A.CP1.y+M*(A.CP2.y-A.CP1.y);var L=new ED.Point(0,0);L.x=z.x+M*(W.x-z.x),L.y=z.y+M*(W.y-z.y),A.CP1=z,A.CP2=L,A.EP=O}}return v&&(e.moveTo(v.EP.x,v.EP.y),e.lineTo(A.EP.x,A.EP.y),this.d<100&&e.bezierCurveTo(A.CP2.x,A.CP2.y,A.CP1.x,A.CP1.y,A.SP.x,A.SP.y),e.moveTo(v.EP.x,v.EP.y)),l&&(this.d<100&&(e.moveTo(h.EP.x,h.EP.y),e.bezierCurveTo(h.CP2.x,h.CP2.y,h.CP1.x,h.CP1.y,h.SP.x,h.SP.y)),e.moveTo(h.SP.x,h.SP.y),e.lineTo(l.SP.x,l.SP.y)),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0,0,0,0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealGraftSuture=function(t,e){this.className="CornealGraftSuture",this.pixelsPerMillimetre=63.3333,this.tension="Loose",this.proudKnot=!1,this.savedParameterArray=["radius","rotation","tension","proudKnot"],this.controlParameterArray={tension:"Tension",proudKnot:"Proud Knot"},ED.Doodle.call(this,t,e)},ED.CornealGraftSuture.prototype=new ED.Doodle,ED.CornealGraftSuture.prototype.constructor=ED.CornealGraftSuture,ED.CornealGraftSuture.superclass=ED.Doodle.prototype,ED.CornealGraftSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.tension={kind:"derived",type:"string",list:["Loose","Tight"],animate:!1},this.parameterValidationArray.proudKnot={kind:"derived",type:"bool",display:!0}},ED.CornealGraftSuture.prototype.setParameterDefaults=function(){this.setParameterFromString("tension","Tight"),this.setParameterFromString("proudKnot","False");var t=this.drawing.lastDoodleOfClass("CornealGraft");if(t){this.radius=t.diameter*this.pixelsPerMillimetre/2;var e=360/t.numberOfSutures;this.setRotationWithDisplacements(0,-e)}else this.radius=374,this.setRotationWithDisplacements(0,30)},ED.CornealGraftSuture.prototype.draw=function(t){var e=this.drawing.context;ED.CornealGraftSuture.superclass.draw.call(this,t);var i=this.drawing.lastDoodleOfClass("CornealGraft");i&&(this.radius=i.diameter*this.pixelsPerMillimetre/2),e.beginPath();var r=this.radius;if(e.rect(-20,-(r+40),40,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=6,e.strokeStyle=this.isSelected?"rgba(120,120,120,0.5)":"rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),"Loose"==this.tension?(e.moveTo(0,-r-40),e.bezierCurveTo(-20,-r-20,20,20-r,0,40-r)):(e.moveTo(0,-r-40),e.lineTo(0,40-r)),e.moveTo(-10,10-r),e.lineTo(0,20-r),e.lineTo(-10,30-r),e.lineWidth=2;e.strokeStyle="rgba(0,0,120,0.7)",e.stroke();var a=this.proudKnot?8:4;this.drawSpot(e,0,20-r,a,"rgba(0,0,120,0.7)")}return this.isClicked},ED.CornealGraftSuture.prototype.description=function(){var t="Corneal suture at ";return t+=this.clockHour()+" o'clock"},ED.CornealInlay=function(t,e){this.className="CornealInlay",this.type="Type 1",this.savedParameterArray=["scaleX","scaleY","rotation","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.CornealInlay.prototype=new ED.Doodle,ED.CornealInlay.prototype.constructor=ED.CornealInlay,ED.CornealInlay.superclass=ED.Doodle.prototype,ED.CornealInlay.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.75,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.75,1),this.parameterValidationArray.type={kind:"other",type:"string",list:["Type 1","Type 2"],animate:!1}},ED.CornealInlay.prototype.setParameterDefaults=function(){},ED.CornealInlay.prototype.draw=function(t){var e=this.drawing.context;ED.CornealInlay.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,200,0,i,!0),e.arc(0,0,100,0,i,!1),e.lineWidth=2,e.fillStyle="rgba(155,155,155,0.8)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.CornealInlay.prototype.description=function(){return"Corneal inlay "+this.type},ED.CornealLaceration=function(t,e){this.className="CornealLaceration",this.plane=0,this.lacerationDepth=0,this.lacType="laceration",this.complete=!1,this.irisProlapse=!1,this.boundaryMin=-450,this.boundaryWidth=900,this.numberOfHandles=0,this.mousePoint=new ED.Point(-550,-550),this.savedParameterArray=["complete","lacerationDepth","numberOfHandles","irisProlapse"],this.controlParameterArray={lacerationDepth:"Laceration Depth %",irisProlapse:"Iris prolapse"},ED.Doodle.call(this,t,e)},ED.CornealLaceration.prototype=new ED.Doodle,ED.CornealLaceration.prototype.constructor=ED.CornealLaceration,ED.CornealLaceration.superclass=ED.Doodle.prototype,ED.CornealLaceration.prototype.setHandles=function(){if(this.numberOfHandles>0)for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.CornealLaceration.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isFilled=!1,this.isMoveable=!1,this.parameterValidationArray.lacerationDepth={kind:"other",type:"int",range:new ED.Range(1,100),animate:!1},this.parameterValidationArray.lacType={kind:"derived",type:"string",list:["laceration","cornealscleral laceration"],animate:!1},this.parameterValidationArray.irisProlapse={kind:"derived",type:"bool",display:!1};var t=this;t.drawing.canvas.addEventListener("dblclick",function(e){t.isSelected&&!t.complete&&(t.complete=!0,t.drawing.repaint())},!1),this.drawing.canvas.addEventListener("mousemove",function(e){if(!t.complete){var i=ED.findPosition(this,e),r=t.drawing.inverseTransform.transformPoint(i);t.mousePoint=new ED.Point(r.x,r.y),t.drawing.repaint()}},!1),this.drawing.canvas.addEventListener("mousedown",function(e){if(null==t.draggingHandleIndex&&t.isSelected&&!t.complete){var i=ED.findPosition(this,e),r=t.drawing.inverseTransform.transformPoint(i);r.x>t.boundaryMin&&r.y>t.boundaryMin&&r.x<t.boundaryMin+t.boundaryWidth&&r.y<t.boundaryMin+t.boundaryWidth&&t.addHandle(r)}},!1)},ED.CornealLaceration.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t)},ED.CornealLaceration.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"handles":i.lacType=this.calculateLacerationType();break;case"complete":this.complete&&(this.numberOfHandles=this.squiggleArray[0].pointsArray.length-1,this.setHandles())}return i},ED.CornealLaceration.prototype.draw=function(t){var e=this.drawing.context;if(ED.CornealLaceration.superclass.draw.call(this,t),e.beginPath(),this.complete){this.hitTestMethod="stroke";var i=this.squiggleArray[0];e.strokeStyle="rgba(0, 0, 0, 0)",e.lineWidth=10;for(var r=this.numberOfHandles-1;r>=0;r--)e.lineTo(i.pointsArray[r].x,i.pointsArray[r].y);e.stroke()}else e.rect(this.boundaryMin,this.boundaryMin,this.boundaryWidth,this.boundaryWidth),this.hitTestMethod="path",e.lineWidth=2;if(e.closePath(),this.isFilled=!1,e.strokeStyle="rgba(255, 255, 255, 0)",this.isSelected&&!this.complete&&(e.strokeStyle="gray"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.numberOfHandles>0){i=this.squiggleArray[0];e.beginPath(),e.lineWidth=5,e.strokeStyle="blue";for(r=this.numberOfHandles-1;r>=0;r--)e.lineTo(i.pointsArray[r].x,i.pointsArray[r].y);this.isSelected&&null==this.draggingHandleIndex&&!this.complete&&this.mousePoint.x>this.boundaryMin&&this.mousePoint.y>this.boundaryMin&&this.mousePoint.x<this.boundaryMin+this.boundaryWidth&&this.mousePoint.y<this.boundaryMin+this.boundaryWidth&&e.lineTo(this.mousePoint.x,this.mousePoint.y),e.stroke()}!this.complete&&this.isSelected&&this.mousePoint.x>this.boundaryMin&&this.mousePoint.y>this.boundaryMin&&this.mousePoint.x<this.boundaryMin+this.boundaryWidth&&this.mousePoint.y<this.boundaryMin+this.boundaryWidth&&(e.beginPath(),e.arc(this.mousePoint.x,this.mousePoint.y,25,0,2*Math.PI),e.strokeStyle="red",e.fillStyle="yellow",e.fill(),e.stroke())}if(this.numberOfHandles>0)for(r=0;r<this.numberOfHandles;r++)this.handleArray[r].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[r]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealLaceration.prototype.description=function(){var t=this.squiggleArray[0],e=(this.numberOfHandles>=2?6*Math.sqrt(Math.pow(t.pointsArray[0].x-t.pointsArray[this.numberOfHandles-1].x,2)+Math.pow(t.pointsArray[0].y-t.pointsArray[this.numberOfHandles-1].y,2))/380:0).toFixed(2);this.lacType=this.calculateLacerationType();var i="";return 100==this.lacerationDepth?i+="Full thickness "+this.lacType+" "+e+"mm":this.lacerationDepth>0?i+="Partial thickness "+this.lacType+" "+e+"mm, "+this.lacerationDepth+"%":i+=this.lacType+" "+e+"mm",this.irisProlapse&&(i+=" with iris prolapse"),i},ED.CornealLaceration.prototype.calculateLacerationType=function(){for(var t=0,e=!1;!e&&t<this.numberOfHandles;){var i=this.squiggleArray[0].pointsArray[t];Math.sqrt(i.x*i.x+i.y*i.y)>380&&(e=!0),t++}return e?"corneoscleral laceration":"corneal laceration"},ED.CornealLaceration.prototype.addHandle=function(t){this.squiggleArray[0].pointsArray.splice(0,0,t),this.handleArray.splice(0,0,new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)),this.numberOfHandles++,this.lacType=this.calculateLacerationType(),this.updateDependentParameters("handles")},ED.CornealLaceration.prototype.snomedCodes=function(){var t=[[95725002,3]];return this.irisProlapse&&t.push([77676001,3]),t},ED.CornealOedema=function(t,e){this.className="CornealOedema",this.numberOfHandles=4,this.initialRadius=360,this.intensity="Mild",this.i=1,this.stromal=!0,this.epithelial=!1,this.endothelial=!1,this.savedParameterArray=["originX","originY","apexX","apexY","rotation","intensity","stromal","epithelial","endothelial","i"],this.controlParameterArray={intensity:"Intensity",epithelial:"Epithelial",stromal:"Stromal",endothelial:"Endothelial"},ED.Doodle.call(this,t,e)},ED.CornealOedema.prototype=new ED.Doodle,ED.CornealOedema.prototype.constructor=ED.CornealOedema,ED.CornealOedema.superclass=ED.Doodle.prototype,ED.CornealOedema.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealOedema.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.intensity={kind:"derived",type:"string",list:["Mild","Moderate","Severe"],animate:!1},this.parameterValidationArray.stromal={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.epithelial={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.endothelial={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.epi={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.str={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.endo={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.i={kind:"other",type:"int",range:[1,2,3],animate:!1}},ED.CornealOedema.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius,this.setParameterFromString("stromal","true"),this.setParameterFromString("epithelial","false"),this.setParameterFromString("endothelial","false"),this.rotation=Math.PI/4},ED.CornealOedema.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"intensity":switch(e){case"Mild":i.i=1;break;case"Moderate":i.i=2;break;case"Severe":i.i=3}break;case"epithelial":1==e?i.epi=1:0==e&&(i.epi=0);break;case"stromal":1==e?i.str=1:0==e&&(i.str=0);break;case"endothelial":1==e?i.endo=1:0==e&&(i.endo=0)}return i},ED.CornealOedema.prototype.draw=function(t){var e=this.drawing.context;ED.CornealOedema.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);switch(e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,this.intensity){case"Mild":e.fillStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPattern,"repeat");break;case"Severe":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPatternBullous,"repeat")}if(e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw);return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealOedema.prototype.description=function(){return"Corneal oedema"},ED.CornealOedemaCrossSection=function(t,e){this.className="CornealOedemaCrossSection",this.initialRadius=360,this.intensity="Mild",this.i=1,this.epi=0,this.str=1,this.endo=0,this.stromal=!0,this.epithelial=!1,this.endothelial=!1,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.h=Math.round(2*this.initialRadius/54),this.w=Math.round(2*this.initialRadius/54),this.minY=-1*this.initialRadius,this.maxY=this.initialRadius,this.savedParameterArray=["originX","originY","apexX","apexY","rotation","intensity","stromal","epithelial","endothelial","i"],this.controlParameterArray={},ED.Doodle.call(this,t,e)},ED.CornealOedemaCrossSection.prototype=new ED.Doodle,ED.CornealOedemaCrossSection.prototype.constructor=ED.CornealOedemaCrossSection,ED.CornealOedemaCrossSection.superclass=ED.Doodle.prototype,ED.CornealOedemaCrossSection.prototype.setHandles=function(){},ED.CornealOedemaCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.parameterValidationArray.originX.range.setMinAndMax(50,50),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.intensity={kind:"derived",type:"string",list:["Mild","Moderate","Severe"],animate:!1},this.parameterValidationArray.stromal={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.epithelial={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.endothelial={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.i={kind:"other",type:"int",range:[1,2,3],animate:!1},this.parameterValidationArray.epi={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.str={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.endo={kind:"other",type:"int",range:[0,1],animate:!1}},ED.CornealOedemaCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"i":i.intensity=3===e?"Severe":2===e?"Moderate":"Mild"}return i},ED.CornealOedemaCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.apexY=-this.initialRadius},ED.CornealOedemaCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=i.pachymetry/5;ED.CornealOedemaCrossSection.superclass.draw.call(this,t),e.beginPath();var a=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY),o=this.originY-a,n=this.originY+a,s=(o+380)/760;s<0&&(s=0);var l=(n+380)/760;if(l>1&&(l=1),s<.5){var h=new Object,d=new Object,c=2*s,p=l<.5?2*l:1;if(i&&"Keratoconus"==i.shape?(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(i.apexX,i.apexY-100-this.originY),h.EP=new ED.Point(i.apexX,i.apexY-this.originY),d.SP=new ED.Point(0,-380-this.originY),d.CP1=new ED.Point(-80,-260-this.originY),d.CP2=new ED.Point(i.apexX+r,i.apexY-120-this.originY),d.EP=new ED.Point(i.apexX+r,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(-380,-100-this.originY),h.EP=new ED.Point(-380,100-this.originY),d.SP=new ED.Point(0,-380-this.originY),d.CP1=new ED.Point(-120,-200-this.originY),d.CP2=new ED.Point(-280,-140-this.originY),d.EP=new ED.Point(-280,100-this.originY)):(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(-320,-160-this.originY),h.EP=new ED.Point(-320,0-this.originY),d.SP=new ED.Point(0,-380-this.originY),d.CP1=new ED.Point(-80,-260-this.originY),d.CP2=new ED.Point(-220,-160-this.originY),d.EP=new ED.Point(-220,0-this.originY)),c>0){(T=new ED.Point(0,0)).y=(1-c)*(1-c)*(1-c)*h.SP.y+3*(1-c)*(1-c)*c*h.CP1.y+3*(1-c)*c*c*h.CP2.y+c*c*c*h.EP.y,T.x=(1-c)*(1-c)*(1-c)*h.SP.x+3*(1-c)*(1-c)*c*h.CP1.x+3*(1-c)*c*c*h.CP2.x+c*c*c*h.EP.x,(E=new ED.Point(0,0)).x=h.CP1.x+c*(h.CP2.x-h.CP1.x),E.y=h.CP1.y+c*(h.CP2.y-h.CP1.y);var y=new ED.Point(0,0);y.x=h.CP2.x+c*(h.EP.x-h.CP2.x),y.y=h.CP2.y+c*(h.EP.y-h.CP2.y);var D=new ED.Point(0,0);D.x=E.x+c*(y.x-E.x),D.y=E.y+c*(y.y-E.y),h.SP=T,h.CP1=D,h.CP2=y,(Y=new ED.Point(0,0)).y=(1-c)*(1-c)*(1-c)*d.SP.y+3*(1-c)*(1-c)*c*d.CP1.y+3*(1-c)*c*c*d.CP2.y+c*c*c*d.EP.y,Y.x=(1-c)*(1-c)*(1-c)*d.SP.x+3*(1-c)*(1-c)*c*d.CP1.x+3*(1-c)*c*c*d.CP2.x+c*c*c*d.EP.x,(x=new ED.Point(0,0)).x=d.CP1.x+c*(d.CP2.x-d.CP1.x),x.y=d.CP1.y+c*(d.CP2.y-d.CP1.y);var u=new ED.Point(0,0);u.x=d.CP2.x+c*(d.EP.x-d.CP2.x),u.y=d.CP2.y+c*(d.EP.y-d.CP2.y);var g=new ED.Point(0,0);g.x=x.x+c*(u.x-x.x),g.y=x.y+c*(u.y-x.y),d.SP=Y,d.CP1=g,d.CP2=u}if(p<1){var P=new ED.Point(0,0);P.y=(1-p)*(1-p)*(1-p)*h.SP.y+3*(1-p)*(1-p)*p*h.CP1.y+3*(1-p)*p*p*h.CP2.y+p*p*p*h.EP.y,P.x=(1-p)*(1-p)*(1-p)*h.SP.x+3*(1-p)*(1-p)*p*h.CP1.x+3*(1-p)*p*p*h.CP2.x+p*p*p*h.EP.x;var E,m=new ED.Point(0,0);m.x=h.SP.x+p*(h.CP1.x-h.SP.x),m.y=h.SP.y+p*(h.CP1.y-h.SP.y),(E=new ED.Point(0,0)).x=h.CP1.x+p*(h.CP2.x-h.CP1.x),E.y=h.CP1.y+p*(h.CP2.y-h.CP1.y);var f=new ED.Point(0,0);f.x=m.x+p*(E.x-m.x),f.y=m.y+p*(E.y-m.y),h.CP1=m,h.CP2=f,h.EP=P;var w=new ED.Point(0,0);w.y=(1-p)*(1-p)*(1-p)*d.SP.y+3*(1-p)*(1-p)*p*d.CP1.y+3*(1-p)*p*p*d.CP2.y+p*p*p*d.EP.y,w.x=(1-p)*(1-p)*(1-p)*d.SP.x+3*(1-p)*(1-p)*p*d.CP1.x+3*(1-p)*p*p*d.CP2.x+p*p*p*d.EP.x;var x,b=new ED.Point(0,0);b.x=d.SP.x+p*(d.CP1.x-d.SP.x),b.y=d.SP.y+p*(d.CP1.y-d.SP.y),(x=new ED.Point(0,0)).x=d.CP1.x+p*(d.CP2.x-d.CP1.x),x.y=d.CP1.y+p*(d.CP2.y-d.CP1.y);var v=new ED.Point(0,0);v.x=b.x+p*(x.x-b.x),v.y=b.y+p*(x.y-b.y),d.CP1=b,d.CP2=v,d.EP=w}}if(l>.5){var A=new Object,C=new Object,M=s>.5?2*(s-.5):0,S=2*(l-.5);if(i&&"Keratoconus"==i.shape?(A.SP=new ED.Point(i.apexX,i.apexY-this.originY),A.CP1=new ED.Point(i.apexX,i.apexY+100-this.originY),A.CP2=new ED.Point(-240,260-this.originY),A.EP=new ED.Point(-120,380-this.originY),C.SP=new ED.Point(i.apexX+r,i.apexY-this.originY),C.CP1=new ED.Point(i.apexX+r,i.apexY+120-this.originY),C.CP2=new ED.Point(-80,260-this.originY),C.EP=new ED.Point(0,380-this.originY)):i&&"Keratoglobus"==i.shape?(A.SP=new ED.Point(-380,100-this.originY),A.CP1=new ED.Point(-380,200-this.originY),A.CP2=new ED.Point(-240,360-this.originY),A.EP=new ED.Point(-120,380-this.originY),C.SP=new ED.Point(-280,100-this.originY),C.CP1=new ED.Point(-260,220-this.originY),C.CP2=new ED.Point(-80,260-this.originY),C.EP=new ED.Point(0,380-this.originY)):(A.SP=new ED.Point(-320,-0-this.originY),A.CP1=new ED.Point(-320,160-this.originY),A.CP2=new ED.Point(-240,260-this.originY),A.EP=new ED.Point(-120,380-this.originY),C.SP=new ED.Point(-220,-0-this.originY),C.CP1=new ED.Point(-220,160-this.originY),C.CP2=new ED.Point(-80,260-this.originY),C.EP=new ED.Point(0,380-this.originY)),M>0){var T;(T=new ED.Point(0,0)).y=(1-M)*(1-M)*(1-M)*A.SP.y+3*(1-M)*(1-M)*M*A.CP1.y+3*(1-M)*M*M*A.CP2.y+M*M*M*A.EP.y,T.x=(1-M)*(1-M)*(1-M)*A.SP.x+3*(1-M)*(1-M)*M*A.CP1.x+3*(1-M)*M*M*A.CP2.x+M*M*M*A.EP.x,(V=new ED.Point(0,0)).x=A.CP1.x+M*(A.CP2.x-A.CP1.x),V.y=A.CP1.y+M*(A.CP2.y-A.CP1.y);var k=new ED.Point(0,0);k.x=A.CP2.x+M*(A.EP.x-A.CP2.x),k.y=A.CP2.y+M*(A.EP.y-A.CP2.y);var Y,I=new ED.Point(0,0);I.x=V.x+M*(k.x-V.x),I.y=V.y+M*(k.y-V.y),A.SP=T,A.CP1=I,A.CP2=k,(Y=new ED.Point(0,0)).y=(1-M)*(1-M)*(1-M)*C.SP.y+3*(1-M)*(1-M)*M*C.CP1.y+3*(1-M)*M*M*C.CP2.y+M*M*M*C.EP.y,Y.x=(1-M)*(1-M)*(1-M)*C.SP.x+3*(1-M)*(1-M)*M*C.CP1.x+3*(1-M)*M*M*C.CP2.x+M*M*M*C.EP.x,(z=new ED.Point(0,0)).x=C.CP1.x+M*(C.CP2.x-C.CP1.x),z.y=C.CP1.y+M*(C.CP2.y-C.CP1.y);var H=new ED.Point(0,0);H.x=C.CP2.x+M*(C.EP.x-C.CP2.x),H.y=C.CP2.y+M*(C.EP.y-C.CP2.y);var R=new ED.Point(0,0);R.x=z.x+M*(H.x-z.x),R.y=z.y+M*(H.y-z.y),C.SP=Y,C.CP1=R,C.CP2=H}if(S<1){var X=new ED.Point(0,0);X.y=(1-S)*(1-S)*(1-S)*A.SP.y+3*(1-S)*(1-S)*S*A.CP1.y+3*(1-S)*S*S*A.CP2.y+S*S*S*A.EP.y,X.x=(1-S)*(1-S)*(1-S)*A.SP.x+3*(1-S)*(1-S)*S*A.CP1.x+3*(1-S)*S*S*A.CP2.x+S*S*S*A.EP.x;var V,F=new ED.Point(0,0);F.x=A.SP.x+S*(A.CP1.x-A.SP.x),F.y=A.SP.y+S*(A.CP1.y-A.SP.y),(V=new ED.Point(0,0)).x=A.CP1.x+S*(A.CP2.x-A.CP1.x),V.y=A.CP1.y+S*(A.CP2.y-A.CP1.y);var O=new ED.Point(0,0);O.x=F.x+S*(V.x-F.x),O.y=F.y+S*(V.y-F.y),A.CP1=F,A.CP2=O,A.EP=X;var W=new ED.Point(0,0);W.y=(1-S)*(1-S)*(1-S)*C.SP.y+3*(1-S)*(1-S)*S*C.CP1.y+3*(1-S)*S*S*C.CP2.y+S*S*S*C.EP.y,W.x=(1-S)*(1-S)*(1-S)*C.SP.x+3*(1-S)*(1-S)*S*C.CP1.x+3*(1-S)*S*S*C.CP2.x+S*S*S*C.EP.x;var z,L=new ED.Point(0,0);L.x=C.SP.x+S*(C.CP1.x-C.SP.x),L.y=C.SP.y+S*(C.CP1.y-C.SP.y),(z=new ED.Point(0,0)).x=C.CP1.x+S*(C.CP2.x-C.CP1.x),z.y=C.CP1.y+S*(C.CP2.y-C.CP1.y);var B=new ED.Point(0,0);B.x=L.x+S*(z.x-L.x),B.y=L.y+S*(z.y-L.y),C.CP1=L,C.CP2=B,C.EP=W}}if(A&&(e.moveTo(C.EP.x,C.EP.y),e.bezierCurveTo(C.CP2.x,C.CP2.y,C.CP1.x,C.CP1.y,C.SP.x,C.SP.y),e.lineTo(A.SP.x,A.SP.y),e.bezierCurveTo(A.CP1.x,A.CP1.y,A.CP2.x,A.CP2.y,A.EP.x,A.EP.y)),h&&(e.moveTo(d.EP.x,d.EP.y),e.bezierCurveTo(d.CP2.x,d.CP2.y,d.CP1.x,d.CP1.y,d.SP.x,d.SP.y),e.lineTo(h.SP.x,h.SP.y),e.bezierCurveTo(h.CP1.x,h.CP1.y,h.CP2.x,h.CP2.y,h.EP.x,h.EP.y)),e.closePath(),e.lineWidth=0,1==this.str)switch(this.intensity){case"Mild":e.fillStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPattern,"repeat");break;case"Severe":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPatternBullous,"repeat")}else e.fillStyle="rgba(0,0,0,0)";if(e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(1==this.epi){switch(e.beginPath(),A&&(e.moveTo(A.SP.x,A.SP.y),e.bezierCurveTo(A.CP1.x,A.CP1.y,A.CP2.x,A.CP2.y,A.EP.x,A.EP.y)),h&&(e.moveTo(h.SP.x,h.SP.y),e.bezierCurveTo(h.CP1.x,h.CP1.y,h.CP2.x,h.CP2.y,h.EP.x,h.EP.y)),this.intensity){case"Mild":e.strokeStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.strokeStyle="rgba(0, 0, 255, 0.3)";break;case"Severe":e.strokeStyle="rgba(0, 0, 255, 0.4)"}e.lineWidth=8,e.stroke()}if(1==this.endo){switch(e.beginPath(),A&&(e.moveTo(C.SP.x,C.SP.y),e.bezierCurveTo(C.CP1.x,C.CP1.y,C.CP2.x,C.CP2.y,C.EP.x,C.EP.y)),h&&(e.moveTo(d.SP.x,d.SP.y),e.bezierCurveTo(d.CP1.x,d.CP1.y,d.CP2.x,d.CP2.y,d.EP.x,d.EP.y)),this.intensity){case"Mild":e.strokeStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.strokeStyle="rgba(0, 0, 255, 0.3)";break;case"Severe":e.strokeStyle="rgba(0, 0, 255, 0.4)"}e.lineWidth=8,e.stroke()}}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealOpacity=function(t,e){this.className="CornealOpacity",this.numberOfHandles=4,this.initialRadius=81,this.resetWidth=!0,this.resetInfiltrate=!0,this.bezierTimeIntervals=[0,.125,.25,.375,.5,.625,.75,.875,1],this.minX=this.minY=-1*this.initialRadius,this.maxX=this.maxY=this.initialRadius,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.depth=33,this.infiltrateWidth=0,this.h=Math.round(2*this.initialRadius/54),this.w=Math.round(2*this.initialRadius/54),this.d=33,this.iW=0,this.savedParameterArray=["originX","originY","rotation","height","width","depth","infiltrateWidth","h","w","d","iW","minY","maxY"],this.controlParameterArray={height:"Height",width:"Width",depth:"Depth (%)",infiltrateWidth:"Infiltrate width"},ED.Doodle.call(this,t,e)},ED.CornealOpacity.prototype=new ED.Doodle,ED.CornealOpacity.prototype.constructor=ED.CornealOpacity,ED.CornealOpacity.superclass=ED.Doodle.prototype,ED.CornealOpacity.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.CornealOpacity.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,380),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.originX.range.setMinAndMax(-350,350),this.parameterValidationArray.originY.range.setMinAndMax(-350,350),this.parameterValidationArray.height={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.width={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.depth={kind:"other",type:"int",range:new ED.Range(1,100),precision:1,animate:!1},this.parameterValidationArray.infiltrateWidth={kind:"other",type:"int",range:new ED.Range(0,15),precision:1,animate:!1},this.parameterValidationArray.h={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.w={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.iW={kind:"other",type:"int",range:[0,15],animate:!1},this.parameterValidationArray.d={kind:"other",type:"int",range:[1,100],animate:!1},this.parameterValidationArray.resetWidth={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.resetInfiltrate={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.minY={kind:"other",type:"int",range:[-500,500],animate:!1},this.parameterValidationArray.maxY={kind:"other",type:"int",range:[-500,500],animate:!1}},ED.CornealOpacity.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"width":i.resetWidth=!0,i.w=parseInt(e);break;case"height":this.squiggleArray[0].pointsArray[0].y=.5*e*-54,this.squiggleArray[0].pointsArray[2].y=.5*e*54,i.h=parseInt(e),i.minY=this.calculateMinY(),i.maxY=this.calculateMaxY();break;case"infiltrateWidth":i.resetInfiltrate=!0,i.iW=parseInt(e);break;case"depth":i.d=parseInt(e);break;case"h":i.h=e;break;case"d":i.depth=e;break;case"w":i.w=e;break;case"iW":i.infiltrateWidth=e;break;case"minY":i.minY=e;break;case"maxY":i.maxY=e;break;case"handles":i.w=this.calculateWidth(),i.h=this.calculateHeight(),i.height=this.calculateHeight(),i.minY=this.calculateMinY(),i.maxY=this.calculateMaxY()}return i},ED.CornealOpacity.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+100,1);this.move(e.x,e.y)}else this.move(100,1);var i=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(i);for(var r=0;r<this.numberOfHandles;r++){(a=new ED.Point(0,0)).setWithPolars(this.initialRadius,2*r*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}for(r=0;r<this.numberOfHandles;r++){var a;(a=new ED.Point(0,0)).setWithPolars(this.initialRadius,2*r*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}},ED.CornealOpacity.prototype.getPhi=function(){return 2*Math.PI/(3*this.numberOfHandles)},ED.CornealOpacity.prototype.calculateWidth=function(){for(var t="",e="",i=this.getPhi(),r=(this.squiggleArray[0],0);r<this.numberOfHandles;r++){fp=this.squiggleArray[0].pointsArray[r];var a=r<this.numberOfHandles-1?r+1:0;tp=this.squiggleArray[0].pointsArray[a];for(var o=fp.x,n=fp.tangentialControlPoint(+i).x,s=tp.tangentialControlPoint(-i).x,l=tp.x,h=0;h<this.bezierTimeIntervals.length;h++){var d=this.bezierTimeIntervals[h],c=(1-d)*(1-d)*(1-d)*o+3*(1-d)*(1-d)*d*n+3*(1-d)*d*d*s+d*d*d*l;(""==t||c>t)&&(t=c),(""==e||c<e)&&(e=c)}}return this.maxX=t,this.minX=e,Math.round((t-e)/54)},ED.CornealOpacity.prototype.calculateHeight=function(){var t=this.calculateMinY(),e=this.calculateMaxY();return Math.round((e-t)/54)},ED.CornealOpacity.prototype.calculateMinY=function(){for(var t=this.getPhi(),e="",i=(this.squiggleArray[0],0);i<this.numberOfHandles;i++){fp=this.squiggleArray[0].pointsArray[i];var r=i<this.numberOfHandles-1?i+1:0;tp=this.squiggleArray[0].pointsArray[r];for(var a=fp.y,o=fp.tangentialControlPoint(+t).y,n=tp.tangentialControlPoint(-t).y,s=tp.y,l=0;l<this.bezierTimeIntervals.length;l++){var h=this.bezierTimeIntervals[l],d=(1-h)*(1-h)*(1-h)*a+3*(1-h)*(1-h)*h*o+3*(1-h)*h*h*n+h*h*h*s;(""==e||d<=e)&&(e=d)}}return e},ED.CornealOpacity.prototype.calculateMaxY=function(){for(var t=this.getPhi(),e="",i="",r=(this.squiggleArray[0],0);r<this.numberOfHandles;r++){fp=this.squiggleArray[0].pointsArray[r];var a=r<this.numberOfHandles-1?r+1:0;tp=this.squiggleArray[0].pointsArray[a];for(var o=fp.y,n=fp.tangentialControlPoint(+t).y,s=tp.tangentialControlPoint(-t).y,l=tp.y,h=0;h<this.bezierTimeIntervals.length;h++){var d=this.bezierTimeIntervals[h],c=(1-d)*(1-d)*(1-d)*o+3*(1-d)*(1-d)*d*n+3*(1-d)*d*d*s+d*d*d*l;(""==i||c>i)&&(i=c),(""==e||c<e)&&(e=c)}}return i},ED.CornealOpacity.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.CornealOpacity.superclass.draw.call(this,t),o.beginPath();var n=this.getPhi();this.resetWidth?(this.squiggleArray[0].pointsArray[1].x=.5*this.width*54,this.squiggleArray[0].pointsArray[3].x=.5*this.width*-54,this.resetWidth=!1):this.width=this.calculateWidth(),o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=4,o.fillStyle="gray",o.strokeStyle="gray",this.drawBoundary(t);for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);if(this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.infiltrateWidth>0){var h=54*this.infiltrateWidth,d=this.numberOfHandles,c=[];this.resetInfiltrate=!1;for(s=0;s<this.numberOfHandles;s++){var p=this.squiggleArray[0].pointsArray[s],y=Math.abs(p.x),D=Math.abs(p.y),u=Math.sqrt(y*y+D*D)+h,g=Math.atan(D/y),P=u*Math.sin(g),E=u*Math.cos(g),m=p.x>=0?1:-1,f=p.y>=0?1:-1,w=new ED.Point(E*m,P*f);c.push(w),this.squiggleArray[0].pointsArray[d+s]=w}o.beginPath(),o.moveTo(this.squiggleArray[0].pointsArray[4].x,this.squiggleArray[0].pointsArray[4].y);for(var x=0;x<this.numberOfHandles;x++){e=this.squiggleArray[0].pointsArray[x+d];l=x<this.numberOfHandles-1?x+1+d:this.numberOfHandles;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.fillStyle="rgba(0,0,0,0.2)",o.fill(),o.beginPath(),o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.fillStyle="gray",o.stroke(),o.fill()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealOpacity.prototype.description=function(){return"Corneal opacity: H-W: "+this.height+"x"+this.width+"mm // Stromal depth: "+this.depth+"% // Infiltrate width: "+this.infiltrateWidth+"mm"},ED.CornealOpacityCrossSection=function(t,e){this.className="CornealOpacityCrossSection",this.initialRadius=81,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.depth=33,this.infiltrateWidth=0,this.h=Math.round(2*this.initialRadius/54),this.w=Math.round(2*this.initialRadius/54),this.d=33,this.iW=0,this.minY=-1*this.initialRadius,this.maxY=this.initialRadius,this.savedParameterArray=["originX","originY","height","width","depth","infiltrateWidth","h","w","d","iW","minY","maxY"],this.controlParameterArray={height:"Height",width:"Width",depth:"Depth (%)",infiltrateWidth:"Infiltrate width"},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={CornealOpacity:{source:["yMidPoint","d","h","w","iW","originY","minY","maxY"]}}},ED.CornealOpacityCrossSection.prototype=new ED.Doodle,ED.CornealOpacityCrossSection.prototype.constructor=ED.CornealOpacityCrossSection,ED.CornealOpacityCrossSection.superclass=ED.Doodle.prototype,ED.CornealOpacityCrossSection.prototype.setHandles=function(){},ED.CornealOpacityCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.parameterValidationArray.originX.range.setMinAndMax(50,50),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.height={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.width={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.depth={kind:"other",type:"int",range:new ED.Range(1,100),precision:1,animate:!1},this.parameterValidationArray.infiltrateWidth={kind:"other",type:"int",range:new ED.Range(0,15),precision:1,animate:!1},this.parameterValidationArray.h={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.w={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.iW={kind:"other",type:"int",range:[0,15],animate:!1},this.parameterValidationArray.d={kind:"other",type:"int",range:[1,100],animate:!1},this.parameterValidationArray.minY={kind:"other",type:"int",range:[-500,500],animate:!1},this.parameterValidationArray.maxY={kind:"other",type:"int",range:[-500,500],animate:!1}},ED.CornealOpacityCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"width":i.w=parseInt(e);break;case"height":i.h=parseInt(e);break;case"infiltrateWidth":i.iW=parseInt(e);break;case"depth":i.d=parseInt(e);break;case"h":i.height=e;break;case"d":i.depth=e;break;case"w":i.width=e;break;case"iW":i.infiltrateWidth=e}return i},ED.CornealOpacityCrossSection.prototype.setParameterDefaults=function(){this.originX=50},ED.CornealOpacityCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=i.pachymetry/5;ED.CornealOpacityCrossSection.superclass.draw.call(this,t),e.beginPath();var a=this.minY+this.originY,o=this.maxY+this.originY,n=(a+380)/760;n<0&&(n=0);var s=(o+380)/760;if(s>1&&(s=1),n<.5){var l=new Object,h=new Object,d=2*n,c=s<.5?2*s:1;if(i&&"Keratoconus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(i.apexX,i.apexY-100-this.originY),l.EP=new ED.Point(i.apexX,i.apexY-this.originY),h.SP=new ED.Point(120*this.depth/100-120,-380-this.originY),h.CP1=new ED.Point(160*this.depth/100-240,-260-this.originY),h.CP2=new ED.Point(i.apexX+r*this.depth/100,i.apexY-120-this.originY),h.EP=new ED.Point(i.apexX+r*this.depth/100,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-380,-100-this.originY),l.EP=new ED.Point(-380,100-this.originY),h.SP=new ED.Point(120*this.depth/100-120,-380-this.originY),h.CP1=new ED.Point(120*this.depth/100-240,-200-this.originY),h.CP2=new ED.Point(100*this.depth/100-380,-140-this.originY),h.EP=new ED.Point(100*this.depth/100-380,100-this.originY)):(l.SP=new ED.Point(-120,-380-this.originY),l.CP1=new ED.Point(-240,-260-this.originY),l.CP2=new ED.Point(-320,-160-this.originY),l.EP=new ED.Point(-320,0-this.originY),h.SP=new ED.Point(120*this.depth/100-120,-380-this.originY),h.CP1=new ED.Point(160*this.depth/100-240,-260-this.originY),h.CP2=new ED.Point(100*this.depth/100-320,-160-this.originY),h.EP=new ED.Point(100*this.depth/100-320,0-this.originY)),d>0){(S=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*l.SP.y+3*(1-d)*(1-d)*d*l.CP1.y+3*(1-d)*d*d*l.CP2.y+d*d*d*l.EP.y,S.x=(1-d)*(1-d)*(1-d)*l.SP.x+3*(1-d)*(1-d)*d*l.CP1.x+3*(1-d)*d*d*l.CP2.x+d*d*d*l.EP.x,(P=new ED.Point(0,0)).x=l.CP1.x+d*(l.CP2.x-l.CP1.x),P.y=l.CP1.y+d*(l.CP2.y-l.CP1.y);var p=new ED.Point(0,0);p.x=l.CP2.x+d*(l.EP.x-l.CP2.x),p.y=l.CP2.y+d*(l.EP.y-l.CP2.y);var y=new ED.Point(0,0);y.x=P.x+d*(p.x-P.x),y.y=P.y+d*(p.y-P.y),l.SP=S,l.CP1=y,l.CP2=p,(k=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*h.SP.y+3*(1-d)*(1-d)*d*h.CP1.y+3*(1-d)*d*d*h.CP2.y+d*d*d*h.EP.y,k.x=(1-d)*(1-d)*(1-d)*h.SP.x+3*(1-d)*(1-d)*d*h.CP1.x+3*(1-d)*d*d*h.CP2.x+d*d*d*h.EP.x,(w=new ED.Point(0,0)).x=h.CP1.x+d*(h.CP2.x-h.CP1.x),w.y=h.CP1.y+d*(h.CP2.y-h.CP1.y);var D=new ED.Point(0,0);D.x=h.CP2.x+d*(h.EP.x-h.CP2.x),D.y=h.CP2.y+d*(h.EP.y-h.CP2.y);var u=new ED.Point(0,0);u.x=w.x+d*(D.x-w.x),u.y=w.y+d*(D.y-w.y),h.SP=k,h.CP1=u,h.CP2=D}if(c<1){var g=new ED.Point(0,0);g.y=(1-c)*(1-c)*(1-c)*l.SP.y+3*(1-c)*(1-c)*c*l.CP1.y+3*(1-c)*c*c*l.CP2.y+c*c*c*l.EP.y,g.x=(1-c)*(1-c)*(1-c)*l.SP.x+3*(1-c)*(1-c)*c*l.CP1.x+3*(1-c)*c*c*l.CP2.x+c*c*c*l.EP.x;var P,E=new ED.Point(0,0);E.x=l.SP.x+c*(l.CP1.x-l.SP.x),E.y=l.SP.y+c*(l.CP1.y-l.SP.y),(P=new ED.Point(0,0)).x=l.CP1.x+c*(l.CP2.x-l.CP1.x),P.y=l.CP1.y+c*(l.CP2.y-l.CP1.y);var m=new ED.Point(0,0);m.x=E.x+c*(P.x-E.x),m.y=E.y+c*(P.y-E.y),l.CP1=E,l.CP2=m,l.EP=g;var f=new ED.Point(0,0);f.y=(1-c)*(1-c)*(1-c)*h.SP.y+3*(1-c)*(1-c)*c*h.CP1.y+3*(1-c)*c*c*h.CP2.y+c*c*c*h.EP.y,f.x=(1-c)*(1-c)*(1-c)*h.SP.x+3*(1-c)*(1-c)*c*h.CP1.x+3*(1-c)*c*c*h.CP2.x+c*c*c*h.EP.x;var w,x=new ED.Point(0,0);x.x=h.SP.x+c*(h.CP1.x-h.SP.x),x.y=h.SP.y+c*(h.CP1.y-h.SP.y),(w=new ED.Point(0,0)).x=h.CP1.x+c*(h.CP2.x-h.CP1.x),w.y=h.CP1.y+c*(h.CP2.y-h.CP1.y);var b=new ED.Point(0,0);b.x=x.x+c*(w.x-x.x),b.y=x.y+c*(w.y-x.y),h.CP1=x,h.CP2=b,h.EP=f}}if(s>.5){var v=new Object,A=new Object,C=n>.5?2*(n-.5):0,M=2*(s-.5);if(i&&"Keratoconus"==i.shape?(v.SP=new ED.Point(i.apexX,i.apexY-this.originY),v.CP1=new ED.Point(i.apexX,i.apexY+100-this.originY),v.CP2=new ED.Point(-240,260-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(i.apexX+r*this.depth/100,i.apexY-this.originY),A.CP1=new ED.Point(i.apexX+r*this.depth/100,i.apexY+120-this.originY),A.CP2=new ED.Point(160*this.depth/100-240,260-this.originY),A.EP=new ED.Point(120*this.depth/100-120,380-this.originY)):i&&"Keratoglobus"==i.shape?(v.SP=new ED.Point(-380,100-this.originY),v.CP1=new ED.Point(-380,200-this.originY),v.CP2=new ED.Point(-240,360-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(100*this.depth/100-380,100-this.originY),A.CP1=new ED.Point(120*this.depth/100-380,220-this.originY),A.CP2=new ED.Point(160*this.depth/100-240,260-this.originY),A.EP=new ED.Point(120*this.depth/100-120,380-this.originY)):(v.SP=new ED.Point(-320,-0-this.originY),v.CP1=new ED.Point(-320,160-this.originY),v.CP2=new ED.Point(-240,260-this.originY),v.EP=new ED.Point(-120,380-this.originY),A.SP=new ED.Point(100*this.depth/100-320,-0-this.originY),A.CP1=new ED.Point(100*this.depth/100-320,160-this.originY),A.CP2=new ED.Point(160*this.depth/100-240,260-this.originY),A.EP=new ED.Point(120*this.depth/100-120,380-this.originY)),C>0){var S;(S=new ED.Point(0,0)).y=(1-C)*(1-C)*(1-C)*v.SP.y+3*(1-C)*(1-C)*C*v.CP1.y+3*(1-C)*C*C*v.CP2.y+C*C*C*v.EP.y,S.x=(1-C)*(1-C)*(1-C)*v.SP.x+3*(1-C)*(1-C)*C*v.CP1.x+3*(1-C)*C*C*v.CP2.x+C*C*C*v.EP.x,(X=new ED.Point(0,0)).x=v.CP1.x+C*(v.CP2.x-v.CP1.x),X.y=v.CP1.y+C*(v.CP2.y-v.CP1.y);var T=new ED.Point(0,0);T.x=v.CP2.x+C*(v.EP.x-v.CP2.x),T.y=v.CP2.y+C*(v.EP.y-v.CP2.y);var k,Y=new ED.Point(0,0);Y.x=X.x+C*(T.x-X.x),Y.y=X.y+C*(T.y-X.y),v.SP=S,v.CP1=Y,v.CP2=T,(k=new ED.Point(0,0)).y=(1-C)*(1-C)*(1-C)*A.SP.y+3*(1-C)*(1-C)*C*A.CP1.y+3*(1-C)*C*C*A.CP2.y+C*C*C*A.EP.y,k.x=(1-C)*(1-C)*(1-C)*A.SP.x+3*(1-C)*(1-C)*C*A.CP1.x+3*(1-C)*C*C*A.CP2.x+C*C*C*A.EP.x,(W=new ED.Point(0,0)).x=A.CP1.x+C*(A.CP2.x-A.CP1.x),W.y=A.CP1.y+C*(A.CP2.y-A.CP1.y);var I=new ED.Point(0,0);I.x=A.CP2.x+C*(A.EP.x-A.CP2.x),I.y=A.CP2.y+C*(A.EP.y-A.CP2.y);var H=new ED.Point(0,0);H.x=W.x+C*(I.x-W.x),H.y=W.y+C*(I.y-W.y),A.SP=k,A.CP1=H,A.CP2=I}if(M<1){var R=new ED.Point(0,0);R.y=(1-M)*(1-M)*(1-M)*v.SP.y+3*(1-M)*(1-M)*M*v.CP1.y+3*(1-M)*M*M*v.CP2.y+M*M*M*v.EP.y,R.x=(1-M)*(1-M)*(1-M)*v.SP.x+3*(1-M)*(1-M)*M*v.CP1.x+3*(1-M)*M*M*v.CP2.x+M*M*M*v.EP.x;var X,V=new ED.Point(0,0);V.x=v.SP.x+M*(v.CP1.x-v.SP.x),V.y=v.SP.y+M*(v.CP1.y-v.SP.y),(X=new ED.Point(0,0)).x=v.CP1.x+M*(v.CP2.x-v.CP1.x),X.y=v.CP1.y+M*(v.CP2.y-v.CP1.y);var F=new ED.Point(0,0);F.x=V.x+M*(X.x-V.x),F.y=V.y+M*(X.y-V.y),v.CP1=V,v.CP2=F,v.EP=R;var O=new ED.Point(0,0);O.y=(1-M)*(1-M)*(1-M)*A.SP.y+3*(1-M)*(1-M)*M*A.CP1.y+3*(1-M)*M*M*A.CP2.y+M*M*M*A.EP.y,O.x=(1-M)*(1-M)*(1-M)*A.SP.x+3*(1-M)*(1-M)*M*A.CP1.x+3*(1-M)*M*M*A.CP2.x+M*M*M*A.EP.x;var W,z=new ED.Point(0,0);z.x=A.SP.x+M*(A.CP1.x-A.SP.x),z.y=A.SP.y+M*(A.CP1.y-A.SP.y),(W=new ED.Point(0,0)).x=A.CP1.x+M*(A.CP2.x-A.CP1.x),W.y=A.CP1.y+M*(A.CP2.y-A.CP1.y);var L=new ED.Point(0,0);L.x=z.x+M*(W.x-z.x),L.y=z.y+M*(W.y-z.y),A.CP1=z,A.CP2=L,A.EP=O}}if(v&&(e.moveTo(A.EP.x,A.EP.y),e.bezierCurveTo(A.CP2.x,A.CP2.y,A.CP1.x,A.CP1.y,A.SP.x,A.SP.y),e.lineTo(v.SP.x,v.SP.y),e.bezierCurveTo(v.CP1.x,v.CP1.y,v.CP2.x,v.CP2.y,v.EP.x,v.EP.y)),l&&(e.moveTo(h.EP.x,h.EP.y),e.bezierCurveTo(h.CP2.x,h.CP2.y,h.CP1.x,h.CP1.y,h.SP.x,h.SP.y),e.lineTo(l.SP.x,l.SP.y),e.bezierCurveTo(l.CP1.x,l.CP1.y,l.CP2.x,l.CP2.y,l.EP.x,l.EP.y)),e.closePath(),e.lineWidth=0,e.fillStyle="gray",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.infiltrateWidth>0){var B=this.maxY+this.originY+.5*this.infiltrateWidth*2*54,N=(this.minY+this.originY-.5*this.infiltrateWidth*2*54+380)/760;N<0&&(N=0);var q=(B+380)/760;q>1&&(q=1);var G=(this.height+this.width)/2,K=(this.height+this.width+4*this.infiltrateWidth)/2,j=this.depth/G*K;if(j>100&&(j=100),N<.5){var U,Q=new Object,_=new Object,J=2*N,Z=q<.5?2*q:1;U=J;var $;if($=Z,i&&"Keratoconus"==i.shape?(Q.SP=new ED.Point(-120,-380-this.originY),Q.CP1=new ED.Point(-240,-260-this.originY),Q.CP2=new ED.Point(i.apexX,i.apexY-100-this.originY),Q.EP=new ED.Point(i.apexX,i.apexY-this.originY),_.SP=new ED.Point(120*j/100-120,-380-this.originY),_.CP1=new ED.Point(160*j/100-240,-260-this.originY),_.CP2=new ED.Point(i.apexX+r*j/100,i.apexY-120-this.originY),_.EP=new ED.Point(i.apexX+r*j/100,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(Q.SP=new ED.Point(-120,-380-this.originY),Q.CP1=new ED.Point(-240,-260-this.originY),Q.CP2=new ED.Point(-380,-100-this.originY),Q.EP=new ED.Point(-380,100-this.originY),_.SP=new ED.Point(120*j/100-120,-380-this.originY),_.CP1=new ED.Point(120*j/100-240,-200-this.originY),_.CP2=new ED.Point(100*j/100-380,-140-this.originY),_.EP=new ED.Point(100*j/100-380,100-this.originY)):(Q.SP=new ED.Point(-120,-380-this.originY),Q.CP1=new ED.Point(-240,-260-this.originY),Q.CP2=new ED.Point(-320,-160-this.originY),Q.EP=new ED.Point(-320,0-this.originY),_.SP=new ED.Point(120*j/100-120,-380-this.originY),_.CP1=new ED.Point(160*j/100-240,-260-this.originY),_.CP2=new ED.Point(100*j/100-320,-160-this.originY),_.EP=new ED.Point(100*j/100-320,0-this.originY)),J>0){(Et=new ED.Point(0,0)).y=(1-J)*(1-J)*(1-J)*Q.SP.y+3*(1-J)*(1-J)*J*Q.CP1.y+3*(1-J)*J*J*Q.CP2.y+J*J*J*Q.EP.y,Et.x=(1-J)*(1-J)*(1-J)*Q.SP.x+3*(1-J)*(1-J)*J*Q.CP1.x+3*(1-J)*J*J*Q.CP2.x+J*J*J*Q.EP.x,(ot=new ED.Point(0,0)).x=Q.CP1.x+J*(Q.CP2.x-Q.CP1.x),ot.y=Q.CP1.y+J*(Q.CP2.y-Q.CP1.y);var tt=new ED.Point(0,0);tt.x=Q.CP2.x+J*(Q.EP.x-Q.CP2.x),tt.y=Q.CP2.y+J*(Q.EP.y-Q.CP2.y);var et=new ED.Point(0,0);et.x=ot.x+J*(tt.x-ot.x),et.y=ot.y+J*(tt.y-ot.y),Q.SP=Et,Q.CP1=et,Q.CP2=tt}if(U>0){(wt=new ED.Point(0,0)).y=(1-U)*(1-U)*(1-U)*_.SP.y+3*(1-U)*(1-U)*U*_.CP1.y+3*(1-U)*U*U*_.CP2.y+U*U*U*_.EP.y,wt.x=(1-U)*(1-U)*(1-U)*_.SP.x+3*(1-U)*(1-U)*U*_.CP1.x+3*(1-U)*U*U*_.CP2.x+U*U*U*_.EP.x,(ht=new ED.Point(0,0)).x=_.CP1.x+U*(_.CP2.x-_.CP1.x),ht.y=_.CP1.y+U*(_.CP2.y-_.CP1.y);var it=new ED.Point(0,0);it.x=_.CP2.x+U*(_.EP.x-_.CP2.x),it.y=_.CP2.y+U*(_.EP.y-_.CP2.y);var rt=new ED.Point(0,0);rt.x=ht.x+U*(it.x-ht.x),rt.y=ht.y+U*(it.y-ht.y),_.SP=wt,_.CP1=rt,_.CP2=it}if(Z<1){var at=new ED.Point(0,0);at.y=(1-Z)*(1-Z)*(1-Z)*Q.SP.y+3*(1-Z)*(1-Z)*Z*Q.CP1.y+3*(1-Z)*Z*Z*Q.CP2.y+Z*Z*Z*Q.EP.y,at.x=(1-Z)*(1-Z)*(1-Z)*Q.SP.x+3*(1-Z)*(1-Z)*Z*Q.CP1.x+3*(1-Z)*Z*Z*Q.CP2.x+Z*Z*Z*Q.EP.x;var ot,nt=new ED.Point(0,0);nt.x=Q.SP.x+Z*(Q.CP1.x-Q.SP.x),nt.y=Q.SP.y+Z*(Q.CP1.y-Q.SP.y),(ot=new ED.Point(0,0)).x=Q.CP1.x+Z*(Q.CP2.x-Q.CP1.x),ot.y=Q.CP1.y+Z*(Q.CP2.y-Q.CP1.y);var st=new ED.Point(0,0);st.x=nt.x+Z*(ot.x-nt.x),st.y=nt.y+Z*(ot.y-nt.y),Q.CP1=nt,Q.CP2=st,Q.EP=at}if($>0){var lt=new ED.Point(0,0);lt.y=(1-$)*(1-$)*(1-$)*_.SP.y+3*(1-$)*(1-$)*$*_.CP1.y+3*(1-$)*$*$*_.CP2.y+$*$*$*_.EP.y,lt.x=(1-$)*(1-$)*(1-$)*_.SP.x+3*(1-$)*(1-$)*$*_.CP1.x+3*(1-$)*$*$*_.CP2.x+$*$*$*_.EP.x;var ht,dt=new ED.Point(0,0);dt.x=_.SP.x+$*(_.CP1.x-_.SP.x),dt.y=_.SP.y+$*(_.CP1.y-_.SP.y),(ht=new ED.Point(0,0)).x=_.CP1.x+$*(_.CP2.x-_.CP1.x),ht.y=_.CP1.y+$*(_.CP2.y-_.CP1.y);var ct=new ED.Point(0,0);ct.x=dt.x+$*(ht.x-dt.x),ct.y=dt.y+$*(ht.y-dt.y),_.CP1=dt,_.CP2=ct,_.EP=lt}}if(q>.5){var pt,yt=new Object,Dt=new Object,ut=N>.5?2*(N-.5):0,gt=2*(q-.5);pt=ut;var Pt;if(Pt=gt,i&&"Keratoconus"==i.shape?(yt.SP=new ED.Point(i.apexX,i.apexY-this.originY),yt.CP1=new ED.Point(i.apexX,i.apexY+100-this.originY),yt.CP2=new ED.Point(-240,260-this.originY),yt.EP=new ED.Point(-120,380-this.originY),Dt.SP=new ED.Point(i.apexX+r*j/100,i.apexY-this.originY),Dt.CP1=new ED.Point(i.apexX+r*j/100,i.apexY+120-this.originY),Dt.CP2=new ED.Point(160*j/100-240,260-this.originY),Dt.EP=new ED.Point(120*j/100-120,380-this.originY)):i&&"Keratoglobus"==i.shape?(yt.SP=new ED.Point(-380,100-this.originY),yt.CP1=new ED.Point(-380,200-this.originY),yt.CP2=new ED.Point(-240,360-this.originY),yt.EP=new ED.Point(-120,380-this.originY),Dt.SP=new ED.Point(100*j/100-380,100-this.originY),Dt.CP1=new ED.Point(120*j/100-380,220-this.originY),Dt.CP2=new ED.Point(160*j/100-240,260-this.originY),Dt.EP=new ED.Point(120*j/100-120,380-this.originY)):(yt.SP=new ED.Point(-320,-0-this.originY),yt.CP1=new ED.Point(-320,160-this.originY),yt.CP2=new ED.Point(-240,260-this.originY),yt.EP=new ED.Point(-120,380-this.originY),Dt.SP=new ED.Point(100*j/100-320,-0-this.originY),Dt.CP1=new ED.Point(100*j/100-320,160-this.originY),Dt.CP2=new ED.Point(160*j/100-240,260-this.originY),Dt.EP=new ED.Point(120*j/100-120,380-this.originY)),ut>0){var Et;(Et=new ED.Point(0,0)).y=(1-ut)*(1-ut)*(1-ut)*yt.SP.y+3*(1-ut)*(1-ut)*ut*yt.CP1.y+3*(1-ut)*ut*ut*yt.CP2.y+ut*ut*ut*yt.EP.y,Et.x=(1-ut)*(1-ut)*(1-ut)*yt.SP.x+3*(1-ut)*(1-ut)*ut*yt.CP1.x+3*(1-ut)*ut*ut*yt.CP2.x+ut*ut*ut*yt.EP.x,(At=new ED.Point(0,0)).x=yt.CP1.x+ut*(yt.CP2.x-yt.CP1.x),At.y=yt.CP1.y+ut*(yt.CP2.y-yt.CP1.y);var mt=new ED.Point(0,0);mt.x=yt.CP2.x+ut*(yt.EP.x-yt.CP2.x),mt.y=yt.CP2.y+ut*(yt.EP.y-yt.CP2.y);var ft=new ED.Point(0,0);ft.x=At.x+ut*(mt.x-At.x),ft.y=At.y+ut*(mt.y-At.y),yt.SP=Et,yt.CP1=ft,yt.CP2=mt}if(pt>0){var wt;(wt=new ED.Point(0,0)).y=(1-pt)*(1-pt)*(1-pt)*Dt.SP.y+3*(1-pt)*(1-pt)*pt*Dt.CP1.y+3*(1-pt)*pt*pt*Dt.CP2.y+pt*pt*pt*Dt.EP.y,wt.x=(1-pt)*(1-pt)*(1-pt)*Dt.SP.x+3*(1-pt)*(1-pt)*pt*Dt.CP1.x+3*(1-pt)*pt*pt*Dt.CP2.x+pt*pt*pt*Dt.EP.x,(Tt=new ED.Point(0,0)).x=Dt.CP1.x+pt*(Dt.CP2.x-Dt.CP1.x),Tt.y=Dt.CP1.y+pt*(Dt.CP2.y-Dt.CP1.y);var xt=new ED.Point(0,0);xt.x=Dt.CP2.x+pt*(Dt.EP.x-Dt.CP2.x),xt.y=Dt.CP2.y+pt*(Dt.EP.y-Dt.CP2.y);var bt=new ED.Point(0,0);bt.x=Tt.x+pt*(xt.x-Tt.x),bt.y=Tt.y+pt*(xt.y-Tt.y),Dt.SP=wt,Dt.CP1=bt,Dt.CP2=xt}if(gt<1){var vt=new ED.Point(0,0);vt.y=(1-gt)*(1-gt)*(1-gt)*yt.SP.y+3*(1-gt)*(1-gt)*gt*yt.CP1.y+3*(1-gt)*gt*gt*yt.CP2.y+gt*gt*gt*yt.EP.y,vt.x=(1-gt)*(1-gt)*(1-gt)*yt.SP.x+3*(1-gt)*(1-gt)*gt*yt.CP1.x+3*(1-gt)*gt*gt*yt.CP2.x+gt*gt*gt*yt.EP.x;var At,Ct=new ED.Point(0,0);Ct.x=yt.SP.x+gt*(yt.CP1.x-yt.SP.x),Ct.y=yt.SP.y+gt*(yt.CP1.y-yt.SP.y),(At=new ED.Point(0,0)).x=yt.CP1.x+gt*(yt.CP2.x-yt.CP1.x),At.y=yt.CP1.y+gt*(yt.CP2.y-yt.CP1.y);var Mt=new ED.Point(0,0);Mt.x=Ct.x+gt*(At.x-Ct.x),Mt.y=Ct.y+gt*(At.y-Ct.y),yt.CP1=Ct,yt.CP2=Mt,yt.EP=vt;var St=new ED.Point(0,0);St.y=(1-Pt)*(1-Pt)*(1-Pt)*Dt.SP.y+3*(1-Pt)*(1-Pt)*Pt*Dt.CP1.y+3*(1-Pt)*Pt*Pt*Dt.CP2.y+Pt*Pt*Pt*Dt.EP.y,St.x=(1-Pt)*(1-Pt)*(1-Pt)*Dt.SP.x+3*(1-Pt)*(1-Pt)*Pt*Dt.CP1.x+3*(1-Pt)*Pt*Pt*Dt.CP2.x+Pt*Pt*Pt*Dt.EP.x;var Tt,kt=new ED.Point(0,0);kt.x=Dt.SP.x+Pt*(Dt.CP1.x-Dt.SP.x),kt.y=Dt.SP.y+Pt*(Dt.CP1.y-Dt.SP.y),(Tt=new ED.Point(0,0)).x=Dt.CP1.x+Pt*(Dt.CP2.x-Dt.CP1.x),Tt.y=Dt.CP1.y+Pt*(Dt.CP2.y-Dt.CP1.y);var Yt=new ED.Point(0,0);Yt.x=kt.x+Pt*(Tt.x-kt.x),Yt.y=kt.y+Pt*(Tt.y-kt.y),Dt.CP1=kt,Dt.CP2=Yt,Dt.EP=St}}e.beginPath(),yt&&(e.moveTo(Dt.EP.x,Dt.EP.y),e.bezierCurveTo(Dt.CP2.x,Dt.CP2.y,Dt.CP1.x,Dt.CP1.y,Dt.SP.x,Dt.SP.y)),_&&_.EP.y>=_.SP.y?(e.moveTo(_.EP.x,_.EP.y),e.bezierCurveTo(_.CP2.x,_.CP2.y,_.CP1.x,_.CP1.y,_.SP.x,_.SP.y),e.lineTo(Q.SP.x,Q.SP.y),e.bezierCurveTo(Q.CP1.x,Q.CP1.y,Q.CP2.x,Q.CP2.y,Q.EP.x,Q.EP.y)):Q&&(e.lineTo(Q.SP.x,Q.SP.y),e.bezierCurveTo(Q.CP1.x,Q.CP1.y,Q.CP2.x,Q.CP2.y,Q.EP.x,Q.EP.y)),yt&&(e.lineTo(yt.SP.x,yt.SP.y),e.bezierCurveTo(yt.CP1.x,yt.CP1.y,yt.CP2.x,yt.CP2.y,yt.EP.x,yt.EP.y)),Dt&&Dt.EP.y>=Dt.SP.y?e.lineTo(Dt.EP.x,Dt.EP.y):e.lineTo(_.EP.x,_.EP.y),e.fillStyle="rgba(0,0,0,0.2)",e.fill(),e.beginPath(),v&&(e.moveTo(A.EP.x,A.EP.y),e.bezierCurveTo(A.CP2.x,A.CP2.y,A.CP1.x,A.CP1.y,A.SP.x,A.SP.y),e.lineTo(v.SP.x,v.SP.y),e.bezierCurveTo(v.CP1.x,v.CP1.y,v.CP2.x,v.CP2.y,v.EP.x,v.EP.y)),l&&(e.moveTo(h.EP.x,h.EP.y),e.bezierCurveTo(h.CP2.x,h.CP2.y,h.CP1.x,h.CP1.y,h.SP.x,h.SP.y),e.lineTo(l.SP.x,l.SP.y),e.bezierCurveTo(l.CP1.x,l.CP1.y,l.CP2.x,l.CP2.y,l.EP.x,l.EP.y)),e.fillStyle="gray",e.fill()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealPigmentation=function(t,e){this.className="CornealPigmentation",this.savedParameterArray=["originX","originY","apexY","apexX","scaleX","scaleY","rotation","level","type"],this.controlParameterArray={level:"Level",type:"Type"},ED.Doodle.call(this,t,e)},ED.CornealPigmentation.prototype=new ED.Doodle,ED.CornealPigmentation.prototype.constructor=ED.CornealPigmentation,ED.CornealPigmentation.superclass=ED.Doodle.prototype,ED.CornealPigmentation.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1),this.handleArray[4].isRotatable=!0},ED.CornealPigmentation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-400,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400),this.parameterValidationArray.level={kind:"derived",type:"string",list:["Endothelium","Epithelial","Subepithelial","Anterior stromal","Mid stromal","Posterior stromal","Descemet's"],animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Iron","Melanin","Blood","Copper","Lead","Organic","Unknown"],animate:!0},this.handleVectorRangeArray=new Array;var t=new Object;t.length=new ED.Range(1,150),t.angle=new ED.Range(.5*Math.PI,.5*Math.PI),this.handleVectorRangeArray[0]=t},ED.CornealPigmentation.prototype.setParameterDefaults=function(){this.setParameterFromString("level","Endothelium"),this.setParameterFromString("type","Melanin"),this.apexY=-150,this.apexX=30;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(40,0);this.addPointToSquiggle(e)},ED.CornealPigmentation.prototype.draw=function(t){var e=this.drawing.context;if(ED.CornealPigmentation.superclass.draw.call(this,t),e.beginPath(),e.ellipse(0,0,Math.abs(this.apexY),Math.abs(this.apexX),.5*Math.PI,0,2*Math.PI),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var i="brown",r=this.squiggleArray[0].pointsArray[0].x,a=Math.PI*Math.abs(this.apexX*this.apexY)/250*(r/30),o=new ED.Point(0,0),n=0;n<a;n++){var s=n<150?n:n<199?n-50:n<249?n-100:n<299?n-150:n<349?n-200:n-250,l=n<200?n:n<398?n-199:n<397?n-298:n-396,h=Math.sqrt(a*ED.randomArray[l]),d=this.apexX*ED.randomArray[l],c=this.apexY*ED.randomArray[s],p=2*Math.PI*ED.randomArray[s+50];o.x=d*Math.cos(p*h),o.y=c*Math.sin(p*h),this.drawSpot(e,o.x,o.y,2,i)}this.drawSpot(e,0,Math.abs(this.apexY),2,i),this.drawSpot(e,0,-1*Math.abs(this.apexY),2,i),this.drawSpot(e,Math.abs(this.apexX),0,2,i),this.drawSpot(e,-1*Math.abs(this.apexX),0,2,i)}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealPigmentation.prototype.description=function(){return"Melanin"===this.type&&"Endothelium"===this.level?"Krukenberg spindle":"Corneal pigmentation: "+this.type+", "+this.level},ED.CornealScar=function(t,e){this.className="CornealScar",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CornealScar.prototype=new ED.Doodle,ED.CornealScar.prototype.constructor=ED.CornealScar,ED.CornealScar.superclass=ED.Doodle.prototype,ED.CornealScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealScar.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-10)},ED.CornealScar.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=.7,this.scaleY=.5,this.setOriginWithDisplacements(0,25)},ED.CornealScar.prototype.draw=function(t){var e=this.drawing.context;ED.CornealScar.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,100,0,2*Math.PI,!1),e.closePath();var i=-this.apexY/100;if(e.fillStyle="rgba(100,100,100,"+i.toFixed(2)+")",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r=new ED.Point(0,0),a=this.drawing.transform.transformPoint(r);(e=this.drawing.context).isPointInPath(a.x,a.y)?this.isInVisualAxis=!0:this.isInVisualAxis=!1}var o=new ED.Point(0,0);return o.setWithPolars(100,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(o),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealScar.prototype.description=function(){var t="",e=this.scaleX+this.scaleY;return t=e<2?"Small ":e<4?"Medium ":"Large ",t+="corneal scar",this.isInVisualAxis&&(t+=" involving visual axis"),t},ED.CornealScar.prototype.snomedCode=function(){return 95726001},ED.CornealScar.prototype.diagnosticHierarchy=function(){return 0},ED.CornealStriae=function(t,e){this.className="CornealStriae",ED.Doodle.call(this,t,e)},ED.CornealStriae.prototype=new ED.Doodle,ED.CornealStriae.prototype.constructor=ED.CornealStriae,ED.CornealStriae.superclass=ED.Doodle.prototype,ED.CornealStriae.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.CornealStriae.prototype.draw=function(t){var e=this.drawing.context;ED.CornealStriae.superclass.draw.call(this,t),e.beginPath();if(e.arc(0,0,300,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(100,100,100,0)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=-300,r=30,a=80,o=-160;e.beginPath();for(var n=0;n<5;n++)e.moveTo(o+a*n,i),e.bezierCurveTo(o+a*n-r,-250,o+a*n-r,-200,o+a*n,-150),e.bezierCurveTo(o+a*n+r,-100,o+a*n+r,-50,o+a*n,0),e.bezierCurveTo(o+a*n-r,50,o+a*n-r,100,o+a*n,150),e.bezierCurveTo(o+a*n+r,200,o+a*n+r,250,o+a*n,300);e.lineWidth=20,e.strokeStyle="rgba(100,100,100,0.6)",e.stroke()}return this.isClicked},ED.CornealStriae.prototype.description=function(){return"Striate keratopathy"},ED.CornealSuture=function(t,e){this.className="CornealSuture",this.removed=!1;var i=t.firstDoodleOfClass("CornealGraft");this.cornealGraft=i||null,this.setParametersFromCornealGraft(),this.savedParameterArray=["originX","originY","radius","rotation","removed"],this.controlParameterArray={removed:"Removed"},ED.Doodle.call(this,t,e)},ED.CornealSuture.prototype=new ED.Doodle,ED.CornealSuture.prototype.constructor=ED.CornealSuture,ED.CornealSuture.superclass=ED.Doodle.prototype,ED.CornealSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.removed={kind:"derived",type:"bool",animate:!1}},ED.CornealSuture.prototype.setParametersFromCornealGraft=function(){this.cornealGraft&&(this.originX=this.cornealGraft.originX,this.originY=this.cornealGraft.originY,this.radius=this.cornealGraft.diameter*this.cornealGraft.pixelsPerMillimetre/2)},ED.CornealSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20),this.setParametersFromCornealGraft()},ED.CornealSuture.prototype.draw=function(t){var e=this.drawing.context;ED.CornealSuture.superclass.draw.call(this,t),e.beginPath(),this.cornealGraft&&(this.radius=this.cornealGraft.diameter*this.cornealGraft.pixelsPerMillimetre/2);var i=this.radius;if(e.rect(-20,-(i+40),40,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=6,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),e.moveTo(0,-i-40),e.lineTo(0,40-i),e.moveTo(-10,10-i),e.lineTo(0,20-i),e.lineTo(-10,30-i),e.lineWidth=2,this.removed)e.strokeStyle="rgba(150,150,150,0.6)";else{var r="rgba(0,0,120,0.7)";e.strokeStyle=r}e.stroke(),this.drawSpot(e,0,20-i,4,r)}return this.isClicked},ED.CornealSuture.prototype.groupDescription=function(){var t="",e=this.drawing.numberOfDoodlesOfClass(this.className);return t=e+" corneal suture",e>1&&(t+="s"),t},ED.CornealThinning=function(t,e){this.className="CornealThinning",this.numberOfHandles=4,this.initialRadius=81,this.resetWidth=!0,this.bezierTimeIntervals=[0,.125,.25,.375,.5,.625,.75,.875,1],this.minX=this.minY=-1*this.initialRadius,this.maxX=this.maxY=this.initialRadius,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.h=Math.round(2*this.initialRadius/54),this.w=Math.round(2*this.initialRadius/54),this.d=0,this.p=0,this.type="Dellen",this.descemetacoele=!1,this.perforation=!1,this.csApexX=0,this.csApexY=0,this.csOriginX=50,this.savedParameterArray=["originX","originY","rotation","height","width","h","w","minY","maxY","type","descemetacoele","perforation","csApexX","csApexY","csOriginX"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.CornealThinning.prototype=new ED.Doodle,ED.CornealThinning.prototype.constructor=ED.CornealThinning,ED.CornealThinning.superclass=ED.Doodle.prototype,ED.CornealThinning.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.CornealThinning.prototype.setPropertyDefaults=function(){this.isUnique=!1,this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,380),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.originX.range.setMinAndMax(-350,350),this.parameterValidationArray.originY.range.setMinAndMax(-350,350),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Dellen","Keratitis"],animate:!1},this.parameterValidationArray.height={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.width={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.h={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.w={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.d={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.p={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.resetWidth={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.descemetacoele={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.perforation={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.minY={kind:"other",type:"int",range:[-500,500],animate:!1},this.parameterValidationArray.maxY={kind:"other",type:"int",range:[-500,500],animate:!1}},ED.CornealThinning.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"width":i.resetWidth=!0,i.w=parseInt(e);break;case"height":this.squiggleArray[0].pointsArray[0].y=.5*e*-54,this.squiggleArray[0].pointsArray[2].y=.5*e*54,i.h=parseInt(e),i.minY=this.calculateMinY(),i.maxY=this.calculateMaxY();break;case"h":i.h=e;break;case"w":i.w=e;break;case"minY":i.minY=e;break;case"maxY":i.maxY=e;break;case"handles":i.w=this.calculateWidth(),i.h=this.calculateHeight(),i.height=this.calculateHeight(),i.minY=this.calculateMinY(),i.maxY=this.calculateMaxY();break;case"d":i.descemetacoele=1==e;break;case"p":i.perforation=1==e}return i},ED.CornealThinning.prototype.setParameterDefaults=function(){this.originY=200,this.originX=0;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;e<this.numberOfHandles;e++){var i=new ED.Point(0,0);i.setWithPolars(this.initialRadius,2*e*Math.PI/this.numberOfHandles),e%2&&(e>1?i.x+=20:i.x-=20),this.addPointToSquiggle(i)}},ED.CornealThinning.prototype.getPhi=function(){return 2*Math.PI/(3*this.numberOfHandles)},ED.CornealThinning.prototype.calculateWidth=function(){for(var t="",e="",i=this.getPhi(),r=(this.squiggleArray[0],0);r<this.numberOfHandles;r++){fp=this.squiggleArray[0].pointsArray[r];var a=r<this.numberOfHandles-1?r+1:0;tp=this.squiggleArray[0].pointsArray[a];for(var o=fp.x,n=fp.tangentialControlPoint(+i).x,s=tp.tangentialControlPoint(-i).x,l=tp.x,h=0;h<this.bezierTimeIntervals.length;h++){var d=this.bezierTimeIntervals[h],c=(1-d)*(1-d)*(1-d)*o+3*(1-d)*(1-d)*d*n+3*(1-d)*d*d*s+d*d*d*l;(""==t||c>t)&&(t=c),(""==e||c<e)&&(e=c)}}return this.maxX=t,this.minX=e,Math.round((t-e)/54)},ED.CornealThinning.prototype.calculateHeight=function(){var t=this.calculateMinY(),e=this.calculateMaxY();return Math.round((e-t)/54)},ED.CornealThinning.prototype.calculateMinY=function(){for(var t=this.getPhi(),e="",i=(this.squiggleArray[0],0);i<this.numberOfHandles;i++){fp=this.squiggleArray[0].pointsArray[i];var r=i<this.numberOfHandles-1?i+1:0;tp=this.squiggleArray[0].pointsArray[r];for(var a=fp.y,o=fp.tangentialControlPoint(+t).y,n=tp.tangentialControlPoint(-t).y,s=tp.y,l=0;l<this.bezierTimeIntervals.length;l++){var h=this.bezierTimeIntervals[l],d=(1-h)*(1-h)*(1-h)*a+3*(1-h)*(1-h)*h*o+3*(1-h)*h*h*n+h*h*h*s;(""==e||d<=e)&&(e=d)}}return e},ED.CornealThinning.prototype.calculateMaxY=function(){for(var t=this.getPhi(),e="",i="",r=(this.squiggleArray[0],0);r<this.numberOfHandles;r++){fp=this.squiggleArray[0].pointsArray[r];var a=r<this.numberOfHandles-1?r+1:0;tp=this.squiggleArray[0].pointsArray[a];for(var o=fp.y,n=fp.tangentialControlPoint(+t).y,s=tp.tangentialControlPoint(-t).y,l=tp.y,h=0;h<this.bezierTimeIntervals.length;h++){var d=this.bezierTimeIntervals[h],c=(1-d)*(1-d)*(1-d)*o+3*(1-d)*(1-d)*d*n+3*(1-d)*d*d*s+d*d*d*l;(""==i||c>i)&&(i=c),(""==e||c<e)&&(e=c)}}return i},ED.CornealThinning.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.CornealThinning.superclass.draw.call(this,t),o.beginPath();var n=this.getPhi();this.resetWidth?(this.squiggleArray[0].pointsArray[1].x=.5*this.width*54,this.squiggleArray[0].pointsArray[3].x=.5*this.width*-54,this.resetWidth=!1):this.width=this.calculateWidth(),o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=4,o.fillStyle=o.createPattern(this.drawing.imageArray.ThinningPattern,"repeat"),o.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t);for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.perforation&&(o.beginPath(),o.fillStyle="gray",o.arc(this.minX+.5*(this.maxX-this.minX),this.minY+.5*(this.maxY-this.minY),40,0,2*Math.PI),o.fill()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CornealThinning.prototype.description=function(){var t="Corneal thinning: "+this.type.toLowerCase();return this.descemetacoele&&(t+=", descemetacoele"),this.perforation&&(t+=", corneal perforation"),t},ED.CornealThinning.prototype.snomedCode=function(){var t=246938006;return this.descemetacoele?t=83110007:this.perforation&&(t=74895004),t},ED.CornealThinningCrossSection=function(t,e){this.className="CornealThinningCrossSection",this.initialRadius=81,this.cornealThickness=110,this.height=Math.round(2*this.initialRadius/54),this.width=Math.round(2*this.initialRadius/54),this.h=Math.round(2*this.initialRadius/54),this.w=Math.round(2*this.initialRadius/54),this.d=0,this.p=0,this.minY=-1*this.initialRadius,this.maxY=this.initialRadius,this.descemetacoele=!1,this.perforation=!1,this.savedParameterArray=["originX","originY","height","width","h","w","minY","maxY","descemetacoele","perforation","apexX","apexY"],ED.Doodle.call(this,t,e),this.linkedDoodleParameters={CornealThinning:{source:["yMidPoint","h","w","originY","minY","maxY","descemetacoele","perforation"],store:[["apexX","csApexX"],["apexY","csApexY"],["originX","csOriginX"]]}}},ED.CornealThinningCrossSection.prototype=new ED.Doodle,ED.CornealThinningCrossSection.prototype.constructor=ED.CornealThinningCrossSection,ED.CornealThinningCrossSection.superclass=ED.Doodle.prototype,ED.CornealThinningCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealThinningCrossSection.prototype.setPropertyDefaults=function(){this.isMoveable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(50,50),this.parameterValidationArray.originY.range.setMinAndMax(-500,500);var t=this.getCornealBezierPoint(580/760);this.parameterValidationArray.apexX.range.setMinAndMax(t.x+15,t.x+100),this.parameterValidationArray.height={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.width={kind:"other",type:"int",range:new ED.Range(1,14),precision:1,animate:!1},this.parameterValidationArray.depth={kind:"other",type:"int",range:new ED.Range(1,100),precision:1,animate:!1},this.parameterValidationArray.h={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.w={kind:"other",type:"int",range:[1,14],animate:!1},this.parameterValidationArray.d={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.p={kind:"other",type:"int",range:[0,1],animate:!1},this.parameterValidationArray.descemetacoele={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.perforation={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.minY={kind:"other",type:"int",range:[-500,500],animate:!1},this.parameterValidationArray.maxY={kind:"other",type:"int",range:[-500,500],animate:!1}},ED.CornealThinningCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"width":i.w=parseInt(e);break;case"height":i.h=parseInt(e);break;case"depth":i.d=parseInt(e);break;case"h":i.height=e;var r=(this.minY+.5*(this.maxY-this.minY)+this.originY+380)/760,a=this.getCornealBezierPoint(r),o=this.getAnglePerpendicularToCornea(r),n=this.cornealThickness*Math.sin(o),s=this.cornealThickness*Math.cos(o),l=new ED.Point(a.x+n,a.y+s),h=this.parameterValidationArray.apexX.range.max;this.parameterValidationArray.apexX.range.setMinAndMax(a.x+15,l.x);var d=this.parameterValidationArray.apexX.range.max-(h-this.apexX);d=this.parameterValidationArray.apexX.range.constrain(d),this.setParameterFromString("apexX",d.toString());break;case"d":i.depth=e;break;case"w":i.width=e;break;case"originY":r=(this.minY+.5*(this.maxY-this.minY)+e+380)/760,a=this.getCornealBezierPoint(r),o=this.getAnglePerpendicularToCornea(r),n=this.cornealThickness*Math.sin(o),s=this.cornealThickness*Math.cos(o),l=new ED.Point(a.x+n,a.y+s);this.parameterValidationArray.apexX.range.setMinAndMax(a.x+15,l.x);h=this.parameterValidationArray.apexX.range.max,d=this.parameterValidationArray.apexX.range.max-(h-this.apexX);d=this.parameterValidationArray.apexX.range.constrain(d),this.setParameterFromString("apexX",d.toString());break;case"apexX":var c=(r=(this.minY+.5*(this.maxY-this.minY)+this.originY+380)/760)+.01,p=r-.01,y=(a=this.getCornealBezierPoint(r),this.getCornealBezierPoint(p)),D=this.getCornealBezierPoint(c),u=(y.y-D.y)/(y.x-D.x),g=-1/u*e+(a.y- -1/u*a.x);this.setSimpleParameter("apexY",g);var P=new ED.Point(e,g),E=a.distanceTo(P);E>=this.cornealThickness-5?(this.setParameterFromString("perforation","true"),this.setParameterFromString("descemetacoele","false")):E>=this.cornealThickness-15?(this.setParameterFromString("descemetacoele","true"),this.setParameterFromString("perforation","false")):(this.setParameterFromString("descemetacoele","false"),this.setParameterFromString("perforation","false"));break;case"perforation":var m=1==e?1:0;i.p=m;break;case"descemetacoele":m=1==e?1:0;i.d=m;break;case"p":i.p=e;break;case"d":i.d=e}return i},ED.CornealThinningCrossSection.prototype.setParameterDefaults=function(){this.originY=200,this.originX=50,this.setParameterWithAnimation("apexX",-200)},ED.CornealThinningCrossSection.prototype.getAnglePerpendicularToCornea=function(t){var e=t+.01,i=t-.01,r=this.getCornealBezierPoint(i),a=this.getCornealBezierPoint(e);return Math.atan(Math.abs((a.x-r.x)/(a.y-r.y)))+.5*Math.PI},ED.CornealThinningCrossSection.prototype.getCornealBezierPoint=function(t){var e=this.drawing.lastDoodleOfClass("CorneaCrossSection"),i=new Object;if(t<.5){var r=2*t;e&&"Keratoconus"==e.shape?(i.SP=new ED.Point(-120,-380-this.originY),i.CP1=new ED.Point(-240,-260-this.originY),i.CP2=new ED.Point(e.apexX,e.apexY-100-this.originY),i.EP=new ED.Point(e.apexX,e.apexY-this.originY)):e&&"Keratoglobus"==e.shape?(i.SP=new ED.Point(-120,-380-this.originY),i.CP1=new ED.Point(-240,-260-this.originY),i.CP2=new ED.Point(-380,-100-this.originY),i.EP=new ED.Point(-380,100-this.originY)):(i.SP=new ED.Point(-120,-380-this.originY),i.CP1=new ED.Point(-240,-260-this.originY),i.CP2=new ED.Point(-320,-160-this.originY),i.EP=new ED.Point(-320,0-this.originY))}else{r=2*(t-.5);e&&"Keratoconus"==e.shape?(i.SP=new ED.Point(e.apexX,e.apexY-this.originY),i.CP1=new ED.Point(e.apexX,e.apexY+100-this.originY),i.CP2=new ED.Point(-240,260-this.originY),i.EP=new ED.Point(-120,380-this.originY)):e&&"Keratoglobus"==e.shape?(i.SP=new ED.Point(-380,100-this.originY),i.CP1=new ED.Point(-380,200-this.originY),i.CP2=new ED.Point(-240,360-this.originY),i.EP=new ED.Point(-120,380-this.originY)):(i.SP=new ED.Point(-320,-0-this.originY),i.CP1=new ED.Point(-320,160-this.originY),i.CP2=new ED.Point(-240,260-this.originY),i.EP=new ED.Point(-120,380-this.originY))}return i.SP.bezierPointAtParameter(r,i.CP1,i.CP2,i.EP)};var calculateStopAndRestartAngles=function(t,e,i,r,a){var o=function(t,e){var i=e*e,r=i*e,a=1-e,o=a*a,n=o*a,s=t.SP.x*n+3*t.CP1.x*o*e+3*t.CP2.x*a*i+t.EP.x*r,l=t.SP.y*n+3*t.CP1.y*o*e+3*t.CP2.y*a*i+t.EP.y*r;return new Vector2D(s,l)},n=function(t,e,i,r){var a=o(t,r),n=a.x-e.x,s=a.y-e.y;return n*n+s*s-i*i},s=function(t,e,i,r){e=e||0,i=i||function(e){return(t(e+.001)-t(e-.001))/.002},r=r||10;for(var a=e,o=0;o<r;++o)a-=t(a)/i(a);return a},l=function(t,e,i,r){return!(void 0!==i&&e<i)&&(!(void 0!==r&&e>r)&&Math.abs(t(e))<.001)},h=new Object,d=function(e){return n(t,new Vector2D(i,r),a,e)},c=function(t){return n(e,new Vector2D(i,r),a,t)},p=s(d,0),y=s(d,1),D=s(c,0),u=s(c,1),g=l(d,p,void 0,1),P=l(d,y,0,1),E=l(c,D,0,1),m=l(c,u,0,void 0);g&&P&&Math.abs(p-y)<.01&&(g=!1),E&&m&&Math.abs(D-u)<.01&&(E=!1);var f=o(t,p),w=o(t,y),x=o(e,D),b=o(e,u),v=Math.atan2(f.y-r,f.x-i),A=Math.atan2(w.y-r,w.x-i),C=Math.atan2(x.y-r,x.x-i),M=Math.atan2(b.y-r,b.x-i);return h.stopAngle=0,h.restartAngle=0,g&&P?(h.stopAngle=A,h.restartAngle=v):E&&m?(h.stopAngle=M,h.restartAngle=C):(g||P)&&(E||m)&&(h.stopAngle=E?C:M,h.restartAngle=g?v:A),h};ED.CornealThinningCrossSection.prototype.draw=function(t){var e=this.drawing.canvas.style.backgroundColor;e||(e="#dae6f1");var i=this.drawing.context,r=this.drawing.lastDoodleOfClass("CorneaCrossSection"),a=r.pachymetry/5;ED.CornealThinningCrossSection.superclass.draw.call(this,t),i.beginPath();var o=this.minY+this.originY,n=this.maxY+this.originY,s=(o+380)/760;s<0&&(s=0);var l=(n+380)/760;if(l>1&&(l=1),s<.5){var h=new Object,d=2*s,c=l<.5?2*l:1;if(r&&"Keratoconus"==r.shape?(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(r.apexX,r.apexY-100-this.originY),h.EP=new ED.Point(r.apexX,r.apexY-this.originY)):r&&"Keratoglobus"==r.shape?(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(-380,-100-this.originY),h.EP=new ED.Point(-380,100-this.originY)):(h.SP=new ED.Point(-120,-380-this.originY),h.CP1=new ED.Point(-240,-260-this.originY),h.CP2=new ED.Point(-320,-160-this.originY),h.EP=new ED.Point(-320,0-this.originY)),d>0){(w=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*h.SP.y+3*(1-d)*(1-d)*d*h.CP1.y+3*(1-d)*d*d*h.CP2.y+d*d*d*h.EP.y,w.x=(1-d)*(1-d)*(1-d)*h.SP.x+3*(1-d)*(1-d)*d*h.CP1.x+3*(1-d)*d*d*h.CP2.x+d*d*d*h.EP.x,(u=new ED.Point(0,0)).x=h.CP1.x+d*(h.CP2.x-h.CP1.x),u.y=h.CP1.y+d*(h.CP2.y-h.CP1.y);var p=new ED.Point(0,0);p.x=h.CP2.x+d*(h.EP.x-h.CP2.x),p.y=h.CP2.y+d*(h.EP.y-h.CP2.y);var y=new ED.Point(0,0);y.x=u.x+d*(p.x-u.x),y.y=u.y+d*(p.y-u.y),h.SP=w,h.CP1=y,h.CP2=p}if(c<1){var D=new ED.Point(0,0);D.y=(1-c)*(1-c)*(1-c)*h.SP.y+3*(1-c)*(1-c)*c*h.CP1.y+3*(1-c)*c*c*h.CP2.y+c*c*c*h.EP.y,D.x=(1-c)*(1-c)*(1-c)*h.SP.x+3*(1-c)*(1-c)*c*h.CP1.x+3*(1-c)*c*c*h.CP2.x+c*c*c*h.EP.x;var u,g=new ED.Point(0,0);g.x=h.SP.x+c*(h.CP1.x-h.SP.x),g.y=h.SP.y+c*(h.CP1.y-h.SP.y),(u=new ED.Point(0,0)).x=h.CP1.x+c*(h.CP2.x-h.CP1.x),u.y=h.CP1.y+c*(h.CP2.y-h.CP1.y);var P=new ED.Point(0,0);P.x=g.x+c*(u.x-g.x),P.y=g.y+c*(u.y-g.y),h.CP1=g,h.CP2=P,h.EP=D}}if(l>.5){var E=new Object,m=s>.5?2*(s-.5):0,f=2*(l-.5);if(r&&"Keratoconus"==r.shape?(E.SP=new ED.Point(r.apexX,r.apexY-this.originY),E.CP1=new ED.Point(r.apexX,r.apexY+100-this.originY),E.CP2=new ED.Point(-240,260-this.originY),E.EP=new ED.Point(-120,380-this.originY)):r&&"Keratoglobus"==r.shape?(E.SP=new ED.Point(-380,100-this.originY),E.CP1=new ED.Point(-380,200-this.originY),E.CP2=new ED.Point(-240,360-this.originY),E.EP=new ED.Point(-120,380-this.originY)):(E.SP=new ED.Point(-320,-0-this.originY),E.CP1=new ED.Point(-320,160-this.originY),E.CP2=new ED.Point(-240,260-this.originY),E.EP=new ED.Point(-120,380-this.originY)),m>0){var w;(w=new ED.Point(0,0)).y=(1-m)*(1-m)*(1-m)*E.SP.y+3*(1-m)*(1-m)*m*E.CP1.y+3*(1-m)*m*m*E.CP2.y+m*m*m*E.EP.y,w.x=(1-m)*(1-m)*(1-m)*E.SP.x+3*(1-m)*(1-m)*m*E.CP1.x+3*(1-m)*m*m*E.CP2.x+m*m*m*E.EP.x,(A=new ED.Point(0,0)).x=E.CP1.x+m*(E.CP2.x-E.CP1.x),A.y=E.CP1.y+m*(E.CP2.y-E.CP1.y);var x=new ED.Point(0,0);x.x=E.CP2.x+m*(E.EP.x-E.CP2.x),x.y=E.CP2.y+m*(E.EP.y-E.CP2.y);var b=new ED.Point(0,0);b.x=A.x+m*(x.x-A.x),b.y=A.y+m*(x.y-A.y),E.SP=w,E.CP1=b,E.CP2=x}if(f<1){var v=new ED.Point(0,0);v.y=(1-f)*(1-f)*(1-f)*E.SP.y+3*(1-f)*(1-f)*f*E.CP1.y+3*(1-f)*f*f*E.CP2.y+f*f*f*E.EP.y,v.x=(1-f)*(1-f)*(1-f)*E.SP.x+3*(1-f)*(1-f)*f*E.CP1.x+3*(1-f)*f*f*E.CP2.x+f*f*f*E.EP.x;var A,C=new ED.Point(0,0);C.x=E.SP.x+f*(E.CP1.x-E.SP.x),C.y=E.SP.y+f*(E.CP1.y-E.SP.y),(A=new ED.Point(0,0)).x=E.CP1.x+f*(E.CP2.x-E.CP1.x),A.y=E.CP1.y+f*(E.CP2.y-E.CP1.y);var M=new ED.Point(0,0);M.x=C.x+f*(A.x-C.x),M.y=C.y+f*(A.y-C.y),E.CP1=C,E.CP2=M,E.EP=v}}var S=p3=new ED.Point(0,0);E?S=E.EP:h&&(S=h.EP),h?p3=h.SP:E&&(p3=E.SP);var T=new ED.Point(this.apexX,this.apexY),k=S.x*(T.y-p3.y)-S.y*(T.x-p3.x)+T.x*p3.y-p3.x*T.y,Y=(S.x*S.x+S.y*S.y)*(p3.y-T.y)+(T.x*T.x+T.y*T.y)*(S.y-p3.y)+(p3.x*p3.x+p3.y*p3.y)*(T.y-S.y),I=(S.x*S.x+S.y*S.y)*(T.x-p3.x)+(T.x*T.x+T.y*T.y)*(p3.x-S.x)+(p3.x*p3.x+p3.y*p3.y)*(S.x-T.x),H=(S.x*S.x+S.y*S.y)*(p3.x*T.y-T.x*p3.y)+(T.x*T.x+T.y*T.y)*(S.x*p3.y-p3.x*S.y)+(p3.x*p3.x+p3.y*p3.y)*(T.x*S.y-S.x*T.y),R=-Y/(2*k),X=-I/(2*k),V=Math.sqrt((Y*Y+I*I-4*k*H)/(4*k*k)),F=new ED.Point(S.x-R,S.y-X),O=(new ED.Point(T.x-R,T.y-X),new ED.Point(p3.x-R,p3.y-X)),W=F.direction()-.5*Math.PI,z=O.direction()-.5*Math.PI,L=!(this.apexX<R);if(E&&(i.moveTo(E.SP.x-5,E.SP.y),i.bezierCurveTo(E.CP1.x-5,E.CP1.y,E.CP2.x-5,E.CP2.y,E.EP.x-5,E.EP.y)),L?i.arc(R,X,V,W,z,!0):i.arc(R,X,V,W,z,!1),h&&(i.lineTo(h.SP.x-5,h.SP.y),i.bezierCurveTo(h.CP1.x-5,h.CP1.y,h.CP2.x-5,h.CP2.y,h.EP.x-5,h.EP.y)),i.closePath(),i.lineWidth=4,i.fillStyle=e,i.strokeStyle=e,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(i.beginPath(),L?(i.moveTo(p3.x,p3.y),i.arc(R,X,V,z,W)):(i.moveTo(S.x,S.y),i.arc(R,X,V,W,z,!1)),i.strokeStyle="gray",i.stroke(),this.perforation)){var B=new Object;B.SP=new ED.Point(0,380-this.originY);var N=new Object;switch(r.shape){case"Normal":B.CP1=new ED.Point(-80,260-this.originY),B.CP2=new ED.Point(-220,180-this.originY),B.EP=new ED.Point(-220,0-this.originY),N.SP=B.EP,N.CP1=new ED.Point(-220,-180-this.originY),N.CP2=new ED.Point(-80,-260-this.originY),N.EP=new ED.Point(0,-380-this.originY);break;case"Keratoconus":B.CP1=new ED.Point(-80,260-this.originY),B.CP2=new ED.Point(r.apexX+a,r.apexY+120-this.originY),B.EP=new ED.Point(r.apexX+a,r.apexY-this.originY),N.SP=B.EP,N.CP1=new ED.Point(r.apexX+a,r.apexY-120-this.originY),N.CP2=new ED.Point(-80,-260-this.originY),N.EP=new ED.Point(0,-380-this.originY);break;case"Keratoglobus":B.CP1=new ED.Point(-80,260-this.originY),B.CP2=new ED.Point(-260,220-this.originY),B.EP=new ED.Point(-280,100-this.originY),N.SP=B.EP,N.CP1=new ED.Point(-280,-140-this.originY),N.CP2=new ED.Point(-120,-200-this.originY),N.EP=new ED.Point(0,-380-this.originY)}var q=calculateStopAndRestartAngles(B,N,R,X,V);i.beginPath(),i.arc(R,X,V+2,q.stopAngle,q.restartAngle),i.fillStyle=e,i.strokeStyle=e,i.fill(),i.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CorticalCataract=function(t,e){this.className="CorticalCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.CorticalCataract.prototype=new ED.Doodle,ED.CorticalCataract.prototype.constructor=ED.CorticalCataract,ED.CorticalCataract.superclass=ED.Doodle.prototype,ED.CorticalCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens","PostSubcapCataract","NuclearCataract"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.CorticalCataract.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.grade=e<-120?"Mild":e<-60?"Moderate":"White";break;case"grade":switch(e){case"Mild":i.apexY=-180;break;case"Moderate":i.apexY=-100;break;case"White":i.apexY=-20}}return i},ED.CorticalCataract.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataract.superclass.draw.call(this,t),e.beginPath();var i=2*Math.PI/16,r=i/2,a=-this.apexY,o=new ED.Point(0,0);o.setWithPolars(230,-r),e.moveTo(o.x,o.y);for(var n=0;n<16;n++){var s=n*i-r,l=new ED.Point(0,0);l.setWithPolars(230,s),e.lineTo(l.x,l.y);var h=new ED.Point(0,0);h.setWithPolars(a,n*i),e.lineTo(h.x,h.y)}return e.lineTo(o.x,o.y),e.moveTo(240,0),e.arc(0,0,240,0,2*Math.PI,!0),e.lineWidth=4,e.lineJoin="bevel",e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CorticalCataract.prototype.description=function(){return this.getParameter("grade")+" cortical cataract"},ED.CorticalCataract.prototype.snomedCode=function(){return 193576003},ED.CorticalCataract.prototype.diagnosticHierarchy=function(){return 0},ED.CorticalCataractCrossSection=function(t,e){this.className="CorticalCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.CorticalCataractCrossSection.prototype=new ED.Doodle,ED.CorticalCataractCrossSection.prototype.constructor=ED.CorticalCataractCrossSection,ED.CorticalCataractCrossSection.superclass=ED.Doodle.prototype,ED.CorticalCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.setParameterFromString("grade","Mild")},ED.CorticalCataractCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.grade=e<-120?"Mild":e<-60?"Moderate":"White";break;case"grade":switch(e){case"Mild":i.apexY=-180;break;case"Moderate":i.apexY=-100;break;case"White":i.apexY=-20}}return i},ED.CorticalCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.CorticalCataractCrossSection.superclass.draw.call(this,t);var i=Math.asin(.8),r=300*Math.cos(i);i=Math.acos(r/270);var a=Math.asin(-this.apexY/270);e.beginPath(),e.arc(100-r,0,270,a,i,!1),e.arc(100+r,0,270,Math.PI-i,Math.PI-a,!1);var o=270*Math.cos(a);return e.moveTo(100-r+o,this.apexY),e.arc(100-r,0,270,-a,-i,!0),e.arc(100+r,0,270,Math.PI+i,Math.PI+a,!0),e.lineWidth=30,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(200,200,200,0.75)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(100,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CottonWoolSpot=function(t,e){this.className="CottonWoolSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CottonWoolSpot.prototype=new ED.Doodle,ED.CottonWoolSpot.prototype.constructor=ED.CottonWoolSpot,ED.CottonWoolSpot.superclass=ED.Doodle.prototype,ED.CottonWoolSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CottonWoolSpot.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CottonWoolSpot.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-150,150)},ED.CottonWoolSpot.prototype.draw=function(t){var e=this.drawing.context;ED.CottonWoolSpot.superclass.draw.call(this,t);var i=80,r=50,a=r/3;return e.beginPath(),e.moveTo(-i,-r),e.lineTo(-i+a,1*a-r),e.lineTo(-i,2*a-r),e.lineTo(-i+a,0),e.lineTo(-i,4*a-r),e.lineTo(-i+a,5*a-r),e.lineTo(-i,50),e.bezierCurveTo(-i+a,7*a-r,i-a,7*a-r,i,50),e.lineTo(i-a,5*a-r),e.lineTo(i,4*a-r),e.lineTo(i-a,0),e.lineTo(i,2*a-r),e.lineTo(i-a,1*a-r),e.lineTo(i,-r),e.bezierCurveTo(i-a,-r-a,-i+a,-r-a,-i,-r),e.closePath(),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(i,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CottonWoolSpot.prototype.groupDescription=function(){return"Cotton wool spots"},ED.Cryo=function(t,e){this.className="Cryo",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.Cryo.prototype=new ED.Doodle,ED.Cryo.prototype.constructor=ED.Cryo,ED.Cryo.superclass=ED.Doodle.prototype,ED.Cryo.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Cryo.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.Cryo.prototype.setParameterDefaults=function(){this.apexY=-40,this.rotation=Math.PI/4;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=new ED.Point(0,0);i.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.Cryo.prototype.draw=function(t){var e=this.drawing.context;ED.Cryo.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=8;var r=e.createPattern(this.drawing.imageArray.CryoPattern,"repeat");return e.fillStyle=r,e.strokeStyle="rgba(80, 40, 0, 1)",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Cryo.prototype.groupDescription=function(){return"Cryotherapy"},ED.CutterPI=function(t,e){this.className="CutterPI",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.CutterPI.prototype=new ED.Doodle,ED.CutterPI.prototype.constructor=ED.CutterPI,ED.CutterPI.superclass=ED.Doodle.prototype,ED.CutterPI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CutterPI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(160,40)},ED.CutterPI.prototype.draw=function(t){var e=this.drawing.context;return ED.CutterPI.superclass.draw.call(this,t),e.beginPath(),e.arc(0,-324,40,0,2*Math.PI,!0),e.fillStyle="rgba(255,255,255,1)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.CutterPI.prototype.groupDescription=function(){return"Cutter iridectomy/s"},ED.Cypass=function(t,e){this.className="Cypass",this.limbus=-400,this.radius=462,this.miotic="Miochol",this.viscoelastic="Viscoelastic",this.complication="Haemorrhage +",this.savedParameterArray=["rotation","radius","miotic","viscoelastic","complication"],this.controlParameterArray={miotic:"Miotic",viscoelastic:"Viscoelastic",complication:"Complication"},ED.Doodle.call(this,t,e)},ED.Cypass.prototype=new ED.Doodle,ED.Cypass.prototype.constructor=ED.Cypass,ED.Cypass.superclass=ED.Doodle.prototype,ED.Cypass.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.radius.range.setMinAndMax(415,480),this.parameterValidationArray.miotic={kind:"derived",type:"string",list:["Miochol","Carbachol","Pilocarpine 2%"],animate:!0},this.parameterValidationArray.viscoelastic={kind:"derived",type:"string",list:["Viscoelastic"],animate:!0},this.parameterValidationArray.complication={kind:"derived",type:"string",list:["Haemorrhage +","Haemorrhage ++","Haemorrhage +++"],animate:!0}},ED.Cypass.prototype.setParameterDefaults=function(){this.radius=462,this.setRotationWithDisplacements(315,270),this.setParameterFromString("miotic","Miochol"),this.setParameterFromString("viscoelastic","Viscoelastic"),this.setParameterFromString("complication","Haemorrhage +")},ED.Cypass.prototype.draw=function(t){var e=this.drawing.context,i=this.radius;if(ED.Cypass.superclass.draw.call(this,t),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r={w:14,h:36};e.beginPath(),e.moveTo(360,-60),e.lineTo(360,60),e.strokeStyle="rgba(0, 0, 0, 1)",e.stroke(),e.closePath(),e.beginPath(),e.rect(-200-i,-10,300,20);for(var a=1;a<4;a++)e.rect(99-i-5-19*a,-18,r.w,r.h);e.rect(99-i,-18,r.w+6,r.h),e.fillStyle="rgba(112, 96, 0, 1)",e.fill(),e.closePath(),e.beginPath();for(a=1;a<6;a++)e.arc(-200-i+5+40*a,0,5,0,2*Math.PI,!1);e.fillStyle="rgba(255, 255, 255, 0.8)",e.fill(),e.closePath(),e.beginPath(),e.rect(-200-i,-15,300,30),e.fillStyle="rgba(0, 0, 0, 0)",e.fill()}return this.isClicked},ED.Cypass.prototype.description=function(){var t="";return t+="Miotic: "+this.miotic+"\n",t+="Viscoelastic: "+this.viscoelastic+"\n",t+="Complication: "+this.complication+"\n",t+="Cypass stent at "+this.clockHour(-3)+" o'clock"},ED.CystoidMacularOedema=function(t,e){this.className="CystoidMacularOedema",this.savedParameterArray=["scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.CystoidMacularOedema.prototype=new ED.Doodle,ED.CystoidMacularOedema.prototype.constructor=ED.CystoidMacularOedema,ED.CystoidMacularOedema.superclass=ED.Doodle.prototype,ED.CystoidMacularOedema.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CystoidMacularOedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CystoidMacularOedema.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.scaleX=.5,this.scaleY=this.scaleX,this.originX=this.drawing.eye==ED.eye.Right?-100:100)},ED.CystoidMacularOedema.prototype.draw=function(t){var e=this.drawing.context;if(ED.CystoidMacularOedema.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,120,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var i="rgba(255, 255, 138, 0.5)",r="rgba(255, 82, 0, 0.7)",a=new ED.Point(0,0),o=0;o<8;o++){var n=2*o*Math.PI/8;a.setWithPolars(80,n),this.drawCircle(e,a.x,a.y,40,i,2,r)}this.drawCircle(e,0,0,60,i,2,r)}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.CystoidMacularOedema.prototype.description=function(){return"Cystoid macular oedema"},ED.CystoidMacularOedema.prototype.snomedCode=function(){return 193387007},ED.CystoidMacularOedema.prototype.diagnosticHierarchy=function(){return 0},ED.DendriticUlcer=function(t,e){this.className="DendriticUlcer",this.numberOfHandles=8,this.initialRadius=120,this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.DendriticUlcer.prototype=new ED.Doodle,ED.DendriticUlcer.prototype.constructor=ED.DendriticUlcer,ED.DendriticUlcer.superclass=ED.Doodle.prototype,ED.DendriticUlcer.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.DendriticUlcer.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,290),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0},ED.DendriticUlcer.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=!0,i=0;i<this.numberOfHandles;i++){var r=new ED.Point(0,0);e?(r.setWithPolars(this.initialRadius,2*i*Math.PI/this.numberOfHandles),e=!1):(r.setWithPolars(this.initialRadius/2,2*i*Math.PI/this.numberOfHandles),e=!0),this.addPointToSquiggle(r)}},ED.DendriticUlcer.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.DendriticUlcer.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=4,o.fillStyle="rgba(0, 255, 0, 0.5)",o.strokeStyle="rgba(0, 100, 0, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw;for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DendriticUlcer.prototype.description=function(){return"Dendritic ulcer"},ED.DendriticUlcer.prototype.snomedCode=function(){"use strict";return 193764001},ED.DiabeticNV=function(t,e){this.className="DiabeticNV",this.type="Active",this.savedParameterArray=["originX","originY","scaleX","scaleY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.DiabeticNV.prototype=new ED.Doodle,ED.DiabeticNV.prototype.constructor=ED.DiabeticNV,ED.DiabeticNV.superclass=ED.Doodle.prototype,ED.DiabeticNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.DiabeticNV.prototype.setPropertyDefaults=function(){this.parameterValidationArray.type={kind:"derived",type:"string",list:["Active","Inactive"],animate:!1}},ED.DiabeticNV.prototype.setParameterDefaults=function(){switch(this.drawing.numberOfDoodlesOfClass(this.className)){case 0:this.originX=this.drawing.eye==ED.eye.Right?300:-300,this.originY=-100;break;case 1:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=-236;break;case 2:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=236;break;default:this.setOriginWithDisplacements(0,-100)}},ED.DiabeticNV.prototype.draw=function(t){var e=this.drawing.context;ED.DiabeticNV.superclass.draw.call(this,t),e.beginPath();var i,r=0,a=Math.PI/8,o=new ED.Point(0,0),n=new ED.Point(0,0),s=new ED.Point(0,0),l=new ED.Point(0,0),h=new ED.Point(0,0);for(e.moveTo(0,0),i=0;i<8;i++)r=2*i*Math.PI/8,o.setWithPolars(30,r-a),n.setWithPolars(60,r-a),s.setWithPolars(60,r),l.setWithPolars(60,r+a),h.setWithPolars(30,r+a),e.bezierCurveTo(o.x,o.y,n.x,n.y,s.x,s.y),e.bezierCurveTo(l.x,l.y,h.x,h.y,0,0);return e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red","Inactive"==this.type&&(e.strokeStyle="gray"),this.drawBoundary(t),point=new ED.Point(0,0),point.setWithPolars(60,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiabeticNV.prototype.groupDescription=function(){return"New vessels "},ED.DiabeticNV.prototype.description=function(){return this.locationRelativeToDisc()+" ("+this.type.toLowerCase()+")"},ED.DiabeticNV.prototype.snomedCode=function(){return 61267008},ED.Dialysis=function(t,e){this.className="Dialysis",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Dialysis.prototype=new ED.Doodle,ED.Dialysis.prototype.constructor=ED.Dialysis,ED.Dialysis.superclass=ED.Doodle.prototype,ED.Dialysis.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Dialysis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,Math.PI)},ED.Dialysis.prototype.setParameterDefaults=function(){this.apexY=-350,this.arc=60*Math.PI/180,this.setRotationWithDisplacements(140,60)},ED.Dialysis.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var i=476,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);return e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s),e.lineWidth=8,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Dialysis.prototype.description=function(){var t="";return t=this.arc<Math.PI/4?"Small ":"Large ",t+="dialysis ",t+=this.clockHour()+" o'clock"},ED.Dialysis.prototype.snomedCode=function(){return 232003005},ED.Dialysis.prototype.diagnosticHierarchy=function(){return 0},ED.DiscHaemorrhage=function(t,e){this.className="DiscHaemorrhage",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.DiscHaemorrhage.prototype=new ED.Doodle,ED.DiscHaemorrhage.prototype.constructor=ED.DiscHaemorrhage,ED.DiscHaemorrhage.superclass=ED.Doodle.prototype,ED.DiscHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.DiscHaemorrhage.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(150,-120)},ED.DiscHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.DiscHaemorrhage.superclass.draw.call(this,t);var i=5*Math.PI/180,r=-Math.PI/2+i,a=-Math.PI/2-i;Math.sin(i),Math.cos(i),Math.sin(i);return e.beginPath(),e.arc(0,0,350,r,a,!0),e.arc(0,0,250,a,r,!1),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="red",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscHaemorrhage.prototype.groupDescription=function(){return"Disc haemorrhage at "},ED.DiscHaemorrhage.prototype.description=function(){return this.clockHour()+" o'clock"},ED.DiscPallor=function(t,e){this.className="DiscPallor",this.grade="Sectorial",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.DiscPallor.prototype=new ED.Doodle,ED.DiscPallor.prototype.constructor=ED.DiscPallor,ED.DiscPallor.superclass=ED.Doodle.prototype,ED.DiscPallor.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.DiscPallor.prototype.setPropertyDefaults=function(){this.isArcSymmetrical=!0,this.isMoveable=!1,this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Sectorial","Diffuse"],animate:!0},this.parameterValidationArray.arc.delta=.2},ED.DiscPallor.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.setRotationWithDisplacements(45,-120),this.setParameterFromString("grade","Sectorial")},ED.DiscPallor.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"arc":e<2*Math.PI?i.grade="Sectorial":i.grade="Diffuse";break;case"grade":switch(e){case"Sectorial":this.arc<2*Math.PI?i.arc=this.arc:i.arc=Math.PI/2;break;case"Diffuse":i.arc=2*Math.PI}}return i},ED.DiscPallor.prototype.draw=function(t){var e=this.drawing.context;ED.DiscPallor.superclass.draw.call(this,t);var i=this.drawing.firstDoodleOfClass("OpticDisc");if(i)var r=i.minimumRadius();else r=150;var a=r+(300-r)/2,o=this.arc/2,n=-Math.PI/2+o,s=-Math.PI/2-o,l=a*Math.sin(o),h=-a*Math.cos(o),d=-a*Math.sin(o),c=h;return e.beginPath(),e.arc(0,0,300,n,s,!0),e.arc(0,0,r,s,n,!1),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.5)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DiscPallor.prototype.groupDescription=function(){return"Diffuse"==this.grade?"Diffuse disc pallor":"Disc pallor at "},ED.DiscPallor.prototype.description=function(){return"Diffuse"==this.grade?"":this.clockHour()+" o'clock"},ED.DrainageRetinotomy=function(t,e){this.className="DrainageRetinotomy",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.DrainageRetinotomy.prototype=new ED.Doodle,ED.DrainageRetinotomy.prototype.constructor=ED.DrainageRetinotomy,ED.DrainageRetinotomy.superclass=ED.Doodle.prototype,ED.DrainageRetinotomy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.DrainageRetinotomy.prototype.draw=function(t){var e=this.drawing.context;return ED.DrainageRetinotomy.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=16,e.fillStyle="rgba(255,0,0,0.5)",e.strokeStyle="red",this.drawBoundary(t),this.isClicked},ED.DrainageRetinotomy.prototype.description=function(){return"Drainage retinotomy in "+this.quadrant()},ED.DrainageSite=function(t,e){this.className="DrainageSite",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.DrainageSite.prototype=new ED.Doodle,ED.DrainageSite.prototype.constructor=ED.DrainageSite,ED.DrainageSite.superclass=ED.Doodle.prototype,ED.DrainageSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.DrainageSite.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.DrainageSite.prototype.draw=function(t){var e=this.drawing.context;ED.DrainageSite.superclass.draw.call(this,t);var i=Math.PI/30,r=-Math.PI/2+i,a=-Math.PI/2-i;return e.beginPath(),e.arc(0,0,440,r,a,!0),e.lineTo(0,-360),e.closePath(),e.lineWidth=4,e.strokeStyle="#777",this.drawBoundary(t),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.DrainageSite.prototype.groupDescription=function(){return"Drainage site at "},ED.DrainageSite.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Drusen=function(t,e){this.className="Drusen",this.drusenType="Hard",this.blur=0,this.scaleRangeMin=.5,this.scaleRangeMax=1.5,this.maximumExtentOriginXRangeMin=-290,this.maximumExtentOriginXRangeMax=180,this.maximumExtentOriginYRangeMin=-250,this.maximumExtentOriginYRangeMax=250,this.minimumExtentOriginXRangeMin=-85,this.minimumExtentOriginXRangeMax=-25,this.minimumExtentOriginYRangeMin=-30,this.minimumExtentOriginYRangeMax=30,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","drusenType","blur"],this.controlParameterArray={drusenType:"Drusen type"},ED.Doodle.call(this,t,e)},ED.Drusen.prototype=new ED.Doodle,ED.Drusen.prototype.constructor=ED.Drusen,ED.Drusen.superclass=ED.Doodle.prototype,ED.Drusen.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Drusen.prototype.setPropertyDefaults=function(){this.isMoveable=!0,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(this.scaleRangeMin,this.scaleRangeMax),this.parameterValidationArray.scaleY.range.setMinAndMax(this.scaleRangeMin,this.scaleRangeMax),this.parameterValidationArray.originX.range.setMinAndMax(this.maximumExtentOriginXRangeMin,this.maximumExtentOriginXRangeMax),this.parameterValidationArray.originY.range.setMinAndMax(this.maximumExtentOriginYRangeMin,this.maximumExtentOriginYRangeMax),this.parameterValidationArray.drusenType={kind:"derived",type:"string",list:["Hard","Soft","Confluent"]}},ED.Drusen.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5),this.setParameterFromString("drusenType","Hard")},ED.Drusen.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"drusenType":switch(e){case"Hard":i.blur=0;break;case"Soft":i.blur=1;break;case"Confluent":i.blur=2}break;case"scaleY":var r=e;this.parameterValidationArray.originX.range.setMinAndMax(MathHelper.calculateLinearFunctionFromPoints(this.scaleRangeMin,this.maximumExtentOriginXRangeMin,this.scaleRangeMax,this.minimumExtentOriginXRangeMin,r),MathHelper.calculateLinearFunctionFromPoints(this.scaleRangeMin,this.maximumExtentOriginXRangeMax,this.scaleRangeMax,this.minimumExtentOriginXRangeMax,r)),this.parameterValidationArray.originY.range.setMinAndMax(MathHelper.calculateLinearFunctionFromPoints(this.scaleRangeMin,this.maximumExtentOriginYRangeMin,this.scaleRangeMax,this.minimumExtentOriginYRangeMin,r),MathHelper.calculateLinearFunctionFromPoints(this.scaleRangeMin,this.maximumExtentOriginYRangeMax,this.scaleRangeMax,this.minimumExtentOriginYRangeMax,r));var a=this.parameterValidationArray.originY.range.constrain(this.originY),o=this.parameterValidationArray.originX.range.constrain(this.originX);this.setSimpleParameter("originX",o),this.setSimpleParameter("originY",a)}return i},ED.Drusen.prototype.draw=function(t){var e=this.drawing.context;ED.Drusen.superclass.draw.call(this,t),e.beginPath();var i=200;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r,a,o="Soft"===this.drusenType?25:"Confluent"===this.drusenType?31:10,n=new ED.Point(0,0),s=20+Math.abs(Math.floor(this.apexY/2));r=o/this.scaleX;for(var l=0;l<s;l++)n.setWithPolars(i*ED.randomArray[l],2*Math.PI*ED.randomArray[l+100]),e.beginPath(),e.arc(n.x,n.y,r,0,2*Math.PI,!0),(a=e.createRadialGradient(n.x,n.y,10/this.scaleX,n.x,n.y,r)).addColorStop(0,"lightgray"),a.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle="Hard"===this.drusenType?"lightgray":a,e.lineWidth=0,e.fill(),e.stroke(),e.closePath()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(140,-140)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Drusen.prototype.description=function(){var t="Signficant numbers of ";return this.apexY>-100&&(t="Moderate numbers of "),this.apexY>-50&&(t="Several "),t+this.drusenType.toLowerCase()+" drusen"},ED.EncirclingBand=function(t,e){this.className="EncirclingBand",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.EncirclingBand.prototype=new ED.Doodle,ED.EncirclingBand.prototype.constructor=ED.EncirclingBand,ED.EncirclingBand.superclass=ED.Doodle.prototype,ED.EncirclingBand.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0},ED.EncirclingBand.prototype.setParameterDefaults=function(){this.rotation=-45*Math.PI/180},ED.EncirclingBand.prototype.draw=function(t){var e=this.drawing.context;ED.EncirclingBand.superclass.draw.call(this,t);var i=270,r=this.drawing.lastDoodleOfClass("CircumferentialBuckle");if(r){var a=r.apexY;-350>a&&a>-380?i=286:a<-380&&(i=315)}var o=i+15,n=i-15;if(e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!0),e.arc(0,0,n,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var s=Math.PI/16;e.arc(0,0,o+10,s,-s,!0),e.arc(0,0,n-10,-s,s,!1),e.closePath(),e.lineWidth=6,e.stroke()}return this.isClicked},ED.EncirclingBand.prototype.description=function(){var t="Encircling band, with Watzke in ";if(this.drawing.eye==ED.eye.Right)var e=!0;else e=!1;var i=this.rotation+Math.PI/2;return t+=Math.cos(i)>0?"supero":"infero",t+=Math.sin(i)>0?e?"nasal":"temporal":e?"temporal":"nasal",t+=" quadrant"},ED.EndothelialKeratoplasty=function(t,e){this.className="EndothelialKeratoplasty",this.pixelsPerMillimetre=63.3333,this.antsegRadius=190,this.diameter=9,this.type="DMEK",this.typeSimple=1,this.csOriginX=50,this.savedParameterArray=["originX","originY","apexY","type","typeSimple","csOriginX"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.EndothelialKeratoplasty.prototype=new ED.Doodle,ED.EndothelialKeratoplasty.prototype.constructor=ED.EndothelialKeratoplasty,ED.EndothelialKeratoplasty.superclass=ED.Doodle.prototype,ED.EndothelialKeratoplasty.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.EndothelialKeratoplasty.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-11.9*this.pixelsPerMillimetre/2,-6.5*this.pixelsPerMillimetre/2),this.handleCoordinateRangeArray=new Array,this.handleCoordinateRangeArray[0]={x:new ED.Range(-0,0),y:new ED.Range(-2.9*this.pixelsPerMillimetre/2,2.5*this.pixelsPerMillimetre/2)},this.parameterValidationArray.type={kind:"derived",type:"string",list:["DMEK","DSAEK"],animate:!1},this.parameterValidationArray.typeSimple={kind:"other",type:"int",range:new ED.Range(1,2),animate:!1},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(6.5,12),animate:!0}},ED.EndothelialKeratoplasty.prototype.setParameterDefaults=function(){this.setParameterFromString("diameter","9.0");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(0,0);this.addPointToSquiggle(e)},ED.EndothelialKeratoplasty.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.diameter=-2*e/this.pixelsPerMillimetre;var r=Math.sqrt((this.antsegRadius+this.antsegRadius+e)*(this.antsegRadius+this.antsegRadius+e)-this.originX*this.originX),a=Math.sqrt((this.antsegRadius+this.antsegRadius+e)*(this.antsegRadius+this.antsegRadius+e)-this.originY*this.originY);this.parameterValidationArray.originY.range.setMinAndMax(-r,+r),this.parameterValidationArray.originX.range.setMinAndMax(-a,+a);var o=this.parameterValidationArray.originX.range.constrain(this.originX),n=this.parameterValidationArray.originY.range.constrain(this.originY);this.setSimpleParameter("originY",n),this.setSimpleParameter("originX",o);break;case"diameter":i.apexY=-e*this.pixelsPerMillimetre/2;break;case"originX":r=Math.sqrt((this.antsegRadius+this.antsegRadius+this.apexY)*(this.antsegRadius+this.antsegRadius+this.apexY)-e*e);if(this.parameterValidationArray.originY.range.setMinAndMax(-r,+r),this.drawing.isActive)n=this.parameterValidationArray.originY.range.constrain(this.originY);else var n=this.originY;this.setSimpleParameter("originY",n),(s=this.drawing.lastDoodleOfClass("CornealGraftRejection"))&&s.cornealGraft==this&&(s.setSimpleParameter("originX",e),s.computeDoodleHeight());break;case"originY":var s;a=Math.sqrt((this.antsegRadius+this.antsegRadius+this.apexY)*(this.antsegRadius+this.antsegRadius+this.apexY)-e*e);if(this.parameterValidationArray.originX.range.setMinAndMax(-a,+a),this.drawing.isActive)o=this.parameterValidationArray.originX.range.constrain(this.originX);else var o=this.originX;this.setSimpleParameter("originX",o),(s=this.drawing.lastDoodleOfClass("CornealGraftRejection"))&&s.cornealGraft==this&&(s.setSimpleParameter("originY",e),s.computeDoodleHeight());break;case"depth":i.d=parseInt(e);break;case"handles":var l=this.squiggleArray[0].pointsArray[0].y-9*this.pixelsPerMillimetre/2;i.diameter=-2*l/this.pixelsPerMillimetre,i.apexY=l;r=Math.sqrt((this.antsegRadius+this.antsegRadius+l)*(this.antsegRadius+this.antsegRadius+l)-this.originX*this.originX),a=Math.sqrt((this.antsegRadius+this.antsegRadius+l)*(this.antsegRadius+this.antsegRadius+l)-this.originY*this.originY);this.parameterValidationArray.originY.range.setMinAndMax(-r,+r),this.parameterValidationArray.originX.range.setMinAndMax(-a,+a);o=this.parameterValidationArray.originX.range.constrain(this.originX),n=this.parameterValidationArray.originY.range.constrain(this.originY);this.setSimpleParameter("originY",n),this.setSimpleParameter("originX",o);break;case"type":i.typeSimple="DMEK"==e?1:2}return i},ED.EndothelialKeratoplasty.prototype.draw=function(t){var e=this.drawing.context;ED.EndothelialKeratoplasty.superclass.draw.call(this,t),e.beginPath();var i=-this.apexY;return e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="gray",e.fillStyle="rgba(255, 255, 255, 0)",e.stroke(),this.drawBoundary(t),e.closePath(),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EndothelialKeratoplasty.prototype.description=function(){return this.type},ED.EndothelialKeratoplastyCrossSection=function(t,e){this.className="EndothelialKeratoplastyCrossSection",this.pixelsPerMillimetre=63.3333,this.initialRadius=360,this.diameter=9,this.typeSimple=1,this.handle1Y=-4.5*this.pixelsPerMillimetre,this.handle1X=-60,this.handle2Y=0,this.handle2X=-220,this.handle3Y=4.5*this.pixelsPerMillimetre,this.handle3X=-60,this.savedParameterArray=["originX","originY","apexY","diameter","typeSimple"],this.controlParameterArray={},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={EndothelialKeratoplasty:{source:["originY","apexY","diameter","typeSimple"],store:[["originX","csOriginX"]]}}},ED.EndothelialKeratoplastyCrossSection.prototype=new ED.Doodle,ED.EndothelialKeratoplastyCrossSection.prototype.constructor=ED.EndothelialKeratoplastyCrossSection,ED.EndothelialKeratoplastyCrossSection.superclass=ED.Doodle.prototype,ED.EndothelialKeratoplastyCrossSection.prototype.setHandles=function(){},ED.EndothelialKeratoplastyCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!1,this.isFilled=!1,this.apexY=-4.5*this.pixelsPerMillimetre,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-12*this.pixelsPerMillimetre/2,-6.5*this.pixelsPerMillimetre/2),this.parameterValidationArray.d={kind:"other",type:"int",range:new ED.Range(1,100),animate:!1},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(6.5,12),precision:1,animate:!0},this.parameterValidationArray.typeSimple={kind:"other",type:"int",range:new ED.Range(1,2),animate:!1}},ED.EndothelialKeratoplastyCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.setParameterFromString("diameter","9.0");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(this.handle1X,this.handle1Y);this.addPointToSquiggle(e);var i=new ED.Point(this.handle2X,this.handle2Y);this.addPointToSquiggle(i);var r=new ED.Point(this.handle3X,this.handle3Y);this.addPointToSquiggle(r)},ED.EndothelialKeratoplastyCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":if(i.diameter=-2*e/this.pixelsPerMillimetre,this.squiggleArray.length>0){var r=this.getXLimitOnCornea(e),a=this.getXLimitOnCornea(-e);this.squiggleArray[0].pointsArray[0]=new ED.Point(r,e),this.squiggleArray[0].pointsArray[2]=new ED.Point(a,-e)}this.handle1Y=e,this.handle3Y=-e;break;case"diameter":i.apexY=-e*this.pixelsPerMillimetre/2;break;case"typeSimple":i.typeSimple=parseInt(e);break;case"handles":0==this.draggingHandleIndex?(this.handle1X=this.squiggleArray[0].pointsArray[0].x,this.handle1Y=this.squiggleArray[0].pointsArray[0].y):1==this.draggingHandleIndex?(this.handle2X=this.squiggleArray[0].pointsArray[1].x,this.handle2Y=this.squiggleArray[0].pointsArray[1].y):2==this.draggingHandleIndex&&(this.handle3X=this.squiggleArray[0].pointsArray[2].x,this.handle3Y=this.squiggleArray[0].pointsArray[2].y);var o=this.getXLimitOnCornea(this.squiggleArray[0].pointsArray[this.draggingHandleIndex].y);this.handleCoordinateRangeArray[this.draggingHandleIndex].x=new ED.Range(o,200)}return i},ED.EndothelialKeratoplastyCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=i.pachymetry/5;ED.EndothelialKeratoplastyCrossSection.superclass.draw.call(this,t),e.beginPath();var a=this.originY+this.apexY,o=this.originY-this.apexY,n=(a+380)/760;n<0&&(n=0);var s=(o+380)/760;s>1&&(s=1);var l=10,h=6,d=6,c=4;if(2==this.typeSimple&&(l=50,h=30,d=30,c=20),n<.5){var p=new Object,y=new Object,D=2*n,u=s<.5?2*s:1;if(i&&"Keratoconus"==i.shape?(p.SP=new ED.Point(0,-380-this.originY),p.CP1=new ED.Point(-80,-260-this.originY),p.CP2=new ED.Point(i.apexX+r,i.apexY-120-this.originY),p.EP=new ED.Point(i.apexX+r,i.apexY-this.originY),y.SP=new ED.Point(0+l,-380-this.originY),y.CP1=new ED.Point(-80+h,-260-this.originY),y.CP2=new ED.Point(i.apexX+r+d,i.apexY-120-this.originY),y.EP=new ED.Point(i.apexX+r+c,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(p.SP=new ED.Point(0,-380-this.originY),p.CP1=new ED.Point(-120,-200-this.originY),p.CP2=new ED.Point(-280,-140-this.originY),p.EP=new ED.Point(-280,100-this.originY),y.SP=new ED.Point(0+l,-380-this.originY),y.CP1=new ED.Point(-120+h,-200-this.originY),y.CP2=new ED.Point(-280+d,-140-this.originY),y.EP=new ED.Point(-280+c,100-this.originY)):(p.SP=new ED.Point(0,-380-this.originY),p.CP1=new ED.Point(-80,-260-this.originY),p.CP2=new ED.Point(-220,-160-this.originY),p.EP=new ED.Point(-220,0-this.originY),y.SP=new ED.Point(0+l,-380-this.originY),y.CP1=new ED.Point(-80+h,-260-this.originY),y.CP2=new ED.Point(-220+d,-160-this.originY),y.EP=new ED.Point(-220+c,0-this.originY)),D>0){(I=new ED.Point(0,0)).y=(1-D)*(1-D)*(1-D)*p.SP.y+3*(1-D)*(1-D)*D*p.CP1.y+3*(1-D)*D*D*p.CP2.y+D*D*D*p.EP.y,I.x=(1-D)*(1-D)*(1-D)*p.SP.x+3*(1-D)*(1-D)*D*p.CP1.x+3*(1-D)*D*D*p.CP2.x+D*D*D*p.EP.x,(w=new ED.Point(0,0)).x=p.CP1.x+D*(p.CP2.x-p.CP1.x),w.y=p.CP1.y+D*(p.CP2.y-p.CP1.y);var g=new ED.Point(0,0);g.x=p.CP2.x+D*(p.EP.x-p.CP2.x),g.y=p.CP2.y+D*(p.EP.y-p.CP2.y);var P=new ED.Point(0,0);P.x=w.x+D*(g.x-w.x),P.y=w.y+D*(g.y-w.y),p.SP=I,p.CP1=P,p.CP2=g,(R=new ED.Point(0,0)).y=(1-D)*(1-D)*(1-D)*y.SP.y+3*(1-D)*(1-D)*D*y.CP1.y+3*(1-D)*D*D*y.CP2.y+D*D*D*y.EP.y,R.x=(1-D)*(1-D)*(1-D)*y.SP.x+3*(1-D)*(1-D)*D*y.CP1.x+3*(1-D)*D*D*y.CP2.x+D*D*D*y.EP.x,(A=new ED.Point(0,0)).x=y.CP1.x+D*(y.CP2.x-y.CP1.x),A.y=y.CP1.y+D*(y.CP2.y-y.CP1.y);var E=new ED.Point(0,0);E.x=y.CP2.x+D*(y.EP.x-y.CP2.x),E.y=y.CP2.y+D*(y.EP.y-y.CP2.y);var m=new ED.Point(0,0);m.x=A.x+D*(E.x-A.x),m.y=A.y+D*(E.y-A.y),y.SP=R,y.CP1=m,y.CP2=E}if(u<1){var f=new ED.Point(0,0);f.y=(1-u)*(1-u)*(1-u)*p.SP.y+3*(1-u)*(1-u)*u*p.CP1.y+3*(1-u)*u*u*p.CP2.y+u*u*u*p.EP.y,f.x=(1-u)*(1-u)*(1-u)*p.SP.x+3*(1-u)*(1-u)*u*p.CP1.x+3*(1-u)*u*u*p.CP2.x+u*u*u*p.EP.x;var w,x=new ED.Point(0,0);x.x=p.SP.x+u*(p.CP1.x-p.SP.x),x.y=p.SP.y+u*(p.CP1.y-p.SP.y),(w=new ED.Point(0,0)).x=p.CP1.x+u*(p.CP2.x-p.CP1.x),w.y=p.CP1.y+u*(p.CP2.y-p.CP1.y);var b=new ED.Point(0,0);b.x=x.x+u*(w.x-x.x),b.y=x.y+u*(w.y-x.y),p.CP1=x,p.CP2=b,p.EP=f;var v=new ED.Point(0,0);v.y=(1-u)*(1-u)*(1-u)*y.SP.y+3*(1-u)*(1-u)*u*y.CP1.y+3*(1-u)*u*u*y.CP2.y+u*u*u*y.EP.y,v.x=(1-u)*(1-u)*(1-u)*y.SP.x+3*(1-u)*(1-u)*u*y.CP1.x+3*(1-u)*u*u*y.CP2.x+u*u*u*y.EP.x;var A,C=new ED.Point(0,0);C.x=y.SP.x+u*(y.CP1.x-y.SP.x),C.y=y.SP.y+u*(y.CP1.y-y.SP.y),(A=new ED.Point(0,0)).x=y.CP1.x+u*(y.CP2.x-y.CP1.x),A.y=y.CP1.y+u*(y.CP2.y-y.CP1.y);var M=new ED.Point(0,0);M.x=C.x+u*(A.x-C.x),M.y=C.y+u*(A.y-C.y),y.CP1=C,y.CP2=M,y.EP=v}}if(s>.5){var S=new Object,T=new Object,k=n>.5?2*(n-.5):0,Y=2*(s-.5);if(i&&"Keratoconus"==i.shape?(S.SP=new ED.Point(i.apexX+r,i.apexY-this.originY),S.CP1=new ED.Point(i.apexX+r,i.apexY+120-this.originY),S.CP2=new ED.Point(-80,260-this.originY),S.EP=new ED.Point(0,380-this.originY),T.SP=new ED.Point(i.apexX+r+c,i.apexY-this.originY),T.CP1=new ED.Point(i.apexX+r+d,i.apexY+120-this.originY),T.CP2=new ED.Point(-80+h,260-this.originY),T.EP=new ED.Point(0+l,380-this.originY)):i&&"Keratoglobus"==i.shape?(S.SP=new ED.Point(-280,100-this.originY),S.CP1=new ED.Point(-260,220-this.originY),S.CP2=new ED.Point(-80,260-this.originY),S.EP=new ED.Point(0,380-this.originY),T.SP=new ED.Point(-280+c,100-this.originY),T.CP1=new ED.Point(-260+d,220-this.originY),T.CP2=new ED.Point(-80+h,260-this.originY),T.EP=new ED.Point(0+l,380-this.originY)):(S.SP=new ED.Point(-220,-0-this.originY),S.CP1=new ED.Point(-220,160-this.originY),S.CP2=new ED.Point(-80,260-this.originY),S.EP=new ED.Point(0,380-this.originY),T.SP=new ED.Point(-220+c,-0-this.originY),T.CP1=new ED.Point(-220+d,160-this.originY),T.CP2=new ED.Point(-80+h,260-this.originY),T.EP=new ED.Point(0+l,380-this.originY)),k>0){var I;(I=new ED.Point(0,0)).y=(1-k)*(1-k)*(1-k)*S.SP.y+3*(1-k)*(1-k)*k*S.CP1.y+3*(1-k)*k*k*S.CP2.y+k*k*k*S.EP.y,I.x=(1-k)*(1-k)*(1-k)*S.SP.x+3*(1-k)*(1-k)*k*S.CP1.x+3*(1-k)*k*k*S.CP2.x+k*k*k*S.EP.x,(W=new ED.Point(0,0)).x=S.CP1.x+k*(S.CP2.x-S.CP1.x),W.y=S.CP1.y+k*(S.CP2.y-S.CP1.y);var H=new ED.Point(0,0);H.x=S.CP2.x+k*(S.EP.x-S.CP2.x),H.y=S.CP2.y+k*(S.EP.y-S.CP2.y);var R,X=new ED.Point(0,0);X.x=W.x+k*(H.x-W.x),X.y=W.y+k*(H.y-W.y),S.SP=I,S.CP1=X,S.CP2=H,(R=new ED.Point(0,0)).y=(1-k)*(1-k)*(1-k)*T.SP.y+3*(1-k)*(1-k)*k*T.CP1.y+3*(1-k)*k*k*T.CP2.y+k*k*k*T.EP.y,R.x=(1-k)*(1-k)*(1-k)*T.SP.x+3*(1-k)*(1-k)*k*T.CP1.x+3*(1-k)*k*k*T.CP2.x+k*k*k*T.EP.x,(N=new ED.Point(0,0)).x=T.CP1.x+k*(T.CP2.x-T.CP1.x),N.y=T.CP1.y+k*(T.CP2.y-T.CP1.y);var V=new ED.Point(0,0);V.x=T.CP2.x+k*(T.EP.x-T.CP2.x),V.y=T.CP2.y+k*(T.EP.y-T.CP2.y);var F=new ED.Point(0,0);F.x=N.x+k*(V.x-N.x),F.y=N.y+k*(V.y-N.y),T.SP=R,T.CP1=F,T.CP2=V}if(Y<1){var O=new ED.Point(0,0);O.y=(1-Y)*(1-Y)*(1-Y)*S.SP.y+3*(1-Y)*(1-Y)*Y*S.CP1.y+3*(1-Y)*Y*Y*S.CP2.y+Y*Y*Y*S.EP.y,O.x=(1-Y)*(1-Y)*(1-Y)*S.SP.x+3*(1-Y)*(1-Y)*Y*S.CP1.x+3*(1-Y)*Y*Y*S.CP2.x+Y*Y*Y*S.EP.x;var W,z=new ED.Point(0,0);z.x=S.SP.x+Y*(S.CP1.x-S.SP.x),z.y=S.SP.y+Y*(S.CP1.y-S.SP.y),(W=new ED.Point(0,0)).x=S.CP1.x+Y*(S.CP2.x-S.CP1.x),W.y=S.CP1.y+Y*(S.CP2.y-S.CP1.y);var L=new ED.Point(0,0);L.x=z.x+Y*(W.x-z.x),L.y=z.y+Y*(W.y-z.y),S.CP1=z,S.CP2=L,S.EP=O;var B=new ED.Point(0,0);B.y=(1-Y)*(1-Y)*(1-Y)*T.SP.y+3*(1-Y)*(1-Y)*Y*T.CP1.y+3*(1-Y)*Y*Y*T.CP2.y+Y*Y*Y*T.EP.y,B.x=(1-Y)*(1-Y)*(1-Y)*T.SP.x+3*(1-Y)*(1-Y)*Y*T.CP1.x+3*(1-Y)*Y*Y*T.CP2.x+Y*Y*Y*T.EP.x;var N,q=new ED.Point(0,0);q.x=T.SP.x+Y*(T.CP1.x-T.SP.x),q.y=T.SP.y+Y*(T.CP1.y-T.SP.y),(N=new ED.Point(0,0)).x=T.CP1.x+Y*(T.CP2.x-T.CP1.x),N.y=T.CP1.y+Y*(T.CP2.y-T.CP1.y);var G=new ED.Point(0,0);G.x=q.x+Y*(N.x-q.x),G.y=q.y+Y*(N.y-q.y),T.CP1=q,T.CP2=G,T.EP=B}}return S&&(e.moveTo(S.EP.x,S.EP.y),e.lineTo(T.EP.x,T.EP.y),e.bezierCurveTo(T.CP2.x,T.CP2.y,T.CP1.x,T.CP1.y,T.SP.x,T.SP.y),e.moveTo(S.EP.x,S.EP.y)),p&&(e.moveTo(y.EP.x,y.EP.y),e.bezierCurveTo(y.CP2.x,y.CP2.y,y.CP1.x,y.CP1.y,y.SP.x,y.SP.y),e.moveTo(y.SP.x,y.SP.y),e.lineTo(p.SP.x,p.SP.y)),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0,0,0,0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),S&&(e.moveTo(T.EP.x,T.EP.y),e.bezierCurveTo(T.CP2.x,T.CP2.y,T.CP1.x,T.CP1.y,T.SP.x,T.SP.y),p&&e.lineTo(y.EP.x,y.EP.y)),p&&(e.moveTo(y.EP.x,y.EP.y),e.bezierCurveTo(y.CP2.x,y.CP2.y,y.CP1.x,y.CP1.y,y.SP.x,y.SP.y)),e.strokeStyle="gray",e.lineWidth=15,e.lineJoin="miter",e.miterLimit=200,e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EndothelialKeratoplastyCrossSection.prototype.getXLimitOnCornea=function(t){var e,i,r,a,o=this.drawing.lastDoodleOfClass("CorneaCrossSection"),n=o.pachymetry/5,s=this.originY+t,l=10,h=6,d=6,c=4;2==this.typeSimple&&(l=50,h=30,d=30,c=20);var p=(s+380)/760;return p<0&&(p=0),p>1&&(p=1),p<=.5&&(p*=2,o&&"Keratoconus"==o.shape?(e=new ED.Point(0+l,-380),i=new ED.Point(-80+h,-260),r=new ED.Point(o.apexX+n+d,o.apexY-120),a=new ED.Point(o.apexX+n+c,o.apexY)):o&&"Keratoglobus"==o.shape?(e=new ED.Point(0+l,-380),i=new ED.Point(-120+h,-200),r=new ED.Point(-280+d,-140),a=new ED.Point(-280+c,100)):(e=new ED.Point(0+l,-380),i=new ED.Point(-80+h,-260),r=new ED.Point(-220+d,-160),a=new ED.Point(-220+c,0))),p>.5&&(p=2*(p-.5),o&&"Keratoconus"==o.shape?(e=new ED.Point(o.apexX+n+c,o.apexY),i=new ED.Point(o.apexX+n+d,o.apexY+120),r=new ED.Point(-80+h,260),a=new ED.Point(0+l,380)):o&&"Keratoglobus"==o.shape?(e=new ED.Point(-280+c,100),i=new ED.Point(-260+d,220),r=new ED.Point(-80+h,260),a=new ED.Point(0+l,380)):(e=new ED.Point(-220+c,-0),i=new ED.Point(-220+d,160),r=new ED.Point(-80+h,260),a=new ED.Point(0+l,380))),e.bezierPointAtParameter(p,i,r,a).x},ED.EntrySiteBreak=function(t,e){this.className="EntrySiteBreak",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.EntrySiteBreak.prototype=new ED.Doodle,ED.EntrySiteBreak.prototype.constructor=ED.EntrySiteBreak,ED.EntrySiteBreak.superclass=ED.Doodle.prototype,ED.EntrySiteBreak.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.EntrySiteBreak.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,3*Math.PI/16)},ED.EntrySiteBreak.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.EntrySiteBreak.prototype.draw=function(t){var e=this.drawing.context;ED.EntrySiteBreak.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i,o=460*Math.sin(i),n=-460*Math.cos(i),s=-460*Math.sin(i),l=n;return e.beginPath(),e.arc(0,0,460,r,a,!0),e.bezierCurveTo(0,-400,0,-400,o,n),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(o,n)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane=function(t,e){this.className="EpiretinalMembrane",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.EpiretinalMembrane.prototype=new ED.Doodle,ED.EpiretinalMembrane.prototype.constructor=ED.EpiretinalMembrane,ED.EpiretinalMembrane.superclass=ED.Doodle.prototype,ED.EpiretinalMembrane.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.EpiretinalMembrane.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.EpiretinalMembrane.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.scaleX=.5,this.scaleY=this.scaleX,this.originX=this.drawing.eye==ED.eye.Right?-100:100)},ED.EpiretinalMembrane.prototype.draw=function(t){var e=this.drawing.context;ED.EpiretinalMembrane.superclass.draw.call(this,t),e.beginPath();var i=120;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.strokeStyle="rgba(0, 255, 0, 0.7)",e.beginPath(),e.moveTo(-i,0),e.lineTo(i,0);var r=108,a=-60,o=.3;e.moveTo(-r,a),e.bezierCurveTo(-r*o,a*o,r*o,a*o,r,a),a=60,e.moveTo(-r,a),e.bezierCurveTo(-r*o,a*o,r*o,a*o,r,a),r=72,a=-96,o=.5,e.moveTo(-r,a),e.bezierCurveTo(-r*o,a*o,r*o,a*o,r,a),a=96,e.moveTo(-r,a),e.bezierCurveTo(-r*o,a*o,r*o,a*o,r,a),e.lineWidth=18,e.lineCap="round",e.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.EpiretinalMembrane.prototype.description=function(){return"Epiretinal membrane"},ED.EpiretinalMembrane.prototype.snomedCode=function(){return 367649002},ED.EpiretinalMembrane.prototype.diagnosticHierarchy=function(){return 0},ED.Episcleritis=function(t,e){this.className="Episcleritis",this.severity="Medium",this.savedParameterArray=["arc","rotation","severity"],this.controlParameterArray={severity:"Severity"},ED.Doodle.call(this,t,e)},ED.Episcleritis.prototype=new ED.Doodle,ED.Episcleritis.prototype.constructor=ED.Episcleritis,ED.Episcleritis.superclass=ED.Doodle.prototype,ED.Episcleritis.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Episcleritis.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.severity={kind:"other",type:"string",list:["Severe","Medium","Mild"],animate:!1}},ED.Episcleritis.prototype.setParameterDefaults=function(){this.arc=20*Math.PI/180,this.setRotationWithDisplacements(90,-90);var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.arc=t.arc,this.severity=t.severity)},ED.Episcleritis.prototype.draw=function(t){var e=this.drawing.context;ED.Episcleritis.superclass.draw.call(this,t);var i=457.5,r=this.arc/2,a=(Math.PI,-Math.PI/2-r),o=i*Math.sin(r),n=-i*Math.cos(r),s=-i*Math.sin(r),l=n;if(e.beginPath(),e.arc(0,0,495,-Math.PI/2+r,-Math.PI/2-r,!0),e.arc(0,0,420,-Math.PI/2-r,-Math.PI/2+r,!1),e.closePath(),e.fillStyle="rgba(218,230,241,0)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var h=2*Math.PI/120,d=Math.floor(this.arc/h),c=new ED.Point(0,0),p=new ED.Point(0,0);e.beginPath();for(var y=0;y<d;y++){r=Math.PI/2+a+y*h;c.setWithPolars(495,r),p.setWithPolars(420,r),e.moveTo(c.x,c.y),e.lineTo(p.x,p.y)}switch(e.strokeStyle="red",this.severity){case"Severe":e.lineWidth=16;break;case"Medium":e.lineWidth=12;break;case"Mild":e.lineWidth=8}e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(o,n)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Episcleritis.prototype.groupDescription=function(){var t=this.severity+" episcleritis";return this.arc<1.8*Math.PI&&(t+=" centred ",t+=Math.cos(this.rotation)>0?"supero":"infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasally":"temporally":this.drawing.eye==ED.eye.Right?"temporally":"nasally"),t},ED.Episcleritis.prototype.drawSoftLine=function(t,e,i,r,a,o,n,s,l){var h=this.drawing.context,d=i-t,c=r-e,p=Math.sqrt(d*d+c*c),y=d/p*a,D=c/p*a,u=h.createLinearGradient(t-D/2,e+y/2,t+D/2,e-y/2);u.addColorStop(0,"rgba("+o+","+n+","+s+",0)"),u.addColorStop(.43,"rgba("+o+","+n+","+s+","+l+")"),u.addColorStop(.57,"rgba("+o+","+n+","+s+","+l+")"),u.addColorStop(1,"rgba("+o+","+n+","+s+",0)"),h.save(),h.beginPath(),h.lineWidth=a,h.strokeStyle=u,h.moveTo(t,e),h.lineTo(i,r),h.stroke(),h.restore()},ED.Episcleritis.prototype.snomedCode=function(){"use strict";return 815008},ED.Eyeball=function(t,e){this.className="Eyeball",ED.Doodle.call(this,t,e)},ED.Eyeball.prototype=new ED.Doodle,ED.Eyeball.prototype.constructor=ED.Eyeball,ED.Eyeball.superclass=ED.Doodle.prototype,ED.Eyeball.prototype.setHandles=function(){},ED.Eyeball.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isFilled=!1},ED.Eyeball.prototype.setParameterDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isScalable=!1,this.isRotatable=!1,this.isShowHighlight=!1},ED.Eyeball.prototype.draw=function(t){var e=this.drawing.context;ED.Eyeball.superclass.draw.call(this,t);if(e.beginPath(),e.beginPath(),e.arc(0,0,250,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.strokeStyle="black",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(120,0),e.arc(0,0,120,0,2*Math.PI),e.fillStyle="gray",e.fill(),e.stroke(),e.closePath();e.beginPath(),e.moveTo(45,0),e.arc(0,0,45,0,2*Math.PI),e.fillStyle="black",e.stroke(),e.fill(),e.closePath()}return this.isClicked},ED.FibrousProliferation=function(t,e){this.className="FibrousProliferation",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.FibrousProliferation.prototype=new ED.Doodle,ED.FibrousProliferation.prototype.constructor=ED.FibrousProliferation,ED.FibrousProliferation.superclass=ED.Doodle.prototype,ED.FibrousProliferation.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.FibrousProliferation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrousProliferation.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-200,150),this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/4:Math.PI/4},ED.FibrousProliferation.prototype.draw=function(t){var e=this.drawing.context;ED.FibrousProliferation.superclass.draw.call(this,t);var i=180,r=70,a=108;return e.beginPath(),e.moveTo(-i,-r),e.bezierCurveTo(-a,-14,a,-14,i,-r),e.bezierCurveTo(a,-14,a,14,i,r),e.bezierCurveTo(a,14,-a,14,-i,r),e.bezierCurveTo(-a,14,-a,-14,-i,-r),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.5)",e.fillStyle="rgba(120,120,120,0.5)",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(i,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FibrousProliferation.prototype.description=function(){return"Fibrous proliferation"},ED.FibrovascularScar=function(t,e){this.className="FibrovascularScar",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.FibrovascularScar.prototype=new ED.Doodle,ED.FibrovascularScar.prototype.constructor=ED.FibrovascularScar,ED.FibrovascularScar.superclass=ED.Doodle.prototype,ED.FibrovascularScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.FibrovascularScar.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrovascularScar.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.FibrovascularScar.prototype.draw=function(t){var e=this.drawing.context;ED.FibrovascularScar.superclass.draw.call(this,t),e.beginPath();var i=2*Math.PI/16,r=.5*Math.PI/16,a=new ED.Point(0,0),o=new ED.Point(0,0);o.setWithPolars(80,0),e.moveTo(o.x,o.y);for(var n=80,s=0;s<16;s++){var l=80*(4+ED.randomArray[s])/4,h=new ED.Point(0,0);h.setWithPolars(n,s*i+r);var d=new ED.Point(0,0);d.setWithPolars(l,(s+1)*i-r);var c=new ED.Point(0,0);c.setWithPolars(l,(s+1)*i),n=l,15==s?e.bezierCurveTo(h.x,h.y,d.x,d.y,o.x,o.y):e.bezierCurveTo(h.x,h.y,d.x,d.y,c.x,c.y),1==s&&(a.x=c.x,a.y=c.y)}return e.closePath(),e.lineWidth=0,e.fillStyle="rgba(255,255,190,1)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,64,0,2*Math.PI,!1),e.closePath(),e.fillStyle="rgba(255,255,230,1)",e.fill()),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FibrovascularScar.prototype.description=function(){return"Fibrovascular scar"},ED.FieldCircle=function(t,e){this.className="FieldCircle",this.colour=new ED.Colour(255,0,0,1),this.savedParameterArray=["originX","originY","colour"],ED.Doodle.call(this,t,e)},ED.FieldCircle.prototype=new ED.Doodle,ED.FieldCircle.prototype.constructor=ED.FieldCircle,ED.FieldCircle.superclass=ED.Doodle.prototype,ED.FieldCircle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.colour={kind:"derived",type:"colour"}},ED.FieldCircle.prototype.setParameterDefaults=function(){},ED.FieldCircle.prototype.draw=function(t){var e=this.drawing.context;return ED.FieldCircle.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,50,0,2*Math.PI,!0),e.closePath(),e.lineWidth=1,e.fillStyle=this.colour.rgba(),e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.FocalChoroiditis=function(t,e){this.className="FocalChoroiditis",this.pigmented=!1,this.numberOfHandles=4,this.initialRadius=80,this.savedParameterArray=["pigmented","originX","originY","apexX","apexY","rotation"],this.controlParameterArray={pigmented:"Pigmented"},ED.Doodle.call(this,t,e)},ED.FocalChoroiditis.prototype=new ED.Doodle,ED.FocalChoroiditis.prototype.constructor=ED.FocalChoroiditis,ED.FocalChoroiditis.superclass=ED.Doodle.prototype,ED.FocalChoroiditis.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.FocalChoroiditis.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,290),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0,this.parameterValidationArray.pigmented={kind:"derived",type:"bool",display:!0}},ED.FocalChoroiditis.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;e<this.numberOfHandles;e++){var i=new ED.Point(0,0);i.setWithPolars(this.initialRadius,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(i)}},ED.FocalChoroiditis.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.FocalChoroiditis.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=8,this.pigmented?(o.fillStyle="rgba(255, 255, 200, 0.8)",o.strokeStyle="brown"):(o.fillStyle="rgba(255, 255, 0, 0.8)",o.strokeStyle=o.fillStyle),this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw;for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FocalChoroiditis.prototype.description=function(){return"FocalChoroiditis"},ED.FocalLaser=function(t,e){this.className="FocalLaser",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.FocalLaser.prototype=new ED.Doodle,ED.FocalLaser.prototype.constructor=ED.FocalLaser,ED.FocalLaser.superclass=ED.Doodle.prototype,ED.FocalLaser.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.FocalLaser.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-75,-50)},ED.FocalLaser.prototype.setParameterDefaults=function(){this.apexY=-50,this.setOriginWithDisplacements(150,80)},ED.FocalLaser.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var i=-this.apexY;if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.apexY<=-75){var r=50/Math.sqrt(2);this.drawLaserSpot(e,0,-50),this.drawLaserSpot(e,r,-r),this.drawLaserSpot(e,50,0),this.drawLaserSpot(e,r,r),this.drawLaserSpot(e,0,50),this.drawLaserSpot(e,-r,r),this.drawLaserSpot(e,-50,0),this.drawLaserSpot(e,-r,-r)}this.drawLaserSpot(e,0,-25),this.drawLaserSpot(e,25,0),this.drawLaserSpot(e,0,25),this.drawLaserSpot(e,-25,0),this.drawLaserSpot(e,0,0)}var a=new ED.Point(0,0);return a.setWithPolars(i,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.FocalLaser.prototype.groupDescription=function(){return"Focal laser"},ED.Fovea=function(t,e){this.className="Fovea",this.type="Normal fovea",this.subfoveal="Type1",this.savedParameterArray=["originX","originY","scaleX","scaleY","type"],this.controlParameterArray={type:"Type",subfoveal:"Subfoveal"},ED.Doodle.call(this,t,e)},ED.Fovea.prototype=new ED.Doodle,ED.Fovea.prototype.constructor=ED.Fovea,ED.Fovea.superclass=ED.Doodle.prototype,ED.Fovea.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Fovea.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2),this.parameterValidationArray.type={kind:"other",type:"string",list:["Normal fovea","CNV","Disciform scar"],animate:!1},this.parameterValidationArray.subfoveal={kind:"other",type:"string",list:["Type1","Type2","Type3"],animate:!1}},ED.Fovea.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.setParameterFromString("type","Normal fovea"),this.setParameterFromString("subfoveal","Type1")},ED.Fovea.prototype.draw=function(t){var e=this.drawing.context;return ED.Fovea.superclass.draw.call(this,t),"Normal fovea"===this.type?this.drawNormalFovea(e,t):"CNV"===this.type?this.drawCNV(e,t,!1):"Disciform scar"===this.type&&this.drawCNV(e,t,!0),this.isClicked},ED.Fovea.prototype.drawNormalFovea=function(t,e){t.beginPath(),t.arc(0,0,28*.8,0,2*Math.PI,!1),t.lineWidth=3,t.strokeStyle="rgb(89,115,175)",t.stroke(),t.closePath(),t.fillStyle="rgb(105,165,234)",t.fill(),this.drawBoundary(e)},ED.Fovea.prototype.drawCNV=function(t,e,i){t.beginPath();var r=2*Math.PI/16,a=.5*Math.PI/16,o=new ED.Point(0,0),n=new ED.Point(0,0);n.setWithPolars(80,0),t.moveTo(n.x,n.y);for(var s=80,l=0;l<16;l++){var h=80*(4+ED.randomArray[l])/4,d=new ED.Point(0,0);d.setWithPolars(s,l*r+a);var c=new ED.Point(0,0);c.setWithPolars(h,(l+1)*r-a);var p=new ED.Point(0,0);p.setWithPolars(h,(l+1)*r),s=h,15===l?t.bezierCurveTo(d.x,d.y,c.x,c.y,n.x,n.y):t.bezierCurveTo(d.x,d.y,c.x,c.y,p.x,p.y),1===l&&(o.x=p.x,o.y=p.y)}t.closePath(),t.lineWidth=0,t.fillStyle="red",t.strokeStyle="red",this.drawBoundary(e),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(t.beginPath(),t.arc(0,0,64,0,2*Math.PI,!1),t.closePath(),t.fillStyle=i?"rgb(155,155,155)":"rgba(255,255,190,1)",t.fill()),this.handleArray[2].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(e)},ED.Fovea.prototype.description=function(){return"CNV"===this.type?"Choroidal neovascular membrane ("+this.subfoveal+")":"Disciform scar"===this.type?"Disciform scar":"Normal fovea"},ED.Fovea.prototype.snomedCode=function(){return"Normal fovea"===this.type?67046006:"CNV"===this.type?75971007:414173003},ED.Fuchs=function(t,e){this.className="Fuchs",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Fuchs.prototype=new ED.Doodle,ED.Fuchs.prototype.constructor=ED.Fuchs,ED.Fuchs.superclass=ED.Doodle.prototype,ED.Fuchs.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Fuchs.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.isUnique=!0},ED.Fuchs.prototype.draw=function(t){var e=this.drawing.context;ED.Fuchs.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,300,0,2*Math.PI,!1),e.closePath();var i=e.createPattern(this.drawing.imageArray.FuchsPattern,"repeat");e.fillStyle=i,e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(300,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Fuchs.prototype.description=function(){return"Guttata"},ED.Fuchs.prototype.snomedCode=function(){return 373424008},ED.Fuchs.prototype.diagnosticHierarchy=function(){return 0},ED.Fundus=function(t,e){this.className="Fundus",ED.Doodle.call(this,t,e)},ED.Fundus.prototype=new ED.Doodle,ED.Fundus.prototype.constructor=ED.Fundus,ED.Fundus.superclass=ED.Doodle.prototype,ED.Fundus.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isFilled=!1,this.showsToolTip=!1},ED.Fundus.prototype.draw=function(t){var e=this.drawing.context;if(ED.Fundus.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,480,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2,e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawing.eye!=ED.eye.Right)var i=200,r=100,a=-50,o=-100,n=100;else i=-200,r=-100,a=50,o=100,n=-100;e.moveTo(i,-50),e.bezierCurveTo(r,-166,0,-62,0,-12),e.bezierCurveTo(0,-40,a,-100,o,-50),e.moveTo(i,50),e.bezierCurveTo(r,166,0,62,0,12),e.bezierCurveTo(0,40,a,100,o,50);e.moveTo(n,-10),e.lineTo(n,10),e.moveTo(n-10,0),e.lineTo(n+10,0),e.moveTo(25,0),e.arc(0,0,25,0,2*Math.PI,!0),e.moveTo(12,0),e.arc(0,0,12,0,2*Math.PI,!0),e.stroke()}return this.isClicked},ED.Fundus.prototype.description=function(){return 1===this.drawing.doodleArray.length?"No abnormality":""},ED.Geographic=function(t,e){this.className="Geographic",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Geographic.prototype=new ED.Doodle,ED.Geographic.prototype.constructor=ED.Geographic,ED.Geographic.superclass=ED.Doodle.prototype,ED.Geographic.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Geographic.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Geographic.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.Geographic.prototype.draw=function(t){var e=this.drawing.context;ED.Geographic.superclass.draw.call(this,t);var i=-this.apexY,r=-this.apexY*Math.PI/800;e.beginPath();var a=new ED.Point(0,0);return this.drawing.eye==ED.eye.Right?(e.arc(0,0,200,r,2*Math.PI-r,!1),a.setWithPolars(i,Math.PI/2-r),e.lineTo(a.x,a.y),e.arc(0,0,i,2*Math.PI-r,r,!0)):(e.arc(0,0,200,Math.PI-r,-Math.PI+r,!0),a.setWithPolars(i,r-Math.PI/2),e.lineTo(a.x,a.y),e.arc(0,0,i,-Math.PI+r,Math.PI-r,!1)),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,50,0.8)",e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,(a=new ED.Point(0,0)).setWithPolars(200,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Geographic.prototype.description=function(){return"Geographic atrophy"},ED.Geographic.prototype.snomedCode=function(){return 414875008},ED.Geographic.prototype.diagnosticHierarchy=function(){return 0},ED.Gonioscopy=function(t,e){this.className="Gonioscopy",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.mode="Basic",this.controlParameterArray={pigmentation:"Meshwork Pigmentation"},this.PigmentationVeryLight="Very light",this.PigmentationLight="Light",this.PigmentationModerate="Moderate",this.PigmentationHeavy="Heavy",this.PigmentationVeryHeavy="Very heavy",this.savedParameterArray=["apexX","apexY","mode"],ED.Doodle.call(this,t,e),this.apexY<-460?this.pigmentation=this.PigmentationVeryLight:this.apexY<-440?this.pigmentation=this.PigmentationLight:this.apexY<-420?this.pigmentation=this.PigmentationModerate:this.apexY<-390?this.pigmentation=this.PigmentationHeavy:this.pigmentation=this.PigmentationVeryHeavy},ED.Gonioscopy.prototype=new ED.Doodle,ED.Gonioscopy.prototype.constructor=ED.Gonioscopy,ED.Gonioscopy.superclass=ED.Doodle.prototype,ED.Gonioscopy.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-500,-380),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1},this.parameterValidationArray.pigmentation={kind:"other",type:"string",list:[this.PigmentationVeryLight,this.PigmentationLight,this.PigmentationModerate,this.PigmentationHeavy,this.PigmentationVeryHeavy],animate:!1}},ED.Gonioscopy.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-430,this.setParameterFromString("mode","Basic"),this.setParameterFromString("pigmentation",this.PigmentationModerate)},ED.Gonioscopy.prototype.dependentParameterValues=function(t,e){var i=[];switch(t){case"pigmentation":switch(i.pigmentation=e,i.apexX=-460,e){case this.PigmentationVeryLight:i.apexY=-500;break;case this.PigmentationLight:i.apexY=-460;break;case this.PigmentationModerate:i.apexY=-430;break;case this.PigmentationHeavy:i.apexY=-420;break;case this.PigmentationVeryHeavy:i.apexY=-390}}return i},ED.Gonioscopy.prototype.draw=function(t){var e=this.drawing.context;ED.Gonioscopy.superclass.draw.call(this,t);var i=2*Math.PI;if(e.beginPath(),e.arc(0,0,this.rsl,0,i,!0),e.lineWidth=15,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(200, 200, 200, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),e.arc(0,0,this.rtmo,0,i,!0),e.moveTo(this.rtmi,0),e.arc(0,0,this.rtmi,i,0,!1),e.lineWidth=1,this.pigmentation){case this.PigmentationVeryLight:e.fillStyle="rgba(200, 200, 200, 1)";break;case this.PigmentationLight:e.fillStyle="rgba(250, 200, 0, 1)";break;case this.PigmentationModerate:e.fillStyle="rgba(200, 150, 0, 1)";break;case this.PigmentationHeavy:e.fillStyle="rgba(150, 100, 0, 1)";break;case this.PigmentationVeryHeavy:e.fillStyle="rgba(100, 50, 0, 1)"}e.strokeStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke(),e.beginPath(),e.arc(0,0,this.rcbo,0,i,!0),e.arc(0,0,this.rcbi,i,0,!1),e.fillStyle="rgba(200, 200, 200, 1)",e.fill();var r=new ED.Point(0,0),a=new ED.Point(0,0),o=0;for(o=0;o<12;o++){var n=(15+30*o)*Math.PI/180;r.setWithPolars(this.rcbi,n),e.beginPath(),e.moveTo(r.x,r.y),1==o||4==o||7==o||10==o?(a.setWithPolars(this.rsl+80,n),e.lineWidth=6,e.strokeStyle="rgba(20, 20, 20, 1)"):(a.setWithPolars(this.rsl,n),e.lineWidth=2,e.strokeStyle="rgba(137, 137, 137, 1)"),e.lineTo(a.x,a.y),e.closePath(),e.stroke()}e.beginPath(),e.arc(0,0,this.riro,0,i,!0),e.arc(0,0,this.riri,i,0,!1),e.lineWidth=2,e.strokeStyle="rgba(180, 180, 180, 1)",e.fillStyle="rgba(200, 200, 200, 1)",e.fill(),e.stroke()}return this.isClicked},ED.Gonioscopy.prototype.description=function(){return"TM pigmentation: "+this.pigmentation},ED.GRT=function(t,e){this.className="GRT",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.GRT.prototype=new ED.Doodle,ED.GRT.prototype.constructor=ED.GRT,ED.GRT.superclass=ED.Doodle.prototype,ED.GRT.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.GRT.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/2,2*Math.PI)},ED.GRT.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-350,this.setRotationWithDisplacements(0,120)},ED.GRT.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var i=-this.apexY,r=i+(476-i)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=this.arc/2.3,l=-Math.PI/2+s,h=-Math.PI/2-s,d=476*Math.sin(a),c=-476*Math.cos(a),p=-476*Math.sin(a),y=c,D=r*Math.sin(s),u=-r*Math.cos(s),g=-D,P=u,E=-(i*Math.sin(a)),m=-i*Math.cos(a);return e.beginPath(),e.arc(0,0,476,o,n,!0),e.lineTo(g,P),e.lineTo(E,m),e.arc(0,0,i,n,o,!1),e.lineTo(D,u),e.closePath(),e.lineWidth=8,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,r,l,h,!0),e.strokeStyle="darkred",e.stroke()),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(p,y)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.GRT.prototype.description=function(){var t="Giant Retinal Tear ",e=this.rotation-this.arc/2,i=Math.floor((6*(e+.2618)/Math.PI+12)%12);0==i&&(i=12);var r=180*this.arc/Math.PI;return t=t+(r=10*Math.floor((r+5)/10))+" degrees clockwise from "+i+" o'clock"},ED.GRT.prototype.snomedCode=function(){return 232004004},ED.GRT.prototype.diagnosticHierarchy=function(){return 0},ED.HardDrusen=function(t,e){this.className="HardDrusen",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.HardDrusen.prototype=new ED.Doodle,ED.HardDrusen.prototype.constructor=ED.HardDrusen,ED.HardDrusen.superclass=ED.Doodle.prototype,ED.HardDrusen.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.HardDrusen.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.HardDrusen.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.HardDrusen.prototype.draw=function(t){var e=this.drawing.context;ED.HardDrusen.superclass.draw.call(this,t),e.beginPath();var i=200;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r=10/this.scaleX,a=new ED.Point(0,0),o=20+Math.abs(Math.floor(this.apexY/2)),n=0;n<o;n++)a.setWithPolars(i*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,a.x,a.y,r,"yellow");return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(140,-140)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.HardDrusen.prototype.description=function(){var t="Signficant numbers of ";return this.apexY>-100&&(t="Moderate numbers of "),this.apexY>-50&&(t="Several "),t+"hard drusen"},ED.HardExudate=function(t,e){this.className="HardExudate",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.HardExudate.prototype=new ED.Doodle,ED.HardExudate.prototype.constructor=ED.HardExudate,ED.HardExudate.superclass=ED.Doodle.prototype,ED.HardExudate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.HardExudate.prototype.draw=function(t){var e=this.drawing.context;ED.HardExudate.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,14,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(220,220,0,1)",e.fillStyle="rgba(220,220,0,1)",this.drawBoundary(t),this.isClicked},ED.HardExudate.prototype.groupDescription=function(){return"Hard exudates"},ED.HVT=function(t,e){this.className="HVT",this.hor="None",this.ver="None",this.tor="None",this.horValue=0,this.verValue=0,this.torValue=0,ED.Doodle.call(this,t,e)},ED.HVT.prototype=new ED.Doodle,ED.HVT.prototype.constructor=ED.HVT,ED.HVT.superclass=ED.Doodle.prototype,ED.HVT.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.HVT.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.parameterValidationArray.originX.range=new ED.Range(-350,-150),this.parameterValidationArray.originY.range=new ED.Range(-100,100),this.parameterValidationArray.rotation.range=new ED.Range(0,Math.PI/2),this.parameterValidationArray.hor={kind:"derived",type:"string",list:["XT","None","ET"],animate:!0},this.parameterValidationArray.ver={kind:"derived",type:"string",list:["R/L","None","L/R"],animate:!0},this.parameterValidationArray.tor={kind:"derived",type:"string",list:["Excyclotorsion","None","Incyclotorsion"],animate:!0},this.parameterValidationArray.horValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.verValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.torValue={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0}},ED.HVT.prototype.setParameterDefaults=function(){},ED.HVT.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"originX":var r=20;i.hor=e<-250-r?"XT":e>-250+r?"ET":"None",i.horValue=Math.abs(Math.round((-250-e)/2));break;case"originY":r=20;i.ver=e<0-r?"R/L":e>0+r?"L/R":"None",i.verValue=Math.abs(Math.round(-e/2));break;case"rotation":r=Math.PI/16;e<Math.PI/4-r?i.tor="Excyclotorsion":e>Math.PI/4+r?i.tor="Incyclotorsion":i.tor="None",i.torValue=Math.abs(Math.round(80*(e-Math.PI/4)/Math.PI));break;case"hor":switch(e){case"XT":i.originX=-350;break;case"ET":i.originX=-150;break;default:i.originX=-250}break;case"ver":switch(e){case"R/L":i.originY=-100;break;case"L/R":i.originY=100;break;default:i.originY=0}break;case"tor":switch(e){case"Excyclotorsion":i.rotation=0;break;case"Incyclotorsion":i.rotation=Math.PI/2;break;default:i.rotation=Math.PI/4}break;case"horValue":switch(this.hor){case"XT":i.originX=-250-2*e;break;case"None":i.originX=-250;break;case"ET":i.originX=2*e-250}break;case"verValue":switch(this.ver){case"R/L":i.originY=2*-e;break;case"None":i.originY=Math.PI/4;break;case"L/R":i.originY=2*e}break;case"torValue":switch(this.tor){case"Excyclotorsion":i.rotation=-e*Math.PI/80+Math.PI/4;break;case"None":i.rotation=Math.PI/4;break;case"Incyclotorsion":i.rotation=e*Math.PI/80+Math.PI/4}}return i},ED.HVT.prototype.draw=function(t){var e=this.drawing.context;ED.HVT.superclass.draw.call(this,t);var i=1.75*Math.PI,r=new ED.Point(0,0);if(e.beginPath(),e.arc(0,0,125,0,2*Math.PI,!0),e.moveTo(40,0),e.arc(0,0,40,2*Math.PI,0,!1),e.lineWidth=4,e.fillStyle=e.fillStyle="rgba(100, 200, 250, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),r.setWithPolars(120,i),e.moveTo(r.x,r.y),r.setWithPolars(45,i),e.lineTo(r.x,r.y),r.setWithPolars(-120,i),e.moveTo(r.x,r.y),r.setWithPolars(-45,i),e.lineTo(r.x,r.y),e.lineWidth=20,this.originX>0?e.strokeStyle="rgba(255, 0, 0, 0.8)":e.strokeStyle="rgba(0, 155, 0, 0.8)",e.stroke()}return r.setWithPolars(125,i),this.handleArray[1].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.HVTGrid=function(t,e){this.className="HVTGrid",ED.Doodle.call(this,t,e)},ED.HVTGrid.prototype=new ED.Doodle,ED.HVTGrid.prototype.constructor=ED.HVTGrid,ED.HVTGrid.superclass=ED.Doodle.prototype,ED.HVTGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.HVTGrid.prototype.draw=function(t){var e=this.drawing.context;ED.HVTGrid.superclass.draw.call(this,t),e.beginPath();var i=250;return e.moveTo(-500,0),e.lineTo(500,0),e.moveTo(-i,-i),e.lineTo(-i,+i),e.moveTo(+i,-i),e.lineTo(+i,+i),e.lineWidth=4,e.strokeStyle="gray",this.drawBoundary(t),this.isClicked},ED.Hyphaema=function(t,e){this.className="Hyphaema",this.ro=380,this.minimum=304,this.csOriginY=0,this.csOriginX=50,this.csApexX=0,this.savedParameterArray=["apexX","apexY","csOriginY","csApexX","csOriginX"],ED.Doodle.call(this,t,e)},ED.Hyphaema.prototype=new ED.Doodle,ED.Hyphaema.prototype.constructor=ED.Hyphaema,ED.Hyphaema.superclass=ED.Doodle.prototype,ED.Hyphaema.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hyphaema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hyphaema.prototype.setParameterDefaults=function(){this.apexY=152},ED.Hyphaema.prototype.draw=function(t){var e=this.drawing.context;ED.Hyphaema.superclass.draw.call(this,t);var i=Math.asin(this.apexY/this.ro);e.beginPath(),e.arc(0,0,this.ro,i,Math.PI-i,!1),e.closePath();var r=(.1+(this.apexX+50)/111).toFixed(2);return e.fillStyle="rgba(255,0,0,"+r+")",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hyphaema.prototype.description=function(){return 10*Math.round(10*(this.ro-this.apexY)/(2*this.ro))+"% hyphaema"},ED.Hyphaema.prototype.snomedCode=function(){"use strict";return 75229002},ED.HyphaemaCrossSection=function(t,e){this.className="HyphaemaCrossSection",this.initialRadius=360,this.ro=380,this.savedParameterArray=["originY","apexX","apexY","originX"],this.controlParameterArray={},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={Hyphaema:{source:["apexY"],store:[["originY","csOriginY"],["apexX","csApexX"],["originX","csOriginX"]]}}},ED.HyphaemaCrossSection.prototype=new ED.Doodle,ED.HyphaemaCrossSection.prototype.constructor=ED.HyphaemaCrossSection,ED.HyphaemaCrossSection.superclass=ED.Doodle.prototype,ED.HyphaemaCrossSection.prototype.setHandles=function(){},ED.HyphaemaCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,304)},ED.HyphaemaCrossSection.prototype.dependentParameterValues=function(t,e){return new Array},ED.HyphaemaCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.apexY=152},ED.HyphaemaCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=i.pachymetry/5;ED.HyphaemaCrossSection.superclass.draw.call(this,t),e.beginPath();var a=(this.apexY-this.apexY/12+380)/760;a<0&&(a=0);if(a<.5){var o=new Object,n=2*a;if(i&&"Keratoconus"==i.shape?(o.SP=new ED.Point(0,-380-this.originY),o.CP1=new ED.Point(-80,-260-this.originY),o.CP2=new ED.Point(i.apexX+r,i.apexY-120-this.originY),o.EP=new ED.Point(i.apexX+r,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(o.SP=new ED.Point(0,-380-this.originY),o.CP1=new ED.Point(-120,-200-this.originY),o.CP2=new ED.Point(-280,-140-this.originY),o.EP=new ED.Point(-280,100-this.originY)):(o.SP=new ED.Point(0,-380-this.originY),o.CP1=new ED.Point(-80,-260-this.originY),o.CP2=new ED.Point(-220,-160-this.originY),o.EP=new ED.Point(-220,0-this.originY)),n>0){var s;(p=new ED.Point(0,0)).y=(1-n)*(1-n)*(1-n)*o.SP.y+3*(1-n)*(1-n)*n*o.CP1.y+3*(1-n)*n*n*o.CP2.y+n*n*n*o.EP.y,p.x=(1-n)*(1-n)*(1-n)*o.SP.x+3*(1-n)*(1-n)*n*o.CP1.x+3*(1-n)*n*n*o.CP2.x+n*n*n*o.EP.x,(s=new ED.Point(0,0)).x=o.CP1.x+n*(o.CP2.x-o.CP1.x),s.y=o.CP1.y+n*(o.CP2.y-o.CP1.y);var l=new ED.Point(0,0);l.x=o.CP2.x+n*(o.EP.x-o.CP2.x),l.y=o.CP2.y+n*(o.EP.y-o.CP2.y);var h=new ED.Point(0,0);h.x=s.x+n*(l.x-s.x),h.y=s.y+n*(l.y-s.y),o.SP=p,o.CP1=h,o.CP2=l}}var d=new Object,c=a>.5?2*(a-.5):0;if(i&&"Keratoconus"==i.shape?(d.SP=new ED.Point(i.apexX+r,i.apexY-this.originY),d.CP1=new ED.Point(i.apexX+r,i.apexY+120-this.originY),d.CP2=new ED.Point(-80,260-this.originY),d.EP=new ED.Point(0,380-this.originY)):i&&"Keratoglobus"==i.shape?(d.SP=new ED.Point(-280,100-this.originY),d.CP1=new ED.Point(-260,220-this.originY),d.CP2=new ED.Point(-80,260-this.originY),d.EP=new ED.Point(0,380-this.originY)):(d.SP=new ED.Point(-220,-0-this.originY),d.CP1=new ED.Point(-220,160-this.originY),d.CP2=new ED.Point(-80,260-this.originY),d.EP=new ED.Point(0,380-this.originY)),c>0){var p,y;(p=new ED.Point(0,0)).y=(1-c)*(1-c)*(1-c)*d.SP.y+3*(1-c)*(1-c)*c*d.CP1.y+3*(1-c)*c*c*d.CP2.y+c*c*c*d.EP.y,p.x=(1-c)*(1-c)*(1-c)*d.SP.x+3*(1-c)*(1-c)*c*d.CP1.x+3*(1-c)*c*c*d.CP2.x+c*c*c*d.EP.x,(y=new ED.Point(0,0)).x=d.CP1.x+c*(d.CP2.x-d.CP1.x),y.y=d.CP1.y+c*(d.CP2.y-d.CP1.y);var D=new ED.Point(0,0);D.x=d.CP2.x+c*(d.EP.x-d.CP2.x),D.y=d.CP2.y+c*(d.EP.y-d.CP2.y);var u=new ED.Point(0,0);u.x=y.x+c*(D.x-y.x),u.y=y.y+c*(D.y-y.y),d.SP=p,d.CP1=u,d.CP2=D}var g=this.drawing.lastDoodleOfClass("LensCrossSection"),P=this.drawing.lastDoodleOfClass("AntSegCrossSection"),E=P?P.apexX:-20;if(g){var m=Math.asin(.8),f=300*Math.cos(m);P?g.originX+100+f-300-this.originX<P.apexX&&(E=g.originX+100+f-300-this.originX):E=g.originX+100+f-300-this.originX}if(d&&(e.moveTo(d.EP.x,d.EP.y),e.bezierCurveTo(d.CP2.x,d.CP2.y,d.CP1.x,d.CP1.y,d.SP.x,d.SP.y)),o)if(e.bezierCurveTo(o.CP2.x,o.CP2.y,o.CP1.x,o.CP1.y,o.SP.x,o.SP.y),P){var w=E<o.SP.x?o.SP.x:E;e.lineTo(w,o.SP.y),this.apexY<P.apexY-20&&(e.lineTo(P.apexX,P.apexY-20),e.lineTo(E,P.apexY-20))}else e.lineTo(E,o.SP.y);if(P){var x=E<d.SP.x?d.SP.x:E;e.lineTo(x,d.SP.y),this.apexY<20-P.apexY&&(e.lineTo(E,20-P.apexY),e.lineTo(P.apexX,20-P.apexY)),e.lineTo(40,460)}else e.lineTo(E,d.SP.y),e.lineTo(40,460);e.closePath(),e.lineWidth=5;var b=(.1+(this.apexX+50)/111).toFixed(2);return e.fillStyle="rgba(255,0,0,"+b+")",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hypopyon=function(t,e){this.className="Hypopyon",this.ro=380,this.minimum=304,this.csOriginX=50,this.savedParameterArray=["apexY","csOriginX"],ED.Doodle.call(this,t,e),this.linkedDoodleParameters={Hyphaema:{source:["apexY"],store:[["originY","csOriginY"],["apexX","csApexX"],["originX","csOriginX"]]}}},ED.Hypopyon.prototype=new ED.Doodle,ED.Hypopyon.prototype.constructor=ED.Hypopyon,ED.Hypopyon.superclass=ED.Doodle.prototype,ED.Hypopyon.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hypopyon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hypopyon.prototype.setParameterDefaults=function(){this.apexY=260},ED.Hypopyon.prototype.draw=function(t){var e=this.drawing.context;ED.Hypopyon.superclass.draw.call(this,t);var i=Math.asin(this.apexY/this.ro);return e.beginPath(),e.arc(0,0,this.ro,i,Math.PI-i,!1),e.closePath(),e.fillStyle="rgba(221,209,171,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Hypopyon.prototype.description=function(){return Math.round(10*(this.ro-this.apexY)/(2*this.ro))+"mm hypopyon"},ED.Hypopyon.prototype.snomedCode=function(){"use strict";return 87807004},ED.HypopyonCrossSection=function(t,e){this.className="HypopyonCrossSection",this.initialRadius=360,this.ro=380,this.minimum=304,this.savedParameterArray=["apexY","originX"],this.controlParameterArray={},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={Hypopyon:{source:["apexY"],store:[["originX","csOriginX"]]}}},ED.HypopyonCrossSection.prototype=new ED.Doodle,ED.HypopyonCrossSection.prototype.constructor=ED.HypopyonCrossSection,ED.HypopyonCrossSection.superclass=ED.Doodle.prototype,ED.HypopyonCrossSection.prototype.setHandles=function(){},ED.HypopyonCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.HypopyonCrossSection.prototype.dependentParameterValues=function(t,e){},ED.HypopyonCrossSection.prototype.setParameterDefaults=function(){this.originX=50,this.apexY=260},ED.HypopyonCrossSection.prototype.draw=function(t){var e=this.drawing.context,i=(P=this.drawing.lastDoodleOfClass("CorneaCrossSection")).pachymetry/5;ED.HypopyonCrossSection.superclass.draw.call(this,t),e.beginPath();var r=(this.apexY-this.apexY/12+380)/760;r<0&&(r=0);if(r<.5){var a=new Object,o=2*r;if(P&&"Keratoconus"==P.shape?(a.SP=new ED.Point(0,-380-this.originY),a.CP1=new ED.Point(-80,-260-this.originY),a.CP2=new ED.Point(P.apexX+i,P.apexY-120-this.originY),a.EP=new ED.Point(P.apexX+i,P.apexY-this.originY)):P&&"Keratoglobus"==P.shape?(a.SP=new ED.Point(0,-380-this.originY),a.CP1=new ED.Point(-120,-200-this.originY),a.CP2=new ED.Point(-280,-140-this.originY),a.EP=new ED.Point(-280,100-this.originY)):(a.SP=new ED.Point(0,-380-this.originY),a.CP1=new ED.Point(-80,-260-this.originY),a.CP2=new ED.Point(-220,-160-this.originY),a.EP=new ED.Point(-220,0-this.originY)),o>0){var n;(c=new ED.Point(0,0)).y=(1-o)*(1-o)*(1-o)*a.SP.y+3*(1-o)*(1-o)*o*a.CP1.y+3*(1-o)*o*o*a.CP2.y+o*o*o*a.EP.y,c.x=(1-o)*(1-o)*(1-o)*a.SP.x+3*(1-o)*(1-o)*o*a.CP1.x+3*(1-o)*o*o*a.CP2.x+o*o*o*a.EP.x,(n=new ED.Point(0,0)).x=a.CP1.x+o*(a.CP2.x-a.CP1.x),n.y=a.CP1.y+o*(a.CP2.y-a.CP1.y);var s=new ED.Point(0,0);s.x=a.CP2.x+o*(a.EP.x-a.CP2.x),s.y=a.CP2.y+o*(a.EP.y-a.CP2.y);var l=new ED.Point(0,0);l.x=n.x+o*(s.x-n.x),l.y=n.y+o*(s.y-n.y),a.SP=c,a.CP1=l,a.CP2=s}}var h=new Object,d=r>.5?2*(r-.5):0;if(P&&"Keratoconus"==P.shape?(h.SP=new ED.Point(P.apexX+i,P.apexY-this.originY),h.CP1=new ED.Point(P.apexX+i,P.apexY+120-this.originY),h.CP2=new ED.Point(-80,260-this.originY),h.EP=new ED.Point(0,380-this.originY)):P&&"Keratoglobus"==P.shape?(h.SP=new ED.Point(-280,100-this.originY),h.CP1=new ED.Point(-260,220-this.originY),h.CP2=new ED.Point(-80,260-this.originY),h.EP=new ED.Point(0,380-this.originY)):(h.SP=new ED.Point(-220,-0-this.originY),h.CP1=new ED.Point(-220,160-this.originY),h.CP2=new ED.Point(-80,260-this.originY),h.EP=new ED.Point(0,380-this.originY)),d>0){var c,p;(c=new ED.Point(0,0)).y=(1-d)*(1-d)*(1-d)*h.SP.y+3*(1-d)*(1-d)*d*h.CP1.y+3*(1-d)*d*d*h.CP2.y+d*d*d*h.EP.y,c.x=(1-d)*(1-d)*(1-d)*h.SP.x+3*(1-d)*(1-d)*d*h.CP1.x+3*(1-d)*d*d*h.CP2.x+d*d*d*h.EP.x,(p=new ED.Point(0,0)).x=h.CP1.x+d*(h.CP2.x-h.CP1.x),p.y=h.CP1.y+d*(h.CP2.y-h.CP1.y);var y=new ED.Point(0,0);y.x=h.CP2.x+d*(h.EP.x-h.CP2.x),y.y=h.CP2.y+d*(h.EP.y-h.CP2.y);var D=new ED.Point(0,0);D.x=p.x+d*(y.x-p.x),D.y=p.y+d*(y.y-p.y),h.SP=c,h.CP1=D,h.CP2=y}var u=this.drawing.lastDoodleOfClass("LensCrossSection"),g=this.drawing.lastDoodleOfClass("AntSegCrossSection"),P=this.drawing.lastDoodleOfClass("CorneaCrossSection"),E=g?g.apexX:-20;if(P&&this.setSimpleParameter("originX",P.originX),u){var m=Math.asin(.8),f=300*Math.cos(m);u.originX+100+f-300-this.originX<g.apexX&&(E=u.originX+100+f-300-this.originX)}if(h&&(e.moveTo(h.EP.x,h.EP.y),e.bezierCurveTo(h.CP2.x,h.CP2.y,h.CP1.x,h.CP1.y,h.SP.x,h.SP.y)),a)if(e.bezierCurveTo(a.CP2.x,a.CP2.y,a.CP1.x,a.CP1.y,a.SP.x,a.SP.y),g){var w=E<a.SP.x?a.SP.x:E;e.lineTo(w,a.SP.y),this.apexY<g.apexY&&(w>g.apexX&&(w=g.apexX),e.lineTo(w,g.apexY),e.lineTo(g.apexX,g.apexY))}else e.lineTo(E,a.SP.y);if(g){var x=E<h.SP.x?h.SP.x:E;x>g.apexX&&(x=g.apexX),e.lineTo(x,h.SP.y),this.apexY<-g.apexY&&(x<g.apexX&&(x=g.apexX),e.lineTo(x,-g.apexY),e.lineTo(g.apexX,-g.apexY)),e.lineTo(40,460)}else e.lineTo(E,h.SP.y),e.lineTo(40,460);return e.closePath(),e.lineWidth=5,e.fillStyle="rgba(221,209,171,1)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IatrogenicBreak=function(t,e){this.className="IatrogenicBreak",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.IatrogenicBreak.prototype=new ED.Doodle,ED.IatrogenicBreak.prototype.constructor=ED.IatrogenicBreak,ED.IatrogenicBreak.superclass=ED.Doodle.prototype,ED.IatrogenicBreak.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IatrogenicBreak.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.8,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.8,2)},ED.IatrogenicBreak.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(240,-50)},ED.IatrogenicBreak.prototype.draw=function(t){var e=this.drawing.context;ED.IatrogenicBreak.superclass.draw.call(this,t),e.beginPath();var i=40,r=new ED.Point(-i,i),a=new ED.Point(i,-i);return e.moveTo(r.x,r.y),e.bezierCurveTo(r.x,r.y-32,a.x-32,a.y,a.x,a.y),e.bezierCurveTo(a.x,a.y+32,r.x+32,r.y,r.x,r.y),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IatrogenicBreak.prototype.description=function(){return"Iatrogenic break in "+this.quadrant()},ED.ICL=function(t,e){this.className="ICL",this.axis="",this.model="",this.lengthICL="",this.sphere,this.cylinder,this.opticalAxis,this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation","axis","model","lengthICL","sphere","cylinder","opticalAxis"],this.controlParameterArray={model:"Model",lengthICL:"Length (mm)",sphere:"Sphere (D)",cylinder:"Cylinder (D)",opticalAxis:"Axis (deg)"},ED.Doodle.call(this,t,e)},ED.ICL.prototype=new ED.Doodle,ED.ICL.prototype.constructor=ED.ICL,ED.ICL.superclass=ED.Doodle.prototype,ED.ICL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.ICL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.parameterValidationArray.rotation.range=new ED.Range(340*Math.PI/180,20*Math.PI/180),this.parameterValidationArray.axis={kind:"derived",type:"string",list:["160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],animate:!1},this.parameterValidationArray.model={kind:"other",type:"string",list:["V4b","V4c"],animate:!1},this.parameterValidationArray.lengthICL={kind:"other",type:"string",list:["11.7","12.2","12.7","13.2","13.7"],animate:!1},this.parameterValidationArray.sphere={kind:"other",type:"string",list:["-18.0","-17.5","-17.0","-16.5","-16.0","-15.5","-15.0","-14.5","-14.0","-13.5","-13.0","-12.5","-12.0","-11.5","-11.0","-10.5","-10.0","-9.5","-9.0","-8.5","-8.0","-7.5","-7.0","-6.5","-6.0","-5.5","-5.0","-4.5","-4.0","-3.5","-3.0","-2.5","-2.0","-1.5","-1.0","-0.5"," 0.0","+0.5","+1.0","+1.5","+2.0","+2.5","+3.0","+3.5","+4.0","+4.5","+5.0","+5.5","+6.0","+6.5","+7.0","+7.5","+8.0"],animate:!1},this.parameterValidationArray.cylinder={kind:"other",type:"string",list:[" 0.0","+0.5","+1.0","+1.5","+2.0","+2.5","+3.0","+3.5","+4.0","+4.5","+5.0","+5.5","+6.0"],animate:!1},this.parameterValidationArray.opticalAxis={kind:"other",type:"int",range:new ED.Range(0,180),animate:!1}},ED.ICL.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","180"),this.setParameterFromString("model","V4c"),this.setParameterFromString("lengthICL","13.2"),this.setParameterFromString("sphere","0.0"),this.setParameterFromString("cylinder","0.0"),this.setParameterFromString("opticalAxis","0")},ED.ICL.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"rotation":var r=((360-180*e/Math.PI)%180).toFixed(0);"180"==r&&(r="0"),i.axis=r}return i},ED.ICL.prototype.draw=function(t){var e=this.drawing.context;ED.ICL.superclass.draw.call(this,t),e.beginPath();if(e.moveTo(0,-218),e.bezierCurveTo(46,-217,64,-203,105,-201),e.bezierCurveTo(146,-199,190,-190,221,-190),e.bezierCurveTo(230,-190,222,-198,237,-197),e.bezierCurveTo(264,-196,305,-207,321,-176),e.bezierCurveTo(334,-149,314,-143,306,-118),e.bezierCurveTo(300,-60,300,60,306,118),e.bezierCurveTo(314,143,334,149,321,176),e.bezierCurveTo(305,207,264,196,237,197),e.bezierCurveTo(222,198,230,190,221,190),e.bezierCurveTo(190,190,146,199,105,201),e.bezierCurveTo(64,203,46,217,0,218),e.bezierCurveTo(-46,217,-64,203,-105,201),e.bezierCurveTo(-146,199,-190,190,-221,190),e.bezierCurveTo(-230,190,-222,198,-237,197),e.bezierCurveTo(-264,196,-305,207,-321,176),e.bezierCurveTo(-334,149,-314,143,-306,118),e.bezierCurveTo(-300,-60,-300,-60,-306,-118),e.bezierCurveTo(-314,-143,-334,-149,-321,-176),e.bezierCurveTo(-305,-207,-264,-196,-237,-197),e.bezierCurveTo(-222,-198,-230,-190,-221,-190),e.bezierCurveTo(-190,-190,-146,-199,-105,-201),e.bezierCurveTo(-64,-203,-46,-217,0,-218),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-218,-192),e.bezierCurveTo(-228,-177,-279,-113,-279,0),e.bezierCurveTo(-279,113,-228,177,-218,192),e.moveTo(218,-192),e.bezierCurveTo(228,-177,279,-113,279,0),e.bezierCurveTo(279,113,228,177,218,192),e.stroke(),this.drawCircle(e,0,0,170,"rgba(0,0,0,0)",4,e.strokeStyle),this.drawCircle(e,-200,0,8,e.fillStyle,4,e.strokeStyle),this.drawCircle(e,200,0,8,e.fillStyle,4,e.strokeStyle),this.drawCircle(e,-280,-160,8,e.fillStyle,4,e.strokeStyle),this.drawCircle(e,280,160,8,e.fillStyle,4,e.strokeStyle),"V4c"==this.model&&this.drawCircle(e,0,0,8,e.fillStyle,4,e.strokeStyle);var i=Math.PI/2-this.opticalAxis*Math.PI/180,r=i+Math.PI,a=new ED.Point(0,0);e.beginPath(),a.setWithPolars(40,i),e.moveTo(a.x,a.y),a.setWithPolars(140,i),e.lineTo(a.x,a.y),a.setWithPolars(40,r),e.moveTo(a.x,a.y),a.setWithPolars(140,r),e.lineTo(a.x,a.y),e.stroke()}return this.isClicked},ED.ICL.prototype.description=function(){return"Implantable Collamer Lens"},ED.ILMPeel=function(t,e){this.className="ILMPeel",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.ILMPeel.prototype=new ED.Doodle,ED.ILMPeel.prototype.constructor=ED.ILMPeel,ED.ILMPeel.superclass=ED.Doodle.prototype,ED.ILMPeel.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ILMPeel.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.ILMPeel.prototype.setParameterDefaults=function(){this.apexY=-60,this.rotation=Math.PI/4,this.originX=this.drawing.eye==ED.eye.Right?-100:100},ED.ILMPeel.prototype.draw=function(t){var e=this.drawing.context;ED.ILMPeel.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);return e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=2,e.fillStyle="rgba(220, 220, 220, 0.5)",e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ILMPeel.prototype.groupDescription=function(){return"ILM peel"},ED.InjectionSite=function(t,e){this.className="InjectionSite",this.parsPlana=-560,this.distance="3.5",this.savedParameterArray=["apexY","rotation"],ED.Doodle.call(this,t,e)},ED.InjectionSite.prototype=new ED.Doodle,ED.InjectionSite.prototype.constructor=ED.InjectionSite,ED.InjectionSite.superclass=ED.Doodle.prototype,ED.InjectionSite.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.InjectionSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-550,-470),this.parameterValidationArray.distance={kind:"derived",type:"string",list:["4.5","4.0","3.5","3.0","2.5"],animate:!1}},ED.InjectionSite.prototype.setParameterDefaults=function(){this.apexY=-510,this.distance="3.5",this.setRotationWithDisplacements(45,30)},ED.InjectionSite.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.distance=e<-540?"4.5":e<-520?"4.0":e<-500?"3.5":e<-480?"3.0":"2.5";break;case"distance":i.apexY="4.5"==e?-550:"4.0"==e?-530:"3.5"==e?-510:"3.0"==e?-490:-470}return i},ED.InjectionSite.prototype.draw=function(t){var e=this.drawing.context;ED.InjectionSite.superclass.draw.call(this,t),e.beginPath();var i=this.parsPlana-300;if(e.moveTo(-80,i),e.lineTo(80,i),e.lineTo(70,i+30),e.lineTo(50,i+240),e.lineTo(20,i+260),e.lineTo(-20,i+260),e.lineTo(-50,i+240),e.lineTo(-70,i+30),e.closePath(),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 1)",e.fillStyle="rgba(255, 255, 0, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-70,i+30),e.lineTo(70,i+30),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(-60,i+130),e.lineTo(60,i+130),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(0,i+130),e.lineTo(0,i+230),e.lineWidth=32,e.strokeStyle="rgba(120, 120, 120, 0.2)",e.stroke(),e.beginPath(),e.moveTo(50,i+240),e.lineTo(20,i+260),e.lineTo(-20,i+260),e.lineTo(-50,i+240),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 1)",e.strokeStyle="rgba(0, 0, 0, 0.5)",e.fill(),e.stroke(),e.beginPath(),e.moveTo(-10,i+260),e.lineTo(10,i+260),e.lineTo(10,this.apexY),e.lineTo(-10,this.apexY),e.closePath(),e.fillStyle="rgba(120, 120, 120, 1)",e.fill(),e.beginPath(),e.moveTo(-10,this.apexY),e.lineTo(10,this.apexY),e.lineTo(10,-130),e.lineTo(-10,-100),e.closePath(),e.lineWidth=1,e.strokeStyle="rgba(60, 60, 60, 1)",e.stroke();var r=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));e.save(),e.setTransform(1,0,0,1,0,0),e.lineWidth=1,e.fillStyle="gray",e.font="18px sans-serif",e.fillText(this.distance+" mm",r.x+10,r.y-5),e.restore()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.InjectionSite.prototype.groupDescription=function(){return"Injection at "},ED.InjectionSite.prototype.description=function(){return this.clockHour()+" o'clock "+this.distance+" from limbus"},ED.InnerLeafBreak=function(t,e){this.className="InnerLeafBreak",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.InnerLeafBreak.prototype=new ED.Doodle,ED.InnerLeafBreak.prototype.constructor=ED.InnerLeafBreak,ED.InnerLeafBreak.superclass=ED.Doodle.prototype,ED.InnerLeafBreak.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.InnerLeafBreak.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!1,this.rangeOfScale=new ED.Range(.5,4),this.rangeOfArc=new ED.Range(Math.PI/6,2*Math.PI),this.rangeOfApexX=new ED.Range(-0,0),this.rangeOfApexY=new ED.Range(-40,30)},ED.InnerLeafBreak.prototype.setParameterDefaults=function(){this.originX=-326,this.originY=206},ED.InnerLeafBreak.prototype.draw=function(t){var e=this.drawing.context;ED.InnerLeafBreak.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,20,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 80, 80, 0.75)",e.strokeStyle="rgba(0, 255, 255, 0.75)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(14,-14)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var i=this.transform.transformPoint(new ED.Point(0,0)),r=this.transform.transformPoint(new ED.Point(60,0)),a=i.x-this.drawing.canvas.width/2,o=i.y-this.drawing.canvas.height/2,n=this.scaleX*Math.sqrt(a*a+o*o),s=this.scaleX*(r.x-i.x);return this.arc=Math.atan(s/n),this.isClicked},ED.InnerLeafBreak.prototype.description=function(){var t="";return this.scaleX<1&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="inner leaf break ",t+=this.clockHour()+" o'clock"},ED.IOL=function(t,e){this.className="IOL",this.classGroupUnique="Lens",this.type="PC",this.savedParameterArray=["originX","originY","rotation","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.IOL.prototype=new ED.Doodle,ED.IOL.prototype.constructor=ED.IOL,ED.IOL.superclass=ED.Doodle.prototype,ED.IOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IOL.prototype.setPropertyDefaults=function(){this.addAtBack="PC"==this.type,this.isUnique=!0,this.parameterValidationArray.originX.range.setMinAndMax(-125,125),this.parameterValidationArray.originY.range.setMinAndMax(-125,125),this.parameterValidationArray.type={kind:"other",type:"string",list:["PC","AC","Iris Clip"],animate:!1}},ED.IOL.prototype.setParameterDefaults=function(){this.setParameterFromString("type","PC")},ED.IOL.prototype.dependentParameterValues=function(t,e){return new Array},ED.IOL.prototype.draw=function(t){var e=this.drawing.context;switch(ED.IOL.superclass.draw.call(this,t),e.beginPath(),this.type){case"PC":var i=180;e.arc(0,0,i,0,2*Math.PI,!1),e.moveTo(112.5,-142.5),e.bezierCurveTo(120,-150,142.5,-262.5,120,-285),e.bezierCurveTo(67.5,-330,-112.5,-307.5,-165,-277.5),e.bezierCurveTo(-187.5,-262.5,-195,-300,-150,-322.5),e.bezierCurveTo(-82.5,-360,97.5,-352.5,150,-322.5),e.bezierCurveTo(202.5,-292.5,165,-105,165,-75),e.moveTo(-112.5,142.5),e.bezierCurveTo(-120,150,-142.5,262.5,-120,285),e.bezierCurveTo(-67.5,330,112.5,307.5,165,277.5),e.bezierCurveTo(187.5,262.5,195,300,150,322.5),e.bezierCurveTo(82.5,360,-97.5,352.5,-150,322.5),e.bezierCurveTo(-202.5,292.5,-165,105,-165,75);break;case"AC":i=192;e.arc(0,0,i,0,2*Math.PI,!1),e.moveTo(120,-152),e.bezierCurveTo(128,-160,136,-168,128,-184),e.bezierCurveTo(120,-200,80,-224,40,-232),e.bezierCurveTo(0,-240,-176,-264,-184,-272),e.bezierCurveTo(-200,-288,-176,-336,-160,-344),e.bezierCurveTo(-144,-352,-144,-352,-120,-360),e.bezierCurveTo(-96,-368,-104,-344,-96,-336),e.bezierCurveTo(-88,-328,88,-328,96,-336),e.bezierCurveTo(104,-344,96,-368,120,-360),e.bezierCurveTo(144,-352,144,-352,160,-344),e.bezierCurveTo(176,-336,144,-320,120,-312),e.bezierCurveTo(96,-304,-96,-304,-120,-312),e.bezierCurveTo(-144,-320,-152,-296,-136,-288),e.bezierCurveTo(-120,-280,16,-264,56,-256),e.bezierCurveTo(96,-248,152,-224,168,-200),e.bezierCurveTo(184,-176,176,-112,176,-80),e.moveTo(-120,152),e.bezierCurveTo(-128,160,-136,168,-128,184),e.bezierCurveTo(-120,200,-80,224,-40,232),e.bezierCurveTo(0,240,176,264,184,272),e.bezierCurveTo(200,288,176,336,160,344),e.bezierCurveTo(144,352,144,352,120,360),e.bezierCurveTo(96,368,104,344,96,336),e.bezierCurveTo(88,328,-88,328,-96,336),e.bezierCurveTo(-104,344,-96,368,-120,360),e.bezierCurveTo(-144,352,-144,352,-160,344),e.bezierCurveTo(-176,336,-144,320,-120,312),e.bezierCurveTo(-96,304,96,304,120,312),e.bezierCurveTo(144,320,152,296,136,288),e.bezierCurveTo(120,280,-16,264,-56,256),e.bezierCurveTo(-96,248,-152,224,-168,200),e.bezierCurveTo(-184,176,-176,112,-176,80);break;case"Iris Clip":i=240;e.moveTo(-260,0),e.bezierCurveTo(-260,-100,-220,-220,0,-220),e.bezierCurveTo(220,-220,260,-100,260,0),e.bezierCurveTo(260,100,220,220,0,220),e.bezierCurveTo(-220,220,-260,100,-260,0),e.moveTo(-330,-10),e.bezierCurveTo(-335,-10,-335,-15,-335,-25),e.bezierCurveTo(-335,-43,-332,-86,-312,-106),e.bezierCurveTo(-292,-125,-265,-125,-252,-125),e.bezierCurveTo(-239,-125,-196,-125,-191,-116),e.bezierCurveTo(-187,-110,-189,-104,-194,-93),e.bezierCurveTo(-198,-82,-218,-50,-218,0),e.bezierCurveTo(-218,50,-198,82,-194,93),e.bezierCurveTo(-189,104,-187,110,-191,116),e.bezierCurveTo(-196,125,-239,125,-252,125),e.bezierCurveTo(-265,125,-292,125,-312,106),e.bezierCurveTo(-332,86,-335,43,-335,25),e.bezierCurveTo(-335,15,-335,10,-330,10),e.bezierCurveTo(-325,10,-320,20,-320,25),e.bezierCurveTo(-321,22,-320,33,-319,47),e.bezierCurveTo(-319,54,-314,61,-308,66),e.bezierCurveTo(-302,71,-288,77,-273,77),e.bezierCurveTo(-258,77,-250,74,-243,66),e.bezierCurveTo(-237,58,-239,0,-239,0),e.bezierCurveTo(-239,0,-237,-58,-243,-66),e.bezierCurveTo(-250,-74,-258,-77,-273,-77),e.bezierCurveTo(-288,-77,-302,-71,-308,-66),e.bezierCurveTo(-314,-61,-319,-54,-319,-47),e.bezierCurveTo(-320,-33,-321,-22,-320,-25),e.bezierCurveTo(-320,-20,-325,-10,-330,-10),e.moveTo(330,10),e.bezierCurveTo(335,10,335,15,335,25),e.bezierCurveTo(335,43,332,86,312,106),e.bezierCurveTo(292,125,265,125,252,125),e.bezierCurveTo(239,125,196,125,191,116),e.bezierCurveTo(187,110,189,104,194,93),e.bezierCurveTo(198,82,218,50,218,0),e.bezierCurveTo(218,-50,198,-82,194,-93),e.bezierCurveTo(189,-104,187,-110,191,-116),e.bezierCurveTo(196,-125,239,-125,252,-125),e.bezierCurveTo(265,-125,292,-125,312,-106),e.bezierCurveTo(332,-86,335,-43,335,-25),e.bezierCurveTo(335,-15,335,-10,330,-10),e.bezierCurveTo(325,-10,320,-20,320,-25),e.bezierCurveTo(321,-22,314,-61,319,-47),e.bezierCurveTo(319,-54,314,-61,308,-66),e.bezierCurveTo(302,-71,288,-77,273,-77),e.bezierCurveTo(258,-77,250,-74,243,-66),e.bezierCurveTo(237,-58,239,0,239,0),e.bezierCurveTo(239,0,237,58,243,66),e.bezierCurveTo(250,74,258,77,273,77),e.bezierCurveTo(288,77,302,71,308,66),e.bezierCurveTo(314,61,319,54,319,47),e.bezierCurveTo(320,33,321,22,320,25),e.bezierCurveTo(320,20,325,10,330,10)}e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(i,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IOL.prototype.description=function(){var t="";switch(this.type){case"PC":t="Posterior Chamber IOL";break;case"AC":t="Anterior Chamber IOL";break;case"Iris Clip":t="Iris clip IOL"}var e="";return this.originY<-40&&(e.length>0&&(e+=" and"),e+=" superiorly"),this.originY>40&&(e.length>0&&(e+=" and"),e+=" inferiorly"),this.originX<-40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),e.length>0&&(t+=" displaced"+e),t},ED.IOLCrossSection=function(t,e){this.className="IOLCrossSection",ED.Doodle.call(this,t,e)},ED.IOLCrossSection.prototype=new ED.Doodle,ED.IOLCrossSection.prototype.constructor=ED.IOLCrossSection,ED.IOLCrossSection.superclass=ED.Doodle.prototype,ED.IOLCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,200),this.parameterValidationArray.originY.range.setMinAndMax(-140,140)},ED.IOLCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.IOLCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.IOLCrossSection.superclass.draw.call(this,t);var i=420,r=Math.asin(240/i),a=i*Math.cos(r);Math.acos(a/360);return e.beginPath(),e.arc(100-a,0,i,r,-r,!0),e.arc(100+a,0,i,Math.PI+r,Math.PI-r,!0),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(100-a,0,i,r,-r,!0),e.arc(100+a,0,i,Math.PI+r,Math.PI+.6*r,!0),e.moveTo(100,240),e.arc(100+a,0,i,Math.PI-r,Math.PI-.6*r,!1),e.strokeStyle="gray",e.stroke(),e.beginPath(),e.ellipse(100,0,160,20,.5*Math.PI,0,2*Math.PI),e.strokeStyle="rgba(0, 0, 0, 0.7)",e.lineWidth=5,e.stroke(),e.beginPath(),e.ellipse(100,0,227,20,.5*Math.PI,.5*Math.PI,1.2*Math.PI),e.moveTo(120,0),e.ellipse(100,0,227,20,.5*Math.PI,1.5*Math.PI,.2*Math.PI),e.strokeStyle="rgba(0, 0, 0, 0.6)",e.stroke(),e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(80,-207),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(120,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(80,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(120,-207),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(80,207),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(120,207),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(80,207),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(120,207),e.lineWidth=2,e.strokeStyle="gray",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisHook=function(t,e){this.className="IrisHook",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.IrisHook.prototype=new ED.Doodle,ED.IrisHook.prototype.constructor=ED.IrisHook,ED.IrisHook.superclass=ED.Doodle.prototype,ED.IrisHook.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isScaleable=!1},ED.IrisHook.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(45,90)},ED.IrisHook.prototype.draw=function(t){var e=this.drawing.context;ED.IrisHook.superclass.draw.call(this,t),e.beginPath();var i=260,r=this.drawing.lastDoodleOfClass("AntSeg");return r&&(i=-r.apexY),e.rect(-25,-440,50,180+i),e.closePath(),e.fillStyle="rgba(255,255,255,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(10,-430),e.lineTo(10,10-i),e.lineTo(-10,-i),e.lineWidth=12,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke(),e.beginPath(),e.moveTo(-20,-400),e.lineTo(40,-400),e.lineWidth=24,e.strokeStyle="rgba(255,120,0,0.75)",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisHook.prototype.groupDescription=function(){return"Iris hooks used at "},ED.IrisHook.prototype.description=function(){var t="";return t+=this.clockHour()},ED.IrisHook.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.IrisNaevus=function(t,e){this.className="IrisNaevus",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.IrisNaevus.prototype=new ED.Doodle,ED.IrisNaevus.prototype.constructor=ED.IrisNaevus,ED.IrisNaevus.superclass=ED.Doodle.prototype,ED.IrisNaevus.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.IrisNaevus.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0},ED.IrisNaevus.prototype.setParameterDefaults=function(){this.originY=-320,this.scaleX=1.8},ED.IrisNaevus.prototype.draw=function(t){var e=this.drawing.context;ED.IrisNaevus.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,50,0,2*Math.PI,!1),e.closePath(),e.fillStyle="brown",e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(50,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisNaevus.prototype.description=function(){return"Iris naevus"},ED.IrisTrauma=function(t,e){this.className="IrisTrauma",this.savedParameterArray=["apexY","arc","rotation","radius"],ED.Doodle.call(this,t,e)},ED.IrisTrauma.prototype=new ED.Doodle,ED.IrisTrauma.prototype.constructor=ED.IrisTrauma,ED.IrisTrauma.superclass=ED.Doodle.prototype,ED.IrisTrauma.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.IrisTrauma.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,0)},ED.IrisTrauma.prototype.setParameterDefaults=function(){this.radius=330,this.apexY=-330;var t=this.drawing.lastDoodleOfClass("AntSeg");t&&(this.apexY=.5*(-380-t.apexY)+t.apexY);var e=.5*Math.PI,i=3.5/6,r=this.drawing.lastDoodleOfClass("PhakoIncision");r&&(e=r.rotation+Math.PI,i=r.arc),this.rotation=e,this.arc=i},ED.IrisTrauma.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"apexY":var r=this.drawing.lastDoodleOfClass("AntSeg");r&&e>r.apexY-10&&(i.apexY=r.apexY-10)}return i},ED.IrisTrauma.prototype.draw=function(t){var e=this.drawing.context;ED.IrisTrauma.superclass.draw.call(this,t);this.radius;var i=this.drawing.lastDoodleOfClass("AntSeg"),r=-this.apexY,a=i?-i.apexY:200;e.beginPath();var o=this.arc/2;return e.arc(0,0,r,-Math.PI/2+o,-Math.PI/2-o,!0),e.arc(0,0,a,-Math.PI/2-o,-Math.PI/2+o,!1),e.closePath(),e.fillStyle=e.createPattern(this.drawing.imageArray.TraumaPattern,"repeat"),e.lineWidth=4,e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IrisTrauma.prototype.description=function(){return"Iris trauma at "+parseInt(180*this.rotation/Math.PI)+" degrees"},ED.IrisTrauma.prototype.snomedCode=function(){return 231951002},ED.IRMA=function(t,e){this.className="IRMA",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.IRMA.prototype=new ED.Doodle,ED.IRMA.prototype.constructor=ED.IRMA,ED.IRMA.superclass=ED.Doodle.prototype,ED.IRMA.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IRMA.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(1,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(1,1.5)},ED.IRMA.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(100,100)},ED.IRMA.prototype.draw=function(t){var e=this.drawing.context;return ED.IRMA.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,30),e.bezierCurveTo(-30,30,-70,0,-50,-20),e.bezierCurveTo(-30,-40,-20,-10,0,-10),e.bezierCurveTo(20,-10,30,-40,50,-20),e.bezierCurveTo(70,0,30,30,0,30),e.fillStyle="rgba(100, 100, 100, 0)",e.lineWidth=3,e.strokeStyle="red",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(50,-40)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.IRMA.prototype.groupDescription=function(){return"Intraretinal microvascular abnormalities "},ED.IRMA.prototype.description=function(){return this.locationRelativeToFovea()},ED.KeraticPrecipitates=function(t,e){this.className="KeraticPrecipitates",this.savedParameterArray=["apexX","apexY","scaleX","scaleY","originX","originY"],ED.Doodle.call(this,t,e)},ED.KeraticPrecipitates.prototype=new ED.Doodle,ED.KeraticPrecipitates.prototype.constructor=ED.KeraticPrecipitates,ED.KeraticPrecipitates.superclass=ED.Doodle.prototype,ED.KeraticPrecipitates.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.KeraticPrecipitates.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,40),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.KeraticPrecipitates.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.KeraticPrecipitates.prototype.draw=function(t){var e=this.drawing.context;ED.KeraticPrecipitates.superclass.draw.call(this,t),e.beginPath();var i=200;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r=(this.apexX+20)/20*10/this.scaleX,a=new ED.Point(0,0),o=40+Math.abs(Math.floor(this.apexY/2)),n=0;n<o;n++)a.setWithPolars(i*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,a.x,a.y,r,"rgba(110, 110, 110, 0.5)");return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(140,-140)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KeraticPrecipitates.prototype.description=function(){return this.apexX>20?"Mutton fat keratic precipitates":"Keratic precipitates"},ED.KoeppeNodule=function(t,e){this.className="KoeppeNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.KoeppeNodule.prototype=new ED.Doodle,ED.KoeppeNodule.prototype.constructor=ED.KoeppeNodule,ED.KoeppeNodule.superclass=ED.Doodle.prototype,ED.KoeppeNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.KoeppeNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.KoeppeNodule.prototype.draw=function(t){var e=this.drawing.context;ED.KoeppeNodule.superclass.draw.call(this,t);var i=260,r=this.drawing.lastDoodleOfClass("AntSeg");return r&&(i=-r.apexY),e.beginPath(),e.arc(0,-i,20,0,2*Math.PI,!1),e.fillStyle="rgba(150,100,50,1)",e.lineWidth=1,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.isClicked},ED.KoeppeNodule.prototype.groupDescription=function(){return"Koeppe nodules"},ED.KrukenbergSpindle=function(t,e){this.className="KrukenbergSpindle",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.KrukenbergSpindle.prototype=new ED.Doodle,ED.KrukenbergSpindle.prototype.constructor=ED.KrukenbergSpindle,ED.KrukenbergSpindle.superclass=ED.Doodle.prototype,ED.KrukenbergSpindle.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.KrukenbergSpindle.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80)},ED.KrukenbergSpindle.prototype.setParameterDefaults=function(){this.apexY=-150,this.originY=200},ED.KrukenbergSpindle.prototype.draw=function(t){var e=this.drawing.context;return ED.KrukenbergSpindle.superclass.draw.call(this,t),e.beginPath(),this.addEllipseToPath(e,0,0,-this.apexY/2,2*-this.apexY),e.fillStyle=e.createPattern(this.drawing.imageArray.BrownSpotPattern,"repeat"),e.strokeStyle="rgba(255,128,0,0.5)",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.KrukenbergSpindle.prototype.description=function(){return"Krukenberg spindle"},ED.LaserCircle=function(t,e){this.className="LaserCircle",this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.LaserCircle.prototype=new ED.Doodle,ED.LaserCircle.prototype.constructor=ED.LaserCircle,ED.LaserCircle.superclass=ED.Doodle.prototype,ED.LaserCircle.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!0)},ED.LaserCircle.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-50)},ED.LaserCircle.prototype.setParameterDefaults=function(){this.apexX=84,this.apexY=-84;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=new ED.Point(0,0);i.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.LaserCircle.prototype.draw=function(t){var e=this.drawing.context;if(ED.LaserCircle.superclass.draw.call(this,t),e.beginPath(),e.moveTo(this.apexX,this.apexY),e.lineTo(this.apexX,-this.apexY),e.lineTo(-this.apexX,-this.apexY),e.lineTo(-this.apexX,this.apexY),e.lineTo(this.apexX,this.apexY),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=new ED.Point(0,0),r=this.apexX+this.apexY;if(r<0)var a=this.apexX;else a=-this.apexY;for(var o=Math.round(Math.PI/(25/a)),n=0;n<o+1;n++)if(r<0){var s=-Math.PI/2+n*Math.PI/o;i.setWithPolars(a,s),this.drawLaserSpot(e,i.x,i.y+r)}else{s=-Math.PI+n*Math.PI/o;i.setWithPolars(a,s),this.drawLaserSpot(e,i.x-r,i.y)}for(n=1;n<o;n++)if(r<0){s=Math.PI/2+n*Math.PI/o;i.setWithPolars(a,s),this.drawLaserSpot(e,i.x,i.y-r)}else{s=0+n*Math.PI/o;i.setWithPolars(a,s),this.drawLaserSpot(e,i.x+r,i.y)}o=Math.abs(Math.round(r/25));for(n=0;n<2*o+1;n++)if(r<0){var l=this.apexY+a+n*Math.abs(r/o);this.drawLaserSpot(e,-a,l),this.drawLaserSpot(e,a,l)}else{var h=-this.apexX+a+n*Math.abs(r/o);this.drawLaserSpot(e,h,-a),this.drawLaserSpot(e,h,a)}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserCircle.prototype.groupDescription=function(){return"laser retinopexy"},ED.LaserDemarcation=function(t,e){this.className="LaserDemarcation",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.LaserDemarcation.prototype=new ED.Doodle,ED.LaserDemarcation.prototype.constructor=ED.LaserDemarcation,ED.LaserDemarcation.superclass=ED.Doodle.prototype,ED.LaserDemarcation.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.LaserDemarcation.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.LaserDemarcation.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-350;var t=this.drawing.lastDoodleOfClass(this.className);t?this.rotation=t.rotation+Math.PI/4:this.drawing.eye==ED.eye.Right?this.rotation=-.8*Math.PI:this.rotation=.8*Math.PI,(t=this.drawing.lastDoodleOfClass("PeripheralRetinectomy"))&&(this.rotation=t.rotation,this.arc=t.arc+Math.PI/16,this.apexY=t.apexY+50)},ED.LaserDemarcation.prototype.draw=function(t){var e=this.drawing.context;ED.LaserDemarcation.superclass.draw.call(this,t);var i=476,r=-this.apexY,a=r+(i-r)/2,o=this.arc/2,n=-Math.PI/2+o,s=-Math.PI/2-o,l=a*Math.sin(o),h=-a*Math.cos(o),d=-a*Math.sin(o),c=h;if(e.beginPath(),e.arc(0,0,a,n,s,!0),e.arc(0,0,r,s,n,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var p=new ED.Point(0,0);if(this.arc<1.9*Math.PI){for(var y=i-r,D=Math.PI/2,u=Math.round(D/(25/y)),g=new ED.Point(-i*Math.sin(o-y/i),-i*Math.cos(o-y/i)),P=0;P<u;P++)p.setWithPolars(y,s+y/i*.5-P*D/u),this.drawLaserSpot(e,g.x+p.x,g.y+p.y);var E=this.arc-2*y/i,m=Math.round(E/(25/r)),f=g.direction();for(P=0;P<m+1;P++)p.setWithPolars(r,f+P*E/m),this.drawLaserSpot(e,p.x,p.y);var w=new ED.Point(-i*Math.sin(y/i-o),-i*Math.cos(y/i-o));for(P=0;P<u;P++)p.setWithPolars(y,n+Math.PI-y/i*.5+P*D/u),this.drawLaserSpot(e,w.x+p.x,w.y+p.y)}else for(u=Math.round(2*Math.PI/(25/r)),P=0;P<u;P++)p.setWithPolars(r,2*P*Math.PI/u),this.drawLaserSpot(e,p.x,p.y)}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserDemarcation.prototype.description=function(){var t="";return this.arc>1.9*Math.PI&&(t+="360 degree "),t+="laser demarcation"},ED.LaserSpot=function(t,e){this.className="LaserSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.LaserSpot.prototype=new ED.Doodle,ED.LaserSpot.prototype.constructor=ED.LaserSpot,ED.LaserSpot.superclass=ED.Doodle.prototype,ED.LaserSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.LaserSpot.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.LaserSpot.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(100,80)},ED.LaserSpot.prototype.draw=function(t){var e=this.drawing.context;ED.LaserSpot.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=20,e.fillStyle="yellow",e.strokeStyle="rgba(255, 128, 0, 1)",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(30,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LaserSpot.prototype.groupDescription=function(){return"Laser spots"},ED.LasikFlap=function(t,e){this.className="LasikFlap",this.hinge="",this.diameter=6,this.femtoLaser="",this.depth=80,this.angle=30,this.spotSeparation="",this.lineSeparation="",this.energyLevel="",this.OBLGrade="",this.savedParameterArray=["scaleX","scaleY","rotation","femtoLaser","diameter","depth","angle","spotSeparation","lineSeparation","energyLevel","OBLGrade"],this.controlParameterArray={hinge:"Hinge",femtoLaser:"Femto laser",diameter:"Diameter",depth:"Depth",angle:"Sidecut angle",spotSeparation:"Spot separation",lineSeparation:"Line separation",energyLevel:"Energy level",OBLGrade:"OBL grade"},ED.Doodle.call(this,t,e)},ED.LasikFlap.prototype=new ED.Doodle,ED.LasikFlap.prototype.constructor=ED.LasikFlap,ED.LasikFlap.superclass=ED.Doodle.prototype,ED.LasikFlap.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.LasikFlap.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.snapToAngles=!0,this.isUnique=!0;Math.PI;this.anglesArray=[0,this.drawing.eye==ED.eye.Right?Math.PI/2:3*Math.PI/2],this.parameterValidationArray.scaleX.range.setMinAndMax(.6,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.6,1),this.parameterValidationArray.hinge={kind:"other",type:"string",list:["Superior","Nasal"],animate:!0},this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(6,10),precision:1,animate:!0},this.parameterValidationArray.femtoLaser={kind:"other",type:"string",list:["DDL AMO iFS","Zeiss Visumax","Zeimer Z7"],animate:!0},this.parameterValidationArray.depth={kind:"other",type:"int",range:new ED.Range(80,200),animate:!1},this.parameterValidationArray.angle={kind:"other",type:"int",range:new ED.Range(30,150),animate:!1},this.parameterValidationArray.spotSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.lineSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.energyLevel={kind:"other",type:"string",list:["0.50uJ","0.55uJ","0.60uJ","0.65uJ","0.70uJ","0.75uJ","0.80uJ","0.85uJ","0.90uJ","0.95uJ","1.00uJ"],animate:!1},this.parameterValidationArray.OBLGrade={kind:"other",type:"string",list:["None","Trace outside pupillary axis","In pupillary axis"],animate:!1}},ED.LasikFlap.prototype.setParameterDefaults=function(){this.setParameterFromString("hinge","Superior"),this.setParameterFromString("femtoLaser","DDL AMO iFS"),this.setParameterFromString("diameter","8.5"),this.setParameterFromString("depth","110"),this.setParameterFromString("angle","90"),this.setParameterFromString("spotSeparation","0.6um"),this.setParameterFromString("lineSeparation","0.6um"),this.setParameterFromString("energyLevel","0.75uJ"),this.setParameterFromString("OBLGrade","None")},ED.LasikFlap.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"scaleX":i.diameter=10*e;break;case"rotation":i.hinge=0==e?"Superior":"Nasal";break;case"diameter":i.scaleX=parseFloat(e)/10,i.scaleY=parseFloat(e)/10;break;case"hinge":i.rotation="Superior"==e?0:this.drawing.eye==ED.eye.Right?Math.PI/2:3*Math.PI/2}return i},ED.LasikFlap.prototype.draw=function(t){var e=this.drawing.context;ED.LasikFlap.superclass.draw.call(this,t);var i=Math.PI/6,r=-Math.PI/2-i,a=-Math.PI/2+i;if(e.beginPath(),e.arc(0,0,320,r,a,!0),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),e.arc(0,0,160,0,2*Math.PI,!0),this.gradeDLK){case"None":e.fillStyle="rgba(155,255,255,0)";break;case"Grade 1":e.fillStyle="rgba(155,255,255,0.4)";break;case"Grade 2":e.fillStyle="rgba(155,255,255,0.6)";break;case"Grade 3":e.fillStyle="rgba(155,255,255,0.8)"}e.fill()}var o=new ED.Point(0,0);return o.setWithPolars(320,i),this.handleArray[2].location=this.transform.transformPoint(o),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LasikFlap.prototype.description=function(){if(this.drawing.eye==ED.eye.Right)var t=!0;else t=!1;var e=Math.cos(this.rotation),i=Math.sin(this.rotation),r=Math.abs(e),a=Math.abs(i),o="";return i>e&&a>r&&(o=t?"nasal":"temporal"),i>e&&a<r&&(o="inferior"),i<e&&a>r&&(o=t?"temporal":"nasal"),i<e&&a<r&&(o="superior"),"LASIK flap with "+o+" hinge"},ED.Lattice=function(t,e){this.className="Lattice",this.savedParameterArray=["arc","radius","originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.Lattice.prototype=new ED.Doodle,ED.Lattice.prototype.constructor=ED.Lattice,ED.Lattice.superclass=ED.Doodle.prototype,ED.Lattice.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Lattice.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!0,this.rangeOfScale=new ED.Range(.125,1.5),this.rangeOfArc=new ED.Range(Math.PI/12,2*Math.PI),this.rangeOfApexX=new ED.Range(-0,0),this.rangeOfApexY=new ED.Range(50,250)},ED.Lattice.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.radius=350},ED.Lattice.prototype.draw=function(t){var e=this.drawing.context;ED.Lattice.superclass.draw.call(this,t);var i=this.radius+50,r=this.radius,a=r+(i-r)/2,o=this.arc/2,n=-Math.PI/2+o,s=-Math.PI/2-o,l=a*Math.sin(o),h=-a*Math.cos(o),d=-a*Math.sin(o),c=h;e.beginPath(),e.arc(0,0,i,n,s,!0),e.arc(0,0,r,s,n,!1),e.closePath(),e.lineWidth=4;var p=e.createPattern(this.drawing.imageArray.LatticePattern,"repeat");return e.fillStyle=p,e.strokeStyle="lightgray",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[0].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(l,h)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Lattice.prototype.description=function(){var t="Lattice at ";return t+=this.clockHour()+" o'clock"},ED.Lattice.prototype.snomedCode=function(){return 3577e3},ED.Lattice.prototype.diagnosticHierarchy=function(){return 0},ED.Lens=function(t,e){this.className="Lens",this.classGroupUnique="Lens",this.nuclearGrade="None",this.corticalGrade="None",this.posteriorSubcapsularGrade="None",this.anteriorPolar=!1,this.posteriorPolar=!1,this.coronary=!1,this.blueDot=!1,this.phakodonesis=!1,this.csOriginX=0,this.savedParameterArray=["rotation","originX","originY","nuclearGrade","corticalGrade","posteriorSubcapsularGrade","anteriorPolar","posteriorPolar","coronary","phakodonesis","blueDot","csOriginX"],this.controlParameterArray={nuclearGrade:"Nuclear",corticalGrade:"Cortical",posteriorSubcapsularGrade:"Posterior subcapsular",anteriorPolar:"Anterior polar",posteriorPolar:"Posterior polar",coronary:"Coronary",phakodonesis:"Phacodonesis",blueDot:"Blue Dot"},ED.Doodle.call(this,t,e)},ED.Lens.prototype=new ED.Doodle,ED.Lens.prototype.constructor=ED.Lens,ED.Lens.superclass=ED.Doodle.prototype,ED.Lens.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-125,125),this.parameterValidationArray.originY.range.setMinAndMax(-125,125),this.parameterValidationArray.nuclearGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","Brunescent"],animate:!1},this.parameterValidationArray.corticalGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","White"],animate:!1},this.parameterValidationArray.posteriorSubcapsularGrade={kind:"derived",type:"string",list:["None","Small","Medium","Large"],animate:!1},this.parameterValidationArray.anteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.posteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.coronary={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.blueDot={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.phakodonesis={kind:"derived",type:"bool",display:!1}},ED.Lens.prototype.setParameterDefaults=function(){},ED.Lens.prototype.draw=function(t){var e=this.drawing.context;ED.Lens.superclass.draw.call(this,t);var i=240;if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if("None"!=this.posteriorSubcapsularGrade){var r;switch(this.posteriorSubcapsularGrade){case"Small":r=30;break;case"Medium":r=60;break;case"Large":r=90}e.beginPath(),e.arc(0,0,r,0,2*Math.PI,!1);var a=e.createPattern(this.drawing.imageArray.PSCPattern,"repeat");e.fillStyle=a,e.strokeStyle="lightgray",e.fill(),e.stroke()}if(this.posteriorPolar){var o=50;e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!1),e.fillStyle="rgba(140,140,140,0.75)",e.strokeStyle="gray",e.fill(),e.stroke()}var n=i-60;if(e.beginPath(),e.arc(0,0,n,0,2*Math.PI,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke(),"None"!=this.nuclearGrade){var s;switch(this.nuclearGrade){case"Mild":s=-120;break;case"Moderate":s=-80;break;case"Brunescent":s=0}yellowColour="rgba(255, 255, 0, 0.75)";var l="rgba("+Math.round(120-s)+", "+Math.round(60-s)+", 0, 0.75)",h=e.createRadialGradient(0,0,210,0,0,50);h.addColorStop(0,yellowColour),h.addColorStop(1,l),e.fillStyle=h,e.fill()}if("None"!=this.corticalGrade){i=240;var d=2*Math.PI/16,c=d/2;switch(this.corticalGrade){case"Mild":n=180;break;case"Moderate":n=100;break;case"White":n=20}e.beginPath();var p=new ED.Point(0,0);p.setWithPolars(230,-c),e.moveTo(p.x,p.y);for(var y=0;y<16;y++){var D=y*d-c,u=new ED.Point(0,0);u.setWithPolars(230,D),e.lineTo(u.x,u.y);var g=new ED.Point(0,0);g.setWithPolars(n,y*d),e.lineTo(g.x,g.y)}e.lineTo(p.x,p.y),e.moveTo(i,0),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,e.lineJoin="bevel",e.fillStyle="rgba(200,200,200,0.75)",e.fill()}var P=Math.PI/8;if(this.coronary)for(var E=0;E<2*Math.PI;E+=P){(m=new ED.Point(0,0)).setWithPolars(130,E),this.drawCircle(e,m.x,m.y,10,"rgba(200,200,255,1)",4,"rgba(200,200,255,1)")}if(this.blueDot)for(E=0;E<2*Math.PI;E+=Math.PI/6){var m;(m=new ED.Point(0,0)).setWithPolars(202,E),this.drawCircle(e,m.x,m.y,15,"rgba(168,194,218,1)",4,"rgba(168,194,218,1)")}if(this.anteriorPolar){o=30;e.beginPath(),e.arc(0,0,o,0,2*Math.PI,!1),e.fillStyle="rgba(120,120,120,0.5)",e.strokeStyle="gray",e.fill(),e.stroke()}if(this.phakodonesis){for(e.beginPath(),e.moveTo(-150,0),x=0;x<=300;x+=1)e.lineTo(-150+x,20*Math.sin(2*Math.PI*x/100));e.lineWidth=4,e.strokeStyle="blue",e.stroke(),e.beginPath(),e.moveTo(-150,-20),e.lineTo(-225,0),e.lineTo(-150,20),e.lineWidth=4,e.fillStyle="blue",e.fill(),e.beginPath(),e.moveTo(150,-20),e.lineTo(225,0),e.lineTo(150,20),e.lineWidth=4,e.fillStyle="blue",e.fill()}}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Lens.prototype.description=function(){return returnValue="",this.originY<-30?returnValue+="Lens subluxation: superior":this.originY>30&&(returnValue+="Lens subluxation: inferior"),"None"!=this.nuclearGrade&&(returnValue+=returnValue.length>0?", ":"",returnValue+=this.nuclearGrade+" nuclear cataract"),"None"!=this.corticalGrade&&(returnValue+=returnValue.length>0?", ":"",returnValue+=this.corticalGrade+" cortical cataract"),"None"!=this.posteriorSubcapsularGrade&&(returnValue+=returnValue.length>0?", ":"",returnValue+=this.posteriorSubcapsularGrade+" posterior subcapsular cataract"),this.coronary&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Coronary cataract"),this.blueDot&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Blue dot cataract"),this.anteriorPolar&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Anterior polar cataract"),this.posteriorPolar&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Posterior polar cataract"),this.phakodonesis&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Phacodonesis"),returnValue},ED.Lens.prototype.snomedCodes=function(){return snomedCodes=new Array,"None"!=this.nuclearGrade&&snomedCodes.push([53889007,3]),"None"!=this.corticalGrade&&snomedCodes.push([193576003,3]),"None"!=this.posteriorSubcapsularGrade&&snomedCodes.push([315353005,3]),this.coronary&&snomedCodes.push([12195004,3]),this.anteriorPolar&&snomedCodes.push([253224008,3]),this.posteriorPolar&&snomedCodes.push([253225009,3]),this.phakodonesis&&snomedCodes.push([116669003,3]),snomedCodes},ED.LensCrossSection=function(t,e){this.className="LensCrossSection",this.nuclearGrade="None",this.corticalGrade="None",this.posteriorSubcapsularGrade="None",this.phakodonesis=!1,this.anteriorPolar=!1,this.posteriorPolar=!1,this.acd=3,this.savedParameterArray=["originX","originY","nuclearGrade","corticalGrade","posteriorSubcapsularGrade","phakodonesis","anteriorPolar","posteriorPolar","acd"],ED.Doodle.call(this,t,e),this.linkedDoodleParameters={Lens:{source:["originY","nuclearGrade","corticalGrade","posteriorSubcapsularGrade","phakodonesis","anteriorPolar","posteriorPolar"],store:[["originX","csOriginX"]]}}},ED.LensCrossSection.prototype=new ED.Doodle,ED.LensCrossSection.prototype.constructor=ED.LensCrossSection,ED.LensCrossSection.superclass=ED.Doodle.prototype,ED.LensCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.nuclearGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","Brunescent"],animate:!1},this.parameterValidationArray.corticalGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","White"],animate:!0},this.parameterValidationArray.posteriorSubcapsularGrade={kind:"derived",type:"string",list:["None","Small","Medium","Large"],animate:!1},this.parameterValidationArray.phakodonesis={kind:"other",type:"bool",display:!1},this.parameterValidationArray.anteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.posteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.acd={kind:"derived",type:"float",range:new ED.Range(0,5),precision:1,animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-150,200),this.parameterValidationArray.originY.range.setMinAndMax(-140,140)},ED.LensCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.LensCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"originX":var r=this.drawing.lastDoodleOfClass("AntSegCrossSection");if(r){var a=r.parameterValidationArray.apexX.range.min,o=r.parameterValidationArray.apexX.range.max,n=32-72/220*(r.apexY+280)+this.originX-44;if(n<a&&(n=a),r.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(r.apexY+280),n),this.drawing.isActive){var s=n-(o-r.apexX);l=r.parameterValidationArray.apexX.range.constrain(s)}else var l=r.parameterValidationArray.apexX.range.max;r.setSimpleParameter("apexX",l)}this.calculateACD()}return i},ED.LensCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.LensCrossSection.superclass.draw.call(this,t);var i=300,r=100,a=Math.asin(.8),o=i*Math.cos(a),n=Math.acos(o/240);if(e.beginPath(),e.arc(r-o,0,i,a,-a,!0),e.arc(r+o,0,i,Math.PI+a,Math.PI-a,!0),e.stroke(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),e.moveTo(r,240*Math.sin(n)),e.arc(r-o,0,240,n,-n,!0),e.arc(r+o,0,240,Math.PI+n,Math.PI-n,!0),e.strokeStyle="rgba(220, 220, 220, 0.75)",e.stroke(),"None"!=this.nuclearGrade){var s;switch(this.nuclearGrade){case"Mild":s=-120;break;case"Moderate":s=-80;break;case"Brunescent":s=0}yellowColour="rgba(255, 255, 0, 0.75)";var l="rgba("+Math.round(120-s)+", "+Math.round(60-s)+", 0, 0.75)",h=e.createRadialGradient(0,0,210,0,0,50);h.addColorStop(0,yellowColour),h.addColorStop(1,l),e.fillStyle=h,e.fill()}if("None"!=this.corticalGrade){switch(this.corticalGrade){case"Mild":p=-180;break;case"Moderate":p=-100;break;case"White":p=-20}a=Math.asin(.8),o=i*Math.cos(a);var d=270;a=Math.acos(o/d);n=Math.asin(-p/d);e.beginPath(),e.arc(r-o,0,d,n,a,!1),e.arc(r+o,0,d,Math.PI-a,Math.PI-n,!1);var c=d*Math.cos(n);e.moveTo(r-o+c,p),e.arc(r-o,0,d,-n,-a,!0),e.arc(r+o,0,d,Math.PI+a,Math.PI+n,!0),e.lineWidth=30,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(200,200,200,0.75)",this.drawBoundary(t)}if("None"!=this.posteriorSubcapsularGrade){var p;switch(this.posteriorSubcapsularGrade){case"Small":p=30;break;case"Medium":p=60;break;case"Large":p=90}a=Math.asin(.8),o=i*Math.cos(a),d=290,n=Math.asin(p/d);e.beginPath(),e.arc(r-o,0,d,-n,n,!1),e.lineWidth=10,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(150,150,150,0.75)",this.drawBoundary(t)}if(e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(64,-207),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(138,-207),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(64,207),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(138,207),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(64,207),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(138,207),e.lineWidth=2,e.strokeStyle="gray",e.stroke(),this.phakodonesis){for(e.beginPath(),e.moveTo(100,-125),y=0;y<=250;y+=1)e.lineTo(100+20*Math.sin(2*Math.PI*y/100),-125+y);e.lineWidth=4,e.strokeStyle="blue",e.stroke(),e.beginPath(),e.moveTo(80,-125),e.lineTo(100,-225),e.lineTo(120,-125),e.lineWidth=4,e.fillStyle="blue",e.fill(),e.beginPath(),e.moveTo(80,125),e.lineTo(100,225),e.lineTo(120,125),e.lineWidth=4,e.fillStyle="blue",e.fill()}if(this.anteriorPolar){var D=new ED.Point(r+o,0),u=Math.PI+10/180*Math.PI,g=Math.sin(u)*i,P=Math.cos(u)*i,E=new ED.Point(D.x+P,D.y+g);e.beginPath(),e.arc(D.x,D.y,i,Math.PI+10/180*Math.PI,Math.PI-10/180*Math.PI,!0),e.bezierCurveTo(E.x-40,10,E.x-40,-10,E.x,E.y),e.strokeStyle="gray",e.fillStyle="rgba(120,120,120,0.5)",e.fill(),e.stroke()}if(this.posteriorPolar){D=new ED.Point(r-o,0),u=10/180*Math.PI,g=Math.sin(u)*i,P=Math.cos(u)*i,E=new ED.Point(D.x+P,D.y+g);e.beginPath(),e.arc(D.x,D.y,i,10/180*Math.PI,-10/180*Math.PI,!0),e.bezierCurveTo(E.x+40,-10,E.x+40,10,E.x,E.y),e.strokeStyle="gray",e.fillStyle="rgba(120,120,120,0.5)",e.fill(),e.stroke()}}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LensCrossSection.prototype.calculateACD=function(){var t=this.drawing.lastDoodleOfClass("CorneaCrossSection");if(t){var e;switch(t.shape){case"Normal":e=-150;break;case"Keratoconus":var i=t.pachymetry/5;e=t.apexX+i+70;break;case"Keratoglobus":e=-210}var r=this.originX-44-e;this.acd=(3*r/150).toFixed(1),this.acd<0&&(this.acd=0)}},ED.LensCrossSection.prototype.description=function(){var t="";return t+="AC depth: "+this.acd+"mm"},ED.Lids=function(t,e){this.className="Lids",this.savedParameterArray=["apexX","apexY","dir"],ED.Doodle.call(this,t,e)},ED.Lids.prototype=new ED.Doodle,ED.Lids.prototype.constructor=ED.Lids,ED.Lids.superclass=ED.Doodle.prototype,ED.Lids.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!0),this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!0)},ED.Lids.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isScalable=!1,this.isRotatable=!1,this.isShowHighlight=!1,this.handleCoordinateRangeArray=new Array,this.handleCoordinateRangeArray[0]={x:new ED.Range(-260,260),y:new ED.Range(30,300)},this.handleCoordinateRangeArray[1]={x:new ED.Range(-0,0),y:new ED.Range(-120,110)}},ED.Lids.prototype.setParameterDefaults=function(){this.drawing.eye!=ED.eye.Right?this.dir=-1:this.drawing.eye!=ED.eye.Left&&(this.dir=1),this.apexX=0,this.apexY=110;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(0,115);this.squiggleArray[0].pointsArray.push(e);var i=new ED.Point(0,-90);this.squiggleArray[0].pointsArray.push(i)},ED.Lids.prototype.draw=function(t){var e=this.drawing.context;ED.Lids.superclass.draw.call(this,t);var i=250,r=45,a=this.squiggleArray[0].pointsArray[0],o=new ED.Point(i*this.dir,r+(a.y-115)/5),n=new ED.Point(-i*this.dir,0);a.x*this.dir>20&&(o.x+=(a.x-20)/5);var s=new ED.Point(a.x+60*this.dir,1.45*a.y),l=new ED.Point(a.x-180*this.dir,1.16*a.y),h=this.squiggleArray[0].pointsArray[1],d=new ED.Point(i*this.dir,h.y/5+19+0),c=new ED.Point(-85*this.dir,1.3*h.y),p=new ED.Point(85*this.dir,1.35*h.y);if(e.beginPath(),e.moveTo(-510*this.dir,-510),e.lineTo(-510*this.dir,510),e.lineTo(510*this.dir,510),e.lineTo(510*this.dir,-510),e.lineTo(-510*this.dir,-510),e.moveTo(n.x,n.y),e.bezierCurveTo(c.x,c.y,p.x,p.y,d.x,d.y),e.bezierCurveTo(312.5*this.dir,40.5,300*this.dir,r,o.x,o.y),e.bezierCurveTo(s.x,s.y,l.x,l.y,n.x,n.y),e.closePath(),e.lineWidth=5,e.fillStyle="white",e.strokeStyle="rgba(0,0,0,0)",e.shadowBlur=15,e.shadowColor="rgba(0,0,0,0.8)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-i*this.dir,0),e.bezierCurveTo(c.x,c.y,p.x,p.y,d.x,d.y),e.bezierCurveTo(312.5*this.dir,40.5,300*this.dir,r,o.x,o.y),e.bezierCurveTo(s.x,s.y,l.x,l.y,n.x,n.y),e.moveTo(-i*this.dir,0),e.strokeStyle="black",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x-22.5*this.dir,n.y+22.5-h.y/5-19),e.stroke(),e.closePath();var y=new ED.Point(a.x-170*this.dir,1.38*a.y),D=new ED.Point(a.x+70*this.dir,1.45*a.y);e.beginPath(),e.moveTo(-i*this.dir,0),e.bezierCurveTo(y.x,y.y,D.x,D.y,o.x,o.y),e.lineWidth=3,e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-i*this.dir-40.5*this.dir,4.5),e.bezierCurveTo(-130*this.dir,-192,100*this.dir,-192,i*this.dir+r*this.dir,0),e.lineWidth=3,e.shadowBlur=7,e.shadowColor="black",e.stroke(),e.closePath()}return this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.handleArray[1].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[1]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Lids.prototype.description=function(){var t=this.squiggleArray[0].pointsArray[0],e=this.squiggleArray[0].pointsArray[1],i="",r="";e.y>=-57&&e.y<-38?r="Mild ptosis":e.y>=-38&&e.y<-19?r="Moderate ptosis":e.y>=-19&&(r="Severe ptosis");var a="";return t.y>132&&t.x*this.dir>90?a="Medial ectropion":t.y>132&&t.x*this.dir<-90?a="Lateral ectropion":t.y>132&&(a="Ectropion"),r.length>0&&(i+=r),r.length>0&&a.length>0&&(i+=", "),a.length>0&&(i+=a),i},ED.LimbalRelaxingIncision=function(t,e){this.className="LimbalRelaxingIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.LimbalRelaxingIncision.prototype=new ED.Doodle,ED.LimbalRelaxingIncision.prototype.constructor=ED.LimbalRelaxingIncision,ED.LimbalRelaxingIncision.superclass=ED.Doodle.prototype,ED.LimbalRelaxingIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.LimbalRelaxingIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2)},ED.LimbalRelaxingIncision.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t?(this.rotation=t.rotation+Math.PI,this.arc=t.arc):this.drawing.eye==ED.eye.Right?this.rotation=-Math.PI/2:this.rotation=Math.PI/2},ED.LimbalRelaxingIncision.prototype.draw=function(t){var e=this.drawing.context;ED.LimbalRelaxingIncision.superclass.draw.call(this,t);e.beginPath();var i=this.arc/2;e.arc(0,0,372,-Math.PI/2+i,-Math.PI/2-i,!0),e.arc(0,0,348,-Math.PI/2-i,-Math.PI/2+i,!1),e.closePath(),e.fillStyle="rgba(100,100,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(360,i),this.handleArray[3].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.LimbalRelaxingIncision.prototype.description=function(){var t="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.Macroaneurysm=function(t,e){this.className="Macroaneurysm",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Macroaneurysm.prototype=new ED.Doodle,ED.Macroaneurysm.prototype.constructor=ED.Macroaneurysm,ED.Macroaneurysm.superclass=ED.Doodle.prototype,ED.Macroaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithRotations(300,60,60)},ED.Macroaneurysm.prototype.draw=function(t){var e=this.drawing.context;ED.Macroaneurysm.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,50,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(e.beginPath(),e.arc(0,0,25,0,2*Math.PI,!0),e.fillStyle="rgba(197,186,80,1)",e.fill()),this.isClicked},ED.Macroaneurysm.prototype.description=function(){return"Macroaneurysm"},ED.Macroaneurysm.prototype.snomedCode=function(){return 247124009},ED.MaculaPostPole=function(t,e){this.className="MaculaPostPole",this.watzke="Not assessed",this.savedParameterArray=["watzke"],this.controlParameterArray={watzke:"Watzke Result"},ED.Doodle.call(this,t,e)},ED.MaculaPostPole.prototype=new ED.Doodle,ED.MaculaPostPole.prototype.constructor=ED.MaculaPostPole,ED.MaculaPostPole.superclass=ED.Doodle.prototype,ED.MaculaPostPole.prototype.setHandles=function(){},ED.MaculaPostPole.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.willReport=!0,this.inFrontOfClassArray=["PostPole"],this.parameterValidationArray.watzke={kind:"derived",type:"string",list:["Not assessed","Normal","Abnormal"],animate:!0}},ED.MaculaPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.MaculaPostPole.superclass.draw.call(this,t);this.drawing.eye,ED.eye.Right;return e.beginPath(),e.lineWidth=4,e.strokeStyle="rgba(249,187,76,0)",e.fillStyle="rgba(249,187,76,0)",e.arc(0,0,20,0,2*Math.PI,!0),this.drawBoundary(t),this.isClicked},ED.MaculaPostPole.prototype.description=function(){var t="";return"Not assessed"!==this.watzke&&(t+="Watzke: "+this.watzke.toLowerCase()+" "),0===t.length&&1===this.drawing.doodleArray.length&&(t="No abnormality"),t},ED.MacularDystrophy=function(t,e){this.className="MacularDystrophy",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularDystrophy.prototype=new ED.Doodle,ED.MacularDystrophy.prototype.constructor=ED.MacularDystrophy,ED.MacularDystrophy.superclass=ED.Doodle.prototype,ED.MacularDystrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularDystrophy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,100)},ED.MacularDystrophy.prototype.setParameterDefaults=function(){this.apexY=-100},ED.MacularDystrophy.prototype.draw=function(t){var e=this.drawing.context;ED.MacularDystrophy.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,150,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="rgba(255,0,0,0)",e.fillStyle="rgba(255,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.apexY<-50?(e.beginPath(),e.moveTo(-200,0),e.bezierCurveTo(-200,-70,-100,-140,0,-140),e.bezierCurveTo(100,-140,200,-70,200,0),e.bezierCurveTo(200,70,100,140,0,140),e.bezierCurveTo(-100,140,-200,70,-200,0),e.fillStyle="rgba(223,80,20,1)",e.fill(),e.beginPath(),e.moveTo(-100,0),e.bezierCurveTo(-100,-35,-50,-70,0,-70),e.bezierCurveTo(50,-70,100,-35,100,0),e.bezierCurveTo(100,35,50,70,0,70),e.bezierCurveTo(-50,70,-100,35,-100,0),e.fillStyle="rgba(125,65,54,1)",e.fill()):this.apexY<0?(e.beginPath(),e.arc(0,0,100,0,2*Math.PI,!0),e.fillStyle="yellow",e.strokeStyle="brown",e.lineWidth=20,e.fill(),e.stroke()):(e.beginPath(),e.arc(0,0,120,0,2*Math.PI,!0),e.fillStyle="rgba(255, 120, 120, 0.5)",e.strokeStyle=e.fillStyle,e.lineWidth=1,e.fill()));var i=new ED.Point(0,0);return i.setWithPolars(150,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularDystrophy.prototype.groupDescription=function(){return this.apexY<-50?"Bull's eye maculopathy":this.apexY<0?"Vitelliform macular dystrophy":"Atrophic macular dystrophy"},ED.MacularDystrophy.prototype.snomedCode=function(){return 276436007},ED.MacularGrid=function(t,e){this.className="MacularGrid",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularGrid.prototype=new ED.Doodle,ED.MacularGrid.prototype.constructor=ED.MacularGrid,ED.MacularGrid.superclass=ED.Doodle.prototype,ED.MacularGrid.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularGrid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-150,-50)},ED.MacularGrid.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.MacularGrid.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t);var i=-this.apexY;if(e.beginPath(),e.arc(0,0,250,0,2*Math.PI,!0),e.arc(0,0,i,2*Math.PI,0,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){n=Math.floor(500/60);for(var r=-n/2*60,a=0;a<n+1;a++)for(var o=0;o<n+1;o++){var s=r+60*a+Math.round(15*(-.5+ED.randomArray[a+o])),l=r+60*o+Math.round(15*(-.5+ED.randomArray[a+o+100])),h=s*s+l*l;h>=i*i&&h<=62500&&this.drawLaserSpot(e,s,l)}}var d=new ED.Point(0,0);return d.setWithPolars(250,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularGrid.prototype.description=function(){return"Macular grid laser"},ED.MacularHole=function(t,e){this.className="MacularHole",this.savedParameterArray=["originX","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.MacularHole.prototype=new ED.Doodle,ED.MacularHole.prototype.constructor=ED.MacularHole,ED.MacularHole.superclass=ED.Doodle.prototype,ED.MacularHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.MacularHole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MacularHole.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.MacularHole.prototype.draw=function(t){var e=this.drawing.context;ED.MacularHole.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,40,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="yellow",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,80/3,0,2*Math.PI,!0),e.closePath(),e.fillStyle="red",e.fill()),point=new ED.Point(0,0),point.setWithPolars(40,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularHole.prototype.description=function(){return"Macular hole"},ED.MacularHole.prototype.snomedCode=function(){return 232006002},ED.MacularHole.prototype.diagnosticHierarchy=function(){return 0},ED.MacularThickening=function(t,e){this.className="MacularThickening",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e),this.rotation=-Math.PI/4},ED.MacularThickening.prototype=new ED.Doodle,ED.MacularThickening.prototype.constructor=ED.MacularThickening,ED.MacularThickening.superclass=ED.Doodle.prototype,ED.MacularThickening.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularThickening.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(100,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.MacularThickening.prototype.setParameterDefaults=function(){this.apexX=100,this.apexY=0,this.setOriginWithDisplacements(0,150)},ED.MacularThickening.prototype.draw=function(t){var e=this.drawing.context;ED.MacularThickening.superclass.draw.call(this,t);var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0)",e.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();e.moveTo(-i,0),e.lineTo(i,0);for(var r=-1;r<2;r+=2)for(var a=30;a<i;a+=30){var o=this.xForY(i,a);e.moveTo(-o,r*a),e.lineTo(o,r*a)}e.lineWidth=15,e.lineCap="round",e.strokeStyle="rgba(200, 200, 200, 0.75)",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MacularThickening.prototype.groupDescription=function(){return"Macular thickening "},ED.MacularThickening.prototype.description=function(){return this.locationRelativeToFovea()},ED.Malyugin=function(t,e){this.className="Malyugin",this.savedParameterArray=["scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.Malyugin.prototype=new ED.Doodle,ED.Malyugin.prototype.constructor=ED.Malyugin,ED.Malyugin.superclass=ED.Doodle.prototype,ED.Malyugin.prototype.formatReport=function(){return this.description()},ED.Malyugin.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.Malyugin.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.isUnique=!0},ED.Malyugin.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(25,90)},ED.Malyugin.prototype.draw=function(t){var e=this.drawing.context;ED.Malyugin.superclass.draw.call(this,t),(i=this.drawing.lastDoodleOfClass("AntSeg"))&&(length=-i.apexY);var i,r=300,a=Math.PI/6,o=Math.PI/12;(i=this.drawing.lastDoodleOfClass("AntSeg"))&&(r=-i.apexY);e.beginPath();var n=new ED.Point(r,0),s=Math.PI/4,l=Math.PI/4;return e.moveTo(n.x,n.y),n.setWithPolars(r,s),e.arc(n.x,n.y,40,0-l+a,0-3*l-o,!0),n.setCoordinates(0,-r),e.moveTo(n.x,n.y),s-=Math.PI/2,n.setWithPolars(r,s),e.arc(n.x,n.y,40,0-3*l+a,0-5*l-o,!0),n.setCoordinates(-r,0),e.moveTo(n.x,n.y),s-=Math.PI/2,n.setWithPolars(r,s),e.arc(n.x,n.y,40,0-5*l+a,0-7*l-o,!0),n.setCoordinates(0,r),e.moveTo(n.x,n.y),s-=Math.PI/2,n.setWithPolars(r,s),e.arc(n.x,n.y,40,0-7*l+a,0-9*l-o,!0),e.lineWidth=8,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="blue",this.drawBoundary(t),point=new ED.Point(r,0),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Malyugin.prototype.description=function(){return"Malyugin ring"},ED.Malyugin.prototype.snomedCode=function(){},ED.MarginalKeratitis=function(t,e){this.className="MarginalKeratitis",this.epithelialDefectPercent=90,this.savedParameterArray=["apexY","arc","rotation","epithelialDefectPercent"],this.controlParameterArray={epithelialDefectPercent:"% Epithelial defect \n of corneal infiltrate"},ED.Doodle.call(this,t,e)},ED.MarginalKeratitis.prototype=new ED.Doodle,ED.MarginalKeratitis.prototype.constructor=ED.MarginalKeratitis,ED.MarginalKeratitis.superclass=ED.Doodle.prototype,ED.MarginalKeratitis.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1),this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.MarginalKeratitis.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;var t=new Object;t.length=new ED.Range(380,495),t.angle=new ED.Range(0,2*Math.PI),this.handleVectorRangeArray[0]=t,this.isMoveable=!1,this.isUnique=!1,this.isFilled=!1,this.parameterValidationArray.epithelialDefectPercent={kind:"other",type:"int",range:new ED.Range(0,100),animate:!1},this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-375,-226)},ED.MarginalKeratitis.prototype.setParameterDefaults=function(){this.apexY=-340,this.arc=45*Math.PI/180;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(0,-420);this.squiggleArray[0].addPoint(e)},ED.MarginalKeratitis.prototype.dependentParameterValues=function(t,e){switch(t){case"handles":this.squiggleArray[0].pointsArray[this.draggingHandleIndex].x=0}return{}},ED.MarginalKeratitis.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var i=Math.abs(this.squiggleArray[0].pointsArray[0].y),r=380,a=Math.abs(this.apexY),o=this.arc/2,n=-Math.PI/2+o,s=-Math.PI/2-o,l=(Math.sin(o),Math.cos(o),Math.sin(o),r*Math.sin(o)),h=-r*Math.cos(o),d=-r*Math.sin(o),c=h;Math.sin(o),Math.cos(o),Math.sin(o);if(e.beginPath(),e.arc(0,0,i,n,s,!0),e.arc(0,0,a,s,n,!1),e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,i,n,s,!0),e.arc(0,0,r,s,n,!1);var p=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");e.fillStyle=p,e.fill();var y=e.createRadialGradient(0,0,r,0,0,i);y.addColorStop(0,"red"),y.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=y,e.fill(),e.closePath(),e.beginPath(),e.arc(0,0,r,n,s,!0),e.arc(0,0,a,s,n,!1),e.fillStyle="gray",e.strokeStyle="gray",e.fill(),e.stroke(),e.closePath();var D=this.epithelialDefectPercent/100*this.arc/2,u=-Math.PI/2+D,g=-Math.PI/2-D,P=r-(r-a)*this.epithelialDefectPercent/100;Math.sin(D),Math.cos(D),Math.sin(D);e.beginPath(),e.arc(0,0,r,u,g,!0),e.arc(0,0,P,g,u,!1),e.fillStyle="green",e.fill(),e.closePath()}return this.handleArray[1].location=this.transform.transformPoint(new ED.Point(d,c)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MarginalKeratitis.prototype.description=function(){return"Marginal keratitis"},ED.MarginalKeratitis.prototype.snomedCode=function(){"use strict";return 95730003},ED.MattressSuture=function(t,e){this.className="MattressSuture",this.savedParameterArray=["radius","rotation"],ED.Doodle.call(this,t,e)},ED.MattressSuture.prototype=new ED.Doodle,ED.MattressSuture.prototype.constructor=ED.MattressSuture,ED.MattressSuture.superclass=ED.Doodle.prototype,ED.MattressSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.MattressSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.MattressSuture.prototype.draw=function(t){var e=this.drawing.context;ED.MattressSuture.superclass.draw.call(this,t),e.beginPath();var i=this.radius;return e.rect(-40,-(i+40),80,80),e.closePath(),e.fillStyle="rgba(255,255,255,0.0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-40,-(i+40)),e.lineTo(40,-(i+40)),e.lineTo(-40,-(i-40)),e.lineTo(40,-(i-40)),e.lineTo(-40,-(i+40)),e.lineWidth=2,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MattressSuture.prototype.description=function(){var t="Mattress suture at ";return t+=this.clockHour()+" o'clock"},ED.MetallicForeignBody=function(t,e){this.className="MetallicForeignBody",this.mfb=!0,this.coats=!1,this.rustRing=!1,this.h=30,this.fb=1,this.savedParameterArray=["originX","originY","scaleX","scaleY","mfb","coats","rustRing","h"],this.controlParameterArray={mfb:"Metallic foreign body",rustRing:"Rust ring",coats:"Coats ring"},ED.Doodle.call(this,t,e)},ED.MetallicForeignBody.prototype=new ED.Doodle,ED.MetallicForeignBody.prototype.constructor=ED.MetallicForeignBody,ED.MetallicForeignBody.superclass=ED.Doodle.prototype,ED.MetallicForeignBody.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.MetallicForeignBody.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(1,2.5),this.parameterValidationArray.scaleY.range.setMinAndMax(1,2.5),this.parameterValidationArray.mfb={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.coats={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.rustRing={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.h={kind:"derived",type:"int",animate:!1},this.parameterValidationArray.fb={kind:"other",type:"int",range:[0,1],animate:!1}},ED.MetallicForeignBody.prototype.setParameterDefaults=function(){},ED.MetallicForeignBody.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"coats":1==e&&(this.setParameterFromString("rustRing","false",!0),this.setParameterFromString("mfb","false",!0));break;case"scaleX":i.h=Math.round(30*e);break;case"mfb":1==e?i.fb=1:0==e&&(i.fb=0)}return i},ED.MetallicForeignBody.prototype.draw=function(t){var e=this.drawing.context;ED.MetallicForeignBody.superclass.draw.call(this,t),e.beginPath();var i=30;return e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.mfb&&(e.beginPath(),e.arc(0,0,24,0,2*Math.PI,!0),e.fillStyle="brown",e.fill()),this.rustRing&&(e.beginPath(),e.arc(0,0,31.5,0,2*Math.PI,!0),e.lineWidth=8,e.strokeStyle="brown",e.stroke()),this.coats&&(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=12,e.strokeStyle="rgba(180,180,180,1)",e.stroke())),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(i,-i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MetallicForeignBody.prototype.description=function(){var t=[];return 1===this.fb&&t.push("metallic foreign body"),this.rustRing&&t.push("rust ring"),this.coats&&t.push("coats ring"),(t=t.join(", ")).charAt(0).toUpperCase()+t.slice(1)},ED.MetallicForeignBody.prototype.snomedCode=function(){return 422321007},ED.MetallicForeignBodyCrossSection=function(t,e){this.className="MetallicForeignBodyCrossSection",this.fb=1,this.h=30,this.point=new ED.Point(0,0),this.savedParameterArray=["originX","originY","h","fb"],this.controlParameterArray={},ED.Doodle.call(this,t,e)},ED.MetallicForeignBodyCrossSection.prototype=new ED.Doodle,ED.MetallicForeignBodyCrossSection.prototype.constructor=ED.MetallicForeignBodyCrossSection,ED.MetallicForeignBodyCrossSection.superclass=ED.Doodle.prototype,ED.MetallicForeignBodyCrossSection.prototype.setHandles=function(){},ED.MetallicForeignBodyCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!1,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(0,108),this.parameterValidationArray.h={kind:"other",type:"int",range:[0,1080],animate:!0},this.parameterValidationArray.fb={kind:"other",type:"int",range:[0,1],animate:!1}},ED.MetallicForeignBodyCrossSection.prototype.setParameterDefaults=function(){this.originX=0,this.originY=0,this.defineBezier()},ED.MetallicForeignBodyCrossSection.prototype.dependentParameterValues=function(t,e){switch(t){case"originY":case"originX":this.defineBezier()}return{}},ED.MetallicForeignBodyCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.MetallicForeignBodyCrossSection.superclass.draw.call(this,t),e.beginPath();var i=new ED.Point(251,-this.originY);angle=i.direction()+.5*Math.PI;return e.ellipse(this.point.x,this.point.y,.5*this.h,this.h,angle,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="brown",1==this.fb&&this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MetallicForeignBodyCrossSection.prototype.defineBezier=function(t){var e=this.originX,i=this.drawing.lastDoodleOfClass("CorneaCrossSection"),r=(i.pachymetry,(this.originY+380)/760),a=new Object;this.originY<0?(i&&"Keratoconus"==i.shape?(a.SP=new ED.Point(-120-this.originX,-380-this.originY),a.CP1=new ED.Point(-240-this.originX,-260-this.originY),a.CP2=new ED.Point(i.apexX-this.originX,i.apexY-100-this.originY),a.EP=new ED.Point(i.apexX-this.originX,i.apexY-this.originY)):i&&"Keratoglobus"==i.shape?(a.SP=new ED.Point(-120-this.originX,-380-this.originY),a.CP1=new ED.Point(-240-this.originX,-260-this.originY),a.CP2=new ED.Point(-380-this.originX,-100-this.originY),a.EP=new ED.Point(-380-this.originX,100-this.originY)):(a.SP=new ED.Point(-120-this.originX+50,-380-this.originY),a.CP1=new ED.Point(-240-this.originX+50,-260-this.originY),a.CP2=new ED.Point(-320-this.originX+50,-160-this.originY),a.EP=new ED.Point(-320-this.originX+50,0-this.originY)),r*=2):(i&&"Keratoconus"==i.shape?(a.SP=new ED.Point(i.apexX-this.originX,i.apexY-this.originY),a.CP1=new ED.Point(i.apexX-this.originX,i.apexY+100-this.originY),a.CP2=new ED.Point(-240-this.originX,260-this.originY),a.EP=new ED.Point(-120-this.originX,380-this.originY)):i&&"Keratoglobus"==i.shape?(a.SP=new ED.Point(-380-this.originX-50,100-this.originY),a.CP1=new ED.Point(-380-this.originX-50,200-this.originY),a.CP2=new ED.Point(-240-this.originX-50,360-this.originY),a.EP=new ED.Point(-120-this.originX-50,380-this.originY)):(a.SP=new ED.Point(-320-this.originX+50,-0-this.originY),a.CP1=new ED.Point(-320-this.originX+50,160-this.originY),a.CP2=new ED.Point(-240-this.originX+50,260-this.originY),a.EP=new ED.Point(-120-this.originX+50,380-this.originY)),r=2*(r-.5)),this.point.x=e+(1-r)*(1-r)*(1-r)*a.SP.x+3*(1-r)*(1-r)*r*a.CP1.x+3*(1-r)*r*r*a.CP2.x+r*r*r*a.EP.x,this.point.y=(1-r)*(1-r)*(1-r)*a.SP.y+3*(1-r)*(1-r)*r*a.CP1.y+3*(1-r)*r*r*a.CP2.y+r*r*r*a.EP.y},ED.Microaneurysm=function(t,e){this.className="Microaneurysm",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.Microaneurysm.prototype=new ED.Doodle,ED.Microaneurysm.prototype.constructor=ED.Microaneurysm,ED.Microaneurysm.superclass=ED.Doodle.prototype,ED.Microaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.Microaneurysm.prototype.draw=function(t){var e=this.drawing.context;ED.Microaneurysm.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,14,0,2*Math.PI,!0),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.isClicked},ED.Microaneurysm.prototype.groupDescription=function(){return"Microaneurysms"},ED.MultifocalChoroiditis=function(t,e){this.className="MultifocalChoroiditis",ED.Doodle.call(this,t,e)},ED.MultifocalChoroiditis.prototype=new ED.Doodle,ED.MultifocalChoroiditis.prototype.constructor=ED.MultifocalChoroiditis,ED.MultifocalChoroiditis.superclass=ED.Doodle.prototype,ED.MultifocalChoroiditis.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.MultifocalChoroiditis.prototype.draw=function(t){var e=this.drawing.context;ED.MultifocalChoroiditis.superclass.draw.call(this,t),e.beginPath();if(e.arc(0,0,480,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 0, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var i=0;i<12;i++)for(var r=2*i*Math.PI/12,a=0;a<3;a++){var o=432*(.5+a)/3,n=new ED.Point(0,0);n.setWithPolars(o,r);var s=80*(ED.randomArray[i+a]-.5),l=80*(ED.randomArray[36+i+a]-.5);this.drawCircle(e,n.x+s,n.y+l,15,"Yellow",3,"rgba(255, 128, 0, 1)")}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.MultifocalChoroiditis.prototype.description=function(){return"Panretinal photocoagulation"},ED.Needle=function(t,e){this.className="Needle",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.Needle.prototype=new ED.Doodle,ED.Needle.prototype.constructor=ED.Needle,ED.Needle.superclass=ED.Doodle.prototype,ED.Needle.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.Needle.prototype.setPropertyDefaults=function(){},ED.Needle.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.5},ED.Needle.prototype.draw=function(t){var e=this.drawing.context;ED.Needle.superclass.draw.call(this,t),e.beginPath();var i=-250;if(e.moveTo(-80,i),e.lineTo(80,i),e.lineTo(70,-220),e.lineTo(50,-10),e.lineTo(20,10),e.lineTo(-20,10),e.lineTo(-50,-10),e.lineTo(-70,-220),e.closePath(),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 1)",e.fillStyle="rgba(255, 127, 0, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-70,-220),e.lineTo(70,-220),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(-60,-120),e.lineTo(60,-120),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.stroke(),e.beginPath(),e.moveTo(0,-120),e.lineTo(0,-20),e.lineWidth=32,e.strokeStyle="rgba(120, 120, 120, 0.2)",e.stroke(),e.beginPath(),e.moveTo(50,-10),e.lineTo(20,10),e.lineTo(-20,10),e.lineTo(-50,-10),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 1)",e.strokeStyle="rgba(0, 0, 0, 0.5)",e.fill(),e.stroke(),e.beginPath(),e.moveTo(-10,10),e.lineTo(10,10),e.lineTo(10,280),e.lineTo(-10,250),e.closePath(),e.fillStyle="rgba(120, 120, 120, 1)",e.fill()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(0,i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Needle.prototype.description=function(){return"Needle"},ED.NerveFibreDefect=function(t,e){this.className="NerveFibreDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.NerveFibreDefect.prototype=new ED.Doodle,ED.NerveFibreDefect.prototype.constructor=ED.NerveFibreDefect,ED.NerveFibreDefect.superclass=ED.Doodle.prototype,ED.NerveFibreDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NerveFibreDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-560,-400)},ED.NerveFibreDefect.prototype.setParameterDefaults=function(){this.arc=20*Math.PI/180,this.apexY=-460,this.setRotationWithDisplacements(150,-120)},ED.NerveFibreDefect.prototype.draw=function(t){var e=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,t);var i=-this.apexY,r=360+(i-360)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=r*Math.sin(a),l=-r*Math.cos(a),h=-r*Math.sin(a),d=l;return e.beginPath(),e.arc(0,0,i,o,n,!0),e.arc(0,0,360,n,o,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200, 200, 200, 0.75)",e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NerveFibreDefect.prototype.groupDescription=function(){return"Nerve fibre layer defect at "},ED.NerveFibreDefect.prototype.description=function(){return this.clockHour()+" o'clock"},ED.NuclearCataract=function(t,e){this.className="NuclearCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.NuclearCataract.prototype=new ED.Doodle,ED.NuclearCataract.prototype.constructor=ED.NuclearCataract,ED.NuclearCataract.superclass=ED.Doodle.prototype,ED.NuclearCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens","PostSubcapCataract"],this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-120,0),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.NuclearCataract.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.grade=e<-80?"Mild":e<-40?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":i.apexY=-120;break;case"Moderate":i.apexY=-80;break;case"Brunescent":i.apexY=0}}return i},ED.NuclearCataract.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,200,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var i="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",r=e.createRadialGradient(0,0,210,0,0,50);return r.addColorStop(0,yellowColour),r.addColorStop(1,i),e.fillStyle=r,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.NuclearCataract.prototype.description=function(){return this.getParameter("grade")+" nuclear cataract"},ED.NuclearCataract.prototype.snomedCode=function(){return 53889007},ED.NuclearCataract.prototype.diagnosticHierarchy=function(){return 0},ED.NuclearCataractCrossSection=function(t,e){this.className="NuclearCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.NuclearCataractCrossSection.prototype=new ED.Doodle,ED.NuclearCataractCrossSection.prototype.constructor=ED.NuclearCataractCrossSection,ED.NuclearCataractCrossSection.superclass=ED.Doodle.prototype,ED.NuclearCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(100,100),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataractCrossSection.prototype.setParameterDefaults=function(){this.apexX=100,this.originX=44,this.setParameterFromString("grade","Mild")},ED.NuclearCataractCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.grade=e<-80?"Mild":e<-40?"Moderate":"Brunescent";break;case"grade":switch(e){case"Mild":i.apexY=-120;break;case"Moderate":i.apexY=-80;break;case"Brunescent":i.apexY=0}}return i},ED.NuclearCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.NuclearCataractCrossSection.superclass.draw.call(this,t);var i=Math.asin(.8),r=300*Math.cos(i),a=Math.acos(r/240);e.beginPath(),e.arc(100-r,0,240,a,-a,!0),e.arc(100+r,0,240,Math.PI+a,Math.PI-a,!0),e.stroke(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var o="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",n=e.createRadialGradient(100,0,210,100,0,50);return n.addColorStop(0,yellowColour),n.addColorStop(1,o),e.fillStyle=n,e.strokeStyle="rgba(0,0,0,1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDisc=function(t,e){this.className="OpticDisc",this.numberOfHandles=8,this.mode="Basic",this.cdRatio="Not checked",this.savedParameterArray=["apexY","mode","cdRatio"],ED.Doodle.call(this,t,e)},ED.OpticDisc.prototype=new ED.Doodle,ED.OpticDisc.prototype.constructor=ED.OpticDisc,ED.OpticDisc.superclass=ED.Doodle.prototype,ED.OpticDisc.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.OpticDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.parameterValidationArray.radius.range.setMinAndMax(50,290),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1},this.parameterValidationArray.cdRatio={kind:"derived",type:"string",list:["Not checked","0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0","No view"],animate:!0},this.handleVectorRangeArray=[];for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i={};i.length=new ED.Range(50,290),i.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=i}},ED.OpticDisc.prototype.setParameterDefaults=function(){this.apexY=-150;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=0;e<this.numberOfHandles;e++){var i=new ED.Point(0,0);i.setWithPolars(-this.apexY,2*e*Math.PI/this.numberOfHandles),this.addPointToSquiggle(i)}this.setParameterFromString("mode","Basic"),this.setParameterFromString("cdRatio","Not checked")},ED.OpticDisc.prototype.dependentParameterValues=function(t,e){var i,r=[];switch(t){case"mode":this.setHandleProperties(),"Expert"===e?this.drawing.isReady&&this.setMeanRadius(-this.apexY):this.drawing.isReady&&this.resetHandles();break;case"apexY":if("Not checked"===this.cdRatio){r.cdRatio=(-.001).toFixed(1);break}r.cdRatio=e<-300?"No view":(-e/300).toFixed(1);break;case"cdRatio":"Not checked"===e?r.apexY=-300*parseFloat("0.3"):"No view"!==e?(i=300*parseFloat(e),r.apexY=-i):r.apexY=-320;break;case"handles":var a=0;a+=this.squiggleArray[0].pointsArray[0].length(),a+=this.squiggleArray[0].pointsArray[this.numberOfHandles/2].length(),r.apexY=-Math.round(a/2);var o=Math.round(10*a/600)/10;r.cdRatio=o.toFixed(1)}return r},ED.OpticDisc.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDisc.superclass.draw.call(this,t);var i=-this.apexY,r=2*Math.PI;if(e.beginPath(),e.arc(0,0,300,0,r,!0),e.closePath(),e.lineWidth=2,e.fillStyle=e.createPattern(this.drawing.imageArray.CribriformPattern,"repeat"),e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode===ED.drawFunctionMode.Draw){if(e.beginPath(),e.arc(0,0,300,0,r,!0),"Basic"===this.mode)e.moveTo(i,0),e.arc(0,0,i,r,0,!1);else{var a,o,n,s,l=2*Math.PI/(3*this.numberOfHandles);e.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){a=this.squiggleArray[0].pointsArray[h];var d=h<this.numberOfHandles-1?h+1:0;o=this.squiggleArray[0].pointsArray[d],n=a.tangentialControlPoint(+l),s=o.tangentialControlPoint(-l),e.bezierCurveTo(n.x,n.y,s.x,s.y,o.x,o.y)}}e.closePath();var c,p=new ED.Colour(0,0,0,1);p.setWithHexString("FFA83C"),e.fillStyle=p.rgba(),e.fill(),e.beginPath(),c=this.drawing.eye===ED.eye.Right?-1:1;var y=new ED.Point(0,0);y.setWithPolars(150,-c*Math.PI/2);var D=new ED.Point(0,0);D.setWithPolars(400,-c*Math.PI/8);var u=new ED.Point(0,0);u.setWithPolars(450,c*Math.PI/8);var g=new ED.Point(0,0);g.setWithPolars(500,c*Math.PI/4),e.moveTo(y.x,y.y),e.bezierCurveTo(D.x,D.y,u.x,u.y,g.x,g.y),(y=new ED.Point(0,0)).setWithPolars(150,-c*Math.PI/2),(D=new ED.Point(0,0)).setWithPolars(400,7*-c*Math.PI/8),(u=new ED.Point(0,0)).setWithPolars(450,7*c*Math.PI/8),(g=new ED.Point(0,0)).setWithPolars(500,3*c*Math.PI/4),e.moveTo(y.x,y.y),e.bezierCurveTo(D.x,D.y,u.x,u.y,g.x,g.y),(y=new ED.Point(0,0)).setWithPolars(150,-c*Math.PI/2),(D=new ED.Point(0,0)).setWithPolars(300,2*-c*Math.PI/8),(u=new ED.Point(0,0)).setWithPolars(350,5*-c*Math.PI/16),(g=new ED.Point(0,0)).setWithPolars(450,3*-c*Math.PI/8),e.moveTo(y.x,y.y),e.bezierCurveTo(D.x,D.y,u.x,u.y,g.x,g.y),(y=new ED.Point(0,0)).setWithPolars(150,-c*Math.PI/2),(D=new ED.Point(0,0)).setWithPolars(300,6*-c*Math.PI/8),(u=new ED.Point(0,0)).setWithPolars(350,11*-c*Math.PI/16),(g=new ED.Point(0,0)).setWithPolars(450,5*-c*Math.PI/8),e.moveTo(y.x,y.y),e.bezierCurveTo(D.x,D.y,u.x,u.y,g.x,g.y),e.lineWidth=48,e.lineCap="round",e.strokeStyle="rgba(255, 0, 0, 0.5)",e.stroke(),"No view"===this.cdRatio&&(e.beginPath(),e.arc(0,0,400,0,2*Math.PI,!0),e.closePath(),e.fillStyle="gray",e.fill())}if("Expert"===this.mode)for(var P=0;P<this.numberOfHandles;P++)this.handleArray[P].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[P]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDisc.prototype.description=function(){var t="";if("Expert"===this.mode){for(var e,i=this.getMeanRadius(),r=[],a=!1,o=0,n=0;n<this.numberOfHandles;n++)if(this.squiggleArray[0].pointsArray[n].length()<1.1*i){o=n;break}for(var s=0;s<this.numberOfHandles;s++){var l=(s+o)%this.numberOfHandles;this.squiggleArray[0].pointsArray[l].length()>1.1*i?a?e.endHour=this.squiggleArray[0].pointsArray[l].clockHour():((e={}).startHour=this.squiggleArray[0].pointsArray[l].clockHour(),e.endHour=this.squiggleArray[0].pointsArray[l].clockHour(),a=!0):a&&(r.push(e),a=!1),s===this.numberOfHandles-1&&a&&(e.endHour=this.squiggleArray[0].pointsArray[l].clockHour(),r.push(e),a=!1)}if(r.length>0){var h=r.length>1;t=h?"Notches":"Notch";for(var d=0;d<r.length;d++)r[d].startHour===r[d].endHour?t+=" at "+r[d].startHour:t+=" from "+r[d].startHour+" to "+r[d].endHour+" o'clock",h&&d!==r.length-1&&(t+=", and")}else t=1===this.drawing.doodleArray.length?"No abnormality":""}else"No view"===this.cdRatio&&(t="No view"),0===t.length&&1===this.drawing.doodleArray.length&&(t="No abnormality");return t},ED.OpticDisc.prototype.setHandleProperties=function(){if("Basic"===this.mode){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t].isVisible=!1;this.handleArray[this.numberOfHandles].isVisible=!0}else{for(var e=0;e<this.numberOfHandles;e++)this.handleArray[e].isVisible=!0;this.handleArray[this.numberOfHandles].isVisible=!1}},ED.OpticDisc.prototype.minimumRadius=function(){var t=500;if("Basic"===this.mode)t=Math.abs(this.apexY);else for(var e=0;e<this.numberOfHandles;e++){var i=this.squiggleArray[0].pointsArray[e].length();i<t&&(t=i)}return t},ED.OpticDisc.prototype.getMeanRadius=function(){if(void 0!==this.squiggleArray[0]){for(var t=0,e=0;e<this.numberOfHandles;e++)t+=this.squiggleArray[0].pointsArray[e].length();return t/this.numberOfHandles}return-this.apexY},ED.OpticDisc.prototype.setMeanRadius=function(t){for(var e=this.getMeanRadius(),i=0;i<this.numberOfHandles;i++){var r=this.squiggleArray[0].pointsArray[i].length(),a=this.squiggleArray[0].pointsArray[i].direction(),o=r*t/e;o=o>300?300:o,this.squiggleArray[0].pointsArray[i].setWithPolars(o,a)}},ED.OpticDisc.prototype.resetHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.squiggleArray[0].pointsArray[t].setWithPolars(-this.apexY,2*t*Math.PI/this.numberOfHandles)},ED.OpticDiscPit=function(t,e){this.className="OpticDiscPit",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.OpticDiscPit.prototype=new ED.Doodle,ED.OpticDiscPit.prototype.constructor=ED.OpticDiscPit,ED.OpticDiscPit.superclass=ED.Doodle.prototype,ED.OpticDiscPit.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.OpticDiscPit.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.originX.range.setMinAndMax(-200,200),this.parameterValidationArray.originY.range.setMinAndMax(-240,240),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.OpticDiscPit.prototype.setParameterDefaults=function(){this.originX=0,this.originY=220,this.apexY=0,this.scaleX=1.5,this.drawing.lastDoodleOfClass(this.className)&&(1==this.drawing.numberOfDoodlesOfClass(this.className)?this.originY=-220:this.setOriginWithDisplacements(-60,-60))},ED.OpticDiscPit.prototype.draw=function(t){var e=this.drawing.context;ED.OpticDiscPit.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,80,0,2*Math.PI,!0),e.closePath();var i=e.createRadialGradient(0,0,80,0,0,10);return i.addColorStop(0,"rgba(100, 100, 100, 0.75)"),i.addColorStop(1,"rgba(200, 200, 200, 0.75)"),e.fillStyle=i,e.lineWidth=2,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(55,-55)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OpticDiscPit.prototype.description=function(){return"Acquired pit of optic nerve"},ED.OuterLeafBreak=function(t,e){this.className="OuterLeafBreak",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.OuterLeafBreak.prototype=new ED.Doodle,ED.OuterLeafBreak.prototype.constructor=ED.OuterLeafBreak,ED.OuterLeafBreak.superclass=ED.Doodle.prototype,ED.OuterLeafBreak.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.OuterLeafBreak.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!1,this.rangeOfScale=new ED.Range(.5,4),this.rangeOfArc=new ED.Range(Math.PI/6,2*Math.PI),this.rangeOfApexX=new ED.Range(-0,0),this.rangeOfApexY=new ED.Range(-40,30)},ED.OuterLeafBreak.prototype.setParameterDefaults=function(){this.originX=-230,this.originY=290},ED.OuterLeafBreak.prototype.draw=function(t){var e=this.drawing.context;ED.OuterLeafBreak.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,60,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 140, 140, 0.75)",e.strokeStyle="rgba(0, 255, 255, 0.75)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(41,-41)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var i=this.transform.transformPoint(new ED.Point(0,0)),r=this.transform.transformPoint(new ED.Point(60,0)),a=i.x-this.drawing.canvas.width/2,o=i.y-this.drawing.canvas.height/2,n=this.scaleX*Math.sqrt(a*a+o*o),s=this.scaleX*(r.x-i.x);return this.arc=Math.atan(s/n),this.isClicked},ED.OuterLeafBreak.prototype.description=function(){var t="";return this.scaleX<1&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="outer leaf break ",t+=this.clockHour()+" o'clock"},ED.PalpebralConjunctivitis=function(t,e){this.className="PalpebralConjunctivitis",this.type="Papillary",this.hyperaemia="+",this.savedParameterArray=["type","hyperaemia"],this.controlParameterArray={type:"Type",hyperaemia:"Hyperaemia"},ED.Doodle.call(this,t,e)},ED.PalpebralConjunctivitis.prototype=new ED.Doodle,ED.PalpebralConjunctivitis.prototype.constructor=ED.PalpebralConjunctivitis,ED.PalpebralConjunctivitis.superclass=ED.Doodle.prototype,ED.PalpebralConjunctivitis.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1,this.addAtBack=!0,this.parameterValidationArray.type={kind:"other",type:"string",list:["Papillary","Follicular"],animate:!1},this.parameterValidationArray.hyperaemia={kind:"other",type:"string",list:["+","++","+++"],animate:!1}},ED.PalpebralConjunctivitis.prototype.setParameterDefaults=function(){},ED.PalpebralConjunctivitis.prototype.draw=function(t){var e=this.drawing.context;ED.PalpebralConjunctivitis.superclass.draw.call(this,t);var i=480,r=-220,a=Math.asin(r/i),o=i*Math.cos(a);e.moveTo(-o,-110),e.arc(0,110,i,a,Math.PI-a,!0),e.lineTo(-o,-110),e.moveTo(-o,110),e.arc(0,-110,i,-a,Math.PI+a,!1),e.lineTo(-o,110),e.stroke(),e.lineWidth=4;var n=e.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return e.fillStyle=n,e.strokeStyle="pink","+"==this.hyperaemia?e.filter="opacity(10%)":"++"==this.hyperaemia?e.filter="opacity(30%)":"+++"==this.hyperaemia&&(e.filter="opacity(50%)"),this.drawBoundary(t),e.filter="none",this.isClicked};ED.PalpebralConjunctivitis.prototype.description=function(){var t=this.type+" conjunctivitis";return t+=" with "+this.hyperaemia+" hyperaemia"},ED.Papilloedema=function(t,e){this.className="Papilloedema",ED.Doodle.call(this,t,e)},ED.Papilloedema.prototype=new ED.Doodle,ED.Papilloedema.prototype.constructor=ED.Papilloedema,ED.Papilloedema.superclass=ED.Doodle.prototype,ED.Papilloedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.Papilloedema.prototype.draw=function(t){var e=this.drawing.context;ED.Papilloedema.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,450,0,2*Math.PI,!0),e.arc(0,0,300,2*Math.PI,0,!1),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var i=e.createRadialGradient(0,0,450,0,0,300);return i.addColorStop(0,yellowColour),i.addColorStop(1,"rgba(240, 140, 40, 0.75)"),e.fillStyle=i,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.isClicked},ED.Papilloedema.prototype.description=function(){return"Papilloedema"},ED.Patch=function(t,e){this.className="Patch",this.material="Sclera",this.savedParameterArray=["originX","originY","width","height","apexX","material"],this.controlParameterArray={material:"Material"},ED.Doodle.call(this,t,e)},ED.Patch.prototype=new ED.Doodle,ED.Patch.prototype.constructor=ED.Patch,ED.Patch.superclass=ED.Doodle.prototype,ED.Patch.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Size,!1)},ED.Patch.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.material={kind:"other",type:"string",list:["Sclera","Tenons","Tutoplast","Cornea"],list:["Sclera","Tenons","Tutoplast","Cornea"],animate:!1}},ED.Patch.prototype.setParameterDefaults=function(){var t;if(this.width=200,this.height=200,this.setParameterFromString("material","Sclera"),t=this.drawing.lastDoodleOfClass("Tube")){var e=this.drawing.eye==ED.eye.Right;switch(t.platePosition){case"STQ":this.originX=e?-350:350,this.originY=-350,this.rotation=(e?7:1)*Math.PI/4;break;case"SNQ":this.originX=e?350:-350,this.originY=-350,this.rotation=(e?1:7)*Math.PI/4;break;case"INQ":this.originX=e?350:-350,this.originY=350,this.rotation=(e?3:5)*Math.PI/4;break;case"ITQ":this.originX=e?-350:350,this.originY=350,this.rotation=(e?5:3)*Math.PI/4}}(t=this.drawing.lastDoodleOfClass("TrabyFlap"))&&(this.originY=-360,this.width=488,this.height=228)},ED.Patch.prototype.draw=function(t){var e=this.drawing.context;switch(ED.Patch.superclass.draw.call(this,t),e.beginPath(),e.rect(-this.width/2,-this.height/2,this.width,this.height),e.closePath(),this.material){case"Sclera":e.fillStyle="rgba(200,200,50,0.5)";break;case"Cornea":e.fillStyle="rgba(180,180,180,0.5)";break;case"Tenons":e.fillStyle="rgba(200,200,200,0.5)";break;case"Tutoplast":e.fillStyle="rgba(230,230,230,0.5)"}if(e.strokeStyle="rgba(120,120,120,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=this.width/2,r=this.height/2-10;this.drawSpot(e,-i,-r,5,"blue"),this.drawSpot(e,-i,r,5,"blue"),this.drawSpot(e,i,-r,5,"blue"),this.drawSpot(e,i,r,5,"blue")}return this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.width/2,-this.height/2)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Patch.prototype.description=function(){return this.material+" patch"},ED.PCIOL=function(t,e){this.className="PCIOL",this.classGroupUnique="Lens",this.fixation="In-the-bag",this.fx=1,this.csOriginX=0,this.savedParameterArray=["fixation","fx","originX","originY","rotation","csOriginX"],this.controlParameterArray={fixation:"Fixation"},ED.Doodle.call(this,t,e),this.scaleX=.75,this.scaleY=.75},ED.PCIOL.prototype=new ED.Doodle,ED.PCIOL.prototype.constructor=ED.PCIOL,ED.PCIOL.superclass=ED.Doodle.prototype,ED.PCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.PCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isUnique=!0,this.parameterValidationArray.fixation={kind:"derived",type:"string",list:["In-the-bag","Ciliary sulcus","Partly in the bag"],animate:!0},this.parameterValidationArray.fx={kind:"other",type:"int",range:new ED.Range(1,8),animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-200,200),this.parameterValidationArray.originY.range.setMinAndMax(-200,200)},ED.PCIOL.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"fx":1===e&&(i.fixation="In-the-bag"),2===e&&(i.fixation="Partly in the bag"),3===e&&(i.fixation="Ciliary sulcus");break;case"fixation":switch(e){case"In-the-bag":this.setParameterFromString("fx","1",!0);break;case"Partly in the bag":this.setParameterFromString("fx","2",!0);break;case"Ciliary sulcus":this.setParameterFromString("fx","3",!0)}}return i},ED.PCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.PCIOL.superclass.draw.call(this,t),e.beginPath();e.arc(0,0,240,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(240,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCIOL.prototype.description=function(){var t="Posterior chamber IOL";t+=" ("+this.fixation+" fixation)";var e="";return this.originY<-40&&(e.length>0&&(e+=" and"),e+=" superiorly"),this.originY>40&&(e.length>0&&(e+=" and"),e+=" inferiorly"),this.originX<-40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>40&&(e.length>0&&(e+=" and"),e+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),e.length>0&&(t+=" displaced"+e),t},ED.PCIOLCrossSection=function(t,e){this.className="PCIOLCrossSection",this.fixation="In-the-bag",this.fx=1,this.savedParameterArray=["fixation","fx","originX","originY"],this.controlParameterArray={fixation:"Fixation"},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={PCIOL:{source:["fixation","fx","originY"],store:[["originX","csOriginX"]]}}},ED.PCIOLCrossSection.prototype=new ED.Doodle,ED.PCIOLCrossSection.prototype.constructor=ED.PCIOLCrossSection,ED.PCIOLCrossSection.superclass=ED.Doodle.prototype,ED.PCIOLCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.inFrontOfClassArray=["HypopyonCrossSection","HyphaemaCrossSection"],this.addAtBack=!0,this.parameterValidationArray.fixation={kind:"derived",type:"string",list:["In-the-bag","Ciliary sulcus","Partly in the bag"],animate:!0},this.parameterValidationArray.fx={kind:"other",type:"int",range:new ED.Range(1,3),animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-150,44),this.parameterValidationArray.originY.range.setMinAndMax(-140,140)},ED.PCIOLCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.PCIOLCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"fx":1===e&&(i.fixation="In-the-bag"),2===e&&(i.fixation="Partly in the bag"),3===e&&(i.fixation="Ciliary sulcus");break;case"fixation":switch(e){case"In-the-bag":this.setParameterFromString("fx","1",!0);break;case"Partly in the bag":this.setParameterFromString("fx","2",!0);break;case"Ciliary sulcus":this.setParameterFromString("fx","3",!0)}break;case"originX":var r=this.drawing.lastDoodleOfClass("AntSegCrossSection");if(r){var a=r.parameterValidationArray.apexX.range.min,o=32-72/220*(r.apexY+280)+this.originX;if(o<a&&(o=a),r.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(r.apexY+280),o),this.drawing.isActive)n=r.parameterValidationArray.apexX.range.constrain(r.apexX);else var n=r.parameterValidationArray.apexX.range.max;r.setSimpleParameter("apexX",n)}}return i},ED.PCIOLCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.PCIOLCrossSection.superclass.draw.call(this,t);var i=450,r=Math.asin(240/i),a=i*Math.cos(r);Math.acos(a/390);if(e.beginPath(),"In-the-bag"==this.fixation?e.ellipse(100,0,160,20,.5*Math.PI,0,2*Math.PI):e.ellipse(50,0,160,25,.5*Math.PI,0,2*Math.PI),e.lineWidth=5,e.fillStyle="rgba(255, 255, 255, 0.75)",e.strokeStyle="#898989",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var o="In-the-bag"==this.fixation?0:this.originX-44;e.beginPath(),e.arc(100-a-o,0-this.originY,i,r,-r,!0),e.arc(100+a-o,0-this.originY,i,Math.PI+r,Math.PI+.75*r,!0),e.moveTo(100-o,240-this.originY),e.arc(100+a-o,0-this.originY,i,Math.PI-r,Math.PI-.75*r,!1),e.strokeStyle="gray",e.lineWidth=3,e.stroke(),e.beginPath(),"In-the-bag"==this.fixation?(e.ellipse(100,0-this.originY,227,20,.5*Math.PI,.5*Math.PI,1.2*Math.PI),e.moveTo(120,0-this.originY),e.ellipse(100,0-this.originY,227,20,.5*Math.PI,1.5*Math.PI,.2*Math.PI)):"Ciliary sulcus"==this.fixation?(e.arc(115-this.originX,-350-this.originY,15,0*Math.PI,1*Math.PI,!0),e.lineTo(35,-125),e.moveTo(120-this.originX,350-this.originY),e.arc(115-this.originX,350-this.originY,15,0,1*Math.PI,!1),e.moveTo(100-this.originX,350-this.originY),e.lineTo(65,125)):(e.ellipse(144-this.originX,0-this.originY,227,20,.5*Math.PI,.9*Math.PI,1.2*Math.PI),e.moveTo(144-this.originX,-227-this.originY),e.lineTo(50,-160),e.moveTo(120-this.originX,350-this.originY),e.arc(115-this.originX,350-this.originY,15,0,1*Math.PI,!1),e.moveTo(100-this.originX,350-this.originY),e.lineTo(65,125)),e.strokeStyle="#898989",e.lineWidth=5,e.stroke(),e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(80-o,-207-this.originY),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(120-o,-207-this.originY),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(80-o,-207-this.originY),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(120-o,-207-this.originY),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(80-o,207-this.originY),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(120-o,207-this.originY),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(80-o,207-this.originY),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(120-o,207-this.originY),e.lineWidth=2,e.strokeStyle="gray",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCV=function(t,e){this.className="PCV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.PCV.prototype=new ED.Doodle,ED.PCV.prototype.constructor=ED.PCV,ED.PCV.superclass=ED.Doodle.prototype,ED.PCV.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.PCV.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.2),this.parameterValidationArray.originY.range.setMinAndMax(-200,200),this.parameterValidationArray.originX.range.setMinAndMax(-200,200)},ED.PCV.prototype.setParameterDefaults=function(){this.scaleY=.5,this.scaleX=.5},ED.PCV.prototype.dependentParameterValues=function(t,e){var i=175;switch(t){case"scaleX":case"scaleY":this.parameterValidationArray.originX.range.setMinAndMax(i*e-300,300-i*e),this.parameterValidationArray.originY.range.setMinAndMax(i*e-300,300-i*e);var r=this.parameterValidationArray.originY.range.constrain(this.originY),a=this.parameterValidationArray.originX.range.constrain(this.originX);this.setSimpleParameter("originX",a),this.setSimpleParameter("originY",r)}return[]},ED.PCV.prototype.draw=function(t){var e=this.drawing.context;ED.PCV.superclass.draw.call(this,t),e.beginPath();if(e.arc(0,0,200,0,2*Math.PI,!0),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",e.closePath(),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var i=Math.PI/180,r=[33,64,121,153,200,232,305,338];e.beginPath();for(var a=0;a<8;a++){var o=new ED.Point(0,0);o.setWithPolars(155,i*r[a]),this.drawSpot(e,o.x,o.y,20,"rgba(188, 25, 0, 1)"),e.moveTo(0,0),e.bezierCurveTo(0,0,0,0,o.x,o.y),e.lineWidth=5,e.strokeStyle="rgba(188, 25, 0, 1)",e.stroke()}e.closePath(),e.beginPath(),e.fillStyle="rgba(188, 25, 0, 1)",e.ellipse(0,0,85,70,0,0,360),e.fill()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(140,-140)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PCV.prototype.description=function(){return"Polypoidal choroidal vasculopathy"},ED.PCV.prototype.snomedCode=function(){return 313001006},ED.PeripapillaryAtrophy=function(t,e){this.className="PeripapillaryAtrophy",this.outerRadius=340,this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.PeripapillaryAtrophy.prototype=new ED.Doodle,ED.PeripapillaryAtrophy.prototype.constructor=ED.PeripapillaryAtrophy,ED.PeripapillaryAtrophy.superclass=ED.Doodle.prototype,ED.PeripapillaryAtrophy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.PeripapillaryAtrophy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.rotation.range.setMinAndMax(7*Math.PI/4,Math.PI/4),this.handleCoordinateRangeArray=new Array;var t=1.4*this.outerRadius,e=this.outerRadius;this.handleCoordinateRangeArray[0]={x:new ED.Range(-t,-e),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[1]={x:new ED.Range(-0,0),y:new ED.Range(-t,-e)},this.handleCoordinateRangeArray[2]={x:new ED.Range(e,t),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[3]={x:new ED.Range(-0,0),y:new ED.Range(e,t)}},ED.PeripapillaryAtrophy.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t),this.addPointToSquiggle(new ED.Point(-this.outerRadius-(this.drawing.eye==ED.eye.Right?100:0),0)),this.addPointToSquiggle(new ED.Point(0,-this.outerRadius)),this.addPointToSquiggle(new ED.Point(this.outerRadius+(this.drawing.eye==ED.eye.Right?0:100),0)),this.addPointToSquiggle(new ED.Point(0,this.outerRadius))},ED.PeripapillaryAtrophy.prototype.draw=function(t){var e=this.drawing.context;ED.PeripapillaryAtrophy.superclass.draw.call(this,t),e.beginPath();var i,r,a,o,n=.55;i=this.squiggleArray[0].pointsArray[0].x,r=this.squiggleArray[0].pointsArray[0].y,a=this.squiggleArray[0].pointsArray[1].x,o=this.squiggleArray[0].pointsArray[1].y,e.moveTo(i,r),e.bezierCurveTo(i,i*n,o*n,o,a,o),i=a,r=o,a=this.squiggleArray[0].pointsArray[2].x,o=this.squiggleArray[0].pointsArray[2].y,e.bezierCurveTo(-r*n,r,a,-a*n,a,o),i=a,r=o,a=this.squiggleArray[0].pointsArray[3].x,o=this.squiggleArray[0].pointsArray[3].y,e.bezierCurveTo(i,i*n,o*n,o,a,o),i=a,r=o,a=this.squiggleArray[0].pointsArray[0].x,o=this.squiggleArray[0].pointsArray[0].y,e.bezierCurveTo(-r*n,r,a,-a*n,a,o),e.moveTo(280,0),e.arc(0,0,280,0,2*Math.PI,!0),e.closePath(),e.lineWidth=2;var s=new ED.Colour(0,0,0,1);return s.setWithHexString("DFD989"),e.fillStyle=s.rgba(),e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.handleArray[1].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[1]),this.handleArray[2].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[2]),this.handleArray[3].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[3]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripapillaryAtrophy.prototype.description=function(){var t="",e=-this.squiggleArray[0].pointsArray[0].x,i=-this.squiggleArray[0].pointsArray[1].y,r=this.squiggleArray[0].pointsArray[2].x,a=this.squiggleArray[0].pointsArray[3].y,o="",n=this.radius;if(e>n&&(n=e,o=this.drawing.eye==ED.eye.Right?"temporally":"nasally"),i>n&&(n=i,o="superiorly"),r>n&&(n=r,o=this.drawing.eye==ED.eye.Right?"nasally":"temporally"),a>n&&(n=a,o="inferiorly"),n>this.radius){var s="Mild";n>350&&(s="Moderate"),n>400&&(s="Significant"),t+=s,t+=" peri-papillary atrophy, maximum ",t+=o}return t},ED.PeripheralRetinectomy=function(t,e){this.className="PeripheralRetinectomy",this.extent="",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PeripheralRetinectomy.prototype=new ED.Doodle,ED.PeripheralRetinectomy.prototype.constructor=ED.PeripheralRetinectomy,ED.PeripheralRetinectomy.superclass=ED.Doodle.prototype,ED.PeripheralRetinectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRetinectomy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-350)},ED.PeripheralRetinectomy.prototype.setParameterDefaults=function(){this.arc=240*Math.PI/180,this.apexY=-380;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/4:Math.PI},ED.PeripheralRetinectomy.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralRetinectomy.superclass.draw.call(this,t);var i=-this.apexY,r=i+(476-i)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=r*Math.sin(a),l=-r*Math.cos(a),h=-r*Math.sin(a),d=l;if(e.beginPath(),e.arc(0,0,476,o,n,!0),e.arc(0,0,i,n,o,!1),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,0,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),this.arc<1.95*Math.PI){var c=a-Math.PI/24,p=a-2*Math.PI/24,y=new ED.Point(476*Math.sin(a),-476*Math.cos(a)),D=new ED.Point(r*Math.sin(a),-r*Math.cos(a)),u=new ED.Point(i*Math.sin(c),-i*Math.cos(c)),g=new ED.Point(i*Math.sin(p),-i*Math.cos(p));o=-Math.PI/2+p,n=-Math.PI/2-p;new ED.Point(-i*Math.sin(p),-i*Math.cos(p));var P=new ED.Point(-i*Math.sin(c),-i*Math.cos(c)),E=new ED.Point(-r*Math.sin(a),-r*Math.cos(a)),m=new ED.Point(-476*Math.sin(a),-476*Math.cos(a));e.moveTo(y.x,y.y),e.bezierCurveTo(D.x,D.y,u.x,u.y,g.x,g.y),e.arc(0,0,i,o,n,!0),e.bezierCurveTo(P.x,P.y,E.x,E.y,m.x,m.y);var f=10*Math.floor(18*this.arc/Math.PI);this.extent="Retinectomy of "+f+" degrees centred at "+this.clockHour()+" o'clock"}else e.arc(0,0,i,0,2*Math.PI,!0),this.extent="360 degree retinectomy";e.lineWidth=16,e.strokeStyle="red",e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralRetinectomy.prototype.description=function(){return this.extent},ED.PeripheralRRD=function(t,e){this.className="PeripheralRRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PeripheralRRD.prototype=new ED.Doodle,ED.PeripheralRRD.prototype.constructor=ED.PeripheralRRD,ED.PeripheralRRD.superclass=ED.Doodle.prototype,ED.PeripheralRRD.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.PeripheralRRD.prototype.setParameterDefaults=function(){this.arc=112*Math.PI/180,this.apexY=-380,this.drawing.lastDoodleOfClass(this.className)?(this.drawing.eye,ED.eye.Right):this.drawing.eye==ED.eye.Right?this.rotation=-.8*Math.PI:this.rotation=.8*Math.PI},ED.PeripheralRRD.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralRRD.superclass.draw.call(this,t);var i=476,r=-this.apexY,a=r+(i-r)/2,o=i-r,n=this.arc/2,s=-Math.PI/2+n,l=-Math.PI/2-n,h=a*Math.sin(n),d=-a*Math.cos(n),c=-a*Math.sin(n),p=d,y=new ED.Point(0,0);y.x=-i*Math.sin(n-o/i),y.y=-i*Math.cos(n-o/i);var D=new ED.Point(0,0);D.x=-i*Math.sin(o/i-n),D.y=-i*Math.cos(o/i-n),e.beginPath(),e.arc(0,0,i,s,l,!0);var u=l-Math.PI/2;return e.arc(y.x,y.y,o,u,u-Math.PI/2+o/i,!0),e.arc(0,0,r,y.direction()-Math.PI/2,D.direction()-Math.PI/2,!1),u=s+Math.PI/2,e.arc(D.x,D.y,o,u+Math.PI/2-o/i,u,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(c,p)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralRRD.prototype.snomedCode=function(){return 232008001},ED.PeripheralRRD.prototype.diagnosticHierarchy=function(){return 0},ED.PeripheralVascularisation=function(t,e){this.className="PeripheralVascularisation",this.ghostVessels=!1,this.plane=0,this.savedParameterArray=["apexY","arc","rotation","ghostVessels"],this.controlParameterArray={ghostVessels:"Ghost vessels"},ED.Doodle.call(this,t,e)},ED.PeripheralVascularisation.prototype=new ED.Doodle,ED.PeripheralVascularisation.prototype.constructor=ED.PeripheralVascularisation,ED.PeripheralVascularisation.superclass=ED.Doodle.prototype,ED.PeripheralVascularisation.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralVascularisation.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isFilled=!1,this.parameterValidationArray.ghostVessels={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-420,-220),this.parameterValidationArray.arc.range.setMinAndMax(5*Math.PI/180,2*Math.PI)},ED.PeripheralVascularisation.prototype.setParameterDefaults=function(){this.arc=5*Math.PI/180,this.apexY=-380,this.setRotationWithDisplacements(0,120)},ED.PeripheralVascularisation.prototype.draw=function(t){var e=this.drawing.context;ED.PeripheralVascularisation.superclass.draw.call(this,t);var i=Math.abs(this.apexY),r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=476*Math.sin(r),s=-476*Math.cos(r),l=-476*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,476,a,o,!0),e.arc(0,0,i,o,a,!1),e.lineTo(n,s),e.lineWidth=4,e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=180/Math.PI,c=Math.PI/180,p=a*d-180,y=Math.abs(Math.round(1400/this.apexY)),D=20/Math.abs(600/this.apexY),u=n,g=s,P=this.arc/(11*c);e.strokeStyle=this.ghostVessels?"gray":"red",e.beginPath();for(var E=0;E<P;E++){var m=p;this.calculateTree(u,g,y,D,m),p-=11,u=-476*Math.cos(p*c),g=-476*Math.sin(p*c)}e.closePath(),e.stroke()}return this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PeripheralVascularisation.prototype.calculateTree=function(t,e,i,r,a){var o=this.drawing.context,n=this;function s(t,e,i,r,a,s){if(o.moveTo(t,e),a){var l=Math.abs(n.apexY),h=Math.sqrt(i*i+r*r),d=i/h*l,c=r/h*l;o.lineTo(d,c)}else o.lineTo(i,r)}function l(t,e,i,r,a,o){if(0!=r){var n=1==r,d=t+Math.cos(i*h)*r*15,c=e+Math.sin(i*h)*r*15;s(t,e,d,c,n),l(d,c,i-.2*a,r-1,a,o),l(d,c,i+1.5*a,r-1,a,o)}}var h=Math.PI/180;if(0!=i){var d=t+Math.cos(a*h)*i*6,c=e+Math.sin(a*h)*i*6;s(t,e,d,c,!1),l(d,c,a-r,i-1,2*r,a),l(d,c,a+r,i-1,r,a)}},ED.PhakoIncision=function(t,e){this.className="PhakoIncision",this.defaultRadius=330,this.sutureSeparation=1.5,this.incisionSite="Corneal",this.incisionType="Pocket",this.incisionMeridian=0,this.savedParameterArray=["apexY","arc","rotation","radius"],ED.Doodle.call(this,t,e),this.apexYDelta=this.radius+this.apexY},ED.PhakoIncision.prototype=new ED.Doodle,ED.PhakoIncision.prototype.constructor=ED.PhakoIncision,ED.PhakoIncision.superclass=ED.Doodle.prototype,ED.PhakoIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PhakoIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.incisionMeridian={kind:"derived",type:"mod",range:new ED.Range(0,360),clock:"bottom",animate:!0},this.parameterValidationArray.incisionLength={kind:"derived",type:"float",range:new ED.Range(1,9.9),precision:1,animate:!0},this.parameterValidationArray.incisionSite={kind:"derived",type:"string",list:["Corneal","Limbal","Scleral"],animate:!0},this.parameterValidationArray.incisionType={kind:"derived",type:"string",list:["Pocket","Section"],animate:!1}},ED.PhakoIncision.prototype.setParameterDefaults=function(){this.setParameterFromString("incisionSite","Corneal"),this.setParameterFromString("incisionLength","3.5"),this.setParameterFromString("incisionType","Pocket"),this.setRotationWithDisplacements(90,-90)},ED.PhakoIncision.prototype.dependentParameterValues=function(t,e){var i={};switch(t){case"rotation":var r=(180*(2*Math.PI-e+Math.PI/2)/Math.PI+360)%360;360==r&&(r=0),i.incisionMeridian=r;break;case"arc":i.incisionLength=e*(6*this.radius)/this.defaultRadius;break;case"radius":i.incisionSite=e>=428?"Scleral":e>=344?"Limbal":"Corneal",i.arc=this.incisionLength*this.defaultRadius/(6*e),this.updateArcRange(),i.apexY=this.apexYDelta-e,this.parameterValidationArray.apexY.range.setMinAndMax(-e,34-e);break;case"apexY":i.apexYDelta=this.radius+e,i.incisionType=this.radius+e>0?"Section":"Pocket";break;case"incisionMeridian":i.rotation=(90-e+360)%360*Math.PI/180;break;case"incisionLength":i.arc=e*this.defaultRadius/(6*this.radius),this.updateArcRange();break;case"incisionSite":switch(e){case"Scleral":i.radius=428;break;case"Limbal":i.radius=376;break;case"Corneal":i.radius=330}break;case"incisionType":switch(e){case"Pocket":i.apexYDelta=0,i.apexY=-this.radius;break;case"Section":i.apexYDelta=34,i.apexY=34-this.radius}}return i},ED.PhakoIncision.prototype.updateArcRange=function(){this.radius>0?(this.parameterValidationArray.arc.range.min=this.parameterValidationArray.incisionLength.range.min*this.defaultRadius/(6*this.radius),this.parameterValidationArray.arc.range.max=this.parameterValidationArray.incisionLength.range.max*this.defaultRadius/(6*this.radius)):ED.errorHandler("ED.PhakoIncision","updateArcRange","Attempt to calculate a range of arc using an illegal value of radius: "+this.radius)},ED.PhakoIncision.prototype.draw=function(t){var e=this.drawing.context;ED.PhakoIncision.superclass.draw.call(this,t);var i=this.radius,r=i+40,a=i-40;e.beginPath();var o=this.arc/2;if(e.arc(0,0,r,-Math.PI/2+o,-Math.PI/2-o,!0),e.arc(0,0,a,-Math.PI/2-o,-Math.PI/2+o,!1),e.closePath(),0==this.apexYDelta?(e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)"):(e.fillStyle="rgba(200,200,200,0)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0)"),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&0!=this.apexYDelta){e.beginPath(),e.arc(0,0,i,-Math.PI/2+o,-Math.PI/2-o,!0);var n=this.sutureSeparation*this.defaultRadius/(6*this.radius),s=new ED.Point(0,0),l=o-n/2;do{s.setWithPolars(i-40,l),e.moveTo(s.x,s.y),s.setWithPolars(i+40,l),e.lineTo(s.x,s.y),l-=n}while(l>-o);e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var h=new ED.Point(0,0);return h.setWithPolars(i,o),this.handleArray[3].location=this.transform.transformPoint(h),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PhakoIncision.prototype.description=function(){var t="";return t=this.radius>428?"Scleral ":this.radius>344?"Limbal ":"Corneal ",this.incisionType?t+=this.incisionType.toLowerCase()+" ":t+=this.apexY+this.radius==0?"pocket ":"section ",t+="incision at ",t+=this.clockHour()+" o'clock"},ED.PI=function(t,e){this.className="PI",this.type="Surgical",this.patent=!0,this.savedParameterArray=["rotation","type","patent"],this.controlParameterArray={type:"Type",patent:"Patent"},ED.Doodle.call(this,t,e)},ED.PI.prototype=new ED.Doodle,ED.PI.prototype.constructor=ED.PI,ED.PI.superclass=ED.Doodle.prototype,ED.PI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.type={kind:"derived",type:"string",list:["Surgical","Laser"],animate:!1},this.parameterValidationArray.patent={kind:"derived",type:"bool",display:!1}},ED.PI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,-30)},ED.PI.prototype.draw=function(t){var e=this.drawing.context;ED.PI.superclass.draw.call(this,t);switch(e.beginPath(),this.type){case"Surgical":var i=Math.PI/24;e.arc(0,0,360,-i-Math.PI/2,i-Math.PI/2,!1),e.lineTo(0,-288),e.closePath();break;case"Laser":e.arc(0,-324,36,0,2*Math.PI,!0)}return e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.patent?e.fillStyle="rgba(255,255,255,1)":e.fillStyle="rgba(150,150,150,1)",this.drawBoundary(t),this.isClicked},ED.PI.prototype.description=function(){return"Peripheral iridectomy at "+this.clockHour()+" o'clock"},ED.PigmentEpitheliumDetachment=function(t,e){this.className="PigmentEpitheliumDetachment",this.discRadius=84,this.type="Serous",this.savedParameterArray=["originX","originY","apexX","apexY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.PigmentEpitheliumDetachment.prototype=new ED.Doodle,ED.PigmentEpitheliumDetachment.prototype.constructor=ED.PigmentEpitheliumDetachment,ED.PigmentEpitheliumDetachment.superclass=ED.Doodle.prototype,ED.PigmentEpitheliumDetachment.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PigmentEpitheliumDetachment.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(30,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Serous","Drusenoid","Type 1 nv","Type 3 nv RAP","PCV"],animate:!1}},ED.PigmentEpitheliumDetachment.prototype.setParameterDefaults=function(){this.apexX=2*this.discRadius},ED.PigmentEpitheliumDetachment.prototype.dependentParameterValues=function(t,e){},ED.PigmentEpitheliumDetachment.prototype.draw=function(t){var e=this.drawing.context;ED.PigmentEpitheliumDetachment.superclass.draw.call(this,t),e.beginPath();var i=this.apexX;e.arc(0,0,i,0,2*Math.PI,!0);var r=e.createRadialGradient(0,0,.8*i,0,0,i);if(r.addColorStop(0,"rgba(215,215,215,0.9)"),r.addColorStop(1,"rgba(215,215,215,0)"),e.lineWidth=4,e.fillStyle=r,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)switch(this.type){case"Drusenoid":e.beginPath(),e.fillStyle="rgba(255,195,0,1)";for(var a=5,o=2*Math.PI/a,n=.35*this.apexX,s=(i=.3*this.apexX,0);s<a;s++){var l=new ED.Point(0,0);l.setWithPolars(n,o*s),e.moveTo(l.x+i,l.y),e.arc(l.x,l.y,i,0,2*Math.PI),e.fill()}for(e.moveTo(0,0),e.arc(0,0,i,0,2*Math.PI),e.fill(),i=10,e.beginPath(),e.fillStyle="rgba(100,25,25,1)",s=0;s<a;s++){var h=n*ED.randomArray[s];(l=new ED.Point(0,0)).setWithPolars(h,o*s),e.moveTo(l.x+i,l.y),e.arc(l.x,l.y,i,0,2*Math.PI),e.fill()}break;case"Type 1 nv":i=this.discRadius/1.2;var d=e.createRadialGradient(0,0,.5*i,0,0,i);d.addColorStop(0,"red"),d.addColorStop(1,"rgba(255,0,0,0)"),e.beginPath(),e.arc(0,0,i,0,2*Math.PI),e.fillStyle=d,e.fill();break;case"Type 3 nv RAP":i=this.discRadius/2;e.beginPath(),e.arc(0,0,i,0,2*Math.PI),e.fillStyle="red",e.fill();break;case"PCV":e.beginPath(),e.ellipse(0,0,20,30,.5*Math.PI,0,2*Math.PI);a=12,o=2*Math.PI/a;var c=this.discRadius/1.5;for(i=8,s=0;s<a;s++)0!=s&&3!=s&&6!=s&&9!=s&&((l=new ED.Point(0,0)).setWithPolars(c,o*s),e.moveTo(0,0),e.lineTo(l.x,l.y),e.moveTo(l.x+i,l.y),e.arc(l.x,l.y,i,0,2*Math.PI));e.lineWidth=2,e.fillStyle="rgba(205,0,0,1)",e.strokeStyle=e.fillStyle,e.stroke(),e.fill()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PigmentEpitheliumDetachment.prototype.description=function(){var t="";switch(this.type){case"Serous":t="Serous PED";break;case"Drusenoid":t="Drusenoid PED";break;case"Type 1 nv":t="Neovascular PED Type 1";break;case"Type 3 nv RAP":t="Neovascular PED Type 3 RAP";break;case"PCV":t="PED with PCV"}return t},ED.PigmentEpitheliumDetachment.prototype.snomedCodes=function(){return snomedCodes=[],"Drusenoid"===this.type?snomedCodes.push([342581000119102,3]):snomedCodes.push([52002008,3]),"Type 1 nv"===this.type||"Type 3 nv RAP"===this.type?snomedCodes.push([75971007,3]):"PCV"===this.type&&snomedCodes.push([313001006,3]),snomedCodes},ED.Pingueculum=function(t,e){this.className="Pingueculum",this.savedParameterArray=["arc","rotation"],this.controlParameterArray={},ED.Doodle.call(this,t,e)},ED.Pingueculum.prototype=new ED.Doodle,ED.Pingueculum.prototype.constructor=ED.Pingueculum,ED.Pingueculum.superclass=ED.Doodle.prototype,ED.Pingueculum.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Pingueculum.prototype.setPropertyDefaults=function(){this.isUnique=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.arc.range.setMinAndMax(.75*Math.PI,1.25*Math.PI)},ED.Pingueculum.prototype.setParameterDefaults=function(){this.arc=180*Math.PI/180,this.setRotationWithDisplacements(0,180),this.rotation>.5*Math.PI&&(this.rotation=Math.PI)},ED.Pingueculum.prototype.draw=function(t){var e=this.drawing.context;ED.Pingueculum.superclass.draw.call(this,t);var i=this.arc/2,r=460*Math.sin(i),a=-460*Math.cos(i),o=38;e.beginPath(),e.arc(r,a,76,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.fillStyle="yellow",e.beginPath(),e.arc(r-o,a-19,o,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.arc(r-o,a+19,o,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.arc(r,a,o,0,2*Math.PI,!1),e.fill());var n=460*Math.sin(i),s=-460*Math.cos(i);Math.sin(i);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Pingueculum.prototype.description=function(){return"Pinguecula"},ED.Pingueculum.prototype.snomedCode=function(){return 87614e3},ED.PosteriorCapsularOpacity=function(t,e){this.className="PosteriorCapsularOpacity",this.numberOfHandles=4,this.initialRadius=360,this.intensity="Mild",this.stromal=!1,this.epithelial=!1,this.endothelial=!1,this.savedParameterArray=["originX","originY","apexX","apexY","rotation","intensity","stromal","epithelial","endothelial"],this.controlParameterArray={intensity:"Intensity",epithelial:"Epithelial",stromal:"Stromal",endothelial:"Endothelial"},ED.Doodle.call(this,t,e)},ED.PosteriorCapsularOpacity.prototype=new ED.Doodle,ED.PosteriorCapsularOpacity.prototype.constructor=ED.PosteriorCapsularOpacity,ED.PosteriorCapsularOpacity.superclass=ED.Doodle.prototype,ED.PosteriorCapsularOpacity.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorCapsularOpacity.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.intensity={kind:"derived",type:"string",list:["Mild","Moderate","Severe"],animate:!1},this.parameterValidationArray.stromal={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.epithelial={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.endothelial={kind:"derived",type:"bool",display:!0}},ED.PosteriorCapsularOpacity.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius,this.setParameterFromString("stromal","false"),this.setParameterFromString("epithelial","false"),this.setParameterFromString("endothelial","false"),this.rotation=Math.PI/4},ED.PosteriorCapsularOpacity.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorCapsularOpacity.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);switch(e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,this.intensity){case"Mild":e.fillStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPattern,"repeat");break;case"Severe":e.fillStyle=e.createPattern(this.drawing.imageArray.OedemaPatternBullous,"repeat")}if(e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw);return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorCapsularOpacity.prototype.description=function(){return"Corneal oedema"},ED.PosteriorCapsule=function(t,e){this.className="PosteriorCapsule",this.opacity="1",this.capsulotomy="None",this.savedParameterArray=["originX","originY","opacity","capsulotomy"],this.controlParameterArray={opacity:"Opacity",capsulotomy:"Capsulotomy"},ED.Doodle.call(this,t,e)},ED.PosteriorCapsule.prototype=new ED.Doodle,ED.PosteriorCapsule.prototype.constructor=ED.PosteriorCapsule,ED.PosteriorCapsule.superclass=ED.Doodle.prototype,ED.PosteriorCapsule.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.opacity={kind:"derived",type:"string",list:["1","2","3","4"],animate:!1},this.parameterValidationArray.capsulotomy={kind:"derived",type:"string",list:["None","Diamond","Circle"],animate:!1}},ED.PosteriorCapsule.prototype.setParameterDefaults=function(){},ED.PosteriorCapsule.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorCapsule.superclass.draw.call(this,t);if(e.beginPath(),e.arc(0,0,240,0,2*Math.PI,!0),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if("1"!=this.capsulotomy){e.beginPath(),e.arc(0,0,240,0,2*Math.PI,!0);switch(e.moveTo(140,0),this.capsulotomy){case"Diamond":e.lineTo(0,140),e.lineTo(-140,0),e.lineTo(0,-140),e.lineTo(140,0),e.closePath();break;case"Circle":e.arc(0,0,140,0,2*Math.PI,!1)}}var i=e.createPattern(this.drawing.imageArray.PSCPattern,"repeat");switch(this.opacity>1&&(e.fillStyle=i),e.fill(),this.opacity){case"1":e.fillStyle="rgba(255, 255, 255, 0.1)";break;case"2":e.fillStyle="rgba(255, 255, 255, 0.5)";break;case"3":e.fillStyle="rgba(200, 200, 200, 0.5)";break;case"4":e.fillStyle="rgba(150, 150, 150, 0.5)";break;default:e.fillStyle="rgba(255, 150, 100, 0.1)"}e.fill(),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorCapsule.prototype.description=function(){var t="";switch("1"!=this.opacity&&(t+=this.opacity+" posterior capsular opacity"),this.opacity){case"2":t="Mild PCO reducing the red reflex, Elschnig pearls to the IOL edge";break;case"3":t="Moderate fibrosis or Elschnig pearls inside IOL edge, but with a clear visual axis";break;case"4":t="Severe fibrosis or Elschnig pearls covering the visual axis and severely reducing the red reflex"}"None"!=this.capsulotomy&&(t+=" with "+this.capsulotomy.toLowerCase()+" shaped capsulotomy");return t},ED.PosteriorEmbryotoxon=function(t,e){this.className="PosteriorEmbryotoxon",ED.Doodle.call(this,t,e)},ED.PosteriorEmbryotoxon.prototype=new ED.Doodle,ED.PosteriorEmbryotoxon.prototype.constructor=ED.PosteriorEmbryotoxon,ED.PosteriorEmbryotoxon.superclass=ED.Doodle.prototype,ED.PosteriorEmbryotoxon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.PosteriorEmbryotoxon.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorEmbryotoxon.superclass.draw.call(this,t);var i=2*Math.PI;return e.beginPath(),e.arc(0,0,370,0,i,!0),e.arc(0,0,340,i,0,!1),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(255,255,255,0.6)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.isClicked},ED.PosteriorEmbryotoxon.prototype.description=function(){return"Posterior Embryotoxon"},ED.PosteriorRetinectomy=function(t,e){this.className="PosteriorRetinectomy",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,t,e)},ED.PosteriorRetinectomy.prototype=new ED.Doodle,ED.PosteriorRetinectomy.prototype.constructor=ED.PosteriorRetinectomy,ED.PosteriorRetinectomy.superclass=ED.Doodle.prototype,ED.PosteriorRetinectomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorRetinectomy.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-50)},ED.PosteriorRetinectomy.prototype.setParameterDefaults=function(){this.apexX=0,this.apexY=-100;this.originX=100,this.originY=-100;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=e.direction()+Math.PI/8,r=e.length(),a=new ED.Point(0,0);a.setWithPolars(r,i),this.originX=a.x,this.originY=a.y}},ED.PosteriorRetinectomy.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorRetinectomy.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);return e.arc(0,0,i+16,0,2*Math.PI,!0),e.arc(0,0,i-16,2*Math.PI,0,!1),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=16,e.strokeStyle="red",e.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorRetinectomy.prototype.groupDescription=function(){return"Posterior retinectomy"},ED.PosteriorSynechia=function(t,e){this.className="PosteriorSynechia",this.size=150,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.PosteriorSynechia.prototype=new ED.Doodle,ED.PosteriorSynechia.prototype.constructor=ED.PosteriorSynechia,ED.PosteriorSynechia.superclass=ED.Doodle.prototype,ED.PosteriorSynechia.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorSynechia.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI/3),this.parameterValidationArray.size={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.PosteriorSynechia.prototype.setParameterDefaults=function(){this.arc=Math.PI/6,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY+this.size:-200},ED.PosteriorSynechia.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"size":(r=this.drawing.lastDoodleOfClass("AntSeg"))&&(i.apexY=r.apexY-e);break;case"apexY":var r;(r=this.drawing.lastDoodleOfClass("AntSeg"))&&(i.size=r.apexY-e)}return i},ED.PosteriorSynechia.prototype.draw=function(t){var e=this.drawing.context;ED.PosteriorSynechia.superclass.draw.call(this,t);var i=200,r=this.drawing.lastDoodleOfClass("AntSeg");r&&(i=-r.apexY);this.apexY;e.beginPath();var a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=new ED.Point(-i*Math.sin(a),-i*Math.cos(a)),l=new ED.Point(i*Math.sin(a),-i*Math.cos(a));e.beginPath(),e.arc(0,0,i,n,o,!1);var h=new ED.Point(this.apexX,this.apexY),d=l.pointAtAngleToLineToPointAtProportion(Math.PI/12,h,.33),c=h.pointAtAngleToLineToPointAtProportion(-Math.PI/12,l,.33);e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY);var p=h.pointAtAngleToLineToPointAtProportion(Math.PI/12,s,.33),y=s.pointAtAngleToLineToPointAtProportion(-Math.PI/12,h,.33);switch(e.bezierCurveTo(p.x,p.y,y.x,y.y,s.x,s.y),e.closePath(),r.colour){case"Blue":e.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":e.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":e.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":e.fillStyle="rgba(114, 172, 62, 0.5)"}return e.lineWidth=4,e.strokeStyle="rgba(250, 250, 250, 0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,i,n,o,!1),e.lineWidth=6,e.strokeStyle="white",e.stroke(),e.strokeStyle=e.fillStyle,e.stroke(),e.beginPath(),e.moveTo(l.x,l.y),e.bezierCurveTo(d.x,d.y,c.x,c.y,this.apexX,this.apexY),e.bezierCurveTo(p.x,p.y,y.x,y.y,s.x,s.y),e.lineWidth=4,e.strokeStyle="gray",e.stroke()),this.handleArray[0].location=this.transform.transformPoint(s),this.handleArray[3].location=this.transform.transformPoint(l),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PosteriorSynechia.prototype.groupDescription=function(){return"Posterior synechiae at "},ED.PosteriorSynechia.prototype.description=function(){return this.clockHour()+" o'clock"},ED.PostPole=function(t,e){this.className="PostPole",this.discRadius=84,this.cdRatio="0",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.PostPole.prototype=new ED.Doodle,ED.PostPole.prototype.constructor=ED.PostPole,ED.PostPole.superclass=ED.Doodle.prototype,ED.PostPole.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostPole.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.willReport=!0;var t=this.drawing.eye==ED.eye.Right?300:-300;this.parameterValidationArray.apexX.range.setMinAndMax(t,t),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-8),this.parameterValidationArray.cdRatio={kind:"derived",type:"float",range:new ED.Range(0,1),precision:1,animate:!1},this.parameterValidationArray.apexY.delta=5},ED.PostPole.prototype.setParameterDefaults=function(){this.setParameterFromString("cdRatio","0.5"),this.apexX=this.drawing.eye==ED.eye.Right?300:-300},ED.PostPole.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.cdRatio=-e/80;break;case"cdRatio":i.apexY=-80*+e}return i},ED.PostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PostPole.superclass.draw.call(this,t);var i=this.drawing.eye==ED.eye.Right?300:-300;if(e.beginPath(),e.arc(i,0,this.discRadius,0,2*Math.PI,!0),e.lineWidth=4,e.strokeStyle="rgba(249,187,76,1)",e.fillStyle="rgba(249,187,76,1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(i,0,-this.apexY,2*Math.PI,0,!1),e.fillStyle="white";var r=e.createPattern(this.drawing.imageArray.CribriformPatternSmall,"repeat");e.fillStyle=r,e.lineWidth=4,e.fill(),e.stroke(),e.beginPath();var a=this.drawing.eye==ED.eye.Right?1:-1,o=-300*a,n=-50*a,s=300*a,l=300*a,h=300*a,d=350*a,c=400*a;e.moveTo(o,-100),e.bezierCurveTo(n,-500,s,-200,l,-24),e.bezierCurveTo(h,-80,d,-140,c,-160),e.moveTo(c,160),e.bezierCurveTo(d,140,h,80,l,24),e.bezierCurveTo(s,200,n,500,o,100);e.moveTo(0,-10),e.lineTo(0,10),e.moveTo(-10,0),e.lineTo(10,0),e.lineWidth=8,e.lineCap="round",e.strokeStyle="red",e.stroke(),e.beginPath(),e.arc(0,0,2*this.discRadius,2*Math.PI,0,!1),e.lineWidth=1,e.strokeStyle="gray",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostPole.prototype.description=function(){var t="";return 0===t.length&&1===this.drawing.doodleArray.length&&(t="No abnormality"),t},ED.PostPole.prototype.isWithinDiscDiametersOfFovea=function(t,e){return t.originX*t.originX+t.originY*t.originY<4*e*this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinDisc=function(t){var e=t.originX-(this.drawing.eye==ED.eye.Right?300:-300);return e*e+t.originY*t.originY<this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinArcades=function(t){return t.originX*t.originX+t.originY*t.originY<9e4},ED.PostSubcapCataract=function(t,e){this.className="PostSubcapCataract",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.PostSubcapCataract.prototype=new ED.Doodle,ED.PostSubcapCataract.prototype.constructor=ED.PostSubcapCataract,ED.PostSubcapCataract.superclass=ED.Doodle.prototype,ED.PostSubcapCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostSubcapCataract.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens"],this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(35,100),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-35)},ED.PostSubcapCataract.prototype.setParameterDefaults=function(){this.apexX=35,this.apexY=35,this.radius=50},ED.PostSubcapCataract.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexX":case"apexY":i.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY)}return i},ED.PostSubcapCataract.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataract.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,this.radius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=4;var i=e.createPattern(this.drawing.imageArray.PSCPattern,"repeat");e.fillStyle=i,e.strokeStyle="lightgray",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw;var r=new ED.Point(0,0);return r.setWithPolars(this.radius,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PostSubcapCataract.prototype.description=function(){return"Posterior subcapsular cataract"},ED.PostSubcapCataract.prototype.snomedCode=function(){return 315353005},ED.PostSubcapCataract.prototype.diagnosticHierarchy=function(){return 0},ED.PostSubcapCataractCrossSection=function(t,e){this.className="PostSubcapCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,t,e)},ED.PostSubcapCataractCrossSection.prototype=new ED.Doodle,ED.PostSubcapCataractCrossSection.prototype.constructor=ED.PostSubcapCataractCrossSection,ED.PostSubcapCataractCrossSection.superclass=ED.Doodle.prototype,ED.PostSubcapCataractCrossSection.prototype.setHandles=function(){},ED.PostSubcapCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20)},ED.PostSubcapCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.apexY=-35},ED.PostSubcapCataractCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.PostSubcapCataractCrossSection.superclass.draw.call(this,t);var i=Math.asin(.8),r=300*Math.cos(i);i=Math.acos(r/290);var a=Math.asin(-this.apexY/290);return e.beginPath(),e.arc(100-r,0,290,-a,a,!1),e.lineWidth=10,e.lineCap="round",e.lineJoin="round",e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(150,150,150,0.75)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PreRetinalHaemorrhage=function(t,e){this.className="PreRetinalHaemorrhage",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.PreRetinalHaemorrhage.prototype=new ED.Doodle,ED.PreRetinalHaemorrhage.prototype.constructor=ED.PreRetinalHaemorrhage,ED.PreRetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.PreRetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PreRetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,200),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.PreRetinalHaemorrhage.prototype.setParameterDefaults=function(){this.apexY=200,this.setOriginWithDisplacements(-150,150)},ED.PreRetinalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.PreRetinalHaemorrhage.superclass.draw.call(this,t);var i=100;return e.beginPath(),e.moveTo(i,0),e.lineTo(-i,0),e.bezierCurveTo(-60,0,-60,this.apexY,0,this.apexY),e.bezierCurveTo(60,this.apexY,60,0,i,0),e.closePath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(100,0)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PreRetinalHaemorrhage.prototype.groupDescription=function(){return"Pre-retinal haemorrages"},ED.PRPPostPole=function(t,e){this.className="PRPPostPole",ED.Doodle.call(this,t,e)},ED.PRPPostPole.prototype=new ED.Doodle,ED.PRPPostPole.prototype.constructor=ED.PRPPostPole,ED.PRPPostPole.superclass=ED.Doodle.prototype,ED.PRPPostPole.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.PRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,t),e.beginPath(),e.rect(-480,-480,960,960);var i=320;if(e.moveTo(i,0),e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(255, 255, 255, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var r=904/60,a=0;a<r;a++)for(var o=0;o<r;o++){var n=60*a-452+Math.round(20*(-.5+ED.randomArray[a+o])),s=60*o-452+Math.round(20*(-.5+ED.randomArray[a+o+100]));n*n+s*s>i*i&&(this.drawing.eye==ED.eye.Right?(13!=a||6!=o&&7!=o&&8!=o&&9!=o)&&(14!=a||7!=o&&8!=o)&&this.drawCircle(e,n,s,15,"Yellow",10,"rgba(255, 128, 0, 1)"):(2!=a||6!=o&&7!=o&&8!=o&&9!=o)&&(1!=a||7!=o&&8!=o)&&this.drawCircle(e,n,s,15,"Yellow",10,"rgba(255, 128, 0, 1)"))}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PRPPostPole.prototype.description=function(){return"Panretinal photocoagulation"},ED.Pterygium=function(t,e){this.className="Pterygium",this.plane=0,this.savedParameterArray=["apexY","arc","rotation","injection","stockersLine"],this.controlParameterArray={injection:"Injection",stockersLine:"Stocker's line"},ED.Doodle.call(this,t,e)},ED.Pterygium.prototype=new ED.Doodle,ED.Pterygium.prototype.constructor=ED.Pterygium,ED.Pterygium.superclass=ED.Doodle.prototype,ED.Pterygium.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1),this.handleArray[5]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[6]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.Pterygium.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!1,this.parameterValidationArray.injection={kind:"derived",type:"string",list:["+","++","+++"],animate:!0},this.parameterValidationArray.stockersLine={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-360,100),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,Math.PI),this.parameterValidationArray.rotation.range.setMinAndMax(0,2*Math.PI)},ED.Pterygium.prototype.setParameterDefaults=function(){this.apexY=-120,this.arc=60*Math.PI/180,this.setRotationWithDisplacements(270,180),this.rotation>Math.PI&&(this.rotation=1.5*Math.PI),this.setParameterFromString("injection","+"),this.setParameterFromString("stockersLine","false");var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(-80,-170);this.squiggleArray[0].pointsArray[5]=e,e=new ED.Point(80,-170),this.squiggleArray[0].pointsArray[6]=e},ED.Pterygium.prototype.dependentParameterValues=function(t,e){switch(t){case"apexY":this.squiggleArray[0].pointsArray[5].y=e-50,this.squiggleArray[0].pointsArray[6].y=e-50;break;case"handles":this.squiggleArray[0].pointsArray[this.draggingHandleIndex].y=this.apexY-50}return{}},ED.Pterygium.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var i=470,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);switch(e.bezierCurveTo(l-.7*(l-this.squiggleArray[0].pointsArray[5].x),h,this.squiggleArray[0].pointsArray[5].x,this.squiggleArray[0].pointsArray[5].y,this.squiggleArray[0].pointsArray[5].x,this.squiggleArray[0].pointsArray[5].y),e.bezierCurveTo(this.squiggleArray[0].pointsArray[5].x,this.apexY,this.apexX,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(this.apexX,this.apexY,this.squiggleArray[0].pointsArray[6].x,this.apexY,this.squiggleArray[0].pointsArray[6].x,this.squiggleArray[0].pointsArray[6].y),e.bezierCurveTo(this.squiggleArray[0].pointsArray[6].x,this.squiggleArray[0].pointsArray[6].y,n-.7*(n-this.squiggleArray[0].pointsArray[6].x),s,n,s),e.lineWidth=4,this.injection){case"+":e.fillStyle="rgba(255, 204, 204, 0.7)";break;case"++":e.fillStyle="rgba(255, 153, 153, 0.7)";break;case"+++":e.fillStyle="rgba(255, 102, 102, 0.7)"}if(e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){this.stockersLine&&(e.beginPath(),e.moveTo(this.squiggleArray[0].pointsArray[5].x-20,this.squiggleArray[0].pointsArray[5].y+20),e.bezierCurveTo(this.squiggleArray[0].pointsArray[5].x,this.apexY+20,this.apexX,this.apexY+20,this.apexX,this.apexY+20),e.bezierCurveTo(this.apexX,this.apexY+20,this.squiggleArray[0].pointsArray[6].x,this.apexY+20,this.squiggleArray[0].pointsArray[6].x+20,this.squiggleArray[0].pointsArray[6].y+20),e.strokeStyle="brown",e.lineWidth=8,e.stroke());var d=this.arc/6,c=Math.abs(this.squiggleArray[0].pointsArray[5].x-this.squiggleArray[0].pointsArray[6].x)/7,p=new ED.Point(0,0),y=new ED.Point(0,0),D=new ED.Point(this.apexX,this.apexY);e.beginPath();for(var u=0;u<6;u++){var g=Math.PI/2+d/2+o+u*d;p.setWithPolars(460,g);y.x=this.squiggleArray[0].pointsArray[5].x+c*(u+1),y.y=p.y+.8*(D.y-p.y),e.moveTo(p.x,p.y),e.bezierCurveTo(y.x-.7*(y.x-p.x),p.y,y.x,y.y,y.x,y.y)}switch(e.strokeStyle="rgba(255,0,0,0.6)",this.injection){case"+":e.lineWidth=4;break;case"++":e.lineWidth=6;break;case"+++":e.lineWidth=8}e.stroke()}return this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.handleArray[5].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[5]),this.handleArray[6].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[6]),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Pterygium.prototype.description=function(){var t=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);t=(t/380*6).toFixed(2);var e="";return"+++"==this.injection&&(e+="injected "),this.rotation>=0&&this.rotation<Math.PI?this.drawing.eye==ED.eye.Right?e+="nasal ":e+="temporal ":this.drawing.eye==ED.eye.Right?e+="temporal ":e+="nasal ",e+="pterygium within "+t+"mm of visual axis"},ED.Pterygium.prototype.snomedCode=function(){return 77489003},ED.Pterygium.prototype.diagnosticHierarchy=function(){return 0},ED.PTK=function(t,e){this.className="PTK",this.diameter=8,this.depth=80,this.transepithelialTreatment=!1,this.topographyGuidedTreatment=!1,this.savedParameterArray=["apexX","apexY","diameter","depth","transepithelialTreatment","topographyGuidedTreatment"],this.controlParameterArray={diameter:"Diameter",depth:"Depth",transepithelialTreatment:"Transepithelial",topographyGuidedTreatment:"Topography guided"},ED.Doodle.call(this,t,e)},ED.PTK.prototype=new ED.Doodle,ED.PTK.prototype.constructor=ED.PTK,ED.PTK.superclass=ED.Doodle.prototype,ED.PTK.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PTK.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-32),this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(1,10),precision:1,animate:!0},this.parameterValidationArray.depth={kind:"other",type:"int",range:new ED.Range(1,400),animate:!1},this.parameterValidationArray.transepithelialTreatment={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.topographyGuidedTreatment={kind:"derived",type:"bool",display:!0}},ED.PTK.prototype.setParameterDefaults=function(){this.rotation=Math.PI/4,this.setParameterFromString("diameter","8.0"),this.setParameterFromString("depth","100")},ED.PTK.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.diameter=-10*e/320;break;case"diameter":i.apexY=-320*parseFloat(e)/10}return i},ED.PTK.prototype.draw=function(t){var e=this.drawing.context;ED.PTK.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,-this.apexY,0,2*Math.PI,!0),e.closePath(),e.fillStyle=e.createPattern(this.drawing.imageArray.TranslucentPattern,"repeat"),e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t);var i=new ED.Point(this.apexX,this.apexY);return this.handleArray[4].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.PTK.prototype.description=function(){return"PTK","PTK"},ED.RadialSponge=function(t,e){this.className="RadialSponge",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.RadialSponge.prototype=new ED.Doodle,ED.RadialSponge.prototype.constructor=ED.RadialSponge,ED.RadialSponge.superclass=ED.Doodle.prototype,ED.RadialSponge.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0},ED.RadialSponge.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/6:-60*Math.PI/180},ED.RadialSponge.prototype.draw=function(t){var e=this.drawing.context;ED.RadialSponge.superclass.draw.call(this,t);var i=-220,r=200;return e.beginPath(),e.moveTo(-40,i),e.lineTo(-40,i-r),e.lineTo(40,i-r),e.lineTo(40,i),e.closePath(),e.lineWidth=4,e.fillStyle="lightgray",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,-380,5,0,2*Math.PI,!0),e.lineTo(-20,-390),e.moveTo(0,-380),e.lineTo(20,-390),e.moveTo(-60,-260),e.lineTo(-60,-380),e.lineTo(60,-380),e.lineTo(60,-260),e.closePath(),e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RadialSponge.prototype.groupDescription=function(){return"Radial sponge at "},ED.RadialSponge.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Rectus=function(t,e){this.className="Rectus",this.insertionY=-200,this.hangback=!1,this.canTranspose=!0,this.recession=0,this.transposition="None",this.savedParameterArray=["apexX","apexY","rotation"],ED.Doodle.call(this,t,e)},ED.Rectus.prototype=new ED.Doodle,ED.Rectus.prototype.constructor=ED.Rectus,ED.Rectus.superclass=ED.Doodle.prototype,ED.Rectus.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rectus.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.recession={kind:"derived",type:"float",range:new ED.Range(-12.5,6.5),precision:1,animate:!0},this.parameterValidationArray.transposition={kind:"derived",type:"string",list:["Up","None","Down"],animate:!0},this.parameterValidationArray.canTranspose={kind:"derived",type:"bool",animate:!0}},ED.Rectus.prototype.setParameterDefaults=function(){this.setParameterFromString("recession","0"),this.setParameterFromString("transposition","None"),this.apexY=this.insertionY,this.canTranspose=!0},ED.Rectus.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.recession=Math.round(2*(e-this.insertionY)/16)/2;break;case"recession":i.apexY=16*e+this.insertionY;break;case"apexX":this.rotation>0&&this.rotation<Math.PI?i.transposition=e<0?"Up":e>0?"Down":"None":i.transposition=e<0?"Down":e>0?"Up":"None";break;case"transposition":switch(e){case"Up":this.rotation>0&&this.rotation<Math.PI?i.apexX=-50:i.apexX=50;break;case"Down":this.rotation>0&&this.rotation<Math.PI?i.apexX=50:i.apexX=-50;break;case"None":i.apexX=0}}return this.apexY>this.insertionY-15&&this.apexY<this.insertionY+15&&this.canTranspose?this.parameterValidationArray.apexX.range.setMinAndMax(-100,100):this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.apexX>-15&&this.apexX<15?this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100):this.parameterValidationArray.apexY.range.setMinAndMax(-200,-200),i},ED.Rectus.prototype.draw=function(t){var e=this.drawing.context;ED.Rectus.superclass.draw.call(this,t),e.beginPath();if(e.moveTo(-60,-450),e.lineTo(60,-450),e.lineTo(this.apexX+60,this.apexY),e.lineTo(this.apexX-60,this.apexY),e.closePath(),e.lineWidth=2,e.fillStyle="rgba(255, 140 , 80, 1)",e.strokeStyle="rgba(255, 184, 93, 1)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.insertionY<this.apexY){var i=this.apexX*(this.insertionY- -450)/(this.apexY- -450)-60;e.beginPath(),e.moveTo(i,this.insertionY),e.lineTo(i+120,this.insertionY),e.lineTo(this.apexX+60,this.apexY),e.lineTo(this.apexX-60,this.apexY),e.closePath(),e.fillStyle="rgba(255, 220, 140, 1)",e.fill()}if(0!=this.apexX||this.apexY!=this.insertionY){var r,a;r=this.insertionY>this.apexY?this.apexY:this.insertionY,a=!this.hangback&&this.insertionY>this.apexY?this.apexY+15:this.insertionY+15;var o=this.apexX;e.beginPath(),e.moveTo(o,a),e.lineTo(o-15,a+15),e.moveTo(o+15,a+15),e.lineTo(o,a),e.arc(o,a,4,0,2*Math.PI,!0),e.moveTo(o,a),e.lineTo(o-60+10,a),e.lineTo(o-60+10,r),e.moveTo(o-60+10,r-15),e.lineTo(o-60+10+20,r-15),e.moveTo(o+60-10-20,r-15),e.lineTo(o+60-10,r-15),e.moveTo(o+60-10,r),e.lineTo(o+60-10,a),e.lineTo(o,a),e.lineWidth=4,e.strokeStyle="black",e.stroke()}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalArteryOcclusionPostPole=function(t,e){this.className="RetinalArteryOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RetinalArteryOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalArteryOcclusionPostPole.prototype.constructor=ED.RetinalArteryOcclusionPostPole,ED.RetinalArteryOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalArteryOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalArteryOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalArteryOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalArteryOcclusionPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.RetinalArteryOcclusionPostPole.superclass.draw.call(this,t);var i=-this.apexY,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=420*Math.sin(r),s=-420*Math.cos(r),l=-420*Math.sin(r),h=s;return e.beginPath(),e.arc(0,0,420,a,o,!0),e.arc(0,0,i,o,a,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(200,200,200,0.5)",e.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(e.beginPath(),e.arc(0,0,-this.apexY,0,2*Math.PI,!0),e.fillStyle="rgba(200,0,0,0.5)",e.fill()),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalArteryOcclusionPostPole.prototype.description=function(){var t="";switch(this.type()){case"branch":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",t+="branch ";break;case"hemispheric":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",t+="hemispheric ";break;case"central":t+="Central "}return t+="retinal artery occlusion",this.apexY<-150?t+=" sparing":t+=" involving",t+=" the macula",this.apexY>-70&&(t+=" with a cherry red spot"),t},ED.RetinalArteryOcclusionPostPole.prototype.snomedCode=function(){switch(this.type()){case"branch":case"hemispheric":return 232035005;case"central":return 38742007}},ED.RetinalArteryOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.RetinalHaemorrhage=function(t,e){this.className="RetinalHaemorrhage",this.layer="Pre-retinal",this.savedParameterArray=["originX","originY","scaleX","scaleY"],this.controlParameterArray={layer:"Layer"},ED.Doodle.call(this,t,e)},ED.RetinalHaemorrhage.prototype=new ED.Doodle,ED.RetinalHaemorrhage.prototype.constructor=ED.RetinalHaemorrhage,ED.RetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.RetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.layer={kind:"other",type:"string",list:["Pre-retinal","Intra-retinal","Sub-retinal","Sub-RPE"],animate:!1}},ED.RetinalHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-60),this.setParameterFromString("layer","Pre-retinal")},ED.RetinalHaemorrhage.prototype.draw=function(t){var e=this.drawing.context;ED.RetinalHaemorrhage.superclass.draw.call(this,t);switch(e.beginPath(),e.arc(0,0,90,0,2*Math.PI,!0),e.lineWidth=1,this.layer){case"Pre-retinal":e.fillStyle="rgba(255,0,0,1.0)",e.strokeStyle=e.fillStyle;break;case"Intra-retinal":e.fillStyle="rgba(255,0,0,0.75)",e.strokeStyle=e.fillStyle;break;case"Sub-retinal":e.fillStyle="rgba(255,0,0,0.5)",e.strokeStyle=e.fillStyle;break;case"Sub-RPE":e.fillStyle="rgba(255,0,0,0.25)",e.strokeStyle=e.fillStyle}this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(90,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalHaemorrhage.prototype.groupDescription=function(){var t="";switch(this.layer){case"Pre-retinal":t="Pre-retinal";break;case"Intra-retinal":t="Intra-retinal";break;case"Sub-retinal":t="Sub-retinal";break;case"Sub-RPE":t="Sub-RPE"}return t+=" haemorrhage"},ED.RetinalTouch=function(t,e){this.className="RetinalTouch",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.RetinalTouch.prototype=new ED.Doodle,ED.RetinalTouch.prototype.constructor=ED.RetinalTouch,ED.RetinalTouch.superclass=ED.Doodle.prototype,ED.RetinalTouch.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.RetinalTouch.prototype.draw=function(t){var e=this.drawing.context;if(ED.RetinalTouch.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,60,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,0,0,0)",e.strokeStyle="rgba(255,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,20,0,2*Math.PI,!0);for(var i=0,r=0;r<8;r++){i+=2*Math.PI/8;var a=new ED.Point(0,0),o=new ED.Point(0,0);a.setWithPolars(20,i),o.setWithPolars(40,i),e.moveTo(a.x,a.y),e.lineTo(o.x,o.y)}e.lineWidth=8,e.strokeStyle="red",e.stroke()}return this.isClicked},ED.RetinalVeinOcclusionPostPole=function(t,e){this.className="RetinalVeinOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RetinalVeinOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalVeinOcclusionPostPole.prototype.constructor=ED.RetinalVeinOcclusionPostPole,ED.RetinalVeinOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalVeinOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalVeinOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalVeinOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalVeinOcclusionPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.RetinalVeinOcclusionPostPole.superclass.draw.call(this,t);var i=-this.apexY,r=i+(420-i)/2,a=this.arc/2,o=-Math.PI/2+a,n=-Math.PI/2-a,s=420*Math.sin(a),l=-420*Math.cos(a),h=-420*Math.sin(a),d=l;if(e.beginPath(),e.arc(0,0,420,o,n,!0),e.arc(0,0,i,n,o,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=[26,24,22,18,14,10],p=0;for(r=390;r>i;r-=60){for(var y=0,D=-Math.PI/2-o;D<this.arc-Math.PI/2-o;D+=60/r){D=-Math.PI/2-o+2*y*Math.PI/c[p];var u=new ED.Point(0,0);u.setWithPolars(r,D),this.drawNFLHaem(e,u.x,u.y),y++}p++}}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(h,d)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(s,l)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RetinalVeinOcclusionPostPole.prototype.description=function(){var t="";switch(this.type()){case"branch":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",t+="branch ";break;case"hemispheric":t=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",t+="hemispheric ";break;case"central":t+="Central "}return t+="retinal vein occlusion ",this.apexY<-150?t+="sparing ":t+="involving ",t+="the macula "},ED.RetinalVeinOcclusionPostPole.prototype.snomedCode=function(){switch(this.type()){case"branch":return 24596005;case"hemispheric":return 232043e3;case"central":return 68478007}},ED.RetinalVeinOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.Retinoschisis=function(t,e){this.className="Retinoschisis",this.savedParameterArray=["arc","rotation","apexY"],ED.Doodle.call(this,t,e)},ED.Retinoschisis.prototype=new ED.Doodle,ED.Retinoschisis.prototype.constructor=ED.Retinoschisis,ED.Retinoschisis.superclass=ED.Doodle.prototype,ED.Retinoschisis.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Retinoschisis.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!0,this.rangeOfScale=new ED.Range(1,4),this.rangeOfArc=new ED.Range(Math.PI/6,2*Math.PI),this.rangeOfApexX=new ED.Range(-0,0),this.rangeOfApexY=new ED.Range(-400,400)},ED.Retinoschisis.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.rotation=225*Math.PI/180,this.apexY=-260},ED.Retinoschisis.prototype.draw=function(t){var e=this.drawing.context;ED.Retinoschisis.superclass.draw.call(this,t);var i=476,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);if(this.apexY<-25)e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);else if(this.apexY<25){var d=Math.acos((0-this.apexY)/25),c=25*Math.sin(d);e.bezierCurveTo(l,h,.6*l,this.apexY,-c,this.apexY),e.arc(0,0,25,-Math.PI/2-d,-Math.PI/2+d,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s)}else e.bezierCurveTo(l,h,.6*l,this.apexY,0,25),e.arc(0,0,25,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);return e.lineWidth=4,e.fillStyle="rgba(0, 255, 255, 0.75)",e.strokeStyle="rgba(0, 200, 255, 0.75)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Retinoschisis.prototype.description=function(){if(this.drawing.eye==ED.eye.Right)var t=!0;else t=!1;var e="";return e+=Math.cos(this.rotation)>0?"Supero":"Infero",e+=Math.sin(this.rotation)>0?t?"nasal":"temporal":t?"temporal":"nasal",e+=" retinoschisis"},ED.Retinoschisis.prototype.snomedCode=function(){return 44268007},ED.Retinoschisis.prototype.diagnosticHierarchy=function(){return 0},ED.RetinoscopyPowerCross=function(t,e){this.className="RetinoscopyPowerCross",this.workingDistance=.5,this.angle1=180,this.angle2=90,this.powerSign1="+",this.powerSign2="+",this.powerInt1=0,this.powerInt2=0,this.powerDp1=".00",this.powerDp2=".00",this.savedParameterArray=["rotation","powerSign1","powerSign2","powerInt1","powerInt2","powerDp1","powerDp2"],this.controlParameterArray={},ED.Doodle.call(this,t,e)},ED.RetinoscopyPowerCross.prototype=new ED.Doodle,ED.RetinoscopyPowerCross.prototype.constructor=ED.RetinoscopyPowerCross,ED.RetinoscopyPowerCross.superclass=ED.Doodle.prototype,ED.RetinoscopyPowerCross.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.rotation.range.setMinAndMax(Math.PI,2*Math.PI),this.parameterValidationArray.workingDistance={kind:"derived",type:"string",list:["0.333","0.500","0.667","1.000","1.500"],animate:!0},this.parameterValidationArray.angle1={kind:"derived",type:"int",range:new ED.Range(1,180),animate:!0},this.parameterValidationArray.powerSign1={kind:"derived",type:"string",list:["+","-"],animate:!0},this.parameterValidationArray.powerInt1={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.powerDp1={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0},this.parameterValidationArray.angle2={kind:"derived",type:"int",range:new ED.Range(1,180),animate:!0},this.parameterValidationArray.powerSign2={kind:"derived",type:"string",list:["+","-"],animate:!0},this.parameterValidationArray.powerInt2={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.powerDp2={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0}},ED.RetinoscopyPowerCross.prototype.setParameterDefaults=function(){this.rotation=Math.PI},ED.RetinoscopyPowerCross.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"angle1":i.rotation=2*Math.PI-parseFloat(e*Math.PI/180),i.angle2=parseInt(e)>90?parseInt(e)-90:parseInt(e)+90;break;case"rotation":var r=Math.round(180*e/Math.PI);i.angle1=360-r,i.angle2=360-r>90?360-r-90:360-r+90}return i},ED.RetinoscopyPowerCross.prototype.draw=function(t){var e=340,i=this.drawing.context;if(ED.RetinoscopyPowerCross.superclass.draw.call(this,t),i.moveTo(-e,-e),i.lineTo(-e,e),i.lineTo(e,e),i.lineTo(e,-e),i.lineTo(-e,-e),i.fillStyle="rgba(255, 255, 255, 0)",i.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var r,a;i.beginPath(),i.moveTo(0,-e),i.lineTo(0,e),i.moveTo(e,0),i.lineTo(-e,0),i.lineWidth=7,i.fillStyle="rgba(255, 255, 255, 0)",i.strokeStyle="black",i.stroke(),i.save(),i.rotate(-this.rotation),i.font="48px Arial",i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.beginPath();var o=410;r=o*Math.cos(this.rotation),a=-o*Math.sin(-this.rotation),i.fillText(this.angle1+"",r,a),r=-o*Math.sin(this.rotation),a=o*Math.cos(this.rotation),i.fillText(this.angle2+"",r,a),r=-o*Math.cos(this.rotation),a=o*Math.sin(-this.rotation),i.fillText(this.powerSign1+parseInt(this.powerInt1)+this.powerDp1,r,a),r=o*Math.sin(this.rotation),a=-o*Math.cos(-this.rotation),i.fillText(this.powerSign2+parseInt(this.powerInt2)+this.powerDp2,r,a),i.restore()}return this.isClicked},ED.RetinoscopyPowerCross.prototype.calcRx=function(){var t=(1/this.workingDistance).toFixed(2),e=parseFloat(this.powerSign1+parseInt(this.powerInt1)+this.powerDp1),i=parseFloat(this.powerSign2+parseInt(this.powerInt2)+this.powerDp2),r=e>=i?(e-t).toFixed(2):(i-t).toFixed(2),a=(-1*Math.abs(e-i)).toFixed(2),o=e>=i?this.angle2:this.angle1;return o>180&&(o-=180),(o-=90)<0&&(o+=180),{pSphere:r,pCyl:a,angle:o}},ED.RetinoscopyPowerCross.prototype.description=function(){calcRx=this.calcRx();var t=calcRx.pSphere>=0?"+"+calcRx.pSphere:calcRx.pSphere;return t+=0==calcRx.pCyl?" / -":" / ",t+=calcRx.pCyl+" x "+calcRx.angle},ED.RingSegment=function(t,e){this.className="RingSegment",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.RingSegment.prototype=new ED.Doodle,ED.RingSegment.prototype.constructor=ED.RingSegment,ED.RingSegment.superclass=ED.Doodle.prototype,ED.RingSegment.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.RingSegment.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2)},ED.RingSegment.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t?(this.rotation=t.rotation+Math.PI,this.arc=t.arc):this.drawing.eye==ED.eye.Right?this.rotation=-Math.PI/2:this.rotation=Math.PI/2},ED.RingSegment.prototype.draw=function(t){var e=this.drawing.context;ED.RingSegment.superclass.draw.call(this,t);e.beginPath();var i=this.arc/2;e.arc(0,0,320,-Math.PI/2+i,-Math.PI/2-i,!0),e.arc(0,0,280,-Math.PI/2-i,-Math.PI/2+i,!1),e.closePath(),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t);var r=new ED.Point(0,0);return r.setWithPolars(300,i),this.handleArray[3].location=this.transform.transformPoint(r),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RingSegment.prototype.description=function(){var t="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.RK=function(t,e){this.className="RK",this.numberOfCuts="8",this.savedParameterArray=["apexY","scaleX","scaleY","rotation","numberOfCuts"],this.controlParameterArray={numberOfCuts:"Number of Cuts"},ED.Doodle.call(this,t,e)},ED.RK.prototype=new ED.Doodle,ED.RK.prototype.constructor=ED.RK,ED.RK.superclass=ED.Doodle.prototype,ED.RK.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RK.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.15),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-60),this.parameterValidationArray.numberOfCuts={kind:"other",type:"string",list:["4","8","16"],animate:!1}},ED.RK.prototype.setParameterDefaults=function(){this.apexY=-100},ED.RK.prototype.draw=function(t){var e=this.drawing.context;ED.RK.superclass.draw.call(this,t);var i=-this.apexY,r=parseInt(this.numberOfCuts),a=2*Math.PI;if(e.beginPath(),e.arc(0,0,320,0,a,!0),e.moveTo(i,0),e.arc(0,0,i,a,0,!1),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var o,n=2*Math.PI/r;for(e.strokeStyle="rgba(100,100,100,0.7)",e.beginPath(),o=0;o<r;o++){var s=o*n,l=new ED.Point(0,0);l.setWithPolars(i,s);var h=new ED.Point(0,0);h.setWithPolars(320,s),e.moveTo(l.x,l.y),e.lineTo(h.x,h.y),e.closePath()}e.stroke()}var d=new ED.Point(0,0);return d.setWithPolars(320,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RK.prototype.description=function(){return"Radial keratotomy"},ED.RoundHole=function(t,e){this.className="RoundHole",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.RoundHole.prototype=new ED.Doodle,ED.RoundHole.prototype.constructor=ED.RoundHole,ED.RoundHole.superclass=ED.Doodle.prototype,ED.RoundHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RoundHole.prototype.setPropertyDefaults=function(){},ED.RoundHole.prototype.setParameterDefaults=function(){this.originX=300,this.originY=300;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=e.direction()+Math.PI/8,r=e.length(),a=new ED.Point(0,0);a.setWithPolars(r,i),this.originX=a.x,this.originY=a.y}},ED.RoundHole.prototype.draw=function(t){var e=this.drawing.context;ED.RoundHole.superclass.draw.call(this,t),e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t);var i=this.transform.transformPoint(new ED.Point(0,0)),r=this.transform.transformPoint(new ED.Point(60,0)),a=i.x-this.drawing.canvas.width/2,o=i.y-this.drawing.canvas.height/2,n=this.scaleX*Math.sqrt(a*a+o*o),s=this.scaleX*(r.x-i.x);return this.arc=Math.atan(s/n),this.isClicked},ED.RoundHole.prototype.description=function(){var t="";return this.scaleX<1&&(t="Small "),this.scaleX>1.5&&(t="Large "),t+="Round hole ",t+=this.clockHour()+" o'clock"},ED.RoundHole.prototype.snomedCode=function(){return 302888003},ED.RoundHole.prototype.diagnosticHierarchy=function(){return 0},ED.RPEAtrophy=function(t,e){this.className="RPEAtrophy",this.savedParameterArray=["originX","originY","scaleX","scaleY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.RPEAtrophy.prototype=new ED.Doodle,ED.RPEAtrophy.prototype.constructor=ED.RPEAtrophy,ED.RPEAtrophy.superclass=ED.Doodle.prototype,ED.RPEAtrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RPEAtrophy.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,80),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.originX.range.setMinAndMax(-290,180),this.parameterValidationArray.originY.range.setMinAndMax(-250,250)},ED.RPEAtrophy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-60),this.apexX=40},ED.RPEAtrophy.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"scaleY":this.parameterValidationArray.originX.range.setMinAndMax(72*e-290-72,180-72*e+72),this.parameterValidationArray.originY.range.setMinAndMax(72*e-250-72,250-72*e+72);var r=this.parameterValidationArray.originY.range.constrain(this.originY),a=this.parameterValidationArray.originX.range.constrain(this.originX);this.setSimpleParameter("originX",a),this.setSimpleParameter("originY",r)}return i},ED.RPEAtrophy.prototype.draw=function(t){var e=this.drawing.context;ED.RPEAtrophy.superclass.draw.call(this,t);if(e.beginPath(),e.arc(0,0,72,0,2*Math.PI,!0),e.lineWidth=1,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var i="rgba(111, 82, 76, "+(.2+this.apexX/100)+")",r=10/this.scaleX,a=new ED.Point(0,0),o=40+Math.abs(Math.floor(this.apexY/2)),n=0;n<o;n++)a.setWithPolars(72*ED.randomArray[n],2*Math.PI*ED.randomArray[n+100]),this.drawSpot(e,a.x,a.y,r,i);var s=new ED.Point(0,0);return s.setWithPolars(72,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(s),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPEAtrophy.prototype.groupDescription=function(){return"RPE atrophy"},ED.RPEDetachment=function(t,e){this.className="RPEDetachment",this.numberOfHandles=4,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.RPEDetachment.prototype=new ED.Doodle,ED.RPEDetachment.prototype.constructor=ED.RPEDetachment,ED.RPEDetachment.superclass=ED.Doodle.prototype,ED.RPEDetachment.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.RPEDetachment.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,290),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}},ED.RPEDetachment.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+150,0);this.move(e.x,e.y)}var i=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(i);for(var r=0;r<this.numberOfHandles;r++){var a=new ED.Point(0,0);a.setWithPolars(this.initialRadius,2*r*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}},ED.RPEDetachment.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.RPEDetachment.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=4,o.fillStyle="rgba(173, 48, 14, 1)",o.strokeStyle="brown",this.drawBoundary(t);for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPEDetachment.prototype.description=function(){return"Retinal pigment epithelial detachment"},ED.RPEDetachment.prototype.snomedCode=function(){"use strict";return 232067008},ED.RPEHypertrophy=function(t,e){this.className="RPEHypertrophy",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.RPEHypertrophy.prototype=new ED.Doodle,ED.RPEHypertrophy.prototype.constructor=ED.RPEHypertrophy,ED.RPEHypertrophy.superclass=ED.Doodle.prototype,ED.RPEHypertrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RPEHypertrophy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-300,-60)},ED.RPEHypertrophy.prototype.draw=function(t){var e=this.drawing.context;ED.RPEHypertrophy.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,60,0,2*Math.PI,!0),e.lineWidth=1,e.fillStyle="rgba(145, 96, 80, 1.0)",e.strokeStyle=e.fillStyle,this.drawBoundary(t);var i=new ED.Point(0,0);return i.setWithPolars(60,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPEHypertrophy.prototype.groupDescription=function(){return"RPE hypertrophy"},ED.RPERip=function(t,e){this.className="RPERip",this.initialRadius=150,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RPERip.prototype=new ED.Doodle,ED.RPERip.prototype.constructor=ED.RPERip,ED.RPERip.superclass=ED.Doodle.prototype,ED.RPERip.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RPERip.prototype.setPropertyDefaults=function(){this.parameterValidationArray.originX.range.setMinAndMax(-120,120),this.parameterValidationArray.originY.range.setMinAndMax(-120,120),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.initialRadius,+this.initialRadius),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.RPERip.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setRotationWithDisplacements(90,0),this.setOriginWithDisplacements(0,100)},ED.RPERip.prototype.draw=function(t){var e=this.drawing.context;ED.RPERip.superclass.draw.call(this,t);var i=this.initialRadius,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=4,e.fillStyle="rgba(251, 147, 76, 0.75)",e.strokeStyle="red",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,i,a,o,!0);e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s),e.lineWidth=4,e.fillStyle="rgba(180, 125, 60, 0.75)",e.strokeStyle="brown",e.fill(),e.stroke()}this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));var d=new ED.Point(0,0);return d.setWithPolars(i,Math.PI/8),this.handleArray[3].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RPERip.prototype.description=function(){return"RPE rip"},ED.RRD=function(t,e){this.className="RRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.RRD.prototype=new ED.Doodle,ED.RRD.prototype.constructor=ED.RRD,ED.RRD.superclass=ED.Doodle.prototype,ED.RRD.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this._isMacOff=!1,this.drawing.eye==ED.eye.Right?this._macPoint=new ED.Point(-100,0):this._macPoint=new ED.Point(100,0),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.RRD.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RRD.prototype.draw=function(t){var e=this.drawing.context;ED.RRD.superclass.draw.call(this,t);var i=476,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;e.beginPath(),e.arc(0,0,i,a,o,!0);if(this.apexY<-25)e.bezierCurveTo(l,h,.6*l,this.apexY,this.apexX,this.apexY),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);else if(this.apexY<25){var d=Math.acos((0-this.apexY)/25),c=25*Math.sin(d);e.bezierCurveTo(l,h,.6*l,this.apexY,-c,this.apexY),e.arc(0,0,25,-Math.PI/2-d,-Math.PI/2+d,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s)}else e.bezierCurveTo(l,h,.6*l,this.apexY,0,25),e.arc(0,0,25,Math.PI/2,2.5*Math.PI,!1),e.bezierCurveTo(-.6*l,this.apexY,n,s,n,s);e.lineWidth=4,e.fillStyle="rgba(0, 0, 255, 0.75)",e.strokeStyle="blue",this.drawBoundary(t);var p=this.drawing.transform.transformPoint(this._macPoint);return this._isMacOff=this.hitTest(e,p),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(n,s)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.RRD.prototype.description=function(){var t="";return t+=Math.cos(this.rotation)>0?"Supero":"Infero",t+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",t+=" retinal detachment",t+=this.isMacOff()?" (macula off)":" (macula on)"},ED.RRD.prototype.snomedCode=function(){return this.isMacOff()?232009009:232008001},ED.RRD.prototype.diagnosticHierarchy=function(){return 0},ED.RRD.prototype.isMacOff=function(){return this._isMacOff},ED.Rubeosis=function(t,e){this.className="Rubeosis",this.severity=50,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Rubeosis.prototype=new ED.Doodle,ED.Rubeosis.prototype.constructor=ED.Rubeosis,ED.Rubeosis.superclass=ED.Doodle.prototype,ED.Rubeosis.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rubeosis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-200),this.parameterValidationArray.severity={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.Rubeosis.prototype.setParameterDefaults=function(){this.arc=Math.PI/12,this.setRotationWithDisplacements(90,45);var t=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=t?t.apexY-this.severity:-320},ED.Rubeosis.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"severity":(r=this.drawing.lastDoodleOfClass("AntSeg"))&&(i.apexY=r.apexY-e);break;case"apexY":var r;(r=this.drawing.lastDoodleOfClass("AntSeg"))&&(i.severity=r.apexY-e)}return i},ED.Rubeosis.prototype.draw=function(t){var e=this.drawing.context;ED.Rubeosis.superclass.draw.call(this,t);var i=200,r=this.drawing.lastDoodleOfClass("AntSeg");r&&(i=-r.apexY);var a=i+16;this.parameterValidationArray.apexY.range.max=-i-50,this.apexY=this.parameterValidationArray.apexY.range.constrain(-i-this.severity);var o=-this.apexY,n=a+(o-a)/2;e.beginPath();var s=this.arc/2,l=-Math.PI/2+s,h=-Math.PI/2-s,d=new ED.Point(-n*Math.sin(s),-n*Math.cos(s)),c=new ED.Point(n*Math.sin(s),-n*Math.cos(s));if(e.beginPath(),e.arc(0,0,a,l,h,!0),e.arc(0,0,o,h,l,!1),e.closePath(),e.fillStyle=this.isSelected?"rgba(240,240,240,0.5)":"rgba(240,240,240,0.0)",e.lineWidth=1,e.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();for(var p=2*Math.PI/16,y=Math.PI/24,D=2*Math.PI/60,u=i+2*(o-i)/3,g=1+Math.floor(this.arc/p),P=0;P<g;P++){var E=d.pointAtRadiusAndClockwiseAngle(i,y+P*p),m=d.pointAtRadiusAndClockwiseAngle(o,y+P*p+D),f=d.pointAtRadiusAndClockwiseAngle(u,y+P*p),w=d.pointAtRadiusAndClockwiseAngle(o,y+P*p+D/2);e.moveTo(E.x,E.y),e.bezierCurveTo(f.x,f.y,w.x,w.y,m.x,m.y),m=d.pointAtRadiusAndClockwiseAngle(o,y+P*p-D),f=d.pointAtRadiusAndClockwiseAngle(u,y+P*p),w=d.pointAtRadiusAndClockwiseAngle(o,y+P*p-D/2),e.moveTo(E.x,E.y),e.bezierCurveTo(f.x,f.y,w.x,w.y,m.x,m.y)}e.lineWidth=4,e.strokeStyle="red",e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(d),this.handleArray[3].location=this.transform.transformPoint(c),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Rubeosis.prototype.groupDescription=function(){return"Rubeotic vessels on margin of pupil at "},ED.Rubeosis.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Rubeosis.prototype.snomedCode=function(){return 51995e3},ED.ScleralIncision=function(t,e){this.className="ScleralIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.ScleralIncision.prototype=new ED.Doodle,ED.ScleralIncision.prototype.constructor=ED.ScleralIncision,ED.ScleralIncision.superclass=ED.Doodle.prototype,ED.ScleralIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.ScleralIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI/2)},ED.ScleralIncision.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.ScleralIncision.prototype.draw=function(t){var e=this.drawing.context;ED.ScleralIncision.superclass.draw.call(this,t);var i=560;e.beginPath();var r=this.arc/2;if(e.arc(0,0,600,-Math.PI/2+r,-Math.PI/2-r,!0),e.arc(0,0,520,-Math.PI/2-r,-Math.PI/2+r,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0)",e.lineWidth=5,e.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,i,-Math.PI/2+r,-Math.PI/2-r,!0);var a=new ED.Point(0,0),o=r-.1;do{a.setWithPolars(520,o),e.moveTo(a.x,a.y),a.setWithPolars(600,o),e.lineTo(a.x,a.y),o-=.2}while(o>-r);e.lineWidth=6,e.strokeStyle="rgba(120,120,120,0.75)",e.stroke()}var n=new ED.Point(0,0);return n.setWithPolars(i,r),this.handleArray[3].location=this.transform.transformPoint(n),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ScleralIncision.prototype.groupDescription=function(){return"Scleral incision at "},ED.ScleralIncision.prototype.description=function(){return this.clockHour()},ED.ScleralIncision.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.Sclerostomy=function(t,e){this.className="Sclerostomy",this.parsPlana=-560,this.overallGauge="23g",this.gauge="23g",this.isSutured=!1,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.Sclerostomy.prototype=new ED.Doodle,ED.Sclerostomy.prototype.constructor=ED.Sclerostomy,ED.Sclerostomy.superclass=ED.Doodle.prototype,ED.Sclerostomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Sclerostomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-660,-460),this.parameterValidationArray.overallGauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.gauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.isSutured={kind:"derived",type:"bool",display:!0}},ED.Sclerostomy.prototype.setParameterDefaults=function(){this.apexY=-600,this.gauge="23g",this.isSutured=!1,this.arc=1,this.setRotationWithDisplacements(60,-45)},ED.Sclerostomy.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexY":i.gauge=e<-610?"20g":e<-560?"23g":e<-510?"25g":"27g";break;case"overallGauge":i.gauge=e;break;case"gauge":i.apexY="20g"==e?-650:"23g"==e?-600:"25g"==e?-550:-500;break;case"arc":i.isSutured=!(e<2);break;case"isSutured":i.arc=e?3:1}return i},ED.Sclerostomy.prototype.draw=function(t){var e=this.drawing.context;if(ED.Sclerostomy.superclass.draw.call(this,t),e.beginPath(),e.rect(-60,this.parsPlana-120,120,160),e.lineWidth=2,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.gauge){case"20g":e.beginPath(),e.moveTo(-50,this.parsPlana),e.bezierCurveTo(-30,this.parsPlana-30,30,this.parsPlana-30,50,this.parsPlana),e.bezierCurveTo(30,this.parsPlana+30,-30,this.parsPlana+30,-50,this.parsPlana),e.closePath(),e.fillStyle="red",e.fill();break;case"23g":e.beginPath(),e.rect(-60,this.parsPlana-120,120,60),e.fillStyle="rgba(0, 0, 255, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana-60,60,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-30,this.parsPlana,60,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"25g":e.beginPath(),e.rect(-50,this.parsPlana-120,100,60),e.fillStyle="rgba(255, 128, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana-60,40,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-20,this.parsPlana,40,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill();break;case"27g":e.beginPath(),e.rect(-40,this.parsPlana-120,80,60),e.fillStyle="rgba(0, 255, 0, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana-60,30,60),e.fillStyle="rgba(120, 120, 120, 0.5)",e.fill(),e.beginPath(),e.rect(-15,this.parsPlana,30,100),e.fillStyle="rgba(220, 220, 220, 0.5)",e.fill()}e.fill(),(this.isSutured||"20g"==this.gauge)&&(e.beginPath(),e.moveTo(-40,this.parsPlana+40),e.lineTo(-40,this.parsPlana-40),e.lineTo(40,this.parsPlana+40),e.lineTo(40,this.parsPlana-40),e.lineTo(-40,this.parsPlana+40),e.lineWidth=6,e.strokeStyle="rgba(0,0,120,0.7)",e.closePath(),e.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Sclerostomy.prototype.drawHighlightExtras=function(){var t=this.drawing.context;t.lineWidth=1,t.fillStyle="gray",t.font="64px sans-serif",t.fillText(this.gauge,80,this.parsPlana+20)},ED.Sclerostomy.prototype.groupDescription=function(){return"Sclerostomies at "},ED.Sclerostomy.prototype.description=function(){var t=this.isSutured?" (sutured)":"";return this.clockHour()+t},ED.Sclerostomy.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.SectorIridectomy=function(t,e){this.className="SectorIridectomy",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorIridectomy.prototype=new ED.Doodle,ED.SectorIridectomy.prototype.constructor=ED.SectorIridectomy,ED.SectorIridectomy.superclass=ED.Doodle.prototype,ED.SectorIridectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorIridectomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300)},ED.SectorIridectomy.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);t&&(this.rotation=t.rotation+Math.PI/2)},ED.SectorIridectomy.prototype.draw=function(t){var e=this.drawing.context;ED.SectorIridectomy.superclass.draw.call(this,t);var i,r=this.drawing.lastDoodleOfClass("AntSeg"),a=(i=r?-r.apexY-2:300)+(376-i)/2,o=this.arc/2,n=(Math.PI,Math.PI,a*Math.sin(o)),s=-a*Math.cos(o),l=-a*Math.sin(o),h=s;e.beginPath();o=this.arc/2;return e.arc(0,0,376,-Math.PI/2+o,-Math.PI/2-o,!0),e.arc(0,0,i,-Math.PI/2-o,-Math.PI/2+o,!1),e.closePath(),e.fillStyle="rgba(218,230,241,1)",e.lineWidth=4,e.strokeStyle="rgba(218,230,241,1)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorIridectomy.prototype.description=function(){var t="Sector iridectomy of "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return t+=this.clockHour()+" o'clock"},ED.SectorPRP=function(t,e){this.className="SectorPRP",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorPRP.prototype=new ED.Doodle,ED.SectorPRP.prototype.constructor=ED.SectorPRP,ED.SectorPRP.superclass=ED.Doodle.prototype,ED.SectorPRP.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRP.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0)},ED.SectorPRP.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRP.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRP.superclass.draw.call(this,t);var i=288,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,476,a,o,!0),e.arc(0,0,100,o,a,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=[47,41,35,28,22,15],c=0;for(i=446;i>100;i-=60){for(var p=0,y=-Math.PI/2-a;y<this.arc-Math.PI/2-a;y+=60/i){y=-Math.PI/2-a+2*p*Math.PI/d[c];var D=new ED.Point(0,0);D.setWithPolars(i,y),this.drawLaserSpot(e,D.x,D.y),p++}c++}}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorPRPPostPole=function(t,e){this.className="SectorPRPPostPole",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SectorPRPPostPole.prototype=new ED.Doodle,ED.SectorPRPPostPole.prototype.constructor=ED.SectorPRPPostPole,ED.SectorPRPPostPole.superclass=ED.Doodle.prototype,ED.SectorPRPPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRPPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.SectorPRPPostPole.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRPPostPole.prototype.draw=function(t){var e=this.drawing.context;ED.SectorPRPPostPole.superclass.draw.call(this,t);var i=400,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,500,a,o,!0),e.arc(0,0,300,o,a,!1),e.closePath(),e.lineWidth=40,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=[47,41,35,28,22,15],c=0;for(i=470;i>300;i-=60){for(var p=0,y=-Math.PI/2-a;y<this.arc-Math.PI/2-a;y+=60/i){y=-Math.PI/2-a+2*p*Math.PI/d[c];var D=new ED.Point(0,0);D.setWithPolars(i,y),this.drawLaserSpot(e,D.x,D.y),p++}c++}}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SectorPRPPostPole.prototype.description=function(){return"Sector PRP"},ED.SidePort=function(t,e){this.className="SidePort",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.SidePort.prototype=new ED.Doodle,ED.SidePort.prototype.constructor=ED.SidePort,ED.SidePort.superclass=ED.Doodle.prototype,ED.SidePort.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0},ED.SidePort.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(90,180)},ED.SidePort.prototype.draw=function(t){var e=this.drawing.context;ED.SidePort.superclass.draw.call(this,t);e.beginPath();return e.arc(0,0,364,-Math.PI/2+.125,-Math.PI/2-.125,!0),e.arc(0,0,304,-Math.PI/2-.125,-Math.PI/2+.125,!1),e.closePath(),e.fillStyle="rgba(200,200,200,0.75)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.isClicked},ED.SidePort.prototype.groupDescription=function(){return"Sideport at "},ED.SidePort.prototype.description=function(){return this.clockHour()},ED.SidePort.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.SMILE=function(t,e){this.className="SMILE",this.diameter=8,this.incisionLength=0,this.thickness=15,this.spotSeparation="",this.lineSeparation="",this.energyLevel="",this.savedParameterArray=["scaleX","scaleY","arc","diameter","incisionLength","thickness","spotSeparation","lineSeparation","energyLevel"],this.controlParameterArray={diameter:"lenticule diameter (mm)",incisionLength:"Pocket length (mm)",thickness:"Lenticule bed thickness (um)",spotSeparation:"Spot separation",lineSeparation:"Line separation",energyLevel:"Energy level (uJ)"},ED.Doodle.call(this,t,e)},ED.SMILE.prototype=new ED.Doodle,ED.SMILE.prototype.constructor=ED.SMILE,ED.SMILE.superclass=ED.Doodle.prototype,ED.SMILE.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.SMILE.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.7,.9),this.parameterValidationArray.scaleY.range.setMinAndMax(.7,.9),this.parameterValidationArray.arc.range.setMinAndMax(1/3,2/3),this.parameterValidationArray.diameter={kind:"derived",type:"float",range:new ED.Range(7,9),precision:1,animate:!0},this.parameterValidationArray.incisionLength={kind:"derived",type:"float",range:new ED.Range(2,4),precision:1,animate:!0},this.parameterValidationArray.thickness={kind:"other",type:"int",range:new ED.Range(10,30),animate:!1},this.parameterValidationArray.spotSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.lineSeparation={kind:"other",type:"string",list:["0.5um","0.6um","0.7um","0.8um","0.9um","1.0um"],animate:!1},this.parameterValidationArray.energyLevel={kind:"other",type:"float",range:new ED.Range(.1,2),precision:2,animate:!1}},ED.SMILE.prototype.setParameterDefaults=function(){this.setParameterFromString("diameter","8.0"),this.setParameterFromString("incisionLength","4.0"),this.setParameterFromString("thickness","15"),this.setParameterFromString("spotSeparation","0.6um"),this.setParameterFromString("lineSeparation","0.6um"),this.setParameterFromString("energyLevel","0.17")},ED.SMILE.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"scaleX":i.diameter=10*e;break;case"arc":i.incisionLength=6*e;break;case"diameter":i.scaleX=parseFloat(e)/10,i.scaleY=parseFloat(e)/10;break;case"incisionLength":i.arc=e/6}return i},ED.SMILE.prototype.draw=function(t){var e=this.drawing.context;ED.SMILE.superclass.draw.call(this,t);var i=320,r=this.arc/2;if(e.beginPath(),e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.fillStyle="rgba(155,255,255,0)",e.lineWidth=2,e.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,256,0,2*Math.PI,!0),e.setLineDash([8,12]),e.stroke(),e.setLineDash([]),e.beginPath();var a=-Math.PI/2+r,o=-Math.PI/2-r;e.arc(0,0,i,a,o,!0),e.arc(0,0,290,o,a,!1),e.closePath(),e.fillStyle="rgba(100,100,200,0.75)",e.fill()}var n=new ED.Point(-i*Math.sin(r),-i*Math.cos(r));this.handleArray[0].location=this.transform.transformPoint(n);var s=new ED.Point(0,0);return s.setWithPolars(i,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(s),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SMILE.prototype.description=function(){return"SMILE","SMILE"},ED.SPEE=function(t,e){this.className="SPEE",this.savedParameterArray=["originX","originY","apexY","apexX","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.SPEE.prototype=new ED.Doodle,ED.SPEE.prototype.constructor=ED.SPEE,ED.SPEE.superclass=ED.Doodle.prototype,ED.SPEE.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1),this.handleArray[4].isRotatable=!0},ED.SPEE.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-400,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400),this.handleVectorRangeArray=new Array;var t=new Object;t.length=new ED.Range(1,150),t.angle=new ED.Range(.5*Math.PI,.5*Math.PI),this.handleVectorRangeArray[0]=t},ED.SPEE.prototype.setParameterDefaults=function(){this.originX=150,this.originY=40,this.apexY=-50,this.apexX=170;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(40,0);this.addPointToSquiggle(e)},ED.SPEE.prototype.draw=function(t){var e=this.drawing.context;if(ED.SPEE.superclass.draw.call(this,t),e.beginPath(),e.ellipse(0,0,Math.abs(this.apexY),Math.abs(this.apexX),.5*Math.PI,0,2*Math.PI),e.lineWidth=1,e.strokeStyle="rgba(0, 0, 0, 0)",e.fillStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var i="rgba(50,205,50,1)",r=this.squiggleArray[0].pointsArray[0].x,a=Math.PI*Math.abs(this.apexX*this.apexY)/250*(r/30),o=new ED.Point(0,0),n=0;n<a;n++){var s=n<150?n:n<199?n-50:n<249?n-100:n<299?n-150:n<349?n-200:n-250,l=n<200?n:n<398?n-199:n<397?n-298:n-396,h=Math.sqrt(a*ED.randomArray[l]),d=this.apexX*ED.randomArray[l],c=this.apexY*ED.randomArray[s],p=2*Math.PI*ED.randomArray[s+50];o.x=d*Math.cos(p*h),o.y=c*Math.sin(p*h),this.drawSpot(e,o.x,o.y,2,i)}this.drawSpot(e,0,Math.abs(this.apexY),2,i),this.drawSpot(e,0,-1*Math.abs(this.apexY),2,i),this.drawSpot(e,Math.abs(this.apexX),0,2,i),this.drawSpot(e,-1*Math.abs(this.apexX),0,2,i)}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SPEE.prototype.groupDescription=function(){return"Superficial punctate epithelial erosions"},ED.StarFold=function(t,e){this.className="StarFold",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.StarFold.prototype=new ED.Doodle,ED.StarFold.prototype.constructor=ED.StarFold,ED.StarFold.superclass=ED.Doodle.prototype,ED.StarFold.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.StarFold.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250),this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.StarFold.prototype.setParameterDefaults=function(){this.apexY=50,this.scaleX=.25,this.scaleY=.25;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=new ED.Point(0,0);i.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else this.move(0,400)},ED.StarFold.prototype.draw=function(t){var e=this.drawing.context;return ED.StarFold.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,-this.apexY),e.bezierCurveTo(100,-50,260,-240,300,-200),e.bezierCurveTo(340,-160,100,-100,2*this.apexY,0),e.bezierCurveTo(100,100,340,160,300,200),e.bezierCurveTo(260,240,100,50,0,this.apexY),e.bezierCurveTo(-100,50,-260,240,-300,200),e.bezierCurveTo(-340,160,-100,100,-2*this.apexY,0),e.bezierCurveTo(-100,-100,-340,-160,-300,-200),e.bezierCurveTo(-260,-240,-100,-50,0,-this.apexY),e.closePath(),e.lineWidth=0,e.fillStyle="lightgreen",e.strokeStyle="green",this.drawBoundary(t),this.arc=Math.atan2(600*this.scaleX,Math.abs(this.originY)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(-300,200)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.StarFold.prototype.description=function(){var t="Star fold at ";return t+=this.clockHour()+" o'clock"},ED.StarFold.prototype.snomedCode=function(){return 232018006},ED.StarFold.prototype.diagnosticHierarchy=function(){return 0},ED.SteepAxis=function(t,e){this.className="SteepAxis",this.axis="0",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.SteepAxis.prototype=new ED.Doodle,ED.SteepAxis.prototype.constructor=ED.SteepAxis,ED.SteepAxis.superclass=ED.Doodle.prototype,ED.SteepAxis.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.SteepAxis.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.SteepAxis.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"rotation":i.axis=(360-180*e/Math.PI)%180;break;case"axis":i.rotation=(180-e)*Math.PI/180}return i},ED.SteepAxis.prototype.draw=function(t){var e=this.drawing.context;ED.SteepAxis.superclass.draw.call(this,t);if(e.beginPath(),e.arc(0,0,300,0,2*Math.PI,!0),e.lineWidth=8,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-440,0),e.lineTo(440,0),e.lineWidth=8,e.strokeStyle="gray",e.stroke();e.beginPath(),e.moveTo(-300,0),e.arcTo(0,200,300,0,540),e.closePath(),e.strokeStyle="gray",e.fillStyle="lightgray",e.fill(),e.stroke()}return this.isClicked},ED.STFB=function(t,e){this.className="STFB",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.STFB.prototype=new ED.Doodle,ED.STFB.prototype.constructor=ED.STFB,ED.STFB.superclass=ED.Doodle.prototype,ED.STFB.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[2].isRotatable=!0},ED.STFB.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.originX.range.setMinAndMax(-380,380),this.parameterValidationArray.originY.range.setMinAndMax(-370,370),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.STFB.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY+70);this.move(e.x,e.y)}else this.move(120,-200);this.rotation=.25*Math.PI},ED.STFB.prototype.draw=function(t){var e=this.drawing.context;ED.STFB.superclass.draw.call(this,t),e.beginPath(),e.ellipse(0,0,15,40,0,0,2*Math.PI),e.lineWidth=3,e.fillStyle="#402A15",e.strokeStyle="#402A15",this.drawBoundary(t);var i=new ED.Point(15,-40);return this.handleArray[2].location=this.transform.transformPoint(i),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.STFB.prototype.description=function(){var t="",e="Sub tarsal foreign body";return this.originY<-110?t="Upper lid ":this.originY>110&&(t="Lower lid "),t.length>0?t+e.toLowerCase():e},ED.APattern=function(t,e){this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e),this.className="APattern"},ED.APattern.prototype=new ED.Doodle,ED.APattern.prototype.constructor=ED.APattern,ED.APattern.superclass=ED.Doodle.prototype,ED.APattern.prototype.setHandles=function(){},ED.APattern.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1},ED.APattern.prototype.setParameterDefaults=function(){this.drawing.eye==ED.eye.Right?this.rotation=Math.PI/8:this.rotation=-Math.PI/8},ED.APattern.prototype.draw=function(t){var e=this.drawing.context;ED.APattern.superclass.draw.call(this,t),e.beginPath();var i=0;for(e.moveTo(0,-500);i<1e3;)i+=4,e.lineTo(0,-500+i),i+=4,e.moveTo(0,-500+i);return e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(80, 80, 80, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.InverseYPattern=function(t,e){this.savedParameterArray=["side"],ED.Doodle.call(this,t,e),this.className="InverseYPattern"},ED.InverseYPattern.prototype=new ED.Doodle,ED.InverseYPattern.prototype.constructor=ED.InverseYPattern,ED.InverseYPattern.superclass=ED.Doodle.prototype,ED.InverseYPattern.prototype.setHandles=function(){},ED.InverseYPattern.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.InverseYPattern.prototype.setParameterDefaults=function(){this.drawing.eye==ED.eye.Right?this.side=1:this.side=-1},ED.InverseYPattern.prototype.draw=function(t){var e=this.drawing.context;ED.InverseYPattern.superclass.draw.call(this,t),e.beginPath();var i=0,r=0;for(e.moveTo(-350*this.side,450);i<185;)i+=8,r+=4,e.lineTo((-350+i)*this.side,450-r),i+=4,r+=4,e.moveTo((-350+i)*this.side,450-r);for(i=0,r=0,e.moveTo(0,-470);i<40;)r+=8,e.lineTo(0,-450+r-20),i+=4,r+=4,e.moveTo(-0,-450+r-20);return e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(80, 80, 80, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.OrthopticEye=function(t,e){this.className="OrthopticEye",ED.Doodle.call(this,t,e)},ED.OrthopticEye.prototype=new ED.Doodle,ED.OrthopticEye.prototype.constructor=ED.OrthopticEye,ED.OrthopticEye.superclass=ED.Doodle.prototype,ED.OrthopticEye.prototype.setHandles=function(){},ED.OrthopticEye.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isFilled=!1},ED.OrthopticEye.prototype.setParameterDefaults=function(){},ED.OrthopticEye.prototype.draw=function(t){var e=this.drawing.context;return ED.OrthopticEye.superclass.draw.call(this,t),this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.lineWidth=12,e.strokeStyle="rgba(80,80,80,1)",e.beginPath(),e.arc(0,150,500,3*-Math.PI/4,1*-Math.PI/4,!1),e.stroke(),e.beginPath(),e.arc(0,-150,500,1*Math.PI/4,3*Math.PI/4,!1),e.stroke()),this.isClicked},ED.OrthopticShading=function(t,e){this.className="OrthopticShading",this.uR=!1,this.cR=!1,this.dR=!1,this.rL=!1,this.cL=!1,this.dL=!1,this.savedParameterArray=["originX","originY","rotation","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.OrthopticShading.prototype=new ED.Doodle,ED.OrthopticShading.prototype.constructor=ED.OrthopticShading,ED.OrthopticShading.superclass=ED.Doodle.prototype,ED.OrthopticShading.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1),this.handleArray[3].isRotatable=!0},ED.OrthopticShading.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!0,this.isMoveable=!0,this.isRotatable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-360,360),this.parameterValidationArray.apexY.range.setMinAndMax(-360,-3)},ED.OrthopticShading.prototype.setParameterDefaults=function(){this.apexX=350,this.apexY=-100,this.setRotationWithDisplacements(0,90.5)},ED.OrthopticShading.prototype.draw=function(t){var e=this.drawing.context;ED.OrthopticShading.superclass.draw.call(this,t),e.beginPath();var i=this.apexX- -350,r=this.apexY- -350;if(e.rect(-350,-350,i,r),e.closePath(),e.fillStyle="rgba(190, 190, 190, 0.55)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(-350,this.apexY);for(var a=0;a<i-40;)a+=42,e.lineTo(-350+a,this.apexY),a+=20,e.moveTo(-350+a,this.apexY);e.lineTo(this.apexX,this.apexY),e.lineWidth=12,e.strokeStyle="rgba(80, 80, 80, 1)",e.stroke()}return this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.calculateUnderActions(),this.isClicked},ED.OrthopticShading.prototype.calculateUnderActions=function(){var t,e,i,r=this.transform.transformPoint(new ED.Point(-350,this.apexY)),a=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),o=a.y-r.y,n=a.x-r.x,s=o/n,l=r.y-s*r.x;0==n&&(s=0,l=70);new ED.Point(100,100);var h=new ED.Point(30,30),d=new ED.Point(170,170);1!==s&&(e=t=-l/(s-1),new ED.Point(t,e),i=h.distanceTo(new ED.Point(t,e)),e>=30&&e<=100&&(r.x<=100||a.x<=100)&&(r.y<=100||a.y<=100)?this.uR=i>79.192?"-4":i>59.394?"-3":i>39.596?"-2":i>19.798?"-1":"-0.5":this.uR=!1,i=d.distanceTo(new ED.Point(t,e)),e<=170&&e>=100&&(r.x>=100||a.x>=100)&&(r.y>=100||a.y>=100)?this.dL=i>79.192?"-4":i>59.394?"-3":i>39.596?"-2":i>19.798?"-1":"-0.5":this.dL=!1);var c=new ED.Point(30,100),p=new ED.Point(170,100);0===s&&0!=n||(t=((e=100)-l)/s,new ED.Point(t,e),i=c.distanceTo(new ED.Point(t,e)),this.cR=t>=30&&t<=100&&(i>56?"-4":i>42?"-3":i>28?"-2":i>14?"-1":"-0.5"),i=p.distanceTo(new ED.Point(t,e)),this.cL=t<=170&&t>=100&&(i>56?"-4":i>42?"-3":i>28?"-2":i>14?"-1":"-0.5"));var y=new ED.Point(30,170),D=new ED.Point(170,30);-1!==s&&(e=200-(t=(200-l)/(s+1)),new ED.Point(t,e),i=D.distanceTo(new ED.Point(t,e)),e>=30&&(r.x>=100||a.x>=100)&&(r.y<=100||a.y<=100)?this.uL=i>79.192?"-4":i>59.394?"-3":i>39.596?"-2":i>19.798?"-1":"-0.5":this.uL=!1,i=y.distanceTo(new ED.Point(t,e)),e<=170&&e>=100&&(r.x<=100||a.x<=100)&&(r.y>=100||a.y>=100)?this.dR=i>79.192?"-4":i>59.394?"-3":i>39.596?"-2":i>19.798?"-1":"-0.5":this.dR=!1)},ED.UpDrift=function(t,e){this.savedParameterArray=["originX","originY","quadrantPoint"],ED.Doodle.call(this,t,e),this.className="UpDrift"},ED.UpDrift.prototype=new ED.Doodle,ED.UpDrift.prototype.constructor=ED.UpDrift,ED.UpDrift.superclass=ED.Doodle.prototype,ED.UpDrift.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.UpDrift.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!1,this.snapToQuadrant=!0,this.quadrantPoint=new ED.Point(335,220),this.handleVectorRangeArray=new Array;var t=new Object;t.length=new ED.Range(50,320),t.angle=new ED.Range(1.75*Math.PI,1.75*Math.PI),this.handleVectorRangeArray[0]=t},ED.UpDrift.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(-125,-125);this.addPointToSquiggle(e)},ED.UpDrift.prototype.draw=function(t){this.scaleX=this.originX/Math.abs(this.originX),this.scaleY=this.originY/Math.abs(this.originY);var e=this.drawing.context;ED.UpDrift.superclass.draw.call(this,t),e.beginPath();var i=Math.abs(this.squiggleArray[0].pointsArray[0].x),r=100+i;return e.rect(-1*i,-1*i,r,r),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(-1*i,100,r,-Math.PI/2,-.1,!1),e.lineWidth=6,e.lineJoin="miter",e.strokeStyle="rgba(80, 80, 80, 1)",e.fillStyle="rgba(0, 0, 0, 0)",this.isSelected&&(e.shadowBlur=10,e.shadowColor="rgba(0,0,0,0.9)"),e.stroke(),e.beginPath(),e.moveTo(100,100),e.lineTo(70,60),e.lineTo(130,60),e.closePath(),e.fillStyle="rgba(80, 80, 80, 1)",this.isSelected&&(e.shadowBlur=10,e.shadowColor="rgba(0,0,0,0.9)"),e.fill()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.UpDrift.prototype.description=function(){return"Up drift"},ED.UpShoot=function(t,e){this.savedParameterArray=["originX","originY","quadrantPoint"],ED.Doodle.call(this,t,e),this.className="UpShoot"},ED.UpShoot.prototype=new ED.Doodle,ED.UpShoot.prototype.constructor=ED.UpShoot,ED.UpShoot.superclass=ED.Doodle.prototype,ED.UpShoot.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.UpShoot.prototype.setPropertyDefaults=function(){this.isSelectable=!0,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!1,this.snapToQuadrant=!0,this.quadrantPoint=new ED.Point(335,220),this.handleVectorRangeArray=new Array;var t=new Object;t.length=new ED.Range(50,320),t.angle=new ED.Range(1.75*Math.PI,1.75*Math.PI),this.handleVectorRangeArray[0]=t},ED.UpShoot.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);var e=new ED.Point(-125,-125);this.addPointToSquiggle(e)},ED.UpShoot.prototype.draw=function(t){this.scaleX=this.originX/Math.abs(this.originX),this.scaleY=this.originY/Math.abs(this.originY);var e=this.drawing.context;ED.UpShoot.superclass.draw.call(this,t),e.beginPath();var i=Math.abs(this.squiggleArray[0].pointsArray[0].x),r=100+i;return e.rect(-1*i,-1*i,r,r),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(-1*i,-1*i),e.lineTo(-1*i+r,-1*i),e.lineTo(-1*i+r,-1*i+r),e.lineWidth=6,e.lineJoin="miter",e.strokeStyle="rgba(80, 80, 80, 1)",this.isSelected&&(e.shadowBlur=10,e.shadowColor="rgba(0,0,0,0.9)"),e.stroke(),e.beginPath(),e.moveTo(100,100),e.lineTo(70,60),e.lineTo(130,60),e.closePath(),this.isSelected&&(e.shadowBlur=10,e.shadowColor="rgba(0,0,0,0.9)"),e.fillStyle="rgba(80, 80, 80, 1)",e.fill()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.UpShoot.prototype.description=function(){return"Up shoot"},ED.VPattern=function(t,e){this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e),this.className="VPattern"},ED.VPattern.prototype=new ED.Doodle,ED.VPattern.prototype.constructor=ED.VPattern,ED.VPattern.superclass=ED.Doodle.prototype,ED.VPattern.prototype.setHandles=function(){},ED.VPattern.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1},ED.VPattern.prototype.setParameterDefaults=function(){this.drawing.eye==ED.eye.Right?this.rotation=-Math.PI/8:this.rotation=Math.PI/8},ED.VPattern.prototype.draw=function(t){var e=this.drawing.context;ED.VPattern.superclass.draw.call(this,t),e.beginPath();var i=0;for(e.moveTo(0,-500);i<1e3;)i+=4,e.lineTo(0,-500+i),i+=4,e.moveTo(0,-500+i);return e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(80, 80, 80, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.XPattern=function(t,e){this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e),this.className="XPattern"},ED.XPattern.prototype=new ED.Doodle,ED.XPattern.prototype.constructor=ED.XPattern,ED.XPattern.superclass=ED.Doodle.prototype,ED.XPattern.prototype.setHandles=function(){},ED.XPattern.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.XPattern.prototype.setParameterDefaults=function(){this.drawing.eye==ED.eye.Right?this.rotation=0:this.rotation=Math.PI},ED.XPattern.prototype.draw=function(t){var e=this.drawing.context;ED.XPattern.superclass.draw.call(this,t),e.beginPath();var i=0,r=0;for(e.moveTo(-350,-450);i<185;)i+=8,r+=4,e.lineTo(-350+i,-450+r),i+=4,r+=4,e.moveTo(-350+i,-450+r);for(i=0,r=0,e.moveTo(-350,450);i<185;)i+=8,r+=4,e.lineTo(-350+i,450-r),i+=4,r+=4,e.moveTo(-350+i,450-r);return e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(80, 80, 80, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.YPattern=function(t,e){this.savedParameterArray=["side"],ED.Doodle.call(this,t,e),this.className="YPattern"},ED.YPattern.prototype=new ED.Doodle,ED.YPattern.prototype.constructor=ED.YPattern,ED.YPattern.superclass=ED.Doodle.prototype,ED.YPattern.prototype.setHandles=function(){},ED.YPattern.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isOrientated=!1,this.isScaleable=!1,this.isSqueezable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.YPattern.prototype.setParameterDefaults=function(){this.drawing.eye==ED.eye.Right?this.side=1:this.side=-1},ED.YPattern.prototype.draw=function(t){var e=this.drawing.context;ED.YPattern.superclass.draw.call(this,t),e.beginPath();var i=0,r=0;for(e.moveTo(-350*this.side,-450);i<185;)i+=8,r+=4,e.lineTo((-350+i)*this.side,-450+r),i+=4,r+=4,e.moveTo((-350+i)*this.side,-450+r);for(i=0,r=0,e.moveTo(0,470);i<40;)r+=8,e.lineTo(0,470-r),i+=4,r+=4,e.moveTo(-0,470-r);return e.closePath(),e.lineWidth=4,e.strokeStyle="rgba(80, 80, 80, 1)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.StrabOpTemplate=function(t,e){this.className="StrabOpTemplate",ED.Doodle.call(this,t,e)},ED.StrabOpTemplate.prototype=new ED.Doodle,ED.StrabOpTemplate.prototype.constructor=ED.StrabOpTemplate,ED.StrabOpTemplate.superclass=ED.Doodle.prototype,ED.StrabOpTemplate.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isUnique=!0,this.isDeletable=!1},ED.StrabOpTemplate.prototype.draw=function(t){var e=this.drawing.context;ED.StrabOpTemplate.superclass.draw.call(this,t);return e.beginPath(),e.arc(0,0,80,0,2*Math.PI,!0),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(100, 200, 250, 0.75)",e.strokeStyle="blue",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.arc(0,0,30,0,2*Math.PI,!0),e.fillStyle="black",e.fill(),e.beginPath(),e.moveTo(-70,-200),e.lineTo(70,-200),e.moveTo(-200,-70),e.lineTo(-200,70),e.moveTo(-70,200),e.lineTo(70,200),e.moveTo(200,-70),e.lineTo(200,70),e.lineWidth=16,e.strokeStyle="brown",e.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalFluid=function(t,e){this.className="SubretinalFluid",this.numberOfHandles=8,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,t,e)},ED.SubretinalFluid.prototype=new ED.Doodle,ED.SubretinalFluid.prototype.constructor=ED.SubretinalFluid,ED.SubretinalFluid.superclass=ED.Doodle.prototype,ED.SubretinalFluid.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.SubretinalFluid.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=this.numberOfHandles,r=new Object;r.length=new ED.Range(50,290),r.angle=new ED.Range(((2*i-1)*e/(2*i)+t*e/i)%e,(1*e/(2*i)+t*e/i)%e),this.handleVectorRangeArray[t]=r}},ED.SubretinalFluid.prototype.setParameterDefaults=function(){var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX+100,0);this.move(e.x,e.y)}else this.move(100*(this.drawing.eye==ED.eye.Right?-1:1),0);var i=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(i);for(var r=0;r<this.numberOfHandles;r++){var a=new ED.Point(0,0);a.setWithPolars(this.initialRadius,2*r*Math.PI/this.numberOfHandles),this.addPointToSquiggle(a)}},ED.SubretinalFluid.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.SubretinalFluid.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}o.closePath(),o.lineWidth=4,o.fillStyle="rgba(0, 0, 255, 0.75)",o.strokeStyle="blue",this.drawBoundary(t);for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalFluid.prototype.description=function(){return"Subretinal fluid"},ED.SubretinalPFCL=function(t,e){this.className="SubretinalPFCL",this.savedParameterArray=["apexY","originX","originY"],ED.Doodle.call(this,t,e),this.rotation=Math.PI/4},ED.SubretinalPFCL.prototype=new ED.Doodle,ED.SubretinalPFCL.prototype.constructor=ED.SubretinalPFCL,ED.SubretinalPFCL.superclass=ED.Doodle.prototype,ED.SubretinalPFCL.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.SubretinalPFCL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-20)},ED.SubretinalPFCL.prototype.setParameterDefaults=function(){this.apexY=-40;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=new ED.Point(0,0);i.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),0)},ED.SubretinalPFCL.prototype.draw=function(t){var e=this.drawing.context;ED.SubretinalPFCL.superclass.draw.call(this,t),e.beginPath();var i=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);e.arc(0,0,i,0,2*Math.PI,!0),e.lineWidth=1;var r=i/1.1412135,a=e.createLinearGradient(-r,-r,r,r);return a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(.7,"rgba(200,200,200,1)"),a.addColorStop(1,"rgba(140,140,140,1)"),e.fillStyle=a,e.strokeStyle="gray",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.SubretinalPFCL.prototype.groupDescription=function(){return"Subretinal PFCL"},ED.Supramid=function(t,e){this.className="Supramid",this.percent="80",this.savedParameterArray=["apexX","apexY","rotation","percent"],this.controlParameterArray={percent:"Percentage of tube"},this.adjustmentArray={0:0,10:10,20:20,30:30,40:40,50:50,60:60,70:70,80:80,90:90,100:100},ED.Doodle.call(this,t,e)},ED.Supramid.prototype=new ED.Doodle,ED.Supramid.prototype.constructor=ED.Supramid,ED.Supramid.superclass=ED.Doodle.prototype,ED.Supramid.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Supramid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-800,800),this.parameterValidationArray.apexY.range.setMinAndMax(-800,800),this.parameterValidationArray.percent={kind:"other",type:"string",list:["0","10","20","30","40","50","60","70","80","90","100"],animate:!1}},ED.Supramid.prototype.setParameterDefaults=function(){this.apexX=-660,this.apexY=30,this.setParameterFromString("percent","80");var t=this.drawing.lastDoodleOfClass("Tube");t&&(this.rotation=t.rotation)},ED.Supramid.prototype.draw=function(t){var e=this.drawing.context;ED.Supramid.superclass.draw.call(this,t);var i=this.drawing.lastDoodleOfClass("TubeExtender");i&&void 0!==i.bezierArray.sp?this.rotation=i.rotation:(i=this.drawing.lastDoodleOfClass("Tube"))&&(this.rotation=i.rotation);var r=new ED.Point(this.apexX,this.apexY),a=new ED.Point(0,-700);if(e.beginPath(),e.rect(this.apexX-100,this.apexY-100,200,200),e.closePath(),e.lineWidth=1,e.fillStyle="rgba(0, 0, 0, 0)",this.isSelected?e.strokeStyle="rgba(0, 0, 0, 0.8)":e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(e.beginPath(),i&&i.bezierArray.sp){var o=r.x/Math.abs(r.x)*100;e.moveTo(r.x,r.y),e.bezierCurveTo(r.x+o,r.y-100,a.x+o,a.y,i.bezierArray.sp.x,i.bezierArray.sp.y);for(var n=this.adjustmentArray[this.percent],s=0;s<.02+n/100;s+=.02){var l=i.bezierArray.sp.bezierPointAtParameter(s,i.bezierArray.cp1,i.bezierArray.cp2,i.bezierArray.ep);e.lineTo(l.x,l.y)}}else e.moveTo(r.x,r.y),e.lineTo(0,-400);e.lineWidth=4,e.strokeStyle="purple",e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Supramid.prototype.description=function(){return"Supramid suture "+this.percent+"% along tube"},ED.SwollenDisc=function(t,e){this.className="SwollenDisc",this.savedParameterArray=["originX"],ED.Doodle.call(this,t,e)},ED.SwollenDisc.prototype=new ED.Doodle,ED.SwollenDisc.prototype.constructor=ED.SwollenDisc,ED.SwollenDisc.superclass=ED.Doodle.prototype,ED.SwollenDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.SwollenDisc.prototype.setParameterDefaults=function(){this.originY=0,this.drawing.hasDoodleOfClass("PostPole")&&(this.originX=this.drawing.eye==ED.eye.Right?300:-300)},ED.SwollenDisc.prototype.draw=function(t){var e=this.drawing.context;ED.SwollenDisc.superclass.draw.call(this,t);e.beginPath(),e.arc(0,0,140,0,2*Math.PI,!0),e.arc(0,0,80,2*Math.PI,0,!1),e.closePath(),e.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var i=e.createRadialGradient(0,0,140,0,0,80);return i.addColorStop(0,yellowColour),i.addColorStop(1,"rgba(240, 140, 40, 0.75)"),e.fillStyle=i,e.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(t),this.isClicked},ED.SwollenDisc.prototype.description=function(){return"Swollen disc"},ED.TarsalPlates=function(t,e){this.className="TarsalPlates",ED.Doodle.call(this,t,e)},ED.TarsalPlates.prototype=new ED.Doodle,ED.TarsalPlates.prototype.constructor=ED.TarsalPlates,ED.TarsalPlates.superclass=ED.Doodle.prototype,ED.TarsalPlates.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.isSelectable=!1,this.isDeletable=!1},ED.TarsalPlates.prototype.setParameterDefaults=function(){},ED.TarsalPlates.prototype.draw=function(t){var e=this.drawing.context;ED.TarsalPlates.superclass.draw.call(this,t);var i=480,r=-220,a=Math.asin(r/i),o=i*Math.cos(a);return e.moveTo(-o,-110),e.arc(0,110,i,a,Math.PI-a,!0),e.lineTo(-o,-110),e.moveTo(-o,110),e.arc(0,-110,i,-a,Math.PI+a,!1),e.lineTo(-o,110),e.stroke(),e.lineWidth=4,e.fillStyle="rgba(255, 255, 255, 0)",e.strokeStyle="gray",this.drawBoundary(t),this.isClicked},ED.Telangiectasis=function(t,e){this.className="Telangiectasis",this.savedParameterArray=["originX","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.Telangiectasis.prototype=new ED.Doodle,ED.Telangiectasis.prototype.constructor=ED.Telangiectasis,ED.Telangiectasis.superclass=ED.Doodle.prototype,ED.Telangiectasis.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Telangiectasis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-100,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Telangiectasis.prototype.setParameterDefaults=function(){this.originX=this.drawing.eye==ED.eye.Right?-160:160},ED.Telangiectasis.prototype.draw=function(t){var e=this.drawing.context;ED.Telangiectasis.superclass.draw.call(this,t),e.beginPath();var i=100;if(e.arc(0,0,i,0,2*Math.PI,!0),e.closePath(),e.lineWidth=0,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var r="red",a=10/this.scaleX,o=new ED.Point(0,0),n=10,s=0;s<n;s++)o.setWithPolars(80*ED.randomArray[s],2*Math.PI*ED.randomArray[s+100]),this.drawSpot(e,o.x,o.y,a,r);if(this.apexY<-50){r="yellow",n=18;for(s=0;s<n;s++)o.setWithPolars(i,2*Math.PI*s/n),this.drawSpot(e,o.x,o.y,a,r)}r="brown",n=Math.abs(Math.floor(this.apexX/10));for(s=0;s<n;s++)o.setWithPolars(80*ED.randomArray[s+10],2*Math.PI*ED.randomArray[s+100]),this.drawSpot(e,o.x,o.y,2*a,r)}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Telangiectasis.prototype.description=function(){return"Parafoveal telangiectasia"},ED.Telangiectasis.prototype.snomedCode=function(){return 232024e3},ED.ToricPCIOL=function(t,e){this.className="ToricPCIOL",this.classGroupUnique="Lens",this.axis=0,this.model="Type 1",this.fixation="In-the-bag",this.fx=1,this.csOriginX=0,this.savedParameterArray=["fixation","fx","originX","originY","rotation","csOriginX","model"],this.controlParameterArray={model:"Model"},ED.Doodle.call(this,t,e),this.scaleX=.75,this.scaleY=.75},ED.ToricPCIOL.prototype=new ED.Doodle,ED.ToricPCIOL.prototype.constructor=ED.ToricPCIOL,ED.ToricPCIOL.superclass=ED.Doodle.prototype,ED.ToricPCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ToricPCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isOrientated=!1,this.isScaleable=!1,this.isUnique=!0,this.parameterValidationArray.fixation={kind:"derived",type:"string",list:["In-the-bag","Ciliary sulcus"],animate:!0},this.parameterValidationArray.fx={kind:"other",type:"int",range:[1,2],animate:!1},this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0},this.parameterValidationArray.model={kind:"derived",type:"string",list:["AcrySof T3 (+1.50 D)","AcrySof T4 (+2.25 D)","AcrySof T5 (+3.00 D)","AA4203-TF (+2.00 D)","AA4203-TL (+3.50 D)","Lisa Tri-toric","AT Torbi"],animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-200,200),this.parameterValidationArray.originY.range.setMinAndMax(-200,200)},ED.ToricPCIOL.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setParameterFromString("axis","0"),this.setParameterFromString("model","AcrySof T3 (+1.50 D)")},ED.ToricPCIOL.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"fx":i.fixation=2===e?"Ciliary sulcus":"In-the-bag";break;case"fixation":switch(e){case"In-the-bag":i.fx=1;break;case"Ciliary sulcus":i.fx=2}break;case"rotation":i.axis=(600-180*e/Math.PI)%180;break;case"axis":i.rotation=(240-e)*Math.PI/180}return i},ED.ToricPCIOL.prototype.draw=function(t){var e=this.drawing.context;ED.ToricPCIOL.superclass.draw.call(this,t),e.beginPath();var i=240;if(e.arc(0,0,i,0,2*Math.PI,!1),e.moveTo(150,-190),e.bezierCurveTo(160,-200,190,-350,160,-380),e.bezierCurveTo(90,-440,-150,-410,-220,-370),e.bezierCurveTo(-250,-350,-260,-400,-200,-430),e.bezierCurveTo(-110,-480,130,-470,200,-430),e.bezierCurveTo(270,-390,220,-140,220,-100),e.moveTo(-150,190),e.bezierCurveTo(-160,200,-190,350,-160,380),e.bezierCurveTo(-90,440,150,410,220,370),e.bezierCurveTo(250,350,260,400,200,430),e.bezierCurveTo(110,480,-130,470,-200,430),e.bezierCurveTo(-270,390,-220,140,-220,100),e.fillStyle="rgba(255,255,255,0.75)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath();var r=.67*Math.PI/4,a=r+Math.PI,o=new ED.Point(0,0);o.setWithPolars(220,r);var n=new ED.Point(0,0);n.setWithPolars(140,r);var s=new ED.Point(0,0);s.setWithPolars(220,a);var l=new ED.Point(0,0);l.setWithPolars(140,a),e.moveTo(o.x,o.y),e.lineTo(n.x,n.y),e.moveTo(s.x,s.y),e.lineTo(l.x,l.y),e.lineWidth=24,e.lineCap="round",e.strokeStyle="darkgray",e.stroke()}var h=new ED.Point(0,0);return h.setWithPolars(i,4*Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ToricPCIOL.prototype.description=function(){var t="Toric posterior chamber IOL "+this.model+" ",e="";return this.originY<-40&&(e.length>0&&(e+=" and"),e+=" superiorly"),this.originY>40&&(e.length>0&&(e+=" and"),e+=" inferiorly"),this.originX<-40&&(e.length>0&&(e+=" and"),e+=" temporally"),this.originX>40&&(e.length>0&&(e+=" and"),e+=" nasally"),e.length>0&&(t+=" displaced"+e),t+=" @ "+this.axis.toFixed(0)+""},ED.ToricPCIOLCrossSection=function(t,e){this.className="ToricPCIOLCrossSection",this.fixation="In-the-bag",this.fx=1,this.savedParameterArray=["fixation","fx","originX","originY"],this.controlParameterArray={fixation:"Fixation"},ED.Doodle.call(this,t,e),this.linkedDoodleParameters={ToricPCIOL:{source:["fixation","fx","originY"],store:[["originX","csOriginX"]]}}},ED.ToricPCIOLCrossSection.prototype=new ED.Doodle,ED.ToricPCIOLCrossSection.prototype.constructor=ED.ToricPCIOLCrossSection,ED.ToricPCIOLCrossSection.superclass=ED.Doodle.prototype,ED.ToricPCIOLCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.inFrontOfClassArray=["HypopyonCrossSection","HyphaemaCrossSection"],this.addAtBack=!0,this.parameterValidationArray.fixation={kind:"derived",type:"string",list:["In-the-bag","Ciliary sulcus"],animate:!0},this.parameterValidationArray.fx={kind:"other",type:"int",range:[1,2],animate:!1},this.parameterValidationArray.originX.range.setMinAndMax(-150,44),this.parameterValidationArray.originY.range.setMinAndMax(-140,140)},ED.ToricPCIOLCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.ToricPCIOLCrossSection.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"fx":i.fixation=2===e?"Ciliary sulcus":"In-the-bag";break;case"fixation":switch(e){case"In-the-bag":i.fx=1;break;case"Ciliary sulcus":i.fx=2}break;case"originX":var r=this.drawing.lastDoodleOfClass("AntSegCrossSection");if(r){var a=r.parameterValidationArray.apexX.range.min,o=32-72/220*(r.apexY+280)+this.originX;if(o<a&&(o=a),r.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(r.apexY+280),o),this.drawing.isActive)n=r.parameterValidationArray.apexX.range.constrain(r.apexX);else var n=r.parameterValidationArray.apexX.range.max;r.setSimpleParameter("apexX",n)}}return i},ED.ToricPCIOLCrossSection.prototype.draw=function(t){var e=this.drawing.context;ED.ToricPCIOLCrossSection.superclass.draw.call(this,t);var i=450,r=Math.asin(240/i),a=i*Math.cos(r);Math.acos(a/390);if(e.beginPath(),"In-the-bag"==this.fixation?e.ellipse(100,0,160,20,.5*Math.PI,0,2*Math.PI):e.ellipse(50,0,160,25,.5*Math.PI,0,2*Math.PI),e.lineWidth=5,e.fillStyle="rgba(255, 255, 255, 0.75)",e.strokeStyle="#898989",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){var o="In-the-bag"==this.fixation?0:this.originX-44;e.beginPath(),e.arc(100-a-o,0-this.originY,i,r,-r,!0),e.arc(100+a-o,0-this.originY,i,Math.PI+r,Math.PI+.75*r,!0),e.moveTo(100-o,240-this.originY),e.arc(100+a-o,0-this.originY,i,Math.PI-r,Math.PI-.75*r,!1),e.strokeStyle="gray",e.lineWidth=3,e.stroke(),e.beginPath(),"In-the-bag"==this.fixation?(e.ellipse(100,0-this.originY,227,20,.5*Math.PI,.5*Math.PI,1.2*Math.PI),e.moveTo(120,0-this.originY),e.ellipse(100,0-this.originY,227,20,.5*Math.PI,1.5*Math.PI,.2*Math.PI)):(e.arc(115-this.originX,-350-this.originY,15,0*Math.PI,1*Math.PI,!0),e.lineTo(35,-125),e.moveTo(120-this.originX,350-this.originY),e.arc(115-this.originX,350-this.originY,15,0,1*Math.PI,!1),e.moveTo(100-this.originX,350-this.originY),e.lineTo(65,125)),e.strokeStyle="#898989",e.lineWidth=5,e.stroke(),e.beginPath(),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(80-o,-207-this.originY),e.moveTo(44-this.originX+80,-this.originY-349),e.lineTo(120-o,-207-this.originY),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(80-o,-207-this.originY),e.moveTo(44-this.originX+120,-this.originY-349),e.lineTo(120-o,-207-this.originY),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(80-o,207-this.originY),e.moveTo(44-this.originX+80,349-this.originY),e.lineTo(120-o,207-this.originY),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(80-o,207-this.originY),e.moveTo(44-this.originX+120,349-this.originY),e.lineTo(120-o,207-this.originY),e.lineWidth=2,e.strokeStyle="gray",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Trabectome=function(t,e){this.className="Trabectome",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.Trabectome.prototype=new ED.Doodle,ED.Trabectome.prototype.constructor=ED.Trabectome,ED.Trabectome.superclass=ED.Doodle.prototype,ED.Trabectome.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Trabectome.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI)},ED.Trabectome.prototype.setParameterDefaults=function(){this.arc=Math.PI/4,this.setRotationWithDisplacements(-90,-120)},ED.Trabectome.prototype.draw=function(t){var e=this.drawing.context;ED.Trabectome.superclass.draw.call(this,t);var i=500,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=420*Math.sin(r),s=-420*Math.cos(r),l=-420*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,440,a,o,!0),e.arc(0,0,400,o,a,!1),e.moveTo(-10,-360),e.lineTo(0,-370),e.lineTo(10,-360),e.lineTo(10,400),e.lineTo(150,i),e.lineTo(150,670),e.lineTo(-150,670),e.lineTo(-150,i),e.lineTo(-10,400),e.lineTo(-10,-360),e.lineWidth=4,e.fillStyle="rgba(200, 200, 200, 0.5)",e.strokeStyle="rgba(200, 200, 200, 0.8)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.arc(0,0,440,a,o,!0),e.arc(0,0,400,o,a,!1),e.fillStyle="rgba(200, 100, 100, 0.8)",e.strokeStyle="red",e.fill(),e.stroke();e.beginPath();e.arc(0,0,364,Math.PI/2+.125,Math.PI/2-.125,!0),e.arc(0,0,304,Math.PI/2-.125,Math.PI/2+.125,!1),e.fillStyle="rgba(200,200,200,0.75)",e.strokeStyle="rgba(120,120,120,0.75)",e.fill(),e.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Trabectome.prototype.description=function(){return"Trabecular meshwork ablation of "+this.degreesExtent()+" degrees centred around "+this.clockHour()+" o'clock"},ED.TrabyConjIncision=function(t,e){this.className="TrabyConjIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,t,e)},ED.TrabyConjIncision.prototype=new ED.Doodle,ED.TrabyConjIncision.prototype.constructor=ED.TrabyConjIncision,ED.TrabyConjIncision.superclass=ED.Doodle.prototype,ED.TrabyConjIncision.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.TrabyConjIncision.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,Math.PI)},ED.TrabyConjIncision.prototype.setParameterDefaults=function(){this.arc=80*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+Math.PI/4:0},ED.TrabyConjIncision.prototype.draw=function(t){var e=this.drawing.context;ED.TrabyConjIncision.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i,o=660*Math.sin(i),n=-660*Math.cos(i),s=-660*Math.sin(i),l=n,h=400*Math.sin(i),d=-400*Math.cos(i);Math.sin(i);return e.beginPath(),e.arc(0,0,660,r,a,!0),e.arc(0,0,400,a,r,!1),e.lineWidth=4,e.fillStyle="rgba(255,255,0,0)",e.strokeStyle="rgba(255,0,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(o,n),e.lineTo(h,d),e.arc(0,0,400,r,a,!0),e.lineTo(s,l),e.lineWidth=4,e.strokeStyle="gray",e.stroke()),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(s,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrabyConjIncision.prototype.description=function(){return""},ED.TrabyFlap=function(t,e){this.className="TrabyFlap",this.site="Superior",this.size="4x3",this.sclerostomy="Punch",this.height=-580,this.r=380,this.right=new ED.Point(0,0),this.left=new ED.Point(0,0),this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.TrabyFlap.prototype=new ED.Doodle,ED.TrabyFlap.prototype.constructor=ED.TrabyFlap,ED.TrabyFlap.superclass=ED.Doodle.prototype,ED.TrabyFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.TrabyFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.snapToArc=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-440,-440),this.parameterValidationArray.rotation.delta=.1,this.parameterValidationArray.site={kind:"derived",type:"string",list:["Superior","Superonasal","Superotemporal"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["4x3","5x2"],animate:!1},this.parameterValidationArray.sclerostomy={kind:"derived",type:"string",list:["Punch","Block","Ex-Press shunt"],animate:!1},this.arcArray=[.9,1.13]},ED.TrabyFlap.prototype.setParameterDefaults=function(){this.apexY=-440,this.height=-580,this.setParameterFromString("size","Superior"),this.setParameterFromString("size","4x3"),this.setParameterFromString("sclerostomy","Punch")},ED.TrabyFlap.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"apexX":i.sclerostomy=e<-15?"Punch":e>15?"Ex-Press shunt":"Block";break;case"arc":e<1?(i.size="4x3",i.height=-580):(i.size="5x2",i.height=-510);break;case"rotation":e>Math.PI/16&&e<Math.PI?i.site=this.drawing.eye==ED.eye.Right?"Superonasal":"Superotemporal":e>=Math.PI&&e<31*Math.PI/16?i.site=this.drawing.eye==ED.eye.Right?"Superotemporal":"Superonasal":i.site="Superior";break;case"site":switch(e){case"Superior":i.rotation=0;break;case"Superonasal":i.rotation=this.drawing.eye==ED.eye.Right?Math.PI/4:7*Math.PI/4;break;case"Superotemporal":i.rotation=this.drawing.eye==ED.eye.Right?7*Math.PI/4:Math.PI/4}break;case"size":switch(e){case"4x3":i.arc=.9,i.height=-580,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2));break;case"5x2":i.arc=1.13,i.height=-510,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2))}break;case"sclerostomy":switch(e){case"Punch":i.apexX=-50;break;case"Block":i.apexX=0;break;case"Ex-Press shunt":i.apexX=50}}return i},ED.TrabyFlap.prototype.draw=function(t){var e=this.drawing.context;ED.TrabyFlap.superclass.draw.call(this,t);var i=this.arc/2,r=-Math.PI/2+i,a=-Math.PI/2-i;this.arc,new ED.Point(0,this.height);if(this.right.x=this.r*Math.sin(i),this.right.y=-this.r*Math.cos(i),this.left.x=-this.r*Math.sin(i),this.left.y=-this.r*Math.cos(i),e.beginPath(),e.arc(0,0,this.r,r,a,!0),e.lineTo(this.left.x,this.height),e.lineTo(this.right.x,this.height),e.closePath(),e.fillStyle="rgba(220,220,150,0.5)",e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),this.sclerostomy){case"Punch":e.arc(0,this.apexY,50,0,2*Math.PI,!0);break;case"Block":var o=i/2;r=-Math.PI/2+o,a=-Math.PI/2-o;var n=new ED.Point(0,-this.r+(this.height+this.r)/2);e.arc(0,0,this.r,r,a,!0),e.lineTo(-this.r*Math.sin(o),n.y),e.lineTo(this.r*Math.sin(o),n.y),e.closePath();break;case"Ex-Press shunt":e.arc(0,this.apexY,40,0,2*Math.PI,!0),e.moveTo(-20,-420),e.lineTo(-20,-300),e.lineTo(20,-300),e.lineTo(20,-420)}e.fillStyle="gray",e.fill()}return this.handleArray[0].location=this.transform.transformPoint(this.left),this.handleArray[3].location=this.transform.transformPoint(this.right),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrabyFlap.prototype.description=function(){return"Trabeculectomy flap at "+this.clockHour()+" o'clock with "+ED.firstLetterToLowerCase(this.sclerostomy)+" sclerostomy"},ED.TrabySuture=function(t,e){this.className="TrabySuture",this.type="Fixed",this.material="Nylon",this.size="10/0",this.removed=!1,this.numberOfHandles=5,this.savedParameterArray=["originX","originY","apexX","apexY","arc","rotation","type","material","size","removed"],this.controlParameterArray={type:"Shape",material:"Material",size:"Size",removed:"Removed"},ED.Doodle.call(this,t,e)},ED.TrabySuture.prototype=new ED.Doodle,ED.TrabySuture.prototype.constructor=ED.TrabySuture,ED.TrabySuture.superclass=ED.Doodle.prototype,ED.TrabySuture.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.TrabySuture.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(70,70),this.parameterValidationArray.originY.range.setMinAndMax(-625,625),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Fixed","Adjustable","Releasable"],animate:!1},this.parameterValidationArray.material={kind:"derived",type:"string",list:["Nylon","Prolene","Vicryl","Silk"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["11/0","10/0","9/0","8/0","7/0","6/0"],animate:!1},this.parameterValidationArray.removed={kind:"derived",type:"bool",animate:!1}},ED.TrabySuture.prototype.setParameterDefaults=function(){this.apexX=50,this.apexY=70,this.material="Nylon",this.size="10/0";var t=this.drawing.lastDoodleOfClass("TrabyFlap");if(t){var e=this.drawing.numberOfDoodlesOfClass("TrabySuture"),i=new ED.Point(-1*t.right.x,t.height+0*(t.right.y-t.height));switch(i.setWithPolars(i.length(),i.direction()+t.rotation),e){case 0:this.originX=i.x,this.originY=i.y,this.rotation=t.rotation,this.scaleX=-1*this.scaleX;break;case 1:(i=new ED.Point(1*t.right.x,t.height+0*(t.right.y-t.height))).setWithPolars(i.length(),i.direction()+t.rotation),this.originX=i.x,this.originY=i.y,this.rotation=t.rotation;break;case 2:var r=this.drawing.firstDoodleOfClass("TrabySuture"),a=this.drawing.lastDoodleOfClass("TrabySuture");this.originX=r.originX+(a.originX-r.originX)/2,this.originY=i.y,this.rotation=a.rotation;break;default:this.setOriginWithDisplacements(0,-40)}}else this.setOriginWithDisplacements(0,-40);var o=this.drawing.lastDoodleOfClass("TrabySuture");this.type=o?o.type:"Releasable";var n=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(n);for(var s=50,l=[{x:s,y:-s},{x:-s,y:s},{x:-s,y:150},{x:0,y:350},{x:s,y:100}],h=0;h<l.length;h++){var d=new ED.Point(l[h].x,l[h].y);this.addPointToSquiggle(d)}},ED.TrabySuture.prototype.draw=function(t){var e=this.drawing.context;if(ED.TrabySuture.superclass.draw.call(this,t),e.beginPath(),e.rect(-40,-70,80,100),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",this.isSelected?e.strokeStyle="gray":e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(e.beginPath(),this.type){case"Releasable":var i=this.squiggleArray[0].pointsArray[0];e.moveTo(i.x,i.y);var r=this.squiggleArray[0].pointsArray[1],a=i.pointAtAngleToLineToPointAtProportion(Math.PI/3,r,.5),o=i.pointAtAngleToLineToPointAtProportion(-Math.PI/3,r,.5);e.bezierCurveTo(a.x,a.y,o.x,o.y,r.x,r.y);r=this.squiggleArray[0].pointsArray[0];e.moveTo(r.x,r.y);for(var n=1;n<3;n++)r=this.squiggleArray[0].pointsArray[n],e.lineTo(r.x,r.y),i=r;i=this.squiggleArray[0].pointsArray[2],r=this.squiggleArray[0].pointsArray[3];var s=2;a=new ED.Point(i.x,i.y+(r.y-i.y)/s),o=new ED.Point(r.x-(r.x-i.x)/s,r.y);e.bezierCurveTo(a.x,a.y,o.x,o.y,r.x,r.y),i=this.squiggleArray[0].pointsArray[3],r=this.squiggleArray[0].pointsArray[4],s=2,a=new ED.Point(i.x+(r.x-i.x)/s,i.y),o=new ED.Point(r.x,r.y-(r.y-i.y)/s),e.bezierCurveTo(a.x,a.y,o.x,o.y,r.x,r.y);for(n=0;n<this.numberOfHandles;n++)this.handleArray[n]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[n].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[n]);break;case"Adjustable":e.moveTo(-2,64),e.bezierCurveTo(20,36,-15,16,-16,-7),e.bezierCurveTo(-18,-30,-12,-43,-4,-43),e.bezierCurveTo(6,-43,12,-28,12,-9),e.bezierCurveTo(12,11,0,23,-2,30),e.bezierCurveTo(-3,36,3,37,2,30),e.bezierCurveTo(2,20,-4,24,-3,29),e.bezierCurveTo(-3,36,14,37,23,56),e.bezierCurveTo(32,74,34,100,34,100),this.handleArray.length=1,this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(40,-70));break;case"Fixed":e.moveTo(0,-30),e.bezierCurveTo(5,-10,5,10,0,30),e.bezierCurveTo(-5,10,-5,-10,0,-30),e.moveTo(-5,50),e.lineTo(0,30),e.lineTo(5,50),this.handleArray.length=1,this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(40,-70))}e.lineWidth=8,e.fillStyle="rgba(0, 0, 0, 0)",this.removed?e.strokeStyle="rgba(150,150,150,0.5)":e.strokeStyle="purple",e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrabySuture.prototype.groupDescription=function(){return"Flap sutures at "},ED.TrabySuture.prototype.description=function(){return this.clockHour()},ED.TrabySuture.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.TractionRetinalDetachment=function(t,e){this.className="TractionRetinalDetachment",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,t,e)},ED.TractionRetinalDetachment.prototype=new ED.Doodle,ED.TractionRetinalDetachment.prototype.constructor=ED.TractionRetinalDetachment,ED.TractionRetinalDetachment.superclass=ED.Doodle.prototype,ED.TractionRetinalDetachment.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.TractionRetinalDetachment.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.TractionRetinalDetachment.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(200,-100)},ED.TractionRetinalDetachment.prototype.draw=function(t){var e=this.drawing.context;ED.TractionRetinalDetachment.superclass.draw.call(this,t),e.beginPath();var i=60,r=150;return e.moveTo(-r,-r),e.bezierCurveTo(-i,-i,i,-i,r,-r),e.bezierCurveTo(i,-i,i,i,r,r),e.bezierCurveTo(i,i,-i,i,-r,r),e.bezierCurveTo(-i,i,-i,-i,-r,-r),e.closePath(),e.lineWidth=1,e.strokeStyle="blue",e.fillStyle="blue",this.drawBoundary(t),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(r,-r)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TractionRetinalDetachment.prototype.groupDescription=function(){return"Traction retinal detachment "},ED.TractionRetinalDetachment.prototype.description=function(){return this.locationRelativeToDisc()},ED.TransilluminationDefect=function(t,e){this.className="TransilluminationDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,t,e)},ED.TransilluminationDefect.prototype=new ED.Doodle,ED.TransilluminationDefect.prototype.constructor=ED.TransilluminationDefect,ED.TransilluminationDefect.superclass=ED.Doodle.prototype,ED.TransilluminationDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.TransilluminationDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.TransilluminationDefect.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var t=this.drawing.lastDoodleOfClass(this.className);this.rotation=t?t.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(t.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.TransilluminationDefect.prototype.draw=function(t){var e=this.drawing.context;ED.TransilluminationDefect.superclass.draw.call(this,t);var i=330,r=this.arc/2,a=-Math.PI/2+r,o=-Math.PI/2-r,n=i*Math.sin(r),s=-i*Math.cos(r),l=-i*Math.sin(r),h=s;if(e.beginPath(),e.arc(0,0,380,a,o,!0),e.arc(0,0,280,o,a,!1),e.closePath(),e.lineWidth=4,e.fillStyle="rgba(255,255,255,0)",e.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var d=Math.PI/8,c=-Math.PI/2-a+d/2;c<this.arc-Math.PI/2-a;c+=d){new ED.Point(0,0).setWithPolars(i,c);var p=new ED.Point(0,0);p.setWithPolars(300,c);var y=new ED.Point(0,0);y.setWithPolars(360,c);var D=Math.PI/40,u=new ED.Point(0,0);u.setWithPolars(i,c-D);var g=new ED.Point(0,0);g.setWithPolars(i,c+D),e.save(),e.beginPath(),e.moveTo(p.x,p.y),e.quadraticCurveTo(u.x,u.y,y.x,y.y),e.quadraticCurveTo(g.x,g.y,p.x,p.y),e.fillStyle="rgba(255,255,255,1)",e.fill(),e.lineWidth=4,e.strokeStyle="rgba(255,255,255,1)",e.stroke(),e.restore()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,h)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(n,s)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TransilluminationDefect.prototype.groupDescription=function(){return"Transillumination defects of iris"},ED.TrialFrame=function(t,e){this.className="TrialFrame",ED.Doodle.call(this,t,e)},ED.TrialFrame.prototype=new ED.Doodle,ED.TrialFrame.prototype.constructor=ED.TrialFrame,ED.TrialFrame.superclass=ED.Doodle.prototype,ED.TrialFrame.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isUnique=!0},ED.TrialFrame.prototype.draw=function(t){var e=this.drawing.context;ED.TrialFrame.superclass.draw.call(this,t),e.beginPath();var i=-Math.PI/20,r=0+i,a=Math.PI-i;if(e.beginPath(),e.arc(0,0,420,r,a,!1),e.arc(0,0,300,a,r,!0),e.closePath(),e.fillStyle="rgba(230,230,230,1)",e.lineWidth=4,e.strokeStyle="darkgray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.font="50px sans-serif",e.fillStyle="blue",e.beginPath();for(var o=0,n=new ED.Point(0,0),s=new ED.Point(0,0),l=new ED.Point(0,0),h=new ED.Point(0,0),d=new ED.Point(0,0),c=0;c<19;c++){var p=c.toFixed(0);o=(-90-10*c)*Math.PI/180,n.setWithPolars(300,o),s.setWithPolars(320,o),l.setWithPolars(340,o),d.setWithPolars(400,o),h.setWithPolars(420,o),e.moveTo(n.x,n.y),e.lineTo(s.x,s.y),e.moveTo(d.x,d.y),e.lineTo(h.x,h.y),e.save(),e.translate(l.x,l.y),e.rotate(Math.PI+o),e.textAlign="center",e.fillText(p,0,40),e.restore()}e.moveTo(-20,0),e.lineTo(20,0),e.moveTo(0,-20),e.lineTo(0,20),e.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TrialLens=function(t,e){this.className="TrialLens",this.axis="0",this.savedParameterArray=["rotation"],ED.Doodle.call(this,t,e)},ED.TrialLens.prototype=new ED.Doodle,ED.TrialLens.prototype.constructor=ED.TrialLens,ED.TrialLens.superclass=ED.Doodle.prototype,ED.TrialLens.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.TrialLens.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.TrialLens.prototype.dependentParameterValues=function(t,e){var i=new Array;switch(t){case"rotation":i.axis=(360-180*e/Math.PI)%180;break;case"axis":i.rotation=(180-e)*Math.PI/180}return i},ED.TrialLens.prototype.draw=function(t){var e=this.drawing.context;ED.TrialLens.superclass.draw.call(this,t);if(e.beginPath(),e.arc(0,0,360,0,2*Math.PI,!0),e.moveTo(180,0),e.arc(0,0,180,2*Math.PI,0,!1),e.lineWidth=4,e.fillStyle="rgba(255,100,100,1)",e.strokeStyle="gray",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(340,0),e.lineTo(200,0),e.moveTo(-340,0),e.lineTo(-200,0),e.lineWidth=16,e.strokeStyle="black",e.stroke()}return this.isClicked},ED.Tube=function(t,e){this.className="Tube",this.type="Baerveldt 103-250",this.platePosition="STQ",this.bezierArray=new Array,this.tubeExtender=!1,this.savedParameterArray=["rotation","apexX","apexY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,t,e)},ED.Tube.prototype=new ED.Doodle,ED.Tube.prototype.constructor=ED.Tube,ED.Tube.superclass=ED.Doodle.prototype,ED.Tube.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Tube.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.isDeletable=!0,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-300,300),this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.type={kind:"other",type:"string",list:["Ahmed FP7","Baerveldt 103-250","Baerveldt 101-350","Baerveldt 103-350","Molteno Single"],animate:!1},this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var t=Math.PI/4;this.anglesArray=[t,3*t,5*t,7*t]},ED.Tube.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ")},ED.Tube.prototype.dependentParameterValues=function(t,e){var i=new Array,r=this.drawing.eye==ED.eye.Right,a=Math.PI/4;switch(t){case"rotation":this.rotation>0&&this.rotation<=2*a?i.platePosition=r?"SNQ":"STQ":this.rotation>2*a&&this.rotation<=4*a?i.platePosition=r?"INQ":"ITQ":this.rotation>4*a&&this.rotation<=6*a?i.platePosition=r?"ITQ":"INQ":i.platePosition=r?"STQ":"SNQ";break;case"platePosition":switch(e){case"STQ":i.rotation=r?7*a:a;break;case"SNQ":i.rotation=r?a:7*a;break;case"INQ":i.rotation=r?3*a:5*a;break;case"ITQ":i.rotation=r?5*a:3*a}}return i},ED.Tube.prototype.draw=function(t){var e=this.drawing.context;ED.Tube.superclass.draw.call(this,t),this.tubeExtender=this.drawing.hasDoodleOfClass("TubeExtender"),e.beginPath();var i=.41666667,r=-740;switch(this.type){case"Ahmed FP7":case"Ahmed S2":e.moveTo(-300*i,0+r),e.bezierCurveTo(-300*i,-100*i+r,-200*i,-400*i+r,0,-400*i+r),e.bezierCurveTo(200*i,-400*i+r,300*i,-100*i+r,300*i,0+r),e.bezierCurveTo(300*i,140*i+r,200*i,250*i+r,0,250*i+r),e.bezierCurveTo(-200*i,250*i+r,-300*i,140*i+r,-300*i,0+r),e.moveTo(-160*i,230*i+r),e.lineTo(-120*i,290*i+r),e.lineTo(120*i,290*i+r),e.lineTo(160*i,230*i+r),e.bezierCurveTo(120*i,250*i+r,-120*i,250*i+r,-160*i,230*i+r);break;case"Ahmed S3":e.moveTo(-100*i,230*i+r),e.lineTo(100*i,230*i+r),e.lineTo(200*i,0+r),e.lineTo(100*i,-230*i+r),e.lineTo(-100*i,-230*i+r),e.lineTo(-200*i,0+r),e.lineTo(-100*i,230*i+r),e.moveTo(-100*i,230*i+r),e.lineTo(-100*i,290*i+r),e.lineTo(100*i,290*i+r),e.lineTo(100*i,230*i+r),e.bezierCurveTo(100*i,250*i+r,-100*i,250*i+r,-100*i,230*i+r);break;case"Baerveldt 103-250":e.moveTo(0,230*i+r),e.lineTo(-100*i,230*i+r),e.bezierCurveTo(-500*i,180*i+r,-300*i,-240*i+r,0,-200*i+r),e.bezierCurveTo(300*i,-240*i+r,500*i,180*i+r,100*i,230*i+r),e.lineTo(0,230*i+r),e.moveTo(-160*i,230*i+r),e.lineTo(-120*i,290*i+r),e.lineTo(120*i,290*i+r),e.lineTo(160*i,230*i+r),e.bezierCurveTo(120*i,250*i+r,-120*i,250*i+r,-160*i,230*i+r);break;case"Baerveldt 101-350":case"Baerveldt 103-350":e.moveTo(0,230*i+r),e.lineTo(-100*i,230*i+r),e.bezierCurveTo(-150*i,230*i+r,-600*i,0+r,-300*i,-200*i+r),e.bezierCurveTo(-200*i,-240*i+r,200*i,-240*i+r,300*i,-200*i+r),e.bezierCurveTo(600*i,0+r,150*i,230*i+r,100*i,230*i+r),e.lineTo(0,230*i+r),e.moveTo(-160*i,230*i+r),e.lineTo(-120*i,290*i+r),e.lineTo(120*i,290*i+r),e.lineTo(160*i,230*i+r),e.bezierCurveTo(120*i,250*i+r,-120*i,250*i+r,-160*i,230*i+r);break;case"Molteno Single":e.arc(0,r,310*i,0,2*Math.PI,!0);break;case"Molteno 8mm":e.arc(0,-710,250*i,0,2*Math.PI,!0)}if(e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.type){case"Ahmed FP7":this.drawSpot(e,0,-230*i+r,20*i,"white"),this.drawSpot(e,-180*i,-180*i+r,20*i,"white"),this.drawSpot(e,180*i,-180*i+r,20*i,"white"),e.beginPath(),e.moveTo(-100*i,230*i+r),e.lineTo(100*i,230*i+r),e.lineTo(200*i,0+r),e.lineTo(40*i,0+r),e.arcTo(0,-540*i+r,-40*i,0+r,15),e.lineTo(-40*i,0+r),e.lineTo(-200*i,0+r),e.closePath(),e.fillStyle="rgba(250,250,250,0.7)",e.fill(),e.moveTo(-80*i,-40*i+r),e.lineTo(-160*i,-280*i+r),e.moveTo(80*i,-40*i+r),e.lineTo(160*i,-280*i+r),e.lineWidth=8,e.strokeStyle="rgba(250,250,250,0.7)",e.stroke(),e.beginPath(),e.moveTo(-30*i,250*i+r),e.lineTo(-30*i,290*i+r),e.moveTo(30*i,250*i+r),e.lineTo(30*i,290*i+r);break;case"Ahmed S2":e.beginPath(),e.moveTo(-100*i,230*i+r),e.lineTo(100*i,230*i+r),e.lineTo(200*i,0+r),e.lineTo(-40*i,0+r),e.lineTo(-200*i,0+r),e.closePath(),e.fillStyle="rgba(250,250,250,0.7)",e.fill(),e.beginPath(),e.moveTo(-280*i,0+r),e.lineTo(280*i,0+r),e.lineWidth=8,e.strokeStyle="rgba(250,250,250,0.7)",e.stroke();break;case"Ahmed S3":e.beginPath(),e.moveTo(-100*i,230*i+r),e.lineTo(100*i,230*i+r),e.lineTo(200*i,0+r),e.lineTo(-40*i,0+r),e.lineTo(-200*i,0+r),e.closePath(),e.fillStyle="rgba(250,250,250,0.7)",e.fill();break;case"Baerveldt 103-250":case"Baerveldt 101-350":case"Baerveldt 103-350":this.drawSpot(e,-120*i,20*i+r,10,"rgba(150,150,150,0.5)"),this.drawSpot(e,120*i,20*i+r,10,"rgba(150,150,150,0.5)"),e.beginPath(),e.moveTo(-30*i,250*i+r),e.lineTo(-30*i,290*i+r),e.moveTo(30*i,250*i+r),e.lineTo(30*i,290*i+r),e.strokeStyle="rgba(150,150,150,0.5)",e.stroke();break;case"Molteno Single":e.beginPath(),e.arc(0,r,250*i,0,2*Math.PI,!0),e.stroke(),this.drawSpot(e,-200*i,200*i+r,5,"rgba(255,255,255,1)"),this.drawSpot(e,-200*i,-200*i+r,5,"rgba(255,255,255,1)"),this.drawSpot(e,200*i,-200*i+r,5,"rgba(255,255,255,1)"),this.drawSpot(e,200*i,200*i+r,5,"rgba(255,255,255,1)");break;case"Molteno 8mm":e.beginPath(),e.arc(0,-710,200*i,0,2*Math.PI,!0),e.stroke(),this.drawSpot(e,-160*i,160*i+r+30,5,"rgba(255,255,255,1)"),this.drawSpot(e,-160*i,-160*i+r+30,5,"rgba(255,255,255,1)"),this.drawSpot(e,160*i,-160*i+r+30,5,"rgba(255,255,255,1)"),this.drawSpot(e,160*i,160*i+r+30,5,"rgba(255,255,255,1)")}if(this.tubeExtender)e.beginPath(),e.moveTo(0,290*i+r),e.lineTo(0,480*i+r);else{this.bezierArray.sp=new ED.Point(0,380*i+r),this.bezierArray.cp1=new ED.Point(0,460*i+r),this.bezierArray.ep=new ED.Point(this.apexX,this.apexY);var a=new ED.Point(this.apexX,this.apexY),o=a.direction()<Math.PI?a.direction():2*Math.PI-a.direction();this.bezierArray.cp2=a.pointAtRadiusAndClockwiseAngle(300*(1+1.5*o),.2*o),e.beginPath(),e.moveTo(0,290*i+r),e.lineTo(this.bezierArray.sp.x,this.bezierArray.sp.y),e.bezierCurveTo(this.bezierArray.cp1.x,this.bezierArray.cp1.y,this.bezierArray.cp2.x,this.bezierArray.cp2.y,this.bezierArray.ep.x,this.bezierArray.ep.y)}e.strokeStyle="rgba(150,150,150,0.5)",e.lineWidth=20,e.stroke(),e.strokeStyle="white",e.lineWidth=8,e.stroke()}return this.tubeExtender||(this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t)),this.isClicked},ED.Tube.prototype.description=function(){return this.type+" tube in the "+{STQ:"superotemporal",SNQ:"superonasal",INQ:"inferonasal",ITQ:"inferotemporal"}[this.platePosition]+" quadrant"},ED.TubeExtender=function(t,e){this.className="TubeExtender",this.platePosition="STQ",this.bezierArray=new Array,this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,t,e)},ED.TubeExtender.prototype=new ED.Doodle,ED.TubeExtender.prototype.constructor=ED.TubeExtender,ED.TubeExtender.superclass=ED.Doodle.prototype,ED.TubeExtender.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.TubeExtender.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var t=Math.PI/4;this.anglesArray=[t,3*t,5*t,7*t]},ED.TubeExtender.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ");var t=this.drawing.lastDoodleOfClass("Tube");t&&(this.rotation=t.rotation)},ED.TubeExtender.prototype.dependentParameterValues=function(t,e){var i=new Array,r=this.drawing.eye==ED.eye.Right,a=Math.PI/4;switch(t){case"rotation":this.rotation>0&&this.rotation<=2*a?i.platePosition=r?"SNQ":"STQ":this.rotation>2*a&&this.rotation<=4*a?i.platePosition=r?"INQ":"ITQ":this.rotation>4*a&&this.rotation<=6*a?i.platePosition=r?"ITQ":"INQ":i.platePosition=r?"STQ":"SNQ";break;case"platePosition":switch(e){case"STQ":i.rotation=r?7*a:a;break;case"SNQ":i.rotation=r?a:7*a;break;case"INQ":i.rotation=r?3*a:5*a;break;case"ITQ":i.rotation=r?5*a:3*a}}return i},ED.TubeExtender.prototype.draw=function(t){var e=this.drawing.context,i=this.drawing.lastDoodleOfClass("Tube");i&&(this.rotation=i.rotation),ED.TubeExtender.superclass.draw.call(this,t),e.beginPath();var r=.41666667,a=-680;if(this.roundRect(e,-160*r,200*r+a,320*r,200*r,40*r),e.lineWidth=4,e.strokeStyle="rgba(120,120,120,0.75)",e.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw){e.beginPath(),e.moveTo(0,180*r+a),e.lineTo(-30*r,180*r+a),e.quadraticCurveTo(-50*r,180*r+a,-50*r,200*r+a),e.lineTo(-50*r,260*r+a),e.quadraticCurveTo(-100*r,300*r+a,-50*r,340*r+a),e.lineTo(-50*r,400*r+a),e.quadraticCurveTo(-50*r,420*r+a,-30*r,420*r+a),e.lineTo(0,420*r+a),e.lineTo(30*r,420*r+a),e.quadraticCurveTo(50*r,420*r+a,50*r,400*r+a),e.lineTo(50*r,340*r+a),e.quadraticCurveTo(100*r,300*r+a,50*r,260*r+a),e.lineTo(50*r,200*r+a),e.quadraticCurveTo(50*r,180*r+a,30*r,180*r+a),e.closePath(),e.stroke(),this.drawCircle(e,-120*r,300*r+a,20*r,e.fillStyle,4,e.strokeStyle),this.drawCircle(e,120*r,300*r+a,20*r,e.fillStyle,4,e.strokeStyle),this.bezierArray.sp=new ED.Point(0,380*r+a),this.bezierArray.cp1=new ED.Point(0,460*r+a),this.bezierArray.ep=new ED.Point(this.apexX,this.apexY);var o=new ED.Point(this.apexX,this.apexY),n=o.direction()<Math.PI?o.direction():2*Math.PI-o.direction();this.bezierArray.cp2=o.pointAtRadiusAndClockwiseAngle(300*(1+1.5*n),.2*n),e.beginPath(),e.moveTo(0,290*r+a),e.lineTo(this.bezierArray.sp.x,this.bezierArray.sp.y),e.bezierCurveTo(this.bezierArray.cp1.x,this.bezierArray.cp1.y,this.bezierArray.cp2.x,this.bezierArray.cp2.y,this.bezierArray.ep.x,this.bezierArray.ep.y),e.strokeStyle="rgba(150,150,150,0.5)",e.lineWidth=20,e.stroke(),e.strokeStyle="white",e.lineWidth=8,e.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TubeExtender.prototype.description=function(){return"Tube extender present"},ED.TubeExtender.prototype.roundRect=function(t,e,i,r,a,o){void 0===o&&(o=5),t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+r-o,i),t.quadraticCurveTo(e+r,i,e+r,i+o),t.lineTo(e+r,i+a-o),t.quadraticCurveTo(e+r,i+a,e+r-o,i+a),t.lineTo(e+o,i+a),t.quadraticCurveTo(e,i+a,e,i+a-o),t.lineTo(e,i+o),t.quadraticCurveTo(e,i,e+o,i),t.closePath()},ED.TubeLigation=function(t,e){this.className="TubeLigation",this.material="Vicryl",this.controlParameterArray={material:"Material"},this.savedParameterArray=["originX","originY","rotation","material"],ED.Doodle.call(this,t,e)},ED.TubeLigation.prototype=new ED.Doodle,ED.TubeLigation.prototype.constructor=ED.TubeLigation,ED.TubeLigation.superclass=ED.Doodle.prototype,ED.TubeLigation.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1,this.parameterValidationArray.material={kind:"derived",type:"string",list:["10/0 Nylon","Vicryl","Prolene"],animate:!1}},ED.TubeLigation.prototype.setParameterDefaults=function(){this.originX=-240,this.originY=-240;var t=this.drawing.eye==ED.eye.Right;if(e=this.drawing.lastDoodleOfClass("Tube"))switch(e.platePosition){case"STQ":t?(this.originX=-240,this.originY=-240,this.rotation=-Math.PI/4):(this.originX=240,this.originY=-240,this.rotation=Math.PI/4);break;case"SNQ":t?(this.originX=240,this.originY=-240,this.rotation=Math.PI/4):(this.originX=-240,this.originY=-240,this.rotation=-Math.PI/4);break;case"INQ":t?(this.originX=240,this.originY=240,this.rotation=3*Math.PI/4):(this.originX=-240,this.originY=240,this.rotation=-3*Math.PI/4);break;case"ITQ":t?(this.originX=-240,this.originY=240,this.rotation=5*Math.PI/4):(this.originX=240,this.originY=240,this.rotation=-5*Math.PI/4)}var e,i=this.drawing.numberOfDoodlesOfClass(this.className),r=(e=this.drawing.firstDoodleOfClass(this.className)).originX>0?1:-1,a=e.originY>0?1:-1;switch(i){case 1:this.originX=400*r,this.originY=400*a;break;case 2:this.originX=320*r,this.originY=320*a}},ED.TubeLigation.prototype.draw=function(t){var e=this.drawing.context;return ED.TubeLigation.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-20,0),e.arcTo(0,-20,20,0,30),e.arcTo(0,20,-20,0,30),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="purple",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(35,-10),e.lineTo(20,0),e.lineTo(35,10),e.stroke(),this.drawSpot(e,20,0,4,"purple")),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.TubeLigation.prototype.groupDescription=function(){var t="",e=this.drawing.numberOfDoodlesOfClass(this.className);return t=e+" ligation suture",e>1&&(t+="s"),t},ED.UTear=function(t,e){this.className="UTear",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.UTear.prototype=new ED.Doodle,ED.UTear.prototype.constructor=ED.UTear,ED.UTear.superclass=ED.Doodle.prototype,ED.UTear.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.UTear.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30)},ED.UTear.prototype.setParameterDefaults=function(){this.apexY=-20,this.cachedClockHour=void 0;var t=this.drawing.lastDoodleOfClass(this.className);if(t){var e=new ED.Point(t.originX,t.originY),i=new ED.Point(0,0);i.setWithPolars(e.length(),e.direction()+Math.PI/6),this.move(i.x,i.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.UTear.prototype.draw=function(t){var e=this.drawing.context;return ED.UTear.superclass.draw.call(this,t),e.beginPath(),e.moveTo(0,40),e.bezierCurveTo(-20,40,-40,-20,-40,-40),e.bezierCurveTo(-40,-60,-20,this.apexY,0,this.apexY),e.bezierCurveTo(20,this.apexY,40,-60,40,-40),e.bezierCurveTo(40,-20,20,40,0,40),e.closePath(),e.lineWidth=4,e.fillStyle="red",e.strokeStyle="blue",this.drawBoundary(t),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(40,-40)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.cachedClockHour=this.clockHour(),this.isClicked},ED.UTear.prototype.groupDescription=function(){return"'U' tear at "},ED.UTear.prototype.description=function(){return this.cachedClockHour},ED.UTear.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.UTear.prototype.snomedCode=function(){return 247168006},ED.UTear.prototype.diagnosticHierarchy=function(){return 0},ED.Vicryl=function(t,e){this.className="Vicryl",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,t,e)},ED.Vicryl.prototype=new ED.Doodle,ED.Vicryl.prototype.constructor=ED.Vicryl,ED.Vicryl.superclass=ED.Doodle.prototype,ED.Vicryl.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1},ED.Vicryl.prototype.setParameterDefaults=function(){this.originY=-240,this.drawing.eye==ED.eye.Right?(this.originX=-240,this.rotation=-Math.PI/4):(this.originX=240,this.rotation=Math.PI/4)},ED.Vicryl.prototype.draw=function(t){var e=this.drawing.context;return ED.Vicryl.superclass.draw.call(this,t),e.beginPath(),e.moveTo(-20,0),e.arcTo(0,-20,20,0,30),e.arcTo(0,20,-20,0,30),e.lineWidth=4,e.fillStyle="rgba(0, 0, 0, 0)",e.strokeStyle="purple",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(e.beginPath(),e.moveTo(35,-10),e.lineTo(20,0),e.lineTo(35,10),e.stroke(),this.drawSpot(e,20,0,4,"purple")),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.Vicryl.prototype.description=function(){return"Vicryl suture"},ED.ViewObscured=function(t,e){this.className="ViewObscured",this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e)},ED.ViewObscured.prototype=new ED.Doodle,ED.ViewObscured.prototype.constructor=ED.ViewObscured,ED.ViewObscured.superclass=ED.Doodle.prototype,ED.ViewObscured.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ViewObscured.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.ViewObscured.prototype.setParameterDefaults=function(){this.apexY=-100},ED.ViewObscured.prototype.draw=function(t){var e=this.drawing.context;ED.ViewObscured.superclass.draw.call(this,t),e.beginPath();e.rect(-499,-499,998,998);var i=.3+.6*(200+2*this.apexY)/200;return e.fillStyle="rgba(150, 150, 150,"+i+")",e.lineWidth=0,e.strokeStyle="rgba(150, 150, 150, 0)",this.drawBoundary(t),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.ViewObscured.prototype.description=function(){var t,e;return this.apexY<-50?(t="Poor view of ",e=""):(t="",e=" obscured"),this.drawing.hasDoodleOfClass("PostPole")?t+="Posterior pole":this.drawing.hasDoodleOfClass("Fundus")?t+="Fundus":this.drawing.hasDoodleOfClass("OpticDisc")&&(t+="Optic disc"),t+=e},ED.VisualField=function(t,e){this.className="VisualField",this.numberOfHandles=8,this.blindSpotX=0,this.savedParameterArray=["apexY"],ED.Doodle.call(this,t,e)},ED.VisualField.prototype=new ED.Doodle,ED.VisualField.prototype.constructor=ED.VisualField,ED.VisualField.superclass=ED.Doodle.prototype,ED.VisualField.prototype.setHandles=function(){for(var t=0;t<this.numberOfHandles;t++)this.handleArray[t]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.VisualField.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.handleVectorRangeArray=new Array;for(var t=0;t<this.numberOfHandles;t++){var e=2*Math.PI,i=new Object;i.length=new ED.Range(0,400),i.angle=new ED.Range((15*e/16+t*e/8)%e,(1*e/16+t*e/8)%e),this.handleVectorRangeArray[t]=i}},ED.VisualField.prototype.setParameterDefaults=function(){this.apexY=-40;var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],i=0;i<this.numberOfHandles;i++){var r=e[i],a=new ED.Point(r[0],r[1]);this.addPointToSquiggle(a)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualField.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.VisualField.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],e.length()<100||i.length()<100?o.lineTo(i.x,i.y):(r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y))}o.moveTo(this.blindSpotX-this.apexY,0),o.arc(this.blindSpotX,0,-this.apexY,0,2*Math.PI,!0),o.closePath(),o.lineWidth=2,o.fillStyle="lightGray",o.strokeStyle="black",this.drawBoundary(t),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(o.beginPath(),o.moveTo(0,-450),o.lineTo(0,450),o.moveTo(-450,0),o.lineTo(450,0),o.lineWidth=8,o.strokeStyle="black",o.stroke());for(s=0;s<this.numberOfHandles;s++)this.handleArray[s].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[s]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.blindSpotX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked};ED.VisualField.prototype.description=function(){return""},ED.VisualFieldChart=function(t,e){this.className="VisualFieldChart",this.numberOfHandles=8,this.blindSpotX=0,ED.Doodle.call(this,t,e)},ED.VisualFieldChart.prototype=new ED.Doodle,ED.VisualFieldChart.prototype.constructor=ED.VisualFieldChart,ED.VisualFieldChart.superclass=ED.Doodle.prototype,ED.VisualFieldChart.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.VisualFieldChart.prototype.setParameterDefaults=function(){var t=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(t);for(var e=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],i=0;i<this.numberOfHandles;i++){var r=e[i],a=new ED.Point(r[0],r[1]);this.addPointToSquiggle(a)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualFieldChart.prototype.draw=function(t){var e,i,r,a,o=this.drawing.context;ED.VisualFieldChart.superclass.draw.call(this,t),o.beginPath();var n=2*Math.PI/(3*this.numberOfHandles);o.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var s=0;s<this.numberOfHandles;s++){e=this.squiggleArray[0].pointsArray[s];var l=s<this.numberOfHandles-1?s+1:0;i=this.squiggleArray[0].pointsArray[l],r=e.tangentialControlPoint(+n),a=i.tangentialControlPoint(-n),o.bezierCurveTo(r.x,r.y,a.x,a.y,i.x,i.y)}return o.closePath(),o.lineWidth=2,o.fillStyle="gray",o.strokeStyle="black",this.drawBoundary(t),this.isClicked},ED.VitelliformMacularLesion=function(t,e){this.className="VitelliformMacularLesion",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,t,e)},ED.VitelliformMacularLesion.prototype=new ED.Doodle,ED.VitelliformMacularLesion.prototype.constructor=ED.VitelliformMacularLesion,ED.VitelliformMacularLesion.superclass=ED.Doodle.prototype,ED.VitelliformMacularLesion.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.VitelliformMacularLesion.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(10,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.originX.range.setMinAndMax(-250,250),this.parameterValidationArray.originY.range.setMinAndMax(-250,250)},ED.VitelliformMacularLesion.prototype.setParameterDefaults=function(){this.apexX=100},ED.VitelliformMacularLesion.prototype.dependentParameterValues=function(t,e){},ED.VitelliformMacularLesion.prototype.draw=function(t){var e=this.drawing.context;ED.VitelliformMacularLesion.superclass.draw.call(this,t),e.beginPath();var i=this.apexX;e.arc(0,0,i,0,2*Math.PI,!0);var r=e.createRadialGradient(0,0,.5*i,0,0,i);return r.addColorStop(0,"rgba(255,190,0,1)"),r.addColorStop(1,"rgba(205,135,140,1)"),e.lineWidth=4,e.fillStyle=r,e.strokeStyle=e.fillStyle,this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VitelliformMacularLesion.prototype.description=function(){return"Vitelliform macular lesions"},ED.VitelliformMacularLesion.prototype.snomedCode=function(){return 247155003},ED.VitreousOpacity=function(t,e){this.className="VitreousOpacity",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,t,e)},ED.VitreousOpacity.prototype=new ED.Doodle,ED.VitreousOpacity.prototype.constructor=ED.VitreousOpacity,ED.VitreousOpacity.superclass=ED.Doodle.prototype,ED.VitreousOpacity.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.VitreousOpacity.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.VitreousOpacity.prototype.setParameterDefaults=function(){this.apexY=-100,this.setOriginWithDisplacements(0,-100)},ED.VitreousOpacity.prototype.draw=function(t){var e=this.drawing.context;ED.VitreousOpacity.superclass.draw.call(this,t),e.beginPath(),e.beginPath();e.arc(0,0,200,0,2*Math.PI,!0);var i=.3+.6*(200+2*this.apexY)/200;return e.fillStyle="rgba(255, 0, 0,"+i+")",e.lineWidth=0,e.strokeStyle="rgba(255, 0, 0, 0)",this.drawBoundary(t),this.drawFunctionMode,ED.drawFunctionMode.Draw,point=new ED.Point(0,0),point.setWithPolars(200,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(t),this.isClicked},ED.VitreousOpacity.prototype.description=function(){return"Vitreous haemorrhage"},ED.VitreousOpacity.prototype.snomedCode=function(){return 31341008};