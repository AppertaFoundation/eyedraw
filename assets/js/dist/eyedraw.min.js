/*! eyedraw 05-12-2014 */
var ED=ED||{};ED.handleRadius=15,ED.arrowDelta=4,ED.squiggleWidth={Thin:4,Medium:12,Thick:20},ED.squiggleStyle={Outline:0,Solid:1},ED.recentClick=!1,ED.eye={Right:0,Left:1},ED.drawFunctionMode={Draw:0,HitTest:1},ED.Mode={None:0,Move:1,Scale:2,Arc:3,Rotate:4,Apex:5,Handles:6,Draw:7,Select:8,Size:9},ED.handleRing={Inner:0,Outer:1},ED.modified=!1,ED.findOffset=function(a,b,c){if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}}},ED.findPosition=function(a,b){var c;return c="undefined"!=typeof jQuery?jQuery(a).offset():ED.findOffset(a,0,0),{x:b.pageX-c.left,y:b.pageY-c.top}},ED.objectIsEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},ED.isFirefox=function(){var a=0,b=window.navigator.userAgent;return a=b.indexOf("Firefox"),a>0?!0:!1},ED.isNumeric=function(a){return a-0==a&&a.length>0},ED.Mod=function(a,b){return a-Math.floor(a/b)*b},ED.positiveAngle=function(a){for(var b=2*Math.PI;0>a;)a+=b;return a%b},ED.errorHandler=function(a,b,c){console.log("EYEDRAW ERROR! class: ["+a+"] method: ["+b+"] message: ["+c+"]")},ED.firstLetterToUpperCase=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},ED.firstLetterToLowerCase=function(a){var b=a.charAt(1);return b===b.toUpperCase()?a:a.charAt(0).toLowerCase()+a.slice(1)},ED.addAndAfterLastComma=function(a){for(var b=!1,c=a.length-1;c>=0;c--)if(","===a.charAt(c)){b=!0;break}return b?a.substring(0,c)+", and"+a.substring(c+1,a.length):a},ED.titles={},ED.setTitles=function(a){$.extend(this.titles,a)},ED.randomArray=[.657,.2886,.7388,.1621,.9896,.0434,.1695,.9099,.1948,.4433,.158,.7392,.873,.2165,.7138,.6316,.3425,.2838,.4551,.4153,.7421,.3364,.6087,.1986,.5764,.1952,.6179,.6699,.0903,.2968,.2684,.9383,.2488,.4579,.2921,.9085,.7951,.45,.2255,.3366,.667,.73,.5511,.5623,.1376,.5553,.9898,.4317,.5922,.6452,.5008,.7077,.0704,.2293,.5697,.7415,.1557,.2944,.4566,.4129,.2449,.562,.4105,.5486,.8917,.9346,.0921,.7998,.7717,.0357,.1179,.0168,.152,.5187,.3466,.1663,.5935,.7524,.841,.1859,.6012,.8171,.9272,.3367,.8133,.4868,.3665,.9625,.7839,.3052,.1651,.6414,.7361,.0065,.3267,.0554,.3389,.8967,.8777,.0557,.9201,.6015,.2676,.3365,.2606,.0989,.2085,.3526,.8476,.0146,.019,.6896,.5198,.9871,.0288,.8037,.6741,.2148,.2584,.8447,.848,.5557,.248,.4736,.8869,.1867,.3869,.6871,.1011,.7561,.734,.1525,.9968,.8179,.7103,.5462,.415,.4187,.0478,.6511,.0386,.5243,.7271,.9093,.4461,.1264,.0756,.9405,.7287,.0684,.282,.4059,.3694,.7641,.4188,.0498,.7841,.9136,.621,.2249,.9935,.9709,.0741,.6218,.3166,.2237,.7754,.4191,.2195,.2935,.4529,.9112,.9183,.3275,.1856,.8345,.0442,.6297,.903,.4689,.9512,.2219,.9993,.8981,.1018,.9362,.6426,.4563,.1267,.7889,.5057,.8588,.4669,.0687,.6623,.3681,.8152,.9004,.0822,.3652];var ED=ED||{};if(ED.Drawing=function(a,b,c,d,e){if(!(a&&a instanceof HTMLCanvasElement))return void ED.errorHandler("ED.Drawing","constructor","Invalid canvas element");var f=0,g=0,h=!1,i=1,j=0;if(this.graphicsPath="assets/img",this.scaleOn="height","undefined"!=typeof e&&(e.offsetX&&(f=e.offsetX),e.offsetY&&(g=e.offsetY),e.toImage&&(h=e.toImage),e.graphicsPath&&(this.graphicsPath=e.graphicsPath),e.scaleOn&&(this.scaleOn=e.scaleOn),e.scale&&(i=e.scale),e.toggleScale&&(j=e.toggleScale)),this.drawingName=e.drawingName,this.canvas=a,this.eye=b,this.idSuffix=c,this.isEditable=d,this.hoverTimer=null,this.convertToImage=h&&!this.isEditable?!0:!1,this.context=this.canvas.getContext("2d"),this.doodleArray=new Array,this.bindingArray=new Array,this.listenerArray=new Array,this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.selectedDoodle=null,this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.lastMousePosition=new ED.Point(0,0),this.doubleClickMilliSeconds=250,this.readyNotificationSent=!1,this.newPointOnClick=!1,this.completeLine=!1,this.globalScaleFactor=i,this.toggleScaleFactor=j,this.origScaleLevel=i,this.scrollValue=0,this.lastDoodleId=0,this.isActive=!1,this.isNew=!0,this.isReady=!1,this.showDoodleControls=!1,this.onReadyCommands=[],this.resetDoodleSet=!1,this.boundElementDeleteValueArray=new Array,this.canvasParent=this.canvas.parentElement,this.notificationArray=new Array,this.canvasTooltip=document.getElementById(this.canvas.id+"Tooltip"),this.scale="height"==this.scaleOn?this.canvas.height/1001:this.canvas.width/1001,this.doodlePlaneWidth=this.canvas.width/this.scale,this.doodlePlaneHeight=this.canvas.height/this.scale,this.imageArray=new Array,this.imageArray.LatticePattern=new Image,this.imageArray.CribriformPattern=new Image,this.imageArray.CribriformPatternSmall=new Image,this.imageArray.CryoPattern=new Image,this.imageArray.AntPVRPattern=new Image,this.imageArray.LaserPattern=new Image,this.imageArray.FuchsPattern=new Image,this.imageArray.PSCPattern=new Image,this.imageArray.MeshworkPatternLight=new Image,this.imageArray.MeshworkPatternMedium=new Image,this.imageArray.MeshworkPatternHeavy=new Image,this.imageArray.NewVesselPattern=new Image,this.imageArray.OedemaPattern=new Image,this.imageArray.OedemaPatternBullous=new Image,this.imageArray.BrownSpotPattern=new Image,this.transform.translate(this.canvas.width/2,this.canvas.height/2),this.transform.scale(this.scale,this.scale),this.inverseTransform=this.transform.createInverse(),this.clear(),this.selectionRectangleIsBeingDragged=!1,this.selectionRectangleStart=new ED.Point(0,0),this.selectionRectangleEnd=new ED.Point(0,0),this.isEditable){var k=this;this.canvas.addEventListener("mousedown",function(a){var b=ED.findPosition(this,a),c=new ED.Point(b.x,b.y);k.mousedown(c)},!1),this.canvas.addEventListener("mouseup",function(a){var b=ED.findPosition(this,a),c=new ED.Point(b.x,b.y);k.mouseup(c)},!1),this.canvas.addEventListener("mousemove",function(a){var b=ED.findPosition(this,a),c=new ED.Point(b.x,b.y);k.mousemove(c)},!1),this.canvas.addEventListener("mouseover",function(a){var b=ED.findPosition(this,a),c=new ED.Point(b.x,b.y);k.mouseover(c)},!1),this.canvas.addEventListener("mouseout",function(a){var b=ED.findPosition(this,a),c=new ED.Point(b.x,b.y);k.mouseout(c)},!1),document.body.addEventListener("mousedown",function(a){var b=a.target,c=!1,d="("+["ed-doodle-popup","ed-button","ed-canvas","ed_canvas","ed-selected-doodle-select"].join(")|(")+")";do c=new RegExp(d).test(b.className);while((b=b.parentNode)&&b!==document.body&&!c);c||k.deselectDoodles()},!1),this.canvas.addEventListener("touchstart",function(a){if(void 0!==a.targetTouches[0]){var b=k.getPositionOfElement(k.canvas),c=new ED.Point(a.targetTouches[0].pageX-b[0]-this.offsetLeft,a.targetTouches[0].pageY-b[1]);a.preventDefault()}else ED.errorHandler("ED.Drawing","Class","Touches undefined: ");k.mousedown(c)},!1),this.canvas.addEventListener("touchend",function(a){if(void 0!==a.targetTouches[0]){var b=k.getPositionOfElement(k.canvas),c=new ED.Point(a.targetTouches[0].pageX-b[0]-this.offsetLeft,a.targetTouches[0].pageY-b[1]);k.mouseup(c)}},!1),this.canvas.addEventListener("touchmove",function(a){if(void 0!==a.targetTouches[0]){var b=k.getPositionOfElement(k.canvas),c=new ED.Point(a.targetTouches[0].pageX-b[0]-this.offsetLeft,a.targetTouches[0].pageY-b[1]);k.mousemove(c)}},!1),window.addEventListener("keydown",function(b){document.activeElement===a&&k.keydown(b)},!0),this.canvas.onselectstart=function(){return!1}}},ED.Drawing.prototype.getPositionOfElement=function(a){for(var b=0,c=0;;){if(b+=a.offsetLeft,c+=a.offsetTop,null===a.offsetParent)break;a=a.offsetParent}return[b,c]},ED.Drawing.prototype.init=function(){this.preLoadImagesFrom(this.graphicsPath+"/patterns/")},ED.Drawing.prototype.replaceWithImage=function(){var a=document.createElement("img");if(a.setAttribute("src",this.canvas.toDataURL("image/png")),this.canvasParent.hasChildNodes())for(;this.canvasParent.childNodes.length>=1;)this.canvasParent.removeChild(this.canvasParent.firstChild);this.canvasParent.appendChild(a)},ED.Drawing.prototype.preLoadImagesFrom=function(a){var b=this;for(var c in this.imageArray)this.imageArray[c].onload=function(){b.checkAllLoaded()},this.imageArray[c].onerror=function(b){return function(){ED.errorHandler("ED.Drawing","preLoadImagesFrom",'Error loading image file "'+b+'.gif" from directory: "'+a+'"')}}(c),this.imageArray[c].src=a+c+".gif"},ED.Drawing.prototype.checkAllLoaded=function(){var a=!0;for(var b in this.imageArray){var c=!1;this.imageArray[b].width>0&&(c=!0),a=a&&c}a&&(this.readyNotificationSent||(this.readyNotificationSent=!0,this.notify("ready")))},ED.Drawing.prototype.registerForNotifications=function(a,b,c){"undefined"==typeof b&&(b="notificationHandler"),"undefined"==typeof c&&(c=new Array),this.notificationArray.push({object:a,methodName:b,notificationList:c})},ED.Drawing.prototype.unRegisterForNotifications=function(a){var b=this.notificationArray.indexOf(a);b>=0&&this.notificationArray.splice(b,1)},ED.Drawing.prototype.notify=function(a,b){for(var c={eventName:a,selectedDoodle:this.selectedDoodle,object:b},d=0;d<this.notificationArray.length;d++){var e=this.notificationArray[d].notificationList,f=this.notificationArray[d].object,g=this.notificationArray[d].methodName;(0==e.length||e.indexOf(a)>=0)&&("undefined"!=typeof f[g]?f[g].apply(f,[c]):ED.errorHandler("ED.Drawing","notify","Attempt to call undefined notification handler method"))}},ED.Drawing.prototype.loadDoodles=function(a){var b=document.getElementById(a);if(b&&b.value.length>0){var c=window.JSON.parse(b.value);this.resetDoodleSet=c,this.load(c),this.isNew=!1,this.notify("doodlesLoaded")}},ED.Drawing.prototype.load=function(a){for(var b=0;b<a.length;b++){if(void 0===ED[a[b].subclass]){ED.errorHandler("ED.Drawing","load","Unrecognised doodle: "+a[b].subclass);break}this.doodleArray[b]=new ED[a[b].subclass](this,a[b]),this.doodleArray[b].id=b}this.doodleArray.sort(function(a,b){return a.order-b.order})},ED.Drawing.prototype.save=function(){return"["+this.json()+"]"},ED.Drawing.prototype.json=function(){for(var a="",b=0;b<this.doodleArray.length;b++){var c=this.doodleArray[b];c.isSaveable&&(a=a+c.json()+",")}return a=a.substring(0,a.length-1)},ED.Drawing.prototype.drawAllDoodles=function(){var a=this.context;a.beginPath();for(var b,c=!1,d=0;d<this.doodleArray.length;d++)this.doodleArray[d].isPointInLine&&(c?a.lineTo(this.doodleArray[d].originX,this.doodleArray[d].originY):(a.moveTo(this.doodleArray[d].originX,this.doodleArray[d].originY),c=!0,b=new ED.Point(this.doodleArray[d].originX,this.doodleArray[d].originY)));this.completeLine&&"undefined"!=typeof b&&a.lineTo(b.x,b.y),c&&(a.lineWidth=4,a.strokeStyle="rgba(20,20,20,1)",a.stroke());for(var d=0;d<this.doodleArray.length;d++)this.context.save(),this.doodleArray[d].draw(),this.context.restore()},ED.Drawing.prototype.mousedown=function(a){this.mouseDown=!0,ED.recentClick&&(this.doubleClick=!0),ED.recentClick=!0;var b=(setTimeout("ED.recentClick = false;",this.doubleClickMilliSeconds),!1);this.lastSelectedDoodle=this.selectedDoodle,this.selectedDoodle=null;for(var c=this.doodleArray.length-1;c>-1;c--)b?(this.doodleArray[c].isSelected=!1,this.doodleArray[c].isForDrawing=!1):(this.context.save(),this.doodleArray[c].draw(a)?this.doodleArray[c].isSelectable&&(this.doubleClick&&this.doodleArray[c].isSelected&&this.doodleArray[c].isDrawable&&(this.doodleArray[c].isForDrawing=!0),b=!0,this.selectDoodle(this.doodleArray[c]),!this.doubleClick&&this.doodleArray[c].isForDrawing&&this.doodleArray[c].addSquiggle()):(this.doodleArray[c].isSelected=!1,this.doodleArray[c].isForDrawing=!1),this.context.restore()),this.doodleArray[c].isBeingDragged=!1;if(this.selectedDoodle||this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.lastSelectedDoodle&&this.lastSelectedDoodle!=this.selectedDoodle&&this.notify("doodleDeselected"),this.newPointOnClick&&!b){var d=this.inverseTransform.transformPoint(a),e=this.addDoodle("PointInLine");e.originX=d.x,e.originY=d.y}this.repaint(),this.notify("mousedown",{drawing:this,point:a})},ED.Drawing.prototype.mousemove=function(a){this.notify("mousemove",{drawing:this,point:a});var b=this.selectedDoodle;if(!b||!this.selectedDoodle.isLocked){var c="";if(this.startHoverTimer(a),this.mouseDown&&null!=b){if(b.isBeingDragged){var d=this.inverseTransform.transformPoint(a),e=this.inverseTransform.transformPoint(this.lastMousePosition),f=b.inverseTransform.transformPoint(a),g=b.inverseTransform.transformPoint(this.lastMousePosition),h=new ED.Point(a.x-this.canvas.width/2,a.y-this.canvas.height/2),i=new ED.Point(this.lastMousePosition.x-this.canvas.width/2,this.lastMousePosition.y-this.canvas.height/2),j=new ED.Point(0,0),k=new ED.Point(0,-100),l=new ED.Point(b.originX,b.originY),m=new ED.Point(b.originX,b.originY-100);switch(this.mode){case ED.Mode.None:break;case ED.Mode.Move:if(b.isMoveable){var n=b.originX,o=b.originY;if(b.snapToGrid){var p=d.x-b.gridDisplacementX,q=Math.floor(p/b.gridSpacing),r=ED.Mod(p,b.gridSpacing);n=b.gridDisplacementX+b.gridSpacing*(q+Math.round(r/b.gridSpacing));var s=d.y-b.gridDisplacementY,t=Math.floor(s/b.gridSpacing),u=ED.Mod(s,b.gridSpacing);o=b.gridDisplacementY+b.gridSpacing*(t+Math.round(u/b.gridSpacing)),b.move(n-b.originX,o-b.originY)}else b.snapToQuadrant?(0!=d.x&&(n=b.quadrantPoint.x*d.x/Math.abs(d.x)),0!=d.y&&(o=b.quadrantPoint.y*d.y/Math.abs(d.y)),b.move(n-b.originX,o-b.originY)):b.snapToPoints?(n=b.nearestPointTo(d).x,o=b.nearestPointTo(d).y,b.move(n-b.originX,o-b.originY)):b.move(d.x-e.x,d.y-e.y);c="move"}else if(b.isRotatable){var v=this.innerAngle(k,j,i),w=this.innerAngle(k,j,h),x=w-v;if(b.snapToAngles)var y=b.nearestAngleTo(w);else var y=ED.Mod(b.rotation+x,2*Math.PI);b.setSimpleParameter("rotation",b.parameterValidationArray.rotation.range.constrainToAngularRange(y,!1)),b.updateDependentParameters("rotation");var z=Math.sqrt(e.x*e.x+e.y*e.y),A=Math.sqrt(d.x*d.x+d.y*d.y),B=b.radius+(A-z);b.setSimpleParameter("radius",b.parameterValidationArray.radius.range.constrain(B)),b.updateDependentParameters("radius")}break;case ED.Mode.Scale:if(b.isScaleable){var C=b.scaleX/Math.abs(b.scaleX),D=b.scaleY/Math.abs(b.scaleY),E=f.x/g.x,F=f.y/g.y;b.isSqueezable||(F=E>F?E:E),E>0&&F>0?(newScaleX=b.scaleX*E,newScaleY=b.scaleY*F,newScaleX=b.parameterValidationArray.scaleX.range.constrain(Math.abs(newScaleX),this.globalScaleFactor),newScaleY=b.parameterValidationArray.scaleY.range.constrain(Math.abs(newScaleY),this.globalScaleFactor),b.setSimpleParameter("scaleX",newScaleX*C),b.setSimpleParameter("scaleY",newScaleY*D),b.updateDependentParameters("scaleX"),b.updateDependentParameters("scaleY")):this.mode=ED.Mode.None}break;case ED.Mode.Arc:var w=this.innerAngle(m,l,f),v=this.innerAngle(m,l,g),G=w-v;b.isArcSymmetrical&&(G=2*G),rotationCorrection=1,b.draggingHandleIndex<2&&(G=-G,rotationCorrection=-1),b.snapToArc?(0>rotationCorrection&&(w=2*Math.PI-ED.positiveAngle(w)),b.setSimpleParameter("arc",b.nearestArcTo(b.arc/2+w))):b.parameterValidationArray.arc.range.isBelow(b.arc+G)?(G=b.parameterValidationArray.arc.range.min-b.arc,b.setSimpleParameter("arc",b.parameterValidationArray.arc.range.min),this.mode=ED.Mode.None):b.parameterValidationArray.arc.range.isAbove(b.arc+G)?(G=b.parameterValidationArray.arc.range.max-b.arc,b.setSimpleParameter("arc",b.parameterValidationArray.arc.range.max),this.mode=ED.Mode.None):b.setSimpleParameter("arc",b.arc+G),b.updateDependentParameters("arc"),b.isArcSymmetrical||(rotationCorrection=rotationCorrection*G/2,b.setSimpleParameter("rotation",b.rotation+rotationCorrection),b.updateDependentParameters("rotation"));break;case ED.Mode.Rotate:if(b.isRotatable){var v=this.innerAngle(m,l,e),w=this.innerAngle(m,l,d),G=w-v,y=b.rotation+G;y=ED.positiveAngle(y),b.setSimpleParameter("rotation",b.parameterValidationArray.rotation.range.constrainToAngularRange(y,!1)),b.updateDependentParameters("rotation")}break;case ED.Mode.Apex:var H=b.apexX+(f.x-g.x),I=b.apexY+(f.y-g.y);b.setSimpleParameter("apexX",b.parameterValidationArray.apexX.range.constrain(H)),b.setSimpleParameter("apexY",b.parameterValidationArray.apexY.range.constrain(I)),b.updateDependentParameters("apexX"),b.updateDependentParameters("apexY");break;case ED.Mode.Size:var J=b.width+2*(f.x-g.x),K=b.height-2*(f.y-g.y);b.setSimpleParameter("width",b.parameterValidationArray.width.range.constrain(J)),b.setSimpleParameter("height",b.parameterValidationArray.height.range.constrain(K)),b.updateDependentParameters("width"),b.updateDependentParameters("height");break;case ED.Mode.Handles:var L=b.draggingHandleIndex,M=new ED.Point(0,0);if(M.x=b.squiggleArray[0].pointsArray[L].x+(f.x-g.x),M.y=b.squiggleArray[0].pointsArray[L].y+(f.y-g.y),"undefined"!=typeof b.handleCoordinateRangeArray&&(M.x=b.handleCoordinateRangeArray[L].x.constrain(M.x),M.y=b.handleCoordinateRangeArray[L].y.constrain(M.y)),"undefined"!=typeof b.handleVectorRangeArray){var N=b.handleVectorRangeArray[L].length.constrain(M.length()),O=b.handleVectorRangeArray[L].angle.constrainToAngularRange(M.direction(),!1);M.setWithPolars(N,O)}b.squiggleArray[0].pointsArray[L].x=M.x,b.squiggleArray[0].pointsArray[L].y=M.y,b.updateDependentParameters("handles");break;case ED.Mode.Draw:var P=new ED.Point(f.x,f.y);b.addPointToSquiggle(P);break;case ED.Mode.Select:var P=new ED.Point(f.x,f.y)}}else b.isBeingDragged=!0;this.lastMousePosition=a,this.notify("mousedragged",{point:a,action:c}),this.repaint()}}},ED.Drawing.prototype.mouseup=function(a){this.mouseDown=!1,this.doubleClick=!1,this.mode=ED.Mode.None,this.selectionRectangleIsBeingDragged=!1,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles()),this.selectedDoodle.willStaySelected||(this.selectedDoodle.isSelected=!1,this.selectedDoodle=null)),this.repaint(),this.notify("mouseup",a)},ED.Drawing.prototype.mouseover=function(a){this.isActive=!0,this.notify("mouseover",a)},ED.Drawing.prototype.mouseout=function(a){this.isActive=!1,this.stopHoverTimer(),this.mouseDown=!1,this.mode=ED.Mode.None,null!=this.selectedDoodle&&(this.selectedDoodle.isBeingDragged=!1,this.selectedDoodle.isDrawable&&(this.selectedDoodle.completeSquiggle(),this.drawAllDoodles())),this.notify("mouseout",a)},ED.Drawing.prototype.keydown=function(a){if(null!=this.selectedDoodle){switch(a.keyCode){case 8:"Label"!=this.selectedDoodle.className&&this.deleteSelectedDoodle();break;case 37:this.selectedDoodle.move(-ED.arrowDelta,0);break;case 38:this.selectedDoodle.move(0,-ED.arrowDelta);break;case 39:this.selectedDoodle.move(ED.arrowDelta,0);break;case 40:this.selectedDoodle.move(0,ED.arrowDelta)}this.repaint(),a.stopPropagation(),a.preventDefault(),this.notify("keydown",a.keyCode)}},ED.Drawing.prototype.startHoverTimer=function(a){if(this.isEditable&&null!=this.canvasTooltip){this.stopHoverTimer();var b=this;this.hoverTimer=setTimeout(function(){b.hover(a)},1e3)}},ED.Drawing.prototype.stopHoverTimer=function(){null!=this.canvasTooltip&&(clearTimeout(this.hoverTimer),this.canvasTooltip.innerHTML="",this.hideTooltip())},ED.Drawing.prototype.hover=function(a){this.showTooltip(a),this.notify("hover",a)},ED.Drawing.prototype.showTooltip=function(a){return},ED.Drawing.prototype.hideTooltip=function(){this.canvasTooltip.style.display="none"},ED.Drawing.prototype.moveToFront=function(){if(null!=this.selectedDoodle){if(this.selectedDoodle.isLocked)return;this.selectedDoodle.order=1e3,this.doodleArray.sort(function(a,b){return a.order-b.order});for(var a=0;a<this.doodleArray.length;a++)this.doodleArray[a].order=a;this.repaint()}this.notify("moveToFront")},ED.Drawing.prototype.moveToBack=function(){if(null!==this.selectedDoodle){if(this.selectedDoodle.isLocked)return;this.selectedDoodle.order=-1,this.doodleArray.sort(function(a,b){return a.order-b.order});for(var a=0;a<this.doodleArray.length;a++)this.doodleArray[a].order=a;this.repaint()}this.notify("moveToBack")},ED.Drawing.prototype.moveNextTo=function(a,b,c){if(this.hasDoodleOfClass(b)){a.order=1e3,this.doodleArray.sort(function(a,b){return a.order-b.order});for(var d=0;d<this.doodleArray.length;d++)this.doodleArray[d].order=d;for(var e=0,d=0;d<this.doodleArray.length-1;d++)this.doodleArray[d].order=d+e,this.doodleArray[d].className==b&&(e=1,c?a.order=d+1:(a.order=d,this.doodleArray[d].order=d+1));this.doodleArray.sort(function(a,b){return a.order-b.order})}},ED.Drawing.prototype.flipVer=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleY=-1*this.selectedDoodle.scaleY,this.repaint()),this.notify("flipVer")},ED.Drawing.prototype.flipHor=function(){null!=this.selectedDoodle&&(this.selectedDoodle.scaleX=-1*this.selectedDoodle.scaleX,this.repaint()),this.notify("flipHor")},ED.Drawing.prototype.deleteDoodle=function(a,b){var c=!1,d="Attempt to delete a doodle that does not exist";if(b||a.willDelete()){for(var e=0;e<this.doodleArray.length;e++)if(this.doodleArray[e].id==a.id)if(b||this.doodleArray[e].isDeletable){c=a.className,null!=this.selectedDoodle&&this.selectedDoodle.id==a.id&&(this.selectedDoodle.onDeselection(),this.selectedDoodle=null);for(var f in a.bindingArray){var g=a.bindingArray[f].id,h=a.bindingArray[f].attribute,i=document.getElementById(g),j=this.boundElementDeleteValueArray[g];if(null!=i&&"undefined"!=typeof j)switch(i.type){case"checkbox":h?ED.errorHandler("ED.Drawing","deleteDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==j?i.setAttribute("checked","checked"):i.removeAttribute("checked");break;case"select-one":if(h){for(var k=0;k<i.length;k++)if(i.options[k].getAttribute(h)==j){i.value=i.options[k].value;break}}else i.value=j;break;default:h?i.setAttribute(h,j):i.value=j}a.removeBinding(f)}this.doodleArray.splice(e,1)}else d="Attempt to delete a doodle that is not deletable, className: "+a.className}else d="Doodle refused permission to be deleted, className: "+a.className;if(c){for(var e=0;e<this.doodleArray.length;e++)this.doodleArray[e].order=e;this.repaint(),this.notify("doodleDeleted",c)}else ED.errorHandler("ED.Drawing","deleteDoodle",d)},ED.Drawing.prototype.deleteSelectedDoodle=function(){null!=this.selectedDoodle?this.deleteDoodle(this.selectedDoodle,!1):ED.errorHandler("ED.Drawing","deleteSelectedDoodle","Attempt to delete selected doodle, when none selected")},ED.Drawing.prototype.resetEyedraw=function(){if(this.notify("beforeReset"),this.deleteAllDoodles(!0),this.notify(this.resetDoodleSet!==!1?"resetEdit":"reset"),this.resetDoodleSet!==!1)this.load(this.resetDoodleSet),this.isNew=!1,this.notify("doodlesLoaded");else for(var a=0;a<this.onReadyCommands.length;a++)for(var b=0;b<this.onReadyCommands[a].length;b++){var c=this.onReadyCommands[a][b][0],d=this.onReadyCommands[a][b][1];this[c].apply(this,d)}this.drawAllDoodles(),this.deselectDoodles(),this.addBindings(this.bindingArray)},ED.Drawing.prototype.setScaleForDrawingAndDoodles=function(a){this.globalScaleFactor=a,this.doodleArray.forEach(function(b){b.setScaleLevel(a)}),this.repaint()},ED.Drawing.prototype.setScaleLevel=function(a){this.setScaleForDrawingAndDoodles(a),this.notifyZoomLevel()},ED.Drawing.prototype.toggleZoom=function(){if(this.toggleScaleFactor){var a=this.globalScaleFactor===this.toggleScaleFactor?this.origScaleLevel:this.toggleScaleFactor;this.setScaleLevel(a)}},ED.Drawing.prototype.notifyZoomLevel=function(){var a,b="drawingZoomIn",c="drawingZoomOut";a=this.origScaleLevel<this.toggleScaleFactor?this.globalScaleFactor<this.toggleScaleFactor?c:b:this.globalScaleFactor<=this.toggleScaleFactor?c:b,this.notify("drawingZoom"),this.notify(a)},ED.Drawing.prototype.setSelectedDoodle=function(a,b){var c=a.checked?"true":"false";null!=this.selectedDoodle?this.selectedDoodle.setParameterFromString(b,c):ED.errorHandler("ED.Drawing","setSelectedDoodle","Attempt to set a property on the selected doodle, when none selected")},ED.Drawing.prototype.deleteDoodleOfId=function(a){var b=this.doodleOfId(a);b?this.deleteDoodle(b,!1):ED.errorHandler("ED.Drawing","deleteDoodleOfId","Attempt to delete doodle with invalid id")},ED.Drawing.prototype.lock=function(){null!==this.selectedDoodle&&(this.selectedDoodle.isLocked=!0,this.notify("doodleLocked"),this.repaint())},ED.Drawing.prototype.unlock=function(){for(var a=0;a<this.doodleArray.length;a++)this.doodleArray[a].isLocked=!1;this.notify("doodleUnlocked"),this.repaint()},ED.Drawing.prototype.toggleHelp=function(){this.notify("toggleDoodleHelp")},ED.Drawing.prototype.deselectDoodles=function(){for(var a=0;a<this.doodleArray.length;a++)this.doodleArray[a].isSelected=!1;this.selectedDoodle&&(this.selectedDoodle.onDeselection(),this.selectedDoodle=null),this.notify("doodleDeselected"),this.repaint()},ED.Drawing.prototype.selectNextDoodle=function(a){this.scrollValue+=a;var b=a>0?!0:!1,c=96;if(this.scrollValue>c||this.scrollValue<-c){this.scrollValue=0;for(var d=-1,e=0;e<this.doodleArray.length;e++)this.doodleArray[e].isSelected&&(d=e,this.doodleArray[e].isSelected=!1);d>=0&&(b?(d++,d==this.doodleArray.length&&(d=0)):(d--,0>d&&(d=this.doodleArray.length-1)),d==this.doodleArray.length,this.doodleArray[d].isSelected=!0,this.selectedDoodle=this.doodleArray[d]),this.repaint()}},ED.Drawing.prototype.setDoodleAsSelected=function(a){for(var b=-1,c=0;c<this.doodleArray.length;c++)this.doodleArray[c].id==a&&(b=c);if(b>=0){var d=this.doodleArray[b];this.selectDoodle(d)}},ED.Drawing.prototype.selectDoodle=function(a){this.deselectDoodles(),a.isSelected=!0,this.selectedDoodle=a,this.lastSelectedDoodle&&this.lastSelectedDoodle.onDeselection(),this.notify("doodleSelected"),this.selectedDoodle.onSelection(),this.repaint()},ED.Drawing.prototype.isReady=function(){this.modified=!1,this.convertToImage&&this.replaceWithImage()},ED.Drawing.prototype.addDoodle=function(a,b,c){var d=this.hasDoodleOfClass(a);if(!ED.hasOwnProperty(a))return ED.errorHandler("ED.Drawing","addDoodle","Unable to find definition for subclass "+a),null;var e=new ED[a](this);if(e.isUnique&&this.hasDoodleOfClass(a))return ED.errorHandler("ED.Drawing","addDoodle","Attempt to add a second unique doodle of class "+a),null;for(var f=0;f<this.doodleArray.length;f++)this.doodleArray[f].isSelected&&this.doodleArray[f].onDeselection(),this.doodleArray[f].isSelected=!1;if("undefined"!=typeof b)for(var g in b){var h=e.validateParameter(g,b[g]);h.valid?e.setParameterFromString(g,h.value):ED.errorHandler("ED.Drawing","addDoodle","ParameterDefaults array contains an invalid value for parameter "+g)}if(this.selectedDoodle=e,e.isDrawable&&(e.isForDrawing=!0),this.doodleArray[this.doodleArray.length]=e,!d)for(var i in this.bindingArray[a]){var j,k=this.bindingArray[a][i].id,l=this.bindingArray[a][i].attribute,m=document.getElementById(k);switch(m.type){case"checkbox":l?ED.errorHandler("ED.Drawing","addDoodle","Binding to a checkbox with a non-standard attribute not yet supported"):j=m.checked.toString();break;case"select-one":l?m.selectedIndex>-1&&(j=m.options[m.selectedIndex].getAttribute(l)):j=m.value;break;default:j=l?m.getAttribute(l):m.value}j==this.boundElementDeleteValueArray[k]&&(j=e[i]);var n=e.validateParameter(i,j);n.valid?(e.setParameterFromString(i,n.value),e.updateDependentParameters(i)):(j=e[i],ED.errorHandler("ED.Drawing","addDoodle","Invalid value for parameter: "+i)),e.addBinding(i,this.bindingArray[a][i]),e.setParameterFromString(i,n.value),e.updateDependentParameters(i),this.updateBindings(e)}if("undefined"!=typeof c)for(var g in c)e.addBinding(g,c[g]);return e.addAtBack?this.moveToBack():this.repaint(),this.notify("doodleAdded",e),this.selectedDoodle.onSelection(),e},ED.Drawing.prototype.addBindings=function(a){this.bindingArray=a;var b=this;for(var c in a){var d=this.firstDoodleOfClass(c);for(var e in a[c]){var f=a[c][e].id,g=document.getElementById(f);g?(g.addEventListener("change",function(a){return function(){b.hasDoodleOfClass(a)||(b.addDoodle(a),b.deselectDoodles())}}(c),!1),d&&d.addBinding(e,a[c][e])):ED.errorHandler("ED.Drawing","addBindings","Attempt to add binding for an element that does not exist for parameter: "+e)}}},ED.Drawing.prototype.addDeleteValues=function(a){for(elementId in a)this.boundElementDeleteValueArray[elementId]=a[elementId]},ED.Drawing.prototype.eventHandler=function(a,b,c,d,e){switch(a){case"oninput":case"onchange":var f=this.doodleOfId(b);if(f)if(this.boundElementDeleteValueArray[d]==e)this.deleteDoodleOfId(b);else{f.drawing.isActive=!0;var g;for(var h in f.bindingArray)f.bindingArray[h].id==d&&(g=h);var i=f.validateParameter(g,e,"onchange"===a);if(i.valid){var j=!1;f.setParameterWithAnimation(g,i.value,j)}else ED.errorHandler("ED.Drawing","eventHandler","Attempt to change HTML element value to an invalid value for parameter "+g);if(e!=i.value){var k=document.getElementById(d),l=f.bindingArray[g].attribute;switch(k.type){case"checkbox":l?ED.errorHandler("ED.Drawing","eventHandler","Binding to a checkbox with a non-standard attribute not yet supported"):(console.log("setting checkbox - needs testing with a suitable doodle"),"true"==value?k.setAttribute("checked","checked"):k.removeAttribute("checked"));break;case"select-one":if(l){for(var m=0;m<k.length;m++)if(k.options[m].getAttribute(l)==i.value){k.value=k.options[m].value;break}}else k.value=i.value;break;case"text":l?ED.errorHandler("ED.Drawing","eventHandler","Binding to a textfield with a non-standard attribute not yet supported"):(console.log("setting textfield - needs testing with a suitable doodle"),k.value=i.value);break;default:l?k.setAttribute(l,i.value):k.value=i.value}}}else ED.errorHandler("ED.Drawing","eventHandler","Doodle of id: "+b+" no longer exists")}},ED.Drawing.prototype.updateBindings=function(a){var b=a;if("undefined"==typeof b&&(b=this.selectedDoodle),null!=b)for(var c in b.bindingArray){var d=document.getElementById(b.bindingArray[c].id),e=b.bindingArray[c].attribute,f=b.getParameter(c);switch(d.type){case"checkbox":e?ED.errorHandler("ED.Drawing","updateBindings","Binding to a checkbox with a non-standard attribute not yet supported"):"true"==f?d.setAttribute("checked","checked"):d.removeAttribute("checked");break;case"select-one":if(e){for(var g=0;g<d.length;g++)if(d.options[g].getAttribute(e)==f){d.value=d.options[g].value;break}}else d.value=f;break;case"text":e?ED.errorHandler("ED.Drawing","updateBindings","Binding to a textfield with a non-standard attribute not yet supported"):d.value=f;break;default:e?d.setAttribute(e,f):d.value=f}}},ED.Drawing.prototype.hasDoodleOfClass=function(a){for(var b=!1,c=0;c<this.doodleArray.length;c++)this.doodleArray[c].className==a&&(b=!0);return b},ED.Drawing.prototype.numberOfDoodlesOfClass=function(a){for(var b=0,c=0;c<this.doodleArray.length;c++)this.doodleArray[c].className==a&&b++;return b},ED.Drawing.prototype.firstDoodleOfClass=function(a){for(var b=!1,c=0;c<this.doodleArray.length;c++)if(this.doodleArray[c].className==a){b=this.doodleArray[c];break}return b},ED.Drawing.prototype.lastDoodleOfClass=function(a){for(var b=!1,c=this.doodleArray.length-1;c>=0;c--)if(this.doodleArray[c].className==a){b=this.doodleArray[c];break}return b},ED.Drawing.prototype.allDoodlesOfClass=function(a){for(var b=[],c=this.doodleArray.length-1;c>=0;c--)this.doodleArray[c].className==a&&b.push(this.doodleArray[c]);return b},ED.Drawing.prototype.setParameterValueForClass=function(a,b,c){for(var d=this.doodleArray.length-1;d>=0;d--)if(this.doodleArray[d].className==c){var e=this.doodleArray[d];e.setParameterWithAnimation(a,b)}this.repaint()},ED.Drawing.prototype.doodleOfId=function(a){for(var b=!1,c=0;c<this.doodleArray.length;c++)if(this.doodleArray[c].id==a){b=this.doodleArray[c];break}return b},ED.Drawing.prototype.deleteAllDoodles=function(a){for(var b=this.doodleArray.length-1;b>=0;b--)(a||this.doodleArray[b].isDeletable)&&this.deleteDoodle(this.doodleArray[b],a)},ED.Drawing.prototype.deleteDoodlesOfClass=function(a){for(var b=this.doodleArray.length-1;b>=0;b--)this.doodleArray[b].className==a&&this.deleteDoodle(this.doodleArray[b],!1)},ED.Drawing.prototype.setParameterForDoodle=function(a,b,c){"undefined"!=typeof a[b]?a[b]=+c:a.setParameterFromString(b,c),"undefined"!=typeof this.saveToInputElement&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.setParameterForDoodleOfClass=function(a,b,c){var d=this.firstDoodleOfClass(a);
d.setParameterWithAnimation(b,c),"undefined"!=typeof this.saveToInputElement&&this.saveToInputElement(),this.repaint()},ED.Drawing.prototype.totalDegreesExtent=function(a){for(var b=0,c=0;c<this.doodleArray.length;c++)this.doodleArray[c].className==a&&(b+=this.doodleArray[c].degreesExtent());return b>360&&(b=360),b},ED.Drawing.prototype.suppressReports=function(){for(var a=0;a<this.doodleArray.length;a++)this.doodleArray[a].willReport=!1},ED.Drawing.prototype.report=function(){for(var a="",b=new Array,c=new Array,d=0;d<this.doodleArray.length;d++){var e=this.doodleArray[d];if(e.willReport)if(e.groupDescription().length>0)"undefined"==typeof b[e.className]?(b[e.className]=e.groupDescription(),b[e.className]+=e.description()):e.description().length>0&&(b[e.className]+=", ",b[e.className]+=e.description()),e.groupDescriptionEnd().length>0&&"undefined"==typeof c[e.className]&&(c[e.className]=e.groupDescriptionEnd());else{var f=e.description();f.length>0&&(0==a.length?a+=f:a=a+", "+ED.firstLetterToLowerCase(f))}}for(className in b){var f=b[className],g="";"undefined"!=typeof c[className]&&(g=c[className]),f=ED.addAndAfterLastComma(f)+g,f.length>0&&(0==a.length?a+=f:a=a+", "+ED.firstLetterToLowerCase(f))}return a},ED.Drawing.prototype.diagnosis=function(){for(var a=0,b=new Array,c=0;c<this.doodleArray.length;c++){var d=this.doodleArray[c],e=d.snomedCode();if(e>0){var f=d.diagnosticHierarchy();f>a?(a=f,b.push(e)):f==a&&b.indexOf(e)<0&&b.push(e)}}return b},ED.Drawing.prototype.setEye=function(a){"Right"==a&&(this.eye=ED.eye.Right),"Left"==a&&(this.eye=ED.eye.Left),this.repaint()},ED.Drawing.prototype.clear=function(){this.canvas.width=this.canvas.width,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.canvas.width/2,this.canvas.height/2),this.context.scale(this.scale,this.scale)},ED.Drawing.prototype.repaint=function(){if(this.clear(),"undefined"!=typeof this.image)if(this.image.width>=this.image.height){var a=1e3*this.image.height/this.image.width;this.context.drawImage(this.image,-500,-a/2,1e3,a)}else{var b=1e3*this.image.width/this.image.height;this.context.drawImage(this.image,-b/2,-500,b,1e3)}this.drawAllDoodles();for(var c=0;c<this.doodleArray.length;c++)this.doodleArray[c].setDisplayOfParameterControls(!1);if(null!=this.selectedDoodle&&this.selectedDoodle.setDisplayOfParameterControls(!0),this.modified||(this.modified=!0),this.selectionRectangleIsBeingDragged){var d=this.context;d.beginPath(),d.moveTo(this.selectionRectangleStart.x,this.selectionRectangleStart.y),d.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleStart.y),d.lineTo(this.selectionRectangleEnd.x,this.selectionRectangleEnd.y),d.lineTo(this.selectionRectangleStart.x,this.selectionRectangleEnd.y),d.closePath(),d.lineWidth=1,d.strokeStyle="gray",d.stroke()}this.notify("drawingRepainted")},ED.Drawing.prototype.innerAngle=function(a,b,c){var d=new ED.Point(a.x-b.x,a.y-b.y),e=new ED.Point(c.x-b.x,c.y-b.y);return d.clockwiseAngleTo(e)},ED.Drawing.prototype.togglePointInLine=function(){this.newPointOnClick?(this.newPointOnClick=!1,this.completeLine=!0,this.deselectDoodles(),this.repaint()):(this.newPointOnClick=!0,this.completeLine=!1)},ED.Drawing.prototype.nextDoodleId=function(){return this.lastDoodleId++},ED.Drawing.prototype.getScaleLevel=function(){return this.globalScaleFactor},ED.Doodle=function(a,b){if("undefined"!=typeof a){this.drawing=a,this.id=this.drawing.nextDoodleId(),this.squiggleArray=new Array,this.transform=new ED.AffineTransform,this.inverseTransform=new ED.AffineTransform,this.createdTime=(new Date).getTime(),this.scaleLevel=1,this.isLocked=!1,this.isSelectable=!0,this.isShowHighlight=!0,this.willStaySelected=!0,this.isDeletable=!0,this.isSaveable=!0,this.isOrientated=!1,this.isScaleable=!0,this.isSqueezable=!1,this.isMoveable=!0,this.isRotatable=!0,this.isDrawable=!1,this.isUnique=!1,this.isArcSymmetrical=!1,this.addAtBack=!1,this.isPointInLine=!1,this.snapToGrid=!1,this.snapToQuadrant=!1,this.snapToPoints=!1,this.snapToAngles=!1,this.snapToArc=!1,this.willReport=!0,this.willSync=!0;var c=Math.round(this.drawing.doodlePlaneWidth/2),d=Math.round(this.drawing.doodlePlaneHeight/2);this.parameterValidationArray={originX:{kind:"simple",type:"int",range:new ED.Range(-c,+c),defaultValue:0,delta:15},originY:{kind:"simple",type:"int",range:new ED.Range(-d,+d),defaultValue:0,delta:15},width:{kind:"simple",type:"int",range:new ED.Range(100,+d),defaultValue:50,delta:15},height:{kind:"simple",type:"int",range:new ED.Range(100,+c),defaultValue:50,delta:15},radius:{kind:"simple",type:"float",range:new ED.Range(100,450),precision:6,defaultValue:100,delta:15},apexX:{kind:"simple",type:"int",defaultValue:0,range:new ED.Range(-500,500),delta:15},apexY:{kind:"simple",type:"int",range:new ED.Range(-500,500),defaultValue:0,delta:15},scaleX:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},scaleY:{kind:"simple",type:"float",range:new ED.Range(.5,4),precision:6,defaultValue:1,delta:.1},arc:{kind:"simple",type:"float",range:new ED.Range(Math.PI/12,2*Math.PI),precision:6,defaultValue:Math.PI,delta:.1},rotation:{kind:"simple",type:"float",range:new ED.Range(0,2*Math.PI),precision:6,defaultValue:0,delta:.2}},this.savedParameterArray||(this.savedParameterArray=[]),this.controlParameterArray||(this.controlParameterArray=[]),this.parameterObjectTypeArray||(this.parameterObjectTypeArray=[]),this.gridSpacing=200,this.gridDisplacementX=0,this.gridDisplacementY=0,this.isBeingDragged=!1,this.draggingHandleIndex=null,this.draggingHandleRing=null,this.isClicked=!1,this.drawFunctionMode=ED.drawFunctionMode.Draw,this.isFilled=!0,this.showsToolTip=!0,this.derivedParametersArray=new Array,this.animationFrameRate=30,this.animationDataArray=new Array,this.parentClass="",this.inFrontOfClassArray=new Array,this.pointsArray=new Array,this.anglesArray=new Array,this.arcArray=new Array,this.quadrantPoint=new ED.Point(200,200),this.bindingArray=new Array,this.drawing.listenerArray[this.id]=new Array,this.handleArray=new Array,this.handleArray[0]=new ED.Doodle.Handle(new ED.Point(-50,50),!1,ED.Mode.Scale,!1),this.handleArray[1]=new ED.Doodle.Handle(new ED.Point(-50,-50),!1,ED.Mode.Scale,!1),this.handleArray[2]=new ED.Doodle.Handle(new ED.Point(50,-50),!1,ED.Mode.Scale,!1),this.handleArray[3]=new ED.Doodle.Handle(new ED.Point(50,50),!1,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(new ED.Point(this.apexX,this.apexY),!1,ED.Mode.Apex,!1),this.setHandles(),this.leftExtremity=new ED.Point(-100,-100),this.rightExtremity=new ED.Point(0,-100),this.version=1.1,this.setPropertyDefaults();for(var e in this.parameterValidationArray){var f=this.parameterValidationArray[e];"simple"==f.kind&&(this[e]=f.defaultValue)}if("undefined"==typeof b)this.order=this.drawing.doodleArray.length,this.setParameterDefaults(),this.setScaleLevel(this.drawing.globalScaleFactor),this.isSelected=!0;else{for(var g in b)if("scaleLevel"!==g)if("arc"==g||"rotation"==g)this[g]=b[g]*Math.PI/180;else if("squiggleArray"==g)for(var h=b[g],i=0;i<h.length;i++){for(var j=h[i].colour,k=new ED.Colour(j.red,j.green,j.blue,j.alpha),l=h[i].thickness,m=h[i].filled,n=new ED.Squiggle(this,k,l,m),o=h[i].pointsArray,p=0;p<o.length;p++){var q=new ED.Point(o[p].x,o[p].y);n.addPoint(q)}n.complete=!0,this.squiggleArray.push(n)}else if("params"==g)for(var i=0;i<b[g].length;i++){var r=b[g][i].name,s=b[g][i].value;this.setParameterFromString(r,s)}else this[g]=g in this.parameterObjectTypeArray?this.parseObjectString(b[g],this.parameterObjectTypeArray[g]):b[g];this.isOrientated&&(this.rotation=this.orientation()),this.order=+b.order,this.setScaleLevel(this.drawing.globalScaleFactor);for(var g in this.savedParameterArray)this.updateDependentParameters(this.savedParameterArray[g]);this.isSelected=!1,this.isForDrawing=!1}}},ED.Doodle.prototype.parseObjectString=function(a,b){var c=!1;switch(b){case"date":var d=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(a);c=new Date(Date.UTC(+d[1],+d[2]-1,+d[3],+d[4],+d[5],+d[6]));break;default:ED.errorHandler("ED.Doodle","parseObjectString","Object type: "+b+" currently not supported")}return c},ED.Doodle.prototype.setHandles=function(){},ED.Doodle.prototype.setPropertyDefaults=function(){},ED.Doodle.prototype.setParameterDefaults=function(){},ED.Doodle.prototype.position=function(){},ED.Doodle.prototype.willDelete=function(){return!0},ED.Doodle.prototype.move=function(a,b){var c=Math.round(+a),d=Math.round(+b);if(this.isMoveable){var e=this.parameterValidationArray.originX.range.constrain(this.originX+c,this.scaleLevel),f=this.parameterValidationArray.originY.range.constrain(this.originY+d,this.scaleLevel);0!=c&&this.setSimpleParameter("originX",e),0!=d&&this.setSimpleParameter("originY",f),this.updateDependentParameters("originX"),this.updateDependentParameters("originY"),(0!=c||0!=d)&&this.isOrientated&&(this.setSimpleParameter("rotation",this.orientation()),this.updateDependentParameters("rotation")),this.drawing.notify("doodleMoved",{doodle:this})}},ED.Doodle.prototype.orientation=function(){var a=new ED.Point(0,0),b=new ED.Point(0,-100),c=new ED.Point(this.originX,this.originY);return this.drawing.innerAngle(b,a,c)},ED.Doodle.prototype.draw=function(a){this.drawFunctionMode="undefined"!=typeof a?ED.drawFunctionMode.HitTest:ED.drawFunctionMode.Draw;var b=this.drawing.context;b.translate(this.originX,this.originY),b.rotate(this.rotation),b.scale(this.scaleX,this.scaleY),this.transform.setToTransform(this.drawing.transform),this.transform.translate(this.originX,this.originY),this.transform.rotate(this.rotation),this.transform.scale(this.scaleX,this.scaleY),this.inverseTransform=this.transform.createInverse(),this.isClicked=!1},ED.Doodle.prototype.drawHandles=function(a){this.drawFunctionMode==ED.drawFunctionMode.HitTest&&(this.draggingHandleIndex=null,this.draggingHandleRing=null);var b=this.drawing.context;b.save(),b.setTransform(1,0,0,1,0,0),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="yellow";for(var c=2*Math.PI,d=0;d<this.handleArray.length;d++){var e=this.handleArray[d];e.isVisible&&(b.beginPath(),b.arc(e.location.x,e.location.y,ED.handleRadius/2,0,c,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&b.isPointInPath(a.x,a.y)&&(this.draggingHandleIndex=d,this.draggingHandleRing=ED.handleRing.Inner,this.drawing.mode=e.mode,this.isClicked=!0),this.isRotatable&&e.isRotatable&&(b.moveTo(e.location.x+ED.handleRadius,e.location.y),b.arc(e.location.x,e.location.y,ED.handleRadius,0,c,!0),this.drawFunctionMode==ED.drawFunctionMode.HitTest&&b.isPointInPath(a.x,a.y)&&(this.draggingHandleIndex=d,null==this.draggingHandleRing&&(this.draggingHandleRing=ED.handleRing.Outer,this.drawing.mode=ED.Mode.Rotate),this.isClicked=!0)),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.fill(),b.stroke()))}b.restore()},ED.Doodle.prototype.drawBoundary=function(a){var b=this.drawing.context;if(this.drawFunctionMode==ED.drawFunctionMode.HitTest){if(ED.isFirefox()){b.save(),b.setTransform(1,0,0,1,0,0);var c=b.isPointInPath(a.x,a.y);b.restore()}else var c=b.isPointInPath(a.x,a.y);c&&(this.drawing.mode=this.isDrawable&&this.isForDrawing?ED.Mode.Draw:ED.Mode.Move,this.isClicked=!0)}else this.isSelected&&this.isShowHighlight&&(b.shadowColor="gray",b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=20),this.isForDrawing&&(b.shadowColor="blue",b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=20),this.isFilled&&b.fill(),b.stroke(),b.shadowBlur=0,this.isSelected&&this.isShowHighlight&&this.drawHighlightExtras()},ED.Doodle.prototype.drawHighlightExtras=function(){},ED.Doodle.prototype.setDisplayOfParameterControls=function(a){for(var b in this.parameterValidationArray){var c=this.parameterValidationArray[b];if(c.display){var d=b+this.className+this.drawing.idSuffix,e=document.getElementById(d);if(e){var f=e.parentNode;f.style.display=a?"inline":"none",e.checked=this[b]}}}},ED.Doodle.prototype.groupDescription=function(){return""},ED.Doodle.prototype.description=function(){return""},ED.Doodle.prototype.groupDescriptionEnd=function(){return""},ED.Doodle.prototype.snomedCode=function(){return 0},ED.Doodle.prototype.diagnosticHierarchy=function(){return 0},ED.Doodle.prototype.dependentParameterValues=function(){return new Array},ED.Doodle.prototype.updateDependentParameters=function(a,b){var c=this.dependentParameterValues(a,this[a]);for(var d in c)this.setSimpleParameter(d,c[d]);(b||void 0===b)&&this.drawing.updateBindings(this)},ED.Doodle.prototype.validateParameter=function(a,b,c){c=void 0===c?!0:c;var d=this.parameterValidationArray[a],e="";if(d){var f=!1;switch(e=b.toString(),c&&(e=e.trim()),d.type){case"string":d.list.indexOf(e)>=0&&(f=!0);break;case"float":ED.isNumeric(e)&&(e=parseFloat(e),e=d.range.constrain(e),e=e.toFixed(d.precision),f=!0);break;case"int":ED.isNumeric(e)&&(e=parseInt(e),e=d.range.constrain(e),e=e.toFixed(0),f=!0);break;case"mod":ED.isNumeric(e)&&(e=parseInt(e),e=d.range.constrain(e),"top"==d.clock?e==d.range.min&&(e=d.range.max):"bottom"==d.clock&&e==d.range.max&&(e=d.range.min),e=e.toFixed(0),f=!0);break;case"bool":("true"==b||"false"==b)&&(e=b,f=!0);break;case"colourString":f=!0;break;case"freeText":f=!0,d.validate&&"function"==typeof d.validate?f=d.validate(b):void 0!==d.maxLength&&(f=b.length<=d.maxLength);break;default:ED.errorHandler("ED.Drawing","eventHandler","Illegal validation type")}}else ED.errorHandler("ED.Doodle","validateParameter","Unknown parameter name: "+a+" with value: "+b);f||(e=this.getParameter(a),ED.errorHandler("ED.Doodle","validateParameter","Validation failure for parameter: "+a+" with value: "+b)),this.showControlValidationMsg(a,f);var g=new Array;return g.valid=f,g.value=e,g},ED.Doodle.prototype.parameterControlElementId=function(a){return this.drawing.canvas.id+"_"+a+"_control"},ED.Doodle.prototype.onSelection=function(){this.drawing.showDoodleControls&&this.showDoodleControls()},ED.Doodle.prototype.onDeselection=function(){this.drawing.showDoodleControls&&this.removeDoodleControls()},ED.Doodle.prototype.getControlElements=function(){var a=[];for(var b in this.controlParameterArray)a.push(this.parameterElement(b));return a},ED.Doodle.prototype.addControlBindings=function(){for(var a in this.controlParameterArray)this.addBinding(a,{id:this.parameterControlElementId(a)})},ED.Doodle.prototype.showControlValidationMsg=function(a,b){if(a in this.controlParameterArray){var c=this.parameterControlElementId(a),d=document.querySelector("[for="+c+"]");if(d){var e=d.querySelector(".validation-msg");e&&(b?e&&e.parentNode.removeChild(e):(e||(e=document.createElement("span"),d.appendChild(e),e.classList.add("validation-msg")),e.textContent="*"))}}},ED.Doodle.prototype.showDoodleControls=function(a){if(!a){var b=this.drawing.canvas.id+"_controls",a=document.getElementById(b);if(!a)return ED.errorHandler("ED.Doodle","showDoodleControls","Unable to create doodle controls: element with id "+b+" does not exist")}this.getControlElements().forEach(function(b){a.appendChild(b)}),this.addControlBindings()},ED.Doodle.prototype.removeDoodleControls=function(a){if(!a){var b=this.drawing.canvas.id+"_controls",a=document.getElementById(b);if(!a)return ED.errorHandler("ED.Doodle","removeDoodleControls","Unable to remove doodle controls: element with id "+b+" does not exist")}for(var c in this.controlParameterArray)this.removeBinding(c);for(;a.hasChildNodes();)a.removeChild(a.lastChild)},ED.Doodle.prototype.parameterElement=function(a){var b;switch(this.parameterValidationArray[a].type){case"string":b=document.createElement("select"),b.setAttribute("id",this.parameterControlElementId(a));for(var c in this.parameterValidationArray[a].list){var d=document.createElement("option");d.innerText=this.parameterValidationArray[a].list[c],b.appendChild(d)}break;case"bool":b=document.createElement("input"),b.type="checkbox",b.setAttribute("id",this.parameterControlElementId(a));break;case"colourString":b=document.createElement("select"),b.setAttribute("id",this.parameterControlElementId(a));for(var c in this.parameterValidationArray[a].list){var d=document.createElement("option");d.innerText="FF0000FF"==this.parameterValidationArray[a].list[c]?"Red":"00FF00FF"==this.parameterValidationArray[a].list[c]?"Green":"Blue",d.value=this.parameterValidationArray[a].list[c],b.appendChild(d)}break;case"freeText":b=document.createElement("input"),b.type="text",b.setAttribute("id",this.parameterControlElementId(a));break;default:ED.errorHandler("ED.Doodle","parameterElement","Unexpected type: "+this.parameterValidationArray[a].type+" for parameter: "+a)}var e=document.createElement("label");e.innerText=this.controlParameterArray[a],e.setAttribute("for",this.parameterControlElementId(a));var f=document.createElement("div");return f.appendChild(e),f.appendChild(b),f},ED.Doodle.prototype.setParameterWithAnimation=function(a,b,c){if(this.parameterValidationArray[a].animate){var d=this.dependentParameterValues(a,b);for(var e in d){var f=this.parameterValidationArray[e].delta,g=d[e]-this[e];if("rotation"==e){var h=(Math.PI-Math.abs(g))*g<0?-1:1;g*=h,0>g&&(g+=2*Math.PI),g>3.141&&this.rotation<Math.PI&&(h=-h)}else var h=0>g?-1:1;f*=h;var i=Math.abs(Math.floor(g/f)),j={timer:null,delta:f,frames:i,frameCounter:0};this.animationDataArray[e]=j,i>0?this.increment(e,d[e],c):(this.setSimpleParameter(e,d[e]),this.updateDependentParameters(e,c),this.drawing.repaint())}}else this.setParameterFromString(a,b.toString(),c);this.drawing.notify("setParameterWithAnimationComplete")},ED.Doodle.prototype.setSimpleParameter=function(a,b){var c=new Object;c.doodle=this,c.parameter=a,c.value=b,c.oldValue=this[a],this[a]=b,this.drawing.notify("parameterChanged",c)},ED.Doodle.prototype.setParameterFromString=function(a,b,c){var d=typeof b;"string"!=d&&ED.errorHandler("ED.Doodle","setParameterFromString","_value parameter should be of type string, not "+d);var e=this.parameterValidationArray[a];if(e){switch(e.type){case"string":this[a]=b;break;case"float":this[a]=parseFloat(b);break;case"int":this[a]=parseInt(b);break;case"mod":this[a]=parseInt(b);break;case"bool":this[a]="true"==b;break;case"colourString":this[a]=b;break;case"freeText":this[a]=b;break;default:ED.errorHandler("ED.Doodle","setParameterFromString","Illegal validation type: "+e.type)}if(this.updateDependentParameters(a,c),"derived"==this.parameterValidationArray[a].kind){var f=this.dependentParameterValues(a,b);for(var g in f)this.updateDependentParameters(g,c)}var h=new Object;h.doodle=this,h.parameter=a,h.value=b,h.oldValue=this[a],this.drawing.notify("parameterChanged",h)}else ED.errorHandler("ED.Doodle","setParameterFromString","No item in parameterValidationArray corresponding to parameter: "+a);this.drawing.repaint()},ED.Doodle.prototype.setOriginWithDisplacements=function(a,b){if(this.originX=this.drawing.eye==ED.eye.Right?-a:a,this.originY=-a,this.addAtBack)var c=this.drawing.firstDoodleOfClass(this.className);else var c=this.drawing.lastDoodleOfClass(this.className);if(c){var d=c.originX-b,e=c.originY-b;this.originX=this.parameterValidationArray.originX.range.constrain(d),this.originY=this.parameterValidationArray.originY.range.constrain(e)}},ED.Doodle.prototype.setOriginWithRotations=function(a,b,c){var d=this.drawing.eye==ED.eye.Right?-1:1,e=new ED.Point(0,0);if(e.setWithPolars(a,d*b*Math.PI/180),this.addAtBack)var f=this.drawing.firstDoodleOfClass(this.className);else var f=this.drawing.lastDoodleOfClass(this.className);if(f){var g=new ED.Point(f.originX,f.originY);e.setWithPolars(a,g.direction()+d*c*Math.PI/180)}this.originX=e.x,this.originY=e.y},ED.Doodle.prototype.setRotationWithDisplacements=function(a,b){var c,d=this.drawing.eye==ED.eye.Right?-1:1;if(this.addAtBack)var e=this.drawing.firstDoodleOfClass(this.className);else var e=this.drawing.lastDoodleOfClass(this.className);c=e?(180*e.rotation/Math.PI+d*b+360)%360*Math.PI/180:(d*a+360)%360*Math.PI/180,this.rotation=this.parameterValidationArray.rotation.range.constrain(c)},ED.Doodle.prototype.deselect=function(){this.isSelected=!1,this.drawing.selectedDoodle=null,this.drawing.repaint()},ED.Doodle.prototype.getParameter=function(a){var b=this.parameterValidationArray[a],c="";if(b)switch(b.type){case"string":c=this[a];break;case"float":c=this[a].toFixed(b.precision);break;case"int":c=this[a].toFixed(0);break;case"mod":c=Math.round(this[a]),"top"==b.clock?c==b.range.min&&(c=b.range.max):"bottom"==b.clock&&c==b.range.max&&(c=b.range.min),c=c.toFixed(0);break;case"bool":c=this[a].toString();break;case"colourString":c=this[a];break;case"freeText":c=this[a];break;default:ED.errorHandler("ED.Doodle","getParameter","Illegal validation type")}else ED.errorHandler("ED.Doodle","getParameter","No entry in parameterValidationArray corresponding to parameter: "+a);return c},ED.Doodle.prototype.increment=function(a,b,c){var d=this[a];this.animationDataArray[a].frameCounter++;var e=1e3/this.animationFrameRate;if(this.animationDataArray[a].frameCounter==this.animationDataArray[a].frames)this.setSimpleParameter(a,b),this.updateDependentParameters(a,c),clearTimeout(this.animationDataArray[a].timer);else{this.setSimpleParameter(a,d+this.animationDataArray[a].delta),this.updateDependentParameters(a,c);var f=this;this.animationDataArray[a].timer=setTimeout(function(){f.increment(a,b,c)},e)}this.drawing.repaint()},ED.Doodle.prototype.addBinding=function(a,b){var c=b.id,d=b.attribute;if("undefined"!=typeof this[a]){var e=document.getElementById(c);if(null!=e){this.bindingArray[a]={id:c,attribute:d};var f,g=this.drawing,h=this.id,i=this.className;switch(e.type){case"checkbox":d?ED.errorHandler("ED.Doodle","addBinding","Binding to a checkbox with a non-standard attribute not yet supported"):(this.savedParameterArray.indexOf(a)<0?this.setParameterFromString(a,e.checked.toString()):this.drawing.updateBindings(this),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.checked.toString())},!1));break;case"select-one":d?(e.selectedIndex>-1&&this.savedParameterArray.indexOf(a)<0&&this.setParameterFromString(a,e.options[e.selectedIndex].getAttribute(d)),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.options[this.selectedIndex].getAttribute(d))},!1)):(this.savedParameterArray.indexOf(a)<0?this.setParameterFromString(a,e.value):this.drawing.updateBindings(this),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.value)},!1));break;case"text":d?ED.errorHandler("ED.Doodle","addBinding","Binding to a text field with a non-standard attribute not yet supported"):(this.savedParameterArray.indexOf(a)<0?this.setParameterFromString(a,e.value):this.drawing.updateBindings(this),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.value)},!1));break;default:d?(this.setParameterFromString(a,e.getAttribute(d)),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.getAttribute(d))},!1)):(this.setParameterFromString(a,e.value),e.addEventListener("change",f=function(){g.eventHandler("onchange",h,i,this.id,this.value)},!1))}this.drawing.listenerArray[this.id][a]=f}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. DOM has no element with id: "+c)}else ED.errorHandler("ED.Doodle","addBinding","Failed to add binding. Doodle of class: "+this.className+" has no parameter of name: "+a)},ED.Doodle.prototype.removeBinding=function(a){var b;for(var c in this.bindingArray)c==a&&(b=this.bindingArray[a].id);delete this.bindingArray[a];var d=document.getElementById(b);d&&d.removeEventListener("change",this.drawing.listenerArray[this.id][a],!1),delete this.drawing.listenerArray[this.id][a]},ED.Doodle.prototype.clockHour=function(a){var b,c;if(c="undefined"!=typeof a?a:0,this.isRotatable&&!this.isMoveable)b=(6*this.rotation/Math.PI+12+c)%12;else var d=new ED.Point(0,-100),e=new ED.Point(this.originX,this.originY),b=(6*d.clockwiseAngleTo(e)/Math.PI+12+c)%12;return b=b.toFixed(0),0==b&&(b=12),b},ED.Doodle.prototype.quadrant=function(){var a="";return a+=this.originY<0?"supero":"infero",a+=this.drawing.eye==ED.eye.Right?this.originX<0?"temporal":"nasal":this.originX<0?"nasal":"temporal",a+=" quadrant"},ED.Doodle.prototype.degrees=function(){var a;if(this.isRotatable&&!this.isMoveable)a=(180*this.rotation/Math.PI+360)%360;else{var b=new ED.Point(0,-100),c=new ED.Point(this.originX,this.originY);a=(180*b.clockwiseAngleTo(c)/Math.PI+360)%360}return a=a.toFixed(0),0==a&&(a=0),a},ED.Doodle.prototype.clockHourExtent=function(){var a,b;if(this.isRotatable&&!this.isMoveable)a=(6*(this.rotation-this.arc/2)/Math.PI+12)%12,b=(6*(this.rotation+this.arc/2)/Math.PI+12)%12;else{var c=new ED.Point(0,-100),d=new ED.Point(this.originX,this.originY);(6*c.clockwiseAngleTo(d)/Math.PI+12)%12}return a=a.toFixed(0),0==a&&(a=12),b=b.toFixed(0),0==b&&(b=12),"from "+a+" to "+b},ED.Doodle.prototype.degreesExtent=function(){var a=180*this.arc/Math.PI,b=Math.round(a);return b},ED.Doodle.prototype.locationRelativeToDisc=function(){var a="";return this.drawing.eye==ED.eye.Right?this.originX>180&&this.originX<420&&this.originY>-120&&this.originY<120?a="at the disc":(a+=this.originY<=0?"supero":"infero",a+=this.originX<=300?"temporally":"nasally"):this.originX<-180&&this.originX>-420&&this.originY>-120&&this.originY<120?a="at the disc":(a+=this.originY<=0?"supero":"infero",a+=this.originX>=-300?"temporally":"nasally"),a},ED.Doodle.prototype.locationRelativeToFovea=function(){var a="";return this.drawing.eye==ED.eye.Right?this.originX>-10&&this.originX<10&&this.originY>-10&&this.originY<10?a="at the fovea":(a+=this.originY<=0?"supero":"infero",a+=this.originX<=0?"temporal":"nasal",a+=" to the fovea"):this.originX>-10&&this.originX<10&&this.originY>-10&&this.originY<10?a="at the fovea":(a+=this.originY<=0?"supero":"infero",a+=this.originX>=0?"temporally":"nasally",a+=" to the fovea"),a},ED.Doodle.prototype.addSquiggle=function(){var a=new ED.Colour(0,0,0,1);a.setWithHexString(this.colourString);var b;switch(this.thickness){case"Thin":b=ED.squiggleWidth.Thin;break;case"Medium":b=ED.squiggleWidth.Medium;break;case"Thick":b=ED.squiggleWidth.Thick;break;default:b=ED.squiggleWidth.Thin}var c=new ED.Squiggle(this,a,b,this.filled);this.squiggleArray.push(c)},ED.Doodle.prototype.addPointToSquiggle=function(a){if(this.squiggleArray.length>0){var b=this.squiggleArray.length-1,c=this.squiggleArray[b];c.addPoint(a)}},ED.Doodle.prototype.completeSquiggle=function(){if(this.squiggleArray.length>0){var a=this.squiggleArray.length-1,b=this.squiggleArray[a];b.complete=!0}},ED.Doodle.prototype.calculateArc=function(){var a=new ED.Point(this.leftExtremity.x-this.drawing.canvas.width/2,this.leftExtremity.y-this.drawing.canvas.height/2),b=new ED.Point(this.rightExtremity.x-this.drawing.canvas.width/2,this.rightExtremity.y-this.drawing.canvas.height/2);return a.clockwiseAngleTo(b)},ED.Doodle.prototype.nearestPointTo=function(a){if(this.pointsArray.length>0){for(var b=1e7,c=0,d=0;d<this.pointsArray.length;d++){var e=this.pointsArray[d],f=(a.x-e.x)*(a.x-e.x)+(a.y-e.y)*(a.y-e.y);b>f&&(b=f,c=d)}return this.pointsArray[c]}return ED.errorHandler("ED.Doodle","nearestPointTo","Attempt to calculate nearest points with an empty points array"),a},ED.Doodle.prototype.nearestAngleTo=function(a){if(this.anglesArray.length>0){for(var b=2*Math.PI,c=0,d=0;d<this.anglesArray.length;d++){var e=this.anglesArray[d],f=Math.abs(e-a);b>f&&(b=f,c=d)}return this.anglesArray[c]}return ED.errorHandler("ED.Doodle","nearestAngleTo","Attempt to calculate nearest angle with an empty angles array"),a},ED.Doodle.prototype.nearestArcTo=function(a){if(this.arcArray.length>0){for(var b=2*Math.PI,c=0,d=0;d<this.arcArray.length;d++){var e=this.arcArray[d],f=Math.abs(e-a);b>f&&(b=f,c=d)}return this.arcArray[c]}return ED.errorHandler("ED.Doodle","nearestArcTo","Attempt to calculate nearest arc with an empty arc array"),a},ED.Doodle.prototype.json=function(){var a="{";if(a=a+'"scaleLevel": '+this.scaleLevel+",",a=a+'"version":'+this.version.toFixed(1)+",",a=a+'"subclass":"'+this.className+'",',"undefined"!=typeof this.savedParameterArray&&this.savedParameterArray.length>0)for(var b=0;b<this.savedParameterArray.length;b++){var c=this.savedParameterArray[b],d=this[c];switch(c){case"scaleX":case"scaleY":case"originX":case"originY":case"lastOriginX":case"lastOriginY":d*=1/this.scaleLevel}"scaleX"==c||"scaleY"==c?d=d.toFixed(2):"arc"==c||"rotation"==c?d=(180*d/Math.PI).toFixed(0):"originX"==c||"originY"==c||"radius"==c||"apexX"==c||"apexY"==c||"width"==c||"height"==c?d=d.toFixed(0):"number"==typeof d?d=d.toFixed(2):"string"==typeof d?d='"'+d+'"':"boolean"==typeof d?d=d:"object"==typeof d?d=JSON.stringify(d):(ED.errorHandler("ED.Doodle","json","Attempt to create json for an unhandled parameter type: "+typeof d),d="ERROR"),a=a+'"'+c+'":'+d+","}if(this.squiggleArray.length>0){a+='"squiggleArray":[';for(var e=0;e<this.squiggleArray.length;e++)a+=this.squiggleArray[e].json(),this.squiggleArray.length-e>1&&(a+=",");a+="],"}return a=a+'"order":'+this.order.toFixed(0),a+="}"},ED.Doodle.prototype.drawSpot=function(a,b,c,d,e){a.save(),a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.fillStyle=e,a.strokeStyle=e,a.lineWidth=0,a.fill(),a.stroke(),a.restore()},ED.Doodle.prototype.drawCircle=function(a,b,c,d,e,f,g){a.save(),a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.fillStyle=e,a.fill(),a.lineWidth=f,a.strokeStyle=g,a.stroke(),a.restore()},ED.Doodle.prototype.drawLine=function(a,b,c,d,e,f,g){a.save(),a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.lineWidth=f,a.strokeStyle=g,a.stroke(),a.restore()},ED.Doodle.prototype.drawLaserSpot=function(a,b,c){this.drawCircle(a,b,c,15,"Yellow",10,"rgba(255, 128, 0, 1)")},ED.Doodle.prototype.drawNFLHaem=function(a,b,c){var d=10,e=new ED.Point(b,c),f=e.direction()+Math.PI/2,g=e.direction()+3*Math.PI/2,h=new ED.Point(0,0);h.setWithPolars(d,f);var i=new ED.Point(0,0);i.setWithPolars(d,g),a.beginPath(),a.moveTo(b+h.x,c+h.y),a.lineTo(b+i.x,c+i.y),a.lineWidth=16,a.lineCap="round",a.strokeStyle="rgba(255,0,0,0.5)",a.stroke()},ED.Doodle.prototype.addEllipseToPath=function(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f;a.moveTo(-d/2,0),a.bezierCurveTo(b-d/2,c-h,b-g,c-e/2,b,c-e/2),a.bezierCurveTo(b+g,c-e/2,b+d/2,c-h,b+d/2,c),a.bezierCurveTo(b+d/2,c+h,b+g,c+e/2,b,c+e/2),a.bezierCurveTo(b-g,c+e/2,b-d/2,c+h,b-d/2,c)},ED.Doodle.prototype.xForY=function(a,b){return Math.sqrt(a*a-b*b)},ED.Doodle.prototype.setScaleLevel=function(a){var b=a/this.scaleLevel;this.adjustScaleAndPosition(b),this.scaleLevel=a},ED.Doodle.prototype.adjustScaleAndPosition=function(a){this.scaleX*=a,this.scaleY*=a,this.originX*=a,this.originY*=a,this.lastOriginX&&(this.lastOriginX*=a),this.lastOriginY&&(this.lastOriginY*=a)},ED.Doodle.prototype.debug=function(){console.log("org: "+this.originX+" : "+this.originY),console.log("apx: "+this.apexX+" : "+this.apexY),console.log("rot: "+180*this.rotation/Math.PI),console.log("arc: "+180*this.arc/Math.PI)},ED.Doodle.Handle=function(a,b,c,d){this.location=null==a?new ED.Point(0,0):a,this.isVisible=b,this.mode=c,this.isRotatable=d},ED.Report=function(a){this.drawing=a,this.breaksInAttached=0,this.breaksInDetached=0,this.largestBreakType="Not found",this.largestBreakSize=0,this.lowestBreakPosition=12,this.pvrType="None",this.pvrCClockHours=0,this.antPvrClockHours=0;var b=0,c=0,d=180,e=new Array;e.UTear="U tear",e.RoundHole="Round hole",e.Dialysis="Dialysis",e.GRT="GRT",e.MacularHole="Macular hole",e.OuterLeafBreak="Outer Leaf Break",this.rrdArray=new Array;var f,g;for(f=0;f<this.drawing.doodleArray.length;f++)g=this.drawing.doodleArray[f],"RRD"==g.className&&this.rrdArray.push(g);for(f=0;f<this.drawing.doodleArray.length;f++)if(g=this.drawing.doodleArray[f],"StarFold"==g.className)this.pvrType="C",b+=180*g.arc/Math.PI;else if("AntPVR"==g.className)this.pvrType="C",c+=180*g.arc/Math.PI;else if(g.className in e){var h=0;h="UTear"==g.className||"RoundHole"==g.className||"OuterLeafBreak"==g.className?(Math.round(180*Math.atan2(g.originX,-g.originY)/Math.PI)+360)%360:Math.round(180*g.rotation/Math.PI+360)%360;
var i=this.inDetachment(h);i?this.breaksInDetached++:this.breaksInAttached++,i&&g.arc>this.largestBreakSize&&(this.largestBreakSize=g.arc,this.largestBreakType=e[g.className]);var j=Math.abs(h-180);if(i&&d>j){d=j;var k=h+15;l=k%30,this.lowestBreakPosition=Math.floor((k-l)/30),0==this.lowestBreakPosition&&(this.lowestBreakPosition=12)}}b+=25;var l=b%30;this.pvrCClockHours=Math.floor((b-l)/30),c+=25,l=c%30,this.antPvrClockHours=Math.floor((c-l)/30);var m=180*this.largestBreakSize/Math.PI+25,l=m%30;this.largestBreakSize=Math.floor((m-l)/30)},ED.Report.prototype.inDetachment=function(a){var b=!1;for(key in this.rrdArray){var c=this.rrdArray[key],d=180*(c.rotation-c.arc/2)/Math.PI,e=180*(c.rotation+c.arc/2)/Math.PI,d=(d+360)%360,e=(e+360)%360;if(d>e)(a>=0&&e>=a||a>=d&&360>=a)&&(b=!0);else{if(e==d)return!0;a>=d&&e>=a&&(b=!0)}}return b},ED.Report.prototype.extent=function(){var a=new Array;this.drawing.eye==ED.eye.Right?(a.SN=0,a.IN=0,a.IT=0,a.ST=0):(a.ST=0,a.IT=0,a.IN=0,a.SN=0);var b=15;for(quadrant in a)for(var c=0;3>c;c++){var d=this.inDetachment(b)?1:0;a[quadrant]=a[quadrant]+d,b+=30}return a},ED.Report.prototype.isMacOff=function(){var a=!1;for(key in this.rrdArray){var b=this.rrdArray[key];b.isMacOff()&&(a=!0)}return a},ED.AffineTransform=function(){this.components=[[1,0,0],[0,1,0],[0,0,1]]},ED.AffineTransform.prototype.setToIdentity=function(){this.components[0][0]=1,this.components[0][1]=0,this.components[0][2]=0,this.components[1][0]=0,this.components[1][1]=1,this.components[1][2]=0,this.components[2][0]=0,this.components[2][1]=0,this.components[2][2]=1},ED.AffineTransform.prototype.setToTransform=function(a){this.components[0][0]=a.components[0][0],this.components[0][1]=a.components[0][1],this.components[0][2]=a.components[0][2],this.components[1][0]=a.components[1][0],this.components[1][1]=a.components[1][1],this.components[1][2]=a.components[1][2],this.components[2][0]=a.components[2][0],this.components[2][1]=a.components[2][1],this.components[2][2]=a.components[2][2]},ED.AffineTransform.prototype.translate=function(a,b){this.components[0][2]=this.components[0][0]*a+this.components[0][1]*b+this.components[0][2],this.components[1][2]=this.components[1][0]*a+this.components[1][1]*b+this.components[1][2],this.components[2][2]=this.components[2][0]*a+this.components[2][1]*b+this.components[2][2]},ED.AffineTransform.prototype.scale=function(a,b){this.components[0][0]=this.components[0][0]*a,this.components[0][1]=this.components[0][1]*b,this.components[1][0]=this.components[1][0]*a,this.components[1][1]=this.components[1][1]*b,this.components[2][0]=this.components[2][0]*a,this.components[2][1]=this.components[2][1]*b},ED.AffineTransform.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=[[0,0,0],[0,0,0],[0,0,0]];d[0][0]=this.components[0][0]*b+this.components[0][1]*c,d[0][1]=this.components[0][1]*b-this.components[0][0]*c,d[1][0]=this.components[1][0]*b+this.components[1][1]*c,d[1][1]=this.components[1][1]*b-this.components[1][0]*c,d[2][0]=this.components[2][0]*b+this.components[2][1]*c,d[2][1]=this.components[2][1]*b-this.components[2][0]*c,this.components[0][0]=d[0][0],this.components[0][1]=d[0][1],this.components[1][0]=d[1][0],this.components[1][1]=d[1][1],this.components[2][0]=d[2][0],this.components[2][1]=d[2][1]},ED.AffineTransform.prototype.transformPoint=function(a){var b=a.x*this.components[0][0]+a.y*this.components[0][1]+1*this.components[0][2],c=a.x*this.components[1][0]+a.y*this.components[1][1]+1*this.components[1][2];return new ED.Point(b,c)},ED.AffineTransform.prototype.determinant=function(){return this.components[0][0]*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1])-this.components[0][1]*(this.components[1][0]*this.components[2][2]-this.components[1][2]*this.components[2][0])+this.components[0][2]*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0])},ED.AffineTransform.prototype.createInverse=function(){var a=new ED.AffineTransform,b=this.determinant(),c=1/b;return a.components[0][0]=c*(this.components[1][1]*this.components[2][2]-this.components[1][2]*this.components[2][1]),a.components[0][1]=c*(this.components[0][2]*this.components[2][1]-this.components[0][1]*this.components[2][2]),a.components[0][2]=c*(this.components[0][1]*this.components[1][2]-this.components[0][2]*this.components[1][1]),a.components[1][0]=c*(this.components[1][2]*this.components[2][0]-this.components[1][0]*this.components[2][2]),a.components[1][1]=c*(this.components[0][0]*this.components[2][2]-this.components[0][2]*this.components[2][0]),a.components[1][2]=c*(this.components[0][2]*this.components[1][0]-this.components[0][0]*this.components[1][2]),a.components[2][0]=c*(this.components[1][0]*this.components[2][1]-this.components[1][1]*this.components[2][0]),a.components[2][1]=c*(this.components[0][1]*this.components[2][0]-this.components[0][0]*this.components[2][1]),a.components[2][2]=c*(this.components[0][0]*this.components[1][1]-this.components[0][1]*this.components[1][0]),a},ED.Colour=function(a,b,c,d){this.red=a,this.green=b,this.blue=c,this.alpha=d},ED.Colour.prototype.setWithHexString=function(a){this.red=parseInt(a.charAt(0)+a.charAt(1),16),this.green=parseInt(a.charAt(2)+a.charAt(3),16),this.blue=parseInt(a.charAt(4)+a.charAt(5),16),a.length>6&&(this.alpha=parseInt(a.charAt(6)+a.charAt(7),16))},ED.Colour.prototype.hexString=function(){return this.red>0?"FF0000FF":"00FF00FF"},ED.Colour.prototype.rgba=function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},ED.Colour.prototype.json=function(){return'{"red":'+this.red+',"green":'+this.green+',"blue":'+this.blue+',"alpha":'+this.alpha+"}"},ED.Point=function(a,b){this.x=Math.round(+a),this.y=Math.round(+b),this.components=[this.x,this.y,1]},ED.Point.prototype.setWithPolars=function(a,b){this.x=Math.round(a*Math.sin(b)),this.y=Math.round(-a*Math.cos(b))},ED.Point.prototype.setCoordinates=function(a,b){this.x=a,this.y=b},ED.Point.prototype.distanceTo=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},ED.Point.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y},ED.Point.prototype.crossProduct=function(a){return this.x*a.y-this.y*a.x},ED.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},ED.Point.prototype.direction=function(){var a=new ED.Point(0,-100);return a.clockwiseAngleTo(this)},ED.Point.prototype.clockwiseAngleTo=function(a){var b=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return this.crossProduct(a)<0?2*Math.PI-b:b},ED.Point.prototype.pointAtRadiusAndClockwiseAngle=function(a,b){var c=this.direction(),d=new ED.Point(0,0);return d.setWithPolars(a,c+b),d},ED.Point.prototype.pointAtAngleToLineToPointAtProportion=function(a,b,c){var d=new ED.Point((b.x-this.x)*c,(b.y-this.y)*c);r=d.length();var e=d.pointAtRadiusAndClockwiseAngle(r,a);return e.x+=this.x,e.y+=this.y,e},ED.Point.prototype.clockHour=function(){var a=new ED.Point(0,-100),b=(6*a.clockwiseAngleTo(this)/Math.PI+12)%12;return b=b.toFixed(0),0==b&&(b=12),b},ED.Point.prototype.tangentialControlPoint=function(a){var b=this.length(),c=this.direction(),d=b/Math.cos(a),e=new ED.Point(0,0);return e.setWithPolars(d,c+a),e},ED.Point.prototype.pointAtPercentageFromPointToPoint=function(a,b){var c=(b.x-this.x)*a/100,d=(b.y-this.y)*a/100,e=new ED.Point(this.x+c,this.y+d);return e},ED.Point.prototype.bezierPointAtParameter=function(a,b,c,d){var e=a*a,f=e*a,g=1-a,h=g*g,i=h*g,j=this.x*i+3*b.x*h*a+3*c.x*g*e+d.x*f,k=this.y*i+3*b.y*h*a+3*c.y*g*e+d.y*f;return new ED.Point(j,k)},ED.Point.prototype.json=function(){return'{"x":'+this.x.toFixed(2)+',"y":'+this.y.toFixed(2)+"}"},ED.Range=function(a,b){this.min=a,this.max=b},ED.Range.prototype.setMinAndMax=function(a,b){this.min=a,this.max=b},ED.Range.prototype.isBelow=function(a){return a<this.min?!0:!1},ED.Range.prototype.isAbove=function(a){return a>this.max?!0:!1},ED.Range.prototype.includes=function(a){return a<this.min||a>this.max?!1:!0},ED.Range.prototype.constrain=function(a,b){b=void 0===b?1:b;var c=this.min*b,d=this.max*b;return c>a?c:a>d?d:a},ED.Range.prototype.includesInAngularRange=function(a,b){var c=100,d=new ED.Point(0,0),e=new ED.Point(0,0),f=new ED.Point(0,0);return b?(d.setWithPolars(c,this.min*Math.PI/180),e.setWithPolars(c,this.max*Math.PI/180),f.setWithPolars(c,a*Math.PI/180)):(d.setWithPolars(c,this.min),e.setWithPolars(c,this.max),f.setWithPolars(c,a)),d.clockwiseAngleTo(f)<=d.clockwiseAngleTo(e)},ED.Range.prototype.constrainToAngularRange=function(a,b){if(this.max-this.min<(b?360:2*Math.PI)){var c=100,d=new ED.Point(0,0),e=new ED.Point(0,0),f=new ED.Point(0,0);return b?(d.setWithPolars(c,this.min*Math.PI/180),e.setWithPolars(c,this.max*Math.PI/180),f.setWithPolars(c,a*Math.PI/180)):(d.setWithPolars(c,this.min),e.setWithPolars(c,this.max),f.setWithPolars(c,a)),d.clockwiseAngleTo(f)<=d.clockwiseAngleTo(e)?a:f.clockwiseAngleTo(d)<e.clockwiseAngleTo(f)?this.min:this.max}return a},ED.Squiggle=function(a,b,c,d){this.doodle=a,this.colour=b,this.thickness=c,this.filled=d,this.pointsArray=new Array,this.complete=!1},ED.Squiggle.prototype.addPoint=function(a){this.pointsArray.push(a)},ED.Squiggle.prototype.json=function(){var a="{";a=a+'"colour":'+this.colour.json()+",",a=a+'"thickness": '+this.thickness+",",a=a+'"filled": "'+this.filled+'",',a+='"pointsArray":[';for(var b=0;b<this.pointsArray.length;b++)a+=this.pointsArray[b].json(),this.pointsArray.length-b>1&&(a+=",");return a+="]",a+="}"},null==ED||"object"!=typeof ED)var ED=new Object;if(ED.Categories=new Object,ED.Categories.EntrySiteBreak={complication:"Entry site break"},ED.Categories.RetinalTouch={complication:"Retinal touch"},ED.Categories.IatrogenicBreak={complication:"Iatrogenic break"},ED.Categories.SubretinalPFCL={complication:"Subretinal PFCL"},ED.FamilyMember=function(a,b){this.className="FamilyMember",this.node=null,this.dimension=32,this.gender="Male",this.drawStub=!1,this.affected=!1,this.deceased=!1,this.isProband=!1,this.condition="",this.savedParameterArray=["gender","affected","deceased","condition"],this.controlParameterArray={gender:"Gender",affected:"Affected",deceased:"Deceased",condition:"Text"},ED.Doodle.call(this,a,b)},ED.FamilyMember.prototype=new ED.Doodle,ED.FamilyMember.prototype.constructor=ED.FamilyMember,ED.FamilyMember.superclass=ED.Doodle.prototype,ED.FamilyMember.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.dimension={kind:"derived",type:"int",range:new ED.Range(0,1e3),animate:!0},this.parameterValidationArray.gender={kind:"derived",type:"string",list:["Male","Female","Unknown"],animate:!0},this.parameterValidationArray.drawStub={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.affected={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.deceased={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.isProband={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.condition={kind:"derived",type:"freeText",animate:!0}},ED.FamilyMember.prototype.setParameterDefaults=function(){},ED.FamilyMember.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"gender":this.node&&(this.node.member.gender=b.charAt(0)),updateMemberSet(this.node.member.name,"gender",this.node.member.gender);break;case"affected":this.node&&(this.node.member.affected="true"==b?!0:!1),updateMemberSet(this.node.member.name,"affected",this.node.member.affected);break;case"deceased":this.node&&(this.node.member.deceased="true"==b?!0:!1),updateMemberSet(this.node.member.name,"deceased",this.node.member.deceased)}return c},ED.FamilyMember.prototype.draw=function(a){var b=this.drawing.context;switch(ED.FamilyMember.superclass.draw.call(this,a),b.beginPath(),this.gender){case"Male":b.rect(-this.dimension,-this.dimension,2*this.dimension,2*this.dimension);break;case"Female":b.arc(0,0,this.dimension,0,2*Math.PI,!0);break;case"Unknown":b.moveTo(0,-this.dimension),b.lineTo(-this.dimension,0),b.lineTo(0,this.dimension),b.lineTo(this.dimension,0),b.lineTo(0,-this.dimension)}if(b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",b.fillStyle=this.affected?"rgba(150,150,150,0.75)":"rgba(255,255,255,0.75)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawStub&&(b.beginPath(),b.moveTo(0,-this.dimension),b.lineTo(0,2*-this.dimension),b.stroke()),this.deceased){var c=1.2*this.dimension;b.beginPath(),b.moveTo(-c,c),b.lineTo(c,-c),b.stroke()}if(this.isProband){var c=1.3*this.dimension,d=5;b.beginPath(),b.moveTo(-d,c),b.lineTo(d,c),b.lineTo(0,c-d),b.closePath(),b.fillStyle="rgba(150,150,150,0.75)",b.fill(),b.stroke()}b.font="24px sans-serif",b.fillStyle="rgba(100,100,100,0.75)";var e=b.measureText(this.condition).width+20;b.fillText(this.condition,-e/2+10,64)}return this.isClicked},ED.FamilyMember.prototype.setNode=function(a){this.node=a,this.node.type==PD.NodeType.Female&&(this.gender="Female"),this.node.type==PD.NodeType.Male&&(this.gender="Male"),this.node.type==PD.NodeType.Unknown&&(this.gender="Unknown"),this.isProband=this.node.member.isProband,this.affected=this.node.member.affected,this.deceased=this.node.member.deceased,this.condition=this.node.member.condition},ED.Freehand=function(a,b){this.className="Freehand",this.labelWidth=0,this.labelHeight=80,this.labelFont="60px sans-serif",this.colourString="00FF00FF",this.filled=!0,this.thickness="Thin",this.labelText="",this.savedParameterArray=["originX","originY","colourString","filled","thickness","labelText"],this.controlParameterArray={colourString:"Colour",filled:"Fill",thickness:"Thickness",labelText:"Label"},ED.Doodle.call(this,a,b)},ED.Freehand.prototype=new ED.Doodle,ED.Freehand.prototype.constructor=ED.Freehand,ED.Freehand.superclass=ED.Doodle.prototype,ED.Freehand.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.Freehand.prototype.setPropertyDefaults=function(){this.isDrawable=!0,this.parameterValidationArray.colourString={kind:"derived",type:"colourString",list:["FF0000FF","00FF00FF","0000FFFF"],animate:!0},this.parameterValidationArray.filled={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.thickness={kind:"derived",type:"string",list:["Thin","Medium","Thick"],animate:!0},this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!0}},ED.Freehand.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,100)},ED.Freehand.prototype.draw=function(a){var b=this.drawing.context;ED.Freehand.superclass.draw.call(this,a),b.beginPath();var c=200;b.rect(-c,-c,2*c,2*c),b.closePath();var d=new ED.Colour(0,0,0,1);if(d.setWithHexString(this.colourString),b.lineWidth=2,this.isFilled=!1,b.strokeStyle="rgba(255, 255, 255, 0)",this.isSelected&&(b.strokeStyle="gray"),this.isForDrawing&&(b.strokeStyle="blue"),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var e=0;e<this.squiggleArray.length;e++){var f=this.squiggleArray[e];b.beginPath(),b.lineWidth=f.thickness,b.strokeStyle=f.colour.rgba(),b.fillStyle=f.colour.rgba();for(var g=0;g<f.pointsArray.length;g++)b.lineTo(f.pointsArray[g].x,f.pointsArray[g].y);b.stroke(),f.filled&&f.complete&&b.fill()}this.labelText.length>0&&(b.font=this.labelFont,this.labelWidth=b.measureText(this.labelText).width,b.fillStyle="black",b.fillText(this.labelText,-this.labelWidth/2,this.labelHeight/6))}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(c,-c)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MouseTest=function(a,b){this.className="MouseTest",ED.Doodle.call(this,a,b)},ED.MouseTest.prototype=new ED.Doodle,ED.MouseTest.prototype.constructor=ED.MouseTest,ED.MouseTest.superclass=ED.Doodle.prototype,ED.MouseTest.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.MouseTest.prototype.draw=function(a){var b=this.drawing.context;ED.MouseTest.superclass.draw.call(this,a),b.beginPath();var c=200;return b.rect(-c/2,-c/2,c,c),b.closePath(),b.lineWidth=1,b.fillStyle="white",b.strokeStyle="blue",this.drawBoundary(a),this.isClicked&&console.log(a.x,a.y),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isClicked},ED.GraphAxes=function(a,b){this.className="GraphAxes",ED.Doodle.call(this,a,b)},ED.GraphAxes.prototype=new ED.Doodle,ED.GraphAxes.prototype.constructor=ED.GraphAxes,ED.GraphAxes.superclass=ED.Doodle.prototype,ED.GraphAxes.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.GraphAxes.prototype.draw=function(a){var b=this.drawing.context;ED.GraphAxes.superclass.draw.call(this,a),b.beginPath();var c=400;if(b.moveTo(0,-c),b.lineTo(0,c),b.moveTo(-c,0),b.lineTo(c,0),b.moveTo(0,-c),b.closePath(),b.lineWidth=4,b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();for(var d=-c;c>=d;d+=100)0!=d&&(b.moveTo(-20,d),b.lineTo(20,d));for(var e=-c;c>=e;e+=100)0!=e&&(b.moveTo(e,-20),b.lineTo(e,20));b.stroke(),b.font="80px sans-serif",b.fillStyle="gray",b.textAlign="center",b.fillText("+Sph",0,-440),b.fillText("-Sph",0,480),b.fillText("+Cyl",400,-40),b.fillText("-Cyl",-400,-40)}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Label=function(a,b){this.className="Label",this.labelText="",this.lastOriginX=0,this.lastOriginY=0,this.labelWidth=0,this.labelHeight=80;var c=1;a.globalScaleFactor&&(c=a.globalScaleFactor);var d=60*(1/c);this.labelFont=d.toString()+"px sans-serif",this.padding=10,this.maximumLength=20,this.isEdited=!1,this.savedParameterArray=["originX","originY","apexX","apexY","labelText","lastOriginX","lastOriginY"],this.controlParameterArray={labelText:"Text"},ED.Doodle.call(this,a,b)},ED.Label.prototype=new ED.Doodle,ED.Label.prototype.constructor=ED.Label,ED.Label.superclass=ED.Doodle.prototype,ED.Label.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Label.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.apexY.range.setMinAndMax(-1e3,1e3),this.parameterValidationArray.labelText={kind:"derived",type:"freeText",animate:!1,validate:this.validateValue.bind(this)},this.storeOriginalParams()},ED.Label.prototype.validateValue=function(a){if(a.length<this.labelText.length)return!0;var b=this.drawing.context;b.font=this.labelFont;var c=1,d=(b.measureText(a).width+2*this.padding)*this.drawing.scale*c;return d<=this.drawing.canvas.width},ED.Label.prototype.storeOriginalParams=function(){this.originalParams={originX:{min:this.parameterValidationArray.originX.range.min,max:this.parameterValidationArray.originX.range.max},originY:{min:this.parameterValidationArray.originY.range.min,max:this.parameterValidationArray.originY.range.max}}},ED.Label.prototype.setScaleLevel=function(){ED.Doodle.prototype.setScaleLevel.apply(this,arguments);var a=this.originalParams.originX.min/this.scaleLevel,b=this.originalParams.originX.max/this.scaleLevel,c=this.originalParams.originY.min/this.scaleLevel,d=this.originalParams.originY.max/this.scaleLevel;this.parameterValidationArray.originX.range.setMinAndMax(a,b),this.parameterValidationArray.originY.range.setMinAndMax(c,d)},ED.Label.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100),this.lastOriginX=this.originX,this.lastOriginY=this.originY,this.apexX=100,this.apexY=-150},ED.Label.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"originX":c.apexX=this.apexX-(b-this.lastOriginX),this.lastOriginX=b;break;case"originY":c.apexY=this.apexY-(b-this.lastOriginY),this.lastOriginY=b}return c},ED.Label.prototype.addBinding=function(a,b){ED.Doodle.prototype.addBinding.apply(this,arguments);var c=this.drawing,d=this.id,e=this.className,f=document.getElementById(b.id);"labelText"===a&&f.addEventListener("input",function(){c.eventHandler("oninput",d,e,this.id,this.value)},!1)},ED.Label.prototype.draw=function(a){var b=this.drawing.context;if(ED.Label.superclass.draw.call(this,a),b.font=this.labelFont,this.labelWidth=b.measureText(this.labelText).width+2*this.padding,b.beginPath(),b.rect(-this.labelWidth/2,-this.labelHeight/2,this.labelWidth,this.labelHeight),b.closePath(),b.lineWidth=2,this.isFilled=!1,b.strokeStyle="rgba(0, 0, 0, 0)",this.isSelected&&(b.strokeStyle="gray"),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.fillText(this.labelText,-this.labelWidth/2+this.padding,this.labelHeight/6);var c,d=new ED.Point(0,0);c=0==this.apexX?2:Math.abs(this.apexY/this.apexX),this.apexY<=0&&c>=1&&(d.x=0,d.y=-this.labelHeight/2),this.apexX<=0&&1>c&&(d.x=-this.labelWidth/2,d.y=0),this.apexY>0&&c>=1&&(d.x=0,d.y=this.labelHeight/2),this.apexX>0&&1>c&&(d.x=this.labelWidth/2,d.y=0);var e=new ED.Point(this.apexX,this.apexY);b.beginPath(),b.moveTo(d.x,d.y),b.lineTo(e.x,e.y),b.strokeStyle="Gray",b.lineWidth=4,b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Label.prototype.onSelection=function(){ED.Label.superclass.onSelection.call(this),document.getElementById(this.parameterControlElementId("labelText")).focus()},ED.MemberConnector=function(a,b){this.className="MemberConnector",this.node=null,this.length=0,this.type="Pair",ED.Doodle.call(this,a,b)},ED.MemberConnector.prototype=new ED.Doodle,ED.MemberConnector.prototype.constructor=ED.MemberConnector,ED.MemberConnector.superclass=ED.Doodle.prototype,ED.MemberConnector.prototype.setPropertyDefaults=function(){this.parameterValidationArray.length={kind:"derived",type:"int",range:new ED.Range(0,1e3),animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Pair","Sibling"],animate:!0}},ED.MemberConnector.prototype.setParameterDefaults=function(){},ED.MemberConnector.prototype.draw=function(a){var b=this.drawing.context;switch(ED.MemberConnector.superclass.draw.call(this,a),b.beginPath(),this.type){case"Pair":b.moveTo(-this.length/2,0),b.lineTo(this.length/2,0),b.moveTo(0,0),b.lineTo(0,this.length);break;case"Sibling":b.moveTo(-this.length/2,0),b.lineTo(this.length/2,0)}return b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.isClicked},ED.OperatingTable=function(a,b){this.className="OperatingTable",ED.Doodle.call(this,a,b)},ED.OperatingTable.prototype=new ED.Doodle,ED.OperatingTable.prototype.constructor=ED.OperatingTable,ED.OperatingTable.superclass=ED.Doodle.prototype,ED.OperatingTable.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.OperatingTable.prototype.draw=function(a){var b=this.drawing.context;return ED.OperatingTable.superclass.draw.call(this,a),b.beginPath(),b.arc(0,-0,60,0,2*Math.PI,!0),b.lineWidth=30,b.strokeStyle="rgba(120,120,120,1)",b.fillStyle="rgba(220,220,220,1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.rect(-100,20,200,400),b.lineWidth=8,b.strokeStyle="rgba(120,120,120,1)",b.fillStyle="rgba(220,220,220,1)",b.fill(),b.stroke()),this.isClicked},ED.Slider2D=function(a,b){this.className="Slider2D",this.sphereSign=" ",this.sphereInteger=0,this.sphereFractional=0,this.cylinderSign=" ",this.cylinderInteger=0,this.cylinderFractional=0,ED.Doodle.call(this,a,b)},ED.Slider2D.prototype=new ED.Doodle,ED.Slider2D.prototype.constructor=ED.Slider2D,ED.Slider2D.superclass=ED.Doodle.prototype,ED.Slider2D.prototype.setPropertyDefaults=function(){this.snapToGrid=!0,this.gridSpacing=5,this.isShowHighlight=!1,this.parameterValidationArray.originX.range.setMinAndMax(-400,400),this.parameterValidationArray.originY.range.setMinAndMax(-400,400),this.parameterValidationArray.sphereSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.sphereInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.sphereFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0},this.parameterValidationArray.cylinderSign={kind:"derived",type:"string",list:["+","=","-"],animate:!0},this.parameterValidationArray.cylinderInteger={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0},this.parameterValidationArray.cylinderFractional={kind:"derived",type:"string",list:[".00",".25",".50",".75"],animate:!0}},ED.Slider2D.prototype.setParameterDefaults=function(){this.setParameterFromString("sphereSign","="),this.setParameterFromString("sphereInteger","0"),this.setParameterFromString("sphereFractional",".00"),this.setParameterFromString("cylinderSign","="),this.setParameterFromString("cylinderInteger","0"),this.setParameterFromString("cylinderFractional",".00")},ED.Slider2D.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"sphereSign":switch(b){case"+":c.originY=-1*Math.abs(this.originY);break;case"=":c.originY=0;break;case"-":c.originY=Math.abs(this.originY)}break;case"sphereInteger":c.originY=20*(parseInt(b)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?1:-1);break;case"sphereFractional":c.originY=20*(this.sphereInteger+parseFloat(b))*("-"==this.sphereSign?1:-1);break;case"cylinderSign":switch(b){case"+":c.originX=Math.abs(this.originX);break;case"=":c.originX=0;break;case"-":c.originX=-1*Math.abs(this.originX)}break;case"cylinderInteger":c.originX=20*(parseInt(b)+parseFloat(this.sphereFractional))*("-"==this.sphereSign?-1:1);break;case"cylinderFractional":c.originX=20*(this.sphereInteger+parseFloat(b))*("-"==this.sphereSign?-1:1);break;case"originY":c.sphereSign=b>0?"-":0>b?"+":"=",c.sphereInteger=Math.floor(Math.abs(b/20));var d=Math.abs(b/20)-Math.floor(Math.abs(b/20));0==d&&(c.sphereFractional=".00"),.25==d&&(c.sphereFractional=".25"),.5==d&&(c.sphereFractional=".50"),.75==d&&(c.sphereFractional=".75");break;case"originX":c.cylinderSign=0>b?"-":b>0?"+":"=",c.cylinderInteger=Math.floor(Math.abs(b/20));var d=Math.abs(b/20)-Math.floor(Math.abs(b/20));0==d&&(c.cylinderFractional=".00"),.25==d&&(c.cylinderFractional=".25"),.5==d&&(c.cylinderFractional=".50"),.75==d&&(c.cylinderFractional=".75")}return c},ED.Slider2D.prototype.draw=function(a){var b=this.drawing.context;ED.Slider2D.superclass.draw.call(this,a),b.beginPath();var c=30,d=80;b.moveTo(0,-d-c),b.lineTo(c,-d),b.lineTo(d,-d),b.lineTo(d,-c),b.lineTo(d+c,0),b.lineTo(d,c),b.lineTo(d,d),b.lineTo(c,d),b.lineTo(0,d+c),b.lineTo(-c,d),b.lineTo(-d,d),b.lineTo(-d,c),b.lineTo(-d-c,0),b.lineTo(-d,-c),b.lineTo(-d,-d),b.lineTo(-c,-d),b.closePath(),b.lineWidth=2,b.strokeStyle="blue";var e="rgba(130, 205, 205, 0.5)",f="rgba(170, 225, 225, 0.5)",g=b.createLinearGradient(0,-25,0,25);if(g.addColorStop(0,f),g.addColorStop(1,e),b.fillStyle=g,this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var h=100;b.moveTo(0,-h),b.lineTo(0,h),b.moveTo(-h,0),b.lineTo(h,0),b.moveTo(0,-h),b.strokeStyle="gray",b.stroke()}return this.isClicked},ED.Surgeon=function(a,b){this.className="Surgeon",this.surgeonPosition="Temporal",this.savedParameterArray=["surgeonPosition"],ED.Doodle.call(this,a,b)},ED.Surgeon.prototype=new ED.Doodle,ED.Surgeon.prototype.constructor=ED.Surgeon,ED.Surgeon.superclass=ED.Doodle.prototype,ED.Surgeon.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.snapToAngles=!0,this.willStaySelected=!1,this.isUnique=!0,this.isDeletable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(100,500),this.parameterValidationArray.surgeonPosition={kind:"derived",type:"string",list:["Superior","Supero-temporal","Temporal","Infero-temporal","Inferior","Infero-nasal","Nasal","Supero-nasal"],animate:!0};var a=Math.PI/4;this.anglesArray=[0,a,2*a,3*a,4*a,5*a,6*a,7*a]},ED.Surgeon.prototype.setParameterDefaults=function(){this.rotation=0,this.setParameterFromString("surgeonPosition","Temporal")},ED.Surgeon.prototype.dependentParameterValues=function(a,b){var c=new Array,d=this.drawing.eye==ED.eye.Right,e=2*Math.PI;switch(a){case"rotation":c.surgeonPosition=d?e/16>b?"Superior":3*e/16>b?"Supero-nasal":5*e/16>b?"Nasal":7*e/16>b?"Infero-nasal":9*e/16>b?"Inferior":11*e/16>b?"Infero-temporal":13*e/16>b?"Temporal":15*e/16>b?"Supero-temporal":"Superior":e/16>b?"Superior":3*e/16>b?"Supero-temporal":5*e/16>b?"Temporal":7*e/16>b?"Infero-temporal":9*e/16>b?"Inferior":11*e/16>b?"Infero-nasal":13*e/16>b?"Nasal":15*e/16>b?"Supero-nasal":"Superior";break;case"surgeonPosition":switch(b){case"Superior":c.rotation=0;break;case"Supero-temporal":c.rotation=d?7*Math.PI/4:1*Math.PI/4;break;case"Temporal":c.rotation=d?6*Math.PI/4:2*Math.PI/4;break;case"Infero-temporal":c.rotation=d?5*Math.PI/4:3*Math.PI/4;break;case"Inferior":c.rotation=Math.PI;break;case"Infero-nasal":c.rotation=d?3*Math.PI/4:5*Math.PI/4;break;case"Nasal":c.rotation=d?2*Math.PI/4:6*Math.PI/4;break;case"Supero-nasal":c.rotation=d?1*Math.PI/4:7*Math.PI/4}}return c},ED.Surgeon.prototype.draw=function(a){var b=this.drawing.context;ED.Surgeon.superclass.draw.call(this,a),b.beginPath();var c=.2,d=-300;b.moveTo(0*c,d-200*c),b.bezierCurveTo(-100*c,d-250*c,-145*c,d-190*c,-200*c,d-180*c),b.bezierCurveTo(-310*c,d-160*c,-498*c,d-75*c,-500*c,d+0*c),b.bezierCurveTo(-500*c,d+50*c,-500*c,d+460*c,-470*c,d+700*c),b.bezierCurveTo(-470*c,d+710*c,-500*c,d+770*c,-500*c,d+810*c),b.bezierCurveTo(-500*c,d+840*c,-440*c,d+850*c,-420*c,d+840*c),b.bezierCurveTo(-390*c,d+830*c,-380*c,d+710*c,-380*c,d+700*c),b.bezierCurveTo(-370*c,d+700*c,-360*c,d+780*c,-350*c,d+780*c),b.bezierCurveTo(-330*c,d+780*c,-340*c,d+730*c,-340*c,d+700*c),b.bezierCurveTo(-340*c,d+690*c,-350*c,d+680*c,-350*c,d+670*c),b.bezierCurveTo(-350*c,d+590*c,-385*c,d+185*c,-300*c,d+100*c),b.bezierCurveTo(-150*c,d+140*c,-250*c,d+200*c,0*c,d+300*c),b.bezierCurveTo(250*c,d+200*c,150*c,d+140*c,300*c,d+100*c),b.bezierCurveTo(380*c,d+180*c,350*c,d+590*c,350*c,d+670*c),b.bezierCurveTo(350*c,d+680*c,340*c,d+690*c,340*c,d+700*c),b.bezierCurveTo(340*c,d+730*c,330*c,d+780*c,350*c,d+780*c),b.bezierCurveTo(360*c,d+780*c,370*c,d+700*c,380*c,d+700*c),b.bezierCurveTo(380*c,d+710*c,390*c,d+830*c,420*c,d+840*c),b.bezierCurveTo(430*c,d+845*c,505*c,d+840*c,505*c,d+810*c),b.bezierCurveTo(505*c,d+760*c,470*c,d+710*c,470*c,d+700*c),b.bezierCurveTo(500*c,d+460*c,499*c,d+45*c,500*c,d+0*c),b.bezierCurveTo(498*c,d-78*c,308*c,d-164*c,200*c,d-182*c),b.bezierCurveTo(145*c,d-190*c,100*c,d-250*c,0*c,d-200*c),b.lineWidth=4,b.strokeStyle="rgba(120,120,120,1)";var e=new ED.Colour(0,0,0,1);return e.setWithHexString("3AFEFA"),b.fillStyle=e.rgba(),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(0*c,d-250*c),b.bezierCurveTo(-100*c,d-250*c,-180*c,d-200*c,-200*c,d-170*c),b.bezierCurveTo(-209*c,d-157*c,-220*c,d-100*c,-230*c,d-50*c),b.bezierCurveTo(-260*c,d-70*c,-260*c,d-20*c,-260*c,d+0*c),b.bezierCurveTo(-260*c,d+20*c,-260*c,d+80*c,-230*c,d+60*c),b.bezierCurveTo(-230*c,d+90*c,-220*c,d+141*c,-210*c,d+160*c),b.bezierCurveTo(-190*c,d+200*c,-100*c,d+280*c,-40*c,d+300*c),b.bezierCurveTo(-34*c,d+303*c,-20*c,d+350*c,0*c,d+350*c),b.bezierCurveTo(20*c,d+350*c,34*c,d+300*c,40*c,d+300*c),b.bezierCurveTo(100*c,d+280*c,190*c,d+200*c,210*c,d+160*c),b.bezierCurveTo(218*c,d+143*c,230*c,d+90*c,230*c,d+60*c),b.bezierCurveTo(260*c,d+80*c,260*c,d+20*c,260*c,d+0*c),b.bezierCurveTo(260*c,d-20*c,260*c,d-70*c,230*c,d-50*c),b.bezierCurveTo(220*c,d-100*c,208*c,d-158*c,200*c,d-170*c),b.bezierCurveTo(180*c,d-200*c,100*c,d-250*c,0*c,d-250*c),b.fill(),b.stroke()),this.isClicked},null==ED||"object"!=typeof ED)var ED=new Object;if(ED.trans=new Object,ED.trans.ACIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.ACMaintainer="Drag to move",ED.trans.AngleGradeEast="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeNorth="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeSouth="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleGradeWest="Drag handle to adjust amount of angle obscure by iris",ED.trans.AngleNV="Drag to move around angle<br/>Drag handles to change extent",ED.trans.AngleRecession="Drag to move around angle<br/>Drag handles to change extent",ED.trans.AntSeg="Drag the handle to resize the pupil<br/><br/>The iris is semi-transparent so that IOLs, and<br/>other structures can be seen behind it",ED.trans.AntSegCrossSection="",ED.trans.AntSynech="Drag to move around angle<br/>Drag handles to change extent",ED.trans.ArcuateScotoma="Drag handle to change size",ED.trans.BiopsySite="Drag to position",ED.trans.Bleb="Drag to move around the limbus<br/>Drag handle to change size",ED.trans.BlotHaemorrhage="Drag to position<br/>Drag the handle to change size",ED.trans.BuckleSuture="Drag to position",ED.trans.BusaccaNodule="Drag to move around the iris",ED.trans.CapsularTensionRing="This cannot be selected directly since it is behind the iris<br/>Select the iris first<br/>Then move the scroll wheel until the ring is selected<br/>Click the 'Move to front' button<br/>Err.. of course if you are seeing this tooltip you have already done it",ED.trans.ChandelierSingle="Drag to rotate around centre<br/>",ED.trans.ChandelierDouble="Drag to rotate around centre<br/>",ED.trans.ChoroidalHaemorrhage="Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.ChoroidalNaevus="Drag to position<br/>Drag outer handles to change shape<br/>Drag outer ring of top handles to rotate<br/>Drag middle handle to add drusen",ED.trans.CiliaryInjection="Drag to rotate around centre<br/>Drag handles to change extent",ED.trans.Circinate="Drag to position<br/>Drag handle to change size",ED.trans.CircumferentialBuckle="Drag to position<br/>Drag outer handles to change extent<br/>Drag middle handle to change width",ED.trans.ConjunctivalFlap="Drag to move around the limbus<br/>Drag handles to change size and depth",ED.trans.CornealAbrasion="Drag to position<br/>Drag handle to change size",ED.trans.CorneaCrossSection="",ED.trans.CornealErosion="Drag to position<br/>Drag handle to change size",ED.trans.CornealGraft="Drag handle to change size",ED.trans.CornealInlay="",ED.trans.CornealOedema="Drag to position<br/>Drag handle to change size",ED.trans.CornealStriae="",ED.trans.CornealScar="Drag outer handle to change shape<br/>Drag inner handle to change density",ED.trans.CornealSuture="Drag to move",ED.trans.CorticalCataract="Drag to move<br/>Drag handle to change density",ED.trans.CottonWoolSpot="Drag to position<br/>Drag handle to change shape and size",ED.trans.CNV="Drag to move<br/>Drag handle to scale",ED.trans.CutterPI="Drag to move around the iris",ED.trans.CystoidMacularOedema="Drag handle to change size",ED.trans.DiabeticNV="Drag to position<br/>Drag handle to change size",ED.trans.DiscHaemorrhage="Drag to position",ED.trans.DiscPallor="Drag to position<br/>Drag handles to adjust extent",ED.trans.DrainageRetinotomy="Drag to position",ED.trans.DrainageSite="Drag to change position",ED.trans.EncirclingBand="Drag to change orientation of Watzke sleeve",ED.trans.EntrySiteBreak="Drag to position<br/>Drag either end handle to increase extent",ED.trans.EpiretinalMembrane="Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrousProliferation="Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.FibrovascularScar="Drag to move<br/>Drag handle to scale",ED.trans.FocalLaser="Drag the handle for a bigger area with more burns",ED.trans.Freehand="Double-click to start drawing<br/>Drag inner handle to change size<br/>Drag outer handle to rotate<br/><br/>Adjust colours and settings in tool bar",ED.trans.Fundus="",ED.trans.Fuchs="Drag handle to change shape",ED.trans.Geographic="Drag middle handle to alter size of remaining central island of RPE<br/>Drag outside handle to scale",ED.trans.Gonioscopy="Drag top left handle up and down to alter pigment density<br/>Drag top left handle left and right to alter pigment homogeneity",ED.trans.HardDrusen="Drag middle handle up and down to alter density of drusen<br/>Drag outside handle to scale",ED.trans.HardExudate="Drag to position",ED.trans.Hyphaema="Drag handle vertically to change size<br/>Drag handle horizontally to change density",ED.trans.Hypopyon="Drag handle vertically to change size",ED.trans.IatrogenicBreak="Drag to position<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.ILMPeel="Drag to position<br/>Drag handle to change size",ED.trans.InjectionSite="Drag to position<br/>Drag handle to adjust distance from limbus",ED.trans.IrisHook="Drag to move around the clock<br/><br/>The hook will match the size of the pupil as it changes<br/>Subsequent hooks are added to the next quadrant",ED.trans.IrisNaevus="Drag to move<br/>Drag handle to change size",ED.trans.IRMA="Drag to move<br/>Drag inner handle to change size<br/>Drag outer handle to rotate",ED.trans.KeraticPrecipitates="Drag middle handle up and down to alter density<br/>Drag middle handle left and right to alter size<br/>Drag outside handle to scale",ED.trans.KoeppeNodule="Drag to move around the iris",ED.trans.KrukenbergSpindle="Drag to move</br>Drag outer handle to change shape",ED.trans.Label="Drag to move label, type text to edit<br/>Drag handle to move pointer",ED.trans.LaserCircle="Drag handle to change shape",ED.trans.LaserDemarcation="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move line more posteriorly",ED.trans.LaserSpot="Drag to position<br/>Drag the handle to change size",ED.trans.LasikFlap="Drag to rotate<br/>Drag the handle to scale",ED.trans.Lens="Drag to move<br/>Edit properties when selected<br/>Delete to remove",ED.trans.LensCrossSection="",ED.trans.LimbalRelaxingIncision="Drag to move",ED.trans.Macroaneurysm="Drag to move",ED.trans.MacularDystrophy="Drag outer handle to change size<br/>Drag middle handle to change type",ED.trans.MacularGrid="Drag the handle to scale",ED.trans.MacularHole="Drag the handle to scale",ED.trans.MacularThickening="Drag to position<br/>Drag handle to change size",ED.trans.MattressSuture="Drag to move",ED.trans.Microaneurysm="Drag to position",ED.trans.NerveFibreDefect="Drag to position<br/>Drag handles to change size",ED.trans.NuclearCataract="Drag to move<br/>Drag handle to change density",ED.trans.OperatingTable="",ED.trans.OpticDisc="Basic mode: Drag handle to adjust cup/disc ratio<br/>Expert mode: Drag handles to re-shape disc",ED.trans.OpticDiscPit="Drag to position<br/>Drag handle to change shape",ED.trans.Patch="Drag to position<br/>Drag handle to change size",ED.trans.Papilloedema="",ED.trans.PCIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.PeripapillaryAtrophy="Drag to rotate<br/>Drag handles to change extent",ED.trans.PeripheralRetinectomy="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PeripheralRRD="Drag to rotate<br/>Drag each end handle to increase extent<br/>Drag the middle handle to move posterior limit",ED.trans.PhakoIncision="Drag end handle to change length<br/>Drag the middle handle to change section type<br/>Drag the incision itself to move",ED.trans.PI="Drag to move around the iris",ED.trans.PosteriorCapsule="",ED.trans.PosteriorEmbryotoxon="",ED.trans.PosteriorRetinectomy="Drag to position<br/>Drag the handle to change size",ED.trans.PosteriorSynechia="Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.PostPole="The disc cup can be edited by clicking on the disc, and dragging the yellow handle<br/>The gray circle marks one disc diameter from the fovea",ED.trans.PostSubcapCataract="Drag handle to change size",ED.trans.PreRetinalHaemorrhage="Drag to position<br/>Drag handles to change shape and size",ED.trans.PRPPostPole="",ED.trans.RadialSponge="Drag to change position",ED.trans.RetinalArteryOcclusionPostPole="Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RetinalTouch="Drag to change position",ED.trans.RetinalVeinOcclusionPostPole="Drag to position<br/>Drag handles to change extent<br/>Drag central handle to alter macular involvement",ED.trans.RK="Drag to rotate<br/>Drag outer handle to resize<br/>Drag inner handle to adjust central extent",ED.trans.RoundHole="",ED.trans.RPEAtrophy="Drag to position<br/>Drag the handle to change size",ED.trans.RPEDetachment="Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.RetinalHaemorrhage="Drag to position<br/>Drag the handle to change size",ED.trans.RPEHypertrophy="Drag to position<br/>Drag the handle to change size",ED.trans.RPERip="Drag to move<br/>Drag large handle to resize and rotate<br/>Drag other handles to adjust shape",ED.trans.RRD="Drag to move around eye<br/>Drag outer handles to change size</br>Drag middle handle to change posterior extent",ED.trans.Rubeosis="Drag to rotate around centre<br/>Drag handles to increase extent",ED.trans.SectorPRP="Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.SectorPRPPostPole="Drag to rotate around centre<br/>Drag each end handle to increase extent",ED.trans.ScleralIncision="Drag to move around the sclera",ED.trans.SectorIridectomy="Drag to position<br/>Drag handles to adjust extent",ED.trans.Sclerostomy="Drag to rotate around centre<br/>Drag each handle to alter gauge<br/>Click suture button to toggle suture",ED.trans.SidePort="Drag to move",ED.trans.SubretinalFluid="Drag to position<br/>Drag handles to change shape<br/>Drag to position<br/>Drag outer ring of top handles to rotate",ED.trans.SubretinalPFCL="Drag to position<br/>Drag handle to change size",ED.trans.Supramid="Drag handle to move conjunctival end of suture",ED.trans.Surgeon="",ED.trans.SwollenDisc="",ED.trans.Telangiectasis="Drag middle handle to add pigment and exudate",ED.trans.ToricPCIOL="Drag to move<br/>Drag the handle to rotate",ED.trans.Trabectome="Drag to position<br/>Drag either end handle to adjust extent",ED.trans.TrabyConjIncision="Drag to position<br/>Drag end handle to adjust extent",ED.trans.TrabyFlap="Drag to position<br/>Drag either end handle to adjust size</br>Drag middle handle to change sclerostomy",ED.trans.TrabySuture="Drag to position<br/>Drag corner handle to adjust orientation</br>Drag lower handle to change suture type",ED.trans.TractionRetinalDetachment="Drag to position<br/>Drag inner handle to change shape and size<br/>Drag outer handle to rotate",ED.trans.TransilluminationDefect="Drag to rotate around centre<br/>Drag each end handle to alter extent",ED.trans.Tube="Drag to change quadrant<br/>Drag handle to move end of tube",ED.trans.TubeExtender="Drag to change quadrant<br/>Drag handle to move end of tube",ED.trans.TubeLigation="Drag to change position",ED.trans.UTear="",ED.trans.ViewObscured="Drag handle to change opacity",ED.trans.VitreousOpacity="Drag to move<br/>Drag the inner handle up and down to alter opacity<br/>Drag the outer handle to scale",ED.trans.Grommet="Drag to position",ED.trans.Perforation="Drag to move<br/>Drag handle to change size",ED.trans.Crepitations="Drag to move<br/>Drag handle to resize",ED.trans.Stenosis="Drag to move<br/>Drag handle up and down to change degree<br/>Drag handle to left and right to change type",ED.trans.Wheeze="Drag to move",ED.trans.Effusion="Drag handle to move up",ED.trans.LeftCoronaryArtery="Drag handle to move origin and make anomolous",ED.trans.DrugStent="Drag to move",ED.trans.MetalStent="Drag to move",ED.trans.Bypass="Drag handle to alter destination",ED.trans.Bruit="Drag to move",ED.trans.Bruising="Drag to move<br/>Drag handle to resize",ED.trans.Haematoma="Drag to move<br/>Drag handle to resize",ED.AgentDose=function(a,b){this.className="AgentDose",this.halfWidth=50,this.halfHeight=20,this.minimumWidth=40,this.valueString="200mg",ED.Doodle.call(this,a,b)
},ED.AgentDose.prototype=new ED.Doodle,ED.AgentDose.prototype.constructor=ED.AgentDose,ED.AgentDose.superclass=ED.Doodle.prototype,ED.AgentDose.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDose.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-1e3+this.halfWidth,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(-this.halfWidth+this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDose.prototype.setParameterDefaults=function(){this.apexX=100},ED.AgentDose.prototype.draw=function(a){var b=this.drawing.context;ED.AgentDose.superclass.draw.call(this,a),b.beginPath();var c=5,d=1.5;if(this.halfWidth=b.measureText(this.valueString).width*d,b.moveTo(-this.halfWidth,-this.halfHeight+c),b.lineTo(-c,-this.halfHeight+c),b.lineTo(0,-this.halfHeight),b.lineTo(c,-this.halfHeight+c),b.lineTo(this.halfWidth,-this.halfHeight+c),b.lineTo(this.halfWidth,this.halfHeight-c),b.lineTo(c,this.halfHeight-c),b.lineTo(0,this.halfHeight),b.lineTo(-c,this.halfHeight-c),b.lineTo(-this.halfWidth,this.halfHeight-c),b.closePath(),b.lineWidth=4,b.strokeStyle="rgba(50,50,50,1)",b.fillStyle="white",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.font="24px sans-serif",b.strokeStyle="gray",b.fillStyle="gray";var e=b.measureText(this.valueString).width;b.fillText(this.valueString,-e/2,8)}return this.isClicked},ED.AgentDuration=function(a,b){this.className="AgentDuration",this.unit="mg",this.type="range",this.halfHeight=20,this.minimumWidth=40,this.dose="",this.savedParameterArray=["originX","apexX","unit","type","dose"],ED.Doodle.call(this,a,b)},ED.AgentDuration.prototype=new ED.Doodle,ED.AgentDuration.prototype.constructor=ED.AgentDuration,ED.AgentDuration.superclass=ED.Doodle.prototype,ED.AgentDuration.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AgentDuration.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.unit={kind:"derived",type:"string",list:["mg","mls","ug","mg/kg/hr","ug/kg/hr","drops","IU"],animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["range","fixed"],animate:!0},this.parameterValidationArray.originX.range.setMinAndMax(-500,900),this.parameterValidationArray.originY.range.setMinAndMax(-0,0),this.parameterValidationArray.apexX.range.setMinAndMax(this.minimumWidth,1500),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.AgentDuration.prototype.setParameterDefaults=function(){this.apexX=this.minimumWidth},ED.AgentDuration.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"type":this.apexX="range"==b?200:40}return c},ED.AgentDuration.prototype.draw=function(a){var b=this.drawing.context;ED.AgentDuration.superclass.draw.call(this,a),b.beginPath();var c=this.minimumWidth/2;if("range"==this.type&&(c=0),b.rect(0-c,-this.halfHeight,this.apexX,2*this.halfHeight),b.closePath(),b.lineWidth=1,b.strokeStyle="rgba(125,125,125,0)",b.fillStyle="rgba(125,125,125,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),"range"==this.type?(b.moveTo(0-c,-this.halfHeight),b.lineTo(0-c,this.halfHeight),b.moveTo(0-c,0),b.lineTo(this.apexX-c,0),b.moveTo(this.apexX-c,-this.halfHeight),b.lineTo(this.apexX-c,this.halfHeight)):(b.moveTo(-c,0),b.lineTo(0,this.halfHeight),b.lineTo(c,0),b.lineTo(0,-this.halfHeight),b.closePath()),b.lineWidth=4,b.strokeStyle="rgba(50,50,50,1)",b.stroke(),b.lineWidth=1,b.font="24px sans-serif",b.strokeStyle="blue",b.fillStyle="blue";var d=String(this.dose);d.length>0&&(d=d+" "+this.unit);var e=(b.measureText(d).width,10);b.fillText(d,c+e,-8)}return"range"==this.type&&(this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a)),this.isClicked},ED.AgentDuration.prototype.drawHighlightExtras=function(){var a=this.drawing.context;a.beginPath();var b=this.minimumWidth/2;"range"==this.type&&(b=0);var c=3;a.rect(0-b-c,-this.halfHeight-c,this.apexX+2*c,2*this.halfHeight+2*c),a.lineWidth=3,a.strokeStyle="yellow",a.stroke()},ED.RecordGrid=function(a,b){this.className="RecordGrid",this.values={sys:160,dia:80,pul:60,res:30,oxi:100},this.minutesPerCell=5,this.minutesLabelArray=[0,30],this.totalMinutes=180,this.numberCellsHorizontal=Math.round(this.totalMinutes/this.minutesPerCell)+2,this.numberCellsVertical=12,this.separationOfVerticalGridLines=a.doodlePlaneWidth/this.numberCellsHorizontal,this.index=0,this.firstCoordinate=-a.doodlePlaneWidth/2,this.startDate=new Date,this.gridStartDate=new Date,this.nowDate=new Date,this.setGridStartDate(this.startDate),this.savedParameterArray=["startDate"],this.parameterObjectTypeArray={startDate:"date",gridStartDate:"date"},ED.Doodle.call(this,a,b)},ED.RecordGrid.prototype=new ED.Doodle,ED.RecordGrid.prototype.constructor=ED.RecordGrid,ED.RecordGrid.superclass=ED.Doodle.prototype,ED.RecordGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.RecordGrid.prototype.draw=function(a){var b=this.drawing.context;ED.RecordGrid.superclass.draw.call(this,a),b.beginPath();var c=-this.drawing.doodlePlaneWidth/2,d=-this.drawing.doodlePlaneHeight/2,e=this.drawing.doodlePlaneWidth/this.numberCellsHorizontal,f=this.drawing.doodlePlaneHeight/this.numberCellsVertical;if(b.rect(c,d,this.drawing.doodlePlaneWidth,this.drawing.doodlePlaneHeight),b.lineWidth=4,b.strokeStyle="gray",b.fillStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();for(var g=0;g<this.numberCellsVertical;g++)b.moveTo(c,d+g*f),b.lineTo(c+this.drawing.doodlePlaneWidth,d+g*f);for(var h=0;h<this.numberCellsHorizontal;h++)b.moveTo(c+h*e,d),b.lineTo(c+h*e,d+this.drawing.doodlePlaneHeight);b.lineWidth=4,b.strokeStyle="rgba(200,200,200,1)",b.stroke();var i=this.nowDate-this.gridStartDate;this.timeLineX=this.firstCoordinate+this.drawing.doodlePlaneWidth/this.numberCellsHorizontal*i/(6e4*this.minutesPerCell),b.beginPath(),b.moveTo(this.timeLineX,d),b.lineTo(this.timeLineX,d+this.drawing.doodlePlaneHeight),b.lineWidth=4,b.strokeStyle="red",b.stroke();for(var h=1;h<this.numberCellsHorizontal;h++){dateOfGridLine=new Date(this.gridStartDate.getTime()+h*this.minutesPerCell*6e4);var j=dateOfGridLine.getHours(),k=dateOfGridLine.getMinutes();if(this.minutesLabelArray.indexOf(k)>=0){var l=j.toString();l.length<2&&(l="0"+l);var m=k.toString();m.length<2&&(m="0"+m);var n=l+":"+m;b.lineWidth=1,b.font="48px sans-serif",b.strokeStyle="gray",b.fillStyle="gray";var o=b.measureText(n).width;b.fillText(n,c+h*e-o/2,d+50)}}}return this.isClicked},ED.RecordGrid.prototype.getNextValues=function(a){for(var b=this.drawing.allDoodlesOfClass("RecordReading"),c=-2e3,d=0;d<b.length;d++)if(b[d].type==a){this.values[a]=b[d].value,c=b[d].originX;break}var e=this.getGridX();return e>c?{value:this.values[a],originX:e}:!1},ED.RecordGrid.prototype.setGridStartDate=function(a){var b=Math.round(a.getMinutes()/this.minutesPerCell)*this.minutesPerCell,c=Math.floor(a.getMinutes()/this.minutesPerCell)*this.minutesPerCell;this.gridStartDate=a,this.gridStartDate.setMinutes(c),b==c&&(this.gridStartDate=new Date(this.gridStartDate.getTime()-6e4*this.minutesPerCell)),this.gridStartDate.setSeconds(0)},ED.RecordGrid.prototype.getGridX=function(){var a=this.nowDate-this.gridStartDate;return this.index=Math.round(a/(6e4*this.minutesPerCell)),Math.round(this.firstCoordinate+this.index*this.separationOfVerticalGridLines)},ED.RecordReading=function(a,b){this.className="RecordReading",this.type="sys",this.value="0",this.savedParameterArray=["originX","originY","value","type"],ED.Doodle.call(this,a,b)},ED.RecordReading.prototype=new ED.Doodle,ED.RecordReading.prototype.constructor=ED.RecordReading,ED.RecordReading.superclass=ED.Doodle.prototype,ED.RecordReading.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.value={kind:"derived",type:"int",range:new ED.Range(0,240),animate:!1},this.parameterValidationArray.type={kind:"derived",type:"string",list:["sys","dia","pul","res","oxi"],animate:!1}},ED.RecordReading.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"originY":c.value=Math.round(240*(this.drawing.doodlePlaneHeight/2-b)/this.drawing.doodlePlaneHeight);break;case"value":c.originY=-(b*this.drawing.doodlePlaneHeight/240)+this.drawing.doodlePlaneHeight/2;break;case"originX":this.parameterValidationArray.originX.range.setMinAndMax(this.originX,this.originX)}return c},ED.RecordReading.prototype.draw=function(a){var b=this.drawing.context;ED.RecordReading.superclass.draw.call(this,a),b.beginPath();var c=56,d=30;switch(this.type){case"sys":b.rect(-c/2,-d,c,d);break;case"dia":b.rect(-c/2,0,c,d);break;case"pul":b.arc(0,0,d,0,2*Math.PI,!0);break;case"res":b.arc(0,0,d,0,2*Math.PI,!0);break;case"oxi":b.rect(-c/2,-d/2,c,d)}if(b.closePath(),b.strokeStyle="rgba(255,255,255,0)",b.fillStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(b.beginPath(),this.type){case"sys":b.moveTo(-c/2,-d),b.lineTo(0,0),b.lineTo(c/2,-d);break;case"dia":b.moveTo(-c/2,d),b.lineTo(0,0),b.lineTo(c/2,d);break;case"pul":b.arc(0,0,20,0,2*Math.PI,!0);break;case"res":b.arc(0,0,20,0,2*Math.PI,!0);break;case"oxi":b.rect(-c/2,-d/2,c,d)}b.lineWidth=8,b.lineJoin="round",b.lineCap="round",b.strokeStyle="gray",b.fillStyle=b.strokeStyle,b.stroke(),"pul"==this.type&&b.fill()}return this.isClicked},ED.RecordReading.prototype.drawHighlightExtras=function(){var a=this.drawing.context;a.lineWidth=1,a.font="64px sans-serif",a.strokeStyle="blue",a.fillStyle="blue",a.fillText(this.value,40,20)},null==ED||"object"!=typeof ED)var ED=new Object;ED.Heart=function(a,b){this.className="Heart",ED.Doodle.call(this,a,b)},ED.Heart.prototype=new ED.Doodle,ED.Heart.prototype.constructor=ED.Heart,ED.Heart.superclass=ED.Doodle.prototype,ED.Heart.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Heart.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Heart.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460},ED.Heart.prototype.draw=function(a){var b=this.drawing.context;ED.Heart.superclass.draw.call(this,a);var c=0,d=2*Math.PI;return b.beginPath(),b.arc(0,0,400,c,d,!0),b.lineWidth=15,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-287,-51),b.bezierCurveTo(-344,53,-346,243,-116,209),b.bezierCurveTo(5,297,269,341,312,268),b.bezierCurveTo(387,141,319,-17,237,-59),b.bezierCurveTo(225,-133,141,-209,65,-215),b.bezierCurveTo(55,-209,43,-219,53,-193),b.bezierCurveTo(133,-185,201,-129,216,-46),b.bezierCurveTo(205,-23,167,11,187,25),b.bezierCurveTo(202,36,192,-37,235,-3),b.bezierCurveTo(291,41,333,227,295,207),b.bezierCurveTo(195,155,153,111,97,43),b.bezierCurveTo(74,15,177,62,181,43),b.bezierCurveTo(187,17,109,25,55,19),b.bezierCurveTo(31,-7,-172,-89,-173,-87),b.bezierCurveTo(-173,-84,-232,-117,-191,-73),b.bezierCurveTo(-115,-49,-61,-13,-37,-3),b.bezierCurveTo(-67,45,-14,171,3,165),b.bezierCurveTo(21,159,-53,45,15,23),b.bezierCurveTo(103,87,199,183,231,249),b.bezierCurveTo(199,297,-31,243,-81,199),b.bezierCurveTo(-53,175,-8,204,-13,187),b.bezierCurveTo(-17,171,-66,181,-105,185),b.bezierCurveTo(-331,209,-289,33,-273,-37),b.bezierCurveTo(-270,-47,-287,-51,-287,-51),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Heart.prototype.description=function(){return"Heart"},ED.Aorta=function(a,b){this.className="Aorta",ED.Doodle.call(this,a,b)},ED.Aorta.prototype=new ED.Doodle,ED.Aorta.prototype.constructor=ED.Aorta,ED.Aorta.superclass=ED.Doodle.prototype,ED.Aorta.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Aorta.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Aorta.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.5,this.originX=-352,this.originY=-416,this.apexX=-460,this.apexY=-460},ED.Aorta.prototype.draw=function(a){var b=this.drawing.context;ED.Aorta.superclass.draw.call(this,a);var c=0,d=2*Math.PI;return b.beginPath(),b.arc(0,0,400,c,d,!0),b.lineWidth=15,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(216,-112),b.bezierCurveTo(216,-112,181,46,210,40),b.bezierCurveTo(239,33,282,-111,282,-111),b.moveTo(423,335),b.bezierCurveTo(423,335,453,57,313,31),b.bezierCurveTo(281,26,330,-100,330,-100),b.moveTo(-1,-25),b.bezierCurveTo(-1,-25,57,2,74,41),b.bezierCurveTo(82,61,93,79,116,78),b.bezierCurveTo(144,78,141,42,141,7),b.bezierCurveTo(141,-50,159,-97,159,-97),b.moveTo(198,582),b.bezierCurveTo(214,619,155,663,105,649),b.moveTo(-39,12),b.bezierCurveTo(-39,12,52,54,28,133),b.bezierCurveTo(28,133,-2,180,-16,200),b.bezierCurveTo(-49,246,-125,446,-28,595),b.lineTo(-1,640),b.bezierCurveTo(67,725,152,624,119,566),b.bezierCurveTo(151,598,255,603,251,514),b.bezierCurveTo(250,473,182,418,182,418),b.bezierCurveTo(118,352,162,209,254,211),b.bezierCurveTo(314,212,287,365,287,365),b.lineWidth=12,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(100, 100, 100, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Aorta.prototype.description=function(){return""},ED.RightCoronaryArtery=function(a,b){this.className="RightCoronaryArtery",ED.Doodle.call(this,a,b)},ED.RightCoronaryArtery.prototype=new ED.Doodle,ED.RightCoronaryArtery.prototype.constructor=ED.RightCoronaryArtery,ED.RightCoronaryArtery.superclass=ED.Doodle.prototype,ED.RightCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RightCoronaryArtery.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.RightCoronaryArtery.prototype.setParameterDefaults=function(){this.originX=24,this.originY=2,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.RightCoronaryArtery.prototype.draw=function(a){var b=this.drawing.context;ED.RightCoronaryArtery.superclass.draw.call(this,a);var c=0,d=2*Math.PI;return b.beginPath(),b.arc(0,0,400,c,d,!0),b.lineWidth=1,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-254,-66),b.bezierCurveTo(-379,8,-313,171,-289,204),b.bezierCurveTo(-245,265,-184,266,-151,252),b.bezierCurveTo(-144,261,-94,311,-94,311),b.moveTo(-244,-58),b.bezierCurveTo(-364,-23,-327,263,-173,247),b.bezierCurveTo(-138,243,-88,191,-36,242),b.bezierCurveTo(-15,261,-9,276,-9,276),b.moveTo(-54,292),b.bezierCurveTo(-54,292,-103,238,-110,234),b.bezierCurveTo(-125,237,-142,247,-142,247),b.moveTo(-82,306),b.lineTo(-142,247),b.moveTo(-42,286),b.lineTo(-96,232),b.bezierCurveTo(-84,218,-36,250,-24,276),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(100, 100, 100, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RightCoronaryArtery.prototype.description=function(){return""},ED.LeftCoronaryArtery=function(a,b){this.className="LeftCoronaryArtery",ED.Doodle.call(this,a,b)},ED.LeftCoronaryArtery.prototype=new ED.Doodle,ED.LeftCoronaryArtery.prototype.constructor=ED.LeftCoronaryArtery,ED.LeftCoronaryArtery.superclass=ED.Doodle.prototype,ED.LeftCoronaryArtery.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.LeftCoronaryArtery.prototype.setPropertyDefaults=function(){this.isDeletable=!1},ED.LeftCoronaryArtery.prototype.setParameterDefaults=function(){this.originY=0,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-153,this.apexY=-84},ED.LeftCoronaryArtery.prototype.draw=function(a){var b=this.drawing.context;ED.LeftCoronaryArtery.superclass.draw.call(this,a);var c=0,d=2*Math.PI;return b.beginPath(),b.arc(-100,-50,100,c,d,!0),b.lineWidth=1,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(this.apexX,this.apexY),b.bezierCurveTo(-165,-48,-94,-52,-37,-58),b.bezierCurveTo(20,-63,40,-34,102,-34),b.bezierCurveTo(119,-34,135,-36,135,-36),b.moveTo(68,136),b.bezierCurveTo(50,130,23,124,14,110),b.bezierCurveTo(2,92,-2,66,-7,39),b.bezierCurveTo(-11,23,-24,-5,-35,-26),b.bezierCurveTo(-50,-55,41,-34,42,-8),b.bezierCurveTo(45,25,39,41,39,41),b.moveTo(200,257),b.bezierCurveTo(223,258,289,267,311,253),b.bezierCurveTo(331,240,314,208,304,193),b.bezierCurveTo(282,155,246,114,224,90),b.moveTo(67,143),b.bezierCurveTo(67,143,42,138,16,129),b.bezierCurveTo(21,144,26,171,40,185),b.bezierCurveTo(63,208,102,210,102,210),b.moveTo(103,218),b.bezierCurveTo(103,218,55,208,39,202),b.bezierCurveTo(49,273,165,280,165,280),b.moveTo(195,136),b.bezierCurveTo(195,136,197,101,196,86),b.bezierCurveTo(214,97,232,110,243,130),b.bezierCurveTo(249,142,247,180,247,180),b.moveTo(164,284),b.bezierCurveTo(164,284,101,286,55,253),b.bezierCurveTo(35,238,24,200,16,175),b.lineTo(-6,94),b.moveTo(221,80),b.moveTo(135,-33),b.bezierCurveTo(135,-33,104,-23,71,-28),b.bezierCurveTo(110,-7,147,18,182,48),b.bezierCurveTo(193,57,205,73,215,77),b.bezierCurveTo(226,81,241,81,253,83),b.moveTo(190,133),b.bezierCurveTo(190,133,191,87,178,68),b.bezierCurveTo(165,49,96,11,96,11),b.moveTo(-4,98),b.bezierCurveTo(-10,136,-10,136,-22,156),b.moveTo(58,-10),b.bezierCurveTo(62,18,62,18,54,42),b.moveTo(102,10),b.bezierCurveTo(106,38,106,38,102,56),b.moveTo(222,90),b.bezierCurveTo(242,92,242,92,258,94),b.moveTo(258,142),b.bezierCurveTo(340,264,316,250,204,244),b.moveTo(258,142),b.bezierCurveTo(264,164,264,164,260,176),b.moveTo(54,-12),b.bezierCurveTo(54,-12,77,-4,84,7),b.bezierCurveTo(94,24,89,57,89,57),b.moveTo(-38,158),b.bezierCurveTo(-38,158,17,81,-58,-42),this.apexX>-200?b.bezierCurveTo(-152,-40,-146,-27,this.apexX-20,this.apexY):b.bezierCurveTo(-152,-40,-146,-27,this.apexX-8,this.apexY+15),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(100, 100, 100, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LeftCoronaryArtery.prototype.description=function(){return this.apexX<-200?"Anomalous insertion of left coronary artery":""},ED.AnomalousVessels=function(a,b){this.className="AnomalousVessels",ED.Doodle.call(this,a,b)},ED.AnomalousVessels.prototype=new ED.Doodle,ED.AnomalousVessels.prototype.constructor=ED.AnomalousVessels,ED.AnomalousVessels.superclass=ED.Doodle.prototype,ED.AnomalousVessels.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AnomalousVessels.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.AnomalousVessels.prototype.setParameterDefaults=function(){this.originY=-100,this.scaleX=1.5,this.scaleY=1.5,this.apexX=-460,this.apexY=-460},ED.AnomalousVessels.prototype.draw=function(a){var b=this.drawing.context;ED.AnomalousVessels.superclass.draw.call(this,a);var c=0,d=2*Math.PI;return b.beginPath(),b.arc(0,0,400,c,d,!0),b.lineWidth=1,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(68,136),b.bezierCurveTo(50,130,23,124,14,110),b.bezierCurveTo(2,92,-2,66,-7,39),b.bezierCurveTo(-11,23,-24,-5,-35,-26),b.bezierCurveTo(-50,-55,41,-34,42,-8),b.bezierCurveTo(45,25,39,41,39,41),b.moveTo(200,257),b.bezierCurveTo(223,258,289,267,311,253),b.bezierCurveTo(331,240,314,208,304,193),b.bezierCurveTo(282,155,246,114,224,90),b.lineTo(254,89),b.moveTo(-6,94),b.bezierCurveTo(-8,113,-11,132,-33,164),b.moveTo(67,143),b.bezierCurveTo(67,143,42,138,16,129),b.bezierCurveTo(21,144,26,171,40,185),b.bezierCurveTo(63,208,102,210,102,210),b.moveTo(103,218),b.bezierCurveTo(103,218,55,208,39,202),b.bezierCurveTo(49,273,165,280,165,280),b.moveTo(-54,292),b.bezierCurveTo(-54,292,-103,238,-110,234),b.bezierCurveTo(-125,237,-142,247,-142,247),b.lineTo(-91,307),b.moveTo(195,136),b.bezierCurveTo(195,136,197,101,196,86),b.bezierCurveTo(214,97,232,110,243,130),b.bezierCurveTo(249,142,247,180,247,180),b.moveTo(164,284),b.bezierCurveTo(164,284,101,286,55,253),b.bezierCurveTo(35,238,24,200,16,175),b.lineTo(-6,94),b.moveTo(221,80),b.moveTo(257,151),b.bezierCurveTo(257,151,278,176,288,190),b.bezierCurveTo(297,204,312,227,304,240),b.bezierCurveTo(291,264,223,250,200,250),b.moveTo(-14,278),b.bezierCurveTo(-14,278,-49,217,-98,230),b.moveTo(135,-33),b.bezierCurveTo(135,-33,104,-23,71,-28),b.bezierCurveTo(110,-7,147,18,182,48),b.bezierCurveTo(193,57,205,73,215,77),b.bezierCurveTo(226,81,241,81,253,83),b.moveTo(190,133),b.bezierCurveTo(190,133,191,87,178,68),b.bezierCurveTo(165,49,96,11,96,11),b.moveTo(54,-12),b.bezierCurveTo(54,-12,77,-4,84,7),b.bezierCurveTo(94,24,89,57,89,57),b.moveTo(-210,-104),b.bezierCurveTo(-253,-100,-259,-73,-254,-66),b.bezierCurveTo(-379,8,-313,171,-289,204),b.bezierCurveTo(-245,265,-184,266,-151,252),b.bezierCurveTo(-144,261,-94,311,-94,311),b.moveTo(-38,158),b.bezierCurveTo(-38,158,17,81,-58,-42),b.bezierCurveTo(-152,-40,-206,-27,-238,-56),b.moveTo(-244,-58),b.bezierCurveTo(-364,-23,-327,263,-173,247),b.bezierCurveTo(-138,243,-88,191,-36,242),b.bezierCurveTo(-15,261,-9,276,-9,276),b.moveTo(-210,-94),b.bezierCurveTo(-277,-82,-206,-47,-186,-48),b.bezierCurveTo(-165,-48,-94,-52,-37,-58),b.bezierCurveTo(20,-63,40,-34,102,-34),b.bezierCurveTo(119,-34,135,-36,135,-36),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AnomalousVessels.prototype.description=function(){return"AnomalousVessels"},ED.Bypass=function(a,b){this.className="Bypass",ED.Doodle.call(this,a,b)},ED.Bypass.prototype=new ED.Doodle,ED.Bypass.prototype.constructor=ED.Bypass,ED.Bypass.superclass=ED.Doodle.prototype,ED.Bypass.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Bypass.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Bypass.prototype.setParameterDefaults=function(){var a=this.drawing.numberOfDoodlesOfClass(this.className);0==a?(this.apexX=40,this.apexY=-60):1==a?(this.apexX=-11,this.apexY=133):(this.apexX=-445,this.apexY=205)},ED.Bypass.prototype.draw=function(a){var b=this.drawing.context;ED.Bypass.superclass.draw.call(this,a),b.beginPath();var c=new ED.Point(-320,-200),d=new ED.Point(this.apexX,this.apexY),e=c.distanceTo(d),f=20,g=Math.PI/8;b.moveTo(c.x,c.y);var h=Math.atan((d.y-c.y)/(d.x-c.x));0>h&&(h=Math.PI/2+(Math.PI/2+h));var i=new ED.Point(0,0);i.setWithPolars(f,h);var j=new ED.Point(0,0);j.setWithPolars(e/2,h+Math.PI/2-g);var k=new ED.Point(i.x+d.x,i.y+d.y),l=new ED.Point(0,0);l.setWithPolars(f,h+Math.PI);var m=new ED.Point(l.x+d.x,l.y+d.y);return b.lineTo(c.x+i.x,c.y+i.y),b.bezierCurveTo(c.x+i.x+j.x,c.y+i.y+j.y,c.x+i.x+j.x,c.y+i.y+j.y,k.x,k.y),b.lineTo(d.x,d.y),b.lineTo(m.x,m.y),b.bezierCurveTo(c.x+l.x+j.x,c.y+l.y+j.y,c.x+l.x+j.x,c.y+l.y+j.y,c.x+l.x,c.y+l.y),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 000, 000, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.Bypass.prototype.description=function(){var a="";return a=this.apexX>0?"left coronary artery":this.apexX>-300?"circumflex artery":"right coronary artery","Bypass graft to "+a},ED.MetalStent=function(a,b){this.className="MetalStent",ED.Doodle.call(this,a,b)},ED.MetalStent.prototype=new ED.Doodle,ED.MetalStent.prototype.constructor=ED.MetalStent,ED.MetalStent.superclass=ED.Doodle.prototype,ED.MetalStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.MetalStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.MetalStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.MetalStent.prototype.draw=function(a){console.log(this.originX,this.originY,this.rotation);var b=this.drawing.context;ED.MetalStent.superclass.draw.call(this,a);var c=50,d=10,e=10;if(b.beginPath(),b.rect(-c,-d,2*c,2*d),b.lineWidth=4,b.strokeStyle="blue",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();for(var f=0;10>f;f++)b.moveTo(-c+f*e,-d),b.lineTo(-c+f*e,+d);b.stroke()}var g=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(g),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MetalStent.prototype.description=function(){var a;return a=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+a},ED.DrugStent=function(a,b){this.className="DrugStent",ED.Doodle.call(this,a,b)},ED.DrugStent.prototype=new ED.Doodle,ED.DrugStent.prototype.constructor=ED.DrugStent,ED.DrugStent.superclass=ED.Doodle.prototype,ED.DrugStent.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.DrugStent.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.DrugStent.prototype.setParameterDefaults=function(){this.originX=-18,this.originY=86,this.rotation=-4.985446531081719},ED.DrugStent.prototype.draw=function(a){console.log(this.originX,this.originY,this.rotation);var b=this.drawing.context;ED.DrugStent.superclass.draw.call(this,a);var c=50,d=10,e=20;if(b.beginPath(),b.rect(-c,-d,2*c,2*d),b.lineWidth=4,b.strokeStyle="blue",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();for(var f=0;5>f;f++)b.moveTo(-c+f*e,-d),b.lineTo(-c+(f+1)*e,+d),b.moveTo(-c+(f+1)*e,-d),b.lineTo(-c+f*e,+d);b.stroke()}var g=new ED.Point(-50,-10);return this.handleArray[2].location=this.transform.transformPoint(g),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.DrugStent.prototype.description=function(){var a;return a=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery","Metal stent in "+a},ED.Stenosis=function(a,b){this.className="Stenosis",this.degree=0,this.type="Calcified",ED.Doodle.call(this,a,b)},ED.Stenosis.prototype=new ED.Doodle,ED.Stenosis.prototype.constructor=ED.Stenosis,ED.Stenosis.superclass=ED.Doodle.prototype,ED.Stenosis.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Stenosis.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-10,10),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0),this.parameterValidationArray.degree={kind:"derived",type:"int",range:new ED.Range(0,100),precision:0,animate:!0},this.parameterValidationArray.type={kind:"derived",type:"string",list:["Calcified","Non-calcified"],animate:!0}},ED.Stenosis.prototype.setParameterDefaults=function(){this.setParameterFromString("degree","0"),this.setParameterFromString("type","Calcified"),this.apexX=0,this.apexY=0,this.originX=-373,this.originY=323},ED.Stenosis.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexX":c.type=b>0?"Calcified":"Non-calcified";break;case"apexY":c.degree=b/-1;break;case"type":c.apexX="Calcified"==b?10:-10;break;case"degree":c.apexY=-1*b}return c},ED.Stenosis.prototype.draw=function(a){var b=this.drawing.context;ED.Stenosis.superclass.draw.call(this,a);return b.beginPath(),b.arc(0,0,30,0,2*Math.PI,!1),b.lineWidth=2,b.strokeStyle="blue",b.fillStyle="rgba(155, 155, 0,"+this.apexY/-100+")",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&"Calcified"==this.type&&(b.beginPath(),b.arc(-10,-10,8,0,2*Math.PI,!1),b.moveTo(10,-10),b.arc(10,-10,8,0,2*Math.PI,!1),b.moveTo(10,10),b.arc(10,10,8,0,2*Math.PI,!1),b.moveTo(-10,10),b.arc(-10,10,8,0,2*Math.PI,!1),b.fillStyle="white",b.fill()),point=new ED.Point(this.apexX,this.apexY),this.handleArray[4].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Stenosis.prototype.description=function(){var a;return a=this.originX>0?"left coronary artery":this.originX>-300?"circumflex artery":"right coronary artery",this.degree.toString()+"% "+this.type+" stenosis in the "+a},ED.Groin=function(a,b){this.className="Groin",ED.Doodle.call(this,a,b)},ED.Groin.prototype=new ED.Doodle,ED.Groin.prototype.constructor=ED.Groin,ED.Groin.superclass=ED.Doodle.prototype,ED.Groin.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Groin.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400)},ED.Groin.prototype.setParameterDefaults=function(){},ED.Groin.prototype.draw=function(a){var b=this.drawing.context;ED.Groin.superclass.draw.call(this,a);2*Math.PI;return b.beginPath(),b.moveTo(12,49),b.bezierCurveTo(37,49,68,24,68,24),b.bezierCurveTo(73,42,136,318,136,318),b.lineTo(460,318),b.bezierCurveTo(460,318,468,191,468,159),b.bezierCurveTo(468,127,451,-48,451,-67),b.bezierCurveTo(451,-87,444,-188,444,-215),b.bezierCurveTo(444,-242,407,-402,407,-402),b.lineTo(-380,-402),b.bezierCurveTo(-380,-402,-417,-242,-417,-215),b.bezierCurveTo(-417,-189,-423,-87,-423,-67),b.bezierCurveTo(-423,-48,-440,127,-440,159),b.bezierCurveTo(-440,191,-432,318,-432,318),b.lineTo(-112,318),b.lineTo(-40,24),b.bezierCurveTo(-27,39,-10,49,15,49),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 175, 175, 0.5)",b.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-228,-189),b.lineTo(-158,-155),b.bezierCurveTo(-158,-155,-109,-113,-88,-75),b.bezierCurveTo(-74,-51,-65,-5,-40,24),b.moveTo(255,-189),b.lineTo(186,-155),b.bezierCurveTo(186,-155,136,-113,115,-75),b.bezierCurveTo(102,-51,92,-5,68,23),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(100, 100, 100, 1)",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked
},ED.Groin.prototype.description=function(){return"Groin"},ED.Haematoma=function(a,b){this.className="Haematoma",ED.Doodle.call(this,a,b)},ED.Haematoma.prototype=new ED.Doodle,ED.Haematoma.prototype.constructor=ED.Haematoma,ED.Haematoma.superclass=ED.Doodle.prototype,ED.Haematoma.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Haematoma.prototype.setParameterDefaults=function(){this.originX=-150},ED.Haematoma.prototype.draw=function(a){var b=this.drawing.context;ED.Haematoma.superclass.draw.call(this,a);var c=30;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="red",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Haematoma.prototype.groupDescription=function(){return"Haematoma"},ED.Bruising=function(a,b){this.className="Bruising",ED.Doodle.call(this,a,b)},ED.Bruising.prototype=new ED.Doodle,ED.Bruising.prototype.constructor=ED.Bruising,ED.Bruising.superclass=ED.Doodle.prototype,ED.Bruising.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Bruising.prototype.setParameterDefaults=function(){this.originX=-190,this.originY=100,this.scaleY=2},ED.Bruising.prototype.setPropertyDefaults=function(){this.isSqueezable=!0},ED.Bruising.prototype.draw=function(a){var b=this.drawing.context;ED.Bruising.superclass.draw.call(this,a);var c=100;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="rgba(127, 0, 127, 0.5)",b.fillStyle="rgba(127, 0, 127, 0.5)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Bruising.prototype.description=function(){return"Bruising"},ED.Bruit=function(a,b){this.className="Bruit",ED.Doodle.call(this,a,b)},ED.Bruit.prototype=new ED.Doodle,ED.Bruit.prototype.constructor=ED.Bruit,ED.Bruit.superclass=ED.Doodle.prototype,ED.Bruit.prototype.setHandles=function(){},ED.Bruit.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.Bruit.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.originX=-150,this.originY=-62},ED.Bruit.prototype.draw=function(a){var b=this.drawing.context;ED.Bruit.superclass.draw.call(this,a);var c=100;b.beginPath(),b.arc(0,-50,c,0,2*Math.PI,!0),b.lineWidth=2,b.strokeStyle="rgba(155, 255, 255, 0)",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.fillStyle="gray",b.strokeStyle="gray",b.lineWidth=8,b.beginPath(),b.arc(-50,0,20,0,2*Math.PI,!1),b.fill(),b.beginPath(),b.moveTo(-34,0),b.lineTo(-34,-100),b.lineTo(0,-80),b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Bruit.prototype.description=function(){return"Bruit"},ED.Crepitations=function(a,b){this.className="Crepitations",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,a,b)},ED.Crepitations.prototype=new ED.Doodle,ED.Crepitations.prototype.constructor=ED.Crepitations,ED.Crepitations.superclass=ED.Doodle.prototype,ED.Crepitations.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Crepitations.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,200),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.Crepitations.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/4,this.apexX=50,this.apexY=0,this.setOriginWithDisplacements(-150,300)},ED.Crepitations.prototype.draw=function(a){var b=this.drawing.context;ED.Crepitations.superclass.draw.call(this,a);var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=3,b.strokeStyle="rgba(255, 255, 255, 0)",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var d=30;b.moveTo(-c,0),b.lineTo(c,0);for(var e=-1;2>e;e+=2)for(var f=d;c>f;f+=d){var g=this.xForY(c,f);b.moveTo(-g,e*f),b.lineTo(g,e*f)}b.lineWidth=15,b.lineCap="round",b.strokeStyle="rgba(200, 200, 200, 0.75)",b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Crepitations.prototype.description=function(){var a=this.originX>0?" left lung":" right lung",b=this.originY>0?" lower lobe of":" upper lobe of";return"crepitations"+b+a},ED.Effusion=function(a,b){this.className="Effusion",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,a,b)},ED.Effusion.prototype=new ED.Doodle,ED.Effusion.prototype.constructor=ED.Effusion,ED.Effusion.superclass=ED.Doodle.prototype,ED.Effusion.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Effusion.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.Effusion.prototype.setParameterDefaults=function(){this.apexX=-231,this.apexY=136},ED.Effusion.prototype.draw=function(a){var b=this.drawing.context;return ED.Effusion.superclass.draw.call(this,a),b.beginPath(),b.moveTo(this.apexX,this.apexY),b.lineTo(-400+(-136+this.apexY)*-.3,this.apexY),b.lineTo(-426,289),b.bezierCurveTo(-334,226,-219,196,-79,236),b.lineTo(-44,this.apexY),b.lineTo(this.apexX,this.apexY),b.closePath(),b.lineWidth=4,b.fillStyle="yellow",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Effusion.prototype.description=function(){return"pleural effusion in right lung"},ED.Lungs=function(a,b){this.className="Lungs",ED.Doodle.call(this,a,b)},ED.Lungs.prototype=new ED.Doodle,ED.Lungs.prototype.constructor=ED.Lungs,ED.Lungs.superclass=ED.Doodle.prototype,ED.Lungs.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1},ED.Lungs.prototype.draw=function(a){var b=this.drawing.context;return ED.Lungs.superclass.draw.call(this,a),b.beginPath(),b.moveTo(-147,-281),b.bezierCurveTo(-224,-279,-414,29,-426,289),b.bezierCurveTo(-334,226,-219,196,-79,236),b.bezierCurveTo(-6,231,-71,-284,-147,-281),b.moveTo(147,-281),b.bezierCurveTo(224,-279,414,29,426,289),b.bezierCurveTo(334,226,219,196,79,236),b.bezierCurveTo(6,231,71,-284,147,-281),b.closePath(),b.lineWidth=4,b.fillStyle="white",b.strokeStyle="gray",this.drawBoundary(a),this.isClicked},ED.Lungs.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.Wheeze=function(a,b){this.className="Wheeze",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.Wheeze.prototype=new ED.Doodle,ED.Wheeze.prototype.constructor=ED.Wheeze,ED.Wheeze.superclass=ED.Doodle.prototype,ED.Wheeze.prototype.setParameterDefaults=function(){this.scaleX=.6,this.scaleY=.6,this.setOriginWithDisplacements(-200,100)},ED.Wheeze.prototype.draw=function(a){var b=this.drawing.context;ED.Wheeze.superclass.draw.call(this,a);var c=100;return b.beginPath(),b.arc(0,-50,c,0,2*Math.PI,!0),b.lineWidth=2,b.strokeStyle="rgba(255, 255, 255, 0)",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.fillStyle="gray",b.strokeStyle="gray",b.lineWidth=8,b.beginPath(),b.arc(-50,0,20,0,2*Math.PI,!1),b.fill(),b.beginPath(),b.moveTo(-34,0),b.lineTo(-34,-100),b.lineTo(66,-150),b.lineTo(66,-50),b.stroke(),b.beginPath(),b.arc(50,-50,20,0,2*Math.PI,!1),b.fill(),b.closePath(),b.fillStyle="gray",b.fill()),this.isClicked},ED.Wheeze.prototype.description=function(){var a=this.originX>0?" left lung":" right lung",b=this.originY>0?" lower lobe of":" upper lobe of";return"wheeze"+b+a},ED.EarDrum=function(a,b){this.className="EarDrum",ED.Doodle.call(this,a,b)},ED.EarDrum.prototype=new ED.Doodle,ED.EarDrum.prototype.constructor=ED.EarDrum,ED.EarDrum.superclass=ED.Doodle.prototype,ED.EarDrum.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.EarDrum.prototype.setParameterDefaults=function(){},ED.EarDrum.prototype.draw=function(a){var b=this.drawing.context;return ED.EarDrum.superclass.draw.call(this,a),b.beginPath(),b.moveTo(-319,-94),b.bezierCurveTo(-321,-68,-330,81,-278,194),b.bezierCurveTo(-247,261,-175,336,-105,371),b.bezierCurveTo(-58,395,-5,397,46,395),b.bezierCurveTo(166,390,231,294,236,287),b.bezierCurveTo(301,194,347,8,322,-133),b.bezierCurveTo(304,-234,284,-259,251,-302),b.bezierCurveTo(191,-383,69,-373,15,-373),b.bezierCurveTo(-10,-373,-23,-393,-61,-390),b.bezierCurveTo(-93,-388,-107,-366,-141,-352),b.bezierCurveTo(-167,-337,-194,-345,-211,-330),b.bezierCurveTo(-229,-313,-236,-289,-254,-253),b.bezierCurveTo(-271,-218,-308,-152,-319,-94),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(245,224,173,0.5)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.fillStyle="rgba(255,255,255,0",b.beginPath(),b.moveTo(-237,-255),b.bezierCurveTo(-224,-269,-198,-270,-175,-272),b.bezierCurveTo(-151,-274,-127,-268,-92,-279),b.bezierCurveTo(-58,-290,-44,-303,-31,-314),b.bezierCurveTo(-18,-325,-4,-339,30,-348),b.stroke(),b.beginPath(),b.moveTo(328,-14),b.bezierCurveTo(334,-136,269,-283,204,-320),b.bezierCurveTo(139,-357,94,-347,47,-339),b.bezierCurveTo(17,-332,-5,-304,-25,-291),b.bezierCurveTo(-46,-278,-71,-268,-86,-255),b.bezierCurveTo(-102,-242,-102,-227,-107,-212),b.bezierCurveTo(-112,-200,-115,-200,-128,-200),b.bezierCurveTo(-143,-201,-143,-202,-152,-212),b.bezierCurveTo(-162,-223,-156,-244,-169,-248),b.bezierCurveTo(-182,-251,-204,-246,-204,-246),b.bezierCurveTo(-259,-227,-321,-138,-321,-63),b.stroke(),b.beginPath(),b.moveTo(-207,-282),b.bezierCurveTo(-179,-279,-164,-280,-143,-292),b.moveTo(-207,-292),b.bezierCurveTo(-197,-289,-181,-290,-165,-295),b.moveTo(-201,-302),b.bezierCurveTo(-193,-299,-182,-302,-174,-305),b.moveTo(-96,-345),b.bezierCurveTo(-88,-351,-87,-352,-82,-363),b.moveTo(-92,-335),b.bezierCurveTo(-83,-341,-75,-349,-70,-359),b.moveTo(-92,-321),b.bezierCurveTo(-76,-330,-65,-345,-58,-359),b.moveTo(-87,-308),b.bezierCurveTo(-71,-317,-50,-339,-44,-354),b.moveTo(-87,-297),b.bezierCurveTo(-70,-308,-45,-327,-33,-348),b.moveTo(-82,-290),b.bezierCurveTo(-62,-301,-33,-324,-18,-348),b.stroke(),b.beginPath(),b.moveTo(-204,-246),b.bezierCurveTo(-189,-199,-146,-200,-123,-195),b.bezierCurveTo(-99,-189,-91,-152,-92,-120),b.bezierCurveTo(-92,-88,-100,-58,-92,-21),b.bezierCurveTo(-83,16,-55,40,-47,64),b.bezierCurveTo(-40,87,-53,99,-44,117),b.bezierCurveTo(-38,128,-38,135,-18,137),b.bezierCurveTo(1,140,2,131,7,120),b.bezierCurveTo(16,99,16,86,10,63),b.bezierCurveTo(4,40,-20,8,-27,-66),b.bezierCurveTo(-33,-129,-17,-167,-3,-223),b.bezierCurveTo(12,-278,58,-321,99,-345),b.setLineDash([10]),b.stroke(),b.beginPath(),b.moveTo(56,-315),b.bezierCurveTo(56,-315,68,-321,84,-308),b.bezierCurveTo(100,-296,126,-182,137,-158),b.bezierCurveTo(148,-135,143,-130,159,-130),b.bezierCurveTo(175,-130,183,-136,185,-162),b.bezierCurveTo(187,-188,169,-293,151,-340),b.setLineDash([10]),b.stroke(),b.beginPath(),b.moveTo(-165,230),b.lineTo(-44,117),b.moveTo(-63,356),b.lineTo(-1,138),b.setLineDash([30,10]),b.stroke()),this.isClicked},ED.Grommet=function(a,b){this.className="Grommet",this.type="Short term",this.savedParameterArray=["originX","originY","scaleX","scaleY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,a,b)},ED.Grommet.prototype=new ED.Doodle,ED.Grommet.prototype.constructor=ED.Grommet,ED.Grommet.superclass=ED.Doodle.prototype,ED.Grommet.prototype.setHandles=function(){},ED.Grommet.prototype.setPropertyDefaults=function(){this.parameterValidationArray.type={kind:"derived",type:"string",list:["Short term","Long term"],animate:!0}},ED.Grommet.prototype.setParameterDefaults=function(){var a=100;this.originX=a,this.originY=a},ED.Grommet.prototype.draw=function(a){var b=this.drawing.context;ED.Grommet.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,40,0,2*Math.PI,!0),b.closePath(),b.lineWidth=32,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle="white",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a);var c=this.transform.transformPoint(new ED.Point(0,0)),d=this.transform.transformPoint(new ED.Point(60,0)),e=c.x-this.drawing.canvas.width/2,f=c.y-this.drawing.canvas.height/2,g=this.scaleX*Math.sqrt(e*e+f*f),h=this.scaleX*(d.x-c.x);return this.arc=Math.atan(h/g),this.isClicked},ED.Grommet.prototype.description=function(){return"Grommet"},ED.Perforation=function(a,b){this.className="Perforation",this.margin=3e4,this.isMarginal=!1,this.safe=!0,this.savedParameterArray=["originX","originY","scaleX","scaleY","safe"],this.controlParameterArray={safe:"Safe"},ED.Doodle.call(this,a,b)},ED.Perforation.prototype=new ED.Doodle,ED.Perforation.prototype.constructor=ED.Perforation,ED.Perforation.superclass=ED.Doodle.prototype,ED.Perforation.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Perforation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-300,300),this.parameterValidationArray.originY.range.setMinAndMax(-300,300),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2),this.parameterValidationArray.isMarginal={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.safe={kind:"derived",type:"bool",display:!0}},ED.Perforation.prototype.setParameterDefaults=function(){this.scaleX=.5,this.scaleY=.75,this.setOriginWithDisplacements(-100,25)},ED.Perforation.prototype.dependentParameterValues=function(a){var b=new Array;switch(a){case"originX":b.isMarginal=this.originX*this.originX+this.originY*this.originY>this.margin?!0:!1;break;case"originY":b.isMarginal=this.originX*this.originX+this.originY*this.originY>this.margin?!0:!1}return b},ED.Perforation.prototype.draw=function(a){var b=this.drawing.context;ED.Perforation.superclass.draw.call(this,a),b.beginPath();var c=120;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath(),b.lineWidth=3,b.fillStyle="rgba(255, 155, 110, 1)",b.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Perforation.prototype.description=function(){var a="";return a=this.originX<=0?"Antero":"Postero",a+=this.originY<=0?"superior":"inferior",a+=" perforation of eardrum"},ED.Perforation.prototype.snomedCode=function(){return this.isMarginal?39895008:40723007},ED.Perforation.prototype.diagnosticHierarchy=function(){return 3},ED.ACIOL=function(a,b){this.className="ACIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,a,b),this.scaleX=.8,this.scaleY=.8},ED.ACIOL.prototype=new ED.Doodle,ED.ACIOL.prototype.constructor=ED.ACIOL,ED.ACIOL.superclass=ED.Doodle.prototype,ED.ACIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ACIOL.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isUnique=!0},ED.ACIOL.prototype.draw=function(a){var b=this.drawing.context;ED.ACIOL.superclass.draw.call(this,a),b.beginPath();var c=240;b.arc(0,0,c,0,2*Math.PI,!1),b.moveTo(150,-190),b.bezierCurveTo(160,-200,170,-210,160,-230),b.bezierCurveTo(150,-250,100,-280,50,-290),b.bezierCurveTo(0,-300,-220,-330,-230,-340),b.bezierCurveTo(-250,-360,-220,-420,-200,-430),b.bezierCurveTo(-180,-440,-180,-440,-150,-450),b.bezierCurveTo(-120,-460,-130,-430,-120,-420),b.bezierCurveTo(-110,-410,110,-410,120,-420),b.bezierCurveTo(130,-430,120,-460,150,-450),b.bezierCurveTo(180,-440,180,-440,200,-430),b.bezierCurveTo(220,-420,180,-400,150,-390),b.bezierCurveTo(120,-380,-120,-380,-150,-390),b.bezierCurveTo(-180,-400,-190,-370,-170,-360),b.bezierCurveTo(-150,-350,20,-330,70,-320),b.bezierCurveTo(120,-310,190,-280,210,-250),b.bezierCurveTo(230,-220,220,-140,220,-100),b.moveTo(-150,190),b.bezierCurveTo(-160,200,-170,210,-160,230),b.bezierCurveTo(-150,250,-100,280,-50,290),b.bezierCurveTo(0,300,220,330,230,340),b.bezierCurveTo(250,360,220,420,200,430),b.bezierCurveTo(180,440,180,440,150,450),b.bezierCurveTo(120,460,130,430,120,420),b.bezierCurveTo(110,410,-110,410,-120,420),b.bezierCurveTo(-130,430,-120,460,-150,450),b.bezierCurveTo(-180,440,-180,440,-200,430),b.bezierCurveTo(-220,420,-180,400,-150,390),b.bezierCurveTo(-120,380,120,380,150,390),b.bezierCurveTo(180,400,190,370,170,360),b.bezierCurveTo(150,350,-20,330,-70,320),b.bezierCurveTo(-120,310,-190,280,-210,250),b.bezierCurveTo(-230,220,-220,140,-220,100),b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ACIOL.prototype.description=function(){var a="Anterior chamber IOL",b=40,c="";return this.originY<-b&&(c.length>0&&(c+=" and"),c+=" superiorly"),this.originY>b&&(c.length>0&&(c+=" and"),c+=" inferiorly"),this.originX<-b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),c.length>0&&(a+=" displaced"+c),a},ED.ACMaintainer=function(a,b){this.className="ACMaintainer",this.limbus=-400,this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.ACMaintainer.prototype=new ED.Doodle,ED.ACMaintainer.prototype.constructor=ED.ACMaintainer,ED.ACMaintainer.superclass=ED.Doodle.prototype,ED.ACMaintainer.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ACMaintainer.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90);var a=this.drawing.lastDoodleOfClass("SidePort");a&&(this.rotation=a.rotation)},ED.ACMaintainer.prototype.draw=function(a){var b=this.drawing.context;return ED.ACMaintainer.superclass.draw.call(this,a),b.beginPath(),b.rect(-60,this.limbus-60,120,160),b.lineWidth=2,b.strokeStyle="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-20,this.limbus+60),b.lineTo(20,this.limbus+60),b.lineTo(20,this.limbus+160),b.lineTo(-20,this.limbus+200),b.lineTo(-20,this.limbus+60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-30,this.limbus,60,80),b.fillStyle="rgba(120, 120, 120, 0.75)",b.fill(),b.beginPath(),b.moveTo(0,this.limbus),b.bezierCurveTo(0,this.limbus-50,50,this.limbus-100,100,this.limbus-100),b.lineWidth=40,b.strokeStyle="rgba(120, 120, 120, 0.5)",b.stroke()),this.isClicked},ED.ACMaintainer.prototype.groupDescription=function(){return"Chandelier at "},ED.ACMaintainer.prototype.description=function(){return this.clockHour()+" o'clock"},ED.AngleGradeEast=function(a,b){this.className="AngleGradeEast",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b),this.arc=90*Math.PI/180,this.rotation=Math.PI/2},ED.AngleGradeEast.prototype=new ED.Doodle,ED.AngleGradeEast.prototype.constructor=ED.AngleGradeEast,ED.AngleGradeEast.superclass=ED.Doodle.prototype,ED.AngleGradeEast.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeEast.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeEast.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeEast.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":var d="4";-b>=this.riro&&(d="3"),-b>=this.rcbo&&(d="2"),-b>=this.rtmo&&(d="1"),-b>=this.rsli&&(d="0"),c.grade=d,c.seen=-b>=this.rtmo?"No":"Yes";break;case"grade":var d="";switch(b){case"0":d=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":d=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":d=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":d=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":d=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}c.apexY=d;break;case"seen":var d="";switch(b){case"No":d=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":d=-this.apexY<this.rtmo?this.apexY:-this.riri}c.apexY=d}return c},ED.AngleGradeEast.prototype.draw=function(a){var b=this.drawing.context;ED.AngleGradeEast.superclass.draw.call(this,a);var c=this.arc/2,d=-Math.PI/2+c,e=-Math.PI/2-c;return b.beginPath(),b.arc(0,0,-this.apexY,d,e,!0),b.arc(0,0,this.rpu,e,d,!1),b.closePath(),b.fillStyle="rgba(100, 200, 250, 1.0)",b.strokeStyle="rgba(100, 100, 100, 1.0)",b.lineWidth=4,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleGradeNorth=function(a,b){this.className="AngleGradeNorth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b),this.arc=90*Math.PI/180,this.rotation=0},ED.AngleGradeNorth.prototype=new ED.Doodle,ED.AngleGradeNorth.prototype.constructor=ED.AngleGradeNorth,ED.AngleGradeNorth.superclass=ED.Doodle.prototype,ED.AngleGradeNorth.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeNorth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeNorth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeNorth.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":var d="4";-b>=this.riro&&(d="3"),-b>=this.rcbo&&(d="2"),-b>=this.rtmo&&(d="1"),-b>=this.rsli&&(d="0"),c.grade=d,c.seen=-b>=this.rtmo?"No":"Yes";break;case"grade":var d="";switch(b){case"0":d=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":d=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":d=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":d=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":d=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}c.apexY=d;break;case"seen":var d="";switch(b){case"No":d=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":d=-this.apexY<this.rtmo?this.apexY:-this.riri}c.apexY=d}return c},ED.AngleGradeNorth.prototype.draw=function(a){var b=this.drawing.context;ED.AngleGradeNorth.superclass.draw.call(this,a);var c=this.arc/2,d=-Math.PI/2+c,e=-Math.PI/2-c;return b.beginPath(),b.arc(0,0,-this.apexY,d,e,!0),b.arc(0,0,this.rpu,e,d,!1),b.closePath(),b.fillStyle="rgba(100, 200, 250, 1.0)",b.strokeStyle="rgba(100, 100, 100, 1.0)",b.lineWidth=4,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleGradeSouth=function(a,b){this.className="AngleGradeSouth",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b),this.arc=90*Math.PI/180,this.rotation=Math.PI},ED.AngleGradeSouth.prototype=new ED.Doodle,ED.AngleGradeSouth.prototype.constructor=ED.AngleGradeSouth,ED.AngleGradeSouth.superclass=ED.Doodle.prototype,ED.AngleGradeSouth.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeSouth.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeSouth.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeSouth.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":var d="4";-b>=this.riro&&(d="3"),-b>=this.rcbo&&(d="2"),-b>=this.rtmo&&(d="1"),-b>=this.rsli&&(d="0"),c.grade=d,c.seen=-b>=this.rtmo?"No":"Yes";break;case"grade":var d="";switch(b){case"0":d=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":d=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":d=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":d=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":d=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}c.apexY=d;break;case"seen":var d="";switch(b){case"No":d=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":d=-this.apexY<this.rtmo?this.apexY:-this.riri}c.apexY=d}return c},ED.AngleGradeSouth.prototype.draw=function(a){var b=this.drawing.context;ED.AngleGradeSouth.superclass.draw.call(this,a);var c=this.arc/2,d=-Math.PI/2+c,e=-Math.PI/2-c;return b.beginPath(),b.arc(0,0,-this.apexY,d,e,!0),b.arc(0,0,this.rpu,e,d,!1),b.closePath(),b.fillStyle="rgba(100, 200, 250, 1.0)",b.strokeStyle="rgba(100, 100, 100, 1.0)",b.lineWidth=4,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleGradeWest=function(a,b){this.className="AngleGradeWest",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.grade="4",this.seen="Yes",this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b),this.arc=90*Math.PI/180,this.rotation=3*Math.PI/2},ED.AngleGradeWest.prototype=new ED.Doodle,ED.AngleGradeWest.prototype.constructor=ED.AngleGradeWest,ED.AngleGradeWest.superclass=ED.Doodle.prototype,ED.AngleGradeWest.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AngleGradeWest.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.rsli,-this.riri),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["4","3","2","1","0"],animate:!0},this.parameterValidationArray.seen={kind:"derived",type:"string",list:["Yes","No"],animate:!0}},ED.AngleGradeWest.prototype.setParameterDefaults=function(){this.apexY=-this.riri,this.setParameterFromString("grade","4"),this.setParameterFromString("seen","Yes")},ED.AngleGradeWest.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":var d="4";-b>=this.riro&&(d="3"),-b>=this.rcbo&&(d="2"),-b>=this.rtmo&&(d="1"),-b>=this.rsli&&(d="0"),c.grade=d,c.seen=-b>=this.rtmo?"No":"Yes";break;case"grade":var d="";switch(b){case"0":d=-this.apexY>=this.rsli?this.apexY:-this.rsli;break;case"1":d=-this.apexY>=this.rtmo&&-this.apexY<this.rsli?this.apexY:-this.rtmo;break;case"2":d=-this.apexY>=this.rcbo&&-this.apexY<this.rtmo?this.apexY:-360;break;case"3":d=-this.apexY>=this.riro&&-this.apexY<this.rcbo?this.apexY:-230;break;case"4":d=-this.apexY>=this.riri&&-this.apexY<this.riro?this.apexY:-this.riri}c.apexY=d;break;case"seen":var d="";switch(b){case"No":d=-this.apexY>=this.rtmo?this.apexY:-this.rtmo;break;case"Yes":d=-this.apexY<this.rtmo?this.apexY:-this.riri}c.apexY=d}return c},ED.AngleGradeWest.prototype.draw=function(a){var b=this.drawing.context;ED.AngleGradeWest.superclass.draw.call(this,a);var c=this.arc/2,d=-Math.PI/2+c,e=-Math.PI/2-c;return b.beginPath(),b.arc(0,0,-this.apexY,d,e,!0),b.arc(0,0,this.rpu,e,d,!1),b.closePath(),b.fillStyle="rgba(100, 200, 250, 1.0)",b.strokeStyle="rgba(100, 100, 100, 1.0)",b.lineWidth=4,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleNV=function(a,b){this.className="AngleNV",this.rtmo=404,this.rtmi=304,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.AngleNV.prototype=new ED.Doodle,ED.AngleNV.prototype.constructor=ED.AngleNV,ED.AngleNV.superclass=ED.Doodle.prototype,ED.AngleNV.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleNV.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleNV.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleNV.prototype.draw=function(a){var b=this.drawing.context;ED.AngleNV.superclass.draw.call(this,a);var c=this.rtmo;this.rir=this.rtmi;
var d=this.rir+(c-this.rir)/2,e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=d*Math.sin(e),i=-d*Math.cos(e),j=-d*Math.sin(e),k=i;b.beginPath(),b.arc(0,0,this.rir,f,g,!0),b.arc(0,0,c,g,f,!1),b.closePath();var l=b.createPattern(this.drawing.imageArray.NewVesselPattern,"repeat");return b.fillStyle=l,b.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleNV.prototype.groupDescription=function(){var a=this.drawing.totalDegreesExtent(this.className);return"Angle new vessels over "+a.toString()+" degrees"},ED.AngleRecession=function(a,b){this.className="AngleRecession",this.riri=176,this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.AngleRecession.prototype=new ED.Doodle,ED.AngleRecession.prototype.constructor=ED.AngleRecession,ED.AngleRecession.superclass=ED.Doodle.prototype,ED.AngleRecession.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.AngleRecession.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250)},ED.AngleRecession.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.setRotationWithDisplacements(0,-60)},ED.AngleRecession.prototype.draw=function(a){var b=this.drawing.context;ED.AngleRecession.superclass.draw.call(this,a);var c=this.riri-30;this.rir=this.riri;var d=(this.rir+(c-this.rir)/2,this.arc/2),e=-Math.PI/2+d,f=-Math.PI/2-d,g=-Math.PI/2+d-Math.PI/24,h=-Math.PI/2-d+Math.PI/24,i=this.rir*Math.sin(d),j=-this.rir*Math.cos(d),k=-this.rir*Math.sin(d),l=j;return b.beginPath(),b.arc(0,0,this.rir,e,f,!0),b.arc(0,0,c,h,g,!1),b.closePath(),b.fillStyle="rgba(255, 255, 200, 1.0)",b.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AngleRecession.prototype.groupDescription=function(){var a=this.drawing.totalDegreesExtent(this.className);return"Angle recession over "+a.toString()+" degrees"},ED.AntPVR=function(a,b){this.className="AntPVR",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.AntPVR.prototype=new ED.Doodle,ED.AntPVR.prototype.constructor=ED.AntPVR,ED.AntPVR.superclass=ED.Doodle.prototype,ED.AntPVR.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntPVR.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,4),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,4),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.AntPVR.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-400,this.setRotationWithDisplacements(180,120)},ED.AntPVR.prototype.draw=function(a){var b=this.drawing.context;ED.AntPVR.superclass.draw.call(this,a);var c=476,d=-this.apexY,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4;var m=b.createPattern(this.drawing.imageArray.AntPVRPattern,"repeat");return b.fillStyle=m,b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AntPVR.prototype.snomedCode=function(){return 232017001},ED.AntPVR.prototype.diagnosticHierarchy=function(){return 2},ED.AntSeg=function(a,b){this.className="AntSeg",this.pupilSize="Large",this.pxe=!1,this.coloboma=!1,this.colour="Blue",this.ectropion=!1,this.savedParameterArray=["pupilSize","apexY","rotation","pxe","coloboma","colour","ectropion"],this.controlParameterArray={pupilSize:"Pupil size",pxe:"PXE",coloboma:"Coloboma",colour:"Colour",ectropion:"Ectropion uveae"},ED.Doodle.call(this,a,b)},ED.AntSeg.prototype=new ED.Doodle,ED.AntSeg.prototype.constructor=ED.AntSeg,ED.AntSeg.superclass=ED.Doodle.prototype,ED.AntSeg.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSeg.prototype.setPropertyDefaults=function(){this.version=1.1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0},this.parameterValidationArray.pxe={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.coloboma={kind:"derived",type:"bool",display:!0},this.parameterValidationArray.colour={kind:"other",type:"string",list:["Blue","Brown","Gray","Green"],animate:!1},this.parameterValidationArray.ectropion={kind:"derived",type:"bool",display:!0}},ED.AntSeg.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.setParameterFromString("pxe","false")},ED.AntSeg.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.pupilSize=-200>b?"Large":-100>b?"Medium":"Small";break;case"pupilSize":switch(b){case"Large":this.apexY<-200?returnValue=this.apexY:c.apexY=-260;break;case"Medium":this.apexY>=-200&&this.apexY<-100?returnValue=this.apexY:c.apexY=-200;break;case"Small":this.apexY>=-100?returnValue=this.apexY:c.apexY=-100}break;case"coloboma":this.isRotatable="true"==b?!0:!1,this.rotation="true"==b?this.rotation:0}return c},ED.AntSeg.prototype.draw=function(a){var b=this.drawing.context;ED.AntSeg.superclass.draw.call(this,a);var c=380,d=-this.apexY,e=0,f=2*Math.PI;if(b.beginPath(),b.arc(0,0,c,e,f,!0),this.coloboma){var g=Math.PI/3*280/d,h=Math.PI/6,i=20,j=new ED.Point(0,0);j.setWithPolars(d,Math.PI+g/2);var k=new ED.Point(0,0);k.setWithPolars(c-i,Math.PI+h/2),b.moveTo(-k.x,k.y),b.arc(0,0,c-i,Math.PI/2-h/2,Math.PI/2+h/2,!1),b.arc(0,0,d,Math.PI/2+g/2,Math.PI/2-g/2,!1),b.lineTo(-k.x,k.y)}else b.moveTo(d,0),b.arc(0,0,d,f,e,!1);switch(b.lineWidth=4,b.strokeStyle="gray",this.colour){case"Blue":b.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":b.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":b.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":b.fillStyle="rgba(114, 172, 62, 0.5)"}if(this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.pxe){b.lineWidth=8,b.strokeStyle="darkgray";var l,m=.8*d,n=1.05*d,o=36,p=2*Math.PI/o;for(l=0;o>l;l++)b.beginPath(),b.arc(0,0,m,l*p,l*p+p/2,!1),b.stroke(),b.beginPath(),b.arc(0,0,n,l*p,l*p+p/2,!1),b.stroke()}this.ectropion&&(b.beginPath(),this.coloboma?b.arc(0,0,d,Math.PI/2-g/2,Math.PI/2+g/2,!0):b.arc(0,0,d+16,e,f,!0),b.lineWidth=32,b.lineCap="round",b.strokeStyle="brown",b.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AntSeg.prototype.description=function(){var a="";return"Large"!=this.pupilSize&&(a+=this.pupilSize.toLowerCase()+" pupil, "),this.coloboma&&(a+="coloboma at "+this.clockHour(6)+" o'clock, "),this.ectropion&&(a+="ectropion uveae, "),this.pxe&&(a+="pseudoexfoliation, "),0==a.length&&1==this.drawing.doodleArray.length&&(a="No abnormality"),a=a.replace(/, +$/,""),a=a.charAt(0).toUpperCase()+a.slice(1)},ED.AntSegCrossSection=function(a,b){this.className="AntSegCrossSection",this.pupilSize="Large",this.savedParameterArray=["apexY","apexX"],ED.Doodle.call(this,a,b),this.originX=44},ED.AntSegCrossSection.prototype=new ED.Doodle,ED.AntSegCrossSection.prototype.constructor=ED.AntSegCrossSection,ED.AntSegCrossSection.superclass=ED.Doodle.prototype,ED.AntSegCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSegCrossSection.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-280,-60),this.parameterValidationArray.pupilSize={kind:"derived",type:"string",list:["Large","Medium","Small"],animate:!0}},ED.AntSegCrossSection.prototype.setParameterDefaults=function(){this.setParameterFromString("pupilSize","Large"),this.apexX=24},ED.AntSegCrossSection.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":if(this.parameterValidationArray.apexX.range.setMinAndMax(-40-140/220*(this.apexY+280),32-72/220*(this.apexY+280)),this.drawing.isActive)var d=this.parameterValidationArray.apexX.range.constrain(this.apexX);else var d=this.parameterValidationArray.apexX.range.max;this.setSimpleParameter("apexX",d),c.pupilSize=-200>b?"Large":-100>b?"Medium":"Small";break;case"pupilSize":switch(b){case"Large":c.apexY=-260;break;case"Medium":c.apexY=-200;break;case"Small":c.apexY=-100}}return c},ED.AntSegCrossSection.prototype.draw=function(a){var b=this.drawing.context;ED.AntSegCrossSection.superclass.draw.call(this,a);var c=this.apexX;b.beginPath(),b.moveTo(60,480),b.lineTo(140,480),b.lineTo(140,380),b.bezierCurveTo(120,340,120,340,100,380),b.bezierCurveTo(80,340,80,340,60,380);var d=.15*Math.abs(c);return b.bezierCurveTo(40,460,c+60+d,-this.apexY,c,-this.apexY),b.bezierCurveTo(c-60-d,-this.apexY,-21,317,0,380),b.moveTo(60,-480),b.lineTo(140,-480),b.lineTo(140,-380),b.bezierCurveTo(120,-340,120,-340,100,-380),b.bezierCurveTo(80,-340,80,-340,60,-380),b.bezierCurveTo(40,-460,c+60+d,this.apexY,c,this.apexY),b.bezierCurveTo(c-60-d,this.apexY,-21,-317,0,-380),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 160, 40, 1)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AntSynech=function(a,b){this.className="AntSynech",this.rtmi=304,this.riri=176,this.savedParameterArray=["arc","rotation","apexY"],ED.Doodle.call(this,a,b)},ED.AntSynech.prototype=new ED.Doodle,ED.AntSynech.prototype.constructor=ED.AntSynech,ED.AntSynech.superclass=ED.Doodle.prototype,ED.AntSynech.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.AntSynech.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-480,-260),this.parameterValidationArray.arc.range.setMinAndMax(30*Math.PI/180,2*Math.PI)},ED.AntSynech.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180,this.apexY=-this.rtmi,this.setRotationWithDisplacements(0,-60)},ED.AntSynech.prototype.draw=function(a){console.log(this.apexY);var b=this.drawing.context;ED.AntSynech.superclass.draw.call(this,a);var c=-this.apexY;this.rir=this.riri;var d=(this.rir+(c-this.rir)/2,this.arc/2),e=-Math.PI/2+d,f=-Math.PI/2-d,g=-Math.PI/2+d-Math.PI/14,h=-Math.PI/2-d+Math.PI/14,i=this.rir*Math.sin(d),j=-this.rir*Math.cos(d),k=-this.rir*Math.sin(d),l=j;return b.beginPath(),b.arc(0,0,this.rir,e,f,!0),b.arc(0,0,c,h,g,!1),b.closePath(),b.fillStyle="rgba(100, 200, 250, 1.0)",b.strokeStyle="rgba(100, 100, 100, 1.0)",b.lineWidth=4,this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.AntSynech.prototype.groupDescription=function(){var a=this.drawing.totalDegreesExtent(this.className);return"Anterior synechiae over "+a.toString()+" degrees"},ED.AnteriorCapsulotomy=function(a,b){this.className="AnteriorCapsulotomy",ED.Doodle.call(this,a,b)},ED.AnteriorCapsulotomy.prototype=new ED.Doodle,ED.AnteriorCapsulotomy.prototype.constructor=ED.AnteriorCapsulotomy,ED.AnteriorCapsulotomy.superclass=ED.Doodle.prototype,ED.AnteriorCapsulotomy.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500)},ED.AnteriorCapsulotomy.prototype.setParameterDefaults=function(){},ED.AnteriorCapsulotomy.prototype.draw=function(a){var b=this.drawing.context;ED.AnteriorCapsulotomy.superclass.draw.call(this,a);var c=240;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=c-60;b.beginPath(),b.arc(0,0,d,0,2*Math.PI,!0),b.strokeStyle="rgba(220, 220, 220, 0.75)",b.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ArcuateScotoma=function(a,b){this.className="ArcuateScotoma",this.savedParameterArray=["scaleX","scaleY","apexY","arc"],ED.Doodle.call(this,a,b)},ED.ArcuateScotoma.prototype=new ED.Doodle,ED.ArcuateScotoma.prototype.constructor=ED.ArcuateScotoma,ED.ArcuateScotoma.superclass=ED.Doodle.prototype,ED.ArcuateScotoma.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ArcuateScotoma.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(140,300),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.ArcuateScotoma.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexX=200,this.drawing.eye==ED.eye.Left&&(this.scaleX=-1*this.scaleX);var a=this.drawing.lastDoodleOfClass(this.className);a&&(this.scaleY=-1*a.scaleY)},ED.ArcuateScotoma.prototype.draw=function(a){var b=this.drawing.context;ED.ArcuateScotoma.superclass.draw.call(this,a);var c=-100,d=100,e=-140,f=(d-c)/2,g=c+f;return b.beginPath(),b.arc(g,0,f,-Math.PI,0,!1),b.lineTo(this.apexX,0),f=(this.apexX-e)/2,g=e+f,b.arc(g,0,f,0,-Math.PI,!0),b.closePath(),b.lineWidth=6,b.fillStyle="gray",b.strokeStyle="black",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ArcuateScotoma.prototype.description=function(){return this.scaleY>0?"Superior":"Inferior arcuate scotoma"},ED.AxialLengthGraph=function(a,b){this.className="AxialLengthGraph",this.padding=100,this.offset=120,this.xAxis=24,this.xFirst=14,this.interval=2,this.stubLength=30,this.axialLength=25,this.standardDeviation=1,this.lowerLimit=21.2,this.upperLimit=26.6,ED.Doodle.call(this,a,b)},ED.AxialLengthGraph.prototype=new ED.Doodle,ED.AxialLengthGraph.prototype.constructor=ED.AxialLengthGraph,ED.AxialLengthGraph.superclass=ED.Doodle.prototype,ED.AxialLengthGraph.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1,this.parameterValidationArray.axialLength={kind:"derived",type:"float",precision:2,range:new ED.Range(14,38),animate:!1}},ED.AxialLengthGraph.prototype.draw=function(a){var b=this.drawing.context;ED.AxialLengthGraph.superclass.draw.call(this,a),b.beginPath();var c=-this.drawing.doodlePlaneWidth/2,d=-this.drawing.doodlePlaneHeight/2,e=this.drawing.doodlePlaneWidth/2,f=this.drawing.doodlePlaneHeight/2,g=(this.drawing.doodlePlaneWidth-2*this.padding)/this.xAxis;if(b.rect(c,d,this.drawing.doodlePlaneWidth,this.drawing.doodlePlaneHeight),b.lineWidth=4,b.strokeStyle="gray",b.fillStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.rect(c+this.padding,d+this.padding,(this.lowerLimit-this.xFirst)*g,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),b.rect(c+this.padding+(this.upperLimit-this.xFirst)*g,d+this.padding,this.drawing.doodlePlaneWidth-2*this.padding-(this.upperLimit-this.xFirst)*g,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),b.fillStyle="rgba(255,167,152,0.5)",b.fill(),b.beginPath(),b.rect(c+this.padding+(this.lowerLimit-this.xFirst)*g,d+this.padding,(this.upperLimit-this.lowerLimit)*g,this.drawing.doodlePlaneHeight-2*this.padding-this.offset),b.fillStyle="rgba(208,255,197,0.5)",b.fill(),b.beginPath(),b.moveTo(c+this.padding,f-this.padding-this.offset),b.lineTo(e-this.padding,f-this.padding-this.offset),b.moveTo(c+this.padding,f-this.padding-this.offset),b.lineTo(c+this.padding,d+this.padding),b.lineWidth=4,b.stroke();for(var h=Math.floor(this.xAxis/this.interval)+1,i=0;h>i;i++){var j=(this.xFirst+i*this.interval).toString(),k=i*(this.drawing.doodlePlaneWidth-2*this.padding)/(h-1);b.lineWidth=4,b.font="112px sans-serif",b.strokeStyle="gray",b.fillStyle="gray",b.beginPath(),b.moveTo(c+this.padding+k,f-this.padding-this.offset),b.lineTo(c+this.padding+k,f-this.padding-this.offset+this.stubLength),b.stroke();var l=b.measureText(j).width;b.fillText(j,c+this.padding+k-l/2,f-this.padding)}var m=c+this.padding+(this.axialLength-this.xFirst)*g;b.beginPath(),b.moveTo(m,f-this.padding-this.offset),b.lineTo(m,d+this.padding),b.lineWidth=16,b.strokeStyle="rgba(50,50,50,1)",b.stroke();var n=this.standardDeviation*g;b.beginPath(),b.rect(m-n/2,0-this.offset/2,n,50),b.lineWidth=16,b.strokeStyle="red",b.stroke()}return this.isClicked},ED.BiopsySite=function(a,b){this.className="BiopsySite",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.BiopsySite.prototype=new ED.Doodle,ED.BiopsySite.prototype.constructor=ED.BiopsySite,ED.BiopsySite.superclass=ED.Doodle.prototype,ED.BiopsySite.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.BiopsySite.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.BiopsySite.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(300,-80)},ED.BiopsySite.prototype.draw=function(a){var b=this.drawing.context;ED.BiopsySite.superclass.draw.call(this,a);var c=30;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=2*c/3,b.fillStyle="yellow",b.strokeStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw;var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.BiopsySite.prototype.description=function(){return"Biopsy site in the "+this.quadrant()},ED.Bleb=function(a,b){this.className="Bleb",this.savedParameterArray=["rotation","arc"],ED.Doodle.call(this,a,b)},ED.Bleb.prototype=new ED.Doodle,ED.Bleb.prototype.constructor=ED.Bleb,ED.Bleb.superclass=ED.Doodle.prototype,ED.Bleb.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Bleb.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/12,Math.PI/2)},ED.Bleb.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30),this.arc=Math.PI/8},ED.Bleb.prototype.draw=function(a){var b=this.drawing.context;ED.Bleb.superclass.draw.call(this,a);var c=384;b.beginPath();var d=500,c=470,e=384,f=this.arc/2,g=Math.PI/30,h=Math.PI/40,i=(-Math.PI/2+f,-Math.PI/2-f,d*Math.sin(f)),j=-d*Math.cos(f),k=(-d*Math.sin(f),c*Math.sin(f+g)),l=-c*Math.cos(f+g),m=(-c*Math.sin(f+g),c*Math.sin(f+g+h)),n=-c*Math.cos(f+g+h),o=-c*Math.sin(f+g+h),p=n,q=(e*Math.sin(f),-e*Math.cos(f)),r=-e*Math.sin(f),s=q;return b.beginPath(),b.arc(0,0,d,-Math.PI/2+f,-Math.PI/2-f,!0),b.quadraticCurveTo(o,p,r,s),b.arc(0,0,e,-Math.PI/2-f,-Math.PI/2+f,!1),b.quadraticCurveTo(m,n,i,j),b.closePath(),b.fillStyle="rgba(240,240,240,0.9)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-50,-e),b.lineTo(-50,1.2*-e),b.lineTo(50,1.2*-e),b.lineTo(50,-e),b.stroke()),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(k,l)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Bleb.prototype.description=function(){return"Trabeculectomy bleb at "+this.clockHour()+" o'clock"},ED.BlotHaemorrhage=function(a,b){this.className="BlotHaemorrhage",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.BlotHaemorrhage.prototype=new ED.Doodle,ED.BlotHaemorrhage.prototype.constructor=ED.BlotHaemorrhage,ED.BlotHaemorrhage.superclass=ED.Doodle.prototype,ED.BlotHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.BlotHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-60,-60)},ED.BlotHaemorrhage.prototype.draw=function(a){var b=this.drawing.context;ED.BlotHaemorrhage.superclass.draw.call(this,a);var c=30;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="red",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.BlotHaemorrhage.prototype.groupDescription=function(){return"Blot haemorrhages"},ED.BuckleOperation=function(a,b){this.className="BuckleOperation",ED.Doodle.call(this,a,b)},ED.BuckleOperation.prototype=new ED.Doodle,ED.BuckleOperation.prototype.constructor=ED.BuckleOperation,ED.BuckleOperation.superclass=ED.Doodle.prototype,ED.BuckleOperation.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.willReport=!1},ED.BuckleOperation.prototype.draw=function(a){var b=this.drawing.context;return ED.BuckleOperation.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,100,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,this.isFilled=!1,b.strokeStyle="#444",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.drawRectus(b,"Sup"),this.drawRectus(b,"Nas"),this.drawRectus(b,"Inf"),this.drawRectus(b,"Tem")),this.isClicked},ED.BuckleOperation.prototype.drawRectus=function(a,b){switch(a.beginPath(),b){case"Sup":x1=-60,y1=-480,x2=-60,y2=-200,x3=60,y3=-200,x4=60,y4=-480,xd=30,yd=0;break;case"Nas":x1=480,y1=-60,x2=200,y2=-60,x3=200,y3=60,x4=480,y4=60,xd=0,yd=30;break;case"Inf":x1=60,y1=480,x2=60,y2=200,x3=-60,y3=200,x4=-60,y4=480,xd=-30,yd=0;break;case"Tem":x1=-480,y1=60,x2=-200,y2=60,x3=-200,y3=-60,x4=-480,y4=-60,xd=0,yd=-30}a.moveTo(x1,y1),a.lineTo(x2,y2),a.lineTo(x3,y3),a.lineTo(x4,y4),a.moveTo(x1+xd,y1+yd),a.lineTo(x2+xd,y2+yd),a.moveTo(x1+2*xd,y1+2*yd),a.lineTo(x2+2*xd,y2+2*yd),a.moveTo(x1+3*xd,y1+3*yd),a.lineTo(x2+3*xd,y2+3*yd),a.fillStyle="#CA6800",a.fill(),a.lineWidth=8,a.strokeStyle="#804000",a.stroke()},ED.BuckleSuture=function(a,b){this.className="BuckleSuture",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b),this.arc=15*Math.PI/180},ED.BuckleSuture.prototype=new ED.Doodle,ED.BuckleSuture.prototype.constructor=ED.BuckleSuture,ED.BuckleSuture.superclass=ED.Doodle.prototype,ED.BuckleSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.willReport=!1},ED.BuckleSuture.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BuckleSuture.prototype.draw=function(a){var b=this.drawing.context;ED.BuckleSuture.superclass.draw.call(this,a);var c=340,d=this.drawing.lastDoodleOfClass("CircumferentialBuckle");d&&(c=-d.apexY+20);var e=200,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,e,h,g,!1),b.closePath(),b.lineWidth=4,this.isFilled=!1,b.strokeStyle="#666",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){r=e+(c-e)/2;var i=r*Math.sin(f),j=-r*Math.cos(f);b.beginPath(),b.arc(i,j,5,0,2*Math.PI,!0),b.moveTo(i+20,j+20),b.lineTo(i,j),b.lineTo(i+20,j-20),b.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.BusaccaNodule=function(a,b){this.className="BusaccaNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.BusaccaNodule.prototype=new ED.Doodle,ED.BusaccaNodule.prototype.constructor=ED.BusaccaNodule,ED.BusaccaNodule.superclass=ED.Doodle.prototype,ED.BusaccaNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.BusaccaNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.BusaccaNodule.prototype.draw=function(a){var b=this.drawing.context;ED.BusaccaNodule.superclass.draw.call(this,a);var c=380,d=260,e=this.drawing.lastDoodleOfClass("AntSeg");e&&(d=-e.apexY);var f=d+(c-d)/2;return b.beginPath(),b.arc(0,-f,30,0,2*Math.PI,!1),b.fillStyle="rgba(150,100,50,1)",b.lineWidth=1,b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.isClicked},ED.BusaccaNodule.prototype.groupDescription=function(){return"Busacca nodules"},ED.CNV=function(a,b){this.className="CNV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CNV.prototype=new ED.Doodle,ED.CNV.prototype.constructor=ED.CNV,ED.CNV.superclass=ED.Doodle.prototype,ED.CNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CNV.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.CNV.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.CNV.prototype.draw=function(a){var b=this.drawing.context;ED.CNV.superclass.draw.call(this,a),b.beginPath();var c=80,d=16,e=2*Math.PI/d,f=.5*Math.PI/d,g=4,h=new ED.Point(0,0),i=new ED.Point(0,0);i.setWithPolars(c,0),b.moveTo(i.x,i.y);for(var j=c,k=0;d>k;k++){var l=c*(g+ED.randomArray[k])/g,m=new ED.Point(0,0);m.setWithPolars(j,k*e+f);var n=new ED.Point(0,0);n.setWithPolars(l,(k+1)*e-f);var o=new ED.Point(0,0);o.setWithPolars(l,(k+1)*e),j=l,k==d-1?b.bezierCurveTo(m.x,m.y,n.x,n.y,i.x,i.y):b.bezierCurveTo(m.x,m.y,n.x,n.y,o.x,o.y),1==k&&(h.x=o.x,h.y=o.y)}return b.closePath(),b.lineWidth=0,b.fillStyle="red",b.strokeStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,.8*c,0,2*Math.PI,!1),b.closePath(),b.fillStyle="rgba(255,255,190,1)",b.fill()),this.handleArray[2].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CNV.prototype.description=function(){return"CNV"},ED.CNV.prototype.snomedCode=function(){return 314517003},ED.CNV.prototype.diagnosticHierarchy=function(){return 2},ED.CapsularTensionRing=function(a,b){this.className="CapsularTensionRing",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.CapsularTensionRing.prototype=new ED.Doodle,ED.CapsularTensionRing.prototype.constructor=ED.CapsularTensionRing,ED.CapsularTensionRing.superclass=ED.Doodle.prototype,ED.CapsularTensionRing.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isMoveable=!1,this.isUnique=!0},ED.CapsularTensionRing.prototype.setParameterDefaults=function(){this.rotation=-Math.PI/2},ED.CapsularTensionRing.prototype.draw=function(a){var b=this.drawing.context;ED.CapsularTensionRing.superclass.draw.call(this,a),b.beginPath();var c=360,d=340,e=300,f=15,g=.2*Math.PI;b.arc(0,0,c,-g,g,!0);var h=new ED.Point(0,0);h.setWithPolars(c,Math.PI/2+.8*g);var i=new ED.Point(0,0);i.setWithPolars(e,Math.PI/2+.8*g);var j=new ED.Point(0,0);j.setWithPolars(e,Math.PI/2+g);var k=new ED.Point(0,0);k.setWithPolars(e,Math.PI/2+1.1*g);var l=new ED.Point(0,0);l.setWithPolars(d,Math.PI/2+1.1*g);var m=new ED.Point(0,0);m.setWithPolars(d,Math.PI/2+1.2*g),b.bezierCurveTo(h.x,h.y,i.x,i.y,j.x,j.y),b.bezierCurveTo(k.x,k.y,l.x,l.y,m.x,m.y),b.arc(0,0,d,1.2*g,-1.2*g,!1);var n=new ED.Point(0,0);n.setWithPolars(d,Math.PI/2-1.1*g);var o=new ED.Point(0,0);o.setWithPolars(e,Math.PI/2-1.1*g);var p=new ED.Point(0,0);p.setWithPolars(e,Math.PI/2-g);var q=new ED.Point(0,0);q.setWithPolars(e,Math.PI/2-.8*g);var r=new ED.Point(0,0);r.setWithPolars(c,Math.PI/2-.8*g);var s=new ED.Point(0,0);s.setWithPolars(c,Math.PI/2-g),b.bezierCurveTo(n.x,n.y,o.x,o.y,p.x,p.y),b.bezierCurveTo(q.x,q.y,r.x,r.y,s.x,s.y);var t=new ED.Point(0,0);t.setWithPolars(d-8,Math.PI/2-g);var u=new ED.Point(0,0);u.setWithPolars(d-8+f,Math.PI/2-g),b.moveTo(u.x,u.y),b.arc(t.x,t.y,15,0,2*Math.PI,!1);var v=new ED.Point(0,0);v.setWithPolars(d-8,Math.PI/2+g);var w=new ED.Point(0,0);return w.setWithPolars(d-8+f,Math.PI/2+g),b.moveTo(w.x,w.y),b.arc(v.x,v.y,15,0,2*Math.PI,!1),b.closePath(),b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a),this.isClicked},ED.CapsularTensionRing.prototype.description=function(){var a="Capsular Tension Ring";return a},ED.ChandelierDouble=function(a,b){this.className="ChandelierDouble",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.ChandelierDouble.prototype=new ED.Doodle,ED.ChandelierDouble.prototype.constructor=ED.ChandelierDouble,ED.ChandelierDouble.superclass=ED.Doodle.prototype,ED.ChandelierDouble.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierDouble.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierDouble.prototype.draw=function(a){var b=this.drawing.context;if(ED.ChandelierDouble.superclass.draw.call(this,a),b.beginPath(),b.rect(-120,this.parsPlana-60,240,160),b.lineWidth=2,b.strokeStyle="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var c=-80;b.moveTo(c-20,this.parsPlana+60),b.lineTo(c+20,this.parsPlana+60),b.lineTo(c+20,this.parsPlana+120),b.lineTo(c,this.parsPlana+140),b.lineTo(c-20,this.parsPlana+120),b.lineTo(c-20,this.parsPlana+60);var c=80;b.moveTo(c-20,this.parsPlana+60),b.lineTo(c+20,this.parsPlana+60),b.lineTo(c+20,this.parsPlana+120),b.lineTo(c,this.parsPlana+140),b.lineTo(c-20,this.parsPlana+120),b.lineTo(c-20,this.parsPlana+60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-120,this.parsPlana,240,60),b.fillStyle="rgba(120, 120, 120, 1)",b.fill(),b.beginPath(),b.moveTo(0,this.parsPlana),b.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),b.lineWidth=40,b.strokeStyle="rgba(120, 120, 120, 0.5)",b.stroke()}return this.isClicked},ED.ChandelierDouble.prototype.groupDescription=function(){return"Twin chandelier at "},ED.ChandelierDouble.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChandelierSingle=function(a,b){this.className="ChandelierSingle",this.parsPlana=-560,this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)
},ED.ChandelierSingle.prototype=new ED.Doodle,ED.ChandelierSingle.prototype.constructor=ED.ChandelierSingle,ED.ChandelierSingle.superclass=ED.Doodle.prototype,ED.ChandelierSingle.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.ChandelierSingle.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(180,90)},ED.ChandelierSingle.prototype.draw=function(a){var b=this.drawing.context;return ED.ChandelierSingle.superclass.draw.call(this,a),b.beginPath(),b.rect(-60,this.parsPlana-60,120,160),b.lineWidth=2,b.strokeStyle="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-20,this.parsPlana+60),b.lineTo(20,this.parsPlana+60),b.lineTo(20,this.parsPlana+120),b.lineTo(0,this.parsPlana+140),b.lineTo(-20,this.parsPlana+120),b.lineTo(-20,this.parsPlana+60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-60,this.parsPlana,120,60),b.fillStyle="rgba(120, 120, 120, 1)",b.fill(),b.beginPath(),b.moveTo(0,this.parsPlana),b.bezierCurveTo(0,this.parsPlana-50,50,this.parsPlana-100,100,this.parsPlana-100),b.lineWidth=40,b.strokeStyle="rgba(120, 120, 120, 0.5)",b.stroke()),this.isClicked},ED.ChandelierSingle.prototype.groupDescription=function(){return"Chandelier at "},ED.ChandelierSingle.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ChoroidalHaemorrhage=function(a,b){this.className="ChoroidalHaemorrhage",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.ChoroidalHaemorrhage.prototype=new ED.Doodle,ED.ChoroidalHaemorrhage.prototype.constructor=ED.ChoroidalHaemorrhage,ED.ChoroidalHaemorrhage.superclass=ED.Doodle.prototype,ED.ChoroidalHaemorrhage.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.ChoroidalHaemorrhage.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.apexY=-200,this.setRotationWithDisplacements(315,60)},ED.ChoroidalHaemorrhage.prototype.draw=function(a){var b=this.drawing.context;ED.ChoroidalHaemorrhage.superclass.draw.call(this,a);var c=476,d=this.arc/2,e=-Math.PI/2+d,f=-Math.PI/2-d,g=c*Math.sin(d),h=-c*Math.cos(d),i=-c*Math.sin(d),j=h;b.beginPath(),b.arc(0,0,c,e,f,!0);var k=.6,l=25;if(this.apexY<-l)b.bezierCurveTo(i,j,k*i,this.apexY,this.apexX,this.apexY),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h);else if(this.apexY<l){var m=Math.acos((0-this.apexY)/l),n=l*Math.sin(m);b.bezierCurveTo(i,j,k*i,this.apexY,-n,this.apexY),b.arc(0,0,l,-Math.PI/2-m,-Math.PI/2+m,!1),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h)}else b.bezierCurveTo(i,j,k*i,this.apexY,0,25),b.arc(0,0,l,Math.PI/2,2.5*Math.PI,!1),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h);return b.lineWidth=4,b.fillStyle="rgba(153, 102, 51, 1)",b.strokeStyle="rgba(153, 102, 51, 1)",this.drawBoundary(a),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(g,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ChoroidalHaemorrhage.prototype.description=function(){var a="";return a+=Math.cos(this.rotation)>0?"Supero":"Infero",a+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",a+=" choroidal haemorrhage"},ED.ChoroidalHaemorrhage.prototype.snomedCode=function(){return 419596007},ED.ChoroidalNaevus=function(a,b){this.className="ChoroidalNaevus",this.numberOfHandles=4,this.initialRadius=120,this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,a,b)},ED.ChoroidalNaevus.prototype=new ED.Doodle,ED.ChoroidalNaevus.prototype.constructor=ED.ChoroidalNaevus,ED.ChoroidalNaevus.superclass=ED.Doodle.prototype,ED.ChoroidalNaevus.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0,this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ChoroidalNaevus.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=this.numberOfHandles,d=new Object;d.length=new ED.Range(50,290),d.angle=new ED.Range(((2*c-1)*b/(2*c)+a*b/c)%b,(1*b/(2*c)+a*b/c)%b),this.handleVectorRangeArray[a]=d}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0},ED.ChoroidalNaevus.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a);for(var b=0;b<this.numberOfHandles;b++){var c=new ED.Point(0,0);c.setWithPolars(this.initialRadius,2*b*Math.PI/this.numberOfHandles),this.addPointToSquiggle(c)}},ED.ChoroidalNaevus.prototype.draw=function(a){var b=this.drawing.context;ED.ChoroidalNaevus.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y)}if(b.closePath(),b.lineWidth=4,b.fillStyle="rgba(125, 65, 54, 0.8)",b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){p=new ED.Point(0,0),fill="yellow";var j=4;n=Math.abs(Math.floor((-this.apexY+50)/5));for(var h=0;n>h;h++)p.setWithPolars(.8*this.initialRadius*ED.randomArray[h+10],2*Math.PI*ED.randomArray[h+100]),this.drawSpot(b,p.x,p.y,2*j,fill)}for(var h=0;h<this.numberOfHandles;h++)this.handleArray[h].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[h]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ChoroidalNaevus.prototype.description=function(){return"Choroidal naevus"},ED.ChoroidalNaevus.prototype.snomedCode=function(){return 255024002},ED.CiliaryInjection=function(a,b){this.className="CiliaryInjection",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.CiliaryInjection.prototype=new ED.Doodle,ED.CiliaryInjection.prototype.constructor=ED.CiliaryInjection,ED.CiliaryInjection.superclass=ED.Doodle.prototype,ED.CiliaryInjection.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.CiliaryInjection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300),this.parameterValidationArray.radius.range.setMinAndMax(250,450)},ED.CiliaryInjection.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.setRotationWithDisplacements(90,-120)},ED.CiliaryInjection.prototype.draw=function(a){var b=this.drawing.context;ED.CiliaryInjection.superclass.draw.call(this,a);var c=480,d=400,e=d+(c-d)/2,f=this.arc/2,g=(-Math.PI/2+f,-Math.PI/2-f),h=e*Math.sin(f),i=-e*Math.cos(f),j=-e*Math.sin(f),k=i;if(b.beginPath(),b.arc(0,0,c,-Math.PI/2+f,-Math.PI/2-f,!0),b.arc(0,0,d,-Math.PI/2-f,-Math.PI/2+f,!1),b.closePath(),b.fillStyle="rgba(218,230,241,0)",b.lineWidth=4,b.strokeStyle="rgba(218,230,241,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var l=60,m=2*Math.PI/l,n=Math.floor(this.arc/m),o=new ED.Point(0,0),p=new ED.Point(0,0);b.beginPath();for(var q=0;n>q;q++){var f=Math.PI/2+g+q*m;o.setWithPolars(c,f),p.setWithPolars(d,f),b.moveTo(o.x,o.y),b.lineTo(p.x,p.y)}b.strokeStyle="red",b.lineWidth=16,b.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CiliaryInjection.prototype.groupDescription=function(){return"Ciliary injection "},ED.Circinate=function(a,b){this.className="Circinate",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.Circinate.prototype=new ED.Doodle,ED.Circinate.prototype.constructor=ED.Circinate,ED.Circinate.superclass=ED.Doodle.prototype,ED.Circinate.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Circinate.prototype.setPropertyDefaults=function(){},ED.Circinate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(60,100)},ED.Circinate.prototype.draw=function(a){var b=this.drawing.context;ED.Circinate.superclass.draw.call(this,a),b.beginPath();var c=80;if(b.arc(0,0,c,0,2*Math.PI,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(200,200,0,0)",b.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=40,e=10,f=12,g=30,h=new ED.Point(0,0),j=new ED.Point(0,0);for(b.beginPath(),b.arc(0,0,e,0,2*Math.PI,!1),b.closePath(),b.fillStyle="red",b.fill(),phi=2*Math.PI/f,i=0;f>i;i++)b.beginPath(),h.setWithPolars(d,i*phi),j.setWithPolars(d+g,i*phi),b.moveTo(h.x,h.y),b.lineTo(j.x,j.y),b.closePath(),b.lineWidth=12,b.strokeStyle="rgba(220,220,0,1)",b.lineCap="round",b.stroke()}var k=new ED.Point(0,0);return k.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(k),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Circinate.prototype.groupDescription=function(){return"Circinate maculopathy "},ED.Circinate.prototype.description=function(){return this.locationRelativeToFovea()},ED.CircumferentialBuckle=function(a,b){this.className="CircumferentialBuckle",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.CircumferentialBuckle.prototype=new ED.Doodle,ED.CircumferentialBuckle.prototype.constructor=ED.CircumferentialBuckle,ED.CircumferentialBuckle.superclass=ED.Doodle.prototype,ED.CircumferentialBuckle.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CircumferentialBuckle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-410,-320)},ED.CircumferentialBuckle.prototype.setParameterDefaults=function(){this.arc=140*Math.PI/180,this.apexY=-320,this.rotation=-45*Math.PI/180},ED.CircumferentialBuckle.prototype.draw=function(a){var b=this.drawing.context;ED.CircumferentialBuckle.superclass.draw.call(this,a);var c=320;-350>this.apexY&&this.apexY>-380?c=350:this.apexY<-380&&(c=410);var d=220,e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=c*Math.sin(e),i=-c*Math.cos(e),j=-c*Math.sin(e),k=i;if(b.beginPath(),b.arc(0,0,c,f,g,!0),b.arc(0,0,d,g,f,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(200,200,200,0.75)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var l=30;rgi=d+(c-d-l)/2,rgo=c-(c-d-l)/2,b.arc(0,0,rgo,f,g,!0),b.arc(0,0,rgi,g,f,!1),b.closePath(),b.fill(),b.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,-c)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CircumferentialBuckle.prototype.description=function(){var a="";return a=this.apexY<=-380?"280 circumferential buckle ":this.apexY<=-350?"279 circumferential buckle ":"277 circumferential buckle ",a+=this.arc>1.8*Math.PI?"encirclement":this.clockHourExtent()+" o'clock"},ED.ConjunctivalFlap=function(a,b){this.className="ConjunctivalFlap",this.method="Fornix-based",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.ConjunctivalFlap.prototype=new ED.Doodle,ED.ConjunctivalFlap.prototype.constructor=ED.ConjunctivalFlap,ED.ConjunctivalFlap.superclass=ED.Doodle.prototype,ED.ConjunctivalFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-640,-100),this.parameterValidationArray.apexY.delta=30,this.parameterValidationArray.arc.range.setMinAndMax(60*Math.PI/180,160*Math.PI/180),this.parameterValidationArray.method={kind:"derived",type:"string",list:["Fornix-based","Limbus-based"],animate:!0}},ED.ConjunctivalFlap.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setParameterFromString("method","Fornix-based")},ED.ConjunctivalFlap.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.method=-380>b?"Fornix-based":"Limbus-based";break;case"method":switch(b){case"Fornix-based":c.apexY=-660;break;case"Limbus-based":c.apexY=-100}}return c},ED.ConjunctivalFlap.prototype.draw=function(a){var b=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,a);var c=380,d=this.arc/2,e=-Math.PI/2+d,f=-Math.PI/2-d,g=(this.arc/6,new ED.Point(this.apexX,this.apexY)),h=new ED.Point(c*Math.sin(d),-c*Math.cos(d)),i=new ED.Point(-c*Math.sin(d),-c*Math.cos(d));b.beginPath(),b.arc(0,0,c,e,f,!0);var j=.8;return b.bezierCurveTo(i.x,i.y,j*i.x,g.y,g.x,g.y),b.bezierCurveTo(j*h.x,g.y,h.x,h.y,h.x,h.y),b.fillStyle="rgba(255,255,255,0.5)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(i),this.handleArray[3].location=this.transform.transformPoint(h),this.handleArray[4].location=this.transform.transformPoint(g),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ConjunctivalFlap.prototype.description=function(){return(this.apexY<-280?"Fornix based ":"Limbus based ")+"flap"},ED.ConjunctivalSuture=function(a,b){this.className="ConjunctivalSuture",this.boundaryWidth=180,this.boundaryHeight=180,this.orientated=!0,this.type="Buried Mattress",this.material="Nylon",this.size="10/0",this.savedParameterArray=["originX","originY","rotation","orientated","type","material","size"],this.controlParameterArray={orientated:"Orientated",type:"Type",material:"Material",size:"Size"},ED.Doodle.call(this,a,b)},ED.ConjunctivalSuture.prototype=new ED.Doodle,ED.ConjunctivalSuture.prototype.constructor=ED.ConjunctivalSuture,ED.ConjunctivalSuture.superclass=ED.Doodle.prototype,ED.ConjunctivalSuture.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ConjunctivalSuture.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.handleArray[2].isVisible=!1,this.parameterValidationArray.apexX.range.setMinAndMax(80,220),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Purse String","Mattress","Buried Mattress","Interrupted","Continuous"],animate:!1},this.parameterValidationArray.material={kind:"derived",type:"string",list:["Nylon","Prolene","Vicryl","Silk"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["11/0","10/0","9/0","8/0","7/0","6/0"],animate:!1},this.parameterValidationArray.orientated={kind:"derived",type:"bool",display:!1}},ED.ConjunctivalSuture.prototype.setParameterDefaults=function(){this.apexX=this.boundaryWidth/2,this.setParameterFromString("type","Purse String");var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else{var c=new ED.Point(0,0),d=this.drawing.eye==ED.eye.Right?11:1;c.setWithPolars(290,d*Math.PI/6),this.move(c.x,c.y)}},ED.ConjunctivalSuture.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"type":"Mattress"==b||"Continuous"==b?(this.boundaryWidth=160,this.boundaryHeight=50,this.parameterValidationArray.apexX.range.setMinAndMax(80,220),this.handleArray[4].isVisible=!0):(this.boundaryWidth=100,this.boundaryHeight=100,this.parameterValidationArray.apexX.range.setMinAndMax(50,50),this.handleArray[4].isVisible=!1),this.apexX=this.boundaryWidth/2;break;case"orientated":"true"==b?(this.isOrientated=!0,this.handleArray[2].isVisible=!1):(this.isOrientated=!1,this.handleArray[2].isVisible=!0);break;case"apexX":this.boundaryWidth=2*this.apexX}return c},ED.ConjunctivalSuture.prototype.draw=function(a){var b=this.drawing.context;if(ED.ConjunctivalSuture.superclass.draw.call(this,a),b.beginPath(),b.rect(-this.boundaryWidth/2,-this.boundaryHeight/2,this.boundaryWidth,this.boundaryHeight),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle=b.fillStyle,this.isSelected&&(b.strokeStyle="gray"),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=20,d=this.boundaryHeight/2;switch(b.beginPath(),this.type){case"Purse String":b.arc(0,0,d,0,2*Math.PI,!0),b.moveTo(0-c,d+c),b.lineTo(0,d),b.lineTo(0+c,d+c);break;case"Mattress":b.rect(-this.boundaryWidth/2,-this.boundaryHeight/2,this.boundaryWidth,this.boundaryHeight);var e=-this.boundaryWidth/2+2*c;b.moveTo(e-c,d+c),b.lineTo(e,d),b.lineTo(e+c,d+c);break;case"Buried Mattress":var f=10,g=40;b.moveTo(-d+f,-d),b.lineTo(d-f,-d),b.lineTo(d-g,d),b.lineTo(-d+g,d),b.lineTo(-d+f,-d),b.moveTo(0-c,d+c),b.lineTo(0,d),b.lineTo(0+c,d+c);break;case"Interrupted":var h=10,i=30;b.moveTo(0,-d),b.bezierCurveTo(-h,-d+i,-h,d-i,0,d),b.bezierCurveTo(h,d-i,h,-d+i,0,-d),b.moveTo(0-c,d+c),b.lineTo(0,d),b.lineTo(0+c,d+c);break;case"Continuous":var j=-this.boundaryWidth/2;for(b.moveTo(j,0);j+2*c<this.boundaryWidth/2;)j+=c,b.lineTo(j,-c),j+=c,b.lineTo(j,+c);b.lineTo(j+c,0),b.closePath()}b.lineWidth=4,b.strokeStyle="blue",b.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(-this.boundaryWidth/2,-this.boundaryHeight/2)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ConjunctivalSuture.prototype.description=function(){var a;return a=this.size+" "+this.material+" "+this.type+" conjunctival suture at "+this.clockHour()+" o'clock"},ED.CorneaCrossSection=function(a,b){this.className="CorneaCrossSection",ED.Doodle.call(this,a,b)},ED.CorneaCrossSection.prototype=new ED.Doodle,ED.CorneaCrossSection.prototype.constructor=ED.CorneaCrossSection,ED.CorneaCrossSection.superclass=ED.Doodle.prototype,ED.CorneaCrossSection.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.CorneaCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.CorneaCrossSection.prototype.draw=function(a){var b=this.drawing.context;return ED.CorneaCrossSection.superclass.draw.call(this,a),b.beginPath(),b.moveTo(60,-480),b.lineTo(-80,-480),b.bezierCurveTo(-100,-440,-100,-440,-120,-380),b.bezierCurveTo(-240,-260,-320,-160,-320,0),b.bezierCurveTo(-320,160,-240,260,-120,380),b.bezierCurveTo(-100,440,-100,440,-80,480),b.lineTo(60,480),b.lineTo(0,380),b.bezierCurveTo(-80,260,-220,180,-220,0),b.bezierCurveTo(-220,-180,-80,-260,0,-380),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(245, 245, 245, 0.5)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(56,-478),b.lineTo(-78,-478),b.bezierCurveTo(-98,-440,-96,-440,-118,-378),b.lineTo(-4,-378),b.lineTo(56,-478),b.moveTo(56,478),b.lineTo(-78,478),b.bezierCurveTo(-98,440,-96,440,-118,378),b.lineTo(-4,378),b.closePath(),b.fillStyle="rgba(255,255,185,1)",b.fill()),this.isClicked},ED.CornealAbrasion=function(a,b){this.className="CornealAbrasion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CornealAbrasion.prototype=new ED.Doodle,ED.CornealAbrasion.prototype.constructor=ED.CornealAbrasion,ED.CornealAbrasion.superclass=ED.Doodle.prototype,ED.CornealAbrasion.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealAbrasion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealAbrasion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealAbrasion.prototype.draw=function(a){var b=this.drawing.context;ED.CornealAbrasion.superclass.draw.call(this,a),b.beginPath();var c=120;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath();-this.apexY/100;b.fillStyle="rgba(0, 255, 0, 1)",b.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CornealAbrasion.prototype.description=function(){var a="",b=this.scaleX+this.scaleY;return a=2>b?"Small ":4>b?"Medium ":"Large ",a+="corneal abrasion"},ED.CornealErosion=function(a,b){this.className="CornealErosion",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CornealErosion.prototype=new ED.Doodle,ED.CornealErosion.prototype.constructor=ED.CornealErosion,ED.CornealErosion.superclass=ED.Doodle.prototype,ED.CornealErosion.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CornealErosion.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.originX.range.setMinAndMax(-150,150),this.parameterValidationArray.originY.range.setMinAndMax(-150,150),this.parameterValidationArray.scaleX.range.setMinAndMax(.25,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.25,2)},ED.CornealErosion.prototype.setParameterDefaults=function(){this.scaleX=1.5,this.scaleY=1,this.setOriginWithDisplacements(0,25)},ED.CornealErosion.prototype.draw=function(a){var b=this.drawing.context;ED.CornealErosion.superclass.draw.call(this,a),b.beginPath();var c=120;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath(),b.lineWidth=3,b.fillStyle="rgba(230, 230, 230, 0.25)",b.strokeStyle="rgba(100, 100, 100, 1)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CornealErosion.prototype.groupDescription=function(){return"Removal of some corneal epithelium"},ED.CornealGraft=function(a,b){this.className="CornealGraft",this.numberOfSutures=16,this.initialRadius=320,this.sutureLength=60,this.sutureType="Interrupted",this.opaque=!1,this.savedParameterArray=["apexY","sutureType","opaque"],this.controlParameterArray={sutureType:"Suture type",opaque:"Opaque"},ED.Doodle.call(this,a,b)},ED.CornealGraft.prototype=new ED.Doodle,ED.CornealGraft.prototype.constructor=ED.CornealGraft,ED.CornealGraft.superclass=ED.Doodle.prototype,ED.CornealGraft.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealGraft.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.sutureType={kind:"derived",type:"string",list:["Interrupted","Continuous","None"],animate:!1},this.parameterValidationArray.opaque={kind:"derived",type:"bool",display:!0}},ED.CornealGraft.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius},ED.CornealGraft.prototype.draw=function(a){var b=this.drawing.context;ED.CornealGraft.superclass.draw.call(this,a),b.beginPath();var c=-this.apexY+this.sutureLength/2,d=-this.apexY-this.sutureLength/2;if(b.arc(0,0,c,0,2*Math.PI,!0),b.moveTo(d,0),b.arc(0,0,d,0,2*Math.PI,!0),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(0,0,-this.apexY,0,2*Math.PI,!0),b.strokeStyle="gray",b.stroke(),this.opaque&&(b.fillStyle="rgba(150, 150, 150, 0.8)",b.fill()),b.beginPath();for(var e=0;e<this.numberOfSutures;e++){var f=2*e*Math.PI/this.numberOfSutures,g=new ED.Point(0,0);g.setWithPolars(d,f);var h=new ED.Point(0,0);h.setWithPolars(c,f),"None"==this.sutureType&&(this.drawSpot(b,g.x,g.y,3,"gray"),this.drawSpot(b,h.x,h.y,3,"gray")),0==f?b.moveTo(g.x,g.y):"Interrupted"==this.sutureType?b.moveTo(g.x,g.y):"Continuous"==this.sutureType&&b.lineTo(g.x,g.y),"None"!=this.sutureType&&b.lineTo(h.x,h.y)}"Continuous"==this.sutureType&&b.closePath(),b.strokeStyle="gray",b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CornealGraft.prototype.description=function(){return"Corneal Graft"},ED.CornealInlay=function(a,b){this.className="CornealInlay",this.type="Type 1",this.savedParameterArray=["scaleX","scaleY","rotation","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,a,b)},ED.CornealInlay.prototype=new ED.Doodle,ED.CornealInlay.prototype.constructor=ED.CornealInlay,ED.CornealInlay.superclass=ED.Doodle.prototype,ED.CornealInlay.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.75,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.75,1),this.parameterValidationArray.type={kind:"other",type:"string",list:["Type 1","Type 2"],animate:!1}},ED.CornealInlay.prototype.setParameterDefaults=function(){},ED.CornealInlay.prototype.draw=function(a){var b=this.drawing.context;ED.CornealInlay.superclass.draw.call(this,a);var c=200,d=100,e=0,f=2*Math.PI;return b.beginPath(),b.arc(0,0,c,e,f,!0),b.arc(0,0,d,e,f,!1),b.lineWidth=2,b.fillStyle="rgba(155,155,155,0.8)",b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.isClicked},ED.CornealInlay.prototype.description=function(){var a="Corneal inlay "+this.type;return a},ED.CornealOedema=function(a,b){this.className="CornealOedema",this.numberOfHandles=4,this.initialRadius=360,this.intensity="Mild",this.savedParameterArray=["originX","originY","apexX","apexY","rotation","intensity"],this.controlParameterArray={intensity:"Intensity"},ED.Doodle.call(this,a,b)},ED.CornealOedema.prototype=new ED.Doodle,ED.CornealOedema.prototype.constructor=ED.CornealOedema,ED.CornealOedema.superclass=ED.Doodle.prototype,ED.CornealOedema.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealOedema.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80),this.parameterValidationArray.intensity={kind:"derived",type:"string",list:["Mild","Moderate","Severe"],animate:!1}},ED.CornealOedema.prototype.setParameterDefaults=function(){this.apexY=-this.initialRadius},ED.CornealOedema.prototype.draw=function(a){var b=this.drawing.context;ED.CornealOedema.superclass.draw.call(this,a),b.beginPath();var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);switch(b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=4,this.intensity){case"Mild":b.fillStyle="rgba(0, 0, 255, 0.2)";break;case"Moderate":b.fillStyle=b.createPattern(this.drawing.imageArray.OedemaPattern,"repeat");break;case"Severe":b.fillStyle=b.createPattern(this.drawing.imageArray.OedemaPatternBullous,"repeat")}if(b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw);return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CornealOedema.prototype.description=function(){return"Corneal oedema"},ED.CornealScar=function(a,b){this.className="CornealScar",this.isInVisualAxis=!1,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CornealScar.prototype=new ED.Doodle,ED.CornealScar.prototype.constructor=ED.CornealScar,ED.CornealScar.superclass=ED.Doodle.prototype,ED.CornealScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CornealScar.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-10)},ED.CornealScar.prototype.setParameterDefaults=function(){this.apexY=-50,this.scaleX=.7,this.scaleY=.5,this.setOriginWithDisplacements(0,25)},ED.CornealScar.prototype.draw=function(a){var b=this.drawing.context;ED.CornealScar.superclass.draw.call(this,a),b.beginPath();var c=100;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath();var d=-this.apexY/100;if(b.fillStyle="rgba(100,100,100,"+d.toFixed(2)+")",b.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var e=new ED.Point(0,0),f=this.drawing.transform.transformPoint(e),b=this.drawing.context;this.isInVisualAxis=b.isPointInPath(f.x,f.y)?!0:!1}var g=new ED.Point(0,0);return g.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(g),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CornealScar.prototype.description=function(){var a="",b=this.scaleX+this.scaleY;return a=2>b?"Small ":4>b?"Medium ":"Large ",a+="corneal scar",this.isInVisualAxis&&(a+=" involving visual axis"),a},ED.CornealScar.prototype.snomedCode=function(){return 95726001},ED.CornealScar.prototype.diagnosticHierarchy=function(){return 2},ED.CornealStriae=function(a,b){this.className="CornealStriae",ED.Doodle.call(this,a,b)},ED.CornealStriae.prototype=new ED.Doodle,ED.CornealStriae.prototype.constructor=ED.CornealStriae,ED.CornealStriae.superclass=ED.Doodle.prototype,ED.CornealStriae.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1},ED.CornealStriae.prototype.draw=function(a){var b=this.drawing.context;ED.CornealStriae.superclass.draw.call(this,a),b.beginPath();var c=300;if(b.arc(0,0,c,0,2*Math.PI,!1),b.closePath(),b.fillStyle="rgba(100,100,100,0)",b.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=-300,e=50,f=30,g=80,h=-2*g;
b.beginPath();for(var i=0;5>i;i++)b.moveTo(h+g*i,d),b.bezierCurveTo(h+g*i-f,d+1*e,h+g*i-f,d+2*e,h+g*i,d+3*e),b.bezierCurveTo(h+g*i+f,d+4*e,h+g*i+f,d+5*e,h+g*i,d+6*e),b.bezierCurveTo(h+g*i-f,d+7*e,h+g*i-f,d+8*e,h+g*i,d+9*e),b.bezierCurveTo(h+g*i+f,d+10*e,h+g*i+f,d+11*e,h+g*i,d+12*e);b.lineWidth=20,b.strokeStyle="rgba(100,100,100,0.6)",b.stroke()}return this.isClicked},ED.CornealStriae.prototype.description=function(){return"Striate keratopathy"},ED.CornealSuture=function(a,b){this.className="CornealSuture",this.savedParameterArray=["radius","rotation"],ED.Doodle.call(this,a,b)},ED.CornealSuture.prototype=new ED.Doodle,ED.CornealSuture.prototype.constructor=ED.CornealSuture,ED.CornealSuture.superclass=ED.Doodle.prototype,ED.CornealSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CornealSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.CornealSuture.prototype.draw=function(a){var b=this.drawing.context;ED.CornealSuture.superclass.draw.call(this,a),b.beginPath();var c=this.radius;if(b.rect(-20,-(c+40),40,80),b.closePath(),b.fillStyle="rgba(255,255,255,0.0)",b.lineWidth=6,b.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.moveTo(0,-c-40),b.lineTo(0,-c+40),b.moveTo(-10,-c+10),b.lineTo(0,-c+20),b.lineTo(-10,-c+30),b.lineWidth=2;var d="rgba(0,0,120,0.7)";b.strokeStyle=d,b.stroke(),this.drawSpot(b,0,-c+20,4,d)}return this.isClicked},ED.CornealSuture.prototype.description=function(){var a="Corneal suture at ";return a+=this.clockHour()+" o'clock"},ED.CorticalCataract=function(a,b){this.className="CorticalCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,a,b)},ED.CorticalCataract.prototype=new ED.Doodle,ED.CorticalCataract.prototype.constructor=ED.CorticalCataract,ED.CorticalCataract.superclass=ED.Doodle.prototype,ED.CorticalCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens","PostSubcapCataract","NuclearCataract"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.CorticalCataract.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.grade=-120>b?"Mild":-60>b?"Moderate":"White";break;case"grade":switch(b){case"Mild":c.apexY=-180;break;case"Moderate":c.apexY=-100;break;case"White":c.apexY=-20}}return c},ED.CorticalCataract.prototype.draw=function(a){var b=this.drawing.context;ED.CorticalCataract.superclass.draw.call(this,a),b.beginPath();var c=16,d=240,e=230,f=2*Math.PI/c,g=f/2,h=-this.apexY,i=new ED.Point(0,0);i.setWithPolars(e,-g),b.moveTo(i.x,i.y);for(var j=0;c>j;j++){var k=j*f-g,l=new ED.Point(0,0);l.setWithPolars(e,k),b.lineTo(l.x,l.y);var m=new ED.Point(0,0);m.setWithPolars(h,j*f),b.lineTo(m.x,m.y)}return b.lineTo(i.x,i.y),b.moveTo(d,0),b.arc(0,0,d,0,2*Math.PI,!0),b.lineWidth=4,b.lineJoin="bevel",b.fillStyle="rgba(200,200,200,0.75)",b.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CorticalCataract.prototype.description=function(){return this.getParameter("grade")+" cortical cataract"},ED.CorticalCataract.prototype.snomedCode=function(){return 193576003},ED.CorticalCataract.prototype.diagnosticHierarchy=function(){return 3},ED.CorticalCataractCrossSection=function(a,b){this.className="CorticalCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,a,b)},ED.CorticalCataractCrossSection.prototype=new ED.Doodle,ED.CorticalCataractCrossSection.prototype.constructor=ED.CorticalCataractCrossSection,ED.CorticalCataractCrossSection.superclass=ED.Doodle.prototype,ED.CorticalCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.CorticalCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","White"],animate:!0}},ED.CorticalCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.setParameterFromString("grade","Mild")},ED.CorticalCataractCrossSection.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.grade=-120>b?"Mild":-60>b?"Moderate":"White";break;case"grade":switch(b){case"Mild":c.apexY=-180;break;case"Moderate":c.apexY=-100;break;case"White":c.apexY=-20}}return c},ED.CorticalCataractCrossSection.prototype.draw=function(a){var b=this.drawing.context;ED.CorticalCataractCrossSection.superclass.draw.call(this,a);var c=240,d=300,e=100,f=Math.asin(c/d),g=d*Math.cos(f),h=d-30;f=Math.acos(g/h);var i=Math.asin(-this.apexY/h);b.beginPath(),b.arc(e-g,0,h,i,f,!1),b.arc(e+g,0,h,Math.PI-f,Math.PI-i,!1);var j=h*Math.cos(i);return b.moveTo(e-g+j,this.apexY),b.arc(e-g,0,h,-i,-f,!0),b.arc(e+g,0,h,Math.PI+f,Math.PI+i,!0),b.lineWidth=30,b.lineCap="round",b.lineJoin="round",b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(200,200,200,0.75)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(e,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CottonWoolSpot=function(a,b){this.className="CottonWoolSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CottonWoolSpot.prototype=new ED.Doodle,ED.CottonWoolSpot.prototype.constructor=ED.CottonWoolSpot,ED.CottonWoolSpot.superclass=ED.Doodle.prototype,ED.CottonWoolSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CottonWoolSpot.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CottonWoolSpot.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-150,150)},ED.CottonWoolSpot.prototype.draw=function(a){var b=this.drawing.context;ED.CottonWoolSpot.superclass.draw.call(this,a);var c=80,d=50,e=d/3;return b.beginPath(),b.moveTo(-c,-d),b.lineTo(-c+e,-d+1*e),b.lineTo(-c,-d+2*e),b.lineTo(-c+e,-d+3*e),b.lineTo(-c,-d+4*e),b.lineTo(-c+e,-d+5*e),b.lineTo(-c,-d+6*e),b.bezierCurveTo(-c+e,-d+7*e,c-e,-d+7*e,c,-d+6*e),b.lineTo(c-e,-d+5*e),b.lineTo(c,-d+4*e),b.lineTo(c-e,-d+3*e),b.lineTo(c,-d+2*e),b.lineTo(c-e,-d+1*e),b.lineTo(c,-d),b.bezierCurveTo(c-e,-d-e,-c+e,-d-e,-c,-d),b.closePath(),b.lineWidth=4,b.strokeStyle="gray",b.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(c,-d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CottonWoolSpot.prototype.groupDescription=function(){return"Cotton wool spots"},ED.Cryo=function(a,b){this.className="Cryo",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,a,b)},ED.Cryo.prototype=new ED.Doodle,ED.Cryo.prototype.constructor=ED.Cryo,ED.Cryo.superclass=ED.Doodle.prototype,ED.Cryo.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Cryo.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.Cryo.prototype.setParameterDefaults=function(){this.apexY=-40,this.rotation=Math.PI/4;var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.Cryo.prototype.draw=function(a){var b=this.drawing.context;ED.Cryo.superclass.draw.call(this,a),b.beginPath();var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=8;var d=b.createPattern(this.drawing.imageArray.CryoPattern,"repeat");return b.fillStyle=d,b.strokeStyle="rgba(80, 40, 0, 1)",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Cryo.prototype.groupDescription=function(){return"Cryotherapy"},ED.CutterPI=function(a,b){this.className="CutterPI",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.CutterPI.prototype=new ED.Doodle,ED.CutterPI.prototype.constructor=ED.CutterPI,ED.CutterPI.superclass=ED.Doodle.prototype,ED.CutterPI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.CutterPI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(160,40)},ED.CutterPI.prototype.draw=function(a){var b=this.drawing.context;return ED.CutterPI.superclass.draw.call(this,a),b.beginPath(),b.arc(0,-324,40,0,2*Math.PI,!0),b.fillStyle="rgba(255,255,255,1)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.isClicked},ED.CutterPI.prototype.groupDescription=function(){return"Cutter iridectomy/s"},ED.CystoidMacularOedema=function(a,b){this.className="CystoidMacularOedema",this.savedParameterArray=["scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.CystoidMacularOedema.prototype=new ED.Doodle,ED.CystoidMacularOedema.prototype.constructor=ED.CystoidMacularOedema,ED.CystoidMacularOedema.superclass=ED.Doodle.prototype,ED.CystoidMacularOedema.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.CystoidMacularOedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.CystoidMacularOedema.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.scaleX=.5,this.scaleY=this.scaleX,this.originX=this.drawing.eye==ED.eye.Right?-100:100)},ED.CystoidMacularOedema.prototype.draw=function(a){var b=this.drawing.context;if(ED.CystoidMacularOedema.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,120,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var c="rgba(255, 255, 138, 0.5)",d="rgba(255, 82, 0, 0.7)",e=new ED.Point(0,0),f=8,g=0;f>g;g++){var h=2*g*Math.PI/f;e.setWithPolars(80,h),this.drawCircle(b,e.x,e.y,40,c,2,d)}this.drawCircle(b,0,0,60,c,2,d)}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(84,-84)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.CystoidMacularOedema.prototype.description=function(){return"Cystoid macular oedema"},ED.CystoidMacularOedema.prototype.snomedCode=function(){return 193387007},ED.CystoidMacularOedema.prototype.diagnosticHierarchy=function(){return 2},ED.DiabeticNV=function(a,b){this.className="DiabeticNV",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.DiabeticNV.prototype=new ED.Doodle,ED.DiabeticNV.prototype.constructor=ED.DiabeticNV,ED.DiabeticNV.superclass=ED.Doodle.prototype,ED.DiabeticNV.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.DiabeticNV.prototype.setPropertyDefaults=function(){},ED.DiabeticNV.prototype.setParameterDefaults=function(){var a=this.drawing.numberOfDoodlesOfClass(this.className);switch(a){case 0:this.originX=this.drawing.eye==ED.eye.Right?300:-300,this.originY=-100;break;case 1:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=-236;break;case 2:this.originX=this.drawing.eye==ED.eye.Right?-176:176,this.originY=236;break;default:this.setOriginWithDisplacements(0,-100)}},ED.DiabeticNV.prototype.draw=function(a){var b=this.drawing.context;ED.DiabeticNV.superclass.draw.call(this,a),b.beginPath();var c=60,d=c/2,e=0,f=Math.PI/8,g=8,h=new ED.Point(0,0),i=new ED.Point(0,0),j=new ED.Point(0,0),k=new ED.Point(0,0),l=new ED.Point(0,0);b.moveTo(0,0);var m;for(m=0;g>m;m++)e=2*m*Math.PI/g,h.setWithPolars(d,e-f),i.setWithPolars(c,e-f),j.setWithPolars(c,e),k.setWithPolars(c,e+f),l.setWithPolars(d,e+f),b.bezierCurveTo(h.x,h.y,i.x,i.y,j.x,j.y),b.bezierCurveTo(k.x,k.y,l.x,l.y,0,0);return b.fillStyle="rgba(100, 100, 100, 0)",b.lineWidth=3,b.strokeStyle="red",this.drawBoundary(a),point=new ED.Point(0,0),point.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.DiabeticNV.prototype.groupDescription=function(){return"Diabetic new vessels "},ED.DiabeticNV.prototype.description=function(){return this.locationRelativeToDisc()},ED.DiabeticNV.prototype.snomedCode=function(){return 59276001},ED.Dialysis=function(a,b){this.className="Dialysis",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.Dialysis.prototype=new ED.Doodle,ED.Dialysis.prototype.constructor=ED.Dialysis,ED.Dialysis.superclass=ED.Doodle.prototype,ED.Dialysis.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Dialysis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,Math.PI)},ED.Dialysis.prototype.setParameterDefaults=function(){this.apexY=-350,this.arc=60*Math.PI/180,this.setRotationWithDisplacements(140,60)},ED.Dialysis.prototype.draw=function(a){var b=this.drawing.context;ED.RRD.superclass.draw.call(this,a);var c=476,d=this.arc/2,e=-Math.PI/2+d,f=-Math.PI/2-d,g=c*Math.sin(d),h=-c*Math.cos(d),i=-c*Math.sin(d),j=h;b.beginPath(),b.arc(0,0,c,e,f,!0);var k=.6;return b.bezierCurveTo(i,j,k*i,this.apexY,this.apexX,this.apexY),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h),b.lineWidth=8,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(g,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Dialysis.prototype.description=function(){var a="";return a=this.arc<Math.PI/4?"Small ":"Large ",a+="dialysis ",a+=this.clockHour()+" o'clock"},ED.Dialysis.prototype.snomedCode=function(){return 232003005},ED.Dialysis.prototype.diagnosticHierarchy=function(){return 4},ED.DiscHaemorrhage=function(a,b){this.className="DiscHaemorrhage",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.DiscHaemorrhage.prototype=new ED.Doodle,ED.DiscHaemorrhage.prototype.constructor=ED.DiscHaemorrhage,ED.DiscHaemorrhage.superclass=ED.Doodle.prototype,ED.DiscHaemorrhage.prototype.setPropertyDefaults=function(){this.isMoveable=!1},ED.DiscHaemorrhage.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(150,-120)},ED.DiscHaemorrhage.prototype.draw=function(a){var b=this.drawing.context;ED.DiscHaemorrhage.superclass.draw.call(this,a);{var c=350,d=250,e=d+(c-d)/2,f=5*Math.PI/180,g=-Math.PI/2+f,h=-Math.PI/2-f;e*Math.sin(f),-e*Math.cos(f),-e*Math.sin(f)}return b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4,b.fillStyle="red",b.strokeStyle="red",this.drawBoundary(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.DiscHaemorrhage.prototype.groupDescription=function(){return"Disc haemorrhage at "},ED.DiscHaemorrhage.prototype.description=function(){return this.clockHour()+" o'clock"},ED.DiscPallor=function(a,b){this.className="DiscPallor",this.grade="Sectorial",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.DiscPallor.prototype=new ED.Doodle,ED.DiscPallor.prototype.constructor=ED.DiscPallor,ED.DiscPallor.superclass=ED.Doodle.prototype,ED.DiscPallor.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.DiscPallor.prototype.setPropertyDefaults=function(){this.isArcSymmetrical=!0,this.isMoveable=!1,this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Sectorial","Diffuse"],animate:!0},this.parameterValidationArray.arc.delta=.2},ED.DiscPallor.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180,this.setRotationWithDisplacements(45,-120),this.setParameterFromString("grade","Sectorial")},ED.DiscPallor.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"arc":c.grade=b<2*Math.PI?"Sectorial":"Diffuse";break;case"grade":switch(b){case"Sectorial":c.arc=this.arc<2*Math.PI?this.arc:Math.PI/2;break;case"Diffuse":c.arc=2*Math.PI}}return c},ED.DiscPallor.prototype.draw=function(a){var b=this.drawing.context;ED.DiscPallor.superclass.draw.call(this,a);var c=300,d=this.drawing.firstDoodleOfClass("OpticDisc");if(d)var e=d.minimumRadius();else var e=150;var f=e+(c-e)/2,g=this.arc/2,h=-Math.PI/2+g,i=-Math.PI/2-g,j=f*Math.sin(g),k=-f*Math.cos(g),l=-f*Math.sin(g),m=k;return b.beginPath(),b.arc(0,0,c,h,i,!0),b.arc(0,0,e,i,h,!1),b.closePath(),b.lineWidth=1,b.fillStyle="rgba(255,255,255,0.5)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,m)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(j,k)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.DiscPallor.prototype.groupDescription=function(){return"Diffuse"==this.grade?"Diffuse disc pallor":"Disc pallor at "},ED.DiscPallor.prototype.description=function(){return"Diffuse"==this.grade?"":this.clockHour()+" o'clock"},ED.DrainageRetinotomy=function(a,b){this.className="DrainageRetinotomy",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,a,b)},ED.DrainageRetinotomy.prototype=new ED.Doodle,ED.DrainageRetinotomy.prototype.constructor=ED.DrainageRetinotomy,ED.DrainageRetinotomy.superclass=ED.Doodle.prototype,ED.DrainageRetinotomy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.DrainageRetinotomy.prototype.draw=function(a){var b=this.drawing.context;return ED.DrainageRetinotomy.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,30,0,2*Math.PI,!0),b.closePath(),b.lineWidth=16,b.fillStyle="rgba(255,0,0,0.5)",b.strokeStyle="red",this.drawBoundary(a),this.isClicked},ED.DrainageRetinotomy.prototype.description=function(){return"Drainage retinotomy in "+this.quadrant()},ED.DrainageSite=function(a,b){this.className="DrainageSite",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.DrainageSite.prototype=new ED.Doodle,ED.DrainageSite.prototype.constructor=ED.DrainageSite,ED.DrainageSite.superclass=ED.Doodle.prototype,ED.DrainageSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.DrainageSite.prototype.setParameterDefaults=function(){var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+Math.PI/6:-60*Math.PI/180},ED.DrainageSite.prototype.draw=function(a){var b=this.drawing.context;ED.DrainageSite.superclass.draw.call(this,a);var c=440,d=360,e=Math.PI/30,f=-Math.PI/2+e,g=-Math.PI/2-e;return b.beginPath(),b.arc(0,0,c,f,g,!0),b.lineTo(0,-d),b.closePath(),b.lineWidth=4,b.strokeStyle="#777",this.drawBoundary(a),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.DrainageSite.prototype.groupDescription=function(){return"Drainage site at "},ED.DrainageSite.prototype.description=function(){return this.clockHour()+" o'clock"},ED.EncirclingBand=function(a,b){this.className="EncirclingBand",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.EncirclingBand.prototype=new ED.Doodle,ED.EncirclingBand.prototype.constructor=ED.EncirclingBand,ED.EncirclingBand.superclass=ED.Doodle.prototype,ED.EncirclingBand.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0},ED.EncirclingBand.prototype.setParameterDefaults=function(){this.rotation=-45*Math.PI/180},ED.EncirclingBand.prototype.draw=function(a){var b=this.drawing.context;ED.EncirclingBand.superclass.draw.call(this,a);var c=270,d=this.drawing.lastDoodleOfClass("CircumferentialBuckle");if(d){var e=d.apexY;-350>e&&e>-380?c=286:-380>e&&(c=315)}var f=c+15,g=c-15;if(b.beginPath(),b.arc(0,0,f,0,2*Math.PI,!0),b.arc(0,0,g,2*Math.PI,0,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(200,200,200,0.75)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var h=Math.PI/16;b.arc(0,0,f+10,h,-h,!0),b.arc(0,0,g-10,-h,h,!1),b.closePath(),b.lineWidth=6,b.stroke()}return this.isClicked},ED.EncirclingBand.prototype.description=function(){var a="Encircling band, with Watzke in ";if(this.drawing.eye==ED.eye.Right)var b=!0;else var b=!1;var c=this.rotation+Math.PI/2;return a+=Math.cos(c)>0?"supero":"infero",a+=Math.sin(c)>0?b?"nasal":"temporal":b?"temporal":"nasal",a+=" quadrant"},ED.EntrySiteBreak=function(a,b){this.className="EntrySiteBreak",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.EntrySiteBreak.prototype=new ED.Doodle,ED.EntrySiteBreak.prototype.constructor=ED.EntrySiteBreak,ED.EntrySiteBreak.superclass=ED.Doodle.prototype,ED.EntrySiteBreak.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.EntrySiteBreak.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,3*Math.PI/16)},ED.EntrySiteBreak.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.EntrySiteBreak.prototype.draw=function(a){var b=this.drawing.context;ED.EntrySiteBreak.superclass.draw.call(this,a);var c=460,d=400,e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=c*Math.sin(e),i=-c*Math.cos(e),j=-c*Math.sin(e),k=i;return b.beginPath(),b.arc(0,0,c,f,g,!0),b.bezierCurveTo(0,-d,0,-d,h,i),b.lineWidth=4,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.EpiretinalMembrane=function(a,b){this.className="EpiretinalMembrane",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,a,b)},ED.EpiretinalMembrane.prototype=new ED.Doodle,ED.EpiretinalMembrane.prototype.constructor=ED.EpiretinalMembrane,ED.EpiretinalMembrane.superclass=ED.Doodle.prototype,ED.EpiretinalMembrane.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.EpiretinalMembrane.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.EpiretinalMembrane.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.scaleX=.5,this.scaleY=this.scaleX,this.originX=this.drawing.eye==ED.eye.Right?-100:100)},ED.EpiretinalMembrane.prototype.draw=function(a){var b=this.drawing.context;ED.EpiretinalMembrane.superclass.draw.call(this,a),b.beginPath();var c=120;if(b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.strokeStyle="rgba(0, 255, 0, 0.7)",b.beginPath(),b.moveTo(-c,0),b.lineTo(c,0);var d=.9*c,e=-c/2,f=.3;b.moveTo(-d,e),b.bezierCurveTo(-d*f,e*f,d*f,e*f,d,e),e=c/2,b.moveTo(-d,e),b.bezierCurveTo(-d*f,e*f,d*f,e*f,d,e),d=.6*c,e=.8*-c,f=.5,b.moveTo(-d,e),b.bezierCurveTo(-d*f,e*f,d*f,e*f,d,e),e=.8*c,b.moveTo(-d,e),b.bezierCurveTo(-d*f,e*f,d*f,e*f,d,e),b.lineWidth=18,b.lineCap="round",b.stroke()}return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*c,.7*-c)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.EpiretinalMembrane.prototype.description=function(){var a="Epiretinal membrane";return a},ED.EpiretinalMembrane.prototype.snomedCode=function(){return 367649002},ED.EpiretinalMembrane.prototype.diagnosticHierarchy=function(){return 2},ED.FibrousProliferation=function(a,b){this.className="FibrousProliferation",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,a,b)},ED.FibrousProliferation.prototype=new ED.Doodle,ED.FibrousProliferation.prototype.constructor=ED.FibrousProliferation,ED.FibrousProliferation.superclass=ED.Doodle.prototype,ED.FibrousProliferation.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.FibrousProliferation.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrousProliferation.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-200,150),this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/4:Math.PI/4},ED.FibrousProliferation.prototype.draw=function(a){var b=this.drawing.context;ED.FibrousProliferation.superclass.draw.call(this,a);var c=180,d=70,e=.6*c,f=.2*d;return b.beginPath(),b.moveTo(-c,-d),b.bezierCurveTo(-e,-f,e,-f,c,-d),b.bezierCurveTo(e,-f,e,f,c,d),b.bezierCurveTo(e,f,-e,f,-c,d),b.bezierCurveTo(-e,f,-e,-f,-c,-d),b.closePath(),b.lineWidth=1,b.strokeStyle="rgba(120,120,120,0.5)",b.fillStyle="rgba(120,120,120,0.5)",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(c,-d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.FibrousProliferation.prototype.description=function(){return"Fibrous proliferation"},ED.FibrovascularScar=function(a,b){this.className="FibrovascularScar",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.FibrovascularScar.prototype=new ED.Doodle,ED.FibrovascularScar.prototype.constructor=ED.FibrovascularScar,ED.FibrovascularScar.superclass=ED.Doodle.prototype,ED.FibrovascularScar.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.FibrovascularScar.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.FibrovascularScar.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-100)},ED.FibrovascularScar.prototype.draw=function(a){var b=this.drawing.context;ED.FibrovascularScar.superclass.draw.call(this,a),b.beginPath();var c=80,d=16,e=2*Math.PI/d,f=.5*Math.PI/d,g=4,h=new ED.Point(0,0),i=new ED.Point(0,0);i.setWithPolars(c,0),b.moveTo(i.x,i.y);for(var j=c,k=0;d>k;k++){var l=c*(g+ED.randomArray[k])/g,m=new ED.Point(0,0);m.setWithPolars(j,k*e+f);var n=new ED.Point(0,0);n.setWithPolars(l,(k+1)*e-f);var o=new ED.Point(0,0);o.setWithPolars(l,(k+1)*e),j=l,k==d-1?b.bezierCurveTo(m.x,m.y,n.x,n.y,i.x,i.y):b.bezierCurveTo(m.x,m.y,n.x,n.y,o.x,o.y),1==k&&(h.x=o.x,h.y=o.y)}return b.closePath(),b.lineWidth=0,b.fillStyle="rgba(255,255,190,1)",b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,.8*c,0,2*Math.PI,!1),b.closePath(),b.fillStyle="rgba(255,255,230,1)",b.fill()),this.handleArray[2].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.FibrovascularScar.prototype.description=function(){return"Fibrovascular scar"},ED.FieldCircle=function(a,b){this.className="FieldCircle",this.colour=new ED.Colour(255,0,0,1),this.savedParameterArray=["originX","originY","colour"],ED.Doodle.call(this,a,b)},ED.FieldCircle.prototype=new ED.Doodle,ED.FieldCircle.prototype.constructor=ED.FieldCircle,ED.FieldCircle.superclass=ED.Doodle.prototype,ED.FieldCircle.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.colour={kind:"derived",type:"colour"}},ED.FieldCircle.prototype.setParameterDefaults=function(){},ED.FieldCircle.prototype.draw=function(a){var b=this.drawing.context;return ED.FieldCircle.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,50,0,2*Math.PI,!0),b.closePath(),b.lineWidth=1,b.fillStyle=this.colour.rgba(),b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.isClicked},ED.FocalChoroiditis=function(a,b){this.className="FocalChoroiditis",this.pigmented=!1,this.numberOfHandles=4,this.initialRadius=80,this.savedParameterArray=["pigmented","originX","originY","apexX","apexY","rotation"],this.controlParameterArray={pigmented:"Pigmented"},ED.Doodle.call(this,a,b)},ED.FocalChoroiditis.prototype=new ED.Doodle,ED.FocalChoroiditis.prototype.constructor=ED.FocalChoroiditis,ED.FocalChoroiditis.superclass=ED.Doodle.prototype,ED.FocalChoroiditis.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.FocalChoroiditis.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=this.numberOfHandles,d=new Object;d.length=new ED.Range(50,290),d.angle=new ED.Range(((2*c-1)*b/(2*c)+a*b/c)%b,(1*b/(2*c)+a*b/c)%b),this.handleVectorRangeArray[a]=d}this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-50,50),this.addAtBack=!0,this.parameterValidationArray.pigmented={kind:"derived",type:"bool",display:!0}},ED.FocalChoroiditis.prototype.setParameterDefaults=function(){this.apexY=50,this.setOriginWithDisplacements(200,150);var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a);for(var b=0;b<this.numberOfHandles;b++){var c=new ED.Point(0,0);c.setWithPolars(this.initialRadius,2*b*Math.PI/this.numberOfHandles),this.addPointToSquiggle(c)}},ED.FocalChoroiditis.prototype.draw=function(a){var b=this.drawing.context;ED.FocalChoroiditis.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y)
}b.closePath(),b.lineWidth=8,this.pigmented?(b.fillStyle="rgba(255, 255, 200, 0.8)",b.strokeStyle="brown"):(b.fillStyle="rgba(255, 255, 0, 0.8)",b.strokeStyle=b.fillStyle),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw;for(var h=0;h<this.numberOfHandles;h++)this.handleArray[h].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[h]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.FocalChoroiditis.prototype.description=function(){return"FocalChoroiditis"},ED.FocalLaser=function(a,b){this.className="FocalLaser",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,a,b)},ED.FocalLaser.prototype=new ED.Doodle,ED.FocalLaser.prototype.constructor=ED.FocalLaser,ED.FocalLaser.superclass=ED.Doodle.prototype,ED.FocalLaser.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.FocalLaser.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-75,-50)},ED.FocalLaser.prototype.setParameterDefaults=function(){this.apexY=-50,this.setOriginWithDisplacements(150,80)},ED.FocalLaser.prototype.draw=function(a){var b=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,a);var c=-this.apexY;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.apexY<=-75){var d=50,e=d/Math.sqrt(2);this.drawLaserSpot(b,0,-d),this.drawLaserSpot(b,e,-e),this.drawLaserSpot(b,d,0),this.drawLaserSpot(b,e,e),this.drawLaserSpot(b,0,d),this.drawLaserSpot(b,-e,e),this.drawLaserSpot(b,-d,0),this.drawLaserSpot(b,-e,-e)}var f=25;this.drawLaserSpot(b,0,-f),this.drawLaserSpot(b,f,0),this.drawLaserSpot(b,0,f),this.drawLaserSpot(b,-f,0),this.drawLaserSpot(b,0,0)}var g=new ED.Point(0,0);return g.setWithPolars(c,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(g),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.FocalLaser.prototype.groupDescription=function(){return"Focal laser"},ED.Fuchs=function(a,b){this.className="Fuchs",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.Fuchs.prototype=new ED.Doodle,ED.Fuchs.prototype.constructor=ED.Fuchs,ED.Fuchs.superclass=ED.Doodle.prototype,ED.Fuchs.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.Fuchs.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.isUnique=!0},ED.Fuchs.prototype.draw=function(a){var b=this.drawing.context;ED.Fuchs.superclass.draw.call(this,a),b.beginPath();var c=300;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath();var d=b.createPattern(this.drawing.imageArray.FuchsPattern,"repeat");b.fillStyle=d,b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a);var e=new ED.Point(0,0);return e.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(e),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Fuchs.prototype.description=function(){return"Fuch's Endothelial Dystrophy"},ED.Fuchs.prototype.snomedCode=function(){return 193839007},ED.Fuchs.prototype.diagnosticHierarchy=function(){return 2},ED.Fundus=function(a,b){this.className="Fundus",ED.Doodle.call(this,a,b)},ED.Fundus.prototype=new ED.Doodle,ED.Fundus.prototype.constructor=ED.Fundus,ED.Fundus.superclass=ED.Doodle.prototype,ED.Fundus.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isFilled=!1,this.showsToolTip=!1},ED.Fundus.prototype.draw=function(a){var b=this.drawing.context;if(ED.Fundus.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,480,0,2*Math.PI,!0),b.closePath(),b.lineWidth=2,b.strokeStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.drawing.eye!=ED.eye.Right)var c=200,d=100,e=-50,f=-100,g=100;else var c=-200,d=-100,e=50,f=100,g=-100;b.moveTo(c,-50),b.bezierCurveTo(d,-166,0,-62,0,-12),b.bezierCurveTo(0,-40,e,-100,f,-50),b.moveTo(c,50),b.bezierCurveTo(d,166,0,62,0,12),b.bezierCurveTo(0,40,e,100,f,50);var h=10;b.moveTo(g,-h),b.lineTo(g,h),b.moveTo(g-h,0),b.lineTo(g+h,0),b.moveTo(25,0),b.arc(0,0,25,0,2*Math.PI,!0),b.moveTo(12,0),b.arc(0,0,12,0,2*Math.PI,!0),b.stroke()}return this.isClicked},ED.GRT=function(a,b){this.className="GRT",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.GRT.prototype=new ED.Doodle,ED.GRT.prototype.constructor=ED.GRT,ED.GRT.superclass=ED.Doodle.prototype,ED.GRT.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.GRT.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-250),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/2,2*Math.PI)},ED.GRT.prototype.setParameterDefaults=function(){this.arc=90*Math.PI/180,this.apexY=-350,this.setRotationWithDisplacements(0,120)},ED.GRT.prototype.draw=function(a){var b=this.drawing.context;ED.RRD.superclass.draw.call(this,a);var c=476,d=-this.apexY,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=this.arc/2.3,j=-Math.PI/2+i,k=-Math.PI/2-i,l=c*Math.sin(f),m=-c*Math.cos(f),n=-c*Math.sin(f),o=m,p=e*Math.sin(i),q=-e*Math.cos(i),r=-p,s=q,t=d*Math.sin(f),u=-d*Math.cos(f),v=-t,w=u;return b.beginPath(),b.arc(0,0,c,g,h,!0),b.lineTo(r,s),b.lineTo(v,w),b.arc(0,0,d,h,g,!1),b.lineTo(p,q),b.closePath(),b.lineWidth=8,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,e,j,k,!0),b.strokeStyle="darkred",b.stroke()),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(n,o)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(l,m)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.GRT.prototype.description=function(){var a="Giant Retinal Tear ",b=this.rotation-this.arc/2,c=Math.floor((6*(b+.2618)/Math.PI+12)%12);0==c&&(c=12);var d=180*this.arc/Math.PI;return d=10*Math.floor((d+5)/10),a=a+d+" degrees clockwise from "+c+" o'clock"},ED.GRT.prototype.snomedCode=function(){return 232004004},ED.GRT.prototype.diagnosticHierarchy=function(){return 7},ED.Geographic=function(a,b){this.className="Geographic",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.Geographic.prototype=new ED.Doodle,ED.Geographic.prototype.constructor=ED.Geographic,ED.Geographic.superclass=ED.Doodle.prototype,ED.Geographic.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Geographic.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Geographic.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.Geographic.prototype.draw=function(a){var b=this.drawing.context;ED.Geographic.superclass.draw.call(this,a);var c=200,d=-this.apexY,e=-this.apexY*Math.PI/800;b.beginPath();var f=new ED.Point(0,0);return this.drawing.eye==ED.eye.Right?(b.arc(0,0,c,e,2*Math.PI-e,!1),f.setWithPolars(d,Math.PI/2-e),b.lineTo(f.x,f.y),b.arc(0,0,d,2*Math.PI-e,e,!0)):(b.arc(0,0,c,Math.PI-e,-Math.PI+e,!0),f.setWithPolars(d,e-Math.PI/2),b.lineTo(f.x,f.y),b.arc(0,0,d,-Math.PI+e,Math.PI-e,!1)),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,255,50,0.8)",b.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,f=new ED.Point(0,0),f.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(f),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Geographic.prototype.description=function(){return"Geographic atrophy"},ED.Geographic.prototype.snomedCode=function(){return 414875008},ED.Geographic.prototype.diagnosticHierarchy=function(){return 2},ED.Gonioscopy=function(a,b){this.className="Gonioscopy",this.rsl=480,this.rsli=470,this.rtmo=404,this.rtmi=304,this.rcbo=270,this.rcbi=190,this.riro=190,this.riri=176,this.rpu=100,this.mode="Basic",this.savedParameterArray=["apexX","apexY","mode"],ED.Doodle.call(this,a,b)},ED.Gonioscopy.prototype=new ED.Doodle,ED.Gonioscopy.prototype.constructor=ED.Gonioscopy,ED.Gonioscopy.superclass=ED.Doodle.prototype,ED.Gonioscopy.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Gonioscopy.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-460,-420),this.parameterValidationArray.apexY.range.setMinAndMax(-460,-400),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1}},ED.Gonioscopy.prototype.setParameterDefaults=function(){this.apexX=-460,this.apexY=-460,this.setParameterFromString("mode","Basic")},ED.Gonioscopy.prototype.draw=function(a){var b=this.drawing.context;ED.Gonioscopy.superclass.draw.call(this,a);var c=0,d=2*Math.PI;if(b.beginPath(),b.arc(0,0,this.rsl,c,d,!0),b.lineWidth=15,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="rgba(200, 200, 200, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(0,0,this.rtmo,c,d,!0),b.moveTo(this.rtmi,0),b.arc(0,0,this.rtmi,d,c,!1),b.lineWidth=1;var e;this.apexX<-440?(e=this.apexY<-440?b.createPattern(this.drawing.imageArray.MeshworkPatternLight,"repeat"):this.apexY<-420?b.createPattern(this.drawing.imageArray.MeshworkPatternMedium,"repeat"):b.createPattern(this.drawing.imageArray.MeshworkPatternHeavy,"repeat"),b.fillStyle=e):b.fillStyle=this.apexY<-440?"rgba(250, 200, 0, 1)":this.apexY<-420?"rgba(200, 150, 0, 1)":"rgba(150, 100, 0, 1)",b.strokeStyle="rgba(200, 200, 200, 1)",b.fill(),b.stroke(),b.beginPath(),b.arc(0,0,this.rcbo,c,d,!0),b.arc(0,0,this.rcbi,d,c,!1),b.fillStyle="rgba(200, 200, 200, 1)",b.fill();var f=15,g=new ED.Point(0,0),h=new ED.Point(0,0),i=0;for(i=0;12>i;i++){var j=(f+30*i)*Math.PI/180;g.setWithPolars(this.rcbi,j),b.beginPath(),b.moveTo(g.x,g.y),1==i||4==i||7==i||10==i?(h.setWithPolars(this.rsl+80,j),b.lineWidth=6,b.strokeStyle="rgba(20, 20, 20, 1)"):(h.setWithPolars(this.rsl,j),b.lineWidth=2,b.strokeStyle="rgba(137, 137, 137, 1)"),b.lineTo(h.x,h.y),b.closePath(),b.stroke()}b.beginPath(),b.arc(0,0,this.riro,c,d,!0),b.arc(0,0,this.riri,d,c,!1),b.lineWidth=2,b.strokeStyle="rgba(180, 180, 180, 1)",b.fillStyle="rgba(200, 200, 200, 1)",b.fill(),b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Gonioscopy.prototype.description=function(){var a="";return a=this.apexX<-440?this.apexY<-440?"Light patchy pigment":this.apexY<-420?"Medium patchy pigment":"Heavy patchy pigment":this.apexY<-440?"Light homogenous pigment":this.apexY<-420?"Medium homogenous pigment":"Heavy homogenous pigment"},ED.HVT=function(a,b){this.className="HVT",this.hor="None",this.ver="None",this.tor="None",this.horValue=0,this.verValue=0,this.torValue=0,ED.Doodle.call(this,a,b)},ED.HVT.prototype=new ED.Doodle,ED.HVT.prototype.constructor=ED.HVT,ED.HVT.superclass=ED.Doodle.prototype,ED.HVT.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.HVT.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.parameterValidationArray.originX.range=new ED.Range(-350,-150),this.parameterValidationArray.originY.range=new ED.Range(-100,100),this.parameterValidationArray.rotation.range=new ED.Range(0,Math.PI/2),this.parameterValidationArray.hor={kind:"derived",type:"string",list:["XT","None","ET"],animate:!0},this.parameterValidationArray.ver={kind:"derived",type:"string",list:["R/L","None","L/R"],animate:!0},this.parameterValidationArray.tor={kind:"derived",type:"string",list:["Excyclotorsion","None","Incyclotorsion"],animate:!0},this.parameterValidationArray.horValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.verValue={kind:"derived",type:"int",range:new ED.Range(0,50),animate:!0},this.parameterValidationArray.torValue={kind:"derived",type:"int",range:new ED.Range(0,20),animate:!0}},ED.HVT.prototype.setParameterDefaults=function(){},ED.HVT.prototype.dependentParameterValues=function(a,b){var c=new Array,d=-250;switch(a){case"originX":var e=20;c.hor=d-e>b?"XT":b>d+e?"ET":"None",c.horValue=Math.abs(Math.round((d-b)/2));break;case"originY":var e=20;c.ver=0-e>b?"R/L":b>0+e?"L/R":"None",c.verValue=Math.abs(Math.round(-b/2));break;case"rotation":var e=Math.PI/16;c.tor=b<Math.PI/4-e?"Excyclotorsion":b>Math.PI/4+e?"Incyclotorsion":"None",c.torValue=Math.abs(Math.round(80*(b-Math.PI/4)/Math.PI));break;case"hor":switch(b){case"XT":c.originX=d-100;break;case"ET":c.originX=d+100;break;default:c.originX=d}break;case"ver":switch(b){case"R/L":c.originY=-100;break;case"L/R":c.originY=100;break;default:c.originY=0}break;case"tor":switch(b){case"Excyclotorsion":c.rotation=0;break;case"Incyclotorsion":c.rotation=Math.PI/2;break;default:c.rotation=Math.PI/4}break;case"horValue":switch(this.hor){case"XT":c.originX=d-2*b;break;case"None":c.originX=d;break;case"ET":c.originX=d+2*b}break;case"verValue":switch(this.ver){case"R/L":c.originY=2*-b;break;case"None":c.originY=Math.PI/4;break;case"L/R":c.originY=2*b}break;case"torValue":switch(this.tor){case"Excyclotorsion":c.rotation=-b*Math.PI/80+Math.PI/4;break;case"None":c.rotation=Math.PI/4;break;case"Incyclotorsion":c.rotation=b*Math.PI/80+Math.PI/4}}return c},ED.HVT.prototype.draw=function(a){var b=this.drawing.context;ED.HVT.superclass.draw.call(this,a);var c=125,d=40,e=1.75*Math.PI,f=new ED.Point(0,0);if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.moveTo(d,0),b.arc(0,0,d,2*Math.PI,0,!1),b.lineWidth=4,b.fillStyle=b.fillStyle="rgba(100, 200, 250, 0.5)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var g=5;b.beginPath(),f.setWithPolars(c-g,e),b.moveTo(f.x,f.y),f.setWithPolars(d+g,e),b.lineTo(f.x,f.y),f.setWithPolars(-c+g,e),b.moveTo(f.x,f.y),f.setWithPolars(-d-g,e),b.lineTo(f.x,f.y),b.lineWidth=20,b.strokeStyle=this.originX>0?"rgba(255, 0, 0, 0.8)":"rgba(0, 155, 0, 0.8)",b.stroke()}return f.setWithPolars(c,e),this.handleArray[1].location=this.transform.transformPoint(f),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.HVTGrid=function(a,b){this.className="HVTGrid",ED.Doodle.call(this,a,b)},ED.HVTGrid.prototype=new ED.Doodle,ED.HVTGrid.prototype.constructor=ED.HVTGrid,ED.HVTGrid.superclass=ED.Doodle.prototype,ED.HVTGrid.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isSelectable=!1},ED.HVTGrid.prototype.draw=function(a){var b=this.drawing.context;ED.HVTGrid.superclass.draw.call(this,a),b.beginPath();var c=125,d=2*c;return b.moveTo(-2*d,0),b.lineTo(2*d,0),b.moveTo(-d,-d),b.lineTo(-d,+d),b.moveTo(+d,-d),b.lineTo(+d,+d),b.lineWidth=4,b.strokeStyle="gray",this.drawBoundary(a),this.isClicked},ED.HardDrusen=function(a,b){this.className="HardDrusen",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.HardDrusen.prototype=new ED.Doodle,ED.HardDrusen.prototype.constructor=ED.HardDrusen,ED.HardDrusen.superclass=ED.Doodle.prototype,ED.HardDrusen.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.HardDrusen.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.HardDrusen.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.HardDrusen.prototype.draw=function(a){var b=this.drawing.context;ED.HardDrusen.superclass.draw.call(this,a),b.beginPath();var c=200;if(b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var d="yellow",e=10/this.scaleX,f=new ED.Point(0,0),g=20+Math.abs(Math.floor(this.apexY/2)),h=0;g>h;h++)f.setWithPolars(c*ED.randomArray[h],2*Math.PI*ED.randomArray[h+100]),this.drawSpot(b,f.x,f.y,e,d);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*c,.7*-c)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.HardDrusen.prototype.description=function(){var a="Signficant numbers of ";return this.apexY>-100&&(a="Moderate numbers of "),this.apexY>-50&&(a="Several "),a+"hard drusen"},ED.HardExudate=function(a,b){this.className="HardExudate",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,a,b)},ED.HardExudate.prototype=new ED.Doodle,ED.HardExudate.prototype.constructor=ED.HardExudate,ED.HardExudate.superclass=ED.Doodle.prototype,ED.HardExudate.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.HardExudate.prototype.draw=function(a){var b=this.drawing.context;ED.HardExudate.superclass.draw.call(this,a);var c=14;return b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="rgba(220,220,0,1)",b.fillStyle="rgba(220,220,0,1)",this.drawBoundary(a),this.isClicked},ED.HardExudate.prototype.groupDescription=function(){return"Hard exudates"},ED.Hyphaema=function(a,b){this.className="Hyphaema",this.ro=380,this.minimum=304,this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,a,b)},ED.Hyphaema.prototype=new ED.Doodle,ED.Hyphaema.prototype.constructor=ED.Hyphaema,ED.Hyphaema.superclass=ED.Doodle.prototype,ED.Hyphaema.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hyphaema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hyphaema.prototype.setParameterDefaults=function(){this.apexY=152},ED.Hyphaema.prototype.draw=function(a){var b=this.drawing.context;ED.Hyphaema.superclass.draw.call(this,a);var c=Math.asin(this.apexY/this.ro);b.beginPath(),b.arc(0,0,this.ro,c,Math.PI-c,!1),b.closePath();var d=(.1+(this.apexX+50)/111).toFixed(2);return b.fillStyle="rgba(255,0,0,"+d+")",b.lineWidth=1,b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Hyphaema.prototype.description=function(){var a=10*Math.round(10*(this.ro-this.apexY)/(2*this.ro));return a+"% hyphaema"},ED.Hypopyon=function(a,b){this.className="Hypopyon",this.ro=380,this.minimum=304,this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b)},ED.Hypopyon.prototype=new ED.Doodle,ED.Hypopyon.prototype.constructor=ED.Hypopyon,ED.Hypopyon.superclass=ED.Doodle.prototype,ED.Hypopyon.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Hypopyon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,this.minimum)},ED.Hypopyon.prototype.setParameterDefaults=function(){this.apexY=260},ED.Hypopyon.prototype.draw=function(a){var b=this.drawing.context;ED.Hypopyon.superclass.draw.call(this,a);var c=Math.asin(this.apexY/this.ro);return b.beginPath(),b.arc(0,0,this.ro,c,Math.PI-c,!1),b.closePath(),b.fillStyle="rgba(221,209,171,1)",b.lineWidth=1,b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Hypopyon.prototype.description=function(){var a=Math.round(10*(this.ro-this.apexY)/(2*this.ro));return a+"mm hypopyon"},ED.ILMPeel=function(a,b){this.className="ILMPeel",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,a,b)},ED.ILMPeel.prototype=new ED.Doodle,ED.ILMPeel.prototype.constructor=ED.ILMPeel,ED.ILMPeel.superclass=ED.Doodle.prototype,ED.ILMPeel.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ILMPeel.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-40)},ED.ILMPeel.prototype.setParameterDefaults=function(){this.apexY=-60,this.rotation=Math.PI/4,this.originX=this.drawing.eye==ED.eye.Right?-100:100},ED.ILMPeel.prototype.draw=function(a){var b=this.drawing.context;ED.ILMPeel.superclass.draw.call(this,a),b.beginPath();var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);return b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=2,b.fillStyle="rgba(220, 220, 220, 0.5)",b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ILMPeel.prototype.groupDescription=function(){return"ILM peel"},ED.IOL=function(a,b){this.className="IOL",this.type="Iris Clip",this.savedParameterArray=["originX","originY","rotation","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,a,b)},ED.IOL.prototype=new ED.Doodle,ED.IOL.prototype.constructor=ED.IOL,ED.IOL.superclass=ED.Doodle.prototype,ED.IOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IOL.prototype.setPropertyDefaults=function(){this.addAtBack="PC"==this.type?!0:!1,this.isUnique=!0,this.parameterValidationArray.type={kind:"other",type:"string",list:["PC","AC","Iris Clip"],animate:!1}},ED.IOL.prototype.setParameterDefaults=function(){this.setParameterFromString("type","Iris Clip")},ED.IOL.prototype.dependentParameterValues=function(a){var b=new Array;return b},ED.IOL.prototype.draw=function(a){var b=this.drawing.context;switch(ED.IOL.superclass.draw.call(this,a),b.beginPath(),this.type){case"PC":var c=180;b.arc(0,0,c,0,2*Math.PI,!1),b.moveTo(112.5,-142.5),b.bezierCurveTo(120,-150,142.5,-262.5,120,-285),b.bezierCurveTo(67.5,-330,-112.5,-307.5,-165,-277.5),b.bezierCurveTo(-187.5,-262.5,-195,-300,-150,-322.5),b.bezierCurveTo(-82.5,-360,97.5,-352.5,150,-322.5),b.bezierCurveTo(202.5,-292.5,165,-105,165,-75),b.moveTo(-112.5,142.5),b.bezierCurveTo(-120,150,-142.5,262.5,-120,285),b.bezierCurveTo(-67.5,330,112.5,307.5,165,277.5),b.bezierCurveTo(187.5,262.5,195,300,150,322.5),b.bezierCurveTo(82.5,360,-97.5,352.5,-150,322.5),b.bezierCurveTo(-202.5,292.5,-165,105,-165,75);break;case"AC":var c=192;b.arc(0,0,c,0,2*Math.PI,!1),b.moveTo(120,-152),b.bezierCurveTo(128,-160,136,-168,128,-184),b.bezierCurveTo(120,-200,80,-224,40,-232),b.bezierCurveTo(0,-240,-176,-264,-184,-272),b.bezierCurveTo(-200,-288,-176,-336,-160,-344),b.bezierCurveTo(-144,-352,-144,-352,-120,-360),b.bezierCurveTo(-96,-368,-104,-344,-96,-336),b.bezierCurveTo(-88,-328,88,-328,96,-336),b.bezierCurveTo(104,-344,96,-368,120,-360),b.bezierCurveTo(144,-352,144,-352,160,-344),b.bezierCurveTo(176,-336,144,-320,120,-312),b.bezierCurveTo(96,-304,-96,-304,-120,-312),b.bezierCurveTo(-144,-320,-152,-296,-136,-288),b.bezierCurveTo(-120,-280,16,-264,56,-256),b.bezierCurveTo(96,-248,152,-224,168,-200),b.bezierCurveTo(184,-176,176,-112,176,-80),b.moveTo(-120,152),b.bezierCurveTo(-128,160,-136,168,-128,184),b.bezierCurveTo(-120,200,-80,224,-40,232),b.bezierCurveTo(0,240,176,264,184,272),b.bezierCurveTo(200,288,176,336,160,344),b.bezierCurveTo(144,352,144,352,120,360),b.bezierCurveTo(96,368,104,344,96,336),b.bezierCurveTo(88,328,-88,328,-96,336),b.bezierCurveTo(-104,344,-96,368,-120,360),b.bezierCurveTo(-144,352,-144,352,-160,344),b.bezierCurveTo(-176,336,-144,320,-120,312),b.bezierCurveTo(-96,304,96,304,120,312),b.bezierCurveTo(144,320,152,296,136,288),b.bezierCurveTo(120,280,-16,264,-56,256),b.bezierCurveTo(-96,248,-152,224,-168,200),b.bezierCurveTo(-184,176,-176,112,-176,80);break;case"Iris Clip":var c=240;b.moveTo(-260,0),b.bezierCurveTo(-260,-100,-220,-220,0,-220),b.bezierCurveTo(220,-220,260,-100,260,0),b.bezierCurveTo(260,100,220,220,0,220),b.bezierCurveTo(-220,220,-260,100,-260,0),b.moveTo(-330,-10),b.bezierCurveTo(-335,-10,-335,-15,-335,-25),b.bezierCurveTo(-335,-43,-332,-86,-312,-106),b.bezierCurveTo(-292,-125,-265,-125,-252,-125),b.bezierCurveTo(-239,-125,-196,-125,-191,-116),b.bezierCurveTo(-187,-110,-189,-104,-194,-93),b.bezierCurveTo(-198,-82,-218,-50,-218,0),b.bezierCurveTo(-218,50,-198,82,-194,93),b.bezierCurveTo(-189,104,-187,110,-191,116),b.bezierCurveTo(-196,125,-239,125,-252,125),b.bezierCurveTo(-265,125,-292,125,-312,106),b.bezierCurveTo(-332,86,-335,43,-335,25),b.bezierCurveTo(-335,15,-335,10,-330,10),b.bezierCurveTo(-325,10,-320,20,-320,25),b.bezierCurveTo(-321,22,-320,33,-319,47),b.bezierCurveTo(-319,54,-314,61,-308,66),b.bezierCurveTo(-302,71,-288,77,-273,77),b.bezierCurveTo(-258,77,-250,74,-243,66),b.bezierCurveTo(-237,58,-239,0,-239,0),b.bezierCurveTo(-239,0,-237,-58,-243,-66),b.bezierCurveTo(-250,-74,-258,-77,-273,-77),b.bezierCurveTo(-288,-77,-302,-71,-308,-66),b.bezierCurveTo(-314,-61,-319,-54,-319,-47),b.bezierCurveTo(-320,-33,-321,-22,-320,-25),b.bezierCurveTo(-320,-20,-325,-10,-330,-10),b.moveTo(330,10),b.bezierCurveTo(335,10,335,15,335,25),b.bezierCurveTo(335,43,332,86,312,106),b.bezierCurveTo(292,125,265,125,252,125),b.bezierCurveTo(239,125,196,125,191,116),b.bezierCurveTo(187,110,189,104,194,93),b.bezierCurveTo(198,82,218,50,218,0),b.bezierCurveTo(218,-50,198,-82,194,-93),b.bezierCurveTo(189,-104,187,-110,191,-116),b.bezierCurveTo(196,-125,239,-125,252,-125),b.bezierCurveTo(265,-125,292,-125,312,-106),b.bezierCurveTo(332,-86,335,-43,335,-25),b.bezierCurveTo(335,-15,335,-10,330,-10),b.bezierCurveTo(325,-10,320,-20,320,-25),b.bezierCurveTo(321,-22,314,-61,319,-47),b.bezierCurveTo(319,-54,314,-61,308,-66),b.bezierCurveTo(302,-71,288,-77,273,-77),b.bezierCurveTo(258,-77,250,-74,243,-66),b.bezierCurveTo(237,-58,239,0,239,0),b.bezierCurveTo(239,0,237,58,243,66),b.bezierCurveTo(250,74,258,77,273,77),b.bezierCurveTo(288,77,302,71,308,66),b.bezierCurveTo(314,61,319,54,319,47),b.bezierCurveTo(320,33,321,22,320,25),b.bezierCurveTo(320,20,325,10,330,10)}b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.IOL.prototype.description=function(){var a="";switch(this.type){case"PC":a="Posterior Chamber IOL";break;case"AC":a="Anterior Chamber IOL";break;case"Iris Clip":a="Iris clip IOL"}var b=40,c="";return this.originY<-b&&(c.length>0&&(c+=" and"),c+=" superiorly"),this.originY>b&&(c.length>0&&(c+=" and"),c+=" inferiorly"),this.originX<-b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),c.length>0&&(a+=" displaced"+c),a},ED.IRMA=function(a,b){this.className="IRMA",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,a,b)},ED.IRMA.prototype=new ED.Doodle,ED.IRMA.prototype.constructor=ED.IRMA,ED.IRMA.superclass=ED.Doodle.prototype,ED.IRMA.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IRMA.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(1,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(1,1.5)},ED.IRMA.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(100,100)},ED.IRMA.prototype.draw=function(a){var b=this.drawing.context;return ED.IRMA.superclass.draw.call(this,a),b.beginPath(),b.moveTo(0,30),b.bezierCurveTo(-30,30,-70,0,-50,-20),b.bezierCurveTo(-30,-40,-20,-10,0,-10),b.bezierCurveTo(20,-10,30,-40,50,-20),b.bezierCurveTo(70,0,30,30,0,30),b.fillStyle="rgba(100, 100, 100, 0)",b.lineWidth=3,b.strokeStyle="red",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(50,-40)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.IRMA.prototype.groupDescription=function(){return"Intraretinal microvascular abnormalities "},ED.IRMA.prototype.description=function(){return this.locationRelativeToFovea()},ED.IatrogenicBreak=function(a,b){this.className="IatrogenicBreak",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,a,b)},ED.IatrogenicBreak.prototype=new ED.Doodle,ED.IatrogenicBreak.prototype.constructor=ED.IatrogenicBreak,ED.IatrogenicBreak.superclass=ED.Doodle.prototype,ED.IatrogenicBreak.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.IatrogenicBreak.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.8,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.8,2)},ED.IatrogenicBreak.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(240,-50)},ED.IatrogenicBreak.prototype.draw=function(a){var b=this.drawing.context;ED.IatrogenicBreak.superclass.draw.call(this,a),b.beginPath();var c=40,d=.8,e=new ED.Point(-c,c),f=new ED.Point(c,-c);return b.moveTo(e.x,e.y),b.bezierCurveTo(e.x,e.y-d*c,f.x-d*c,f.y,f.x,f.y),b.bezierCurveTo(f.x,f.y+d*c,e.x+d*c,e.y,e.x,e.y),b.lineWidth=4,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(f),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.IatrogenicBreak.prototype.description=function(){return"Iatrogenic break in "+this.quadrant()},ED.InjectionSite=function(a,b){this.className="InjectionSite",this.parsPlana=-560,this.distance="3.5",this.savedParameterArray=["apexY","rotation"],ED.Doodle.call(this,a,b)},ED.InjectionSite.prototype=new ED.Doodle,ED.InjectionSite.prototype.constructor=ED.InjectionSite,ED.InjectionSite.superclass=ED.Doodle.prototype,ED.InjectionSite.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.InjectionSite.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-550,-470),this.parameterValidationArray.distance={kind:"derived",type:"string",list:["4.5","4.0","3.5","3.0","2.5"],animate:!1}
},ED.InjectionSite.prototype.setParameterDefaults=function(){this.apexY=-510,this.distance="3.5",this.setRotationWithDisplacements(45,30)},ED.InjectionSite.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.distance=-540>b?"4.5":-520>b?"4.0":-500>b?"3.5":-480>b?"3.0":"2.5";break;case"distance":c.apexY="4.5"==b?-550:"4.0"==b?-530:"3.5"==b?-510:"3.0"==b?-490:-470}return c},ED.InjectionSite.prototype.draw=function(a){var b=this.drawing.context;ED.InjectionSite.superclass.draw.call(this,a),b.beginPath();var c=this.parsPlana-300;if(b.moveTo(-80,c),b.lineTo(80,c),b.lineTo(70,c+30),b.lineTo(50,c+240),b.lineTo(20,c+260),b.lineTo(-20,c+260),b.lineTo(-50,c+240),b.lineTo(-70,c+30),b.closePath(),b.lineWidth=2,b.strokeStyle="rgba(0, 0, 0, 1)",b.fillStyle="rgba(255, 255, 0, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.moveTo(-70,c+30),b.lineTo(70,c+30),b.lineWidth=1,b.strokeStyle="rgba(0, 0, 0, 0.5)",b.stroke(),b.beginPath(),b.moveTo(-60,c+130),b.lineTo(60,c+130),b.lineWidth=1,b.strokeStyle="rgba(0, 0, 0, 0.5)",b.stroke(),b.beginPath(),b.moveTo(0,c+130),b.lineTo(0,c+230),b.lineWidth=32,b.strokeStyle="rgba(120, 120, 120, 0.2)",b.stroke(),b.beginPath(),b.moveTo(50,c+240),b.lineTo(20,c+260),b.lineTo(-20,c+260),b.lineTo(-50,c+240),b.closePath(),b.lineWidth=1,b.fillStyle="rgba(255, 255, 255, 1)",b.strokeStyle="rgba(0, 0, 0, 0.5)",b.fill(),b.stroke(),b.beginPath(),b.moveTo(-10,c+260),b.lineTo(10,c+260),b.lineTo(10,this.apexY),b.lineTo(-10,this.apexY),b.closePath(),b.fillStyle="rgba(120, 120, 120, 1)",b.fill(),b.beginPath(),b.moveTo(-10,this.apexY),b.lineTo(10,this.apexY),b.lineTo(10,-130),b.lineTo(-10,-100),b.closePath(),b.lineWidth=1,b.strokeStyle="rgba(60, 60, 60, 1)",b.stroke();var d=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));b.save(),b.setTransform(1,0,0,1,0,0),b.lineWidth=1,b.fillStyle="gray",b.font="18px sans-serif",b.fillText(this.distance+" mm",d.x+10,d.y-5),b.restore()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.InjectionSite.prototype.groupDescription=function(){return"Injection at "},ED.InjectionSite.prototype.description=function(){return this.clockHour()+" o'clock "+this.distance+" from limbus"},ED.IrisHook=function(a,b){this.className="IrisHook",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.IrisHook.prototype=new ED.Doodle,ED.IrisHook.prototype.constructor=ED.IrisHook,ED.IrisHook.superclass=ED.Doodle.prototype,ED.IrisHook.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isScaleable=!1},ED.IrisHook.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(45,90)},ED.IrisHook.prototype.draw=function(a){var b=this.drawing.context;ED.IrisHook.superclass.draw.call(this,a),b.beginPath();var c=260,d=this.drawing.lastDoodleOfClass("AntSeg");return d&&(c=-d.apexY),b.rect(-25,-440,50,180+c),b.closePath(),b.fillStyle="rgba(255,255,255,0)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(10,-430),b.lineTo(10,-c+10),b.lineTo(-10,-c),b.lineWidth=12,b.strokeStyle="rgba(120,120,120,0.75)",b.stroke(),b.beginPath(),b.moveTo(-20,-400),b.lineTo(40,-400),b.lineWidth=24,b.strokeStyle="rgba(255,120,0,0.75)",b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.IrisHook.prototype.groupDescription=function(){return"Iris hooks used at "},ED.IrisHook.prototype.description=function(){var a="";return a+=this.clockHour()},ED.IrisHook.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.IrisNaevus=function(a,b){this.className="IrisNaevus",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.IrisNaevus.prototype=new ED.Doodle,ED.IrisNaevus.prototype.constructor=ED.IrisNaevus,ED.IrisNaevus.superclass=ED.Doodle.prototype,ED.IrisNaevus.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.IrisNaevus.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.isOrientated=!0},ED.IrisNaevus.prototype.setParameterDefaults=function(){this.originY=-320,this.scaleX=1.8},ED.IrisNaevus.prototype.draw=function(a){var b=this.drawing.context;ED.IrisNaevus.superclass.draw.call(this,a),b.beginPath();var c=50;b.arc(0,0,c,0,2*Math.PI,!1),b.closePath(),b.fillStyle="brown",b.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.IrisNaevus.prototype.description=function(){return"Iris naevus"},ED.KeraticPrecipitates=function(a,b){this.className="KeraticPrecipitates",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.KeraticPrecipitates.prototype=new ED.Doodle,ED.KeraticPrecipitates.prototype.constructor=ED.KeraticPrecipitates,ED.KeraticPrecipitates.superclass=ED.Doodle.prototype,ED.KeraticPrecipitates.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.KeraticPrecipitates.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,40),this.parameterValidationArray.apexY.range.setMinAndMax(-160,0),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.KeraticPrecipitates.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.KeraticPrecipitates.prototype.draw=function(a){var b=this.drawing.context;ED.KeraticPrecipitates.superclass.draw.call(this,a),b.beginPath();var c=200;if(b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var d="rgba(110, 110, 110, 0.5)",e=10*((this.apexX+20)/20)/this.scaleX,f=new ED.Point(0,0),g=40+Math.abs(Math.floor(this.apexY/2)),h=0;g>h;h++)f.setWithPolars(c*ED.randomArray[h],2*Math.PI*ED.randomArray[h+100]),this.drawSpot(b,f.x,f.y,e,d);return this.handleArray[2].location=this.transform.transformPoint(new ED.Point(.7*c,.7*-c)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.KeraticPrecipitates.prototype.description=function(){return this.apexX>20?"Mutton fat keratic precipitates":"Keratic precipitates"},ED.KoeppeNodule=function(a,b){this.className="KoeppeNodule",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.KoeppeNodule.prototype=new ED.Doodle,ED.KoeppeNodule.prototype.constructor=ED.KoeppeNodule,ED.KoeppeNodule.superclass=ED.Doodle.prototype,ED.KoeppeNodule.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.KoeppeNodule.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(30,30)},ED.KoeppeNodule.prototype.draw=function(a){var b=this.drawing.context;ED.KoeppeNodule.superclass.draw.call(this,a);var c=260,d=this.drawing.lastDoodleOfClass("AntSeg");return d&&(c=-d.apexY),b.beginPath(),b.arc(0,-c,20,0,2*Math.PI,!1),b.fillStyle="rgba(150,100,50,1)",b.lineWidth=1,b.strokeStyle=b.fillStyle,this.drawBoundary(a),this.isClicked},ED.KoeppeNodule.prototype.groupDescription=function(){return"Koeppe nodules"},ED.KrukenbergSpindle=function(a,b){this.className="KrukenbergSpindle",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,a,b)},ED.KrukenbergSpindle.prototype=new ED.Doodle,ED.KrukenbergSpindle.prototype.constructor=ED.KrukenbergSpindle,ED.KrukenbergSpindle.superclass=ED.Doodle.prototype,ED.KrukenbergSpindle.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.KrukenbergSpindle.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-80)},ED.KrukenbergSpindle.prototype.setParameterDefaults=function(){this.apexY=-150,this.originY=200},ED.KrukenbergSpindle.prototype.draw=function(a){var b=this.drawing.context;return ED.KrukenbergSpindle.superclass.draw.call(this,a),b.beginPath(),this.addEllipseToPath(b,0,0,-this.apexY/2,2*-this.apexY),b.fillStyle=b.createPattern(this.drawing.imageArray.BrownSpotPattern,"repeat"),b.strokeStyle="rgba(255,128,0,0.5)",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.KrukenbergSpindle.prototype.description=function(){return"Krukenberg spindle"},ED.LaserCircle=function(a,b){this.className="LaserCircle",this.savedParameterArray=["originX","originY","apexX","apexY","rotation"],ED.Doodle.call(this,a,b)},ED.LaserCircle.prototype=new ED.Doodle,ED.LaserCircle.prototype.constructor=ED.LaserCircle,ED.LaserCircle.superclass=ED.Doodle.prototype,ED.LaserCircle.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!0)},ED.LaserCircle.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(50,400),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-50)},ED.LaserCircle.prototype.setParameterDefaults=function(){this.apexX=84,this.apexY=-84;var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.LaserCircle.prototype.draw=function(a){var b=this.drawing.context;if(ED.LaserCircle.superclass.draw.call(this,a),b.beginPath(),b.moveTo(this.apexX,this.apexY),b.lineTo(this.apexX,-this.apexY),b.lineTo(-this.apexX,-this.apexY),b.lineTo(-this.apexX,this.apexY),b.lineTo(this.apexX,this.apexY),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=25,d=new ED.Point(0,0),e=this.apexX+this.apexY;if(0>e)var f=this.apexX;else var f=-this.apexY;for(var g=Math.round(Math.PI/(c/f)),h=0;g+1>h;h++)if(0>e){var i=-Math.PI/2+h*Math.PI/g;d.setWithPolars(f,i),this.drawLaserSpot(b,d.x,d.y+e)}else{var i=-Math.PI+h*Math.PI/g;d.setWithPolars(f,i),this.drawLaserSpot(b,d.x-e,d.y)}for(var h=1;g>h;h++)if(0>e){var i=Math.PI/2+h*Math.PI/g;d.setWithPolars(f,i),this.drawLaserSpot(b,d.x,d.y-e)}else{var i=0+h*Math.PI/g;d.setWithPolars(f,i),this.drawLaserSpot(b,d.x+e,d.y)}g=Math.abs(Math.round(e/c));for(var h=0;2*g+1>h;h++)if(0>e){var j=this.apexY+f+h*Math.abs(e/g);this.drawLaserSpot(b,-f,j),this.drawLaserSpot(b,f,j)}else{var k=-this.apexX+f+h*Math.abs(e/g);this.drawLaserSpot(b,k,-f),this.drawLaserSpot(b,k,f)}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LaserCircle.prototype.groupDescription=function(){return"laser retinopexy"},ED.LaserDemarcation=function(a,b){this.className="LaserDemarcation",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.LaserDemarcation.prototype=new ED.Doodle,ED.LaserDemarcation.prototype.constructor=ED.LaserDemarcation,ED.LaserDemarcation.superclass=ED.Doodle.prototype,ED.LaserDemarcation.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.LaserDemarcation.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.LaserDemarcation.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-350;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+Math.PI/4:this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI,a=this.drawing.lastDoodleOfClass("PeripheralRetinectomy"),a&&(this.rotation=a.rotation,this.arc=a.arc+Math.PI/16,this.apexY=a.apexY+50)},ED.LaserDemarcation.prototype.draw=function(a){var b=this.drawing.context;ED.LaserDemarcation.superclass.draw.call(this,a);var c=476,d=-this.apexY,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,e,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,255,0,0)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var m=25,n=new ED.Point(0,0);if(this.arc<1.9*Math.PI){for(var o=c-d,p=Math.PI/2,q=Math.round(p/(m/o)),r=new ED.Point(-c*Math.sin(f-o/c),-c*Math.cos(f-o/c)),s=0;q>s;s++)n.setWithPolars(o,h+.5*(o/c)-s*p/q),this.drawLaserSpot(b,r.x+n.x,r.y+n.y);for(var t=this.arc-2*o/c,u=Math.round(t/(m/d)),v=r.direction(),s=0;u+1>s;s++)n.setWithPolars(d,v+s*t/u),this.drawLaserSpot(b,n.x,n.y);for(var w=new ED.Point(-c*Math.sin(-f+o/c),-c*Math.cos(-f+o/c)),s=0;q>s;s++)n.setWithPolars(o,g+Math.PI-.5*(o/c)+s*p/q),this.drawLaserSpot(b,w.x+n.x,w.y+n.y)}else for(var q=Math.round(2*Math.PI/(m/d)),s=0;q>s;s++)n.setWithPolars(d,2*s*Math.PI/q),this.drawLaserSpot(b,n.x,n.y)}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LaserDemarcation.prototype.description=function(){var a="";return this.arc>1.9*Math.PI&&(a+="360 degree "),a+="laser demarcation"},ED.LaserSpot=function(a,b){this.className="LaserSpot",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.LaserSpot.prototype=new ED.Doodle,ED.LaserSpot.prototype.constructor=ED.LaserSpot,ED.LaserSpot.superclass=ED.Doodle.prototype,ED.LaserSpot.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.LaserSpot.prototype.setPropertyDefaults=function(){this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.LaserSpot.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75,this.setOriginWithDisplacements(100,80)},ED.LaserSpot.prototype.draw=function(a){var b=this.drawing.context;ED.LaserSpot.superclass.draw.call(this,a);var c=30;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=2*c/3,b.fillStyle="yellow",b.strokeStyle="rgba(255, 128, 0, 1)",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LaserSpot.prototype.groupDescription=function(){return"Laser spots"},ED.LasikFlap=function(a,b){this.className="LasikFlap",this.gradeDLK="None",this.savedParameterArray=["scaleX","scaleY","rotation","gradeDLK"],this.controlParameterArray={gradeDLK:"DLK Grade"},ED.Doodle.call(this,a,b)},ED.LasikFlap.prototype=new ED.Doodle,ED.LasikFlap.prototype.constructor=ED.LasikFlap,ED.LasikFlap.superclass=ED.Doodle.prototype,ED.LasikFlap.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.LasikFlap.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.75,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.75,1),this.parameterValidationArray.gradeDLK={kind:"other",type:"string",list:["None","Grade 1","Grade 2","Grade 3"],animate:!1}},ED.LasikFlap.prototype.setParameterDefaults=function(){this.apexY=-100},ED.LasikFlap.prototype.draw=function(a){var b=this.drawing.context;ED.LasikFlap.superclass.draw.call(this,a);var c=320,d=Math.PI/6,e=-Math.PI/2-d,f=-Math.PI/2+d;if(b.beginPath(),b.arc(0,0,c,e,f,!0),b.closePath(),b.fillStyle="rgba(155,255,255,0)",b.lineWidth=2,b.strokeStyle="rgba(100,100,100,0.9)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(b.beginPath(),b.arc(0,0,c/2,0,2*Math.PI,!0),this.gradeDLK){case"None":b.fillStyle="rgba(155,255,255,0)";break;case"Grade 1":b.fillStyle="rgba(155,255,255,0.4)";break;case"Grade 2":b.fillStyle="rgba(155,255,255,0.6)";break;case"Grade 3":b.fillStyle="rgba(155,255,255,0.8)"}b.fill()}var g=new ED.Point(0,0);return g.setWithPolars(c,d),this.handleArray[2].location=this.transform.transformPoint(g),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LasikFlap.prototype.description=function(){var a="";if(this.drawing.eye==ED.eye.Right)var b=!0;else var b=!1;var c=Math.cos(this.rotation),d=Math.sin(this.rotation),e=Math.abs(c),f=Math.abs(d),g="";return d>c&&f>e&&(g=b?"nasal":"temporal"),d>c&&e>f&&(g="inferior"),c>d&&f>e&&(g=b?"temporal":"nasal"),c>d&&e>f&&(g="superior"),a="LASIK flap with "+g+" hinge","None"!=this.gradeDLK&&(a+=", DLK "+this.gradeDLK),a},ED.Lens=function(a,b){this.className="Lens",this.nuclearGrade="None",this.corticalGrade="None",this.posteriorSubcapsularGrade="None",this.anteriorPolar=!1,this.posteriorPolar=!1,this.coronary=!1,this.phakodonesis=!1,this.savedParameterArray=["originX","originY","nuclearGrade","corticalGrade","posteriorSubcapsularGrade","anteriorPolar","posteriorPolar","coronary","phakodonesis"],this.controlParameterArray={nuclearGrade:"Nuclear",corticalGrade:"Cortical",posteriorSubcapsularGrade:"Posterior subcapsular",anteriorPolar:"Anterior polar",posteriorPolar:"Posterior polar",coronary:"Coronary",phakodonesis:"Phakodonesis"},ED.Doodle.call(this,a,b)},ED.Lens.prototype=new ED.Doodle,ED.Lens.prototype.constructor=ED.Lens,ED.Lens.superclass=ED.Doodle.prototype,ED.Lens.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.nuclearGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","Brunescent"],animate:!1},this.parameterValidationArray.corticalGrade={kind:"derived",type:"string",list:["None","Mild","Moderate","White"],animate:!1},this.parameterValidationArray.posteriorSubcapsularGrade={kind:"derived",type:"string",list:["None","Small","Medium","Large"],animate:!1},this.parameterValidationArray.anteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.posteriorPolar={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.coronary={kind:"derived",type:"bool",display:!1},this.parameterValidationArray.phakodonesis={kind:"derived",type:"bool",display:!1}},ED.Lens.prototype.setParameterDefaults=function(){},ED.Lens.prototype.draw=function(a){var b=this.drawing.context;ED.Lens.superclass.draw.call(this,a);var c=240;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if("None"!=this.posteriorSubcapsularGrade){var d;switch(this.posteriorSubcapsularGrade){case"Small":d=30;break;case"Medium":d=60;break;case"Large":d=90}b.beginPath(),b.arc(0,0,d,0,2*Math.PI,!1);var e=b.createPattern(this.drawing.imageArray.PSCPattern,"repeat");b.fillStyle=e,b.strokeStyle="lightgray",b.fill(),b.stroke()}if(this.posteriorPolar){var f=50;b.beginPath(),b.arc(0,0,f,0,2*Math.PI,!1),b.fillStyle="rgba(140,140,140,0.75)",b.strokeStyle="gray",b.fill(),b.stroke()}var g=c-60;if(b.beginPath(),b.arc(0,0,g,0,2*Math.PI,!0),b.strokeStyle="rgba(220, 220, 220, 0.75)",b.stroke(),"None"!=this.nuclearGrade){var h;switch(this.nuclearGrade){case"Mild":h=-120;break;case"Moderate":h=-80;break;case"Brunescent":h=0}yellowColour="rgba(255, 255, 0, 0.75)";var i="rgba("+Math.round(120-h)+", "+Math.round(60-h)+", 0, 0.75)",j=b.createRadialGradient(0,0,210,0,0,50);j.addColorStop(0,yellowColour),j.addColorStop(1,i),b.fillStyle=j,b.fill()}if("None"!=this.corticalGrade){var g,k=16,c=240,l=230,m=2*Math.PI/k,n=m/2;switch(this.corticalGrade){case"Mild":g=180;break;case"Moderate":g=100;break;case"White":g=20}b.beginPath();var o=new ED.Point(0,0);o.setWithPolars(l,-n),b.moveTo(o.x,o.y);for(var p=0;k>p;p++){var q=p*m-n,r=new ED.Point(0,0);r.setWithPolars(l,q),b.lineTo(r.x,r.y);var s=new ED.Point(0,0);s.setWithPolars(g,p*m),b.lineTo(s.x,s.y)}b.lineTo(o.x,o.y),b.moveTo(c,0),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=4,b.lineJoin="bevel",b.fillStyle="rgba(200,200,200,0.75)",b.fill()}if(this.coronary)for(var t=130,u=10,v=Math.PI/8,w=0;w<2*Math.PI;w+=v){var x=new ED.Point(0,0);x.setWithPolars(t,w),this.drawCircle(b,x.x,x.y,u,"rgba(200,200,255,1)",4,"rgba(200,200,255,1)")}if(this.anteriorPolar){var f=30;b.beginPath(),b.arc(0,0,f,0,2*Math.PI,!1),b.fillStyle="rgba(120,120,120,0.5)",b.strokeStyle="gray",b.fill(),b.stroke()}}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Lens.prototype.description=function(){return returnValue="","None"!=this.nuclearGrade&&(returnValue+=this.nuclearGrade+" nuclear cataract"),"None"!=this.corticalGrade&&(returnValue+=returnValue.length>0?", ":"",returnValue+=this.corticalGrade+" cortical cataract"),"None"!=this.posteriorSubcapsularGrade&&(returnValue+=returnValue.length>0?", ":"",returnValue+=this.posteriorSubcapsularGrade+" posterior subcapsular cataract"),this.coronary&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Coronary cataract"),this.anteriorPolar&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Anterior polar cataract"),this.posteriorPolar&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Posterior polar cataract"),this.phakodonesis&&(returnValue+=returnValue.length>0?", ":"",returnValue+="Phakodonesis"),returnValue},ED.LensCrossSection=function(a,b){this.className="LensCrossSection",ED.Doodle.call(this,a,b)},ED.LensCrossSection.prototype=new ED.Doodle,ED.LensCrossSection.prototype.constructor=ED.LensCrossSection,ED.LensCrossSection.superclass=ED.Doodle.prototype,ED.LensCrossSection.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-150,200),this.parameterValidationArray.originY.range.setMinAndMax(-380,380)},ED.LensCrossSection.prototype.setParameterDefaults=function(){this.originX=44},ED.LensCrossSection.prototype.draw=function(a){var b=this.drawing.context;ED.LensCrossSection.superclass.draw.call(this,a);var c=240,d=300,e=100,f=Math.asin(c/d),g=d*Math.cos(f),h=d-60,i=Math.acos(g/h);return b.beginPath(),b.arc(e-g,0,d,f,-f,!0),b.arc(e+g,0,d,Math.PI+f,Math.PI-f,!0),b.stroke(),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(e,h*Math.sin(i)),b.arc(e-g,0,h,i,-i,!0),b.arc(e+g,0,h,Math.PI+i,Math.PI-i,!0),b.strokeStyle="rgba(220, 220, 220, 0.75)",b.stroke(),b.beginPath(),b.moveTo(44-this.originX+80,-this.originY-349),b.lineTo(64,-207),b.moveTo(44-this.originX+80,-this.originY-349),b.lineTo(138,-207),b.moveTo(44-this.originX+120,-this.originY-349),b.lineTo(64,-207),b.moveTo(44-this.originX+120,-this.originY-349),b.lineTo(138,-207),b.moveTo(44-this.originX+80,-this.originY+349),b.lineTo(64,207),b.moveTo(44-this.originX+80,-this.originY+349),b.lineTo(138,207),b.moveTo(44-this.originX+120,-this.originY+349),b.lineTo(64,207),b.moveTo(44-this.originX+120,-this.originY+349),b.lineTo(138,207),b.lineWidth=2,b.strokeStyle="gray",b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LimbalRelaxingIncision=function(a,b){this.className="LimbalRelaxingIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.LimbalRelaxingIncision.prototype=new ED.Doodle,ED.LimbalRelaxingIncision.prototype.constructor=ED.LimbalRelaxingIncision,ED.LimbalRelaxingIncision.superclass=ED.Doodle.prototype,ED.LimbalRelaxingIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.LimbalRelaxingIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2)},ED.LimbalRelaxingIncision.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);a?(this.rotation=a.rotation+Math.PI,this.arc=a.arc):this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/2:Math.PI/2},ED.LimbalRelaxingIncision.prototype.draw=function(a){var b=this.drawing.context;ED.LimbalRelaxingIncision.superclass.draw.call(this,a);var c=360,d=12,e=c+d,f=c-d;b.beginPath();var g=this.arc/2;b.arc(0,0,e,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,f,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),b.fillStyle="rgba(100,100,200,0.75)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a);var h=new ED.Point(0,0);return h.setWithPolars(c,g),this.handleArray[3].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.LimbalRelaxingIncision.prototype.description=function(){var a="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return a+=this.clockHour()+" o'clock"},ED.Macroaneurysm=function(a,b){this.className="Macroaneurysm",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.Macroaneurysm.prototype=new ED.Doodle,ED.Macroaneurysm.prototype.constructor=ED.Macroaneurysm,ED.Macroaneurysm.superclass=ED.Doodle.prototype,ED.Macroaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithRotations(300,60,60)},ED.Macroaneurysm.prototype.draw=function(a){var b=this.drawing.context;ED.Macroaneurysm.superclass.draw.call(this,a);var c=50;return b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(b.beginPath(),b.arc(0,0,25,0,2*Math.PI,!0),b.fillStyle="rgba(197,186,80,1)",b.fill()),this.isClicked},ED.Macroaneurysm.prototype.description=function(){return"Macroaneurysm"},ED.Macroaneurysm.prototype.snomedCode=function(){return 247124009},ED.MacularDystrophy=function(a,b){this.className="MacularDystrophy",this.savedParameterArray=["apexX","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.MacularDystrophy.prototype=new ED.Doodle,ED.MacularDystrophy.prototype.constructor=ED.MacularDystrophy,ED.MacularDystrophy.superclass=ED.Doodle.prototype,ED.MacularDystrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularDystrophy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,100)},ED.MacularDystrophy.prototype.setParameterDefaults=function(){this.apexY=-100},ED.MacularDystrophy.prototype.draw=function(a){var b=this.drawing.context;ED.MacularDystrophy.superclass.draw.call(this,a);var c=150;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="rgba(255,0,0,0)",b.fillStyle="rgba(255,0,0,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(this.apexY<-50?(b.beginPath(),b.moveTo(-200,0),b.bezierCurveTo(-200,-70,-100,-140,0,-140),b.bezierCurveTo(100,-140,200,-70,200,0),b.bezierCurveTo(200,70,100,140,0,140),b.bezierCurveTo(-100,140,-200,70,-200,0),b.fillStyle="rgba(223,80,20,1)",b.fill(),b.beginPath(),b.moveTo(-100,0),b.bezierCurveTo(-100,-35,-50,-70,0,-70),b.bezierCurveTo(50,-70,100,-35,100,0),b.bezierCurveTo(100,35,50,70,0,70),b.bezierCurveTo(-50,70,-100,35,-100,0),b.fillStyle="rgba(125,65,54,1)",b.fill()):this.apexY<0?(b.beginPath(),b.arc(0,0,100,0,2*Math.PI,!0),b.fillStyle="yellow",b.strokeStyle="brown",b.lineWidth=20,b.fill(),b.stroke()):(b.beginPath(),b.arc(0,0,120,0,2*Math.PI,!0),b.fillStyle="rgba(255, 120, 120, 0.5)",b.strokeStyle=b.fillStyle,b.lineWidth=1,b.fill()));var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MacularDystrophy.prototype.groupDescription=function(){return this.apexY<-50?"Bull's eye maculopathy":this.apexY<0?"Vitelliform macular dystrophy":"Atrophic macular dystrophy"},ED.MacularDystrophy.prototype.snomedCode=function(){return 276436007},ED.MacularGrid=function(a,b){this.className="MacularGrid",this.savedParameterArray=["apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.MacularGrid.prototype=new ED.Doodle,ED.MacularGrid.prototype.constructor=ED.MacularGrid,ED.MacularGrid.superclass=ED.Doodle.prototype,ED.MacularGrid.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularGrid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-150,-50)},ED.MacularGrid.prototype.setParameterDefaults=function(){this.apexY=-100,this.scaleX=.7,this.scaleY=.7},ED.MacularGrid.prototype.draw=function(a){var b=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,a);var c=250,d=-this.apexY;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.arc(0,0,d,2*Math.PI,0,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var e=60;n=Math.floor(2*c/e);for(var f=-n/2*e,g=0;n+1>g;g++)for(var h=0;n+1>h;h++){var i=f+g*e+Math.round(15*(-.5+ED.randomArray[g+h])),j=f+h*e+Math.round(15*(-.5+ED.randomArray[g+h+100])),k=i*i+j*j;k>=d*d&&c*c>=k&&this.drawLaserSpot(b,i,j)}}var l=new ED.Point(0,0);return l.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(l),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MacularGrid.prototype.description=function(){return"Macular grid laser"},ED.MacularHole=function(a,b){this.className="MacularHole",this.savedParameterArray=["originX","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.MacularHole.prototype=new ED.Doodle,ED.MacularHole.prototype.constructor=ED.MacularHole,ED.MacularHole.superclass=ED.Doodle.prototype,ED.MacularHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.MacularHole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)
},ED.MacularHole.prototype.setParameterDefaults=function(){this.drawing.hasDoodleOfClass("Fundus")&&(this.originX=this.drawing.eye==ED.eye.Right?-100:100,this.scaleX=.5,this.scaleY=.5)},ED.MacularHole.prototype.draw=function(a){var b=this.drawing.context;ED.MacularHole.superclass.draw.call(this,a);var c=40;return b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="yellow",b.strokeStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,2*c/3,0,2*Math.PI,!0),b.closePath(),b.fillStyle="red",b.fill()),point=new ED.Point(0,0),point.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MacularHole.prototype.description=function(){return"Macular hole"},ED.MacularHole.prototype.snomedCode=function(){return 232006002},ED.MacularHole.prototype.diagnosticHierarchy=function(){return 2},ED.MacularThickening=function(a,b){this.className="MacularThickening",this.savedParameterArray=["originX","originY","apexX","apexY"],ED.Doodle.call(this,a,b),this.rotation=-Math.PI/4},ED.MacularThickening.prototype=new ED.Doodle,ED.MacularThickening.prototype.constructor=ED.MacularThickening,ED.MacularThickening.superclass=ED.Doodle.prototype,ED.MacularThickening.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.MacularThickening.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(100,400),this.parameterValidationArray.apexY.range.setMinAndMax(-0,0)},ED.MacularThickening.prototype.setParameterDefaults=function(){this.apexX=100,this.apexY=0,this.setOriginWithDisplacements(0,150)},ED.MacularThickening.prototype.draw=function(a){var b=this.drawing.context;ED.MacularThickening.superclass.draw.call(this,a);var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=3,b.strokeStyle="rgba(255, 255, 255, 0)",b.fillStyle="rgba(255, 255, 255, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var d=30;b.moveTo(-c,0),b.lineTo(c,0);for(var e=-1;2>e;e+=2)for(var f=d;c>f;f+=d){var g=this.xForY(c,f);b.moveTo(-g,e*f),b.lineTo(g,e*f)}b.lineWidth=15,b.lineCap="round",b.strokeStyle="rgba(200, 200, 200, 0.75)",b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MacularThickening.prototype.groupDescription=function(){return"Macular thickening "},ED.MacularThickening.prototype.description=function(){return this.locationRelativeToFovea()},ED.MattressSuture=function(a,b){this.className="MattressSuture",this.savedParameterArray=["radius","rotation"],ED.Doodle.call(this,a,b)},ED.MattressSuture.prototype=new ED.Doodle,ED.MattressSuture.prototype.constructor=ED.MattressSuture,ED.MattressSuture.superclass=ED.Doodle.prototype,ED.MattressSuture.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1},ED.MattressSuture.prototype.setParameterDefaults=function(){this.radius=374,this.setRotationWithDisplacements(10,20)},ED.MattressSuture.prototype.draw=function(a){var b=this.drawing.context;ED.MattressSuture.superclass.draw.call(this,a),b.beginPath();var c=this.radius;return b.rect(-40,-(c+40),80,80),b.closePath(),b.fillStyle="rgba(255,255,255,0.0)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(-40,-(c+40)),b.lineTo(40,-(c+40)),b.lineTo(-40,-(c-40)),b.lineTo(40,-(c-40)),b.lineTo(-40,-(c+40)),b.lineWidth=2,b.strokeStyle="rgba(0,0,120,0.7)",b.closePath(),b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MattressSuture.prototype.description=function(){var a="Mattress suture at ";return a+=this.clockHour()+" o'clock"},ED.Microaneurysm=function(a,b){this.className="Microaneurysm",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,a,b)},ED.Microaneurysm.prototype=new ED.Doodle,ED.Microaneurysm.prototype.constructor=ED.Microaneurysm,ED.Microaneurysm.superclass=ED.Doodle.prototype,ED.Microaneurysm.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(50,30)},ED.Microaneurysm.prototype.draw=function(a){var b=this.drawing.context;ED.Microaneurysm.superclass.draw.call(this,a);var c=14;return b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="red",this.drawBoundary(a),this.isClicked},ED.Microaneurysm.prototype.groupDescription=function(){return"Microaneurysms"},ED.MultifocalChoroiditis=function(a,b){this.className="MultifocalChoroiditis",ED.Doodle.call(this,a,b)},ED.MultifocalChoroiditis.prototype=new ED.Doodle,ED.MultifocalChoroiditis.prototype.constructor=ED.MultifocalChoroiditis,ED.MultifocalChoroiditis.superclass=ED.Doodle.prototype,ED.MultifocalChoroiditis.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.MultifocalChoroiditis.prototype.draw=function(a){var b=this.drawing.context;ED.MultifocalChoroiditis.superclass.draw.call(this,a),b.beginPath();var c=480;if(b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(255, 255, 0, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var d=15,e=.9*c,f=12,g=3,h=0;f>h;h++)for(var i=2*h*Math.PI/f,j=0;g>j;j++){var k=(.5+j)*e/g,l=new ED.Point(0,0);l.setWithPolars(k,i);var m=80,n=(ED.randomArray[h+j]-.5)*m,o=(ED.randomArray[f*g+h+j]-.5)*m;this.drawCircle(b,l.x+n,l.y+o,d,"Yellow",3,"rgba(255, 128, 0, 1)")}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.MultifocalChoroiditis.prototype.description=function(){return"Panretinal photocoagulation"},ED.NerveFibreDefect=function(a,b){this.className="NerveFibreDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.NerveFibreDefect.prototype=new ED.Doodle,ED.NerveFibreDefect.prototype.constructor=ED.NerveFibreDefect,ED.NerveFibreDefect.superclass=ED.Doodle.prototype,ED.NerveFibreDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NerveFibreDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-560,-400)},ED.NerveFibreDefect.prototype.setParameterDefaults=function(){this.arc=20*Math.PI/180,this.apexY=-460,this.setRotationWithDisplacements(150,-120)},ED.NerveFibreDefect.prototype.draw=function(a){var b=this.drawing.context;ED.NerveFibreDefect.superclass.draw.call(this,a);var c=-this.apexY,d=360,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;return b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(200, 200, 200, 0.75)",b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.NerveFibreDefect.prototype.groupDescription=function(){return"Nerve fibre layer defect at "},ED.NerveFibreDefect.prototype.description=function(){return this.clockHour()+" o'clock"},ED.NuclearCataract=function(a,b){this.className="NuclearCataract",this.grade="Mild",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,a,b)},ED.NuclearCataract.prototype=new ED.Doodle,ED.NuclearCataract.prototype.constructor=ED.NuclearCataract,ED.NuclearCataract.superclass=ED.Doodle.prototype,ED.NuclearCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataract.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-120,0),this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataract.prototype.setParameterDefaults=function(){this.setParameterFromString("grade","Mild")},ED.NuclearCataract.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.grade=-80>b?"Mild":-40>b?"Moderate":"Brunescent";break;case"grade":switch(b){case"Mild":c.apexY=-120;break;case"Moderate":c.apexY=-80;break;case"Brunescent":c.apexY=0}}return c},ED.NuclearCataract.prototype.draw=function(a){var b=this.drawing.context;ED.NuclearCataract.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,200,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var c="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",d=b.createRadialGradient(0,0,210,0,0,50);return d.addColorStop(0,yellowColour),d.addColorStop(1,c),b.fillStyle=d,b.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.NuclearCataract.prototype.description=function(){return this.getParameter("grade")+" nuclear cataract"},ED.NuclearCataract.prototype.snomedCode=function(){return 53889007},ED.NuclearCataract.prototype.diagnosticHierarchy=function(){return 3},ED.NuclearCataractCrossSection=function(a,b){this.className="NuclearCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,a,b)},ED.NuclearCataractCrossSection.prototype=new ED.Doodle,ED.NuclearCataractCrossSection.prototype.constructor=ED.NuclearCataractCrossSection,ED.NuclearCataractCrossSection.superclass=ED.Doodle.prototype,ED.NuclearCataractCrossSection.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.NuclearCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection","NuclearCataractCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(100,100),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20),this.parameterValidationArray.grade={kind:"derived",type:"string",list:["Mild","Moderate","Brunescent"],animate:!0}},ED.NuclearCataractCrossSection.prototype.setParameterDefaults=function(){this.apexX=100,this.originX=44,this.setParameterFromString("grade","Mild")},ED.NuclearCataractCrossSection.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.grade=-80>b?"Mild":-40>b?"Moderate":"Brunescent";break;case"grade":switch(b){case"Mild":c.apexY=-120;break;case"Moderate":c.apexY=-80;break;case"Brunescent":c.apexY=0}}return c},ED.NuclearCataractCrossSection.prototype.draw=function(a){var b=this.drawing.context;ED.NuclearCataractCrossSection.superclass.draw.call(this,a);var c=240,d=300,e=100,f=Math.asin(c/d),g=d*Math.cos(f),h=d-60,i=Math.acos(g/h);b.beginPath(),b.arc(e-g,0,h,i,-i,!0),b.arc(e+g,0,h,Math.PI+i,Math.PI-i,!0),b.stroke(),b.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var j="rgba("+Math.round(120-this.apexY)+", "+Math.round(60-this.apexY)+", 0, 0.75)",k=b.createRadialGradient(e,0,210,e,0,50);return k.addColorStop(0,yellowColour),k.addColorStop(1,j),b.fillStyle=k,b.strokeStyle="rgba(0,0,0,1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.OpticDisc=function(a,b){this.className="OpticDisc",this.numberOfHandles=8,this.mode="Basic",this.cdRatio="0",this.savedParameterArray=["apexY","mode"],ED.Doodle.call(this,a,b)},ED.OpticDisc.prototype=new ED.Doodle,ED.OpticDisc.prototype.constructor=ED.OpticDisc,ED.OpticDisc.superclass=ED.Doodle.prototype,ED.OpticDisc.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.OpticDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.parameterValidationArray.radius.range.setMinAndMax(50,290),this.parameterValidationArray.mode={kind:"derived",type:"string",list:["Basic","Expert"],animate:!1},this.parameterValidationArray.cdRatio={kind:"derived",type:"string",list:["0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0","No view"],animate:!0},this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=new Object;c.length=new ED.Range(50,290),c.angle=new ED.Range((15*b/16+a*b/8)%b,(1*b/16+a*b/8)%b),this.handleVectorRangeArray[a]=c}},ED.OpticDisc.prototype.setParameterDefaults=function(){this.apexY=-150;var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a);for(var b=0;b<this.numberOfHandles;b++){var c=new ED.Point(0,0);c.setWithPolars(-this.apexY,2*b*Math.PI/this.numberOfHandles),this.addPointToSquiggle(c)}this.setParameterFromString("mode","Basic"),this.setParameterFromString("cdRatio","0.3")},ED.OpticDisc.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"mode":this.setHandleProperties(),"Expert"==b?this.drawing.isReady&&this.setMeanRadius(-this.apexY):this.drawing.isReady&&this.resetHandles();break;case"apexY":c.cdRatio=-300>b?"No view":(-b/300).toFixed(1);break;case"cdRatio":if("No view"!=b){var d=300*parseFloat(b);c.apexY=-d}else c.apexY=-320;break;case"handles":var e=0;e+=this.squiggleArray[0].pointsArray[0].length(),e+=this.squiggleArray[0].pointsArray[this.numberOfHandles/2].length(),c.apexY=-Math.round(e/2);var f=Math.round(10*e/600)/10;c.cdRatio=f.toFixed(1)}return c},ED.OpticDisc.prototype.draw=function(a){var b=this.drawing.context;ED.OpticDisc.superclass.draw.call(this,a);var c=300,d=-this.apexY,e=0,f=2*Math.PI;b.beginPath(),b.arc(0,0,c,e,f,!0),b.closePath(),b.lineWidth=2;var g=b.createPattern(this.drawing.imageArray.CribriformPattern,"repeat");if(b.fillStyle=g,b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(b.beginPath(),b.arc(0,0,c,e,f,!0),"Basic"==this.mode)b.moveTo(d,0),b.arc(0,0,d,f,e,!1);else{var h,i,j,k,l=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var m=0;m<this.numberOfHandles;m++){h=this.squiggleArray[0].pointsArray[m];var n=m<this.numberOfHandles-1?m+1:0;i=this.squiggleArray[0].pointsArray[n],j=h.tangentialControlPoint(+l),k=i.tangentialControlPoint(-l),b.bezierCurveTo(j.x,j.y,k.x,k.y,i.x,i.y)}}b.closePath();var o=new ED.Colour(0,0,0,1);o.setWithHexString("FFA83C"),b.fillStyle=o.rgba(),b.fill(),b.beginPath();var p;p=this.drawing.eye==ED.eye.Right?-1:1;var q=new ED.Point(0,0);q.setWithPolars(150,-p*Math.PI/2);var r=new ED.Point(0,0);r.setWithPolars(400,-p*Math.PI/8);var s=new ED.Point(0,0);s.setWithPolars(450,p*Math.PI/8);var t=new ED.Point(0,0);t.setWithPolars(500,p*Math.PI/4),b.moveTo(q.x,q.y),b.bezierCurveTo(r.x,r.y,s.x,s.y,t.x,t.y);var q=new ED.Point(0,0);q.setWithPolars(150,-p*Math.PI/2);var r=new ED.Point(0,0);r.setWithPolars(400,7*-p*Math.PI/8);var s=new ED.Point(0,0);s.setWithPolars(450,7*p*Math.PI/8);var t=new ED.Point(0,0);t.setWithPolars(500,3*p*Math.PI/4),b.moveTo(q.x,q.y),b.bezierCurveTo(r.x,r.y,s.x,s.y,t.x,t.y);var q=new ED.Point(0,0);q.setWithPolars(150,-p*Math.PI/2);var r=new ED.Point(0,0);r.setWithPolars(300,2*-p*Math.PI/8);var s=new ED.Point(0,0);s.setWithPolars(350,5*-p*Math.PI/16);var t=new ED.Point(0,0);t.setWithPolars(450,3*-p*Math.PI/8),b.moveTo(q.x,q.y),b.bezierCurveTo(r.x,r.y,s.x,s.y,t.x,t.y);var q=new ED.Point(0,0);q.setWithPolars(150,-p*Math.PI/2);var r=new ED.Point(0,0);r.setWithPolars(300,6*-p*Math.PI/8);var s=new ED.Point(0,0);s.setWithPolars(350,11*-p*Math.PI/16);var t=new ED.Point(0,0);t.setWithPolars(450,5*-p*Math.PI/8),b.moveTo(q.x,q.y),b.bezierCurveTo(r.x,r.y,s.x,s.y,t.x,t.y),b.lineWidth=48,b.lineCap="round",b.strokeStyle="rgba(255, 0, 0, 0.5)",b.stroke(),"No view"==this.cdRatio&&(b.beginPath(),b.arc(0,0,400,0,2*Math.PI,!0),b.closePath(),b.fillStyle="gray",b.fill())}if("Expert"==this.mode)for(var m=0;m<this.numberOfHandles;m++)this.handleArray[m].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[m]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(0,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.OpticDisc.prototype.description=function(){var a="";if("Expert"==this.mode){for(var b,c=this.getMeanRadius(),d=new Array,e=!1,f=0,g=0;g<this.numberOfHandles;g++)if(this.squiggleArray[0].pointsArray[g].length()<1.1*c){f=g;break}for(var g=0;g<this.numberOfHandles;g++){var h=(g+f)%this.numberOfHandles;this.squiggleArray[0].pointsArray[h].length()>1.1*c?e?b.endHour=this.squiggleArray[0].pointsArray[h].clockHour():(b=new Object,b.startHour=this.squiggleArray[0].pointsArray[h].clockHour(),b.endHour=this.squiggleArray[0].pointsArray[h].clockHour(),e=!0):e&&(d.push(b),e=!1),g==this.numberOfHandles-1&&e&&(b.endHour=this.squiggleArray[0].pointsArray[h].clockHour(),d.push(b),e=!1)}if(d.length>0){var i=d.length>1;a=i?"Notches":"Notch";for(var g=0;g<d.length;g++)a+=d[g].startHour==d[g].endHour?" at "+d[g].startHour:" from "+d[g].startHour+" to "+d[g].endHour+" o'clock",i&&g!=d.length-1&&(a+=", and")}else a=1==this.drawing.doodleArray.length?"No abnormality":""}else a="No view"==this.cdRatio?"No view":1==this.drawing.doodleArray.length?"No abnormality":"";return a},ED.OpticDisc.prototype.setHandleProperties=function(){if("Basic"==this.mode){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a].isVisible=!1;this.handleArray[this.numberOfHandles].isVisible=!0}else{for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a].isVisible=!0;this.handleArray[this.numberOfHandles].isVisible=!1}},ED.OpticDisc.prototype.minimumRadius=function(){var a=500;if("Basic"==this.mode)a=Math.abs(this.apexY);else for(var b=0;b<this.numberOfHandles;b++){var c=this.squiggleArray[0].pointsArray[b].length();a>c&&(a=c)}return a},ED.OpticDisc.prototype.getMeanRadius=function(){if("undefined"!=typeof this.squiggleArray[0]){for(var a=0,b=0;b<this.numberOfHandles;b++)a+=this.squiggleArray[0].pointsArray[b].length();return a/this.numberOfHandles}return-this.apexY},ED.OpticDisc.prototype.setMeanRadius=function(a){for(var b=this.getMeanRadius(),c=0;c<this.numberOfHandles;c++){var d=this.squiggleArray[0].pointsArray[c].length(),e=this.squiggleArray[0].pointsArray[c].direction(),f=d*a/b;f=f>300?300:f,this.squiggleArray[0].pointsArray[c].setWithPolars(f,e)}},ED.OpticDisc.prototype.resetHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.squiggleArray[0].pointsArray[a].setWithPolars(-this.apexY,2*a*Math.PI/this.numberOfHandles)},ED.OpticDiscPit=function(a,b){this.className="OpticDiscPit",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.OpticDiscPit.prototype=new ED.Doodle,ED.OpticDiscPit.prototype.constructor=ED.OpticDiscPit,ED.OpticDiscPit.superclass=ED.Doodle.prototype,ED.OpticDiscPit.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.OpticDiscPit.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.parameterValidationArray.originX.range.setMinAndMax(-200,200),this.parameterValidationArray.originY.range.setMinAndMax(-240,240),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,3),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,3)},ED.OpticDiscPit.prototype.setParameterDefaults=function(){this.originX=0,this.originY=220,this.apexY=0,this.scaleX=1.5;var a=this.drawing.lastDoodleOfClass(this.className);a&&(1==this.drawing.numberOfDoodlesOfClass(this.className)?this.originY=-220:this.setOriginWithDisplacements(-60,-60))},ED.OpticDiscPit.prototype.draw=function(a){var b=this.drawing.context;ED.OpticDiscPit.superclass.draw.call(this,a),b.beginPath();var c=80;b.arc(0,0,c,0,2*Math.PI,!0),b.closePath();var d="rgba(200, 200, 200, 0.75)",e="rgba(100, 100, 100, 0.75)",f=b.createRadialGradient(0,0,c,0,0,10);return f.addColorStop(0,e),f.addColorStop(1,d),b.fillStyle=f,b.lineWidth=2,b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(55,-55)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.OpticDiscPit.prototype.description=function(){return"Acquired pit of optic nerve"},ED.PCIOL=function(a,b){this.className="PCIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,a,b),this.scaleX=.75,this.scaleY=.75},ED.PCIOL.prototype=new ED.Doodle,ED.PCIOL.prototype.constructor=ED.PCIOL,ED.PCIOL.superclass=ED.Doodle.prototype,ED.PCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.PCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isScaleable=!1,this.isUnique=!0},ED.PCIOL.prototype.draw=function(a){var b=this.drawing.context;ED.PCIOL.superclass.draw.call(this,a),b.beginPath();var c=240;b.arc(0,0,c,0,2*Math.PI,!1),b.moveTo(150,-190),b.bezierCurveTo(160,-200,190,-350,160,-380),b.bezierCurveTo(90,-440,-150,-410,-220,-370),b.bezierCurveTo(-250,-350,-260,-400,-200,-430),b.bezierCurveTo(-110,-480,130,-470,200,-430),b.bezierCurveTo(270,-390,220,-140,220,-100),b.moveTo(-150,190),b.bezierCurveTo(-160,200,-190,350,-160,380),b.bezierCurveTo(-90,440,150,410,220,370),b.bezierCurveTo(250,350,260,400,200,430),b.bezierCurveTo(110,480,-130,470,-200,430),b.bezierCurveTo(-270,390,-220,140,-220,100),b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PCIOL.prototype.description=function(){var a="Posterior chamber IOL",b=40,c="";return this.originY<-b&&(c.length>0&&(c+=" and"),c+=" superiorly"),this.originY>b&&(c.length>0&&(c+=" and"),c+=" inferiorly"),this.originX<-b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" temporally":" nasally"),this.originX>b&&(c.length>0&&(c+=" and"),c+=this.drawing.eye==ED.eye.Right?" nasally":" temporally"),c.length>0&&(a+=" displaced"+c),a},ED.PI=function(a,b){this.className="PI",this.type="Surgical",this.patent=!0,this.savedParameterArray=["rotation","type","patent"],this.controlParameterArray={type:"Type",patent:"Patent"},ED.Doodle.call(this,a,b)},ED.PI.prototype=new ED.Doodle,ED.PI.prototype.constructor=ED.PI,ED.PI.superclass=ED.Doodle.prototype,ED.PI.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.type={kind:"derived",type:"string",list:["Surgical","Laser"],animate:!1},this.parameterValidationArray.patent={kind:"derived",type:"bool",display:!1}},ED.PI.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(60,-60)},ED.PI.prototype.draw=function(a){var b=this.drawing.context;ED.PI.superclass.draw.call(this,a);var c=360;switch(b.beginPath(),this.type){case"Surgical":var d=Math.PI/24;b.arc(0,0,c,-d-Math.PI/2,d-Math.PI/2,!1),b.lineTo(0,.8*-c),b.closePath();break;case"Laser":b.arc(0,.9*-c,36,0,2*Math.PI,!0)}return b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",b.fillStyle=this.patent?"rgba(255,255,255,1)":"rgba(150,150,150,1)",this.drawBoundary(a),this.isClicked},ED.PI.prototype.description=function(){return"Peripheral iridectomy at "+this.clockHour()+" o'clock"},ED.PRPPostPole=function(a,b){this.className="PRPPostPole",ED.Doodle.call(this,a,b)},ED.PRPPostPole.prototype=new ED.Doodle,ED.PRPPostPole.prototype.constructor=ED.PRPPostPole,ED.PRPPostPole.superclass=ED.Doodle.prototype,ED.PRPPostPole.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isUnique=!0,this.isMoveable=!1,this.isRotatable=!1},ED.PRPPostPole.prototype.draw=function(a){var b=this.drawing.context;ED.PRPPostPole.superclass.draw.call(this,a),b.beginPath(),b.rect(-480,-480,960,960);var c=320;if(b.moveTo(c,0),b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(255, 255, 255, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var d=15,e=30,f=48,g=(1e3-2*f)/(2*d+e),h=2*d+e,i=10,j=0;g>j;j++)for(var k=0;g>k;k++){var l=-500+f+j*h+Math.round(20*(-.5+ED.randomArray[j+k])),m=-500+f+k*h+Math.round(20*(-.5+ED.randomArray[j+k+100]));l*l+m*m>c*c&&(this.drawing.eye==ED.eye.Right?(13!=j||6!=k&&7!=k&&8!=k&&9!=k)&&(14!=j||7!=k&&8!=k)&&this.drawCircle(b,l,m,d,"Yellow",i,"rgba(255, 128, 0, 1)"):(2!=j||6!=k&&7!=k&&8!=k&&9!=k)&&(1!=j||7!=k&&8!=k)&&this.drawCircle(b,l,m,d,"Yellow",i,"rgba(255, 128, 0, 1)"))}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PRPPostPole.prototype.description=function(){return"Panretinal photocoagulation"},ED.Papilloedema=function(a,b){this.className="Papilloedema",ED.Doodle.call(this,a,b)},ED.Papilloedema.prototype=new ED.Doodle,ED.Papilloedema.prototype.constructor=ED.Papilloedema,ED.Papilloedema.superclass=ED.Doodle.prototype,ED.Papilloedema.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.Papilloedema.prototype.draw=function(a){var b=this.drawing.context;ED.Papilloedema.superclass.draw.call(this,a);var c=450,d=300;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.arc(0,0,d,2*Math.PI,0,!1),b.closePath(),b.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var e="rgba(240, 140, 40, 0.75)",f=b.createRadialGradient(0,0,c,0,0,d);return f.addColorStop(0,yellowColour),f.addColorStop(1,e),b.fillStyle=f,b.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(a),this.isClicked},ED.Papilloedema.prototype.description=function(){return"Papilloedema"},ED.Patch=function(a,b){this.className="Patch",this.material="Sclera",this.savedParameterArray=["originX","originY","width","height","apexX","material"],this.controlParameterArray={material:"Material"},ED.Doodle.call(this,a,b)},ED.Patch.prototype=new ED.Doodle,ED.Patch.prototype.constructor=ED.Patch,ED.Patch.superclass=ED.Doodle.prototype,ED.Patch.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Size,!1)},ED.Patch.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.material={kind:"other",type:"string",list:["Sclera","Tenons","Tutoplast"],animate:!1}},ED.Patch.prototype.setParameterDefaults=function(){this.width=200,this.height=200,this.setParameterFromString("material","Sclera");var a=this.drawing.lastDoodleOfClass("Tube");if(a){var b=this.drawing.eye==ED.eye.Right;switch(a.platePosition){case"STQ":this.originX=b?-350:350,this.originY=-350,this.rotation=(b?7:1)*Math.PI/4;break;case"SNQ":this.originX=b?350:-350,this.originY=-350,this.rotation=(b?1:7)*Math.PI/4;break;case"INQ":this.originX=b?350:-350,this.originY=350,this.rotation=(b?3:5)*Math.PI/4;break;case"ITQ":this.originX=b?-350:350,this.originY=350,this.rotation=(b?5:3)*Math.PI/4}}var a=this.drawing.lastDoodleOfClass("TrabyFlap");a&&(this.originY=-360,this.width=488,this.height=228)},ED.Patch.prototype.draw=function(a){var b=this.drawing.context;switch(ED.Patch.superclass.draw.call(this,a),b.beginPath(),b.rect(-this.width/2,-this.height/2,this.width,this.height),b.closePath(),this.material){case"Sclera":b.fillStyle="rgba(200,200,50,0.5)";break;case"Tenons":b.fillStyle="rgba(200,200,200,0.5)";break;case"Tutoplast":b.fillStyle="rgba(230,230,230,0.5)"}if(b.strokeStyle="rgba(120,120,120,0.5)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=this.width/2,d=this.height/2-10;this.drawSpot(b,-c,-d,5,"blue"),this.drawSpot(b,-c,d,5,"blue"),this.drawSpot(b,c,-d,5,"blue"),this.drawSpot(b,c,d,5,"blue")}return this.handleArray[3].location=this.transform.transformPoint(new ED.Point(this.width/2,-this.height/2)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Patch.prototype.description=function(){return this.material+" patch"},ED.PeripapillaryAtrophy=function(a,b){this.className="PeripapillaryAtrophy",this.outerRadius=340,this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.PeripapillaryAtrophy.prototype=new ED.Doodle,ED.PeripapillaryAtrophy.prototype.constructor=ED.PeripapillaryAtrophy,ED.PeripapillaryAtrophy.superclass=ED.Doodle.prototype,ED.PeripapillaryAtrophy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1)},ED.PeripapillaryAtrophy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.rotation.range.setMinAndMax(7*Math.PI/4,Math.PI/4),this.handleCoordinateRangeArray=new Array;var a=1.4*this.outerRadius,b=this.outerRadius;this.handleCoordinateRangeArray[0]={x:new ED.Range(-a,-b),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[1]={x:new ED.Range(-0,0),y:new ED.Range(-a,-b)},this.handleCoordinateRangeArray[2]={x:new ED.Range(b,a),y:new ED.Range(-0,0)},this.handleCoordinateRangeArray[3]={x:new ED.Range(-0,0),y:new ED.Range(b,a)}},ED.PeripapillaryAtrophy.prototype.setParameterDefaults=function(){var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a),this.addPointToSquiggle(new ED.Point(-this.outerRadius-(this.drawing.eye==ED.eye.Right?100:0),0)),this.addPointToSquiggle(new ED.Point(0,-this.outerRadius)),this.addPointToSquiggle(new ED.Point(this.outerRadius+(this.drawing.eye==ED.eye.Right?0:100),0)),this.addPointToSquiggle(new ED.Point(0,this.outerRadius))},ED.PeripapillaryAtrophy.prototype.draw=function(a){var b=this.drawing.context;ED.PeripapillaryAtrophy.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=.55;c=this.squiggleArray[0].pointsArray[0].x,d=this.squiggleArray[0].pointsArray[0].y,e=this.squiggleArray[0].pointsArray[1].x,f=this.squiggleArray[0].pointsArray[1].y,b.moveTo(c,d),b.bezierCurveTo(c,c*g,f*g,f,e,f),c=e,d=f,e=this.squiggleArray[0].pointsArray[2].x,f=this.squiggleArray[0].pointsArray[2].y,b.bezierCurveTo(-d*g,d,e,-e*g,e,f),c=e,d=f,e=this.squiggleArray[0].pointsArray[3].x,f=this.squiggleArray[0].pointsArray[3].y,b.bezierCurveTo(c,c*g,f*g,f,e,f),c=e,d=f,e=this.squiggleArray[0].pointsArray[0].x,f=this.squiggleArray[0].pointsArray[0].y,b.bezierCurveTo(-d*g,d,e,-e*g,e,f),b.moveTo(280,0),b.arc(0,0,280,0,2*Math.PI,!0),b.closePath(),b.lineWidth=2;var h=new ED.Colour(0,0,0,1);return h.setWithHexString("DFD989"),b.fillStyle=h.rgba(),b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[0]),this.handleArray[1].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[1]),this.handleArray[2].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[2]),this.handleArray[3].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[3]),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked
},ED.PeripapillaryAtrophy.prototype.description=function(){var a="",b=-this.squiggleArray[0].pointsArray[0].x,c=-this.squiggleArray[0].pointsArray[1].y,d=this.squiggleArray[0].pointsArray[2].x,e=this.squiggleArray[0].pointsArray[3].y,f="",g=this.radius;if(b>g&&(g=b,f=this.drawing.eye==ED.eye.Right?"temporally":"nasally"),c>g&&(g=c,f="superiorly"),d>g&&(g=d,f=this.drawing.eye==ED.eye.Right?"nasally":"temporally"),e>g&&(g=e,f="inferiorly"),g>this.radius){var h="Mild";g>350&&(h="Moderate"),g>400&&(h="Signficant"),a+=h,a+=" peri-papillary atrophy, maximum ",a+=f}return a},ED.PeripheralRRD=function(a,b){this.className="PeripheralRRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.PeripheralRRD.prototype=new ED.Doodle,ED.PeripheralRRD.prototype.constructor=ED.PeripheralRRD,ED.PeripheralRRD.superclass=ED.Doodle.prototype,ED.PeripheralRRD.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-300)},ED.PeripheralRRD.prototype.setParameterDefaults=function(){this.arc=112*Math.PI/180,this.apexY=-380;var a=this.drawing.lastDoodleOfClass(this.className);a?this.drawing.eye==ED.eye.Right:this.rotation=this.drawing.eye==ED.eye.Right?-.8*Math.PI:.8*Math.PI},ED.PeripheralRRD.prototype.draw=function(a){var b=this.drawing.context;ED.PeripheralRRD.superclass.draw.call(this,a);var c=476,d=-this.apexY,e=d+(c-d)/2,f=c-d,g=this.arc/2,h=-Math.PI/2+g,i=-Math.PI/2-g,j=e*Math.sin(g),k=-e*Math.cos(g),l=-e*Math.sin(g),m=k,n=new ED.Point(0,0);n.x=-c*Math.sin(g-f/c),n.y=-c*Math.cos(g-f/c);var o=new ED.Point(0,0);o.x=-c*Math.sin(-g+f/c),o.y=-c*Math.cos(-g+f/c),b.beginPath(),b.arc(0,0,c,h,i,!0);var p=i-Math.PI/2;return b.arc(n.x,n.y,f,p,p-Math.PI/2+f/c,!0),b.arc(0,0,d,n.direction()-Math.PI/2,o.direction()-Math.PI/2,!1),p=h+Math.PI/2,b.arc(o.x,o.y,f,p+Math.PI/2-f/c,p,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 255, 0.75)",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(l,m)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PeripheralRRD.prototype.snomedCode=function(){return 232008001},ED.PeripheralRRD.prototype.diagnosticHierarchy=function(){return 8},ED.PeripheralRetinectomy=function(a,b){this.className="PeripheralRetinectomy",this.extent="",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.PeripheralRetinectomy.prototype=new ED.Doodle,ED.PeripheralRetinectomy.prototype.constructor=ED.PeripheralRetinectomy,ED.PeripheralRetinectomy.superclass=ED.Doodle.prototype,ED.PeripheralRetinectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PeripheralRetinectomy.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/4,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-450,-350)},ED.PeripheralRetinectomy.prototype.setParameterDefaults=function(){this.arc=240*Math.PI/180,this.apexY=-380;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+Math.PI/4:Math.PI},ED.PeripheralRetinectomy.prototype.draw=function(a){var b=this.drawing.context;ED.PeripheralRetinectomy.superclass.draw.call(this,a);var c=476,d=-this.apexY,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.lineWidth=4,b.fillStyle="rgba(255,255,0,0)",b.strokeStyle="rgba(255,0,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(b.beginPath(),this.arc<1.95*Math.PI){var m=f-Math.PI/24,n=f-2*Math.PI/24,o=new ED.Point(c*Math.sin(f),-c*Math.cos(f)),p=new ED.Point(e*Math.sin(f),-e*Math.cos(f)),q=new ED.Point(d*Math.sin(m),-d*Math.cos(m)),r=new ED.Point(d*Math.sin(n),-d*Math.cos(n));g=-Math.PI/2+n,h=-Math.PI/2-n;var s=(new ED.Point(-d*Math.sin(n),-d*Math.cos(n)),new ED.Point(-d*Math.sin(m),-d*Math.cos(m))),t=new ED.Point(-e*Math.sin(f),-e*Math.cos(f)),u=new ED.Point(-c*Math.sin(f),-c*Math.cos(f));b.moveTo(o.x,o.y),b.bezierCurveTo(p.x,p.y,q.x,q.y,r.x,r.y),b.arc(0,0,d,g,h,!0),b.bezierCurveTo(s.x,s.y,t.x,t.y,u.x,u.y);var v=10*Math.floor(18*this.arc/Math.PI);this.extent="Retinectomy of "+v+" degrees centred at "+this.clockHour()+" o'clock"}else b.arc(0,0,d,0,2*Math.PI,!0),this.extent="360 degree retinectomy";b.lineWidth=16,b.strokeStyle="red",b.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PeripheralRetinectomy.prototype.description=function(){return this.extent},ED.PhakoIncision=function(a,b){this.className="PhakoIncision",this.defaultRadius=330,this.sutureSeparation=1.5,this.incisionSite="Corneal",this.incisionType="Pocket",this.incisionMeridian=0,this.savedParameterArray=["apexY","arc","rotation","radius"],ED.Doodle.call(this,a,b),this.apexYDelta=this.radius+this.apexY},ED.PhakoIncision.prototype=new ED.Doodle,ED.PhakoIncision.prototype.constructor=ED.PhakoIncision,ED.PhakoIncision.superclass=ED.Doodle.prototype,ED.PhakoIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PhakoIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.radius.range.setMinAndMax(250,450),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.incisionMeridian={kind:"derived",type:"mod",range:new ED.Range(0,360),clock:"bottom",animate:!0},this.parameterValidationArray.incisionLength={kind:"derived",type:"float",range:new ED.Range(1,9.9),precision:1,animate:!0},this.parameterValidationArray.incisionSite={kind:"derived",type:"string",list:["Corneal","Limbal","Scleral"],animate:!0},this.parameterValidationArray.incisionType={kind:"derived",type:"string",list:["Pocket","Section"],animate:!1}},ED.PhakoIncision.prototype.setParameterDefaults=function(){this.setParameterFromString("incisionSite","Corneal"),this.setParameterFromString("incisionLength","3.5"),this.setParameterFromString("incisionType","Pocket"),this.setRotationWithDisplacements(90,-90)},ED.PhakoIncision.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"rotation":var d=(180*(2*Math.PI-b+Math.PI/2)/Math.PI+360)%360;360==d&&(d=0),c.incisionMeridian=d;break;case"arc":c.incisionLength=6*b*this.radius/this.defaultRadius;break;case"radius":c.incisionSite=b>=428?"Scleral":b>=344?"Limbal":"Corneal",c.arc=this.incisionLength*this.defaultRadius/(6*b),this.updateArcRange(),c.apexY=this.apexYDelta-b,this.parameterValidationArray.apexY.range.setMinAndMax(-b,-b+34);break;case"apexY":c.apexYDelta=this.radius+b,c.incisionType=this.radius+b>0?"Section":"Pocket";break;case"incisionMeridian":c.rotation=(90-b+360)%360*Math.PI/180;break;case"incisionLength":c.arc=b*this.defaultRadius/(6*this.radius),this.updateArcRange();break;case"incisionSite":switch(b){case"Scleral":c.radius=428;break;case"Limbal":c.radius=376;break;case"Corneal":c.radius=330}break;case"incisionType":switch(b){case"Pocket":c.apexYDelta=0,c.apexY=-this.radius;break;case"Section":c.apexYDelta=34,c.apexY=34-this.radius}}return c},ED.PhakoIncision.prototype.updateArcRange=function(){this.radius>0?(this.parameterValidationArray.arc.range.min=this.parameterValidationArray.incisionLength.range.min*this.defaultRadius/(6*this.radius),this.parameterValidationArray.arc.range.max=this.parameterValidationArray.incisionLength.range.max*this.defaultRadius/(6*this.radius)):ED.errorHandler("ED.PhakoIncision","updateArcRange","Attempt to calculate a range of arc using an illegal value of radius: "+this.radius)},ED.PhakoIncision.prototype.draw=function(a){var b=this.drawing.context;ED.PhakoIncision.superclass.draw.call(this,a);var c=this.radius,d=40,e=c+d,f=c-d;b.beginPath();var g=this.arc/2;if(b.arc(0,0,e,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,f,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),0==this.apexYDelta?(b.fillStyle="rgba(200,200,200,0.75)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)"):(b.fillStyle="rgba(200,200,200,0)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0)"),this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&0!=this.apexYDelta){b.beginPath(),b.arc(0,0,c,-Math.PI/2+g,-Math.PI/2-g,!0);var h=this.sutureSeparation*this.defaultRadius/(6*this.radius),i=new ED.Point(0,0),j=g-h/2;do i.setWithPolars(c-d,j),b.moveTo(i.x,i.y),i.setWithPolars(c+d,j),b.lineTo(i.x,i.y),j-=h;while(j>-g);b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",b.stroke()}var k=new ED.Point(0,0);return k.setWithPolars(c,g),this.handleArray[3].location=this.transform.transformPoint(k),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PhakoIncision.prototype.description=function(){var a="";return a=this.radius>428?"Scleral ":this.radius>344?"Limbal ":"Corneal ",a+=this.apexY+this.radius==0?"pocket ":"section ",a+="incision at ",a+=this.clockHour()+" o'clock"},ED.PostPole=function(a,b){this.className="PostPole",this.discRadius=84,this.cdRatio="0",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,a,b)},ED.PostPole.prototype=new ED.Doodle,ED.PostPole.prototype.constructor=ED.PostPole,ED.PostPole.superclass=ED.Doodle.prototype,ED.PostPole.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostPole.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0;var a=this.drawing.eye==ED.eye.Right?300:-300;this.parameterValidationArray.apexX.range.setMinAndMax(a,a),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-8),this.parameterValidationArray.cdRatio={kind:"derived",type:"float",range:new ED.Range(0,1),precision:1,animate:!1},this.parameterValidationArray.apexY.delta=5},ED.PostPole.prototype.setParameterDefaults=function(){this.setParameterFromString("cdRatio","0.5"),this.apexX=this.drawing.eye==ED.eye.Right?300:-300},ED.PostPole.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.cdRatio=-b/80;break;case"cdRatio":c.apexY=-(80*+b)}return c},ED.PostPole.prototype.draw=function(a){var b=this.drawing.context;ED.PostPole.superclass.draw.call(this,a);var c=this.drawing.eye==ED.eye.Right?300:-300;if(b.beginPath(),b.arc(c,0,this.discRadius,0,2*Math.PI,!0),b.lineWidth=4,b.strokeStyle="rgba(249,187,76,1)",b.fillStyle="rgba(249,187,76,1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(c,0,-this.apexY,2*Math.PI,0,!1),b.fillStyle="white";var d=b.createPattern(this.drawing.imageArray.CribriformPatternSmall,"repeat");b.fillStyle=d,b.lineWidth=4,b.fill(),b.stroke(),b.beginPath();var e=this.drawing.eye==ED.eye.Right?1:-1,f=-300*e,g=-50*e,h=300*e,i=300*e,j=300*e,k=350*e,l=400*e,m=0;b.moveTo(f,-100),b.bezierCurveTo(g,-500,h,-200,i,-24),b.bezierCurveTo(j,-80,k,-140,l,-160),b.moveTo(l,160),b.bezierCurveTo(k,140,j,80,i,24),b.bezierCurveTo(h,200,g,500,f,100);var n=10;b.moveTo(m,-n),b.lineTo(m,n),b.moveTo(m-n,0),b.lineTo(m+n,0),b.lineWidth=8,b.lineCap="round",b.strokeStyle="red",b.stroke(),b.beginPath(),b.arc(0,0,2*this.discRadius,2*Math.PI,0,!1),b.lineWidth=1,b.strokeStyle="gray",b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PostPole.prototype.description=function(){return 1==this.drawing.doodleArray.length?"No abnormality":""},ED.PostPole.prototype.isWithinDiscDiametersOfFovea=function(a,b){return a.originX*a.originX+a.originY*a.originY<4*b*this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinDisc=function(a){var b=a.originX-(this.drawing.eye==ED.eye.Right?300:-300);return b*b+a.originY*a.originY<this.discRadius*this.discRadius},ED.PostPole.prototype.isWithinArcades=function(a){return a.originX*a.originX+a.originY*a.originY<9e4},ED.PostSubcapCataract=function(a,b){this.className="PostSubcapCataract",this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,a,b)},ED.PostSubcapCataract.prototype=new ED.Doodle,ED.PostSubcapCataract.prototype.constructor=ED.PostSubcapCataract,ED.PostSubcapCataract.superclass=ED.Doodle.prototype,ED.PostSubcapCataract.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PostSubcapCataract.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="Lens",this.inFrontOfClassArray=["Lens"],this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(35,100),this.parameterValidationArray.apexY.range.setMinAndMax(-100,-35)},ED.PostSubcapCataract.prototype.setParameterDefaults=function(){this.apexX=35,this.apexY=35,this.radius=50},ED.PostSubcapCataract.prototype.dependentParameterValues=function(a){var b=new Array;switch(a){case"apexX":b.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);break;case"apexY":b.radius=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY)}return b},ED.PostSubcapCataract.prototype.draw=function(a){var b=this.drawing.context;ED.PostSubcapCataract.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,this.radius,0,2*Math.PI,!1),b.closePath(),b.lineWidth=4;var c=b.createPattern(this.drawing.imageArray.PSCPattern,"repeat");b.fillStyle=c,b.strokeStyle="lightgray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw;var d=new ED.Point(0,0);return d.setWithPolars(this.radius,Math.PI/4),this.handleArray[4].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PostSubcapCataract.prototype.description=function(){return"Posterior subcapsular cataract"},ED.PostSubcapCataract.prototype.snomedCode=function(){return 315353005},ED.PostSubcapCataract.prototype.diagnosticHierarchy=function(){return 3},ED.PostSubcapCataractCrossSection=function(a,b){this.className="PostSubcapCataractCrossSection",this.grade="Mild",ED.Doodle.call(this,a,b)},ED.PostSubcapCataractCrossSection.prototype=new ED.Doodle,ED.PostSubcapCataractCrossSection.prototype.constructor=ED.PostSubcapCataractCrossSection,ED.PostSubcapCataractCrossSection.superclass=ED.Doodle.prototype,ED.PostSubcapCataractCrossSection.prototype.setHandles=function(){},ED.PostSubcapCataractCrossSection.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isRotatable=!1,this.isUnique=!0,this.parentClass="LensCrossSection",this.inFrontOfClassArray=["LensCrossSection"],this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-180,-20)},ED.PostSubcapCataractCrossSection.prototype.setParameterDefaults=function(){this.originX=44,this.apexY=-35},ED.PostSubcapCataractCrossSection.prototype.draw=function(a){var b=this.drawing.context;ED.PostSubcapCataractCrossSection.superclass.draw.call(this,a);var c=240,d=300,e=100,f=Math.asin(c/d),g=d*Math.cos(f),h=d-10;f=Math.acos(g/h);var i=Math.asin(-this.apexY/h);return b.beginPath(),b.arc(e-g,0,h,-i,i,!1),b.lineWidth=10,b.lineCap="round",b.lineJoin="round",b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(150,150,150,0.75)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PosteriorCapsule=function(a,b){this.className="PosteriorCapsule",this.opacity="Mild",this.capsulotomy="None",this.savedParameterArray=["originX","originY","opacity","capsulotomy"],this.controlParameterArray={opacity:"Opacity",capsulotomy:"Capsulotomy"},ED.Doodle.call(this,a,b)},ED.PosteriorCapsule.prototype=new ED.Doodle,ED.PosteriorCapsule.prototype.constructor=ED.PosteriorCapsule,ED.PosteriorCapsule.superclass=ED.Doodle.prototype,ED.PosteriorCapsule.prototype.setPropertyDefaults=function(){this.isUnique=!0,this.addAtBack=!0,this.parameterValidationArray.originX.range.setMinAndMax(-500,500),this.parameterValidationArray.originY.range.setMinAndMax(-500,500),this.parameterValidationArray.opacity={kind:"derived",type:"string",list:["None","Mild","Moderate","Dense"],animate:!1},this.parameterValidationArray.capsulotomy={kind:"derived",type:"string",list:["None","Diamond","Circle"],animate:!1}},ED.PosteriorCapsule.prototype.setParameterDefaults=function(){},ED.PosteriorCapsule.prototype.draw=function(a){var b=this.drawing.context;ED.PosteriorCapsule.superclass.draw.call(this,a);var c=240;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=4,b.fillStyle="rgba(255, 255, 255, 0)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if("None"!=this.capsulotomy){b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0);var d=140;switch(b.moveTo(d,0),this.capsulotomy){case"Diamond":b.lineTo(0,d),b.lineTo(-d,0),b.lineTo(0,-d),b.lineTo(d,0),b.closePath();break;case"Circle":b.arc(0,0,d,0,2*Math.PI,!1)}}if("None"!=this.opacity){var e=b.createPattern(this.drawing.imageArray.PSCPattern,"repeat");switch(b.fillStyle=e,b.fill(),this.opacity){case"Mild":b.fillStyle="rgba(255, 255, 255, 0.5)";break;case"Moderate":b.fillStyle="rgba(200, 200, 200, 0.5)";break;case"Dense":b.fillStyle="rgba(150, 150, 150, 0.5)"}b.fill(),b.stroke()}}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PosteriorCapsule.prototype.description=function(){var a="";if("None"!=this.opacity&&(a+=this.opacity+" posterior capsular opacity"),"None"!=this.capsulotomy){var b=this.capsulotomy.toLowerCase();a+=" with "+b+" shaped capsulotomy"}return a},ED.PosteriorEmbryotoxon=function(a,b){this.className="PosteriorEmbryotoxon",ED.Doodle.call(this,a,b)},ED.PosteriorEmbryotoxon.prototype=new ED.Doodle,ED.PosteriorEmbryotoxon.prototype.constructor=ED.PosteriorEmbryotoxon,ED.PosteriorEmbryotoxon.superclass=ED.Doodle.prototype,ED.PosteriorEmbryotoxon.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0},ED.PosteriorEmbryotoxon.prototype.draw=function(a){var b=this.drawing.context;ED.PosteriorEmbryotoxon.superclass.draw.call(this,a);var c=370,d=340,e=0,f=2*Math.PI;return b.beginPath(),b.arc(0,0,c,e,f,!0),b.arc(0,0,d,f,e,!1),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(255,255,255,0.6)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.isClicked},ED.PosteriorEmbryotoxon.prototype.description=function(){return"Posterior Embryotoxon"},ED.PosteriorRetinectomy=function(a,b){this.className="PosteriorRetinectomy",this.savedParameterArray=["originX","originY","apexY"],ED.Doodle.call(this,a,b)},ED.PosteriorRetinectomy.prototype=new ED.Doodle,ED.PosteriorRetinectomy.prototype.constructor=ED.PosteriorRetinectomy,ED.PosteriorRetinectomy.superclass=ED.Doodle.prototype,ED.PosteriorRetinectomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorRetinectomy.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-50)},ED.PosteriorRetinectomy.prototype.setParameterDefaults=function(){this.apexX=0,this.apexY=-100;var a=100;this.originX=a,this.originY=-a;var b=this.drawing.lastDoodleOfClass(this.className);if(b){var c=new ED.Point(b.originX,b.originY),d=c.direction()+Math.PI/8,e=c.length(),f=new ED.Point(0,0);f.setWithPolars(e,d),this.originX=f.x,this.originY=f.y}},ED.PosteriorRetinectomy.prototype.draw=function(a){var b=this.drawing.context;ED.PosteriorRetinectomy.superclass.draw.call(this,a),b.beginPath();var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY),d=16;return b.arc(0,0,c+d,0,2*Math.PI,!0),b.arc(0,0,c-d,2*Math.PI,0,!1),b.closePath(),b.lineWidth=1,b.fillStyle="rgba(255,255,0,0)",b.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=16,b.strokeStyle="red",b.stroke()),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PosteriorRetinectomy.prototype.groupDescription=function(){return"Posterior retinectomy"},ED.PosteriorSynechia=function(a,b){this.className="PosteriorSynechia",this.size=150,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.PosteriorSynechia.prototype=new ED.Doodle,ED.PosteriorSynechia.prototype.constructor=ED.PosteriorSynechia,ED.PosteriorSynechia.superclass=ED.Doodle.prototype,ED.PosteriorSynechia.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PosteriorSynechia.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-0),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI/3),this.parameterValidationArray.size={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.PosteriorSynechia.prototype.setParameterDefaults=function(){this.arc=Math.PI/6,this.setRotationWithDisplacements(90,45);var a=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=a?a.apexY+this.size:-200},ED.PosteriorSynechia.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"size":var d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c.apexY=d.apexY-b);break;case"apexY":var d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c.size=d.apexY-b)}return c},ED.PosteriorSynechia.prototype.draw=function(a){var b=this.drawing.context;ED.PosteriorSynechia.superclass.draw.call(this,a);var c=200,d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c=-d.apexY);-this.apexY;b.beginPath();var e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=new ED.Point(-c*Math.sin(e),-c*Math.cos(e)),i=new ED.Point(c*Math.sin(e),-c*Math.cos(e));b.beginPath(),b.arc(0,0,c,g,f,!1);var j=new ED.Point(this.apexX,this.apexY),k=i.pointAtAngleToLineToPointAtProportion(Math.PI/12,j,.33),l=j.pointAtAngleToLineToPointAtProportion(-Math.PI/12,i,.33);b.bezierCurveTo(k.x,k.y,l.x,l.y,this.apexX,this.apexY);var m=j.pointAtAngleToLineToPointAtProportion(Math.PI/12,h,.33),n=h.pointAtAngleToLineToPointAtProportion(-Math.PI/12,j,.33);switch(b.bezierCurveTo(m.x,m.y,n.x,n.y,h.x,h.y),b.closePath(),d.colour){case"Blue":b.fillStyle="rgba(100, 200, 250, 0.5)";break;case"Brown":b.fillStyle="rgba(172, 100, 55, 0.5)";break;case"Gray":b.fillStyle="rgba(125, 132, 116, 0.5)";break;case"Green":b.fillStyle="rgba(114, 172, 62, 0.5)"}return b.lineWidth=4,b.strokeStyle="rgba(250, 250, 250, 0.0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,c,g,f,!1),b.lineWidth=6,b.strokeStyle="white",b.stroke(),b.strokeStyle=b.fillStyle,b.stroke(),b.beginPath(),b.moveTo(i.x,i.y),b.bezierCurveTo(k.x,k.y,l.x,l.y,this.apexX,this.apexY),b.bezierCurveTo(m.x,m.y,n.x,n.y,h.x,h.y),b.lineWidth=4,b.strokeStyle="gray",b.stroke()),this.handleArray[0].location=this.transform.transformPoint(h),this.handleArray[3].location=this.transform.transformPoint(i),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PosteriorSynechia.prototype.groupDescription=function(){return"Posterior synechiae at "},ED.PosteriorSynechia.prototype.description=function(){return this.clockHour()+" o'clock"},ED.PreRetinalHaemorrhage=function(a,b){this.className="PreRetinalHaemorrhage",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.PreRetinalHaemorrhage.prototype=new ED.Doodle,ED.PreRetinalHaemorrhage.prototype.constructor=ED.PreRetinalHaemorrhage,ED.PreRetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.PreRetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.PreRetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,200),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,2),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,2)},ED.PreRetinalHaemorrhage.prototype.setParameterDefaults=function(){this.apexY=200,this.setOriginWithDisplacements(-150,150)},ED.PreRetinalHaemorrhage.prototype.draw=function(a){var b=this.drawing.context;ED.PreRetinalHaemorrhage.superclass.draw.call(this,a);var c=100,d=.6;return b.beginPath(),b.moveTo(c,0),b.lineTo(-c,0),b.bezierCurveTo(-c*d,0,-c*d,this.apexY,0,this.apexY),b.bezierCurveTo(c*d,this.apexY,c*d,0,c,0),b.closePath(),b.lineWidth=1,b.strokeStyle="red",b.fillStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(100,0)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.PreRetinalHaemorrhage.prototype.groupDescription=function(){return"Pre-retinal haemorrages"},ED.RK=function(a,b){this.className="RK",this.numberOfCuts="8",this.savedParameterArray=["apexY","scaleX","scaleY","rotation","numberOfCuts"],this.controlParameterArray={numberOfCuts:"Number of Cuts"},ED.Doodle.call(this,a,b)},ED.RK.prototype=new ED.Doodle,ED.RK.prototype.constructor=ED.RK,ED.RK.superclass=ED.Doodle.prototype,ED.RK.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RK.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.15),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.15),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-60),this.parameterValidationArray.numberOfCuts={kind:"other",type:"string",list:["4","8","16"],animate:!1}},ED.RK.prototype.setParameterDefaults=function(){this.apexY=-100},ED.RK.prototype.draw=function(a){var b=this.drawing.context;ED.RK.superclass.draw.call(this,a);var c=320,d=-this.apexY,e=parseInt(this.numberOfCuts),f=0,g=2*Math.PI;if(b.beginPath(),b.arc(0,0,c,f,g,!0),b.moveTo(d,0),b.arc(0,0,d,g,f,!1),b.closePath(),b.fillStyle="rgba(155,255,255,0)",b.lineWidth=2,b.strokeStyle="rgba(100,100,100,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var h=2*Math.PI/e;b.strokeStyle="rgba(100,100,100,0.7)",b.beginPath();var i;for(i=0;e>i;i++){var j=i*h,k=new ED.Point(0,0);k.setWithPolars(d,j);var l=new ED.Point(0,0);l.setWithPolars(c,j),b.moveTo(k.x,k.y),b.lineTo(l.x,l.y),b.closePath()}b.stroke()}var m=new ED.Point(0,0);return m.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(m),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RK.prototype.description=function(){return"Radial keratotomy"},ED.RPEAtrophy=function(a,b){this.className="RPEAtrophy",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.RPEAtrophy.prototype=new ED.Doodle,ED.RPEAtrophy.prototype.constructor=ED.RPEAtrophy,ED.RPEAtrophy.superclass=ED.Doodle.prototype,ED.RPEAtrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RPEAtrophy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-60)},ED.RPEAtrophy.prototype.draw=function(a){var b=this.drawing.context;ED.RPEAtrophy.superclass.draw.call(this,a);var c=120;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.fillStyle="rgba(253, 238, 173, 0.75)",b.strokeStyle=b.fillStyle,this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RPEAtrophy.prototype.groupDescription=function(){return"RPE atrophy"},ED.RPEDetachment=function(a,b){this.className="RPEDetachment",this.numberOfHandles=4,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,a,b)},ED.RPEDetachment.prototype=new ED.Doodle,ED.RPEDetachment.prototype.constructor=ED.RPEDetachment,ED.RPEDetachment.superclass=ED.Doodle.prototype,ED.RPEDetachment.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.RPEDetachment.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=this.numberOfHandles,d=new Object;d.length=new ED.Range(50,290),d.angle=new ED.Range(((2*c-1)*b/(2*c)+a*b/c)%b,(1*b/(2*c)+a*b/c)%b),this.handleVectorRangeArray[a]=d}},ED.RPEDetachment.prototype.setParameterDefaults=function(){var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX+150,0);this.move(b.x,b.y)}var c=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(c);for(var d=0;d<this.numberOfHandles;d++){var e=new ED.Point(0,0);e.setWithPolars(this.initialRadius,2*d*Math.PI/this.numberOfHandles),this.addPointToSquiggle(e)}},ED.RPEDetachment.prototype.draw=function(a){var b=this.drawing.context;ED.RPEDetachment.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y)}b.closePath(),b.lineWidth=4,b.fillStyle="rgba(173, 48, 14, 1)",b.strokeStyle="brown",this.drawBoundary(a);for(var h=0;h<this.numberOfHandles;h++)this.handleArray[h].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[h]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RPEDetachment.prototype.description=function(){return"Retinal pigment epithelial detachment"},ED.RPEHypertrophy=function(a,b){this.className="RPEHypertrophy",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.RPEHypertrophy.prototype=new ED.Doodle,ED.RPEHypertrophy.prototype.constructor=ED.RPEHypertrophy,ED.RPEHypertrophy.superclass=ED.Doodle.prototype,ED.RPEHypertrophy.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)
},ED.RPEHypertrophy.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(-300,-60)},ED.RPEHypertrophy.prototype.draw=function(a){var b=this.drawing.context;ED.RPEHypertrophy.superclass.draw.call(this,a);var c=60;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,b.fillStyle="rgba(145, 96, 80, 1.0)",b.strokeStyle=b.fillStyle,this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RPEHypertrophy.prototype.groupDescription=function(){return"RPE hypertrophy"},ED.RPERip=function(a,b){this.className="RPERip",this.initialRadius=150,this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.RPERip.prototype=new ED.Doodle,ED.RPERip.prototype.constructor=ED.RPERip,ED.RPERip.superclass=ED.Doodle.prototype,ED.RPERip.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RPERip.prototype.setPropertyDefaults=function(){this.parameterValidationArray.originX.range.setMinAndMax(-120,120),this.parameterValidationArray.originY.range.setMinAndMax(-120,120),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-this.initialRadius,+this.initialRadius),this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.RPERip.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.setRotationWithDisplacements(90,0),this.setOriginWithDisplacements(0,100)},ED.RPERip.prototype.draw=function(a){var b=this.drawing.context;ED.RPERip.superclass.draw.call(this,a);var c=this.initialRadius,d=this.arc/2,e=-Math.PI/2+d,f=-Math.PI/2-d,g=c*Math.sin(d),h=-c*Math.cos(d),i=-c*Math.sin(d),j=h;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=4,b.fillStyle="rgba(251, 147, 76, 0.75)",b.strokeStyle="red",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(0,0,c,e,f,!0);var k=.6;b.bezierCurveTo(i,j,k*i,this.apexY,this.apexX,this.apexY),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h),b.lineWidth=4,b.fillStyle="rgba(180, 125, 60, 0.75)",b.strokeStyle="brown",b.fill(),b.stroke()}this.handleArray[1].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(g,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY));var l=new ED.Point(0,0);return l.setWithPolars(c,Math.PI/8),this.handleArray[3].location=this.transform.transformPoint(l),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RPERip.prototype.description=function(){return"RPE rip"},ED.RRD=function(a,b){this.className="RRD",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.RRD.prototype=new ED.Doodle,ED.RRD.prototype.constructor=ED.RRD,ED.RRD.superclass=ED.Doodle.prototype,ED.RRD.prototype.setHandles=function(){this.handleArray[1]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RRD.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,400)},ED.RRD.prototype.setParameterDefaults=function(){this.arc=120*Math.PI/180,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RRD.prototype.draw=function(a){var b=this.drawing.context;ED.RRD.superclass.draw.call(this,a);var c=476,d=this.arc/2,e=-Math.PI/2+d,f=-Math.PI/2-d,g=c*Math.sin(d),h=-c*Math.cos(d),i=-c*Math.sin(d),j=h;b.beginPath(),b.arc(0,0,c,e,f,!0);var k=.6,l=25;if(this.apexY<-l)b.bezierCurveTo(i,j,k*i,this.apexY,this.apexX,this.apexY),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h);else if(this.apexY<l){var m=Math.acos((0-this.apexY)/l),n=l*Math.sin(m);b.bezierCurveTo(i,j,k*i,this.apexY,-n,this.apexY),b.arc(0,0,l,-Math.PI/2-m,-Math.PI/2+m,!1),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h)}else b.bezierCurveTo(i,j,k*i,this.apexY,0,25),b.arc(0,0,l,Math.PI/2,2.5*Math.PI,!1),b.bezierCurveTo(-k*i,this.apexY,g,h,g,h);return b.lineWidth=4,b.fillStyle="rgba(0, 0, 255, 0.75)",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[1].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(g,h)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RRD.prototype.description=function(){var a="";return a+=Math.cos(this.rotation)>0?"Supero":"Infero",a+=Math.sin(this.rotation)>0?this.drawing.eye==ED.eye.Right?"nasal":"temporal":this.drawing.eye==ED.eye.Right?"temporal":"nasal",a+=" retinal detachment",a+=this.isMacOff()?" (macula off)":" (macula on)"},ED.RRD.prototype.snomedCode=function(){return this.isMacOff()?232009009:232008001},ED.RRD.prototype.diagnosticHierarchy=function(){return this.isMacOff()?10:9},ED.RRD.prototype.isMacOff=function(){if(this.drawing.eye==ED.eye.Right)var a=new ED.Point(-100,0);else var a=new ED.Point(100,0);var b=this.drawing.transform.transformPoint(a);return this.draw(b)?!0:!1},ED.RadialSponge=function(a,b){this.className="RadialSponge",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.RadialSponge.prototype=new ED.Doodle,ED.RadialSponge.prototype.constructor=ED.RadialSponge,ED.RadialSponge.superclass=ED.Doodle.prototype,ED.RadialSponge.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.addAtBack=!0},ED.RadialSponge.prototype.setParameterDefaults=function(){var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+Math.PI/6:-60*Math.PI/180},ED.RadialSponge.prototype.draw=function(a){var b=this.drawing.context;ED.RadialSponge.superclass.draw.call(this,a);var c=-220,d=200,e=80;return b.beginPath(),b.moveTo(-e/2,c),b.lineTo(-e/2,c-d),b.lineTo(e/2,c-d),b.lineTo(e/2,c),b.closePath(),b.lineWidth=4,b.fillStyle="lightgray",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,c-d+40,5,0,2*Math.PI,!0),b.lineTo(-20,c-d+30),b.moveTo(0,c-d+40),b.lineTo(20,c-d+30),b.moveTo(-e/2-20,c-40),b.lineTo(-e/2-20,c-d+40),b.lineTo(e/2+20,c-d+40),b.lineTo(e/2+20,c-40),b.closePath(),b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RadialSponge.prototype.groupDescription=function(){return"Radial sponge at "},ED.RadialSponge.prototype.description=function(){return this.clockHour()+" o'clock"},ED.Rectus=function(a,b){this.className="Rectus",this.insertionY=-200,this.hangback=!1,this.canTranspose=!0,this.recession=0,this.transposition="None",this.savedParameterArray=["apexX","apexY","rotation"],ED.Doodle.call(this,a,b)},ED.Rectus.prototype=new ED.Doodle,ED.Rectus.prototype.constructor=ED.Rectus,ED.Rectus.superclass=ED.Doodle.prototype,ED.Rectus.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rectus.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.recession={kind:"derived",type:"float",range:new ED.Range(-12.5,6.5),precision:1,animate:!0},this.parameterValidationArray.transposition={kind:"derived",type:"string",list:["Up","None","Down"],animate:!0},this.parameterValidationArray.canTranspose={kind:"derived",type:"bool",animate:!0}},ED.Rectus.prototype.setParameterDefaults=function(){this.setParameterFromString("recession","0"),this.setParameterFromString("transposition","None"),this.apexY=this.insertionY,this.canTranspose=!0},ED.Rectus.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.recession=Math.round(2*(b-this.insertionY)/16)/2;break;case"recession":c.apexY=16*b+this.insertionY;break;case"apexX":c.transposition=this.rotation>0&&this.rotation<Math.PI?0>b?"Up":b>0?"Down":"None":0>b?"Down":b>0?"Up":"None";break;case"transposition":switch(b){case"Up":c.apexX=this.rotation>0&&this.rotation<Math.PI?-50:50;break;case"Down":c.apexX=this.rotation>0&&this.rotation<Math.PI?50:-50;break;case"None":c.apexX=0}}var d=15;return this.apexY>this.insertionY-d&&this.apexY<this.insertionY+d&&this.canTranspose?this.parameterValidationArray.apexX.range.setMinAndMax(-100,100):this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.apexX>-d&&this.apexX<d?this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100):this.parameterValidationArray.apexY.range.setMinAndMax(-200,-200),c},ED.Rectus.prototype.draw=function(a){var b=this.drawing.context;ED.Rectus.superclass.draw.call(this,a),b.beginPath();var c=60,d=-450;if(b.moveTo(-c,d),b.lineTo(c,d),b.lineTo(this.apexX+c,this.apexY),b.lineTo(this.apexX-c,this.apexY),b.closePath(),b.lineWidth=2,b.fillStyle="rgba(255, 140 , 80, 1)",b.strokeStyle="rgba(255, 184, 93, 1)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(this.insertionY<this.apexY){var e=-c+this.apexX*(this.insertionY-d)/(this.apexY-d);b.beginPath(),b.moveTo(e,this.insertionY),b.lineTo(e+2*c,this.insertionY),b.lineTo(this.apexX+c,this.apexY),b.lineTo(this.apexX-c,this.apexY),b.closePath(),b.fillStyle="rgba(255, 220, 140, 1)",b.fill()}if(0!=this.apexX||this.apexY!=this.insertionY){var f,g=15,h=15,i=10,j=20;f=this.insertionY>this.apexY?this.apexY:this.insertionY;var k;k=!this.hangback&&this.insertionY>this.apexY?this.apexY+g:this.insertionY+g;var l=this.apexX;b.beginPath(),b.moveTo(l,k),b.lineTo(l-h,k+h),b.moveTo(l+h,k+h),b.lineTo(l,k),b.arc(l,k,4,0,2*Math.PI,!0),b.moveTo(l,k),b.lineTo(l-c+i,k),b.lineTo(l-c+i,f),b.moveTo(l-c+i,f-g),b.lineTo(l-c+i+j,f-g),b.moveTo(l+c-i-j,f-g),b.lineTo(l+c-i,f-g),b.moveTo(l+c-i,f),b.lineTo(l+c-i,k),b.lineTo(l,k),b.lineWidth=4,b.strokeStyle="black",b.stroke()}}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RetinalArteryOcclusionPostPole=function(a,b){this.className="RetinalArteryOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.RetinalArteryOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalArteryOcclusionPostPole.prototype.constructor=ED.RetinalArteryOcclusionPostPole,ED.RetinalArteryOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalArteryOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalArteryOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalArteryOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalArteryOcclusionPostPole.prototype.draw=function(a){var b=this.drawing.context;ED.RetinalArteryOcclusionPostPole.superclass.draw.call(this,a);var c=420,d=-this.apexY,e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=c*Math.sin(e),i=-c*Math.cos(e),j=-c*Math.sin(e),k=i;return b.beginPath(),b.arc(0,0,c,f,g,!0),b.arc(0,0,d,g,f,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(200,200,200,0.5)",b.strokeStyle="rgba(200,200,200,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&this.apexY>-70&&(b.beginPath(),b.arc(0,0,-this.apexY,0,2*Math.PI,!0),b.fillStyle="rgba(200,0,0,0.5)",b.fill()),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RetinalArteryOcclusionPostPole.prototype.description=function(){var a="",b=this.type();switch(b){case"branch":a=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",a+="branch ";break;case"hemispheric":a=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",a+="hemispheric ";break;case"central":a+="Central "}return a+="retinal artery occlusion",a+=this.apexY<-150?" sparing":" involving",a+=" the macula",this.apexY>-70&&(a+=" with a cherry red spot"),a},ED.RetinalArteryOcclusionPostPole.prototype.snomedCode=function(){var a=this.type();switch(a){case"branch":return 232035005;case"hemispheric":return 232035005;case"central":return 38742007}},ED.RetinalArteryOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.RetinalHaemorrhage=function(a,b){this.className="RetinalHaemorrhage",this.layer="Pre-retinal",this.savedParameterArray=["originX","originY","scaleX","scaleY"],this.controlParameterArray={layer:"Layer"},ED.Doodle.call(this,a,b)},ED.RetinalHaemorrhage.prototype=new ED.Doodle,ED.RetinalHaemorrhage.prototype.constructor=ED.RetinalHaemorrhage,ED.RetinalHaemorrhage.superclass=ED.Doodle.prototype,ED.RetinalHaemorrhage.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RetinalHaemorrhage.prototype.setPropertyDefaults=function(){this.parameterValidationArray.layer={kind:"other",type:"string",list:["Pre-retinal","Intra-retinal","Sub-retinal","Sub-RPE"],animate:!1}},ED.RetinalHaemorrhage.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(0,-60),this.setParameterFromString("layer","Pre-retinal")},ED.RetinalHaemorrhage.prototype.draw=function(a){var b=this.drawing.context;ED.RetinalHaemorrhage.superclass.draw.call(this,a);var c=90;switch(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1,this.layer){case"Pre-retinal":b.fillStyle="rgba(255,0,0,1.0)",b.strokeStyle=b.fillStyle;break;case"Intra-retinal":b.fillStyle="rgba(255,0,0,0.75)",b.strokeStyle=b.fillStyle;break;case"Sub-retinal":b.fillStyle="rgba(255,0,0,0.5)",b.strokeStyle=b.fillStyle;break;case"Sub-RPE":b.fillStyle="rgba(255,0,0,0.25)",b.strokeStyle=b.fillStyle}this.drawBoundary(a);var d=new ED.Point(0,0);return d.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(d),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RetinalHaemorrhage.prototype.groupDescription=function(){var a="";switch(this.layer){case"Pre-retinal":a="Pre-retinal";break;case"Intra-retinal":a="Intra-retinal";break;case"Sub-retinal":a="Sub-retinal";break;case"Sub-RPE":a="Sub-RPE"}return a+=" haemorrhage"},ED.RetinalTouch=function(a,b){this.className="RetinalTouch",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,a,b)},ED.RetinalTouch.prototype=new ED.Doodle,ED.RetinalTouch.prototype.constructor=ED.RetinalTouch,ED.RetinalTouch.superclass=ED.Doodle.prototype,ED.RetinalTouch.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(140,100)},ED.RetinalTouch.prototype.draw=function(a){var b=this.drawing.context;if(ED.RetinalTouch.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,60,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,0,0,0)",b.strokeStyle="rgba(255,0,0,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var c=8,d=20,e=40;b.beginPath(),b.arc(0,0,d,0,2*Math.PI,!0);for(var f=0,g=0;c>g;g++){f+=2*Math.PI/c;var h=new ED.Point(0,0),i=new ED.Point(0,0);h.setWithPolars(d,f),i.setWithPolars(e,f),b.moveTo(h.x,h.y),b.lineTo(i.x,i.y)}b.lineWidth=8,b.strokeStyle="red",b.stroke()}return this.isClicked},ED.RetinalVeinOcclusionPostPole=function(a,b){this.className="RetinalVeinOcclusionPostPole",this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.RetinalVeinOcclusionPostPole.prototype=new ED.Doodle,ED.RetinalVeinOcclusionPostPole.prototype.constructor=ED.RetinalVeinOcclusionPostPole,ED.RetinalVeinOcclusionPostPole.superclass=ED.Doodle.prototype,ED.RetinalVeinOcclusionPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.RetinalVeinOcclusionPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-200,-30)},ED.RetinalVeinOcclusionPostPole.prototype.setParameterDefaults=function(){this.arc=Math.PI/2,this.apexY=-100,this.setRotationWithDisplacements(45,120)},ED.RetinalVeinOcclusionPostPole.prototype.draw=function(a){var b=this.drawing.context;ED.RetinalVeinOcclusionPostPole.superclass.draw.call(this,a);var c=420,d=-this.apexY,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=c*Math.sin(f),j=-c*Math.cos(f),k=-c*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,255,0,0)",b.strokeStyle="rgba(255,255,0,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var m=30,n=30+m,o=[26,24,22,18,14,10],p=0,e=c-m;e>d;e-=n){for(var q=0,r=-Math.PI/2-g;r<this.arc-Math.PI/2-g;r+=n/e){r=-Math.PI/2-g+2*q*Math.PI/o[p];var s=new ED.Point(0,0);s.setWithPolars(e,r),this.drawNFLHaem(b,s.x,s.y),q++}p++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RetinalVeinOcclusionPostPole.prototype.description=function(){var a="",b=this.type();switch(b){case"branch":a=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferotemporal ":"Superotemporal ",a+="branch ";break;case"hemispheric":a=this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?"Inferior ":"Superior ",a+="hemispheric ";break;case"central":a+="Central "}return a+="retinal vein occlusion ",a+=this.apexY<-150?"sparing ":"involving ",a+="the macula "},ED.RetinalVeinOcclusionPostPole.prototype.snomedCode=function(){var a=this.type();switch(a){case"branch":return 24596005;case"hemispheric":return 232043e3;case"central":return 68478007}},ED.RetinalVeinOcclusionPostPole.prototype.type=function(){return this.arc>1.5*Math.PI?"central":this.arc>.8*Math.PI?"hemispheric":"branch"},ED.RingSegment=function(a,b){this.className="RingSegment",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.RingSegment.prototype=new ED.Doodle,ED.RingSegment.prototype.constructor=ED.RingSegment,ED.RingSegment.superclass=ED.Doodle.prototype,ED.RingSegment.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.RingSegment.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2)},ED.RingSegment.prototype.setParameterDefaults=function(){this.arc=30*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);a?(this.rotation=a.rotation+Math.PI,this.arc=a.arc):this.rotation=this.drawing.eye==ED.eye.Right?-Math.PI/2:Math.PI/2},ED.RingSegment.prototype.draw=function(a){var b=this.drawing.context;ED.RingSegment.superclass.draw.call(this,a);var c=300,d=20,e=c+d,f=c-d;b.beginPath();var g=this.arc/2;b.arc(0,0,e,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,f,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a);var h=new ED.Point(0,0);return h.setWithPolars(c,g),this.handleArray[3].location=this.transform.transformPoint(h),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.RingSegment.prototype.description=function(){var a="Limbal relaxing incision "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return a+=this.clockHour()+" o'clock"},ED.RoundHole=function(a,b){this.className="RoundHole",this.savedParameterArray=["originX","originY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.RoundHole.prototype=new ED.Doodle,ED.RoundHole.prototype.constructor=ED.RoundHole,ED.RoundHole.superclass=ED.Doodle.prototype,ED.RoundHole.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1)},ED.RoundHole.prototype.setPropertyDefaults=function(){},ED.RoundHole.prototype.setParameterDefaults=function(){var a=300;this.originX=a,this.originY=a;var b=this.drawing.lastDoodleOfClass(this.className);if(b){var c=new ED.Point(b.originX,b.originY),d=c.direction()+Math.PI/8,e=c.length(),f=new ED.Point(0,0);f.setWithPolars(e,d),this.originX=f.x,this.originY=f.y}},ED.RoundHole.prototype.draw=function(a){var b=this.drawing.context;ED.RoundHole.superclass.draw.call(this,a),b.beginPath(),b.arc(0,0,30,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,this.handleArray[2].location=this.transform.transformPoint(new ED.Point(21,-21)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a);var c=this.transform.transformPoint(new ED.Point(0,0)),d=this.transform.transformPoint(new ED.Point(60,0)),e=c.x-this.drawing.canvas.width/2,f=c.y-this.drawing.canvas.height/2,g=this.scaleX*Math.sqrt(e*e+f*f),h=this.scaleX*(d.x-c.x);return this.arc=Math.atan(h/g),this.isClicked},ED.RoundHole.prototype.description=function(){var a="";return this.scaleX<1&&(a="Small "),this.scaleX>1.5&&(a="Large "),a+="Round hole ",a+=this.clockHour()+" o'clock"},ED.RoundHole.prototype.snomedCode=function(){return 302888003},ED.RoundHole.prototype.diagnosticHierarchy=function(){return 3},ED.Rubeosis=function(a,b){this.className="Rubeosis",this.severity=50,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.Rubeosis.prototype=new ED.Doodle,ED.Rubeosis.prototype.constructor=ED.Rubeosis,ED.Rubeosis.superclass=ED.Doodle.prototype,ED.Rubeosis.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Rubeosis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-380,-200),this.parameterValidationArray.severity={kind:"derived",type:"float",range:new ED.Range(20,100),precision:1,animate:!0}},ED.Rubeosis.prototype.setParameterDefaults=function(){this.arc=Math.PI/12,this.setRotationWithDisplacements(90,45);var a=this.drawing.lastDoodleOfClass("AntSeg");this.apexY=a?a.apexY-this.severity:-320},ED.Rubeosis.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"severity":var d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c.apexY=d.apexY-b);break;case"apexY":var d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c.severity=d.apexY-b)}return c},ED.Rubeosis.prototype.draw=function(a){var b=this.drawing.context;ED.Rubeosis.superclass.draw.call(this,a);var c=200,d=this.drawing.lastDoodleOfClass("AntSeg");d&&(c=-d.apexY);var e=c+16;this.parameterValidationArray.apexY.range.max=-c-50,this.apexY=this.parameterValidationArray.apexY.range.constrain(-c-this.severity);var f=-this.apexY,g=e+(f-e)/2;b.beginPath();var h=this.arc/2,i=-Math.PI/2+h,j=-Math.PI/2-h,k=new ED.Point(-g*Math.sin(h),-g*Math.cos(h)),l=new ED.Point(g*Math.sin(h),-g*Math.cos(h));if(b.beginPath(),b.arc(0,0,e,i,j,!0),b.arc(0,0,f,j,i,!1),b.closePath(),b.fillStyle=this.isSelected?"rgba(240,240,240,0.5)":"rgba(240,240,240,0.0)",b.lineWidth=1,b.strokeStyle="rgba(120,120,120,0.0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();for(var m=2*Math.PI/16,n=Math.PI/24,o=2*Math.PI/60,p=c+2*(f-c)/3,q=1+Math.floor(this.arc/m),r=0;q>r;r++){var s=k.pointAtRadiusAndClockwiseAngle(c,n+r*m),t=k.pointAtRadiusAndClockwiseAngle(f,n+r*m+o),u=k.pointAtRadiusAndClockwiseAngle(p,n+r*m),v=k.pointAtRadiusAndClockwiseAngle(f,n+r*m+o/2);b.moveTo(s.x,s.y),b.bezierCurveTo(u.x,u.y,v.x,v.y,t.x,t.y),t=k.pointAtRadiusAndClockwiseAngle(f,n+r*m-o),u=k.pointAtRadiusAndClockwiseAngle(p,n+r*m),v=k.pointAtRadiusAndClockwiseAngle(f,n+r*m-o/2),b.moveTo(s.x,s.y),b.bezierCurveTo(u.x,u.y,v.x,v.y,t.x,t.y)}b.lineWidth=4,b.strokeStyle="red",b.stroke()}return this.handleArray[0].location=this.transform.transformPoint(k),this.handleArray[3].location=this.transform.transformPoint(l),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Rubeosis.prototype.groupDescription=function(){return"Rubeotic vessels on margin of pupil at "},ED.Rubeosis.prototype.description=function(){return this.clockHour()+" o'clock"},ED.ScleralIncision=function(a,b){this.className="ScleralIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.ScleralIncision.prototype=new ED.Doodle,ED.ScleralIncision.prototype.constructor=ED.ScleralIncision,ED.ScleralIncision.superclass=ED.Doodle.prototype,ED.ScleralIncision.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.ScleralIncision.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI/2)},ED.ScleralIncision.prototype.setParameterDefaults=function(){this.arc=Math.PI/8,this.setRotationWithDisplacements(60,-120)},ED.ScleralIncision.prototype.draw=function(a){var b=this.drawing.context;ED.ScleralIncision.superclass.draw.call(this,a);var c=560,d=40,e=c+d,f=c-d;b.beginPath();var g=this.arc/2;if(b.arc(0,0,e,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,f,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),b.fillStyle="rgba(200,200,200,0)",b.lineWidth=5,b.strokeStyle="rgba(120,120,120,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(0,0,c,-Math.PI/2+g,-Math.PI/2-g,!0);var h=.2,i=new ED.Point(0,0),j=g-h/2;do i.setWithPolars(c-d,j),b.moveTo(i.x,i.y),i.setWithPolars(c+d,j),b.lineTo(i.x,i.y),j-=h;while(j>-g);b.lineWidth=6,b.strokeStyle="rgba(120,120,120,0.75)",b.stroke()}var k=new ED.Point(0,0);return k.setWithPolars(c,g),this.handleArray[3].location=this.transform.transformPoint(k),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ScleralIncision.prototype.groupDescription=function(){return"Scleral incision at "},ED.ScleralIncision.prototype.description=function(){return this.clockHour()},ED.ScleralIncision.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.Sclerostomy=function(a,b){this.className="Sclerostomy",this.parsPlana=-560,this.overallGauge="23g",this.gauge="23g",this.isSutured=!1,this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.Sclerostomy.prototype=new ED.Doodle,ED.Sclerostomy.prototype.constructor=ED.Sclerostomy,ED.Sclerostomy.superclass=ED.Doodle.prototype,ED.Sclerostomy.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Sclerostomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-660,-460),this.parameterValidationArray.overallGauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.gauge={kind:"derived",type:"string",list:["20g","23g","25g","27g"],animate:!1},this.parameterValidationArray.isSutured={kind:"derived",type:"bool",display:!0}},ED.Sclerostomy.prototype.setParameterDefaults=function(){this.apexY=-600,this.gauge="23g",this.isSutured=!1,this.arc=1,this.setRotationWithDisplacements(60,-45)},ED.Sclerostomy.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexY":c.gauge=-610>b?"20g":-560>b?"23g":-510>b?"25g":"27g";break;case"overallGauge":c.gauge=b;break;case"gauge":c.apexY="20g"==b?-650:"23g"==b?-600:"25g"==b?-550:-500;break;case"arc":c.isSutured=2>b?!1:!0;break;case"isSutured":c.arc=b?3:1}return c},ED.Sclerostomy.prototype.draw=function(a){var b=this.drawing.context;if(ED.Sclerostomy.superclass.draw.call(this,a),b.beginPath(),b.rect(-60,this.parsPlana-120,120,160),b.lineWidth=2,b.strokeStyle="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.gauge){case"20g":b.beginPath(),b.moveTo(-50,this.parsPlana),b.bezierCurveTo(-30,this.parsPlana-30,30,this.parsPlana-30,50,this.parsPlana),b.bezierCurveTo(30,this.parsPlana+30,-30,this.parsPlana+30,-50,this.parsPlana),b.closePath(),b.fillStyle="red",b.fill();break;case"23g":b.beginPath(),b.rect(-60,this.parsPlana-120,120,60),b.fillStyle="rgba(0, 0, 255, 0.5)",b.fill(),b.beginPath(),b.rect(-30,this.parsPlana-60,60,60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-30,this.parsPlana,60,100),b.fillStyle="rgba(220, 220, 220, 0.5)",b.fill();break;case"25g":b.beginPath(),b.rect(-50,this.parsPlana-120,100,60),b.fillStyle="rgba(255, 128, 0, 0.5)",b.fill(),b.beginPath(),b.rect(-20,this.parsPlana-60,40,60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-20,this.parsPlana,40,100),b.fillStyle="rgba(220, 220, 220, 0.5)",b.fill();break;case"27g":b.beginPath(),b.rect(-40,this.parsPlana-120,80,60),b.fillStyle="rgba(0, 255, 0, 0.5)",b.fill(),b.beginPath(),b.rect(-15,this.parsPlana-60,30,60),b.fillStyle="rgba(120, 120, 120, 0.5)",b.fill(),b.beginPath(),b.rect(-15,this.parsPlana,30,100),b.fillStyle="rgba(220, 220, 220, 0.5)",b.fill()}b.fill(),(this.isSutured||"20g"==this.gauge)&&(b.beginPath(),b.moveTo(-40,this.parsPlana+40),b.lineTo(-40,this.parsPlana-40),b.lineTo(40,this.parsPlana+40),b.lineTo(40,this.parsPlana-40),b.lineTo(-40,this.parsPlana+40),b.lineWidth=6,b.strokeStyle="rgba(0,0,120,0.7)",b.closePath(),b.stroke())}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Sclerostomy.prototype.drawHighlightExtras=function(){var a=this.drawing.context;a.lineWidth=1,a.fillStyle="gray",a.font="64px sans-serif",a.fillText(this.gauge,80,this.parsPlana+20)},ED.Sclerostomy.prototype.groupDescription=function(){return"Sclerostomies at "},ED.Sclerostomy.prototype.description=function(){var a=this.isSutured?" (sutured)":"";return this.clockHour()+a},ED.Sclerostomy.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.SectorIridectomy=function(a,b){this.className="SectorIridectomy",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.SectorIridectomy.prototype=new ED.Doodle,ED.SectorIridectomy.prototype.constructor=ED.SectorIridectomy,ED.SectorIridectomy.superclass=ED.Doodle.prototype,ED.SectorIridectomy.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorIridectomy.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(20*Math.PI/180,Math.PI/2),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-334,-300)
},ED.SectorIridectomy.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);a&&(this.rotation=a.rotation+Math.PI/2)},ED.SectorIridectomy.prototype.draw=function(a){var b=this.drawing.context;ED.SectorIridectomy.superclass.draw.call(this,a);var c,d=376,e=this.drawing.lastDoodleOfClass("AntSeg");c=e?-e.apexY-2:300;var f=c+(d-c)/2,g=this.arc/2,h=(-Math.PI/2+g,-Math.PI/2-g,f*Math.sin(g)),i=-f*Math.cos(g),j=-f*Math.sin(g),k=i;b.beginPath();var g=this.arc/2;return b.arc(0,0,d,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,c,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),b.fillStyle="rgba(218,230,241,1)",b.lineWidth=4,b.strokeStyle="rgba(218,230,241,1)",this.drawBoundary(a),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(h,i)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SectorIridectomy.prototype.description=function(){var a="Sector iridectomy of "+(180*this.arc/Math.PI).toFixed(0)+" degrees at ";return a+=this.clockHour()+" o'clock"},ED.SectorPRP=function(a,b){this.className="SectorPRP",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.SectorPRP.prototype=new ED.Doodle,ED.SectorPRP.prototype.constructor=ED.SectorPRP,ED.SectorPRP.superclass=ED.Doodle.prototype,ED.SectorPRP.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRP.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0)},ED.SectorPRP.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(a.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRP.prototype.draw=function(a){var b=this.drawing.context;ED.SectorPRP.superclass.draw.call(this,a);var c=476,d=100,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=40,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var m=30,n=30+m,o=[47,41,35,28,22,15],p=0,e=c-m;e>d;e-=n){for(var q=0,r=-Math.PI/2-g;r<this.arc-Math.PI/2-g;r+=n/e){r=-Math.PI/2-g+2*q*Math.PI/o[p];var s=new ED.Point(0,0);s.setWithPolars(e,r),this.drawLaserSpot(b,s.x,s.y),q++}p++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SectorPRPPostPole=function(a,b){this.className="SectorPRPPostPole",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.SectorPRPPostPole.prototype=new ED.Doodle,ED.SectorPRPPostPole.prototype.constructor=ED.SectorPRPPostPole,ED.SectorPRPPostPole.superclass=ED.Doodle.prototype,ED.SectorPRPPostPole.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.SectorPRPPostPole.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.SectorPRPPostPole.prototype.setParameterDefaults=function(){this.arc=55*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(a.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.SectorPRPPostPole.prototype.draw=function(a){var b=this.drawing.context;ED.SectorPRPPostPole.superclass.draw.call(this,a);var c=500,d=300,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=40,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var m=30,n=30+m,o=[47,41,35,28,22,15],p=0,e=c-m;e>d;e-=n){for(var q=0,r=-Math.PI/2-g;r<this.arc-Math.PI/2-g;r+=n/e){r=-Math.PI/2-g+2*q*Math.PI/o[p];var s=new ED.Point(0,0);s.setWithPolars(e,r),this.drawLaserSpot(b,s.x,s.y),q++}p++}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SectorPRPPostPole.prototype.description=function(){return"Sector PRP"},ED.SidePort=function(a,b){this.className="SidePort",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.SidePort.prototype=new ED.Doodle,ED.SidePort.prototype.constructor=ED.SidePort,ED.SidePort.superclass=ED.Doodle.prototype,ED.SidePort.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isRotatable=!0,this.isArcSymmetrical=!0},ED.SidePort.prototype.setParameterDefaults=function(){this.setRotationWithDisplacements(90,180)},ED.SidePort.prototype.draw=function(a){var b=this.drawing.context;ED.SidePort.superclass.draw.call(this,a);var c=334,d=30,e=c+d,f=c-d;b.beginPath();var g=.125;return b.arc(0,0,e,-Math.PI/2+g,-Math.PI/2-g,!0),b.arc(0,0,f,-Math.PI/2-g,-Math.PI/2+g,!1),b.closePath(),b.fillStyle="rgba(200,200,200,0.75)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.isClicked},ED.SidePort.prototype.groupDescription=function(){return"Sideport at "},ED.SidePort.prototype.description=function(){return this.clockHour()},ED.SidePort.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.StarFold=function(a,b){this.className="StarFold",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.StarFold.prototype=new ED.Doodle,ED.StarFold.prototype.constructor=ED.StarFold,ED.StarFold.superclass=ED.Doodle.prototype,ED.StarFold.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.StarFold.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isSqueezable=!0,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(50,250),this.parameterValidationArray.scaleX.range.setMinAndMax(.125,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.125,1.5),this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/6,2*Math.PI)},ED.StarFold.prototype.setParameterDefaults=function(){this.apexY=50,this.scaleX=.25,this.scaleY=.25;var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else this.move(0,400)},ED.StarFold.prototype.draw=function(a){var b=this.drawing.context;return ED.StarFold.superclass.draw.call(this,a),b.beginPath(),b.moveTo(0,-this.apexY),b.bezierCurveTo(100,-50,260,-240,300,-200),b.bezierCurveTo(340,-160,100,-100,2*this.apexY,0),b.bezierCurveTo(100,100,340,160,300,200),b.bezierCurveTo(260,240,100,50,0,this.apexY),b.bezierCurveTo(-100,50,-260,240,-300,200),b.bezierCurveTo(-340,160,-100,100,-2*this.apexY,0),b.bezierCurveTo(-100,-100,-340,-160,-300,-200),b.bezierCurveTo(-260,-240,-100,-50,0,-this.apexY),b.closePath(),b.lineWidth=0,b.fillStyle="lightgreen",b.strokeStyle="green",this.drawBoundary(a),this.arc=Math.atan2(600*this.scaleX,Math.abs(this.originY)),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(-300,200)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.StarFold.prototype.description=function(){var a="Star fold at ";return a+=this.clockHour()+" o'clock"},ED.StarFold.prototype.snomedCode=function(){return 232018006},ED.StarFold.prototype.diagnosticHierarchy=function(){return 2},ED.SteepAxis=function(a,b){this.className="SteepAxis",this.axis="0",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.SteepAxis.prototype=new ED.Doodle,ED.SteepAxis.prototype.constructor=ED.SteepAxis,ED.SteepAxis.superclass=ED.Doodle.prototype,ED.SteepAxis.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.SteepAxis.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.SteepAxis.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"rotation":c.axis=(360-180*b/Math.PI)%180;break;case"axis":c.rotation=(180-b)*Math.PI/180}return c},ED.SteepAxis.prototype.draw=function(a){var b=this.drawing.context;ED.SteepAxis.superclass.draw.call(this,a);var c=300;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=8,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var d=140;b.beginPath(),b.moveTo(-c-d,0),b.lineTo(c+d,0),b.lineWidth=8,b.strokeStyle="gray",b.stroke();var e=200,f=540;b.beginPath(),b.moveTo(-c,0),b.arcTo(0,e,c,0,f),b.closePath(),b.strokeStyle="gray",b.fillStyle="lightgray",b.fill(),b.stroke()}return this.isClicked},ED.StrabOpTemplate=function(a,b){this.className="StrabOpTemplate",ED.Doodle.call(this,a,b)},ED.StrabOpTemplate.prototype=new ED.Doodle,ED.StrabOpTemplate.prototype.constructor=ED.StrabOpTemplate,ED.StrabOpTemplate.superclass=ED.Doodle.prototype,ED.StrabOpTemplate.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isUnique=!0,this.isDeletable=!1},ED.StrabOpTemplate.prototype.draw=function(a){var b=this.drawing.context;ED.StrabOpTemplate.superclass.draw.call(this,a);var c=-200,d=70;return b.beginPath(),b.arc(0,0,80,0,2*Math.PI,!0),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(100, 200, 250, 0.75)",b.strokeStyle="blue",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.arc(0,0,30,0,2*Math.PI,!0),b.fillStyle="black",b.fill(),b.beginPath(),b.moveTo(-d,c),b.lineTo(d,c),b.moveTo(c,-d),b.lineTo(c,d),b.moveTo(-d,-c),b.lineTo(d,-c),b.moveTo(-c,-d),b.lineTo(-c,d),b.lineWidth=16,b.strokeStyle="brown",b.stroke()),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SubretinalFluid=function(a,b){this.className="SubretinalFluid",this.numberOfHandles=8,this.initialRadius=80,this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,a,b)},ED.SubretinalFluid.prototype=new ED.Doodle,ED.SubretinalFluid.prototype.constructor=ED.SubretinalFluid,ED.SubretinalFluid.superclass=ED.Doodle.prototype,ED.SubretinalFluid.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[0].isRotatable=!0},ED.SubretinalFluid.prototype.setPropertyDefaults=function(){this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=this.numberOfHandles,d=new Object;d.length=new ED.Range(50,290),d.angle=new ED.Range(((2*c-1)*b/(2*c)+a*b/c)%b,(1*b/(2*c)+a*b/c)%b),this.handleVectorRangeArray[a]=d}},ED.SubretinalFluid.prototype.setParameterDefaults=function(){var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX+100,0);this.move(b.x,b.y)}else this.move(100*(this.drawing.eye==ED.eye.Right?-1:1),0);var c=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(c);for(var d=0;d<this.numberOfHandles;d++){var e=new ED.Point(0,0);e.setWithPolars(this.initialRadius,2*d*Math.PI/this.numberOfHandles),this.addPointToSquiggle(e)}},ED.SubretinalFluid.prototype.draw=function(a){var b=this.drawing.context;ED.SubretinalFluid.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y)}b.closePath(),b.lineWidth=4,b.fillStyle="rgba(0, 0, 255, 0.75)",b.strokeStyle="blue",this.drawBoundary(a);for(var h=0;h<this.numberOfHandles;h++)this.handleArray[h].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[h]);return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SubretinalFluid.prototype.description=function(){return"Subretinal fluid"},ED.SubretinalPFCL=function(a,b){this.className="SubretinalPFCL",this.savedParameterArray=["apexY","originX","originY"],ED.Doodle.call(this,a,b),this.rotation=Math.PI/4},ED.SubretinalPFCL.prototype=new ED.Doodle,ED.SubretinalPFCL.prototype.constructor=ED.SubretinalPFCL,ED.SubretinalPFCL.superclass=ED.Doodle.prototype,ED.SubretinalPFCL.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.SubretinalPFCL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-80,-20)},ED.SubretinalPFCL.prototype.setParameterDefaults=function(){this.apexY=-40;var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),0)},ED.SubretinalPFCL.prototype.draw=function(a){var b=this.drawing.context;ED.SubretinalPFCL.superclass.draw.call(this,a),b.beginPath();var c=Math.sqrt(this.apexX*this.apexX+this.apexY*this.apexY);b.arc(0,0,c,0,2*Math.PI,!0),b.lineWidth=1;var d=c/1.1412135,e=b.createLinearGradient(-d,-d,d,d);return e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(.7,"rgba(200,200,200,1)"),e.addColorStop(1,"rgba(140,140,140,1)"),b.fillStyle=e,b.strokeStyle="gray",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.SubretinalPFCL.prototype.groupDescription=function(){return"Subretinal PFCL"},ED.Supramid=function(a,b){this.className="Supramid",this.percent="80",this.savedParameterArray=["apexX","apexY","rotation","percent"],this.controlParameterArray={percent:"Percentage of tube"},this.adjustmentArray={0:0,10:10,20:20,30:30,40:40,50:50,60:60,70:70,80:80,90:90,100:100},ED.Doodle.call(this,a,b)},ED.Supramid.prototype=new ED.Doodle,ED.Supramid.prototype.constructor=ED.Supramid,ED.Supramid.superclass=ED.Doodle.prototype,ED.Supramid.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Supramid.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-800,800),this.parameterValidationArray.apexY.range.setMinAndMax(-800,800),this.parameterValidationArray.percent={kind:"other",type:"string",list:["0","10","20","30","40","50","60","70","80","90","100"],animate:!1}},ED.Supramid.prototype.setParameterDefaults=function(){this.apexX=-660,this.apexY=30,this.setParameterFromString("percent","80");var a=this.drawing.lastDoodleOfClass("Tube");a&&(this.rotation=a.rotation)},ED.Supramid.prototype.draw=function(a){var b=this.drawing.context;ED.Supramid.superclass.draw.call(this,a);var c=this.drawing.lastDoodleOfClass("TubeExtender");c&&"undefined"!=typeof c.bezierArray.sp?this.rotation=c.rotation:(c=this.drawing.lastDoodleOfClass("Tube"),c&&(this.rotation=c.rotation));var d=new ED.Point(this.apexX,this.apexY),e=new ED.Point(0,-700);if(b.beginPath(),b.rect(this.apexX-100,this.apexY-100,200,200),b.closePath(),b.lineWidth=1,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle=this.isSelected?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){if(b.beginPath(),c&&c.bezierArray.sp){var f=d.x/Math.abs(d.x)*100;b.moveTo(d.x,d.y),b.bezierCurveTo(d.x+f,d.y-100,e.x+f,e.y,c.bezierArray.sp.x,c.bezierArray.sp.y);for(var g=50,h=this.adjustmentArray[this.percent],i=0;1/g+h/100>i;i+=1/g){var j=c.bezierArray.sp.bezierPointAtParameter(i,c.bezierArray.cp1,c.bezierArray.cp2,c.bezierArray.ep);b.lineTo(j.x,j.y)}}else b.moveTo(d.x,d.y),b.lineTo(0,-400);b.lineWidth=4,b.strokeStyle="purple",b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Supramid.prototype.description=function(){return"Supramid suture "+this.percent+"% along tube"},ED.SwollenDisc=function(a,b){this.className="SwollenDisc",this.savedParameterArray=["originX"],ED.Doodle.call(this,a,b)},ED.SwollenDisc.prototype=new ED.Doodle,ED.SwollenDisc.prototype.constructor=ED.SwollenDisc,ED.SwollenDisc.superclass=ED.Doodle.prototype,ED.SwollenDisc.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.addAtBack=!0},ED.SwollenDisc.prototype.setParameterDefaults=function(){this.originY=0,this.drawing.hasDoodleOfClass("PostPole")&&(this.originX=this.drawing.eye==ED.eye.Right?300:-300)},ED.SwollenDisc.prototype.draw=function(a){var b=this.drawing.context;ED.SwollenDisc.superclass.draw.call(this,a);var c=140,d=80;b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.arc(0,0,d,2*Math.PI,0,!1),b.closePath(),b.lineWidth=0,yellowColour="rgba(255, 255, 0, 0.75)";var e="rgba(240, 140, 40, 0.75)",f=b.createRadialGradient(0,0,c,0,0,d);return f.addColorStop(0,yellowColour),f.addColorStop(1,e),b.fillStyle=f,b.strokeStyle="rgba(0,0,0,0)",this.drawBoundary(a),this.isClicked},ED.SwollenDisc.prototype.description=function(){return"Swollen disc"},ED.Telangiectasis=function(a,b){this.className="Telangiectasis",this.savedParameterArray=["originX","apexX","apexY"],ED.Doodle.call(this,a,b)},ED.Telangiectasis.prototype=new ED.Doodle,ED.Telangiectasis.prototype.constructor=ED.Telangiectasis,ED.Telangiectasis.superclass=ED.Doodle.prototype,ED.Telangiectasis.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Telangiectasis.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-100,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.Telangiectasis.prototype.setParameterDefaults=function(){this.originX=this.drawing.eye==ED.eye.Right?-160:160},ED.Telangiectasis.prototype.draw=function(a){var b=this.drawing.context;ED.Telangiectasis.superclass.draw.call(this,a),b.beginPath();var c=100;if(b.arc(0,0,c,0,2*Math.PI,!0),b.closePath(),b.lineWidth=0,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){for(var d="red",e=10/this.scaleX,f=new ED.Point(0,0),g=10,h=0;g>h;h++)f.setWithPolars(.8*c*ED.randomArray[h],2*Math.PI*ED.randomArray[h+100]),this.drawSpot(b,f.x,f.y,e,d);if(this.apexY<-50){d="yellow",g=18;for(var h=0;g>h;h++)f.setWithPolars(c,2*Math.PI*h/g),this.drawSpot(b,f.x,f.y,e,d)}d="brown",g=Math.abs(Math.floor(this.apexX/10));for(var h=0;g>h;h++)f.setWithPolars(.8*c*ED.randomArray[h+10],2*Math.PI*ED.randomArray[h+100]),this.drawSpot(b,f.x,f.y,2*e,d)}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Telangiectasis.prototype.description=function(){return"Parafoveal telangiectasia"},ED.ToricPCIOL=function(a,b){this.className="ToricPCIOL",this.savedParameterArray=["originX","originY","rotation"],ED.Doodle.call(this,a,b)},ED.ToricPCIOL.prototype=new ED.Doodle,ED.ToricPCIOL.prototype.constructor=ED.ToricPCIOL,ED.ToricPCIOL.superclass=ED.Doodle.prototype,ED.ToricPCIOL.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.ToricPCIOL.prototype.setPropertyDefaults=function(){this.addAtBack=!0,this.isOrientated=!1,this.isScaleable=!1,this.isUnique=!0},ED.ToricPCIOL.prototype.setParameterDefaults=function(){this.scaleX=.75,this.scaleY=.75},ED.ToricPCIOL.prototype.draw=function(a){var b=this.drawing.context;ED.ToricPCIOL.superclass.draw.call(this,a),b.beginPath();var c=240;if(b.arc(0,0,c,0,2*Math.PI,!1),b.moveTo(150,-190),b.bezierCurveTo(160,-200,190,-350,160,-380),b.bezierCurveTo(90,-440,-150,-410,-220,-370),b.bezierCurveTo(-250,-350,-260,-400,-200,-430),b.bezierCurveTo(-110,-480,130,-470,200,-430),b.bezierCurveTo(270,-390,220,-140,220,-100),b.moveTo(-150,190),b.bezierCurveTo(-160,200,-190,350,-160,380),b.bezierCurveTo(-90,440,150,410,220,370),b.bezierCurveTo(250,350,260,400,200,430),b.bezierCurveTo(110,480,-130,470,-200,430),b.bezierCurveTo(-270,390,-220,140,-220,100),b.fillStyle="rgba(255,255,255,0.75)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath();var d=.7*Math.PI/4,e=d+Math.PI,f=new ED.Point(0,0);f.setWithPolars(c-20,d);var g=new ED.Point(0,0);g.setWithPolars(c-100,d);var h=new ED.Point(0,0);h.setWithPolars(c-20,e);var i=new ED.Point(0,0);i.setWithPolars(c-100,e),b.moveTo(f.x,f.y),b.lineTo(g.x,g.y),b.moveTo(h.x,h.y),b.lineTo(i.x,i.y),b.lineWidth=24,b.lineCap="round",b.strokeStyle="darkgray",b.stroke()}var j=new ED.Point(0,0);return j.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(j),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ToricPCIOL.prototype.description=function(){var a="Toric posterior chamber IOL",b=40,c="";return this.originY<-b&&(c.length>0&&(c+=" and"),c+=" superiorly"),this.originY>b&&(c.length>0&&(c+=" and"),c+=" inferiorly"),this.originX<-b&&(c.length>0&&(c+=" and"),c+=" temporally"),this.originX>b&&(c.length>0&&(c+=" and"),c+=" nasally"),c.length>0&&(a+=" displaced"+c),a},ED.Trabectome=function(a,b){this.className="Trabectome",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.Trabectome.prototype=new ED.Doodle,ED.Trabectome.prototype.constructor=ED.Trabectome,ED.Trabectome.superclass=ED.Doodle.prototype,ED.Trabectome.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.Trabectome.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.isUnique=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/16,Math.PI)},ED.Trabectome.prototype.setParameterDefaults=function(){this.arc=Math.PI/4,this.setRotationWithDisplacements(-90,-120)},ED.Trabectome.prototype.draw=function(a){var b=this.drawing.context;ED.Trabectome.superclass.draw.call(this,a);var c=440,d=400,e=500,f=10,g=760,h=100,i=150,j=170,k=this.arc/2,l=-Math.PI/2+k,m=-Math.PI/2-k,n=(c+d)/2,o=n*Math.sin(k),p=-n*Math.cos(k),q=-n*Math.sin(k),r=p;if(b.beginPath(),b.arc(0,0,c,l,m,!0),b.arc(0,0,d,m,l,!1),b.moveTo(-f,e-(h+g)),b.lineTo(0,e-(h+g)-f),b.lineTo(f,e-(h+g)),b.lineTo(f,e-h),b.lineTo(i,e),b.lineTo(i,e+j),b.lineTo(-i,e+j),b.lineTo(-i,e),b.lineTo(-f,e-h),b.lineTo(-f,e-(h+g)),b.lineWidth=4,b.fillStyle="rgba(200, 200, 200, 0.5)",b.strokeStyle="rgba(200, 200, 200, 0.8)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.arc(0,0,c,l,m,!0),b.arc(0,0,d,m,l,!1),b.fillStyle="rgba(200, 100, 100, 0.8)",b.strokeStyle="red",b.fill(),b.stroke();var s=334,t=30,u=s+t,v=s-t;b.beginPath();var w=.125;b.arc(0,0,u,Math.PI/2+w,Math.PI/2-w,!0),b.arc(0,0,v,Math.PI/2-w,Math.PI/2+w,!1),b.fillStyle="rgba(200,200,200,0.75)",b.strokeStyle="rgba(120,120,120,0.75)",b.fill(),b.stroke()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(q,r)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(o,p)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Trabectome.prototype.description=function(){return"Trabecular meshwork ablation of "+this.degreesExtent()+" degrees centred around "+this.clockHour()+" o'clock"},ED.TrabyConjIncision=function(a,b){this.className="TrabyConjIncision",this.savedParameterArray=["arc","rotation"],ED.Doodle.call(this,a,b)},ED.TrabyConjIncision.prototype=new ED.Doodle,ED.TrabyConjIncision.prototype.constructor=ED.TrabyConjIncision,ED.TrabyConjIncision.superclass=ED.Doodle.prototype,ED.TrabyConjIncision.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.TrabyConjIncision.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isArcSymmetrical=!0,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,Math.PI)},ED.TrabyConjIncision.prototype.setParameterDefaults=function(){this.arc=80*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+Math.PI/4:0},ED.TrabyConjIncision.prototype.draw=function(a){var b=this.drawing.context;ED.TrabyConjIncision.superclass.draw.call(this,a);{var c=660,d=400,e=this.arc/2,f=-Math.PI/2+e,g=-Math.PI/2-e,h=c*Math.sin(e),i=-c*Math.cos(e),j=-c*Math.sin(e),k=i,l=d*Math.sin(e),m=-d*Math.cos(e);-d*Math.sin(e)}return b.beginPath(),b.arc(0,0,c,f,g,!0),b.arc(0,0,d,g,f,!1),b.lineWidth=4,b.fillStyle="rgba(255,255,0,0)",b.strokeStyle="rgba(255,0,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(h,i),b.lineTo(l,m),b.arc(0,0,d,f,g,!0),b.lineTo(j,k),b.lineWidth=4,b.strokeStyle="gray",b.stroke()),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(j,k)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TrabyConjIncision.prototype.description=function(){return""},ED.TrabyFlap=function(a,b){this.className="TrabyFlap",this.site="Superior",this.size="4x3",this.sclerostomy="Punch",this.height=-580,this.r=380,this.right=new ED.Point(0,0),this.left=new ED.Point(0,0),this.savedParameterArray=["apexX","apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.TrabyFlap.prototype=new ED.Doodle,ED.TrabyFlap.prototype.constructor=ED.TrabyFlap,ED.TrabyFlap.superclass=ED.Doodle.prototype,ED.TrabyFlap.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.TrabyFlap.prototype.setPropertyDefaults=function(){this.isScaleable=!1,this.isMoveable=!1,this.isArcSymmetrical=!0,this.snapToArc=!0,this.isDeletable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(-440,-440),this.parameterValidationArray.rotation.delta=.1,this.parameterValidationArray.site={kind:"derived",type:"string",list:["Superior","Superonasal","Superotemporal"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["4x3","5x2"],animate:!1},this.parameterValidationArray.sclerostomy={kind:"derived",type:"string",list:["Punch","Block","Ex-Press shunt"],animate:!1},this.arcArray=[.9,1.13]},ED.TrabyFlap.prototype.setParameterDefaults=function(){this.apexY=-440,this.height=-580,this.setParameterFromString("size","Superior"),this.setParameterFromString("size","4x3"),this.setParameterFromString("sclerostomy","Punch")},ED.TrabyFlap.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"apexX":c.sclerostomy=-15>b?"Punch":b>15?"Ex-Press shunt":"Block";break;case"arc":1>b?(c.size="4x3",c.height=-580):(c.size="5x2",c.height=-510);break;case"rotation":c.site=b>Math.PI/16&&b<Math.PI?this.drawing.eye==ED.eye.Right?"Superonasal":"Superotemporal":b>=Math.PI&&b<31*Math.PI/16?this.drawing.eye==ED.eye.Right?"Superotemporal":"Superonasal":"Superior";break;case"site":switch(b){case"Superior":c.rotation=0;break;case"Superonasal":c.rotation=this.drawing.eye==ED.eye.Right?Math.PI/4:7*Math.PI/4;break;case"Superotemporal":c.rotation=this.drawing.eye==ED.eye.Right?7*Math.PI/4:Math.PI/4}break;case"size":switch(b){case"4x3":c.arc=.9,c.height=-580,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2));break;case"5x2":c.arc=1.13,c.height=-510,this.right.setCoordinates(this.r*Math.sin(this.arc/2),-this.r*Math.cos(this.arc/2))}break;case"sclerostomy":switch(b){case"Punch":c.apexX=-50;break;case"Block":c.apexX=0;break;case"Ex-Press shunt":c.apexX=50}}return c},ED.TrabyFlap.prototype.draw=function(a){var b=this.drawing.context;ED.TrabyFlap.superclass.draw.call(this,a);{var c=this.arc/2,d=-Math.PI/2+c,e=-Math.PI/2-c;this.arc/6,new ED.Point(0,this.height)}if(this.right.x=this.r*Math.sin(c),this.right.y=-this.r*Math.cos(c),this.left.x=-this.r*Math.sin(c),this.left.y=-this.r*Math.cos(c),b.beginPath(),b.arc(0,0,this.r,d,e,!0),b.lineTo(this.left.x,this.height),b.lineTo(this.right.x,this.height),b.closePath(),b.fillStyle="rgba(220,220,150,0.5)",b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(b.beginPath(),this.sclerostomy){case"Punch":b.arc(0,this.apexY,50,0,2*Math.PI,!0);break;case"Block":var f=c/2;d=-Math.PI/2+f,e=-Math.PI/2-f;var g=new ED.Point(0,-this.r+(this.height+this.r)/2);b.arc(0,0,this.r,d,e,!0),b.lineTo(-this.r*Math.sin(f),g.y),b.lineTo(this.r*Math.sin(f),g.y),b.closePath();break;case"Ex-Press shunt":b.arc(0,this.apexY,40,0,2*Math.PI,!0),b.moveTo(-20,-420),b.lineTo(-20,-300),b.lineTo(20,-300),b.lineTo(20,-420)}b.fillStyle="gray",b.fill()}return this.handleArray[0].location=this.transform.transformPoint(this.left),this.handleArray[3].location=this.transform.transformPoint(this.right),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TrabyFlap.prototype.description=function(){return"Trabeculectomy flap at "+this.clockHour()+" o'clock with "+ED.firstLetterToLowerCase(this.sclerostomy)+" sclerostomy"},ED.TrabySuture=function(a,b){this.className="TrabySuture",this.type="Fixed",this.material="Nylon",this.size="10/0",this.numberOfHandles=5,this.savedParameterArray=["originX","originY","apexX","apexY","arc","rotation","type","material","size"],this.controlParameterArray={type:"Shape",material:"Material",size:"Size"},ED.Doodle.call(this,a,b)},ED.TrabySuture.prototype=new ED.Doodle,ED.TrabySuture.prototype.constructor=ED.TrabySuture,ED.TrabySuture.superclass=ED.Doodle.prototype,ED.TrabySuture.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1)},ED.TrabySuture.prototype.setPropertyDefaults=function(){this.parameterValidationArray.apexX.range.setMinAndMax(-50,50),this.parameterValidationArray.apexY.range.setMinAndMax(70,70),this.parameterValidationArray.originY.range.setMinAndMax(-625,625),this.parameterValidationArray.type={kind:"derived",type:"string",list:["Fixed","Adjustable","Releasable"],animate:!1},this.parameterValidationArray.material={kind:"derived",type:"string",list:["Nylon","Prolene","Vicryl","Silk"],animate:!1},this.parameterValidationArray.size={kind:"derived",type:"string",list:["11/0","10/0","9/0","8/0","7/0","6/0"],animate:!1}},ED.TrabySuture.prototype.setParameterDefaults=function(){this.apexX=50,this.apexY=70,this.material="Nylon",this.size="10/0";var a=this.drawing.lastDoodleOfClass("TrabyFlap");if(a){var b=this.drawing.numberOfDoodlesOfClass("TrabySuture"),c=new ED.Point(-1*a.right.x,a.height+0*(a.right.y-a.height));
switch(c.setWithPolars(c.length(),c.direction()+a.rotation),b){case 0:this.originX=c.x,this.originY=c.y,this.rotation=a.rotation,this.scaleX=-1*this.scaleX;break;case 1:c=new ED.Point(1*a.right.x,a.height+0*(a.right.y-a.height)),c.setWithPolars(c.length(),c.direction()+a.rotation),this.originX=c.x,this.originY=c.y,this.rotation=a.rotation;break;case 2:var d=this.drawing.firstDoodleOfClass("TrabySuture"),e=this.drawing.lastDoodleOfClass("TrabySuture");this.originX=d.originX+(e.originX-d.originX)/2,this.originY=c.y,this.rotation=e.rotation;break;default:this.setOriginWithDisplacements(0,-40)}}else this.setOriginWithDisplacements(0,-40);var f=this.drawing.lastDoodleOfClass("TrabySuture");this.type=f?f.type:"Releasable";var g=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(g);for(var h=50,i=[{x:h,y:-h},{x:-h,y:h},{x:-h,y:3*h},{x:0,y:7*h},{x:h,y:2*h}],j=0;j<i.length;j++){var k=new ED.Point(i[j].x,i[j].y);this.addPointToSquiggle(k)}},ED.TrabySuture.prototype.draw=function(a){var b=this.drawing.context;if(ED.TrabySuture.superclass.draw.call(this,a),b.beginPath(),b.rect(-40,-70,80,100),b.lineWidth=4,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle=this.isSelected?"gray":"rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(b.beginPath(),this.type){case"Releasable":var c=this.squiggleArray[0].pointsArray[0];b.moveTo(c.x,c.y);var d=this.squiggleArray[0].pointsArray[1],e=c.pointAtAngleToLineToPointAtProportion(Math.PI/3,d,.5),f=c.pointAtAngleToLineToPointAtProportion(-Math.PI/3,d,.5);b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y);var d=this.squiggleArray[0].pointsArray[0];b.moveTo(d.x,d.y);for(var g=1;3>g;g++)d=this.squiggleArray[0].pointsArray[g],b.lineTo(d.x,d.y),c=d;var c=this.squiggleArray[0].pointsArray[2],d=this.squiggleArray[0].pointsArray[3],h=2,e=new ED.Point(c.x,c.y+(d.y-c.y)/h),f=new ED.Point(d.x-(d.x-c.x)/h,d.y);b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y),c=this.squiggleArray[0].pointsArray[3],d=this.squiggleArray[0].pointsArray[4],h=2,e=new ED.Point(c.x+(d.x-c.x)/h,c.y),f=new ED.Point(d.x,d.y-(d.y-c.y)/h),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y);for(var g=0;g<this.numberOfHandles;g++)this.handleArray[g]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1),this.handleArray[g].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[g]);break;case"Adjustable":b.moveTo(-2,64),b.bezierCurveTo(20,36,-15,16,-16,-7),b.bezierCurveTo(-18,-30,-12,-43,-4,-43),b.bezierCurveTo(6,-43,12,-28,12,-9),b.bezierCurveTo(12,11,0,23,-2,30),b.bezierCurveTo(-3,36,3,37,2,30),b.bezierCurveTo(2,20,-4,24,-3,29),b.bezierCurveTo(-3,36,14,37,23,56),b.bezierCurveTo(32,74,34,100,34,100),this.handleArray.length=1,this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(40,-70));break;case"Fixed":b.moveTo(0,-30),b.bezierCurveTo(5,-10,5,10,0,30),b.bezierCurveTo(-5,10,-5,-10,0,-30),b.moveTo(-5,50),b.lineTo(0,30),b.lineTo(5,50),this.handleArray.length=1,this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Rotate,!1),this.handleArray[0].location=this.transform.transformPoint(new ED.Point(40,-70))}b.lineWidth=8,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="purple",b.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TrabySuture.prototype.groupDescription=function(){return"Flap sutures at "},ED.TrabySuture.prototype.description=function(){return this.clockHour()},ED.TrabySuture.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.TractionRetinalDetachment=function(a,b){this.className="TractionRetinalDetachment",this.savedParameterArray=["originX","originY","scaleX","scaleY","rotation"],ED.Doodle.call(this,a,b)},ED.TractionRetinalDetachment.prototype=new ED.Doodle,ED.TractionRetinalDetachment.prototype.constructor=ED.TractionRetinalDetachment,ED.TractionRetinalDetachment.superclass=ED.Doodle.prototype,ED.TractionRetinalDetachment.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!0)},ED.TractionRetinalDetachment.prototype.setPropertyDefaults=function(){this.isSqueezable=!0,this.addAtBack=!0,this.parameterValidationArray.scaleX.range.setMinAndMax(.5,1.5),this.parameterValidationArray.scaleY.range.setMinAndMax(.5,1.5)},ED.TractionRetinalDetachment.prototype.setParameterDefaults=function(){this.setOriginWithDisplacements(200,-100)},ED.TractionRetinalDetachment.prototype.draw=function(a){var b=this.drawing.context;ED.TractionRetinalDetachment.superclass.draw.call(this,a),b.beginPath();var c=60,d=150;return b.moveTo(-d,-d),b.bezierCurveTo(-c,-c,c,-c,d,-d),b.bezierCurveTo(c,-c,c,c,d,d),b.bezierCurveTo(c,c,-c,c,-d,d),b.bezierCurveTo(-c,c,-c,-c,-d,-d),b.closePath(),b.lineWidth=1,b.strokeStyle="blue",b.fillStyle="blue",this.drawBoundary(a),this.handleArray[2].location=this.transform.transformPoint(new ED.Point(d,-d)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TractionRetinalDetachment.prototype.groupDescription=function(){return"Traction retinal detachment "},ED.TractionRetinalDetachment.prototype.description=function(){return this.locationRelativeToDisc()},ED.TransilluminationDefect=function(a,b){this.className="TransilluminationDefect",this.savedParameterArray=["apexY","arc","rotation"],ED.Doodle.call(this,a,b)},ED.TransilluminationDefect.prototype=new ED.Doodle,ED.TransilluminationDefect.prototype.constructor=ED.TransilluminationDefect,ED.TransilluminationDefect.superclass=ED.Doodle.prototype,ED.TransilluminationDefect.prototype.setHandles=function(){this.handleArray[0]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1),this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Arc,!1)},ED.TransilluminationDefect.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.parameterValidationArray.arc.range.setMinAndMax(Math.PI/8,2*Math.PI),this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-400,-100)},ED.TransilluminationDefect.prototype.setParameterDefaults=function(){this.arc=60*Math.PI/180;var a=this.drawing.lastDoodleOfClass(this.className);this.rotation=a?a.rotation+(this.drawing.eye==ED.eye.Right?-1:1)*(a.arc/2+this.arc/2+Math.PI/12):(this.drawing.eye==ED.eye.Right?-1:1)*this.arc/2},ED.TransilluminationDefect.prototype.draw=function(a){var b=this.drawing.context;ED.TransilluminationDefect.superclass.draw.call(this,a);var c=380,d=280,e=d+(c-d)/2,f=this.arc/2,g=-Math.PI/2+f,h=-Math.PI/2-f,i=e*Math.sin(f),j=-e*Math.cos(f),k=-e*Math.sin(f),l=j;if(b.beginPath(),b.arc(0,0,c,g,h,!0),b.arc(0,0,d,h,g,!1),b.closePath(),b.lineWidth=4,b.fillStyle="rgba(255,255,255,0)",b.strokeStyle="rgba(255,255,255,0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw)for(var m=30,n=Math.PI/8,o=-Math.PI/2-g+n/2;o<this.arc-Math.PI/2-g;o+=n){var p=new ED.Point(0,0);p.setWithPolars(e,o);var q=new ED.Point(0,0);q.setWithPolars(e-m,o);var r=new ED.Point(0,0);r.setWithPolars(e+m,o);var s=Math.PI/40,t=new ED.Point(0,0);t.setWithPolars(e,o-s);var u=new ED.Point(0,0);u.setWithPolars(e,o+s),b.save(),b.beginPath(),b.moveTo(q.x,q.y),b.quadraticCurveTo(t.x,t.y,r.x,r.y),b.quadraticCurveTo(u.x,u.y,q.x,q.y),b.fillStyle="rgba(255,255,255,1)",b.fill(),b.lineWidth=4,b.strokeStyle="rgba(255,255,255,1)",b.stroke(),b.restore()}return this.handleArray[0].location=this.transform.transformPoint(new ED.Point(k,l)),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(i,j)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TransilluminationDefect.prototype.groupDescription=function(){return"Transillumination defects of iris"},ED.TrialFrame=function(a,b){this.className="TrialFrame",ED.Doodle.call(this,a,b)},ED.TrialFrame.prototype=new ED.Doodle,ED.TrialFrame.prototype.constructor=ED.TrialFrame,ED.TrialFrame.superclass=ED.Doodle.prototype,ED.TrialFrame.prototype.setPropertyDefaults=function(){this.isSelectable=!1,this.isDeletable=!1,this.isUnique=!0},ED.TrialFrame.prototype.draw=function(a){var b=this.drawing.context;ED.TrialFrame.superclass.draw.call(this,a),b.beginPath();var c=420,d=340,e=300,f=20,g=50,h=-Math.PI/20,i=0+h,j=Math.PI-h;if(b.beginPath(),b.arc(0,0,c,i,j,!1),b.arc(0,0,e,j,i,!0),b.closePath(),b.fillStyle="rgba(230,230,230,1)",b.lineWidth=4,b.strokeStyle="darkgray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.font=g+"px sans-serif",b.fillStyle="blue",b.beginPath();for(var k=0,l=new ED.Point(0,0),m=new ED.Point(0,0),n=new ED.Point(0,0),o=new ED.Point(0,0),p=new ED.Point(0,0),q=0;19>q;q++){var r=q.toFixed(0);k=(-90-10*q)*Math.PI/180,l.setWithPolars(e,k),m.setWithPolars(e+f,k),n.setWithPolars(d,k),p.setWithPolars(c-f,k),o.setWithPolars(c,k),b.moveTo(l.x,l.y),b.lineTo(m.x,m.y),b.moveTo(p.x,p.y),b.lineTo(o.x,o.y),b.save(),b.translate(n.x,n.y),b.rotate(Math.PI+k),b.textAlign="center",b.fillText(r,0,40),b.restore()}b.moveTo(-20,0),b.lineTo(20,0),b.moveTo(0,-20),b.lineTo(0,20),b.stroke()}return this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TrialLens=function(a,b){this.className="TrialLens",this.axis="0",this.savedParameterArray=["rotation"],ED.Doodle.call(this,a,b)},ED.TrialLens.prototype=new ED.Doodle,ED.TrialLens.prototype.constructor=ED.TrialLens,ED.TrialLens.superclass=ED.Doodle.prototype,ED.TrialLens.prototype.setPropertyDefaults=function(){this.isDeletable=!1,this.isShowHighlight=!1,this.isMoveable=!1,this.addAtBack=!0,this.isUnique=!0,this.parameterValidationArray.axis={kind:"derived",type:"mod",range:new ED.Range(0,180),clock:"bottom",animate:!0}},ED.TrialLens.prototype.setParameterDefaults=function(){this.setParameterFromString("axis","0")},ED.TrialLens.prototype.dependentParameterValues=function(a,b){var c=new Array;switch(a){case"rotation":c.axis=(360-180*b/Math.PI)%180;break;case"axis":c.rotation=(180-b)*Math.PI/180}return c},ED.TrialLens.prototype.draw=function(a){var b=this.drawing.context;ED.TrialLens.superclass.draw.call(this,a);var c=360,d=180;if(b.beginPath(),b.arc(0,0,c,0,2*Math.PI,!0),b.moveTo(d,0),b.arc(0,0,d,2*Math.PI,0,!1),b.lineWidth=4,b.fillStyle="rgba(255,100,100,1)",b.strokeStyle="gray",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){var e=20;b.beginPath(),b.moveTo(c-e,0),b.lineTo(d+e,0),b.moveTo(-c+e,0),b.lineTo(-d-e,0),b.lineWidth=16,b.strokeStyle="black",b.stroke()}return this.isClicked},ED.Tube=function(a,b){this.className="Tube",this.type="Baerveldt 103-250",this.platePosition="STQ",this.bezierArray=new Array,this.tubeExtender=!1,this.savedParameterArray=["rotation","apexX","apexY","type"],this.controlParameterArray={type:"Type"},ED.Doodle.call(this,a,b)},ED.Tube.prototype=new ED.Doodle,ED.Tube.prototype.constructor=ED.Tube,ED.Tube.superclass=ED.Doodle.prototype,ED.Tube.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.Tube.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-300,300),this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.type={kind:"other",type:"string",list:["Ahmed FP7","Baerveldt 103-250","Baerveldt 101-350","Baerveldt 103-350","Molteno Single"],animate:!1},this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var a=Math.PI/4;this.anglesArray=[a,3*a,5*a,7*a]},ED.Tube.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ")},ED.Tube.prototype.dependentParameterValues=function(a,b){var c=new Array,d=this.drawing.eye==ED.eye.Right,e=Math.PI/4;switch(a){case"rotation":c.platePosition=this.rotation>0&&this.rotation<=2*e?d?"SNQ":"STQ":this.rotation>2*e&&this.rotation<=4*e?d?"INQ":"ITQ":this.rotation>4*e&&this.rotation<=6*e?d?"ITQ":"INQ":d?"STQ":"SNQ";break;case"platePosition":switch(b){case"STQ":c.rotation=d?7*e:e;break;case"SNQ":c.rotation=d?e:7*e;break;case"INQ":c.rotation=d?3*e:5*e;break;case"ITQ":c.rotation=d?5*e:3*e}}return c},ED.Tube.prototype.draw=function(a){var b=this.drawing.context;ED.Tube.superclass.draw.call(this,a),this.tubeExtender=this.drawing.hasDoodleOfClass("TubeExtender"),b.beginPath();var c=.41666667,d=-740;switch(this.type){case"Ahmed FP7":b.moveTo(-300*c,0*c+d),b.bezierCurveTo(-300*c,-100*c+d,-200*c,-400*c+d,0*c,-400*c+d),b.bezierCurveTo(200*c,-400*c+d,300*c,-100*c+d,300*c,0*c+d),b.bezierCurveTo(300*c,140*c+d,200*c,250*c+d,0*c,250*c+d),b.bezierCurveTo(-200*c,250*c+d,-300*c,140*c+d,-300*c,0*c+d),b.moveTo(-160*c,230*c+d),b.lineTo(-120*c,290*c+d),b.lineTo(120*c,290*c+d),b.lineTo(160*c,230*c+d),b.bezierCurveTo(120*c,250*c+d,-120*c,250*c+d,-160*c,230*c+d);break;case"Ahmed S2":b.moveTo(-300*c,0*c+d),b.bezierCurveTo(-300*c,-100*c+d,-200*c,-400*c+d,0*c,-400*c+d),b.bezierCurveTo(200*c,-400*c+d,300*c,-100*c+d,300*c,0*c+d),b.bezierCurveTo(300*c,140*c+d,200*c,250*c+d,0*c,250*c+d),b.bezierCurveTo(-200*c,250*c+d,-300*c,140*c+d,-300*c,0*c+d),b.moveTo(-160*c,230*c+d),b.lineTo(-120*c,290*c+d),b.lineTo(120*c,290*c+d),b.lineTo(160*c,230*c+d),b.bezierCurveTo(120*c,250*c+d,-120*c,250*c+d,-160*c,230*c+d);break;case"Ahmed S3":b.moveTo(-100*c,230*c+d),b.lineTo(100*c,230*c+d),b.lineTo(200*c,0*c+d),b.lineTo(100*c,-230*c+d),b.lineTo(-100*c,-230*c+d),b.lineTo(-200*c,0*c+d),b.lineTo(-100*c,230*c+d),b.moveTo(-100*c,230*c+d),b.lineTo(-100*c,290*c+d),b.lineTo(100*c,290*c+d),b.lineTo(100*c,230*c+d),b.bezierCurveTo(100*c,250*c+d,-100*c,250*c+d,-100*c,230*c+d);break;case"Baerveldt 103-250":b.moveTo(0,230*c+d),b.lineTo(-100*c,230*c+d),b.bezierCurveTo(-500*c,180*c+d,-300*c,-240*c+d,0,-200*c+d),b.bezierCurveTo(300*c,-240*c+d,500*c,180*c+d,100*c,230*c+d),b.lineTo(0,230*c+d),b.moveTo(-160*c,230*c+d),b.lineTo(-120*c,290*c+d),b.lineTo(120*c,290*c+d),b.lineTo(160*c,230*c+d),b.bezierCurveTo(120*c,250*c+d,-120*c,250*c+d,-160*c,230*c+d);break;case"Baerveldt 101-350":b.moveTo(0,230*c+d),b.lineTo(-100*c,230*c+d),b.bezierCurveTo(-150*c,230*c+d,-600*c,0*c+d,-300*c,-200*c+d),b.bezierCurveTo(-200*c,-240*c+d,200*c,-240*c+d,300*c,-200*c+d),b.bezierCurveTo(600*c,0*c+d,150*c,230*c+d,100*c,230*c+d),b.lineTo(0,230*c+d),b.moveTo(-160*c,230*c+d),b.lineTo(-120*c,290*c+d),b.lineTo(120*c,290*c+d),b.lineTo(160*c,230*c+d),b.bezierCurveTo(120*c,250*c+d,-120*c,250*c+d,-160*c,230*c+d);break;case"Baerveldt 103-350":b.moveTo(0,230*c+d),b.lineTo(-100*c,230*c+d),b.bezierCurveTo(-150*c,230*c+d,-600*c,0*c+d,-300*c,-200*c+d),b.bezierCurveTo(-200*c,-240*c+d,200*c,-240*c+d,300*c,-200*c+d),b.bezierCurveTo(600*c,0*c+d,150*c,230*c+d,100*c,230*c+d),b.lineTo(0,230*c+d),b.moveTo(-160*c,230*c+d),b.lineTo(-120*c,290*c+d),b.lineTo(120*c,290*c+d),b.lineTo(160*c,230*c+d),b.bezierCurveTo(120*c,250*c+d,-120*c,250*c+d,-160*c,230*c+d);break;case"Molteno Single":b.arc(0,d,310*c,0,2*Math.PI,!0);break;case"Molteno 8mm":b.arc(0,d+30,250*c,0,2*Math.PI,!0)}if(b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",b.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){switch(this.type){case"Ahmed FP7":this.drawSpot(b,0*c,-230*c+d,20*c,"white"),this.drawSpot(b,-180*c,-180*c+d,20*c,"white"),this.drawSpot(b,180*c,-180*c+d,20*c,"white"),b.beginPath(),b.moveTo(-100*c,230*c+d),b.lineTo(100*c,230*c+d),b.lineTo(200*c,0*c+d),b.lineTo(40*c,0*c+d),b.arcTo(0,-540*c+d,-40*c,0*c+d,15),b.lineTo(-40*c,0*c+d),b.lineTo(-200*c,0*c+d),b.closePath(),b.fillStyle="rgba(250,250,250,0.7)",b.fill(),b.moveTo(-80*c,-40*c+d),b.lineTo(-160*c,-280*c+d),b.moveTo(80*c,-40*c+d),b.lineTo(160*c,-280*c+d),b.lineWidth=8,b.strokeStyle="rgba(250,250,250,0.7)",b.stroke(),b.beginPath(),b.moveTo(-30*c,250*c+d),b.lineTo(-30*c,290*c+d),b.moveTo(30*c,250*c+d),b.lineTo(30*c,290*c+d);break;case"Ahmed S2":b.beginPath(),b.moveTo(-100*c,230*c+d),b.lineTo(100*c,230*c+d),b.lineTo(200*c,0*c+d),b.lineTo(-40*c,0*c+d),b.lineTo(-200*c,0*c+d),b.closePath(),b.fillStyle="rgba(250,250,250,0.7)",b.fill(),b.beginPath(),b.moveTo(-280*c,0*c+d),b.lineTo(280*c,0*c+d),b.lineWidth=8,b.strokeStyle="rgba(250,250,250,0.7)",b.stroke();break;case"Ahmed S3":b.beginPath(),b.moveTo(-100*c,230*c+d),b.lineTo(100*c,230*c+d),b.lineTo(200*c,0*c+d),b.lineTo(-40*c,0*c+d),b.lineTo(-200*c,0*c+d),b.closePath(),b.fillStyle="rgba(250,250,250,0.7)",b.fill();break;case"Baerveldt 103-250":this.drawSpot(b,-120*c,20*c+d,10,"rgba(150,150,150,0.5)"),this.drawSpot(b,120*c,20*c+d,10,"rgba(150,150,150,0.5)"),b.beginPath(),b.moveTo(-30*c,250*c+d),b.lineTo(-30*c,290*c+d),b.moveTo(30*c,250*c+d),b.lineTo(30*c,290*c+d),b.strokeStyle="rgba(150,150,150,0.5)",b.stroke();break;case"Baerveldt 101-350":this.drawSpot(b,-120*c,20*c+d,10,"rgba(150,150,150,0.5)"),this.drawSpot(b,120*c,20*c+d,10,"rgba(150,150,150,0.5)"),b.beginPath(),b.moveTo(-30*c,250*c+d),b.lineTo(-30*c,290*c+d),b.moveTo(30*c,250*c+d),b.lineTo(30*c,290*c+d),b.strokeStyle="rgba(150,150,150,0.5)",b.stroke();break;case"Baerveldt 103-350":this.drawSpot(b,-120*c,20*c+d,10,"rgba(150,150,150,0.5)"),this.drawSpot(b,120*c,20*c+d,10,"rgba(150,150,150,0.5)"),b.beginPath(),b.moveTo(-30*c,250*c+d),b.lineTo(-30*c,290*c+d),b.moveTo(30*c,250*c+d),b.lineTo(30*c,290*c+d),b.strokeStyle="rgba(150,150,150,0.5)",b.stroke();break;case"Molteno Single":b.beginPath(),b.arc(0,d,250*c,0,2*Math.PI,!0),b.stroke(),this.drawSpot(b,-200*c,200*c+d,5,"rgba(255,255,255,1)"),this.drawSpot(b,-200*c,-200*c+d,5,"rgba(255,255,255,1)"),this.drawSpot(b,200*c,-200*c+d,5,"rgba(255,255,255,1)"),this.drawSpot(b,200*c,200*c+d,5,"rgba(255,255,255,1)");break;case"Molteno 8mm":b.beginPath(),b.arc(0,d+30,200*c,0,2*Math.PI,!0),b.stroke(),this.drawSpot(b,-160*c,160*c+d+30,5,"rgba(255,255,255,1)"),this.drawSpot(b,-160*c,-160*c+d+30,5,"rgba(255,255,255,1)"),this.drawSpot(b,160*c,-160*c+d+30,5,"rgba(255,255,255,1)"),this.drawSpot(b,160*c,160*c+d+30,5,"rgba(255,255,255,1)")}if(this.tubeExtender)b.beginPath(),b.moveTo(0,290*c+d),b.lineTo(0,480*c+d);else{this.bezierArray.sp=new ED.Point(0,380*c+d),this.bezierArray.cp1=new ED.Point(0,460*c+d),this.bezierArray.ep=new ED.Point(this.apexX,this.apexY);var e=new ED.Point(this.apexX,this.apexY),f=e.direction()<Math.PI?e.direction():2*Math.PI-e.direction();this.bezierArray.cp2=e.pointAtRadiusAndClockwiseAngle(300*(1+1.5*f),.2*f),b.beginPath(),b.moveTo(0,290*c+d),b.lineTo(this.bezierArray.sp.x,this.bezierArray.sp.y),b.bezierCurveTo(this.bezierArray.cp1.x,this.bezierArray.cp1.y,this.bezierArray.cp2.x,this.bezierArray.cp2.y,this.bezierArray.ep.x,this.bezierArray.ep.y)}b.strokeStyle="rgba(150,150,150,0.5)",b.lineWidth=20,b.stroke(),b.strokeStyle="white",b.lineWidth=8,b.stroke()}return this.tubeExtender||(this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a)),this.isClicked},ED.Tube.prototype.description=function(){var a={STQ:"superotemporal",SNQ:"superonasal",INQ:"inferonasal",ITQ:"inferotemporal"};return this.type+" tube in the "+a[this.platePosition]+" quadrant"},ED.TubeExtender=function(a,b){this.className="TubeExtender",this.platePosition="STQ",this.bezierArray=new Array,this.savedParameterArray=["apexX","apexY"],ED.Doodle.call(this,a,b)},ED.TubeExtender.prototype=new ED.Doodle,ED.TubeExtender.prototype.constructor=ED.TubeExtender,ED.TubeExtender.superclass=ED.Doodle.prototype,ED.TubeExtender.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.TubeExtender.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!0,this.snapToAngles=!0,this.isUnique=!0,this.parameterValidationArray.apexY.range.setMinAndMax(-600,-100),this.parameterValidationArray.platePosition={kind:"derived",type:"string",list:["STQ","SNQ","INQ","ITQ"],animate:!0};var a=Math.PI/4;this.anglesArray=[a,3*a,5*a,7*a]},ED.TubeExtender.prototype.setParameterDefaults=function(){this.apexY=-300,this.setParameterFromString("platePosition","STQ");var a=this.drawing.lastDoodleOfClass("Tube");a&&(this.rotation=a.rotation)},ED.TubeExtender.prototype.dependentParameterValues=function(a,b){var c=new Array,d=this.drawing.eye==ED.eye.Right,e=Math.PI/4;switch(a){case"rotation":c.platePosition=this.rotation>0&&this.rotation<=2*e?d?"SNQ":"STQ":this.rotation>2*e&&this.rotation<=4*e?d?"INQ":"ITQ":this.rotation>4*e&&this.rotation<=6*e?d?"ITQ":"INQ":d?"STQ":"SNQ";break;case"platePosition":switch(b){case"STQ":c.rotation=d?7*e:e;break;case"SNQ":c.rotation=d?e:7*e;break;case"INQ":c.rotation=d?3*e:5*e;break;case"ITQ":c.rotation=d?5*e:3*e}}return c},ED.TubeExtender.prototype.draw=function(a){var b=this.drawing.context,c=this.drawing.lastDoodleOfClass("Tube");c&&(this.rotation=c.rotation),ED.TubeExtender.superclass.draw.call(this,a),b.beginPath();var d=.41666667,e=-680;if(this.roundRect(b,-160*d,200*d+e,320*d,200*d,40*d),b.lineWidth=4,b.strokeStyle="rgba(120,120,120,0.75)",b.fillStyle="rgba(220,220,220,0.5)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw){b.beginPath(),b.moveTo(0*d,180*d+e),b.lineTo(-30*d,180*d+e),b.quadraticCurveTo(-50*d,180*d+e,-50*d,200*d+e),b.lineTo(-50*d,260*d+e),b.quadraticCurveTo(-100*d,300*d+e,-50*d,340*d+e),b.lineTo(-50*d,400*d+e),b.quadraticCurveTo(-50*d,420*d+e,-30*d,420*d+e),b.lineTo(0*d,420*d+e),b.lineTo(30*d,420*d+e),b.quadraticCurveTo(50*d,420*d+e,50*d,400*d+e),b.lineTo(50*d,340*d+e),b.quadraticCurveTo(100*d,300*d+e,50*d,260*d+e),b.lineTo(50*d,200*d+e),b.quadraticCurveTo(50*d,180*d+e,30*d,180*d+e),b.closePath(),b.stroke(),this.drawCircle(b,-120*d,300*d+e,20*d,b.fillStyle,4,b.strokeStyle),this.drawCircle(b,120*d,300*d+e,20*d,b.fillStyle,4,b.strokeStyle),this.bezierArray.sp=new ED.Point(0,380*d+e),this.bezierArray.cp1=new ED.Point(0,460*d+e),this.bezierArray.ep=new ED.Point(this.apexX,this.apexY);var f=new ED.Point(this.apexX,this.apexY),g=f.direction()<Math.PI?f.direction():2*Math.PI-f.direction();this.bezierArray.cp2=f.pointAtRadiusAndClockwiseAngle(300*(1+1.5*g),.2*g),b.beginPath(),b.moveTo(0,290*d+e),b.lineTo(this.bezierArray.sp.x,this.bezierArray.sp.y),b.bezierCurveTo(this.bezierArray.cp1.x,this.bezierArray.cp1.y,this.bezierArray.cp2.x,this.bezierArray.cp2.y,this.bezierArray.ep.x,this.bezierArray.ep.y),b.strokeStyle="rgba(150,150,150,0.5)",b.lineWidth=20,b.stroke(),b.strokeStyle="white",b.lineWidth=8,b.stroke()}return this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TubeExtender.prototype.description=function(){return"Tube extender present"},ED.TubeExtender.prototype.roundRect=function(a,b,c,d,e,f){"undefined"==typeof f&&(f=5),a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath()},ED.TubeLigation=function(a,b){this.className="TubeLigation",this.material="Vicryl",this.controlParameterArray={material:"Material"},this.savedParameterArray=["originX","originY","rotation","material"],ED.Doodle.call(this,a,b)},ED.TubeLigation.prototype=new ED.Doodle,ED.TubeLigation.prototype.constructor=ED.TubeLigation,ED.TubeLigation.superclass=ED.Doodle.prototype,ED.TubeLigation.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1,this.parameterValidationArray.material={kind:"derived",type:"string",list:["10/0 Nylon","Vicryl","Prolene"],animate:!0}},ED.TubeLigation.prototype.setParameterDefaults=function(){this.originX=-240,this.originY=-240;var a=this.drawing.eye==ED.eye.Right,b=this.drawing.lastDoodleOfClass("Tube");if(b)switch(b.platePosition){case"STQ":a?(this.originX=-240,this.originY=-240,this.rotation=-Math.PI/4):(this.originX=240,this.originY=-240,this.rotation=Math.PI/4);break;case"SNQ":a?(this.originX=240,this.originY=-240,this.rotation=Math.PI/4):(this.originX=-240,this.originY=-240,this.rotation=-Math.PI/4);break;case"INQ":a?(this.originX=240,this.originY=240,this.rotation=3*Math.PI/4):(this.originX=-240,this.originY=240,this.rotation=-3*Math.PI/4);break;case"ITQ":a?(this.originX=-240,this.originY=240,this.rotation=5*Math.PI/4):(this.originX=240,this.originY=240,this.rotation=-5*Math.PI/4)}var c=this.drawing.numberOfDoodlesOfClass(this.className),b=this.drawing.firstDoodleOfClass(this.className),d=b.originX>0?1:-1,e=b.originY>0?1:-1;switch(c){case 1:this.originX=400*d,this.originY=400*e;break;case 2:this.originX=320*d,this.originY=320*e}},ED.TubeLigation.prototype.draw=function(a){var b=this.drawing.context;return ED.TubeLigation.superclass.draw.call(this,a),b.beginPath(),b.moveTo(-20,0),b.arcTo(0,-20,20,0,30),b.arcTo(0,20,-20,0,30),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="purple",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(35,-10),b.lineTo(20,0),b.lineTo(35,10),b.stroke(),this.drawSpot(b,20,0,4,"purple")),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.TubeLigation.prototype.groupDescription=function(){var a="",b=this.drawing.numberOfDoodlesOfClass(this.className);return a=b+" ligation suture",b>1&&(a+="s"),a},ED.UTear=function(a,b){this.className="UTear",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.UTear.prototype=new ED.Doodle,ED.UTear.prototype.constructor=ED.UTear,ED.UTear.superclass=ED.Doodle.prototype,ED.UTear.prototype.setHandles=function(){this.handleArray[3]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.UTear.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-40,30)},ED.UTear.prototype.setParameterDefaults=function(){this.apexY=-20;var a=this.drawing.lastDoodleOfClass(this.className);if(a){var b=new ED.Point(a.originX,a.originY),c=new ED.Point(0,0);c.setWithPolars(b.length(),b.direction()+Math.PI/6),this.move(c.x,c.y)}else this.move(200*(this.drawing.eye==ED.eye.Right?-1:1),-300)},ED.UTear.prototype.draw=function(a){var b=this.drawing.context;return ED.UTear.superclass.draw.call(this,a),b.beginPath(),b.moveTo(0,40),b.bezierCurveTo(-20,40,-40,-20,-40,-40),b.bezierCurveTo(-40,-60,-20,this.apexY,0,this.apexY),b.bezierCurveTo(20,this.apexY,40,-60,40,-40),b.bezierCurveTo(40,-20,20,40,0,40),b.closePath(),b.lineWidth=4,b.fillStyle="red",b.strokeStyle="blue",this.drawBoundary(a),this.handleArray[3].location=this.transform.transformPoint(new ED.Point(40,-40)),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.leftExtremity=this.transform.transformPoint(new ED.Point(-40,-40)),this.rightExtremity=this.transform.transformPoint(new ED.Point(40,-40)),this.arc=this.calculateArc(),this.isClicked},ED.UTear.prototype.groupDescription=function(){return"'U' tear at "},ED.UTear.prototype.description=function(){return this.clockHour()},ED.UTear.prototype.groupDescriptionEnd=function(){return" o'clock"},ED.UTear.prototype.snomedCode=function(){return 247168006},ED.UTear.prototype.diagnosticHierarchy=function(){return 6},ED.Vicryl=function(a,b){this.className="Vicryl",this.savedParameterArray=["originX","originY"],ED.Doodle.call(this,a,b)},ED.Vicryl.prototype=new ED.Doodle,ED.Vicryl.prototype.constructor=ED.Vicryl,ED.Vicryl.superclass=ED.Doodle.prototype,ED.Vicryl.prototype.setPropertyDefaults=function(){this.isOrientated=!0,this.isRotatable=!1},ED.Vicryl.prototype.setParameterDefaults=function(){this.originY=-240,this.drawing.eye==ED.eye.Right?(this.originX=-240,this.rotation=-Math.PI/4):(this.originX=240,this.rotation=Math.PI/4)},ED.Vicryl.prototype.draw=function(a){var b=this.drawing.context;return ED.Vicryl.superclass.draw.call(this,a),b.beginPath(),b.moveTo(-20,0),b.arcTo(0,-20,20,0,30),b.arcTo(0,20,-20,0,30),b.lineWidth=4,b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="purple",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(35,-10),b.lineTo(20,0),b.lineTo(35,10),b.stroke(),this.drawSpot(b,20,0,4,"purple")),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.Vicryl.prototype.description=function(){return"Vicryl suture"},ED.ViewObscured=function(a,b){this.className="ViewObscured",this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b)},ED.ViewObscured.prototype=new ED.Doodle,ED.ViewObscured.prototype.constructor=ED.ViewObscured,ED.ViewObscured.superclass=ED.Doodle.prototype,ED.ViewObscured.prototype.setHandles=function(){this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.ViewObscured.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.ViewObscured.prototype.setParameterDefaults=function(){this.apexY=-100},ED.ViewObscured.prototype.draw=function(a){var b=this.drawing.context;ED.ViewObscured.superclass.draw.call(this,a),b.beginPath();var c=200;b.rect(-499,-499,998,998);var d=.3+.6*(c+2*this.apexY)/c;return b.fillStyle="rgba(150, 150, 150,"+d+")",b.lineWidth=0,b.strokeStyle="rgba(150, 150, 150, 0)",this.drawBoundary(a),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.ViewObscured.prototype.description=function(){var a,b;return this.apexY<-50?(a="Poor view of ",b=""):(a="",b=" obscured"),this.drawing.hasDoodleOfClass("PostPole")?a+="Posterior pole":this.drawing.hasDoodleOfClass("Fundus")?a+="Fundus":this.drawing.hasDoodleOfClass("OpticDisc")&&(a+="Optic disc"),a+=b},ED.VisualField=function(a,b){this.className="VisualField",this.numberOfHandles=8,this.blindSpotX=0,this.savedParameterArray=["apexY"],ED.Doodle.call(this,a,b)},ED.VisualField.prototype=new ED.Doodle,ED.VisualField.prototype.constructor=ED.VisualField,ED.VisualField.superclass=ED.Doodle.prototype,ED.VisualField.prototype.setHandles=function(){for(var a=0;a<this.numberOfHandles;a++)this.handleArray[a]=new ED.Doodle.Handle(null,!0,ED.Mode.Handles,!1);this.handleArray[this.numberOfHandles]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.VisualField.prototype.setPropertyDefaults=function(){this.isMoveable=!1,this.isRotatable=!1,this.isDeletable=!1,this.isUnique=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-320,-20),this.handleVectorRangeArray=new Array;for(var a=0;a<this.numberOfHandles;a++){var b=2*Math.PI,c=new Object;c.length=new ED.Range(0,400),c.angle=new ED.Range((15*b/16+a*b/8)%b,(1*b/16+a*b/8)%b),this.handleVectorRangeArray[a]=c}},ED.VisualField.prototype.setParameterDefaults=function(){this.apexY=-40;var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a);for(var b=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],c=0;c<this.numberOfHandles;c++){var d=b[c],e=new ED.Point(d[0],d[1]);this.addPointToSquiggle(e)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualField.prototype.draw=function(a){var b=this.drawing.context;ED.VisualField.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],c.length()<100||d.length()<100?b.lineTo(d.x,d.y):(e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y))
}b.moveTo(this.blindSpotX-this.apexY,0),b.arc(this.blindSpotX,0,-this.apexY,0,2*Math.PI,!0),b.closePath(),b.lineWidth=2,b.fillStyle="lightGray",b.strokeStyle="black",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw&&(b.beginPath(),b.moveTo(0,-450),b.lineTo(0,450),b.moveTo(-450,0),b.lineTo(450,0),b.lineWidth=8,b.strokeStyle="black",b.stroke());for(var h=0;h<this.numberOfHandles;h++)this.handleArray[h].location=this.transform.transformPoint(this.squiggleArray[0].pointsArray[h]);return this.handleArray[this.numberOfHandles].location=this.transform.transformPoint(new ED.Point(this.blindSpotX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.VisualField.prototype.description=function(){return""},ED.VisualFieldChart=function(a,b){this.className="VisualFieldChart",this.numberOfHandles=8,this.blindSpotX=0,ED.Doodle.call(this,a,b)},ED.VisualFieldChart.prototype=new ED.Doodle,ED.VisualFieldChart.prototype.constructor=ED.VisualFieldChart,ED.VisualFieldChart.superclass=ED.Doodle.prototype,ED.VisualFieldChart.prototype.setPropertyDefaults=function(){this.isSelectable=!1},ED.VisualFieldChart.prototype.setParameterDefaults=function(){var a=new ED.Squiggle(this,new ED.Colour(100,100,100,1),4,!0);this.squiggleArray.push(a);for(var b=[[0,-370],[300,-260],[400,0],[300,260],[0,370],[-300,260],[-400,0],[-300,-260]],c=0;c<this.numberOfHandles;c++){var d=b[c],e=new ED.Point(d[0],d[1]);this.addPointToSquiggle(e)}this.drawing.eye==ED.eye.Right?(this.squiggleArray[0].pointsArray[3].x=220,this.squiggleArray[0].pointsArray[3].y=170,this.blindSpotX=-120):(this.squiggleArray[0].pointsArray[5].x=-220,this.squiggleArray[0].pointsArray[5].y=170,this.blindSpotX=120)},ED.VisualFieldChart.prototype.draw=function(a){var b=this.drawing.context;ED.VisualFieldChart.superclass.draw.call(this,a),b.beginPath();var c,d,e,f,g=2*Math.PI/(3*this.numberOfHandles);b.moveTo(this.squiggleArray[0].pointsArray[0].x,this.squiggleArray[0].pointsArray[0].y);for(var h=0;h<this.numberOfHandles;h++){c=this.squiggleArray[0].pointsArray[h];var i=h<this.numberOfHandles-1?h+1:0;d=this.squiggleArray[0].pointsArray[i],e=c.tangentialControlPoint(+g),f=d.tangentialControlPoint(-g),b.bezierCurveTo(e.x,e.y,f.x,f.y,d.x,d.y)}return b.closePath(),b.lineWidth=2,b.fillStyle="gray",b.strokeStyle="black",this.drawBoundary(a),this.isClicked},ED.VitreousOpacity=function(a,b){this.className="VitreousOpacity",this.savedParameterArray=["originX","originY","apexY","scaleX","scaleY"],ED.Doodle.call(this,a,b)},ED.VitreousOpacity.prototype=new ED.Doodle,ED.VitreousOpacity.prototype.constructor=ED.VitreousOpacity,ED.VitreousOpacity.superclass=ED.Doodle.prototype,ED.VitreousOpacity.prototype.setHandles=function(){this.handleArray[2]=new ED.Doodle.Handle(null,!0,ED.Mode.Scale,!1),this.handleArray[4]=new ED.Doodle.Handle(null,!0,ED.Mode.Apex,!1)},ED.VitreousOpacity.prototype.setPropertyDefaults=function(){this.isRotatable=!1,this.isSqueezable=!0,this.parameterValidationArray.apexX.range.setMinAndMax(-0,0),this.parameterValidationArray.apexY.range.setMinAndMax(-100,0)},ED.VitreousOpacity.prototype.setParameterDefaults=function(){this.apexY=-100,this.setOriginWithDisplacements(0,-100)},ED.VitreousOpacity.prototype.draw=function(a){var b=this.drawing.context;ED.VitreousOpacity.superclass.draw.call(this,a),b.beginPath(),b.beginPath();var c=200;b.arc(0,0,c,0,2*Math.PI,!0);var d=.3+.6*(c+2*this.apexY)/c;return b.fillStyle="rgba(255, 0, 0,"+d+")",b.lineWidth=0,b.strokeStyle="rgba(255, 0, 0, 0)",this.drawBoundary(a),this.drawFunctionMode==ED.drawFunctionMode.Draw,point=new ED.Point(0,0),point.setWithPolars(c,Math.PI/4),this.handleArray[2].location=this.transform.transformPoint(point),this.handleArray[4].location=this.transform.transformPoint(new ED.Point(this.apexX,this.apexY)),this.isSelected&&!this.isForDrawing&&this.drawHandles(a),this.isClicked},ED.VitreousOpacity.prototype.description=function(){return"Vitreous haemorrhage"},ED.VitreousOpacity.prototype.snomedCode=function(){return 31341008};