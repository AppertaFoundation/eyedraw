<!DOCTYPE html>
<html>
    <head>
        <!-- EyeDraw CSS style sheet -->
        <link rel="stylesheet" href="../css/OEEyeDraw.css" type="text/css" media="screen" />
        
        <!-- Mandatory file containing key drawing classes -->
        <script language="JavaScript" src="../js/ED_Drawing.js" type="text/javascript"></script>
        
        <!-- Subclasses loaded according to need -->
        <script language="JavaScript" src="../js/ED_AntSeg.js" type="text/javascript"></script>
        
        <!-- This script handles the drawings for the page -->
        <script type="text/javascript">
            
            // Assign a global variable to the drawing
            var drawingEdit1;
            var drawingEdit2;
            
            // Runs on page load
            function init()
            {
                // Create two drawings linked to each canvas
                drawingEdit1 = new ED.Drawing(document.getElementById('canvasEdit1'), ED.eye.Right, 'RPS', true, {graphicsPath:"../graphics/"});
                drawingEdit2 = new ED.Drawing(document.getElementById('canvasEdit2'), ED.eye.Left, 'LPS', true, {graphicsPath:"../graphics/"});
            }
            
            // Main Controller class
            function eyeDrawController(_drawing)
            {
                // Create an array of synchronisations
                var syncArray = new Array();
                if (_drawing.IDSuffix == 'RPS')
                {
                    syncArray['LPS'] = {AntSeg:['AntSeg']};
                }
                if (_drawing.IDSuffix == 'LPS')
                {
                    syncArray['RPS'] = {AntSeg:['AntSeg']};
                }
                
                // Function called for notification
                this.notificationHandler = function (_messageArray)
                {
                    switch (_messageArray['eventName'])
                    {
                        // Loaded notification
                        case 'loaded':
                            _drawing.addDoodle('AntSeg');
                            break;
                        
                        // Parameter change notification
                        case 'parameter':
                        
                            // Iterate through syncArray
                            for (var idSuffix in syncArray)
                            {
                                // Iterate through each specified className
                                for (var className in syncArray[idSuffix])
                                {
                                    // Get array of specified slave doodle class names
                                    var slaveClassNameArray = syncArray[idSuffix][className];
                                    
                                    // Iterate through it,
                                    for (var i = 0; i < slaveClassNameArray.length; i++)
                                    {
                                        // Define which drawing is slave
                                        var slaveDrawing = idSuffix == 'RPS'?drawingEdit1:drawingEdit2;
                                        
                                        // Master doodle
                                        var masterDoodle = _messageArray['object'].doodle;
                                        
                                        // Slave doodle (uses first doodle in the drawing matching the className)
                                        var slaveDoodle = slaveDrawing.firstDoodleOfClass(slaveClassNameArray[i]);
                                        
                                        // If master is being driven, both are defined, and slave doodle is set to sync, enact sync for the changed parameter
                                        if (masterDoodle && slaveDoodle && slaveDoodle.willSync && masterDoodle.drawing.isActive)
                                        {
                                            // Sync is handled by a method of the slave doodle object
                                            slaveDoodle.syncParameter(_messageArray.object.parameter, masterDoodle[_messageArray.object.parameter]);
                                            
                                            // Update any bindings associated with the slave doodle
                                            slaveDrawing.updateBindings(slaveDoodle);
                                        }
                                    }
                                }
                            }

                            break;
                    }
                }
            }
            
            </script>
    </head>
    <body onload="init();">
        
        <!-- Canvas elements -->
        <canvas id="canvasEdit1" class="ed_canvas_edit" width="300" height="300" tabindex="1"></canvas>
        <canvas id="canvasEdit2" class="ed_canvas_edit" width="300" height="300" tabindex="2"></canvas>
        
    </body>
</html>