<!DOCTYPE html>
<html>
    <head>
        <title>EyeDraw</title>
        
        <!-- EyeDraw CSS style sheet -->
        <link rel="stylesheet" href="../css/oe-eyedraw.css" type="text/css" media="screen" />
        
        <!-- Mandatory file containing key drawing classes -->
        <script src="../dist/eyedraw.js" type="text/javascript"></script>
        
        <!--   This script handles the drawings for the page   -->
        <script type="text/javascript">
        
            var doodleSet = [{"version": 1.0, "subclass": "Patch", "originX": -130, "originY": -183, "apexX": -50, "rotation": 325, "order": 0, }];
            
            
            // This set can be written by PHP and contains doodle data for this drawing from a database
//            var doodleSet = [{"subclass": "PhakoIncision", "originX": 0, "originY": 0, "radius": 250, "apexX": 0, "apexY": -250, "scaleX": 1.00, "scaleY": 1.00, "arc": 90, "rotation": 319, "order": 0, "squiggleArray": []}];
            
            
            // Unique variable assigned to the drawing
            var drawingEdit;
            var drawingDisplay;
            var doodle;
            var controller;
            
            // Runs on page load
            function init()
            {
                // Get reference to the drawingEdit canvas
                var canvasEdit = document.getElementById('canvasEdit');
                
                // Create a drawingEdit , {scaleOn:'width'}
                drawingEdit = new ED.Drawing(canvasEdit, ED.eye.Right, 'RPS', true, {graphicsPath:'../img/'});
                
                // Instantiate a controller object
                controller = new eyeDrawController(drawingEdit);
                
                // Initialise drawing
                drawingEdit.init();
                
                // Set focus to canvasEdit element
                canvasEdit.focus();
                
//                for (var propertyName in ED)
//                {
//                    var doodle = ED[propertyName];
//                    
//                    if (doodle.superclass == ED.Doodle.prototype)
//                    {
//                        var dood = new ED[propertyName];
//                        console.log(dood.className);
//                    }
//                }
            }

            // Controller class
            function eyeDrawController(_drawing)
            {
                this.drawing = _drawing;
                this.gsf = 1;
                
                // Specify call back function
                this.callBack = callBack;
                
                // Register for notifications with drawing object
                this.drawing.registerForNotifications(this, 'callBack', []);
                
                
                // Method called for notification
                function callBack(_messageArray)
                {
                    switch (_messageArray['eventName'])
                    {
                        // Eye draw image files all loaded
                        case 'ready':
                        
							//Scale down for glaucoma drawings
							this.drawing.globalScaleFactor = this.gsf;
							
							//this.drawing.addDoodle('PostPole');
							this.drawing.addDoodle('RPERip');

/*
							// Column 1
							this.drawing.addDoodle('FieldCircle', {originX:-450, originY:-150, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-450, originY:-50, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-450, originY:+50, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-450, originY:+150, colour:"FF0000"});

							// Column 2
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:-250, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:-150, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:-50, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:+50, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:+150, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-350, originY:+250, colour:"FF0000"});                   

							// Column 3
							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:-350, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:-250, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:-150, colour:"FF0000"});

							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:+150, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:+250, colour:"FF0000"}); 
							this.drawing.addDoodle('FieldCircle', {originX:-250, originY:+350, colour:"008000"});

							// Column 4
							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:-350, colour:"FF0000"});
							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:-250, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:-150, colour:"008000"});

							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:+150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:+250, colour:"008000"}); 
							this.drawing.addDoodle('FieldCircle', {originX:-150, originY:+350, colour:"FF0000"});

							// Column 5
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:-350, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:-250, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:-150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:+50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:+150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:+250, colour:"008000"}); 
							this.drawing.addDoodle('FieldCircle', {originX:-50, originY:+350, colour:"008000"});

							// Column 6
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:-350, colour:"FFA400"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:-250, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:-150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:+50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:+150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:+250, colour:"008000"}); 
							this.drawing.addDoodle('FieldCircle', {originX:+50, originY:+350, colour:"FFA400"});

							// Column 7
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:-250, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:-150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:+50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:+150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:+250, colour:"008000"});
							
							// Column 8
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:-150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:+50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+150, originY:+150, colour:"008000"});

							// Column 9
							this.drawing.addDoodle('FieldCircle', {originX:+250, originY:-150, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+250, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+250, originY:+50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+250, originY:+150, colour:"008000"});
							
							// Column 10
							this.drawing.addDoodle('FieldCircle', {originX:+350, originY:-50, colour:"008000"});
							this.drawing.addDoodle('FieldCircle', {originX:+350, originY:+50, colour:"008000"});
*/																												
							this.drawing.deselectDoodles();
                            break;
                            
                        case 'parameterChanged':
                            var doodle = _messageArray['object'].doodle;
                            

                            break;
                        
                        case 'doodleAdded':
							var dood = _messageArray['object'];
							if (typeof(dood) != 'undefined')
							{
								if (dood.className == 'TrabySuture')
								{
									// Add it to first available slot in suture Array
									for (var i = 0; i < sutureArray.length; i++)
                            		{
                            			if (sutureArray[i] == null)
                            			{
                            				sutureArray[i] = dood;
                            				
											var trab = this.drawing.lastDoodleOfClass("TrabyFlap");
											if (trab)
											{
												// Get original position
												var p = suturePointsArray[i];
								
												// Calculate radius to this point
												var r = Math.sqrt(p.x * p.x + p.y * p.y);
								
												// Calculate new position
												var np = p.pointAtRadiusAndClockwiseAngle(r, trab.rotation);
								
												// Apply it to suture
												sutureArray[i].originX = np.x;
												sutureArray[i].originY = np.y;
								
												// Apply rotation
												sutureArray[i].rotation = ED.Mod(p.angle + trab.rotation, 2 * Math.PI);
												
												// Apply type
												sutureArray[i].setParameterFromString('type', p.type);
												
												// Apply firstOrginX
												sutureArray[i].firstOriginX = p.ex;
												
												this.drawing.repaint();
											}
											                      				
                            				break;
                            			}
                            		}									
								}
							}
							break;
                        
                        case 'doodleDeleted':
							var className = _messageArray['object'];
							if (typeof(className) != 'undefined')
							{
								if (className == 'TrabySuture') 
								{
									console.log('Traby suture deleted');
									
									// Go through array identifying which one has been removed
									for (var i = 0; i < sutureArray.length; i++)
                            		{
                            			var id = sutureArray[i].id;
                            			if (!this.drawing.doodleOfId(id))
                            			{
                            				sutureArray[i] = null;
                            			}
                            		}
								}
							}
							break;

                    }
                }
            }
            
            </script>
    </head>
    
    <body onload="init();">
    
        <!-- Doodle controls toolbar -->
        <div class="ed_toolbar">
            <button class="imgbutton" class="imgbutton" disabled="disabled" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="../img/moveToFront.gif"/></button>
            <button class="imgbutton" disabled="disabled" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="../img/moveToBack.gif" /></button>
            <button class="imgbutton" disabled="disabled" id="flipVerRPS" title="Flip around vertical axis" onclick="drawingEdit.flipVer(); return false;" ><img src="../img/flipVer.gif" /></button>
            <button class="imgbutton" disabled="disabled" id="flipHorRPS" title="Flip around horizontal axis" onclick="drawingEdit.flipHor(); return false;" ><img src="../img/flipHor.gif" /></button>
            <button class="imgbutton" disabled="disabled" id="deleteSelectedDoodleRPS" title="Delete" onclick="drawingEdit.deleteSelectedDoodle(); return false;" ><img src="../img/deleteSelectedDoodle.gif" /></button>
            <button class="imgbutton" disabled="disabled" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="../img/lock.gif" /></button>
            <button class="imgbutton" disabled="disabled" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="../img/unlock.gif" /></button>
            
            <label style="display:none;" ><input class="checkbox" type="checkbox" id="isSuturedSclerostomyRPS" onchange="drawingEdit.setSelectedDoodle(this, 'isSutured');return false;" />Sutured</label>
            
            <!-- Squiggle options -->
            <span class= "squiggle" id="squiggleSpanRPS" style="display:none;">
                <img class="colourWell" border="0" src="../img/ColourWell.gif" usemap="#colormapRPS" alt='colormap' />
                <map id="colormapRPS" name="colormapRPS">
                    <area style="cursor:pointer" shape="rect" coords="0,0,16,16" onclick="drawingEdit.setSquiggleColour('000000');" />
                    <area style="cursor:pointer" shape="rect" coords="16,0,32,16" onclick="drawingEdit.setSquiggleColour('FF0000');" />
                    <area style="cursor:pointer" shape="rect" coords="32,0,48,16" onclick="drawingEdit.setSquiggleColour('FF7F00');" />
                    <area style="cursor:pointer" shape="rect" coords="0,16,16,32" onclick="drawingEdit.setSquiggleColour('0000FF');" />
                    <area style="cursor:pointer" shape="rect" coords="16,16,32,32" onclick="drawingEdit.setSquiggleColour('00FF00');" />
                    <area style="cursor:pointer" shape="rect" coords="32,16,48,32" onclick="drawingEdit.setSquiggleColour('FFFF00');" />
                </map>
<!--                 <img class="drawingControl" border="0" src="../img/DrawingControl.gif" usemap="#drawingControlRPS" alt='drawingcontrol' /> -->
                <map id="drawingControlRPS" name="drawingControlRPS">
                    <area style="cursor:pointer" shape="rect" coords="0,0,16,16" onclick="drawingEdit.setSquiggleWidth(ED.squiggleWidth.Thin);" />
                    <area style="cursor:pointer" shape="rect" coords="16,0,32,16" onclick="drawingEdit.setSquiggleWidth(ED.squiggleWidth.Medium);" />
                    <area style="cursor:pointer" shape="rect" coords="32,0,48,16" onclick="drawingEdit.setSquiggleWidth(ED.squiggleWidth.Thick);" />
                    <area style="cursor:pointer" shape="rect" coords="0,16,24,32" onclick="console.log('one');drawingEdit.setSquiggleStyle(ED.squiggleStyle.Outline);" />
                    <area style="cursor:pointer" shape="rect" coords="24,16,48,32" onclick="console.log('two');drawingEdit.setSquiggleStyle(ED.squiggleStyle.Solid);" />
                </map>
                <canvas id="squiggleSettingsRPS" width="24" height="32"></canvas>

            </span>

            <br />
        </div>
            
        <!-- Doodle selection toolbar -->
        <div class="ed_toolbar" id="canvasEdit1doodleToolbar">
 
            <button id="LensRPS" class="imgbutton" title="Lens" onclick="drawingEdit.addDoodle('KoeppeNodule'); return false;" ><img src="../img/KoeppeNodule.gif" /></button>
            <button id="LensRPS" class="imgbutton" title="Lens" onclick="drawingEdit.addDoodle('PI', {rotation:0}); return false;" ><img src="../img/PI.gif" /></button>

<!--            <button id="LensRPS" class="imgbutton" title="Lens" onclick="drawingEdit.addDoodle('Cryo'); return false;" ><img src="../img/Cryo.gif" /></button>
 -->


            <br />
        </div>
        
        <!-- <input class="checkbox" type="checkbox" id="chk_phd"> -->
            
        <!-- Canvas tooltip -->
        <span class="canvasTooltip" id="canvasEditTooltip"></span>
        
        <!-- Canvas element style="border: none;" style="background-color: #DAE6F1;"-->
        <canvas id="canvasEdit" class="ed_canvas_edit" width="300" height="300" tabindex="1" style="border: 1px solic gray;"></canvas>

        <br/>

		<select id="methodSelect">
			<option value="Fornix-based">Fornix-based</option>
			<option value="Limbus-based">Limbus-based</option>
		</select>
		
		<select id="siteSelect">
			<option value="Superior">Superior</option>
			<option value="Superonasal">Superonasal</option>
			<option value="Superotemporal">Superotemporal</option>
		</select>
							        
        <select id="sizeSelect">
            <option value="4x3">4x3</option>
            <option value="5x2">5x2</option>
        </select>
        
        <select id="sclerostomySelect">
            <option value="Punch">Punch</option>
            <option value="Block">Block</option>
        </select>
            
        <!-- Input element -->
        <!-- 
        <input type="text" id="stenosisInput" value="0" />
        <input type="text" id="typeInput" value="Calcified" />
         --> 
         
        <button onclick="console.log(drawingEdit.report()); return false;" >Report</button>
        


        
    </body>
</html>
 
