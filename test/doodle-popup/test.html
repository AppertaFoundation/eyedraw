<!doctype html>
<html>
<head>
	<title>Eyedraw doodle popup menu prototype</title>

	<!-- This is the main OpenEyes stlesheet -->
	<link rel="stylesheet" type="text/css" href="css/style.css" />

	<!-- This is purely used for test/demo purposes -->
	<link rel="stylesheet" type="text/css" href="css/test.css" />

	<!-- The eyedraw widget stylesheet -->
	<link rel="stylesheet" type="text/css" href="../../assets/css/oe-eyedraw.css" />

	<!-- Other dependent scripts -->
	<script type="text/javascript" src="../../assets/components/jquery/jquery.min.js"></script>

	<!-- Load in the eyedraw scripts -->
	<script>
	(function() {
		// We have to use 'jsonp' here so that we can run this test document on the
		// file:// protocol (ie, without the use of a webserver)
		window.scriptsLoadCallback = function(obj) {
			obj.files.forEach(function(file) {
				// We use document.write to force the files to be loaded synchronously.
				document.write('<script src="../../src/' + file + '"><\/script>');
			});
		};
	}(this));
	</script>
	<script type="text/javascript" src="./scripts.jsonp"></script>
	<!-- End loading in eyedraw scripts -->
</head>
<body>
	<div class="container main" role="main">
		<div class="container content">
			<div class="large-12 column event edit">
				<header class="event-header">
					<ul class="inline-list tabs event-actions">
						<li class="selected">
							<a href="#">Create</a>
						</li>
					</ul>
				</header>
				<div class="event-content" id="event-content">
					<h2 class="event-title">Event title</h2>
					<section class="element Element_OphCiExamination_AnteriorSegment">
						<header class="element-header">
							<h3 class="element-title">Element title</h3>
						</header>
						<div class="element-fields element-eyes row">
							<div class="element-eye right-eye column side left" data-side="right">
								<div class="eyedraw-row row anterior-segment">
									<div class="fixed column">

										<!-- EYEDRAW WIDGET START -->
										<div class="eyedraw-widget" id="eyedrawwidget_example">

											<!-- TOOLBAR START -->
											<div class="eyedraw-toolbar">

												<!-- PANEL START -->
												<ul class="panel">
													<li>
														<a class="eyedraw-button" href="#" data-function="moveToFront">
															<img src="../../assets/img/moveToFront.gif" />
															<span class="label">Move to front</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="moveToBack">
															<img src="../../assets/img/moveToBack.gif" />
															<span class="label">Move to back</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="deleteSelectedDoodle">
															<img src="../../assets/img/deleteSelectedDoodle.gif" />
															<span class="label">Delete</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="resetEyedraw">
															<img src="../../assets/img/resetEyedraw.gif" />
															<span class="label">Reset eyedraw</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="lock">
															<img src="../../assets/img/lock.gif" />
															<span class="label">Lock</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="unlock">
															<img src="../../assets/img/unlock.gif" />
															<span class="label">Unlock</span>
														</a>
													</li>
												</ul>
												<!-- PANEL END -->

												<!-- PANEL START -->
												<ul class="panel">
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="NuclearCataract">
															<img src="../../assets/img/NuclearCataract.gif" />
															<span class="label">Nuclear cataract</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="CorticalCataract">
															<img src="../../assets/img/CorticalCataract.gif" />
															<span class="label">Cortical cataract</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="PostSubcapCataract">
															<img src="../../assets/img/PostSubcapCataract.gif" />
															<span class="label">Posterior subcapsular cataract</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="PCIOL">
															<img src="../../assets/img/PCIOL.gif" />
															<span class="label">Posterior chamber IOL</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="ACIOL">
															<img src="../../assets/img/ACIOL.gif" />
															<span class="label">Anterior chamber IOL</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="Bleb">
															<img src="../../assets/img/Bleb.gif" />
															<span class="label">Trabeculectomy bleb</span>
														</a>
													</li>
													<li>
														<a class="eyedraw-button" href="#" data-function="addDoodle" data-arg="PI">
															<img src="../../assets/img/PI.gif" />
															<span class="label">Peripheral iridectomy</span>
														</a>
													</li>
													<li class="drawer">
														<a class="eyedraw-button" href="#">
															<img src="../../assets/img/more.gif" />
															<span class="label">More...</span>
														</a>
														<ul>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="Fuchs">
																	<img src="../../assets/img/Fuchs.gif" />
																	<span class="label">Fuchs endothelial dystrophy</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="RK">
																	<img src="../../assets/img/RK.gif" />
																	<span class="label">Radial keratotomy</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="LasikFlap">
																	<img src="../../assets/img/LasikFlap.gif" />
																	<span class="label">LASIK flap</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="CornealScar">
																	<img src="../../assets/img/CornealScar.gif" />
																	<span class="label">Corneal scar</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="SectorIridectomy">
																	<img src="../../assets/img/SectorIridectomy.gif" />
																	<span class="label">Sector iridectomy</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="PosteriorSynechia">
																	<img src="../../assets/img/PosteriorSynechia.gif" />
																	<span class="label">Posterior synechia</span>
																</a>
															</li>
															<li>
																<a class="eyedraw-button" href="" data-function="addDoodle" data-arg="Rubeosis">
																	<img src="../../assets/img/Rubeosis.gif" />
																	<span class="label">Rubeosis iridis</span>
																</a>
															</li>
														</ul>
													</li>
												</ul>
												<!-- PANEL END-->
											</div>
											<!-- TOOLBAR END -->

											<!-- CANVAS START -->
											<canvas
											id="ed_example"
											class="ed_canvas_edit"
											width="300"
											height="300"
											tabindex="1"
											>
											</canvas>
											<input
												type="hidden"
												id="ed_example_data"
												value='' />
											<!-- CANVAS END -->

										</div>
										<!-- EYEDRAW WIDGET END -->

									</div>
									<div class="fluid column">
										<div class="eyedraw-fields">
											<!-- FIELD ROW -->
											<div class="field-row">
												<label for="eyedraw-field-1">
													Field 1:
												</label>
												<div class="row">
													<div class="large-8 column">
														<select name="field" id="eyedraw-field-1">
															<option>Large</option>
															<option>Medium</option>
															<option>Small</option>
														</select>
													</div>
												</div>
											</div>
											<!-- FIELD ROW -->
											<div class="field-row">
												<label for="eyedraw-field-2">
													Field 2:
												</label>
												<div class="row">
													<div class="large-8 column">
														<select name="field" id="eyedraw-field-2">
															<option>Large</option>
															<option>Medium</option>
															<option>Small</option>
														</select>
													</div>
												</div>
											</div>
											<!-- FIELD ROW -->
											<div class="field-row">
												<label for="eyedraw-field-3">
													Field 3:
												</label>
												<textarea rows="2" id="eyedraw-field-3"></textarea>
											</div>
											<!-- FIELD ROW -->
											<fieldset class="field-row">
												<label>
													<input type="checkbox"> Option 1
												</label>
												<label>
													<input type="checkbox"> Option 2
												</label>
											</fieldset>
											<!-- FIELD ROW -->
											<div class="field-row">
												<button class="small">Report</button>
												<button class="small">Clear</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>

	<!-- EYEDRAW INIT -->
	<script>

		// Here we init the eyedraw.
		eyeDrawInit({
			'drawingName': 'ed_example',
			'canvasId': 'ed_example',
			'eye': 0,
			'scale': 1,
			'idSuffix': '',
			'isEditable': true,
			'focus': false,
			'graphicsPath': '../../assets/img/',
			'inputId': 'ed_example_data',
			'onReadyCommandArray': [
				['addDoodle', ['AntSeg']],
				['deselectDoodles', []]
			],
			'onDoodlesLoadedCommandArray': [],
			'bindingArray': {
				// 'AntSeg': {
				// 	'pupilSize': {
				// 		'id': 'Element_OphCiExamination_AnteriorSegment_right_pupil_id',
				// 		'attribute': 'data-value'
				// 	},
				// 	'pxe': {
				// 		'id': 'Element_OphCiExamination_AnteriorSegment_right_pxe'
				// 	}
				// },
				// 'NuclearCataract': {
				// 	'grade': {
				// 		'id': 'Element_OphCiExamination_AnteriorSegment_right_nuclear_id',
				// 		'attribute': 'data-value'
				// 	}
				// },
				// 'CorticalCataract': {
				// 	'grade': {
				// 		'id': 'Element_OphCiExamination_AnteriorSegment_right_cortical_id',
				// 		'attribute': 'data-value'
				// 	}
				// }
			},
			// 'deleteValueArray': {
			// 	'Element_OphCiExamination_AnteriorSegment_right_nuclear_id': '',
			// 	'Element_OphCiExamination_AnteriorSegment_right_cortical_id': ''
			// },
			'syncArray': [],
			'listenerArray': [],
			'offsetX': 0,
			'offsetY': 0,
			'toImage': false
		});

		// Here we init the eyedraw toolbar. Ideally, this should be managed by
		// eyedraw itself.
		(function initToolbars(widgets) {

			function onDrawerButtonClick(e) {
				e.preventDefault();
				e.stopImmediatePropagation();
				var button = $(e.currentTarget);
				button.closest('.drawer').toggleClass('active');
			}

			function onButtonClick(e) {
				e.preventDefault();

				var button = $(e.currentTarget);
				var fn = button.data('function');
				var arg = button.data('arg');

				// @todo
				// 1. Find the eyedraw instance
				// 2. Execute the function on the eyedraw instance
			}

			function onDocumentClick(e) {
				widgets.find('.drawer').removeClass('active');
			}

			widgets.on('click', '.eyedraw-toolbar .drawer > a', onDrawerButtonClick);
			widgets.on('click', '.eyedraw-toolbar a', onButtonClick);;
			$(document).on('click', onDocumentClick);

		}($('.eyedraw-widget')));
	</script>
	<!-- END EYEDRAW INIT -->
</body>
</html>