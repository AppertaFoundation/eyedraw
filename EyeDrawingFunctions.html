<!DOCTYPE html>
<html>
    <head>
        <title>EyeDraw</title>
        
        <link rel="stylesheet" href="styles.css" type="text/css" media="screen" />
        
        <!--   Include this file first to establish name space and include key drawing classes -->
        <script language="JavaScript" src="ED_Drawing.js" type="text/javascript"></script>
        
        <!--   Subclasses loaded according to need -->
        <script language="JavaScript" src="ED_General.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_VitreoRetinal.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_Cancer.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_AntSeg.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_MedicalRetina.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_Strabismus.js" type="text/javascript"></script>
        <script language="JavaScript" src="ED_Adnexal.js" type="text/javascript"></script>
        
        <!--   This script handles the drawings for the page   -->
        <script type="text/javascript">
            
//            $(document).ready(function() {
//                              $("a").click(function() {
//                                           alert("Hello world!");
//                                           });
//                              });
            
            
            // This set is written by PHP and contains doodle data for this drawing from the database
            var doodleSetRPS = 
            
//[{"subclass": "Freehand", "originX": 0, "originY": 0, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 180, "rotation": 0, "order": 0, "squiggleArray": [{"colour": {"red":255,"green":0,"blue":0,"alpha":1}, "thickness": 4, "filled": "true", "pointsArray": [{"x":-36.96,"y":-114.89}, {"x":-32.97,"y":-110.89}, {"x":-30.97,"y":-108.89}, {"x":-20.98,"y":-102.90}, {"x":-16.98,"y":-102.90}, {"x":-5.00,"y":-100.90}, {"x":5.00,"y":-100.90}, {"x":18.98,"y":-100.90}, {"x":26.97,"y":-100.90}, {"x":36.96,"y":-100.90}, {"x":40.96,"y":-102.90}, {"x":44.96,"y":-102.90}, {"x":46.95,"y":-104.90}, {"x":48.95,"y":-106.89}, {"x":48.95,"y":-110.89}, {"x":50.95,"y":-112.89}, {"x":52.95,"y":-116.88}, {"x":52.95,"y":-118.88}, {"x":52.95,"y":-120.88}, {"x":52.95,"y":-122.88}, {"x":52.95,"y":-126.87}, {"x":52.95,"y":-128.87}, {"x":52.95,"y":-132.87}, {"x":52.95,"y":-136.86}, {"x":50.95,"y":-138.86}, {"x":50.95,"y":-140.86}, {"x":50.95,"y":-142.86}, {"x":50.95,"y":-146.85}, {"x":48.95,"y":-152.85}, {"x":48.95,"y":-156.84}, {"x":46.95,"y":-160.84}, {"x":46.95,"y":-162.84}, ]}, ]}, {"subclass": "RoundHole", "originX": 0, "originY": -376, "apexX": 0, "apexY": 0, "scaleX": 1.00, "scaleY": 1.00, "arc": 180, "rotation": 0, "order": 1, "squiggleArray": []}, ]
            
            
            [
             //{subclass: "Fundus", originX: "0", originY: "0", apexX: "0", apexY: "0", scaleX: "1", scaleY: "1", arc: "0", rotation: "0", order: "0"},
//             {subclass: "RRD", originX: "0", originY: "0", apexX: "0", apexY: "105", scaleX: "1", scaleY: "1", arc: "160", rotation: "330", order: "1"},
             //{subclass: "UTear", originX: "-212", originY: "-320", apexX: "0", apexY: "-22", scaleX: "1", scaleY: "1", arc: "0", rotation: "327", order: "2"}
             //{subclass: "Arrow", originX: "0", originY: "0", apexX: "0", apexY: "0", scaleX: "1", scaleY: "1", arc: "0", rotation: "0", order: "0"}
             ]
            
            // Assign a global variable to each drawing on the page
            var drawing;
            var drawing2;
            
           
            // Runs on page load
            function init()
            {
                // Get reference to the drawing canvas
                var canvas = document.getElementById('canvas');
                
                // Create a drawing
                drawing = new ED.Drawing(canvas, ED.eye.Right, 'RPS');
                
                //drawing.globalScaleFactor = 0.8;
                
                // Preload any images
                drawing.preLoadImagesFrom('graphics/');
                
                // Set focus to canvas element
                canvas.focus();
                
                // Wait for drawing object to be ready before adding objects or drawings
                drawing.onLoaded = function()
                {
                    var doodle = drawing.addDoodle('Lattice');
                    //doodle.willReport = false;
                    
                    //drawing.addDoodle('BuckleOperation');
                    //drawing.addDoodle('CircumferentialBuckle');
                    //drawing.addDoodle('EncirclingBand');
                    //drawing.addDoodle('BuckleSuture');
                    //drawing.addDoodle('Patch');
                    //drawing.deselectDoodles();
//                    var doodle = drawing.addDoodle('UpDrift');
//                    doodle.originX = doodle.quadrantPoint.x;
//                    doodle.originY = -doodle.quadrantPoint.y; 
                    //drawing.deselectDoodles();
                    //drawing.lock();
                    
                    drawing.drawAllDoodles();
                }
                
                // Function to detect changes in parameters (eg from mouse dragging)
                drawing.parameterListener = function()
                {
                    // Get reference to form inputs
                    var platePosition = document.getElementById('platePosition');
                    var plateLimbusDistance = document.getElementById('plateLimbusDistance');
                    
                    // Check doodle of appropriate classname is selected
                    if (drawing.selectedDoodle != null && drawing.selectedDoodle.className == 'Baerveldt')
                    {
                        platePosition.value = drawing.selectedDoodle.getParameter('platePosition');
                        plateLimbusDistance.value = drawing.selectedDoodle.getParameter('plateLimbusDistance');
                    }
                }
                
                // Load doodleSet (for existing drawings)
                //drawing.load(doodleSetRPS);
                
                // Use fundus as template (for new drawings)
                //drawing.addDoodle('Fundus');
                //drawing.lock();
                
                // Test new doodles here
                //drawing.addDoodle('LaserCircle');
                //drawing.addDoodle('Retinoschisis');
                //drawing.addDoodle('OuterLeafBreak');
                //drawing.addDoodle('InnerLeafBreak');
                //drawing.deselectDoodles();
                
                // Draw doodles
                //drawing.drawAllDoodles();
                
                //img.src = "graphics/laserPattern.gif";

                
                // Test background image
//                var img = new Image();
//                img.onload = function(){
//                    drawing.image = img;
//                    
//                    // Draw doodles
//                    drawing.repaint();
//                }
//                img.src = "graphics/bsv.png";

            }
            
            // Temporary test function
            function test()
            {
                
                var report = new ED.Report(drawing);
                console.log("lowest position: " + report.lowestBreakPosition);
                //var doodle = drawing.firstDoodleOfClass('PhakoIncision');
                //console.log(typeof(doodle['incision']));
                //console.log(doodle.apexY);
                //doodle.apexY = -384;
                //drawing.repaint();
                
            }
            
            function updateIncision(_value)
            {
                // Set grade
                var doodle = drawing.firstDoodleOfClass('PhakoIncision');
                doodle.setIncision(_value);

                // Refresh drawing
                drawing.repaint();
            }
            
      
            // Returns true if browser is firefox
            function isFirefox()
            {
                var index = 0;
                var ua = window.navigator.userAgent;
                index = ua.indexOf("Firefox");
                
                if (index > 0)
                {
                    return true;
                }
                else
                {
                    return false;
                }
            }
            
            // Changes colour of preview display
            function changeColour(_hexColour)
            {
                document.getElementById("colourPreviewRPS").style.background=_hexColour;
            }
            
   
            </script>
    </head>
    <body onload="init();">
        <!-- <input type="text" id="testInput" name="somename" size="20" value="22" onblur="updateNuclearCataract(this.value);"/> -->
                
        <label for="Dataset_asmt_eye">Eye</label>
        <select onChange="drawing.setEye(this.value);" name="Dataset[asmt_eye]" id="Dataset_asmt_eye">
            <option value="Right" selected="selected">Right</option>
            <option value="Left">Left</option>
        </select> 
        
        <select name="incision" id="platePosition" onclick="drawing.setParameterForDoodle('Baerveldt', 'platePosition', this.value);" >
            <option value="STQ">STQ</option>
            <option value="ITQ">ITQ</option>
            <option value="SNQ">SNQ</option>
            <option value="INQ">INQ</option>
        </select>
        <input type="text" id="plateLimbusDistance" onchange="drawing.setParameterForDoodle('Baerveldt', 'plateLimbusDistance', this.value);"/>
        <input type="text" id="incisionMeridian" onchange="drawing.setParameterForDoodle('PhakoIncision', 'incisionMeridian', this.value);"/>
        <select name="incisionType" id="incisionType" onclick="drawing.setParameterForDoodle('PhakoIncision', 'incisionType', this.value);" >
            <option value="Pocket">Pocket</option>
            <option value="Section">Section</option>
        </select>
        <div>
            <div>
                <form>
                    <div>
                        <span>
                            <!-- Doodle toolbar -->
                            <button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawing.moveToFront(); return false;" ><img src="graphics/moveToFront.gif"/></button>
                            <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawing.moveToBack(); return false;" ><img src="graphics/moveToBack.gif" /></button>
                            <button class="imgbutton" disabled="true" id="deleteRPS" title="Delete" onclick="drawing.deleteDoodle(); return false;" ><img src="graphics/delete.gif" /></button>
                            <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawing.lock(); return false;" ><img src="graphics/lock.gif" /></button>
                            <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawing.unlock(); return false;" ><img src="graphics/unlock.gif" /></button>

                            <!-- Squiggle options 
                            <span <span class= "squiggle" id="squiggleSpanRPS" style="display:none;">
                                <img class="colourWell" border="0" src="graphics/colourWell.gif" usemap="#colormap" alt='colormap' />
                                <map id="colormap" name="colormap">
                                    <area style="cursor:pointer" shape="rect" coords="0,0,16,16" onclick="changeColour('#000000');" />
                                    <area style="cursor:pointer" shape="rect" coords="16,0,32,16" onclick="changeColour('#FF0000');" />
                                    <area style="cursor:pointer" shape="rect" coords="32,0,48,16" onclick="changeColour('#FF7F00');" />
                                    <area style="cursor:pointer" shape="rect" coords="0,16,16,32" onclick="changeColour('#0000FF');" />
                                    <area style="cursor:pointer" shape="rect" coords="16,16,32,32" onclick="changeColour('#00FF00');" />
                                    <area style="cursor:pointer" shape="rect" coords="32,16,48,32" onclick="changeColour('#FFFF00');" />
                                </map>
                                <table class="preview" cellpadding="0" border="0" cellspacing="0" width="32"><tr><td width="32"><div id="colourPreviewRPS" style="height:32px;width:32px;background-color:#FF0000;">&nbsp;</div></td></tr>
                                </table>
                                <select class="thickness" id="thicknessSelectRPS" >
									<option value="Thin">Thin</option>
									<option value="Medium">Medium</option>
									<option value="Thick">Thick</option>
								</select>
                                <span class="fill">
	                                <input id="fillRadioRPS" class="fillbutton" type="radio" name="fill" checked="true"/>Solid<br />
	                                <input class="fillbutton" type="radio" name="fill"/>Outline<br />
								</span>
                            </span> -->
                                                        
                            <br />
                            
                            <!-- Doodle selection toolbar -->
                            <!--
                            <button class="imgbutton" id="RRDRPS" title="Retinal detachment" onclick="drawing.addDoodle('RRD'); return false;" ><img src="graphics/rrd.gif" /></button>
                            <button class="imgbutton" id="uTearRPS" title="U tear" onclick="drawing.addDoodle('UTear'); return false;" ><img src="graphics/uTear.gif" /></button>
                            <button class="imgbutton" id="roundHoleRPS" title="Round hole" onclick="drawing.addDoodle('RoundHole'); return false;" ><img src="graphics/roundHole.gif" /></button>
                            <button class="imgbutton" id="dialysisRPS" title="Dialysis" onclick="drawing.addDoodle('Dialysis'); return false;" ><img src="graphics/dialysis.gif" /></button>
                            <button class="imgbutton" id="grtRPS" title="GRT" onclick="drawing.addDoodle('GRT'); return false;" ><img src="graphics/grt.gif" /></button>
                            <button class="imgbutton" id="macularHoleRPS" title="Macular hole" onclick="drawing.addDoodle('MacularHole'); return false;" ><img src="graphics/macularHole.gif" /></button>
                            <button class="imgbutton" id="starFoldRPS" title="Star Fold" onclick="drawing.addDoodle('StarFold'); return false;" ><img src="graphics/starFold.gif" /></button>
                            <button class="imgbutton" id="antPVRRPS" title="Anterior PVR" onclick="drawing.addDoodle('AntPVR'); return false;" ><img src="graphics/antPVR.gif" /></button>
                            <button class="imgbutton" id="latticeRPS" title="Lattice" onclick="drawing.addDoodle('Lattice'); return false;" ><img src="graphics/lattice.gif" /></button>
                            <button class="imgbutton" id="cryoRPS" title="Cryo" onclick="drawing.addDoodle('Cryo'); return false;" ><img src="graphics/cryo.gif" /></button>
                            <button class="imgbutton" id="laserCircleRPS" title="Laser" onclick="drawing.addDoodle('LaserCircle'); return false;" ><img src="graphics/laserCircle.gif" /></button>
                            <button class="imgbutton" id="buckleRPS" title="Buckle" onclick="drawing.addDoodle('Buckle'); return false;" ><img src="graphics/buckle.gif" /></button>
                             <br />
                            
                            <button class="imgbutton" id="retinoschisisRPS" title="Retinoschisis" onclick="drawing.addDoodle('Retinoschisis'); return false;" ><img src="graphics/retinoschisis.gif" /></button>
                            <button class="imgbutton" id="outerleafbreakRPS" title="Outer leaf break" onclick="drawing.addDoodle('OuterLeafBreak'); return false;" ><img src="graphics/outerLeafBreak.gif" /></button>
                            <button class="imgbutton" id="innerleafbreakRPS" title="Inner leaf break" onclick="drawing.addDoodle('InnerLeafBreak'); return false;" ><img src="graphics/innerLeafBreak.gif" /></button>
                            <br />
                            
                            <button class="imgbutton" id="buckleRPS" title="Freehand" onclick="drawing.addDoodle('Freehand'); return false;" ><img src="graphics/freehand.gif" /></button>
                            <button class="imgbutton" id="lableRPS" title="Lable" onclick="drawing.addDoodle('Lable'); canvas.focus(); return false;" ><img src="graphics/lable.gif" /></button>
                            <button class="imgbutton" id="arrowRPS" title="Arrow" onclick="drawing.addDoodle('Arrow'); return false;" ><img src="graphics/arrow.gif" /></button> 
                            <button class="imgbutton" id="pointInLine" title="Line of points" onclick="drawing.togglePointInLine(); return false;" ><img src="graphics/pointInLine.gif" /></button> -->
                            
                            <!-- Anterior segment doodles -->
                            <!--
                            <button class="imgbutton" id="NuclearCataractRPS" title="Nuclear Cataract" onclick="drawing.addDoodle('NuclearCataract'); return false;" ><img src="graphics/nuclearCataract.gif" /></button>
                            <button class="imgbutton" id="CorticalCataractRPS" title="Cortical Cataract" onclick="drawing.addDoodle('CorticalCataract'); return false;" ><img src="graphics/corticalCataract.gif" /></button>
                            <button class="imgbutton" id="PostSubcapCataractRPS" title="Posterior Subcapsular Cataract" onclick="drawing.addDoodle('PostSubcapCataract'); return false;" ><img src="graphics/postSubcapCataract.gif" /></button>
                            <button class="imgbutton" id="PCIOLRPS" title="Posterior Chamber IOL" onclick="drawing.addDoodle('PCIOL'); return false;" ><img src="graphics/PCIOL.gif" /></button>
                            <button class="imgbutton" id="ACIOLRPS" title="Anterior Chamber IOL" onclick="drawing.addDoodle('ACIOL'); return false;" ><img src="graphics/ACIOL.gif" /></button>
                            <button class="imgbutton" id="BlebRPS" title="Trabeculectomy bleb" onclick="drawing.addDoodle('Bleb'); return false;" ><img src="graphics/bleb.gif" /></button>
                            <button class="imgbutton" id="PIRPS" title="Peripheral Iridectomy" onclick="drawing.addDoodle('PI'); return false;" ><img src="graphics/PI.gif" /></button>
                             <button class="imgbutton" id="FuchsRPS" title="Fuch's Endothelial Dystrophy" onclick="drawing.addDoodle('Fuchs'); return false;" ><img src="graphics/fuchs.gif" /></button>
                             <button class="imgbutton" id="RKRPS" title="Radial keratotomy" onclick="drawing.addDoodle('RK'); return false;" ><img src="graphics/rk.gif" /></button> 
                             <button class="imgbutton" id="LasikFlapRPS" title="Lasik Flap" onclick="drawing.addDoodle('LasikFlap'); return false;" ><img src="graphics/lasikFlap.gif" /></button>                            
                             <button class="imgbutton" id="CornealScarRPS" title="Corneal Scar" onclick="drawing.addDoodle('CornealScar'); return false;" ><img src="graphics/cornealScar.gif" /></button> -->
                            
                            
                            <!-- Medical retinal doodles 
                            <button class="imgbutton" id="geographicRPS" title="Geographic atrophy" onclick="drawing.addDoodle('Geographic'); return false;" ><img src="graphics/geographic.gif" /></button>
                            <button class="imgbutton" id="vitreousOpacityRPS" title="Vitreous Opacity" onclick="drawing.addDoodle('VitreousOpacity'); return false;" ><img src="graphics/vitreousOpacity.gif" /></button>
                            <button class="imgbutton" id="diabeticNVRPS" title="Diabetic new vessels" onclick="drawing.addDoodle('DiabeticNV'); return false;" ><img src="graphics/diabeticNV.gif" /></button>
                            <button class="imgbutton" id="cNVRPS" title="Choroidal neovascularisation" onclick="drawing.addDoodle('CNV'); return false;" ><img src="graphics/cnv.gif" /></button>
                             <button class="imgbutton" id="circinateRPS" title="Circinate maculopathy" onclick="drawing.addDoodle('Circinate'); return false;" ><img src="graphics/circinate.gif" /></button>-->
                            

                            <!-- Phako surgery doodles 
                            <button class="imgbutton" id="phakoIncisionRPS" title="Cataract incision" onclick="drawing.addDoodle('PhakoIncision'); return false;" ><img src="graphics/phakoIncision.gif" /></button>
                            <button class="imgbutton" id="sidePortRPS" title="Side port" onclick="drawing.addDoodle('SidePort'); return false;" ><img src="graphics/sidePort.gif" /></button> 
                            <button class="imgbutton" id="sidePortRPS" title="Iris Hook" onclick="drawing.addDoodle('IrisHook'); return false;" ><img src="graphics/irisHook.gif" /></button>                             
                             <button class="imgbutton" id="sidePortRPS" title="Iris Hook" onclick="drawing.addDoodle('MattressSuture'); return false;" ><img src="graphics/mattressSuture.gif" /></button> -->                           
                            
                            <!-- Breast cancer doodles 
                            <button class="imgbutton" id="cryoRPS" title="Cryo" onclick="drawing.addDoodle('Lump'); return false;" ><img src="graphics/lump.gif" /></button>
                            <button class="imgbutton" id="buckleRPS" title="Buckle" onclick="drawing.addDoodle('Scar'); return false;" ><img src="graphics/scar.gif" /></button>
                             -->
                            
                            <!-- Glaucoma doodles -->
                            <!-- 
                            <button class="imgbutton" id="shading" title="Baerveldt tube" onclick="drawing.addDoodle('Baerveldt'); return false;" ><img src="graphics/baerveldt.gif" /></button>                           
                            <button class="imgbutton" id="upshoot" title="Patch" onclick="drawing.addDoodle('Patch'); return false;" ><img src="graphics/patch.gif" /></button> -->

                            <!-- Strabismus doodles
                            <button class="imgbutton" id="shading" title="Shading" onclick="drawing.addDoodle('Shading'); return false;" ><img src="graphics/shading.gif" /></button>                           
                            <button class="imgbutton" id="upshoot" title="Upshoot" onclick="drawing.addDoodle('UpShoot'); return false;" ><img src="graphics/UpShoot.gif" /></button>
                            <button class="imgbutton" id="updrift" title="Up/down drift" onclick="drawing.addDoodle('UpDrift'); return false;" ><img src="graphics/UpDriftFromRight.gif" /></button> -->
                            
                            
                            <!-- VR opnote doodles -->
                            <button class="imgbutton" id="circumferentialBuckle" title="Circumferential Buckle" onclick="drawing.addDoodle('CircumferentialBuckle'); return false;" ><img src="graphics/circumferentialBuckle.gif" /></button>                            
                            <button class="imgbutton" id="encirclingBand" title="Encircling Band" onclick="drawing.addDoodle('EncirclingBand'); return false;" ><img src="graphics/encirclingBand.gif" /></button>
                            <button class="imgbutton" id="radialSponge" title="Radial Sponge" onclick="drawing.addDoodle('RadialSponge'); return false;" ><img src="graphics/radialSponge.gif" /></button> 
                            <button class="imgbutton" id="buckleSuture" title="Buckle suture" onclick="drawing.addDoodle('BuckleSuture'); return false;" ><img src="graphics/buckleSuture.gif" /></button>
                            <button class="imgbutton" id="drainageSite" title="Drainage site" onclick="drawing.addDoodle('DrainageSite'); return false;" ><img src="graphics/drainageSite.gif" /></button>
                            
                            <!--
                            <br />  
                            <button class="imgbutton" id="antSeg" title="Anterior Segment" onclick="drawing.addDoodle('AntSeg'); return false;" ><img src="graphics/antSeg.gif" /></button>
                             -->
                            
                            <br />
                            <!-- add tabindex="1" to make canvas focusable -->
                            <!-- <canvas id="canvas" class="canvasclass" width="725" height="530" tabindex="1"></canvas> -->
                            <canvas id="canvas" class="canvasclass" width="400" height="400" tabindex="2"></canvas>
                            <br />
                            <button title="Report" onclick="alert(drawing.report()); return false;" >Report</button><br />
                            <button title="Delete" onclick="drawing.deleteDoodlesOfClass('UTear'); return false;" >Delete</button><br />
                            <button title="Clear" onclick="drawing.deleteAllDoodles(); return false;" >Clear</button><br />
                            <button title="Test" onclick="test(); return false;" >Test</button><br />
                            
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </body>
</html>